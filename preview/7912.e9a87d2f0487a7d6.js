/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunk_cosmos_journeyer_game=globalThis.webpackChunk_cosmos_journeyer_game||[]).push([["7912"],{93039(e,t,i){i.d(t,{A:()=>o});var r=i(59530),n=i(26934),s=i(16891);let a="undefined"==typeof performance?()=>performance.now():()=>Date.now();class o extends s.A{constructor(e={}){let t;super(),Array.isArray(e)&&(e={bindings:e}),this.name=e.name||"";const i=[],s=[];let o=!1,l=!0,u=null,h=0;this.bindings=i,this.processors=s,this.bind=(e,r)=>{if(r||e instanceof n.A||(r=e),r&&r.control&&(e=r.control),!(e instanceof n.A))throw Error("Binding requires an InputControl");let s={control:e,processors:r&&r.processors};return i.push(s),void 0===t&&(t=Object.getPrototypeOf(e).constructor.defaultValue),(null==r?void 0:r.autoUpdate)!==!1&&e.on("change",this.update),i.length-1},this.unbind=e=>{if(e<i.length&&e>=0){let t=i[e];i.splice(e,1),t.control.off("change",this.update)}},this.update=()=>{if(!l)return;let e=t;u=null;let n=-1/0;for(let e=0;e<i.length;e++){let s=i[e],{control:o}=s;if(o.enabled){let e=s.processors?(0,r.A)(s.processors,o.read()):o.read(),i=o.magnitude(e);i>n&&(t=e,n=i,i>0&&(u=s,h||(h=a())))}}u||(h=0),void 0!==t&&(t=(0,r.A)(s,t)),this.emit("update"),t!==e&&this.emit("change")};const c=this.destroy;this.destroy=()=>{o=!0,l=!1,c()},Object.defineProperties(this,{enabled:{set(e){(e=!!e)===l||o||((l=e)?this.emit("enable"):this.emit("disable"))},get:()=>l},activeControl:{get:()=>u?u.control:null},value:{get:()=>t}}),e.bindings&&e.bindings.forEach(e=>{this.bind(e)}),e.processors&&s.push(...e.processors),!1===e.enabled&&(this.enabled=!1)}}},9059(e,t,i){i.d(t,{$9:()=>s,Ct:()=>a,pF:()=>n});var r=i(16891);class n extends r.A{}class s extends n{}class a extends s{}},60688(e,t,i){i.d(t,{A:()=>s});var r=i(65959),n=i(82090);class s extends n.A{constructor(e){const{negative:t,positive:i}=e;super(()=>{let e=this.children.get("negative").read();return this.children.get("positive").read()-e},(0,r.Tt)(e,["negative","positive"])),this.children.set("negative",t),this.children.set("positive",i);const n=()=>this.emit("change");this.children.forEach(e=>{e.on("change",n)})}}},82090(e,t,i){i.d(t,{A:()=>n});var r=i(26934);class n extends r.A{constructor(e,t){e&&"function"!=typeof e&&!t&&(t=e,e=null),super(e,t),this.axis=this.read}}},54451(e,t,i){i.d(t,{A:()=>n});var r=i(82090);class n extends r.A{constructor(e,t){e&&"object"==typeof e&&!t&&(t=e,e=null),super(e,t),this.pressPoint=.5,(null==t?void 0:t.pressPoint)!==void 0&&(this.pressPoint=null==t?void 0:t.pressPoint)}pressed(e=this.magnitude()){return e>=this.pressPoint}}},36960(e,t,i){i.d(t,{A:()=>s});var r=i(65959),n=i(91806);class s extends n.A{constructor(e){var{left:t,right:i,up:n,down:s}=e;super(()=>[this.children.get("right").read()-this.children.get("left").read(),this.children.get("up").read()-this.children.get("down").read()],(0,r.Tt)(e,["left","right","up","down"])),this.children.set("left",t),this.children.set("right",i),this.children.set("up",n),this.children.set("down",s);const a=()=>this.emit("change");this.children.forEach(e=>{e.on("change",a)})}}},26934(e,t,i){i.d(t,{A:()=>a});var r=i(65959),n=i(59530),s=i(16891);class a extends s.A{constructor(e,t){super(),this.name="",this.parent=null,this.enabled=!0,this.children=new Map,this.device=null,this.processors=[],e&&"object"==typeof e&&!t&&(t=e,e=void 0);const i=t||{},{processors:s,children:a,active:o}=i;if(!function(e,t){t&&Object.keys(e).forEach(i=>{i in t&&"function"!=typeof e[i]&&(e[i]=t[i])})}(this,(0,r.Tt)(i,["processors","children","active"])),this.device&&this.device.on("change",()=>{this.enabled&&this.emit("change")}),s)for(const e of s)this.processors.push(e);if(a)for(const[e,t]of Array.isArray(a)||a instanceof Map?a:Object.entries(a))this.children.set(e,t);const l=e||this.read.bind(this),u=()=>(0,n.A)(this.processors,l());this.read=()=>this.enabled?u():Object.getPrototypeOf(this).constructor.defaultValue,"function"==typeof o&&(this.active=()=>o(this));const h=this.destroy;this.destroy=()=>{h(),this.children.forEach(e=>e.destroy())}}find(e){if(!e)return this;let t=e.indexOf("/");if(t>0){let i=e.substring(0,t),r=this.children.get(i);if(r)return r.find(e.substring(t+1))}return this.children.get(e)||null}read(){return Object.getPrototypeOf(this).constructor.defaultValue}magnitude(e=this.read()){return"number"==typeof e?Math.abs(e):0}active(){return this.magnitude()>0}}a.defaultValue=0},72450(e,t,i){i.d(t,{A:()=>o});var r=i(91806),n=i(54451);function s(e,t,i){let[r,n]=e,s=Math.hypot(r,n),a=function(e,t=.125,i=.925){let r=Math.abs(e);return r<t?0:r>i?Math.sign(e):Math.sign(e)*(r-t)/(i-t)}(s,t,i);if(0===a)return[0,0];let o=a/s;return[r*o,n*o]}let a=[["left",0,!0],["right",0,!1],["down",1,!0],["up",1,!1]];class o extends r.A{constructor(e,t){e&&"object"==typeof e&&!t&&(t=e,e=null),super(e,Object.assign({processors:[s]},t)),a.forEach(([e,i,r])=>{var s,a;let o;s=this,o=Object.assign({},(a=t)&&a[e],{parent:s,device:s.device}),s[e]=new n.A(()=>{var e;let t;return e=s.read,t=e()[i],Math.max(0,r?-t:t)},o),s.children.set(e,s[e])});const i=()=>this.emit("change");this.children.forEach(e=>{e.on("change",i)})}}},91806(e,t,i){i.d(t,{A:()=>a});var r=i(65959),n=i(26934),s=i(82090);class a extends n.A{constructor(e,t){e&&"object"==typeof e&&!t&&(t=e,e=null);const i=t||{},{x:n,y:a}=i;super(e,(0,r.Tt)(i,["x","y"])),this.vector2=this.read,this.x=new s.A(()=>this.read()[0],Object.assign({},n,{parent:this,device:null==t?void 0:t.device})),this.y=new s.A(()=>this.read()[1],Object.assign({},a,{parent:this,device:null==t?void 0:t.device})),this.children.set("x",this.x),this.children.set("y",this.x);const o=()=>this.emit("change");this.children.forEach(e=>{e.on("change",o)})}magnitude(e=this.read()){return Math.hypot(e[0],e[1])}active(){let e=this.read();return 0!==e[0]||0!==e[1]}}a.defaultValue=[0,0]},67924(e,t,i){let r={dpadUp:12,dpadDown:13,dpadLeft:14,dpadRight:15,L1:4,L2:6,L3:10,R1:5,R2:7,R3:11,A:0,B:1,X:2,Y:3,start:9,select:8,home:16},n=[];Object.keys(r).forEach(e=>{n[r[e]]=e});var s=i(54451),a=i(72450),o=i(82090),l=i(9059);let u=new Set(n);["leftStick","rightStick"].forEach(e=>u.add(e)),s.A,a.A,o.A,l.Ct},98648(e,t,i){i.d(t,{A:()=>o});var r=i(65959),n=i(54451),s=i(28346),a=i(9059);class o extends a.pF{constructor(e){super();let t=!1,i=!1;const a=(null==e?void 0:e.keyCode)!==!1,o=new Set,l=e=>{let t=a?e.code:e.key;o.add(t),o.add(t.toLowerCase()),this.emit("change")},u=e=>{let t=a?e.code:e.key;o.delete(t),o.delete(t.toLowerCase()),this.emit("change")};function h(){return o.size>0}function c(e){return o.has(e.toLowerCase())}const d=(e=!1)=>{!i&&(i=!0,window.addEventListener("keydown",l),window.addEventListener("keyup",u),e&&this.emit("enable"))},p=(e=!1)=>{i&&(i=!1,o.clear(),window.removeEventListener("keydown",l),window.removeEventListener("keyup",u),e&&this.emit("disable"))};this.getControl=(e,t={})=>{let{filter:i=e}=t,a=(0,r.Tt)(t,["filter"]),l=h;return i&&("string"==typeof i?l=()=>c(i):"function"==typeof i?l=()=>h()&&i(new Set(o)):Array.isArray(i)&&(l=()=>i.some(c))),new n.A((0,s.A)(l),Object.assign({name:t.filter?String(e||i):"string"==typeof i&&i?`key:${i}`:String(e||i||"any key")},a,{device:this,children:null}))};const f=this.destroy;this.destroy=()=>{t=!0,f(),p()},Object.defineProperties(this,{connected:{enumerable:!1,configurable:!1,writable:!1,value:!0},enabled:{get:()=>i,set(e){e&&!t?d(!0):p(!0)}}}),(null==e?void 0:e.enabled)!==!1&&d()}}},91020(e,t,i){i.d(t,{A:()=>p});var r=i(54451),n=i(82090),s=i(91806),a=i(28346),o=i(9059);let l={leftMouseButton:{device:"mouse",index:0},touch:{device:"touch",index:0},penTip:{device:"pen",index:0},middleMouseButton:{device:"mouse",index:1},rightMouseButton:{device:"mouse",index:2},penBarrelButton:{device:"pen",index:2},mouseBackButton:{device:"mouse",index:3},mouseForwardButton:{device:"mouse",index:4},penEraser:{device:"pen",index:5}},u=[],h=new Set(Object.keys(l));h.forEach(e=>{let{device:t,index:i}=l[e];u[i]||(u[i]={}),u[i][t]=e});let c={position:{constructor:s.A,reader:e=>[e.x,e.y]},pagePosition:{constructor:s.A,reader:e=>[e.pageX,e.pageY]},screenPosition:{constructor:s.A,reader:e=>[e.screenX,e.screenY]},tilt:{constructor:s.A,reader:e=>[e.screenX/90,e.screenY/90]},contact:{constructor:s.A,reader:e=>[e.width,e.height]},delta:{constructor:s.A,reader:(e,t,i)=>{if(!t)return i;let r=(e.timeStamp-t.timeStamp)*.1||1;return[(e.x-t.x)/r,(e.y-t.y)/r]}},pageDelta:{constructor:s.A,reader:(e,t,i)=>{if(!t)return i;let r=e.timeStamp-t.timeStamp||1;return[(e.pageX-t.pageX)/r,(e.pageY-t.pageY)/r]}},screenDelta:{constructor:s.A,reader:"movementX"in MouseEvent.prototype?(e,t,i)=>e?[e.movementX,e.movementY]:i:(e,t,i)=>{if(!t)return i;let r=e.timeStamp-t.timeStamp||1;return[(e.screenX-t.screenX)/r,(e.screenY-t.screenY)/r]}}},d={constructor:n.A,reader:e=>e.pressure||0};class p extends o.$9{constructor(e={}){super();const{updatePeriod:t=1e3/60,element:i=document.body,touch:n=!0,pen:o=!0,mouse:l=!0,touchActionStyle:p=!0}=e;let{enabled:f=!0}=e,_=null,m=null,g=null;const b={pen:o,mouse:l,touch:n},y=new Set,x=e=>{if(f&&e.isPrimary&&b[e.pointerType]){m&&(!_||m.timeStamp-_.timeStamp>=t)&&(_=m),m=e;for(let t=0;t<u.length;t++){let i=1<<t,r=e.buttons&i,n=function(e,t=e.button){return t>=0&&t<u.length&&e.isPrimary&&u[t][e.pointerType]||""}(e,t);r?y.add(n):y.delete(n)}this.emit("change")}},T=()=>{m=_=null},v=e=>{g=e},A=p&&i.style?i:document.body;function S(){f=!0,window.addEventListener("pointerdown",x),window.addEventListener("pointerup",x),window.addEventListener("pointermove",x),window.addEventListener("pointerout",T),window.addEventListener("wheel",v)}function E(){f=!1,_=null,m=null,g=null,p&&(A.style.touchAction=""),y.clear(),window.removeEventListener("pointerdown",x),window.removeEventListener("pointerup",x),window.removeEventListener("pointermove",x),window.removeEventListener("pointerout",T),window.removeEventListener("wheel",v)}p&&(A.style.touchAction="none"),this.getControl=(e,i={})=>{let n="pressure"===e?d:c[e];if(n){let{constructor:t,reader:r}=n;return new t(()=>m?r(m,_,t.defaultValue):t.defaultValue,Object.assign({name:e},i,{device:this}))}if(h.has(e))return new r.A((0,a.A)(()=>y.has(e.toLowerCase())),Object.assign({name:e},i,{device:this}));if("wheel"===e)return new s.A(()=>(g&&performance.now()-g.timeStamp>t&&(g=null),g?[g.deltaX,g.deltaY]:s.A.defaultValue),Object.assign({name:e},i,{device:this}));throw Error("Control not found")},this.destroy=()=>{E()},Object.defineProperties(this,{pointerType:{get:()=>m&&m.pointerType||""},connected:{enumerable:!1,configurable:!1,writable:!1,value:!0},timestamp:{get:()=>m&&m.timeStamp||0},enabled:{get:()=>f,set(e){!!e!=!!f&&(e?S():E())}}}),f&&S()}}},76692(e,t,i){var r=i(72450),n=i(9059);r.A,n.pF},60393(e,t,i){i(93039),i(26934),i(60688),i(82090),i(54451),i(36960),i(72450),i(91806)},11787(e,t,i){i.d(t,{A:()=>s});var r=i(16891);let n={disabled:{started:["cancel","disable"],"*":["disable"]},ready:{started:["cancel","ready"],"*":["ready"]},started:{disabled:["enable","start"],"*":["start"]},complete:{disabled:["enable","start","complete"],started:["complete"],"*":["start","complete"]}};class s extends r.A{constructor(e){if(!e)throw Error("Interaction requires an Action");super();let t=!1,i=!0,r="ready",s=0;const a=e=>{if(r===e)return;let t=n[e],i=t[r]||t["*"];r=e,i.forEach(e=>this.emit(e))},o=()=>{(s=i?this.evaluate():0)<=0?a("ready"):s>=1?a("complete"):a("started")};e.on("change",o),e.on("enable",o),e.on("disable",o),this.update=o;const l=this.destroy;this.destroy=()=>{t=!0,i=!1,l()},this.destroy=()=>{e.off("change",o),e.off("enable",o),e.off("disable",o),l()},Object.defineProperties(this,{enabled:{set(e){(e=!!e)===i||t||((i=e)?a("ready"):a("disabled"))},get:()=>i},action:{get:()=>e},state:{get:()=>r}})}evaluate(){var e;return+(((null==(e=this.action.activeControl)?void 0:e.magnitude())||0)>0)}}},4762(e,t,i){i.d(t,{A:()=>n});var r=i(11787);class n extends r.A{constructor(e,t){super(e),this.pressPoint=.5,t>=0&&(this.pressPoint=t)}evaluate(){var e;return+(((null==(e=this.action.activeControl)?void 0:e.magnitude())||0)>=this.pressPoint)}}},57324(e,t,i){i.d(t,{A:()=>n});var r=i(11787);class n extends r.A{constructor(e,t){super(e),this.pressPoint=.5,"number"==typeof t&&t>=0&&(this.pressPoint=t);let i=!1,r=0;this.evaluate=()=>{var e;clearTimeout(r);let t=i;return(i=((null==(e=this.action.activeControl)?void 0:e.magnitude())||0)>=this.pressPoint)?.5:t?(r=setTimeout(this.update,0),1):0}}}},16891(e,t,i){i.d(t,{A:()=>r});class r{constructor(){const{all:e,on:t,off:i,emit:r}=function(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(e){e(i)}),(r=e.get("*"))&&r.slice().map(function(e){e(t,i)})}}}();this.on=t,this.off=i,this.emit=r,this.destroy=()=>e.clear()}}},28346(e,t,i){i.d(t,{A:()=>r});let r=e=>()=>+!!e()},59530(e,t,i){i.d(t,{A:()=>n});let r=(e,t)=>t(e);function n(e,t){return e.reduce(r,t)}},88314(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeNoise2D=void 0;var i=(3-Math.sqrt(3))/6,r=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[1,0],[-1,0],[0,1],[0,-1],[0,1],[0,-1]];t.makeNoise2D=function(e){void 0===e&&(e=Math.random);for(var t,n,s=new Uint8Array(256),a=0;a<256;a++)s[a]=a;for(var a=255;a>0;a--)t=Math.floor((a+1)*e()),n=s[a],s[a]=s[t],s[t]=n;for(var o=new Uint8Array(512),l=new Uint8Array(512),a=0;a<512;a++)o[a]=s[255&a],l[a]=o[a]%12;return function(e,t){var n=(e+t)*.5*(Math.sqrt(3)-1),s=Math.floor(e+n),a=Math.floor(t+n),u=(s+a)*i,h=e-(s-u),c=t-(a-u),d=+(h>c),p=h>c?0:1,f=h-d+i,_=c-p+i,m=h-1+2*i,g=c-1+2*i,b=255&s,y=255&a,x=r[l[b+o[y]]],T=r[l[b+d+o[y+p]]],v=r[l[b+1+o[y+1]]],A=.5-h*h-c*c,S=A<0?0:Math.pow(A,4)*(x[0]*h+x[1]*c),E=.5-f*f-_*_,I=E<0?0:Math.pow(E,4)*(T[0]*f+T[1]*_),R=.5-m*m-g*g;return 70.14805770653952*(S+I+(R<0?0:Math.pow(R,4)*(v[0]*m+v[1]*g)))}}},66039(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeNoise3D=void 0;var i=1/6,r=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,-1],[0,1,-1],[0,-1,-1]];t.makeNoise3D=function(e){void 0===e&&(e=Math.random);for(var t,n,s=new Uint8Array(256),a=0;a<256;a++)s[a]=a;for(var a=255;a>0;a--)t=Math.floor((a+1)*e()),n=s[a],s[a]=s[t],s[t]=n;for(var o=new Uint8Array(512),l=new Uint8Array(512),a=0;a<512;a++)o[a]=s[255&a],l[a]=o[a]%12;return function(e,t,n){var s,a,u,h,c,d,p=(e+t+n)/3,f=Math.floor(e+p),_=Math.floor(t+p),m=Math.floor(n+p),g=(f+_+m)*i,b=e-(f-g),y=t-(_-g),x=n-(m-g);b>=y?y>=x?(s=h=c=1,a=u=d=0):b>=x?(s=h=d=1,a=u=c=0):(u=h=d=1,s=a=c=0):y<x?(u=c=d=1,s=a=h=0):b<x?(a=c=d=1,s=u=h=0):(a=h=c=1,s=u=d=0);var T=b-s+i,v=y-a+i,A=x-u+i,S=b-h+2*i,E=y-c+2*i,I=x-d+2*i,R=b-1+3*i,P=y-1+3*i,M=x-1+3*i,C=255&f,O=255&_,w=255&m,D=r[l[C+o[O+o[w]]]],N=r[l[C+s+o[O+a+o[w+u]]]],L=r[l[C+h+o[O+c+o[w+d]]]],F=r[l[C+1+o[O+1+o[w+1]]]],B=.5-b*b-y*y-x*x,k=B<0?0:Math.pow(B,4)*(D[0]*b+D[1]*y+D[2]*x),U=.5-T*T-v*v-A*A,V=U<0?0:Math.pow(U,4)*(N[0]*T+N[1]*v+N[2]*A),G=.5-S*S-E*E-I*I,z=G<0?0:Math.pow(G,4)*(L[0]*S+L[1]*E+L[2]*I),$=.5-R*R-P*P-M*M;return 94.68493150681972*(k+V+z+($<0?0:Math.pow($,4)*(F[0]*R+F[1]*P+F[2]*M)))}}},48236(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeNoise4D=void 0;var i=(5-Math.sqrt(5))/20,r=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]];t.makeNoise4D=function(e){void 0===e&&(e=Math.random);for(var t,n,s=new Uint8Array(256),a=0;a<256;a++)s[a]=a;for(var a=255;a>0;a--)t=Math.floor((a+1)*e()),n=s[a],s[a]=s[t],s[t]=n;for(var o=new Uint8Array(512),l=new Uint8Array(512),a=0;a<512;a++)o[a]=s[255&a],l[a]=o[a]%12;return function(e,t,n,s){var a=(e+t+n+s)*(Math.sqrt(5)-1)/4,l=Math.floor(e+a),u=Math.floor(t+a),h=Math.floor(n+a),c=Math.floor(s+a),d=(l+u+h+c)*i,p=e-(l-d),f=t-(u-d),_=n-(h-d),m=s-(c-d),g=0,b=0,y=0,x=0;p>f?g++:b++,p>_?g++:y++,p>m?g++:x++,f>_?b++:y++,f>m?b++:x++,_>m?y++:x++;var T=+(g>=3),v=+(b>=3),A=+(y>=3),S=+(x>=3),E=+(g>=2),I=+(b>=2),R=+(y>=2),P=+(x>=2),M=+(g>=1),C=+(b>=1),O=+(y>=1),w=+(x>=1),D=p-T+i,N=f-v+i,L=_-A+i,F=m-S+i,B=p-E+2*i,k=f-I+2*i,U=_-R+2*i,V=m-P+2*i,G=p-M+3*i,z=f-C+3*i,$=_-O+3*i,H=m-w+3*i,W=p-1+4*i,q=f-1+4*i,j=_-1+4*i,X=m-1+4*i,Z=255&l,Y=255&u,K=255&h,Q=255&c,J=r[o[Z+o[Y+o[K+o[Q]]]]%32],ee=r[o[Z+T+o[Y+v+o[K+A+o[Q+S]]]]%32],et=r[o[Z+E+o[Y+I+o[K+R+o[Q+P]]]]%32],ei=r[o[Z+M+o[Y+C+o[K+O+o[Q+w]]]]%32],er=r[o[Z+1+o[Y+1+o[K+1+o[Q+1]]]]%32],en=.5-p*p-f*f-_*_-m*m,es=en<0?0:Math.pow(en,4)*(J[0]*p+J[1]*f+J[2]*_+J[3]*m),ea=.5-D*D-N*N-L*L-F*F,eo=ea<0?0:Math.pow(ea,4)*(ee[0]*D+ee[1]*N+ee[2]*L+ee[3]*F),el=.5-B*B-k*k-U*U-V*V,eu=el<0?0:Math.pow(el,4)*(et[0]*B+et[1]*k+et[2]*U+et[3]*V),eh=.5-G*G-z*z-$*$-H*H,ec=eh<0?0:Math.pow(eh,4)*(ei[0]*G+ei[1]*z+ei[2]*$+ei[3]*H),ed=.5-W*W-q*q-j*j-X*X;return 72.37855765153665*(es+eo+eu+ec+(ed<0?0:Math.pow(ed,4)*(er[0]*W+er[1]*q+er[2]*j+er[3]*X)))}}},67902(e,t,i){t.makeNoise3D=void 0,i(88314);var r=i(66039);Object.defineProperty(t,"makeNoise3D",{enumerable:!0,get:function(){return r.makeNoise3D}}),i(48236)},2733(e,t){t.seededSquirrelNoise=void 0,t.seededSquirrelNoise=function(e){return function(t){var i,r,n;return i=e,n=0x68e31da4*(r=t)+i,n^=n>>8,n+=0xb5297a4d,n^=n<<8,n*=0x1b56c4e9,(n^=n>>8)/0x7fffffff}}},18544(e,t,i){e.exports=i.p+"a8639ad1a24e52dd.wasm"},4116(e,t,i){i.d(t,{rT:()=>u,BT:()=>h,SM:()=>c});var r=i(60371),n=i(52969),s=i(69043),a=i(25835),o=i(61146),l=i(70134);class u{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(e){if(-1===e){this._weight=-1;return}this._weight=Math.min(Math.max(e,0),1)}get speedRatio(){return this._speedRatio}set speedRatio(e){for(let t=0;t<this._runtimeAnimations.length;t++)this._runtimeAnimations[t]._prepareForSpeedRatioChange(e);this._speedRatio=e,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(e,t,i=0,r=100,s=!1,a=1,o,l,u,h=!1,c=0){this.target=t,this.fromFrame=i,this.toFrame=r,this.loopAnimation=s,this.onAnimationEnd=o,this.onAnimationLoop=u,this.isAdditive=h,this.playOrder=c,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=[],this._paused=!1,this._speedRatio=1,this._weight=-1,this._previousWeight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new n.cP,this.onAnimationLoopObservable=new n.cP,this._scene=e,l&&this.appendAnimations(t,l),this._speedRatio=a,e._activeAnimatables.push(this)}syncWith(e){if(this._syncRoot=e,e){let e=this._scene._activeAnimatables.indexOf(this);e>-1&&(this._scene._activeAnimatables.splice(e,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(e,t){for(let i=0;i<t.length;i++){let r=t[i],n=new s.x(e,r,this._scene,this);n._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(n)}}getAnimationByTargetProperty(e){let t=this._runtimeAnimations;for(let i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i].animation;return null}getRuntimeAnimationByTargetProperty(e){let t=this._runtimeAnimations;for(let i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i];return null}reset(){let e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(e){let t=this._runtimeAnimations;for(let i=0;i<t.length;i++)t[i].animation.enableBlending=!0,t[i].animation.blendingSpeed=e}disableBlending(){let e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].animation.enableBlending=!1}goToFrame(e,t=!1){let i=this._runtimeAnimations;if(i[0]){let t=i[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??i[0].currentFrame;let r=0===this.speedRatio?0:(e-this._frameToSyncFromJump)/t*1e3/this.speedRatio;this._manualJumpDelay=-r}for(let r=0;r<i.length;r++)i[r].goToFrame(e,t?this._weight:-1);this._goToFrame=e}get paused(){return this._paused}pause(){this._paused||(this._paused=!0)}restart(){this._paused=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(e,t,i=!1,r=!1){if(e||t){let n=this._scene._activeAnimatables.indexOf(this);if(n>-1){let s=this._runtimeAnimations;for(let i=s.length-1;i>=0;i--){let r=s[i];(!e||r.animation.name==e)&&(!t||t(r.target))&&(r.dispose(),s.splice(i,1))}0==s.length&&(i||this._scene._activeAnimatables.splice(n,1),r||this._raiseOnAnimationEnd())}}else{let e=this._scene._activeAnimatables.indexOf(this);if(e>-1){i||this._scene._activeAnimatables.splice(e,1);let t=this._runtimeAnimations;for(let e=0;e<t.length;e++)t[e].dispose();this._runtimeAnimations.length=0,r||this._raiseOnAnimationEnd()}}}async waitAsync(){return await new Promise(e=>{this.onAnimationEndObservable.add(()=>{e(this)},void 0,void 0,this,!0)})}_animate(e){let t;if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;if(null===this._localDelayOffset?(this._localDelayOffset=e,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this.speedRatio<0?-this._manualJumpDelay:this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,!u.ProcessPausedAnimatables&&0===this._weight&&0===this._previousWeight)return!0;this._previousWeight=this._weight;let i=!1,r=this._runtimeAnimations;for(t=0;t<r.length;t++){let n=r[t].animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);i=i||n}if(this.animationStarted=i,!i){if(this.disposeOnEnd)for(t=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(t,1),t=0;t<r.length;t++)r[t].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return i}}function h(e,t,i){let r=t.target;e._registeredForLateAnimationBindings.pushNoDuplicate(r),r._lateAnimationHolders||(r._lateAnimationHolders={}),r._lateAnimationHolders[t.targetPath]||(r._lateAnimationHolders[t.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:i}),t.isAdditive?(r._lateAnimationHolders[t.targetPath].additiveAnimations.push(t),r._lateAnimationHolders[t.targetPath].totalAdditiveWeight+=t.weight):(r._lateAnimationHolders[t.targetPath].animations.push(t),r._lateAnimationHolders[t.targetPath].totalWeight+=t.weight)}function c(e,t){t&&(t.prototype.copyAnimationRange=function(e,t,i,r=!1,n=null){let s,o,l;0===this.animations.length&&(this.animations.push(new a.X5(this.name,"_matrix",e.animations[0].framePerSecond,a.X5.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));let u=e.animations[0].getRange(t);if(!u)return!1;let h=u.from,c=u.to,d=e.animations[0].getKeys(),p=e.length,f=e.getParent(),_=this.getParent(),m=r&&f&&p&&this.length&&p!==this.length,g=m&&_&&f?_.length/f.length:1,b=r&&!_&&n&&(1!==n.x||1!==n.y||1!==n.z),y=this.animations[0].getKeys();for(let e=0,t=d.length;e<t;e++)(s=d[e]).frame>=h&&s.frame<=c&&(r?(l=s.value.clone(),m?(o=l.getTranslation(),l.setTranslation(o.scaleInPlace(g))):b&&n?(o=l.getTranslation(),l.setTranslation(o.multiplyInPlace(n))):l=s.value):l=s.value,y.push({frame:s.frame+i,value:l}));return this.animations[0].createRange(t,h+i,c+i),!0}),e&&(e.prototype._animate=function(e){if(!this.animationsEnabled)return;let t=o.j.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=t}this.deltaTime=void 0!==e?e:this.useConstantAnimationDeltaTime?16:(t-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=t;let i=this._activeAnimatables;if(0===i.length)return;this._animationTime+=this.deltaTime;let r=this._animationTime;for(let e=0;e<i.length;e++){let t=i[e];!t._animate(r)&&t.disposeOnEnd&&e--}!function(e){if(e._registeredForLateAnimationBindings.length){for(let t=0;t<e._registeredForLateAnimationBindings.length;t++){let i=e._registeredForLateAnimationBindings.data[t];for(let e in i._lateAnimationHolders){let t=i._lateAnimationHolders[e],r=t.animations[0],n=t.originalValue;if(null==n)continue;let s=a.X5.AllowMatrixDecomposeForInterpolation&&n.m,o=i[e];if(s)o=function(e){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return e.originalValue;let t=1,i=l.AA.Vector3["0"],r=l.AA.Vector3["1"],n=l.AA.Quaternion["0"],s=0,a=e.animations[0],o=e.originalValue,u=1,h=!1;if(e.totalWeight<1)u=1-e.totalWeight,o.decompose(r,n,i);else{if(s=1,t=e.totalWeight,1==(u=a.weight/t))if(!e.totalAdditiveWeight)return a.currentValue;else h=!0;a.currentValue.decompose(r,n,i)}if(!h){r.scaleInPlace(u),i.scaleInPlace(u),n.scaleInPlace(u);for(let a=s;a<e.animations.length;a++){let s=e.animations[a];if(0===s.weight)continue;u=s.weight/t;let o=l.AA.Vector3["2"],h=l.AA.Vector3["3"],c=l.AA.Quaternion["1"];s.currentValue.decompose(h,c,o),h.scaleAndAddToRef(u,r),c.scaleAndAddToRef(l.PT.Dot(n,c)>0?u:-u,n),o.scaleAndAddToRef(u,i)}n.normalize()}for(let t=0;t<e.additiveAnimations.length;t++){let s=e.additiveAnimations[t];if(0===s.weight)continue;let a=l.AA.Vector3["2"],o=l.AA.Vector3["3"],u=l.AA.Quaternion["1"];s.currentValue.decompose(o,u,a),o.multiplyToRef(r,o),l.Pq.LerpToRef(r,o,s.weight,r),n.multiplyToRef(u,u),l.PT.SlerpToRef(n,u,s.weight,n),a.scaleAndAddToRef(s.weight,i)}let c=a?a._animationState.workValue:l.AA.Matrix["0"].clone();return l.uq.ComposeToRef(r,n,i,c),c}(t);else if(void 0!==n.w)o=function(e,t){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return t;let i=e.animations[0],r=e.originalValue,n=t;if(0===e.totalWeight&&e.totalAdditiveWeight>0)n.copyFrom(r);else if(1===e.animations.length){if(l.PT.SlerpToRef(r,i.currentValue,Math.min(1,e.totalWeight),n),0===e.totalAdditiveWeight)return n}else if(e.animations.length>1){let i,s,a=1;if(e.totalWeight<1){let t=1-e.totalWeight;s=[],(i=[]).push(r),s.push(t)}else{if(2===e.animations.length&&(l.PT.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,t),0===e.totalAdditiveWeight))return t;i=[],s=[],a=e.totalWeight}for(let t=0;t<e.animations.length;t++){let r=e.animations[t];i.push(r.currentValue),s.push(r.weight/a)}let o=0;for(let e=0;e<i.length;){if(!e){l.PT.SlerpToRef(i[e],i[e+1],s[e+1]/(s[e]+s[e+1]),t),n=t,o=s[e]+s[e+1],e+=2;continue}o+=s[e],l.PT.SlerpToRef(n,i[e],s[e]/o,n),e++}}for(let t=0;t<e.additiveAnimations.length;t++){let i=e.additiveAnimations[t];0!==i.weight&&(n.multiplyToRef(i.currentValue,l.AA.Quaternion["0"]),l.PT.SlerpToRef(n,l.AA.Quaternion["0"],i.weight,n))}return n}(t,o||l.PT.Identity());else{let e=0,i=1,s=r&&r._animationState.loopMode===a.X5.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(t.totalWeight<1)o=s?n.clone?n.clone():n:r&&n.scale?n.scale(1-t.totalWeight):r?n*(1-t.totalWeight):n.clone?n.clone():n;else if(r){i=t.totalWeight;let a=r.weight/i;o=1!==a?r.currentValue.scale?r.currentValue.scale(a):r.currentValue*a:r.currentValue,s&&(o.addToRef?o.addToRef(n,o):o+=n),e=1}for(let r=e;r<t.animations.length;r++){let e=t.animations[r],n=e.weight/i;n&&(e.currentValue.scaleAndAddToRef?e.currentValue.scaleAndAddToRef(n,o):o+=e.currentValue*n)}for(let e=0;e<t.additiveAnimations.length;e++){let i=t.additiveAnimations[e],r=i.weight;r&&(i.currentValue.scaleAndAddToRef?i.currentValue.scaleAndAddToRef(r,o):o+=i.currentValue*r)}}i[e]=o}i._lateAnimationHolders={}}e._registeredForLateAnimationBindings.reset()}}(this)},e.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort((e,t)=>e.playOrder-t.playOrder)},e.prototype.beginWeightedAnimation=function(e,t,i,r=1,n,s=1,a,o,l,u,h=!1){let c=this.beginAnimation(e,t,i,n,s,a,o,!1,l,u,h);return c.weight=r,c},e.prototype.beginAnimation=function(e,t,i,r,n=1,s,a,o=!0,l,h,c=!1){if(n<0){let e=t;t=i,i=e,n=-n}t>i&&(n=-n),o&&this.stopAnimation(e,void 0,l),a||(a=new u(this,e,t,i,r,n,s,void 0,h,c));let d=!l||l(e);if(e.animations&&d&&a.appendAnimations(e,e.animations),e.getAnimatables){let u=e.getAnimatables();for(let e=0;e<u.length;e++)this.beginAnimation(u[e],t,i,r,n,s,a,o,l,h)}return a.reset(),a},e.prototype.beginHierarchyAnimation=function(e,t,i,r,n,s=1,a,o,l=!0,u,h,c=!1){let d=e.getDescendants(t),p=[];for(let t of(p.push(this.beginAnimation(e,i,r,n,s,a,o,l,u,void 0,c)),d))p.push(this.beginAnimation(t,i,r,n,s,a,o,l,u,void 0,c));return p},e.prototype.beginDirectAnimation=function(e,t,i,r,n,s=1,a,o,l=!1){if(s<0){let e=i;i=r,r=e,s=-s}return i>r&&(s=-s),new u(this,e,i,r,n,s,a,t,o,l)},e.prototype.beginDirectHierarchyAnimation=function(e,t,i,r,n,s,a,o,l,u=!1){let h=e.getDescendants(t),c=[];for(let t of(c.push(this.beginDirectAnimation(e,i,r,n,s,a,o,l,u)),h))c.push(this.beginDirectAnimation(t,i,r,n,s,a,o,l,u));return c},e.prototype.getAnimatableByTarget=function(e){for(let t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},e.prototype.getAllAnimatablesByTarget=function(e){let t=[];for(let i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].target===e&&t.push(this._activeAnimatables[i]);return t},e.prototype.stopAnimation=function(e,t,i){for(let r of this.getAllAnimatablesByTarget(e))r.stop(t,i)},e.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(let e of this.animationGroups)e.stop()})}u.ProcessPausedAnimatables=!1,c(i(9633).Z,r.$)},91924(e,t,i){i.d(t,{L:()=>a});var r=i(23295),n=i(87201),s=i(52969);n.$.AudioEngineFactory=(e,t,i)=>new a(e,t,i);class a{get masterGain(){return this._masterGain}set masterGain(e){this._masterGain=this._v2.mainOut._inNode=e}get useCustomUnlockedButton(){return this._useCustomUnlockedButton}set useCustomUnlockedButton(e){this._useCustomUnlockedButton=e,this._v2._unmuteUIEnabled=!e}get audioContext(){return"running"===this._v2.state&&this._triggerRunningStateAsync(),this._v2._audioContext}constructor(e=null,t=null,i=null){this._tryToRun=!1,this._useCustomUnlockedButton=!1,this.canUseWebAudio=!0,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.onAudioUnlockedObservable=new s.cP,this.onAudioLockedObservable=new s.cP;const n=new r.Q({audioContext:t||void 0,defaultUIParentElement:e?.parentElement?e.parentElement:void 0});n._unmuteUIEnabled=!1,this._masterGain=new GainNode(n._audioContext),n._audioDestination=i,n.stateChangedObservable.add(e=>{"running"===e?(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)):(this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this))}),n._initAsync({resumeOnInteraction:!1}).then(()=>{let e=n.defaultMainBus._outNode;e&&(e.disconnect(n.mainOut._inNode),e.connect(this._masterGain)),n.mainOut._inNode=this._masterGain,n.stateChangedObservable.notifyObservers(n.state)}),this.isMP3supported=n.isFormatValid("mp3"),this.isOGGsupported=n.isFormatValid("ogg"),this._v2=n}lock(){this._v2._audioContext.suspend(),this._useCustomUnlockedButton||(this._v2._unmuteUIEnabled=!0)}unlock(){if(this._v2._audioContext?.state==="running"){this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this));return}this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){this._v2._audioContext?.addEventListener("statechange",()=>{this.unlocked&&this._v2._audioContext?.state!=="running"&&this._resumeAudioContextAsync()},{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){return this._v2._isUsingOfflineAudioContext?Promise.resolve():("suspended"!==this._v2._audioContext.state||this._useCustomUnlockedButton||(this._v2._unmuteUIEnabled=!0),this._v2._audioContext.resume())}dispose(){this._v2.dispose(),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.masterGain.gain.value}setGlobalVolume(e){this.masterGain.gain.value=e}connectToAnalyser(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._v2._audioContext.destination)}async _triggerRunningStateAsync(){this._tryToRun?this._v2._audioContext.resume():(this._tryToRun=!0,await this._resumeAudioContextAsync(),this._tryToRun=!1,this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))}}},62861(e,t,i){i.d(t,{Y:()=>c});var r=i(68667),n=i(16),s=i(70134),a=i(75318),o=i(9633);i(91924);var l=i(61146),u=i(94470),h=i(87201);(0,i(30403).ji)(a.v.NAME_AUDIO,(e,t,i,n)=>{let s,a=[];if(i.sounds=i.sounds||[],void 0!==e.sounds&&null!==e.sounds)for(let o=0,l=e.sounds.length;o<l;o++){let l=e.sounds[o];h.$.audioEngine?.canUseWebAudio?(l.url||(l.url=l.name),a[l.url]?i.sounds.push(r.A.Parse(l,t,n,a[l.url])):(s=r.A.Parse(l,t,n),a[l.url]=s,i.sounds.push(s))):i.sounds.push(new r.A(l.name,null,t))}a=[]}),Object.defineProperty(o.Z.prototype,"mainSoundTrack",{get:function(){let e=this._getComponent(a.v.NAME_AUDIO);return e||(e=new c(this),this._addComponent(e)),this._mainSoundTrack||(this._mainSoundTrack=new n.j(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),o.Z.prototype.getSoundByName=function(e){let t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===e)return this.mainSoundTrack.soundCollection[t];if(this.soundTracks){for(let i=0;i<this.soundTracks.length;i++)for(t=0;t<this.soundTracks[i].soundCollection.length;t++)if(this.soundTracks[i].soundCollection[t].name===e)return this.soundTracks[i].soundCollection[t]}return null},Object.defineProperty(o.Z.prototype,"audioEnabled",{get:function(){let e=this._getComponent(a.v.NAME_AUDIO);return e||(e=new c(this),this._addComponent(e)),e.audioEnabled},set:function(e){let t=this._getComponent(a.v.NAME_AUDIO);t||(t=new c(this),this._addComponent(t)),e?t.enableAudio():t.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(o.Z.prototype,"headphone",{get:function(){let e=this._getComponent(a.v.NAME_AUDIO);return e||(e=new c(this),this._addComponent(e)),e.headphone},set:function(e){let t=this._getComponent(a.v.NAME_AUDIO);t||(t=new c(this),this._addComponent(t)),e?t.switchAudioModeForHeadphones():t.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(o.Z.prototype,"audioListenerPositionProvider",{get:function(){let e=this._getComponent(a.v.NAME_AUDIO);return e||(e=new c(this),this._addComponent(e)),e.audioListenerPositionProvider},set:function(e){let t=this._getComponent(a.v.NAME_AUDIO);if(t||(t=new c(this),this._addComponent(t)),e&&"function"!=typeof e)throw Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");t.audioListenerPositionProvider=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.Z.prototype,"audioListenerRotationProvider",{get:function(){let e=this._getComponent(a.v.NAME_AUDIO);return e||(e=new c(this),this._addComponent(e)),e.audioListenerRotationProvider},set:function(e){let t=this._getComponent(a.v.NAME_AUDIO);if(t||(t=new c(this),this._addComponent(t)),e&&"function"!=typeof e)throw Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");t.audioListenerRotationProvider=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.Z.prototype,"audioPositioningRefreshRate",{get:function(){let e=this._getComponent(a.v.NAME_AUDIO);return e||(e=new c(this),this._addComponent(e)),e.audioPositioningRefreshRate},set:function(e){let t=this._getComponent(a.v.NAME_AUDIO);t||(t=new c(this),this._addComponent(t)),t.audioPositioningRefreshRate=e},enumerable:!0,configurable:!0});class c{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(e){if(this.name=a.v.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new s.Pq,this._cachedCameraPosition=new s.Pq,this._lastCheck=0,this._invertMatrixTemp=new s.uq,this._cameraDirectionTemp=new s.Pq,!(e=e||u.q.LastCreatedScene))return;this.scene=e,e.soundTracks=[],e.sounds=[]}register(){this.scene._afterRenderStage.registerStep(a.v.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(e){if(e.sounds=[],this.scene.soundTracks)for(let t=0;t<this.scene.soundTracks.length;t++){let i=this.scene.soundTracks[t];for(let t=0;t<i.soundCollection.length;t++)e.sounds.push(i.soundCollection[t].serialize())}}addFromContainer(e){if(e.sounds)for(let t of e.sounds)t.play(),t.autoplay=!0,this.scene.mainSoundTrack.addSound(t)}removeFromContainer(e,t=!1){if(e.sounds)for(let i of e.sounds)i.stop(),i.autoplay=!1,this.scene.mainSoundTrack.removeSound(i),t&&i.dispose()}dispose(){let e=this.scene;if(e._mainSoundTrack&&e.mainSoundTrack.dispose(),e.soundTracks)for(let t=0;t<e.soundTracks.length;t++)e.soundTracks[t].dispose()}disableAudio(){let e,t=this.scene;for(this._audioEnabled=!1,h.$.audioEngine&&h.$.audioEngine.audioContext&&h.$.audioEngine.audioContext.suspend(),e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[e].pause();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(let i=0;i<t.soundTracks[e].soundCollection.length;i++)t.soundTracks[e].soundCollection[i].pause()}enableAudio(){let e,t=this.scene;for(this._audioEnabled=!0,h.$.audioEngine&&h.$.audioEngine.audioContext&&h.$.audioEngine.audioContext.resume(),e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[e].isPaused&&t.mainSoundTrack.soundCollection[e].play();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(let i=0;i<t.soundTracks[e].soundCollection.length;i++)t.soundTracks[e].soundCollection[i].isPaused&&t.soundTracks[e].soundCollection[i].play()}switchAudioModeForHeadphones(){let e=this.scene;if(this._headphone=!0,e.mainSoundTrack.switchPanningModelToHRTF(),e.soundTracks)for(let t=0;t<e.soundTracks.length;t++)e.soundTracks[t].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){let e=this.scene;if(this._headphone=!1,e.mainSoundTrack.switchPanningModelToEqualPower(),e.soundTracks)for(let t=0;t<e.soundTracks.length;t++)e.soundTracks[t].switchPanningModelToEqualPower()}_afterRender(){let e=l.j.Now;if(this._lastCheck&&e-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=e;let t=this.scene;if(!this._audioEnabled||!t._mainSoundTrack||!t.soundTracks||0===t._mainSoundTrack.soundCollection.length&&1===t.soundTracks.length)return;let i=h.$.audioEngine;if(i&&i.audioContext){let e,r=t.activeCamera;if(t.activeCameras&&t.activeCameras.length>0&&(r=t.activeCameras[0]),this.audioListenerPositionProvider){let e=this.audioListenerPositionProvider();i.audioContext.listener.setPosition(e.x||0,e.y||0,e.z||0)}else r?this._cachedCameraPosition.equals(r.globalPosition)||(this._cachedCameraPosition.copyFrom(r.globalPosition),i.audioContext.listener.setPosition(r.globalPosition.x,r.globalPosition.y,r.globalPosition.z)):i.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){let e=this.audioListenerRotationProvider();i.audioContext.listener.setOrientation(e.x||0,e.y||0,e.z||0,0,1,0)}else r?(r.rigCameras&&r.rigCameras.length>0&&(r=r.rigCameras[0]),r.getViewMatrix().invertToRef(this._invertMatrixTemp),s.Pq.TransformNormalToRef(c._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.copyFrom(this._cameraDirectionTemp),i.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):i.audioContext.listener.setOrientation(0,0,0,0,1,0);for(e=0;e<t.mainSoundTrack.soundCollection.length;e++){let i=t.mainSoundTrack.soundCollection[e];i.useCustomAttenuation&&i.updateDistanceFromListener()}if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(let i=0;i<t.soundTracks[e].soundCollection.length;i++){let r=t.soundTracks[e].soundCollection[i];r.useCustomAttenuation&&r.updateDistanceFromListener()}}}}c._CameraDirection=new s.Pq(0,0,-1),r.A._SceneComponentInitialization=e=>{let t=e._getComponent(a.v.NAME_AUDIO);t||(t=new c(e),e._addComponent(t))}},13805(e,t,i){i.d(t,{g:()=>s});var r=i(52969),n=i(55971);class s extends n.f0{constructor(e){super(e.engine,2),this._state=1,this.onEndedObservable=new r.cP,this.onErrorObservable=new r.cP,this.onStateChangedObservable=new r.cP,this._sound=e}get state(){return this._state}dispose(){super.dispose(),this.stop(),this.onEndedObservable.clear(),this.onStateChangedObservable.clear()}_setState(e){this._state!==e&&(this._state=e,this.onStateChangedObservable.notifyObservers(this),1===this._state&&this.onEndedObservable.notifyObservers(this))}}},19847(e,t,i){i.d(t,{L:()=>n});var r=i(48879);class n extends r.t{constructor(e,t,i,r=2){super(e,t,r),this._spatialAutoUpdate=!0,this._spatialMinUpdateTime=0,this._outBus=null,this._spatial=null,this._onOutBusDisposed=null,"boolean"==typeof i.spatialAutoUpdate&&(this._spatialAutoUpdate=i.spatialAutoUpdate),"number"==typeof i.spatialMinUpdateTime&&(this._spatialMinUpdateTime=i.spatialMinUpdateTime)}get outBus(){return this._outBus}set outBus(e){if(this._outBus!==e){if(this._outBus&&(this._onOutBusDisposed&&(this._outBus.onDisposeObservable.removeCallback(this._onOutBusDisposed),this._onOutBusDisposed=null),!this._disconnect(this._outBus)))throw Error("Disconnect failed");if(this._outBus=e,this._outBus&&(this._onOutBusDisposed=()=>{this._outBus=null},this._outBus.onDisposeObservable.add(this._onOutBusDisposed),!this._connect(this._outBus)))throw Error("Connect failed")}}get spatial(){return this._spatial?this._spatial:this._initSpatialProperty()}dispose(){super.dispose(),this._spatial?.dispose(),this._spatial=null,this._outBus&&this._onOutBusDisposed&&(this._outBus.onDisposeObservable.removeCallback(this._onOutBusDisposed),this._onOutBusDisposed=null),this._outBus=null}_initSpatialProperty(){return this._spatial=this._createSpatialProperty(this._spatialAutoUpdate,this._spatialMinUpdateTime)}get _isSpatial(){return null!==this._spatial}set _isSpatial(e){e&&!this._spatial?this._initSpatialProperty():!e&&this._spatial&&(this._spatial.dispose(),this._spatial=null)}}},74083(e,t,i){i.d(t,{l:()=>n});var r=i(70134);class n{constructor(e){this._attachmentType=3,this._position=new r.Pq,this._rotationQuaternion=new r.PT,this._sceneNode=null,this._useBoundingBox=!1,this.dispose=()=>{this.detach()},this._spatialAudioNode=e}get isAttached(){return null!==this._sceneNode}attach(e,t,i){this._sceneNode===e||(this.detach(),e&&(this._attachmentType=i,this._sceneNode=e,this._sceneNode.onDisposeObservable.add(this.dispose),this._useBoundingBox=t))}detach(){this._sceneNode?.onDisposeObservable.removeCallback(this.dispose),this._sceneNode=null}update(){1&this._attachmentType&&(this._useBoundingBox&&this._sceneNode.getBoundingInfo?this._position.copyFrom(this._sceneNode.getBoundingInfo().boundingBox.centerWorld):this._sceneNode?.getWorldMatrix().getTranslationToRef(this._position),this._spatialAudioNode.position.copyFrom(this._position),this._spatialAudioNode._updatePosition()),2&this._attachmentType&&(this._sceneNode?.getWorldMatrix().decompose(void 0,this._rotationQuaternion),this._spatialAudioNode.rotationQuaternion.copyFrom(this._rotationQuaternion),this._spatialAudioNode._updateRotation())}}},38781(e,t,i){i.d(t,{I:()=>n});var r=i(13805);class n extends r.g{}},62051(e,t,i){i.d(t,{K:()=>s});var r=i(52969),n=i(13805);class s extends n.g{constructor(e){super(e),this.onReadyObservable=new r.cP,this.preloadedPromise=new Promise((e,t)=>{this._rejectPreloadedProimse=t,this._resolvePreloadedPromise=e}),this.onErrorObservable.add(this._rejectPreloadedProimse),this.onReadyObservable.add(this._resolvePreloadedPromise)}set startOffset(e){this._options.startOffset=e}dispose(){super.dispose(),this.onErrorObservable.clear(),this.onReadyObservable.clear(),this._resolvePreloadedPromise()}}},85993(e,t,i){i.d(t,{e:()=>n});var r=i(55971);class n extends r.Ui{constructor(e,t){super(e,t,3)}connect(e){if(!this._connect(e))throw Error("Connect failed")}disconnect(e){if(!this._disconnect(e))throw Error("Disconnect failed")}disconnectAll(){if(!this._downstreamNodes)throw Error("Disconnect failed");let e=this._downstreamNodes.values();for(let t=e.next();!t.done;t=e.next())if(!this._disconnect(t.value))throw Error("Disconnect failed")}}},15129(e,t,i){i.d(t,{CA:()=>a,Z7:()=>o,i_:()=>s});var r=i(23613),n=i(85993);class s extends n.e{constructor(e){super("Analyzer",e)}setOptions(e){this.fftSize=e.analyzerFFTSize??r.IR.fftSize,this.minDecibels=e.analyzerMinDecibels??r.IR.minDecibels,this.maxDecibels=e.analyzerMaxDecibels??r.IR.maxDecibels,this.smoothing=e.analyzerSmoothing??r.IR.smoothing}}function a(e){return e.getSubNode("Analyzer")}function o(e,t,i){e.callOnSubNode("Analyzer",e=>{e[t]=i})}},46835(e,t,i){i.d(t,{Au:()=>a,Pt:()=>l,y5:()=>o});var r=i(74083),n=i(79095),s=i(85993);class a extends s.e{constructor(e){super("Spatial",e),this._attacherComponent=null}get isAttached(){return null!==this._attacherComponent&&this._attacherComponent.isAttached}attach(e,t,i){this.detach(),this._attacherComponent||(this._attacherComponent=new r.l(this)),this._attacherComponent.attach(e,t,i)}detach(){this._attacherComponent?.detach()}dispose(){super.dispose(),this._attacherComponent?.dispose(),this._attacherComponent=null}setOptions(e){this.coneInnerAngle=e.spatialConeInnerAngle??n.Qc.coneInnerAngle,this.coneOuterAngle=e.spatialConeOuterAngle??n.Qc.coneOuterAngle,this.coneOuterVolume=e.spatialConeOuterVolume??n.Qc.coneOuterVolume,this.distanceModel=e.spatialDistanceModel??n.Qc.distanceModel,this.maxDistance=e.spatialMaxDistance??n.Qc.maxDistance,this.minDistance=e.spatialMinDistance??n.Qc.minDistance,this.orientation=e.spatialOrientation??n.Qc.orientation,this.panningModel=e.spatialPanningModel??n.Qc.panningModel,this.rolloffFactor=e.spatialRolloffFactor??n.Qc.rolloffFactor,e.spatialPosition&&(this.position=e.spatialPosition.clone()),e.spatialRotationQuaternion?this.rotationQuaternion=e.spatialRotationQuaternion.clone():e.spatialRotation?this.rotation=e.spatialRotation.clone():this.rotationQuaternion=n.Qc.rotationQuaternion.clone(),this.update()}update(){this.isAttached?this._attacherComponent?.update():(this._updatePosition(),this._updateRotation())}}function o(e){return e.getSubNode("Spatial")}function l(e,t,i){e.callOnSubNode("Spatial",e=>{e[t]=i})}},57647(e,t,i){i.d(t,{KJ:()=>a,a7:()=>s,n9:()=>o});var r=i(85993),n=i(37023);class s extends r.e{constructor(e){super("Stereo",e)}setOptions(e){this.pan=e.stereoPan??n.uJ.pan}}function a(e){return e.getSubNode("Stereo")}function o(e,t,i){e.callOnSubNode("Stereo",e=>{e[t]=i})}},2797(e,t,i){i.d(t,{Sy:()=>s,pN:()=>o,sf:()=>a});var r=i(85993);let n={volume:1};class s extends r.e{constructor(e){super("Volume",e)}setOptions(e){this.setVolume(e.volume??n.volume,{shape:"none"})}}function a(e){return e.getSubNode("Volume")}function o(e,t){return a(e)?.[t]??n[t]}},73711(e,t,i){i.d(t,{Hi:()=>u,hU:()=>l,sQ:()=>h});var r=i(31656),n=i(23613),s=i(15129);let a=null,o=null;function l(){return a||(a=new Uint8Array),a}function u(){return o||(o=new Float32Array),o}class h extends n.zx{constructor(e){super(),this._fftSize=n.IR.fftSize,this._maxDecibels=n.IR.maxDecibels,this._minDecibels=n.IR.minDecibels,this._smoothing=n.IR.smoothing,this._subGraph=e}get fftSize(){return this._fftSize}set fftSize(e){this._fftSize=e,(0,s.Z7)(this._subGraph,"fftSize",e)}get isEnabled(){return null!==(0,s.CA)(this._subGraph)}get minDecibels(){return this._minDecibels}set minDecibels(e){this._minDecibels=e,(0,s.Z7)(this._subGraph,"minDecibels",e)}get maxDecibels(){return this._maxDecibels}set maxDecibels(e){this._maxDecibels=e,(0,s.Z7)(this._subGraph,"maxDecibels",e)}get smoothing(){return this._smoothing}set smoothing(e){this._smoothing=e,(0,s.Z7)(this._subGraph,"smoothing",e)}dispose(){let e=(0,s.CA)(this._subGraph);e&&(this._subGraph.removeSubNodeAsync(e),e.dispose())}async enableAsync(){(0,s.CA)(this._subGraph)||await this._subGraph.createAndAddSubNodeAsync("Analyzer")}getByteFrequencyData(){let e=(0,s.CA)(this._subGraph);return e?e.getByteFrequencyData():(r.V.Warn("AudioAnalyzer not enabled"),this.enableAsync(),l())}getFloatFrequencyData(){let e=(0,s.CA)(this._subGraph);return e?e.getFloatFrequencyData():(r.V.Warn("AudioAnalyzer not enabled"),this.enableAsync(),u())}}},57233(e,t,i){i.d(t,{i:()=>s});var r=i(37023),n=i(57647);class s extends r.bO{constructor(e){super(),this._pan=r.uJ.pan,this._subGraph=e}get pan(){return this._pan}set pan(e){this._pan=e,(0,n.n9)(this._subGraph,"pan",e)}}},81989(e,t,i){i.d(t,{Ki:()=>u,mJ:()=>l,qK:()=>r});let r=RegExp("\\.(\\w{3,4})($|\\?)"),n=new Float32Array([0,0]),s=null,a=null,o=null;function l(e,t,i){let r;if(s||(s=new Float32Array(100)),"linear"===e)return n[0]=t,n[1]=i,n;if("exponential"===e)r=function(){if(!a){a=new Float32Array(100);let e=1/99,t=1/99;for(let i=1;i<100;i++)a[i]=Math.exp(-11.512925464970227*(1-t)),t+=e}return a}();else if("logarithmic"===e)r=function(){if(!o){o=new Float32Array(100);let e=.01;for(let t=0;t<100;t++)o[t]=1+Math.log10(e)/Math.log10(100),e+=.01}return o}();else throw Error(`Unknown ramp shape: ${e}`);let l=Math.sign(i-t),u=Math.abs(i-t);if(1===l)for(let e=0;e<r.length;e++)s[e]=t+u*r[e];else{let e=99;for(let i=0;i<r.length;i++,e--)s[i]=t-u*(1-r[e])}return s}function u(e){return e.replace(/#/gm,"%23")}},95498(e,t,i){i.d(t,{w:()=>n});var r=i(61146);class n{constructor(e,t,i){if(this._autoUpdate=!0,this._lastUpdateTime=0,this.minUpdateTime=0,!t)return;this.minUpdateTime=i;const n=()=>{if(!this._autoUpdate)return;let t=!1;if(0<this.minUpdateTime){let e=r.j.Now;this._lastUpdateTime&&e-this._lastUpdateTime<this.minUpdateTime&&(t=!0),this._lastUpdateTime=e}t||e.update(),requestAnimationFrame(n)};requestAnimationFrame(n)}dispose(){this._autoUpdate=!1}}},72394(e,t,i){i.d(t,{k:()=>a});var r=i(31656),n=i(81989);let s=!0;class a{constructor(e,t){this._rampEndTime=0,this._engine=e,this._param=t,this._targetValue=t.value}get isRamping(){return this._engine.currentTime<this._rampEndTime}get targetValue(){return this._targetValue}set targetValue(e){this.setTargetValue(e)}get value(){return this._param.value}dispose(){this._param=null,this._engine=null}setTargetValue(e,t=null){if(!Number.isFinite(e))return void r.V.Warn(`Attempted to set audio parameter to non-finite value: ${e}`);this._param.cancelScheduledValues(0);let i="string"==typeof t?.shape?t.shape:"linear",a=this._engine.currentTime;if("none"===i){this._param.value=this._targetValue=e,this._rampEndTime=a;return}let o="number"==typeof t?.duration?Math.max(t.duration,this._engine.parameterRampDuration):this._engine.parameterRampDuration;if(this._targetValue=e,(o=Math.max(this._engine.parameterRampDuration,o))<1e-6)return void this._param.setValueAtTime(e,a);try{this._param.setValueCurveAtTime((0,n.mJ)(i,Number.isFinite(this._param.value)?this._param.value:0,e),a,o),this._rampEndTime=a+o}catch(e){s&&(r.V.Warn(`Audio parameter ramping failed: ${e.message}`),s=!1)}}}},92383(e,t,i){i.d(t,{H:()=>p});class r{constructor(){this._createSubNodePromises={},this._isDisposed=!1,this._subNodes={},this._onSubNodeDisposed=e=>{delete this._subNodes[e.name],this._onSubNodesChanged()}}callOnSubNode(e,t){let i=this.getSubNode(e);i?t(i):this._createSubNodePromisesResolvedAsync().then(()=>{let i=this.getSubNode(e);i?t(i):this.createAndAddSubNodeAsync(e).then(e=>{t(e)})})}createAndAddSubNodeAsync(e){var t;return(t=this._createSubNodePromises)[e]||(t[e]=this._createSubNode(e).then(e=>(this._addSubNode(e),e))),this._createSubNodePromises[e]}dispose(){for(let e of(this._isDisposed=!0,Object.values(this._subNodes)))e.dispose();this._subNodes={},this._createSubNodePromises={}}getSubNode(e){return this._subNodes[e]??null}async removeSubNodeAsync(e){if(!e)return;await this._createSubNodePromisesResolvedAsync();let t=e.name;this._subNodes[t]&&delete this._subNodes[t],delete this._createSubNodePromises[t],this._onSubNodesChanged()}async _createSubNodePromisesResolvedAsync(){return await Promise.all(Object.values(this._createSubNodePromises))}_addSubNode(e){this._isDisposed?e.dispose():(this._subNodes[e.name]=e,e.onDisposeObservable.addOnce(this._onSubNodeDisposed),this._onSubNodesChanged())}}var n=i(15129),s=i(2797),a=i(23613),o=i(72394);async function l(e){return new u(e)}class u extends s.Sy{constructor(e){super(e);const t=this.node=new GainNode(e._audioContext);this._volume=new o.k(e,t.gain)}dispose(){super.dispose(),this._volume.dispose()}get volume(){return this._volume.value}set volume(e){this.setVolume(e)}get _inNode(){return this.node}get _outNode(){return this.node}setVolume(e,t=null){this._volume.setTargetValue(e,t)}_connect(e){return!!super._connect(e)&&(e._inNode&&this.node.connect(e._inNode),!0)}_disconnect(e){return!!super._disconnect(e)&&(e._inNode&&this.node.disconnect(e._inNode),!0)}getClassName(){return"_VolumeWebAudioSubNode"}}var h=i(73711);async function c(e){return new d(e)}class d extends n.i_{constructor(e){super(e),this._byteFrequencyData=null,this._floatFrequencyData=null,this._analyzerNode=new AnalyserNode(e._audioContext)}get fftSize(){return this._analyzerNode.fftSize}set fftSize(e){e!==this._analyzerNode.fftSize&&(this._analyzerNode.fftSize=e,this._clearArrays())}get _inNode(){return this._analyzerNode}get minDecibels(){return this._analyzerNode.minDecibels}set minDecibels(e){this._analyzerNode.minDecibels=e}get maxDecibels(){return this._analyzerNode.maxDecibels}set maxDecibels(e){this._analyzerNode.maxDecibels=e}get smoothing(){return this._analyzerNode.smoothingTimeConstant}set smoothing(e){this._analyzerNode.smoothingTimeConstant=e}dispose(){super.dispose(),this._clearArrays(),this._byteFrequencyData=null,this._floatFrequencyData=null,this._analyzerNode.disconnect()}getClassName(){return"_WebAudioAnalyzerSubNode"}getByteFrequencyData(){return this._byteFrequencyData&&0!==this._byteFrequencyData.length||(this._byteFrequencyData=new Uint8Array(this._analyzerNode.frequencyBinCount)),this._analyzerNode.getByteFrequencyData(this._byteFrequencyData),this._byteFrequencyData}getFloatFrequencyData(){return this._floatFrequencyData&&0!==this._floatFrequencyData.length||(this._floatFrequencyData=new Float32Array(this._analyzerNode.frequencyBinCount)),this._analyzerNode.getFloatFrequencyData(this._floatFrequencyData),this._floatFrequencyData}_clearArrays(){this._byteFrequencyData?.set((0,h.hU)()),this._floatFrequencyData?.set((0,h.Hi)())}}class p extends r{constructor(e){super(),this._outputNode=null,this._owner=e}async initAsync(e){let t=(0,a.GA)(e);if(t&&await this.createAndAddSubNodeAsync("Analyzer"),await this.createAndAddSubNodeAsync("Volume"),await this._createSubNodePromisesResolvedAsync(),t){let t=(0,n.CA)(this);if(!t)throw Error("No analyzer subnode.");t.setOptions(e)}let i=(0,s.sf)(this);if(!i)throw Error("No volume subnode.");if(i.setOptions(e),"_VolumeWebAudioSubNode"!==i.getClassName())throw Error("Not a WebAudio subnode.");if(this._outputNode=i.node,this._outputNode&&this._downstreamNodes){let e=this._downstreamNodes.values();for(let t=e.next();!t.done;t=e.next()){let e=t.value._inNode;e&&this._outputNode.connect(e)}}}get _inNode(){return this._outputNode}get _outNode(){return this._outputNode}_createSubNode(e){switch(e){case"Analyzer":return c(this._owner.engine);case"Volume":return l(this._owner.engine);default:throw Error(`Unknown subnode name: ${e}`)}}_onSubNodesChanged(){let e=(0,n.CA)(this),t=(0,s.sf)(this);e&&t&&t.connect(e)}}},54412(e,t,i){i.d(t,{Q:()=>y});var r=i(46835),n=i(57647),s=i(2797),a=i(79095),o=i(37023),l=i(70134),u=i(72394);let h=l.uq.Zero(),c=new l.PT;function d(e){return e*Math.PI/180}function p(e){return 180*e/Math.PI}async function f(e){return new _(e)}class _ extends r.Au{constructor(e){super(e),this._lastOrientation=l.Pq.Zero(),this._lastPosition=l.Pq.Zero(),this._lastRotation=l.Pq.Zero(),this._lastRotationQuaternion=new l.PT,this.orientation=a.Qc.orientation.clone(),this.position=a.Qc.position.clone(),this.rotation=a.Qc.rotation.clone(),this.rotationQuaternion=a.Qc.rotationQuaternion.clone(),this.node=new PannerNode(e._audioContext),this._orientationX=new u.k(e,this.node.orientationX),this._orientationY=new u.k(e,this.node.orientationY),this._orientationZ=new u.k(e,this.node.orientationZ),this._positionX=new u.k(e,this.node.positionX),this._positionY=new u.k(e,this.node.positionY),this._positionZ=new u.k(e,this.node.positionZ)}dispose(){super.dispose(),this._orientationX.dispose(),this._orientationY.dispose(),this._orientationZ.dispose(),this._positionX.dispose(),this._positionY.dispose(),this._positionZ.dispose(),this.node.disconnect()}get coneInnerAngle(){return d(this.node.coneInnerAngle)}set coneInnerAngle(e){this.node.coneInnerAngle=p(e)}get coneOuterAngle(){return d(this.node.coneOuterAngle)}set coneOuterAngle(e){this.node.coneOuterAngle=p(e)}get coneOuterVolume(){return this.node.coneOuterGain}set coneOuterVolume(e){this.node.coneOuterGain=e}get distanceModel(){return this.node.distanceModel}set distanceModel(e){this.node.distanceModel=e;let t=this.node.maxDistance;this.node.maxDistance=t+.001,this.node.maxDistance=t}get minDistance(){return this.node.refDistance}set minDistance(e){this.node.refDistance=e}get maxDistance(){return this.node.maxDistance}set maxDistance(e){this.node.maxDistance=e}get panningModel(){return this.node.panningModel}set panningModel(e){this.node.panningModel=e}get rolloffFactor(){return this.node.rolloffFactor}set rolloffFactor(e){this.node.rolloffFactor=e}get _inNode(){return this.node}get _outNode(){return this.node}_updatePosition(){this._lastPosition.equalsWithEpsilon(this.position)||(this._positionX.targetValue=this.position.x,this._positionY.targetValue=this.position.y,this._positionZ.targetValue=this.position.z,this._lastPosition.copyFrom(this.position))}_updateRotation(){let e=!1;if(this._lastRotationQuaternion.equalsWithEpsilon(this.rotationQuaternion))if(this._lastRotation.equalsWithEpsilon(this.rotation)){if(this._lastOrientation.equalsWithEpsilon(this.orientation))return}else l.PT.FromEulerAnglesToRef(this.rotation.x,this.rotation.y,this.rotation.z,c),this._lastRotation.copyFrom(this.rotation),e=!0;else c.copyFrom(this.rotationQuaternion),this._lastRotationQuaternion.copyFrom(this.rotationQuaternion),e=!0;e&&(l.uq.FromQuaternionToRef(c,h),l.Pq.TransformNormalToRef(l.Pq.RightReadOnly,h,this.orientation)),this._orientationX.targetValue=this.orientation.x,this._orientationY.targetValue=this.orientation.y,this._orientationZ.targetValue=this.orientation.z}_connect(e){return!!super._connect(e)&&(e._inNode&&this.node.connect(e._inNode),!0)}_disconnect(e){return!!super._disconnect(e)&&(e._inNode&&this.node.disconnect(e._inNode),!0)}getClassName(){return"_SpatialWebAudioSubNode"}}async function m(e){return new g(e)}class g extends n.a7{constructor(e){super(e),this.node=new StereoPannerNode(e._audioContext),this._pan=new u.k(e,this.node.pan)}dispose(){super.dispose(),this._pan.dispose()}get pan(){return this._pan.targetValue}set pan(e){this._pan.targetValue=e}get _inNode(){return this.node}get _outNode(){return this.node}getClassName(){return"_StereoWebAudioSubNode"}_connect(e){return!!super._connect(e)&&(e._inNode&&this.node.connect(e._inNode),!0)}_disconnect(e){return!!super._disconnect(e)&&(e._inNode&&this.node.disconnect(e._inNode),!0)}}var b=i(92383);class y extends b.H{constructor(){super(...arguments),this._rootNode=null,this._inputNode=null}async initAsync(e){await super.initAsync(e);let t=!1,i=!1;(t=(0,a.GB)(e))&&await this.createAndAddSubNodeAsync("Spatial"),(i=(0,o.uD)(e))&&await this.createAndAddSubNodeAsync("Stereo"),await this._createSubNodePromisesResolvedAsync(),t&&(0,r.y5)(this)?.setOptions(e),i&&(0,n.KJ)(this)?.setOptions(e)}get _inNode(){return this._inputNode}_createSubNode(e){try{return super._createSubNode(e)}catch(e){}switch(e){case"Spatial":return f(this._owner.engine);case"Stereo":return m(this._owner.engine);default:throw Error(`Unknown subnode name: ${e}`)}}_onSubNodesChanged(){super._onSubNodesChanged();let e=(0,r.y5)(this),t=(0,n.KJ)(this),i=(0,s.sf)(this);if(e&&"_SpatialWebAudioSubNode"!==e.getClassName()||t&&"_StereoWebAudioSubNode"!==t.getClassName()||i&&"_VolumeWebAudioSubNode"!==i.getClassName())throw Error("Not a WebAudio subnode.");e&&(e.disconnectAll(),i&&e.connect(i)),t&&(t.disconnectAll(),i&&t.connect(i)),e&&t?(this._rootNode=new GainNode(this._owner.engine._audioContext),this._rootNode.connect(e._outNode),this._rootNode.connect(t._outNode)):(this._rootNode?.disconnect(),this._rootNode=null);let a=null,o=null;if(this._rootNode?o=this._rootNode:(e?a=e:t?a=t:i&&(a=i),o=a?.node??null),this._inputNode!==o){if(this._inputNode&&this._upstreamNodes){let e=this._upstreamNodes.values();for(let t=e.next();!t.done;t=e.next())t.value._outNode?.disconnect(this._inputNode)}if(this._inputNode=o,o&&this._upstreamNodes){let e=this._upstreamNodes.values();for(let t=e.next();!t.done;t=e.next())t.value._outNode?.connect(o)}}}}},42866(e,t,i){i.d(t,{i:()=>o});var r=i(46835),n=i(79095);class s extends n.lA{constructor(e){super(),this._coneInnerAngle=n.Qc.coneInnerAngle,this._coneOuterAngle=n.Qc.coneOuterAngle,this._coneOuterVolume=n.Qc.coneOuterVolume,this._distanceModel=n.Qc.distanceModel,this._maxDistance=n.Qc.maxDistance,this._minDistance=n.Qc.minDistance,this._panningModel=n.Qc.panningModel,this._rolloffFactor=n.Qc.rolloffFactor;const t=(0,r.y5)(e);t?(this._orientation=t.orientation.clone(),this._position=t.position.clone(),this._rotation=t.rotation.clone(),this._rotationQuaternion=t.rotationQuaternion.clone()):(this._orientation=n.Qc.orientation.clone(),this._position=n.Qc.position.clone(),this._rotation=n.Qc.rotation.clone(),this._rotationQuaternion=n.Qc.rotationQuaternion.clone(),e.createAndAddSubNodeAsync("Spatial")),this._subGraph=e}dispose(){this._subGraph.removeSubNodeAsync((0,r.y5)(this._subGraph))}get coneInnerAngle(){return this._coneInnerAngle}set coneInnerAngle(e){this._coneInnerAngle=e,(0,r.Pt)(this._subGraph,"coneInnerAngle",e)}get coneOuterAngle(){return this._coneOuterAngle}set coneOuterAngle(e){this._coneOuterAngle=e,(0,r.Pt)(this._subGraph,"coneOuterAngle",e)}get coneOuterVolume(){return this._coneOuterVolume}set coneOuterVolume(e){this._coneOuterVolume=e,(0,r.Pt)(this._subGraph,"coneOuterVolume",e)}get distanceModel(){return this._distanceModel}set distanceModel(e){this._distanceModel=e,(0,r.Pt)(this._subGraph,"distanceModel",e)}get isAttached(){return this._subGraph.getSubNode("Spatial")?.isAttached??!1}get maxDistance(){return this._maxDistance}set maxDistance(e){e<=0&&(e=1e-6),this._maxDistance=e,(0,r.Pt)(this._subGraph,"maxDistance",e)}get minDistance(){return this._minDistance}set minDistance(e){this._minDistance=e,(0,r.Pt)(this._subGraph,"minDistance",e)}get orientation(){return this._orientation}set orientation(e){this._orientation=e,this._updateRotation()}get panningModel(){return this._panningModel}set panningModel(e){this._panningModel=e,(0,r.Pt)(this._subGraph,"panningModel",e)}get position(){return this._position}set position(e){this._position=e,this._updatePosition()}get rolloffFactor(){return this._rolloffFactor}set rolloffFactor(e){this._rolloffFactor=e,(0,r.Pt)(this._subGraph,"rolloffFactor",e)}get rotation(){return this._rotation}set rotation(e){this._rotation=e,this._updateRotation()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(e){this._rotationQuaternion=e,this._updateRotation()}attach(e,t=!1,i=3){(0,r.y5)(this._subGraph)?.attach(e,t,i)}detach(){(0,r.y5)(this._subGraph)?.detach()}update(){let e=(0,r.y5)(this._subGraph);e&&(e.isAttached?e.update():(this._updatePosition(e),this._updateRotation(e)))}_updatePosition(e=null){(e||(e=(0,r.y5)(this._subGraph)))&&(e.position.equalsWithEpsilon(this._position)||(e.position.copyFrom(this._position),e._updatePosition()))}_updateRotation(e=null){(e||(e=(0,r.y5)(this._subGraph)))&&(e.rotationQuaternion.equalsWithEpsilon(this._rotationQuaternion)?e.rotation.equalsWithEpsilon(this._rotation)?e.orientation.equalsWithEpsilon(this._orientation)||(e.orientation.copyFrom(this._orientation),e._updateRotation(),this._rotation.copyFrom(e.rotation),this._rotationQuaternion.copyFrom(e.rotationQuaternion)):(e.rotation.copyFrom(this._rotation),e._updateRotation(),this._orientation.copyFrom(e.orientation),this._rotationQuaternion.copyFrom(e.rotationQuaternion)):(e.rotationQuaternion.copyFrom(this._rotationQuaternion),e._updateRotation(),this._orientation.copyFrom(e.orientation),this._rotation.copyFrom(e.rotation)))}}var a=i(95498);class o extends s{constructor(e,t,i){super(e),this._updaterComponent=new a.w(this,t,i)}get minUpdateTime(){return this._updaterComponent.minUpdateTime}set minUpdateTime(e){this._updaterComponent.minUpdateTime=e}dispose(){super.dispose(),this._updaterComponent.dispose(),this._updaterComponent=null}}},708(e,t,i){i.d(t,{o:()=>p});var r=i(70134),n=i(74083),s=i(93319);class a extends s.rF{constructor(){super(),this._attacherComponent=null,this._attacherComponent=new n.l(this)}get isAttached(){return null!==this._attacherComponent&&this._attacherComponent.isAttached}attach(e,t=!1,i=3){this._attacherComponent||(this._attacherComponent=new n.l(this)),this._attacherComponent.attach(e,t,i)}detach(){this._attacherComponent?.detach()}dispose(){this._attacherComponent?.dispose(),this._attacherComponent=null}setOptions(e){void 0!==e.listenerMinUpdateTime&&(this.minUpdateTime=e.listenerMinUpdateTime),e.listenerPosition&&(this.position=e.listenerPosition.clone()),e.listenerRotationQuaternion?this.rotationQuaternion=e.listenerRotationQuaternion.clone():e.listenerRotation?this.rotation=e.listenerRotation.clone():this.rotationQuaternion=s.oO.rotationQuaternion.clone(),this.update()}}var o=i(95498),l=i(72394);let u=r.uq.Zero(),h=new r.PT,c=r.Pq.Zero(),d=r.Pq.Zero();function p(e,t,i){let r=e._audioContext.listener;return r.forwardX&&r.forwardY&&r.forwardZ&&r.positionX&&r.positionY&&r.positionZ&&r.upX&&r.upY&&r.upZ?new _(e,t,i):new m(e,t,i)}class f extends a{constructor(e,t,i){super(),this._lastPosition=r.Pq.Zero(),this._lastRotation=r.Pq.Zero(),this._lastRotationQuaternion=new r.PT,this.position=r.Pq.Zero(),this.rotation=r.Pq.Zero(),this.rotationQuaternion=new r.PT,this._listener=e._audioContext.listener,this.engine=e,this._updaterComponent=new o.w(this,t,i)}dispose(){super.dispose(),this._updaterComponent.dispose(),this._updaterComponent=null}get minUpdateTime(){return this._updaterComponent.minUpdateTime}set minUpdateTime(e){this._updaterComponent.minUpdateTime=e}update(){this.isAttached?this._attacherComponent?.update():(this._updatePosition(),this._updateRotation())}_updatePosition(){this._lastPosition.equalsWithEpsilon(this.position)||(this._setWebAudioPosition(this.position),this._lastPosition.copyFrom(this.position))}_updateRotation(){if(this._lastRotationQuaternion.equalsWithEpsilon(this.rotationQuaternion))if(this._lastRotation.equalsWithEpsilon(this.rotation))return;else r.PT.FromEulerAnglesToRef(this.rotation.x,this.rotation.y,this.rotation.z,h),this._lastRotation.copyFrom(this.rotation);else h.copyFrom(this.rotationQuaternion),this._lastRotationQuaternion.copyFrom(this.rotationQuaternion);r.uq.FromQuaternionToRef(h,u),r.Pq.TransformNormalToRef(r.Pq.RightHandedForwardReadOnly,u,c),r.Pq.TransformNormalToRef(r.Pq.Up(),u,d),this._setWebAudioOrientation(c,d)}}class _ extends f{constructor(e,t,i){super(e,t,i);const r=e._audioContext.listener;this._forwardX=new l.k(e,r.forwardX),this._forwardY=new l.k(e,r.forwardY),this._forwardZ=new l.k(e,r.forwardZ),this._positionX=new l.k(e,r.positionX),this._positionY=new l.k(e,r.positionY),this._positionZ=new l.k(e,r.positionZ),this._upX=new l.k(e,r.upX),this._upY=new l.k(e,r.upY),this._upZ=new l.k(e,r.upZ)}_setWebAudioPosition(e){this.isAttached&&(this._positionX.isRamping||this._positionY.isRamping||this._positionZ.isRamping)||(this._positionX.targetValue=e.x,this._positionY.targetValue=e.y,this._positionZ.targetValue=e.z)}_setWebAudioOrientation(e,t){this.isAttached&&(this._forwardX.isRamping||this._forwardY.isRamping||this._forwardZ.isRamping||this._upX.isRamping||this._upY.isRamping||this._upZ.isRamping)||(this._forwardX.targetValue=e.x,this._forwardY.targetValue=e.y,this._forwardZ.targetValue=e.z,this._upX.targetValue=t.x,this._upY.targetValue=t.y,this._upZ.targetValue=t.z)}}class m extends f{_setWebAudioPosition(e){this._listener.setPosition(e.x,e.y,e.z)}_setWebAudioOrientation(e,t){this._listener.setOrientation(e.x,e.y,e.z,t.x,t.y,t.z)}}},27982(e,t,i){i.d(t,{$:()=>a});var r=i(55971);class n extends r.f0{constructor(e){super(e,1)}}var s=i(72394);class a extends n{constructor(e){super(e),this._setGainNode(new GainNode(e._audioContext))}dispose(){super.dispose(),this._volume.dispose(),this._gainNode.disconnect(),this._destinationNode.disconnect()}get _inNode(){return this._gainNode}set _inNode(e){this._gainNode!==e&&this._setGainNode(e)}get volume(){return this._volume.targetValue}set volume(e){this._volume.targetValue=e}get _destinationNode(){return this.engine._audioDestination}getClassName(){return"_WebAudioMainOut"}setVolume(e,t=null){this._volume.setTargetValue(e,t)}_setGainNode(e){this._gainNode!==e&&(this._gainNode?.disconnect(),e.connect(this._destinationNode),this._volume=new s.k(this.engine,e.gain),this._gainNode=e)}}},49437(e,t,i){i.d(t,{U:()=>n});var r=i(94470);class n{constructor(e,t){this._button=null,this._enabled=!0,this._style=null,this._onStateChanged=()=>{this._button&&("running"===this._engine.state?this._hide():this._show())},this._engine=e;const i=t||r.q.LastCreatedEngine?.getInputElement()?.parentElement||document.body,n=(i?.offsetTop||0)+20;this._style=document.createElement("style"),this._style.appendChild(document.createTextNode(`.babylonUnmute{position:absolute;top:${n}px;margin-left:20px;height:40px;width:60px;background-color:rgba(51,51,51,0.7);background-image:url("data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E");background-size:80%;background-repeat:no-repeat;background-position:center;background-position-y:4px;border:none;outline:none;transition:transform 0.125s ease-out;cursor:pointer;z-index:9999;}.babylonUnmute:hover{transform:scale(1.05)}`)),document.head.appendChild(this._style),this._button=document.createElement("button"),this._button.className="babylonUnmute",this._button.id="babylonUnmuteButton",this._button.addEventListener("click",()=>{this._engine.unlockAsync()}),i.appendChild(this._button),this._engine.stateChangedObservable.add(this._onStateChanged)}dispose(){this._button?.remove(),this._button=null,this._style?.remove(),this._style=null,this._engine.stateChangedObservable.removeCallback(this._onStateChanged)}get enabled(){return this._enabled}set enabled(e){this._enabled=e,e?"running"!==this._engine.state&&this._show():this._hide()}_show(){this._button&&this._enabled&&(this._button.style.display="block")}_hide(){this._button&&(this._button.style.display="none")}}},72876(e,t,i){let r;var n=i(95435),s=i(33914);let a=!!((new Uint32Array((r=new Uint8Array(4)).buffer)[0]=1)&r[0]);Object.defineProperty(n.R.prototype,"effectiveByteStride",{get:function(){return this._alignedBuffer&&this._alignedBuffer.byteStride||this.byteStride},enumerable:!0,configurable:!0}),Object.defineProperty(n.R.prototype,"effectiveByteOffset",{get:function(){return this._alignedBuffer?0:this.byteOffset},enumerable:!0,configurable:!0}),Object.defineProperty(n.R.prototype,"effectiveBuffer",{get:function(){return this._alignedBuffer&&this._alignedBuffer.getBuffer()||this._buffer.getBuffer()},enumerable:!0,configurable:!0}),n.R.prototype._rebuild=function(){this._buffer?._rebuild(),this._alignedBuffer?._rebuild()},n.R.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose(),this._alignedBuffer?.dispose(),this._alignedBuffer=void 0,this._isDisposed=!0},n.R.prototype.getWrapperBuffer=function(){return this._alignedBuffer||this._buffer},n.R.prototype._alignBuffer=function(){let e,t,i=this._buffer.getData();if(!this.engine._features.forceVertexBufferStrideAndOffsetMultiple4Bytes||this.byteStride%4==0&&this.byteOffset%4==0||!i)return;let r=(0,s.PD)(this.type),o=this.byteStride+3&-4,l=o/r,u=this._maxVerticesCount,h=u*o/r;if(Array.isArray(i)){let t=new Float32Array(i);e=new DataView(t.buffer,t.byteOffset,t.byteLength)}else e=i instanceof ArrayBuffer?new DataView(i,0,i.byteLength):new DataView(i.buffer,i.byteOffset,i.byteLength);t=this.type===n.R.BYTE?new Int8Array(h):this.type===n.R.UNSIGNED_BYTE?new Uint8Array(h):this.type===n.R.SHORT?new Int16Array(h):this.type===n.R.UNSIGNED_SHORT?new Uint16Array(h):this.type===n.R.INT?new Int32Array(h):this.type===n.R.UNSIGNED_INT?new Uint32Array(h):new Float32Array(h);let c=this.getSize(),d=this.byteOffset;for(let i=0;i<u;++i){for(let r=0;r<c;++r)switch(this.type){case n.R.BYTE:t[i*l+r]=e.getInt8(d+r);break;case n.R.UNSIGNED_BYTE:t[i*l+r]=e.getUint8(d+r);break;case n.R.SHORT:t[i*l+r]=e.getInt16(d+2*r,a);break;case n.R.UNSIGNED_SHORT:t[i*l+r]=e.getUint16(d+2*r,a);break;case n.R.INT:t[i*l+r]=e.getInt32(d+4*r,a);break;case n.R.UNSIGNED_INT:t[i*l+r]=e.getUint32(d+4*r,a);break;case n.R.FLOAT:t[i*l+r]=e.getFloat32(d+4*r,a)}d+=this.byteStride}this._alignedBuffer?.dispose(),this._alignedBuffer=new n.h(this.engine,t,!1,o,!1,this.getIsInstanced(),!0,this.instanceDivisor,(this._label??"VertexBuffer")+"_aligned")}},39993(e,t,i){i.d(t,{z:()=>s});var r=i(26061);let n={[r.R.PositionKind]:!0,[r.R.NormalKind]:!0,[r.R.TangentKind]:!0,[r.R.UVKind]:!0,[r.R.UV2Kind]:!0,[r.R.UV3Kind]:!0,[r.R.UV4Kind]:!0,[r.R.UV5Kind]:!0,[r.R.UV6Kind]:!0,[r.R.ColorKind]:!0,[r.R.ColorInstanceKind]:!0,[r.R.MatricesIndicesKind]:!0,[r.R.MatricesWeightsKind]:!0,[r.R.MatricesIndicesExtraKind]:!0,[r.R.MatricesWeightsExtraKind]:!0};function s(e,t){let i=t.getEngine(),s=t._pipelineContext;if(!s?.vertexBufferKindToType)return;let a=null;for(let o in e){let l=e[o];if(!l||!n[o])continue;let u=l.normalized?r.R.FLOAT:l.type,h=s.vertexBufferKindToType[o];(u!==r.R.FLOAT&&void 0===h||void 0!==h&&h!==u)&&(a||(a=i._getShaderProcessingContext(t.shaderLanguage,!1)),s.vertexBufferKindToType[o]=u,u!==r.R.FLOAT&&(a.vertexBufferKindToNumberOfComponents[o]=r.R.DeduceStride(o),function(e){switch(e){case r.R.BYTE:case r.R.SHORT:case r.R.INT:case r.R.FLOAT:return!0;case r.R.UNSIGNED_BYTE:case r.R.UNSIGNED_SHORT:case r.R.UNSIGNED_INT:return!1;default:throw Error(`Invalid type '${e}'`)}}(u)&&(a.vertexBufferKindToNumberOfComponents[o]*=-1)))}if(a){let e=i._caps.parallelShaderCompile;i._caps.parallelShaderCompile=void 0,t._processShaderCodeAsync(null,i._features._checkNonFloatVertexBuffersDontRecreatePipelineContext,a),i._caps.parallelShaderCompile=e}}},33617(e,t,i){i.d(t,{e:()=>l});var r=i(11683),n=i(70134),s=i(32997),a=i(3765),o=i(52969);a.s.prototype.addDeviceOrientation=function(e){return this._deviceOrientationInput||(this._deviceOrientationInput=new l,e&&(this._deviceOrientationInput.smoothFactor=e),this.add(this._deviceOrientationInput)),this};class l{static async WaitForOrientationChangeAsync(e){return await new Promise((t,i)=>{let r=!1,n=()=>{window.removeEventListener("deviceorientation",n),r=!0,t()};e&&setTimeout(()=>{r||(window.removeEventListener("deviceorientation",n),i("WaitForOrientationChangeAsync timed out"))},e),"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e?window.addEventListener("deviceorientation",n):s.S0.Warn("Permission not granted.")}).catch(e=>{s.S0.Error(e)}):window.addEventListener("deviceorientation",n)})}constructor(){this._screenOrientationAngle=0,this._screenQuaternion=new n.PT,this._alpha=0,this._beta=0,this._gamma=0,this.smoothFactor=0,this._onDeviceOrientationChangedObservable=new o.cP,this._orientationChanged=()=>{this._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,this._screenOrientationAngle=-s.S0.ToRadians(this._screenOrientationAngle/2),this._screenQuaternion.copyFromFloats(0,Math.sin(this._screenOrientationAngle),0,Math.cos(this._screenOrientationAngle))},this._deviceOrientation=e=>{this.smoothFactor?(this._alpha=null!==e.alpha?s.S0.SmoothAngleChange(this._alpha,e.alpha,this.smoothFactor):0,this._beta=null!==e.beta?s.S0.SmoothAngleChange(this._beta,e.beta,this.smoothFactor):0,this._gamma=null!==e.gamma?s.S0.SmoothAngleChange(this._gamma,e.gamma,this.smoothFactor):0):(this._alpha=null!==e.alpha?e.alpha:0,this._beta=null!==e.beta?e.beta:0,this._gamma=null!==e.gamma?e.gamma:0),null!==e.alpha&&this._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTransform=new n.PT(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}get camera(){return this._camera}set camera(e){this._camera=e,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new n.PT),this._camera&&this._camera.onDisposeObservable.add(()=>{this._onDeviceOrientationChangedObservable.clear()})}attachControl(){let e=this.camera.getScene().getEngine().getHostWindow();if(e){let t=()=>{e.addEventListener("orientationchange",this._orientationChanged),e.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()};"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e?t():s.S0.Warn("Permission not granted.")}).catch(e=>{s.S0.Error(e)}):t()}}detachControl(){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0}checkInputs(){this._alpha&&this._camera.rotationQuaternion&&(n.PT.RotationYawPitchRollToRef(s.S0.ToRadians(this._alpha),s.S0.ToRadians(this._beta),-s.S0.ToRadians(this._gamma),this._camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTransform),this._camera.getScene().useRightHandedSystem?this._camera.rotationQuaternion.y*=-1:this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)}getClassName(){return"FreeCameraDeviceOrientationInput"}getSimpleName(){return"deviceOrientation"}}r.H.FreeCameraDeviceOrientationInput=l},16355(e,t,i){i.d(t,{g:()=>a});var r=i(39545),n=i(61646),s=i(19094);class a extends s.R{constructor(){super(...arguments),this.pinchZoom=!0,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this._isPinching=!1,this._twoFingerActivityCount=0,this._shouldStartPinchZoom=!1}_computePinchZoom(e,t){}_computeMultiTouchPanning(e,t){}onMultiTouch(e,t,i,r,n,s){0===i&&null===n||(0!==r||null!==s)&&(this.multiTouchPanAndZoom?(this._computePinchZoom(i,r),this._computeMultiTouchPanning(n,s)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._shouldStartPinchZoom?(this._computePinchZoom(i,r),this._isPinching=!0):this._computeMultiTouchPanning(n,s)):this.multiTouchPanning?this._computeMultiTouchPanning(n,s):this.pinchZoom&&this._computePinchZoom(i,r))}onButtonUp(e){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._twoFingerActivityCount=0,this._isPinching=!1}}(0,r.Cg)([(0,n.lK)()],a.prototype,"pinchZoom",void 0),(0,r.Cg)([(0,n.lK)()],a.prototype,"multiTouchPanning",void 0),(0,r.Cg)([(0,n.lK)()],a.prototype,"multiTouchPanAndZoom",void 0)},55745(e,t,i){i.d(t,{A:()=>o});var r=i(9633),n=i(70134),s=i(28667),a=i(87201);class o{constructor(){this._scaledPosition=n.Pq.Zero(),this._scaledVelocity=n.Pq.Zero(),this._finalPosition=n.Pq.Zero()}getNewPosition(e,t,i,r,n,s,a,o=!0){return e.divideToRef(i._radius,this._scaledPosition),t.divideToRef(i._radius,this._scaledVelocity),i.collidedMesh=null,i._retry=0,i._initialVelocity=this._scaledVelocity,i._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,r,this._finalPosition,o,n),this._finalPosition.multiplyInPlace(i._radius),s(a,this._finalPosition,i.collidedMesh),this._finalPosition}createCollider(){return new s.J}init(e){this._scene=e}_collideWithWorld(e,t,i,r,n,s,o=null){let l=10*a.$.CollisionsEpsilon;if(i._retry>=r)return void n.copyFrom(e);let u=o?o.collisionMask:i.collisionMask;i._initialize(e,t,l);let h=o&&o.surroundingMeshes||this._scene.meshes;for(let e=0;e<h.length;e++){let t=h[e];t.isEnabled()&&t.checkCollisions&&t.subMeshes&&t!==o&&(u&t.collisionGroup)!=0&&t._checkCollision(i)}i.collisionFound?((0!==t.x||0!==t.y||0!==t.z)&&(i._getResponse(e,t,s),s||t.setAll(0)),t.length()<=l)?n.copyFrom(e):(i._retry++,this._collideWithWorld(e,t,i,r,n,s,o)):e.addToRef(t,n)}}r.Z.CollisionCoordinatorFactory=()=>new o},33521(e,t,i){i.d(t,{AU:()=>f,DY:()=>v,Gz:()=>p,KI:()=>S,Oj:()=>I,R0:()=>h,Rl:()=>c,S:()=>T,TR:()=>A,m9:()=>E,mc:()=>x,oZ:()=>_,uW:()=>y,ui:()=>d});var r=i(26108),n=i(70134),s=i(70728),a=i(49342),o=i(81520),l=i(94470),u=i(90368);let h={internalPickerForMesh:void 0};class c{constructor(e,t,i=Number.MAX_VALUE,n=r.bH){this.origin=e,this.direction=t,this.length=i,this.epsilon=n}clone(){return new c(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(e,t,i=0){let r,n,s,a,o=c._TmpVector3[0].copyFromFloats(e.x-i,e.y-i,e.z-i),l=c._TmpVector3[1].copyFromFloats(t.x+i,t.y+i,t.z+i),u=0,h=Number.MAX_VALUE;if(1e-7>Math.abs(this.direction.x)){if(this.origin.x<o.x||this.origin.x>l.x)return!1}else if(r=1/this.direction.x,n=(o.x-this.origin.x)*r,(s=(l.x-this.origin.x)*r)==-1/0&&(s=1/0),n>s&&(a=n,n=s,s=a),(u=Math.max(n,u))>(h=Math.min(s,h)))return!1;if(1e-7>Math.abs(this.direction.y)){if(this.origin.y<o.y||this.origin.y>l.y)return!1}else if(r=1/this.direction.y,n=(o.y-this.origin.y)*r,(s=(l.y-this.origin.y)*r)==-1/0&&(s=1/0),n>s&&(a=n,n=s,s=a),(u=Math.max(n,u))>(h=Math.min(s,h)))return!1;if(1e-7>Math.abs(this.direction.z)){if(this.origin.z<o.z||this.origin.z>l.z)return!1}else if(r=1/this.direction.z,n=(o.z-this.origin.z)*r,(s=(l.z-this.origin.z)*r)==-1/0&&(s=1/0),n>s&&(a=n,n=s,s=a),(u=Math.max(n,u))>(h=Math.min(s,h)))return!1;return!0}intersectsBox(e,t=0){return this.intersectsBoxMinMax(e.minimum,e.maximum,t)}intersectsSphere(e,t=0){let i=e.center.x-this.origin.x,r=e.center.y-this.origin.y,n=e.center.z-this.origin.z,s=i*i+r*r+n*n,a=e.radius+t,o=a*a;if(s<=o)return!0;let l=i*this.direction.x+r*this.direction.y+n*this.direction.z;return!(l<0)&&s-l*l<=o}intersectsTriangle(e,t,i){let r=c._TmpVector3[0],s=c._TmpVector3[1],o=c._TmpVector3[2],l=c._TmpVector3[3],u=c._TmpVector3[4];t.subtractToRef(e,r),i.subtractToRef(e,s),n.Pq.CrossToRef(this.direction,s,o);let h=n.Pq.Dot(r,o);if(0===h)return null;let d=1/h;this.origin.subtractToRef(e,l);let p=n.Pq.Dot(l,o)*d;if(p<-this.epsilon||p>1+this.epsilon)return null;n.Pq.CrossToRef(l,r,u);let f=n.Pq.Dot(this.direction,u)*d;if(f<-this.epsilon||p+f>1+this.epsilon)return null;let _=n.Pq.Dot(s,u)*d;return _>this.length||_<0?null:new a.w(1-p-f,p,_)}intersectsPlane(e){let t,i=n.Pq.Dot(e.normal,this.direction);if(999999997475243e-21>Math.abs(i))return null;{let r=n.Pq.Dot(e.normal,this.origin);if((t=(-e.d-r)/i)<0)if(t<-999999997475243e-21)return null;else return 0;return t}}intersectsAxis(e,t=0){switch(e){case"y":{let e=(this.origin.y-t)/this.direction.y;if(e>0)return null;return new n.Pq(this.origin.x+-(this.direction.x*e),t,this.origin.z+-(this.direction.z*e))}case"x":{let e=(this.origin.x-t)/this.direction.x;if(e>0)return null;return new n.Pq(t,this.origin.y+-(this.direction.y*e),this.origin.z+-(this.direction.z*e))}case"z":{let e=(this.origin.z-t)/this.direction.z;if(e>0)return null;return new n.Pq(this.origin.x+-(this.direction.x*e),this.origin.y+-(this.direction.y*e),t)}default:return null}}intersectsMesh(e,t,i,r=!1,s,a=!1){let o=n.AA.Matrix["0"];return e.getWorldMatrix().invertToRef(o),this._tmpRay?c.TransformToRef(this,o,this._tmpRay):this._tmpRay=c.Transform(this,o),e.intersects(this._tmpRay,t,i,r,s,a)}intersectsMeshes(e,t,i){i?i.length=0:i=[];for(let r=0;r<e.length;r++){let n=this.intersectsMesh(e[r],t);n.hit&&i.push(n)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(e,t){return e.distance<t.distance?-1:+(e.distance>t.distance)}intersectionSegment(e,t,i){let r=this.origin,s=n.AA.Vector3["0"],a=n.AA.Vector3["1"],o=n.AA.Vector3["2"],l=n.AA.Vector3["3"];t.subtractToRef(e,s),this.direction.scaleToRef(c._Rayl,o),r.addToRef(o,a),e.subtractToRef(r,l);let u=n.Pq.Dot(s,s),h=n.Pq.Dot(s,o),d=n.Pq.Dot(o,o),p=n.Pq.Dot(s,l),f=n.Pq.Dot(o,l),_=u*d-h*h,m,g=_,b,y=_;_<c._Smallnum?(m=0,g=1,b=f,y=d):(m=h*f-d*p,b=u*f-h*p,m<0?(m=0,b=f,y=d):m>g&&(m=g,b=f+h,y=d)),b<0?(b=0,0>-p?m=0:-p>u?m=g:(m=-p,g=u)):b>y&&(b=y,-p+h<0?m=0:-p+h>u?m=g:(m=-p+h,g=u));let x=Math.abs(m)<c._Smallnum?0:m/g,T=Math.abs(b)<c._Smallnum?0:b/y,v=n.AA.Vector3["4"];o.scaleToRef(T,v);let A=n.AA.Vector3["5"];s.scaleToRef(x,A),A.addInPlace(l);let S=n.AA.Vector3["6"];return(A.subtractToRef(v,S),T>0&&T<=this.length&&S.lengthSquared()<i*i)?A.length():-1}update(e,t,i,r,s,a,o,l=!1){if(l){c._RayDistant||(c._RayDistant=c.Zero()),c._RayDistant.unprojectRayToRef(e,t,i,r,n.uq.IdentityReadOnly,a,o);let l=n.AA.Matrix["0"];s.invertToRef(l),c.TransformToRef(c._RayDistant,l,this)}else this.unprojectRayToRef(e,t,i,r,s,a,o);return this}static Zero(){return new c(n.Pq.Zero(),n.Pq.Zero())}static CreateNew(e,t,i,r,n,s,a){return c.Zero().update(e,t,i,r,n,s,a)}static CreateNewFromTo(e,t,i=n.uq.IdentityReadOnly){let r=new c(new n.Pq(0,0,0),new n.Pq(0,0,0));return c.CreateFromToToRef(e,t,r,i)}static CreateFromToToRef(e,t,i,r=n.uq.IdentityReadOnly){i.origin.copyFrom(e);let s=t.subtractToRef(e,i.direction);return i.length=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z),i.direction.normalize(),c.TransformToRef(i,r,i)}static Transform(e,t){let i=new c(new n.Pq(0,0,0),new n.Pq(0,0,0));return c.TransformToRef(e,t,i),i}static TransformToRef(e,t,i){n.Pq.TransformCoordinatesToRef(e.origin,t,i.origin),n.Pq.TransformNormalToRef(e.direction,t,i.direction),i.length=e.length,i.epsilon=e.epsilon;let r=i.direction,s=r.length();if(0!==s&&1!==s){let e=1/s;r.x*=e,r.y*=e,r.z*=e,i.length*=s}return i}unprojectRayToRef(e,t,i,r,s,a,o){let u=n.AA.Matrix["0"];s.multiplyToRef(a,u),u.multiplyToRef(o,u),u.invert();let h=l.q.LastCreatedEngine,c=n.AA.Vector3["0"];c.x=e/i*2-1,c.y=-(t/r*2-1),c.z=h?.useReverseDepthBuffer?1:h?.isNDCHalfZRange?0:-1;let d=n.AA.Vector3["1"].copyFromFloats(c.x,c.y,1-1e-8),p=n.AA.Vector3["2"],f=n.AA.Vector3["3"];n.Pq.TransformCoordinatesToRef(c,u,p),n.Pq.TransformCoordinatesToRef(d,u,f),this.origin.copyFrom(p),f.subtractToRef(p,this.direction),this.direction.normalize()}}function d(e,t,i,r,n,s=!1){let a=c.Zero();return p(e,t,i,r,a,n,s),a}function p(e,t,i,r,s,a,o=!1,l=!1){let u=e.getEngine();if(!a&&!(a=e.activeCamera))return e;let h=a.viewport,c=u.getRenderHeight(),{x:d,y:f,width:_,height:m}=h.toGlobal(u.getRenderWidth(),c),g=1/u.getHardwareScalingLevel();return t=t*g-d,i=i*g-(c-f-m),s.update(t,i,_,m,r||n.uq.IdentityReadOnly,o?n.uq.IdentityReadOnly:a.getViewMatrix(),a.getProjectionMatrix(),l),e}function f(e,t,i,r){let n=c.Zero();return _(e,t,i,n,r),n}function _(e,t,i,r,s){if(!o.G)return e;let a=e.getEngine();if(!s&&!(s=e.activeCamera))throw Error("Active camera not set");let l=s.viewport,u=a.getRenderHeight(),{x:h,y:c,width:d,height:p}=l.toGlobal(a.getRenderWidth(),u),f=n.uq.Identity(),_=1/a.getHardwareScalingLevel();return t=t*_-h,i=i*_-(u-c-p),r.update(t,i,d,p,f,f,s.getProjectionMatrix()),e}function m(e,t,i,r,n,s,a,o){let l=t(r,i.enableDistantPicking),u=i.intersects(l,n,a,s,r,o);return u&&u.hit&&(n||null==e||!(u.distance>=e.distance))?u:null}function g(e,t,i,r,s,a){let l=null,u=!!(e.activeCameras&&e.activeCameras.length>1&&e.cameraToUseForPointers!==e.activeCamera),c=e.cameraToUseForPointers||e.activeCamera,d=h.internalPickerForMesh||m;for(let o=0;o<e.meshes.length;o++){let h=e.meshes[o];if(i){if(!i(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.isPickable)continue;let p=u&&h.isWorldMatrixCameraDependent(),f=h.computeWorldMatrix(p,c);if(h.hasThinInstances&&h.thinInstanceEnablePicking){let e=d(l,t,h,f,!0,!0,a);if(e){if(s)return e;let o=n.AA.Matrix["1"],u=h.thinInstanceGetWorldMatrices();for(let e=0;e<u.length;e++){if(i&&!i(h,e))continue;u[e].multiplyToRef(f,o);let n=d(l,t,h,o,r,s,a,!0);if(n&&((l=n).thinInstanceIndex=e,r))return l}}}else{let e=d(l,t,h,f,r,s,a);if(e&&(l=e,r))return l}}return l||new o.G}function b(e,t,i,r){if(!o.G)return null;let s=[],a=!!(e.activeCameras&&e.activeCameras.length>1&&e.cameraToUseForPointers!==e.activeCamera),l=e.cameraToUseForPointers||e.activeCamera,u=h.internalPickerForMesh||m;for(let o=0;o<e.meshes.length;o++){let h=e.meshes[o];if(i){if(!i(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.isPickable)continue;let c=a&&h.isWorldMatrixCameraDependent(),d=h.computeWorldMatrix(c,l);if(h.hasThinInstances&&h.thinInstanceEnablePicking){if(u(null,t,h,d,!0,!0,r)){let e=n.AA.Matrix["1"],a=h.thinInstanceGetWorldMatrices();for(let n=0;n<a.length;n++){if(i&&!i(h,n))continue;a[n].multiplyToRef(d,e);let o=u(null,t,h,e,!1,!1,r,!0);o&&(o.thinInstanceIndex=n,s.push(o))}}}else{let e=u(null,t,h,d,!1,!1,r);e&&s.push(e)}}return s}function y(e,t,i,r,s,a){if(!o.G)return null;let l=g(e,r=>(e._tempPickingRay||(e._tempPickingRay=c.Zero()),p(e,t,i,r,e._tempPickingRay,a||null),e._tempPickingRay),r,s,!0);return l&&(l.ray=d(e,t,i,n.uq.Identity(),a||null)),l}function x(e,t,i,r,s,a,o,l=!1){let u=g(e,(r,n)=>(e._tempPickingRay||(e._tempPickingRay=c.Zero()),p(e,t,i,r,e._tempPickingRay,a||null,!1,n),e._tempPickingRay),r,s,!1,o);return u&&(u.ray=d(e,t,i,n.uq.Identity(),a||null)),u}function T(e,t,i,r,s){let a=g(e,i=>(e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=n.uq.Identity()),i.invertToRef(e._pickWithRayInverseMatrix),e._cachedRayForTransform||(e._cachedRayForTransform=c.Zero()),c.TransformToRef(t,e._pickWithRayInverseMatrix,e._cachedRayForTransform),e._cachedRayForTransform),i,r,!1,s);return a&&(a.ray=t),a}function v(e,t,i,r,n,s){return b(e,r=>d(e,t,i,r,n||null),r,s)}function A(e,t,i,r){return b(e,i=>(e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=n.uq.Identity()),i.invertToRef(e._pickWithRayInverseMatrix),e._cachedRayForTransform||(e._cachedRayForTransform=c.Zero()),c.TransformToRef(t,e._pickWithRayInverseMatrix,e._cachedRayForTransform),e._cachedRayForTransform),i,r)}function S(e,t=100,i,r){return E(e,new c(n.Pq.Zero(),n.Pq.Zero(),t),t,i,r)}function E(e,t,i=100,r,s){r||(r=e.getWorldMatrix()),t.length=i,s?t.origin.copyFrom(s):t.origin.copyFrom(e.position);let a=n.AA.Vector3["2"];a.set(0,0,e._scene.useRightHandedSystem?-1:1);let o=n.AA.Vector3["3"];return n.Pq.TransformNormalToRef(a,r,o),n.Pq.NormalizeToRef(o,t.direction),t}function I(e,t){t&&(t.prototype.getForwardRay=function(e=100,t,i){return E(this,new c(n.Pq.Zero(),n.Pq.Zero(),e),e,t,i)},t.prototype.getForwardRayToRef=function(e,t=100,i,r){return E(this,e,t,i,r)}),e&&(u.h._IsPickingAvailable=!0,e.prototype.createPickingRay=function(e,t,i,r,n=!1){return d(this,e,t,i,r,n)})}c._TmpVector3=(0,s.mI)(6,n.Pq.Zero),c._RayDistant=c.Zero(),c._Smallnum=1e-8,c._Rayl=1e9},56282(e,t,i){i.d(t,{AU:()=>s.AU,DY:()=>s.DY,Gz:()=>s.Gz,KI:()=>s.KI,Oj:()=>s.Oj,R0:()=>s.R0,Rl:()=>s.Rl,S:()=>s.S,TR:()=>s.TR,m9:()=>s.m9,mc:()=>s.mc,oZ:()=>s.oZ,uW:()=>s.uW,ui:()=>s.ui});var r=i(9633),n=i(26623),s=i(33521);(0,s.Oj)(r.Z,n.i),r.Z.prototype.createPickingRayToRef=function(e,t,i,r,n,a=!1,o=!1){return(0,s.Gz)(this,e,t,i,r,n,a,o)},r.Z.prototype.createPickingRayInCameraSpace=function(e,t,i){return(0,s.AU)(this,e,t,i)},r.Z.prototype.createPickingRayInCameraSpaceToRef=function(e,t,i,r){return(0,s.oZ)(this,e,t,i,r)},r.Z.prototype.pickWithBoundingInfo=function(e,t,i,r,n){return(0,s.uW)(this,e,t,i,r,n)},r.Z.prototype.pick=function(e,t,i,r,n,a,o=!1){return(0,s.mc)(this,e,t,i,r,n,a,o)},r.Z.prototype.pickWithRay=function(e,t,i,r){return(0,s.S)(this,e,t,i,r)},r.Z.prototype.multiPick=function(e,t,i,r,n){return(0,s.DY)(this,e,t,i,r,n)},r.Z.prototype.multiPickWithRay=function(e,t,i){return(0,s.TR)(this,e,t,i)}},69646(e,t,i){i(87201).$.prototype.setAlphaEquation=function(e,t=0){if(this._alphaEquation[t]!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774,t);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778,t);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779,t);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776,t);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775,t);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774,t)}this._alphaEquation[t]=e}}},43946(e,t,i){var r=i(53805),n=i(31656),s=i(32715),a=i(74761),o=i(87201),l=i(49211),u=i(40404);o.$.prototype._partialLoadFile=function(e,t,i,r,n=null){this._loadFile(e,e=>{i[t]=e,i._internalCount++,6===i._internalCount&&r(i)},void 0,void 0,!0,(e,t)=>{n&&e&&n(e.status+" "+e.statusText,t)})},o.$.prototype._cascadeLoadFiles=function(e,t,i,r=null){let n=[];n._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(i[e],e,n,t,r)},o.$.prototype._cascadeLoadImgs=function(e,t,i,r,n=null,s){let a=[];a._internalCount=0;for(let o=0;o<6;o++)this._partialLoadImg(r[o],o,a,e,t,i,n,s)},o.$.prototype._partialLoadImg=function(e,t,i,r,n,o,l=null,u){let h=(0,a.z)();(0,s.W$)(e,e=>{i[t]=e,i._internalCount++,r&&r.removePendingData(h),6===i._internalCount&&o&&o(n,i)},(e,t)=>{r&&r.removePendingData(h),l&&l(e,t)},r?r.offlineProvider:null,u),r&&r.addPendingData(h)},o.$.prototype.createCubeTextureBase=function(e,t,i,s,a=null,o=null,h,c=null,d=!1,p=0,f=0,_=null,m=null,g=null,b=!1,y=null){let x=_||new r.h(this,7);x.isCube=!0,x.url=e,x.generateMipMaps=!s,x._lodGenerationScale=p,x._lodGenerationOffset=f,x._useSRGBBuffer=!!b&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!s),x!==_&&(x.label=e.substring(0,60)),this._doNotHandleContextLost||(x._extension=c,x._files=i,x._buffer=y);let T=e;this._transformTextureUrl&&!_&&(e=this._transformTextureUrl(e));let v=c??(0,u.r)(e),A=(0,l.gT)(v),S=(e,t)=>{x.dispose(),o?o(e,t):e&&n.V.Warn(e)},E=(r,o)=>{e===T?r&&S(r.status+" "+r.statusText,o):(n.V.Warn(`Failed to load ${e}, falling back to the ${T}`),this.createCubeTextureBase(T,t,i,!!s,a,S,h,c,d,p,f,x,m,g,b,y))};if(A)A.then(r=>{let n=e=>{m&&m(x,e),r.loadCubeData(e,x,d,a,(e,t)=>{S(e,t)})};y?n(y):i&&6===i.length?r.supportCascades?this._cascadeLoadFiles(t,e=>n(e.map(e=>new Uint8Array(e))),i,S):S("Textures type does not support cascades."):this._loadFile(e,e=>n(new Uint8Array(e)),void 0,t?t.offlineProvider||null:void 0,!0,E)});else{if(!i||0===i.length)throw Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,x,(e,t)=>{g&&g(e,t)},i,S)}return this._internalTexturesCache.push(x),x}},52653(e,t,i){var r=i(87201);r.$.prototype.getInputElement=function(){return this._renderingCanvas},r.$.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},r.$.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},r.$.prototype.getAspectRatio=function(e,t=!1){let i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},r.$.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},r.$.prototype._verifyPointerLock=function(){this._onPointerLockChange?.()}},69670(e,t,i){i(87201).$.prototype._loadFileAsync=async function(e,t,i){return await new Promise((r,n)=>{this._loadFile(e,e=>{r(e)},void 0,t,i,(e,t)=>{n(t)})})}},75034(e,t,i){var r=i(77629),n=i(87201);n.$.prototype.displayLoadingUI=function(){if(!(0,r.BA)())return;let e=this.loadingScreen;e&&e.displayLoadingUI()},n.$.prototype.hideLoadingUI=function(){if(!(0,r.BA)())return;let e=this._loadingScreen;e&&e.hideLoadingUI()},Object.defineProperty(n.$.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=n.$.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.$.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.$.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0})},77738(e,t,i){i.d(t,{W:()=>s});var r=i(31804),n=i(87201);class s{constructor(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=r.u.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=r.u.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE,this.forceRenderingWhenOccluded=!1}}n.$.prototype.createQuery=function(){return null},n.$.prototype.deleteQuery=function(e){return this},n.$.prototype.isQueryResultAvailable=function(e){return!1},n.$.prototype.getQueryResult=function(e){return 0},n.$.prototype.beginOcclusionQuery=function(e,t){return!1},n.$.prototype.endOcclusionQuery=function(e){return this},Object.defineProperty(r.u.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(e){this._occlusionDataStorage.isOcclusionQueryInProgress=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.u.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new s),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(r.u.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(e){this._occlusionDataStorage.isOccluded=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.u.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(e){this._occlusionDataStorage.occlusionQueryAlgorithmType=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.u.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(e){this._occlusionDataStorage.occlusionType=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.u.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(e){this._occlusionDataStorage.occlusionRetryCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.u.prototype,"forceRenderingWhenOccluded",{get:function(){return this._occlusionDataStorage.forceRenderingWhenOccluded},set:function(e){this._occlusionDataStorage.forceRenderingWhenOccluded=e},enumerable:!0,configurable:!0}),r.u.prototype._checkOcclusionQuery=function(){let e=this._occlusionDataStorage;if(e.occlusionType===r.u.OCCLUSION_TYPE_NONE)return e.isOccluded=!1,!1;let t=this.getEngine();if(!t.getCaps().supportOcclusionQuery||!t.isQueryResultAvailable)return e.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&null!==this._occlusionQuery&&void 0!==this._occlusionQuery)if(t.isQueryResultAvailable(this._occlusionQuery)){let i=t.getQueryResult(this._occlusionQuery);e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=!(i>0)}else{if(e.occlusionInternalRetryCounter++,-1===e.occlusionRetryCount||!(e.occlusionInternalRetryCounter>e.occlusionRetryCount))return e.occlusionType!==r.u.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded;e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=e.occlusionType!==r.u.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded}let i=this.getScene();if(i.getBoundingBoxRenderer){let r=i.getBoundingBoxRenderer();null===this._occlusionQuery&&(this._occlusionQuery=t.createQuery()),this._occlusionQuery&&t.beginOcclusionQuery(e.occlusionQueryAlgorithmType,this._occlusionQuery)&&(r.renderOcclusionBoundingBox(this),t.endOcclusionQuery(e.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0)}return e.isOccluded}},27125(e,t,i){var r=i(87201);r.$.prototype.getRenderPassNames=function(){return this._renderPassNames},r.$.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},r.$.prototype.createRenderPassId=function(e){let t=++r.$._RenderPassIdCounter;return this._renderPassNames[t]=e??"NONAME",t},r.$.prototype.releaseRenderPassId=function(e){this._renderPassNames[e]=void 0;for(let t=0;t<this.scenes.length;++t){let i=this.scenes[t];for(let t=0;t<i.meshes.length;++t){let r=i.meshes[t];if(r.subMeshes)for(let t=0;t<r.subMeshes.length;++t)r.subMeshes[t]._removeDrawWrapper(e)}}}},93430(e,t,i){var r=i(87201);i(69646),r.$.prototype.getInputElement=function(){return this._renderingCanvas},r.$.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},r.$.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},r.$.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},r.$.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},r.$.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},r.$.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},r.$.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},r.$.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},r.$.prototype.setAlphaConstants=function(e,t,i,r){this._alphaState.setAlphaBlendConstants(e,t,i,r)},r.$.prototype.getAlphaMode=function(e=0){return this._alphaMode[e]},r.$.prototype.getAlphaEquation=function(e=0){return this._alphaEquation[e]}},38170(e,t,i){var r=i(87201);i(69646),r.$.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},r.$.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},r.$.prototype.getStencilMask=function(){return this._stencilState.stencilMask},r.$.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},r.$.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},r.$.prototype.getStencilBackFunction=function(){return this._stencilState.stencilBackFunc},r.$.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},r.$.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},r.$.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},r.$.prototype.setStencilBackFunction=function(e){this._stencilState.stencilBackFunc=e},r.$.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},r.$.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},r.$.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},r.$.prototype.getStencilBackOperationFail=function(){return this._stencilState.stencilBackOpStencilFail},r.$.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},r.$.prototype.getStencilBackOperationDepthFail=function(){return this._stencilState.stencilBackOpDepthFail},r.$.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},r.$.prototype.getStencilBackOperationPass=function(){return this._stencilState.stencilBackOpStencilDepthPass},r.$.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},r.$.prototype.setStencilBackOperationFail=function(e){this._stencilState.stencilBackOpStencilFail=e},r.$.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},r.$.prototype.setStencilBackOperationDepthFail=function(e){this._stencilState.stencilBackOpDepthFail=e},r.$.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},r.$.prototype.setStencilBackOperationPass=function(e){this._stencilState.stencilBackOpStencilDepthPass=e},r.$.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},r.$.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)}},32173(e,t,i){i(87201).$.prototype.createDepthStencilTexture=function(e,t,i){if(!t.isCube)return this._createDepthStencilTexture(e,t,i);{let i=e.width||e;return this._createDepthStencilCubeTexture(i,t)}}},58797(e,t,i){var r=i(49211);i(87201).$.GetCompatibleTextureLoader=r.gT},35289(e,t,i){var r=i(87201),n=i(9711);r.$.prototype.getGPUFrameTimeCounter=function(){return this._gpuFrameTime||(this._gpuFrameTime=new n.A),this._gpuFrameTime},r.$.prototype.captureGPUFrameTime=function(e){}},25430(e,t,i){i(23808).ThinEngine.prototype.setAlphaMode=function(e,t=!1,i=0){if(this._alphaMode[i]===e){if(!t){let t=0===e;this.depthCullingState.depthMask!==t&&(this.depthCullingState.depthMask=t)}return}let r=0===e;this._alphaState.setAlphaBlend(!r,i),this._alphaState.setAlphaMode(e,i),t||(this.depthCullingState.depthMask=r),this._alphaMode[i]=e}},18946(e,t,i){var r=i(23808),n=i(53805),s=i(31656),a=i(78598);r.ThinEngine.prototype._createDepthStencilCubeTexture=function(e,t){let i=new n.h(this,12);if(i.isCube=!0,1===this.webGLVersion)return s.V.Error("Depth cube texture is not supported by WebGL 1."),i;let r={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t},a=this._gl;this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,i,!0),this._setupDepthStencilTexture(i,e,r.bilinearFiltering,r.comparisonFunction);for(let t=0;t<6;t++)r.generateStencil?a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,a.DEPTH24_STENCIL8,e,e,0,a.DEPTH_STENCIL,a.UNSIGNED_INT_24_8,null):a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,a.DEPTH_COMPONENT24,e,e,0,a.DEPTH_COMPONENT,a.UNSIGNED_INT,null);return this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(i),i},r.ThinEngine.prototype._setCubeMapTextureParams=function(e,t,i){let r=this._gl;r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),e.samplingMode=t?3:2,t&&this.getCaps().textureMaxLevel&&void 0!==i&&i>0&&(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAX_LEVEL,i),e._maxLodLevel=i),this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null)},r.ThinEngine.prototype.createCubeTexture=function(e,t,i,r,n=null,o=null,l,u=null,h=!1,c=0,d=0,p=null,f,_=!1,m=null){let g=this._gl;return this.createCubeTextureBase(e,t,i,!!r,n,o,l,u,h,c,d,p,e=>this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,e,!0),(e,t)=>{let i=this.needPOTTextures?(0,a.R)(t[0].width,this._caps.maxCubemapTextureSize):t[0].width,o=[g.TEXTURE_CUBE_MAP_POSITIVE_X,g.TEXTURE_CUBE_MAP_POSITIVE_Y,g.TEXTURE_CUBE_MAP_POSITIVE_Z,g.TEXTURE_CUBE_MAP_NEGATIVE_X,g.TEXTURE_CUBE_MAP_NEGATIVE_Y,g.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(!1);let u=l?this._getInternalFormat(l,e._useSRGBBuffer):e._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:g.RGBA,h=l?this._getInternalFormat(l):g.RGBA;e._useSRGBBuffer&&1===this.webGLVersion&&(h=u);for(let e=0;e<o.length;e++)if(t[e].width!==i||t[e].height!==i){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void s.V.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=i,this._workingCanvas.height=i,this._workingContext.drawImage(t[e],0,0,t[e].width,t[e].height,0,0,i,i),g.texImage2D(o[e],0,u,h,g.UNSIGNED_BYTE,this._workingCanvas)}else g.texImage2D(o[e],0,u,h,g.UNSIGNED_BYTE,t[e]);r||g.generateMipmap(g.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(e,!r),e.width=i,e.height=i,e.isReady=!0,l&&(e.format=l),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),n&&n()},!!_,m)},r.ThinEngine.prototype.generateMipMapsForCubemap=function(e,t=!0){if(e.generateMipMaps){let i=this._gl;this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),i.generateMipmap(i.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)}}},26069(e,t,i){var r=i(23808);r.ThinEngine.prototype.updateDynamicIndexBuffer=function(e,t,i=0){let r;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),r=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},r.ThinEngine.prototype.updateDynamicVertexBuffer=function(e,t,i,r){this.bindArrayBuffer(e),void 0===i&&(i=0);let n=t.byteLength||t.length;void 0===r||r>=n&&0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t).subarray(0,r/4)):(t=t instanceof ArrayBuffer?new Uint8Array(t,0,r):new Uint8Array(t.buffer,t.byteOffset,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t)),this._resetVertexBufferBinding()}},99688(e,t,i){var r=i(78598),n=i(23808),s=i(53805);n.ThinEngine.prototype.createDynamicTexture=function(e,t,i,n){let a=new s.h(this,4);return a.baseWidth=e,a.baseHeight=t,i&&(e=this.needPOTTextures?(0,r.R)(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?(0,r.R)(t,this._caps.maxTextureSize):t),a.width=e,a.height=t,a.isReady=!1,a.generateMipMaps=i,a.samplingMode=n,this.updateTextureSamplingMode(n,a),this._internalTexturesCache.push(a),a},n.ThinEngine.prototype.updateDynamicTexture=function(e,t,i,r=!1,n,s=!1,a=!1){if(!e)return;let o=this._gl,l=o.TEXTURE_2D,u=this._bindTextureDirectly(l,e,!0,s);this._unpackFlipY(void 0===i?e.invertY:i),r&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);let h=this._getWebGLTextureType(e.type),c=this._getInternalFormat(n||e.format),d=this._getRGBABufferInternalSizedFormat(e.type,c);o.texImage2D(l,0,d,c,h,t),e.generateMipMaps&&o.generateMipmap(l),u||this._bindTextureDirectly(l,null),r&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),n&&(e.format=n),e._dynamicTextureSource=t,e._premulAlpha=r,e.invertY=i||!1,e.isReady=!0}},67043(e,t,i){i.r(t);var r=i(53805),n=i(31656),s=i(23808);s.ThinEngine.prototype.restoreSingleAttachment=function(){let e=this._gl;this.bindAttachments([e.BACK])},s.ThinEngine.prototype.restoreSingleAttachmentForRenderTarget=function(){let e=this._gl;this.bindAttachments([e.COLOR_ATTACHMENT0])},s.ThinEngine.prototype.buildTextureLayout=function(e,t=!1){let i=this._gl,r=[];if(t)r.push(i.BACK);else for(let t=0;t<e.length;t++)e[t]?r.push(i["COLOR_ATTACHMENT"+t]):r.push(i.NONE);return r},s.ThinEngine.prototype.bindAttachments=function(e){this._gl.drawBuffers(e)},s.ThinEngine.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t=!1,i){this._currentRenderTarget=null,e.disableAutomaticMSAAResolve||this.resolveMultiFramebuffer(e),t||this.generateMipMapsMultiFramebuffer(e),i&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),i()),this._bindUnboundFramebuffer(null)},s.ThinEngine.prototype.createMultipleRenderTarget=function(e,t,i=!0){let s,a=!1,o=!0,l=!1,u=!1,h=1,c=1,d=[],p=[],f=[],_=[],m=[],g=[],b=[],y=[],x=[],T=!1,v=this._createHardwareRenderTargetWrapper(!0,!1,e);void 0!==t&&(a=void 0!==t.generateMipMaps&&t.generateMipMaps,o=void 0===t.generateDepthBuffer||t.generateDepthBuffer,l=void 0!==t.generateStencilBuffer&&t.generateStencilBuffer,u=void 0!==t.generateDepthTexture&&t.generateDepthTexture,h=t.textureCount??1,c=t.samples??c,d=t.types||d,p=t.samplingModes||p,f=t.useSRGBBuffers||f,_=t.formats||_,m=t.targetTypes||m,g=t.faceIndex||g,b=t.layerIndex||b,y=t.layerCounts||y,x=t.labels||x,T=t.dontCreateTextures??!1,this.webGLVersion>1&&(13===t.depthTextureFormat||17===t.depthTextureFormat||16===t.depthTextureFormat||14===t.depthTextureFormat||18===t.depthTextureFormat)&&(s=t.depthTextureFormat)),void 0===s&&(s=l?13:14);let A=this._gl,S=this._currentFramebuffer,E=A.createFramebuffer();this._bindUnboundFramebuffer(E);let I=e.width??e,R=e.height??e,P=[],M=[],C=this.webGLVersion>1&&(13===s||17===s||18===s);v.label=t?.label??"MultiRenderTargetWrapper",v._framebuffer=E,v._generateDepthBuffer=u||o,v._generateStencilBuffer=u?C:l,v._depthStencilBuffer=this._setupFramebufferDepthAttachments(v._generateStencilBuffer,v._generateDepthBuffer,I,R,1,s),v._attachments=M;for(let e=0;e<h;e++){let t=p[e]||3,i=d[e]||0,s=f[e]||!1,o=_[e]||5,l=m[e]||3553,u=y[e]??1;(1!==i||this._caps.textureFloatLinearFiltering)&&(2!==i||this._caps.textureHalfFloatLinearFiltering)||(t=1);let h=this._getSamplingParameters(t,a);1!==i||this._caps.textureFloat||(i=0,n.V.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),s=s&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU);let c=this.webGLVersion>1,g=A[c?"COLOR_ATTACHMENT"+e:"COLOR_ATTACHMENT"+e+"_WEBGL"];if(M.push(g),-1===l||T)continue;let b=new r.h(this,6);P[e]=b,A.activeTexture(A["TEXTURE"+e]),A.bindTexture(l,b._hardwareTexture.underlyingResource),A.texParameteri(l,A.TEXTURE_MAG_FILTER,h.mag),A.texParameteri(l,A.TEXTURE_MIN_FILTER,h.min),A.texParameteri(l,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(l,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);let S=this._getRGBABufferInternalSizedFormat(i,o,s),E=this._getInternalFormat(o),C=this._getWebGLTextureType(i);if(c&&(35866===l||32879===l))35866===l?b.is2DArray=!0:b.is3D=!0,b.baseDepth=b.depth=u,A.texImage3D(l,0,S,I,R,u,0,E,C,null);else if(34067===l){for(let e=0;e<6;e++)A.texImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,I,R,0,E,C,null);b.isCube=!0}else A.texImage2D(A.TEXTURE_2D,0,S,I,R,0,E,C,null);a&&A.generateMipmap(l),this._bindTextureDirectly(l,null),b.baseWidth=I,b.baseHeight=R,b.width=I,b.height=R,b.isReady=!0,b.samples=1,b.generateMipMaps=a,b.samplingMode=t,b.type=i,b._useSRGBBuffer=s,b.format=o,b.label=x[e]??v.label+"-Texture"+e,this._internalTexturesCache.push(b)}if(u&&this._caps.depthTextureExtension&&!T){let e=new r.h(this,14),t=5,i=A.DEPTH_COMPONENT16,n=A.DEPTH_COMPONENT,o=A.UNSIGNED_SHORT,l=A.DEPTH_ATTACHMENT;this.webGLVersion<2?i=A.DEPTH_COMPONENT:14===s?(t=1,o=A.FLOAT,i=A.DEPTH_COMPONENT32F):18===s?(t=0,o=A.FLOAT_32_UNSIGNED_INT_24_8_REV,i=A.DEPTH32F_STENCIL8,n=A.DEPTH_STENCIL,l=A.DEPTH_STENCIL_ATTACHMENT):16===s?(t=0,o=A.UNSIGNED_INT,i=A.DEPTH_COMPONENT24,l=A.DEPTH_ATTACHMENT):(13===s||17===s)&&(t=12,o=A.UNSIGNED_INT_24_8,i=A.DEPTH24_STENCIL8,n=A.DEPTH_STENCIL,l=A.DEPTH_STENCIL_ATTACHMENT),this._bindTextureDirectly(A.TEXTURE_2D,e,!0),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texImage2D(A.TEXTURE_2D,0,i,I,R,0,n,o,null),A.framebufferTexture2D(A.FRAMEBUFFER,l,A.TEXTURE_2D,e._hardwareTexture.underlyingResource,0),this._bindTextureDirectly(A.TEXTURE_2D,null),v._depthStencilTexture=e,v._depthStencilTextureWithStencil=C,e.baseWidth=I,e.baseHeight=R,e.width=I,e.height=R,e.isReady=!0,e.samples=1,e.generateMipMaps=a,e.samplingMode=1,e.format=s,e.type=t,e.label=v.label+"-DepthStencil",P[h]=e,this._internalTexturesCache.push(e)}if(v.setTextures(P),i&&A.drawBuffers(M),this._bindUnboundFramebuffer(S),v.setLayerAndFaceIndices(b,g),this.resetTextureCache(),T){if(c>1){let e=A.createFramebuffer();if(!e)throw Error("Unable to create multi sampled framebuffer");v._samples=c,v._MSAAFramebuffer=e,h>0&&i&&(this._bindUnboundFramebuffer(e),A.drawBuffers(M),this._bindUnboundFramebuffer(S))}}else this.updateMultipleRenderTargetTextureSampleCount(v,c,i);return v},s.ThinEngine.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t,i=!0){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;let r=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(r.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(r.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null);let n=e._attachments.length;for(let t=0;t<n;t++){let i=e.textures[t]._hardwareTexture;i?.releaseMSAARenderBuffers()}if(t>1&&"function"==typeof r.renderbufferStorageMultisample){let s=r.createFramebuffer();if(!s)throw Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=s,this._bindUnboundFramebuffer(s);let a=[];for(let i=0;i<n;i++){let n=e.textures[i],s=n._hardwareTexture,o=r[this.webGLVersion>1?"COLOR_ATTACHMENT"+i:"COLOR_ATTACHMENT"+i+"_WEBGL"],l=this._createRenderBuffer(n.width,n.height,t,-1,this._getRGBABufferInternalSizedFormat(n.type,n.format,n._useSRGBBuffer),o);if(!l)throw Error("Unable to create multi sampled framebuffer");s.addMSAARenderBuffer(l),n.samples=t,a.push(o)}i&&r.drawBuffers(a)}else this._bindUnboundFramebuffer(e._framebuffer);let s=e._depthStencilTexture?e._depthStencilTexture.format:void 0;return e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t,s),this._bindUnboundFramebuffer(null),e._samples=t,t},s.ThinEngine.prototype.generateMipMapsMultiFramebuffer=function(e){let t=this._gl;if(e.isMulti)for(let i=0;i<e._attachments.length;i++){let r=e.textures[i];!r?.generateMipMaps||r?.isCube||r?.is3D||(this._bindTextureDirectly(t.TEXTURE_2D,r,!0),t.generateMipmap(t.TEXTURE_2D),this._bindTextureDirectly(t.TEXTURE_2D,null))}},s.ThinEngine.prototype.resolveMultiFramebuffer=function(e){let t=this._gl;if(!e._MSAAFramebuffer||!e.isMulti)return;let i=e.resolveMSAAColors?t.COLOR_BUFFER_BIT:0;i|=e._generateDepthBuffer&&e.resolveMSAADepth?t.DEPTH_BUFFER_BIT:0,i|=e._generateStencilBuffer&&e.resolveMSAAStencil?t.STENCIL_BUFFER_BIT:0;let r=e._attachments,n=r.length;t.bindFramebuffer(t.READ_FRAMEBUFFER,e._MSAAFramebuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e._framebuffer);for(let s=0;s<n;s++){let a=e.textures[s];for(let e=0;e<n;e++)r[e]=t.NONE;r[s]=t[this.webGLVersion>1?"COLOR_ATTACHMENT"+s:"COLOR_ATTACHMENT"+s+"_WEBGL"],t.readBuffer(r[s]),t.drawBuffers(r),t.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,i,t.NEAREST)}for(let e=0;e<n;e++)r[e]=t[this.webGLVersion>1?"COLOR_ATTACHMENT"+e:"COLOR_ATTACHMENT"+e+"_WEBGL"];t.drawBuffers(r),t.bindFramebuffer(this._gl.FRAMEBUFFER,e._MSAAFramebuffer)}},75470(e,t,i){var r=i(26623),n=i(42555),s=i(9633),a=i(53805),o=i(70134),l=i(61882),u=i(36276),h=i(20515);function c(e,t,i){let r=new l.D(e,void 0,!0,t,void 0,i);return r.addUniform("viewProjection",16),r.addUniform("viewProjectionR",16),r.addUniform("view",16),r.addUniform("projection",16),r.addUniform("vEyePosition",4),r}n.N.prototype.createMultiviewRenderTargetTexture=function(e,t,i,r){let n=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";let s=this._createHardwareRenderTargetWrapper(!1,!1,{width:e,height:t});s._framebuffer=n.createFramebuffer();let o=new a.h(this,0,!0);return o.width=e,o.height=t,o.isMultiview=!0,i||(i=n.createTexture(),n.bindTexture(n.TEXTURE_2D_ARRAY,i),n.texStorage3D(n.TEXTURE_2D_ARRAY,1,n.RGBA8,e,t,2)),s._colorTextureArray=i,r||(r=n.createTexture(),n.bindTexture(n.TEXTURE_2D_ARRAY,r),n.texStorage3D(n.TEXTURE_2D_ARRAY,1,n.DEPTH24_STENCIL8,e,t,2)),s._depthStencilTextureArray=r,o.isReady=!0,s.setTextures(o),s._depthStencilTexture=o,s},n.N.prototype.bindMultiviewFramebuffer=function(e){let t=this._gl,i=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(e,void 0,void 0,void 0,!0),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e._framebuffer),e._colorTextureArray&&e._depthStencilTextureArray)this.getCaps().oculusMultiview?(i.framebufferTextureMultisampleMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,e._colorTextureArray,0,e.samples,0,2),i.framebufferTextureMultisampleMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,e._depthStencilTextureArray,0,e.samples,0,2)):(i.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,e._colorTextureArray,0,0,2),i.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,e._depthStencilTextureArray,0,0,2));else throw"Invalid multiview frame buffer"},n.N.prototype.bindSpaceWarpFramebuffer=function(e){let t=this._gl,i=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(e,void 0,void 0,void 0,!0),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e._framebuffer),e._colorTextureArray&&e._depthStencilTextureArray)i.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,e._colorTextureArray,0,0,2),i.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_ATTACHMENT,e._depthStencilTextureArray,0,0,2);else throw Error("Invalid Space Warp framebuffer")},r.i.prototype._useMultiviewToSingleView=!1,r.i.prototype._multiviewTexture=null,r.i.prototype._resizeOrCreateMultiviewTexture=function(e,t){this._multiviewTexture?(this._multiviewTexture.getRenderWidth()!=e||this._multiviewTexture.getRenderHeight()!=t)&&(this._multiviewTexture.dispose(),this._multiviewTexture=new u.c(this.getScene(),{width:e,height:t})):this._multiviewTexture=new u.c(this.getScene(),{width:e,height:t})};let d=s.Z.prototype.createSceneUniformBuffer;s.Z.prototype._transformMatrixR=o.uq.Zero(),s.Z.prototype._multiviewSceneUbo=null,s.Z.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=c(this.getEngine(),"scene_multiview")},s.Z.prototype.createSceneUniformBuffer=function(e,t){return this._multiviewSceneUbo?c(this.getEngine(),e,t):d.bind(this)(e,t)},s.Z.prototype._updateMultiviewUbo=function(e,t){e&&t&&e.multiplyToRef(t,this._transformMatrixR),e&&t&&(e.multiplyToRef(t,o.AA.Matrix["0"]),h.P.GetRightPlaneToRef(o.AA.Matrix["0"],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.updateMatrix("projection",this._projectionMatrix))},s.Z.prototype._renderMultiviewToSingleView=function(e){e._resizeOrCreateMultiviewTexture(e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.width>0?e._rigPostProcess.width:this.getEngine().getRenderWidth(!0),e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.height>0?e._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),e.outputRenderTarget=e._multiviewTexture,this._renderForCamera(e),e.outputRenderTarget=null;for(let t=0;t<e._rigCameras.length;t++){let i=this.getEngine();this._activeCamera=e._rigCameras[t],i.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}}},98454(e,t,i){var r=i(23808),n=i(53805),s=i(31656),a=i(13468),o=i(12797);r.ThinEngine.prototype.createPrefilteredCubeTexture=function(e,t,r,l,u=null,h=null,c,d=null,p=!0){let f=async e=>{if(!e){u&&u(null);return}let h=e.texture;if(p?e.info.sphericalPolynomial&&(h._sphericalPolynomial=e.info.sphericalPolynomial):h._sphericalPolynomial=h._sphericalPolynomial??new a.Q,h._source=9,this.getCaps().textureLOD){u&&u(h);return}let c=this._gl,d=e.width;if(!d)return;let{DDSTools:f}=await Promise.resolve().then(i.bind(i,97319)),_=[];for(let i=0;i<3;i++){let a=Math.log2(d)*r+l,u=Math.round(Math.min(Math.max(l+(a-l)*(1-i/2),0),a)),p=new n.h(this,2);if(p.type=h.type,p.format=h.format,p.width=Math.pow(2,Math.max(Math.log2(d)-u,0)),p.height=p.width,p.isCube=!0,p._cachedWrapU=0,p._cachedWrapV=0,this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,p,!0),p.samplingMode=2,c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),e.isDDS){let t=e.info,i=e.data;this._unpackFlipY(t.isCompressed),f.UploadDDSLevels(this,p,i,t,!0,6,u)}else s.V.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null);let m=new o.t(t);m._isCube=!0,m._texture=p,p.isReady=!0,_.push(m)}h._lodTextureHigh=_[2],h._lodTextureMid=_[1],h._lodTextureLow=_[0],u&&u(h)};return this.createCubeTexture(e,t,null,!1,f,h,c,d,p,r,l)}},57218(e,t,i){var r=i(23808),n=i(31804),s=i(43166);i(35289),i(77738),r.ThinEngine.prototype.createQuery=function(){let e=this._gl.createQuery();if(!e)throw Error("Unable to create Occlusion Query");return e},r.ThinEngine.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this},r.ThinEngine.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)},r.ThinEngine.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)},r.ThinEngine.prototype.beginOcclusionQuery=function(e,t){let i=this._getGlAlgorithmType(e);return this._gl.beginQuery(i,t),!0},r.ThinEngine.prototype.endOcclusionQuery=function(e){let t=this._getGlAlgorithmType(e);return this._gl.endQuery(t),this},r.ThinEngine.prototype._createTimeQuery=function(){let e=this.getCaps().timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()},r.ThinEngine.prototype._deleteTimeQuery=function(e){let t=this.getCaps().timerQuery;t.deleteQueryEXT?t.deleteQueryEXT(e):this.deleteQuery(e)},r.ThinEngine.prototype._getTimeQueryResult=function(e){let t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT):this.getQueryResult(e)},r.ThinEngine.prototype._getTimeQueryAvailability=function(e){let t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)},r.ThinEngine.prototype.startTimeQuery=function(){let e=this.getCaps(),t=e.timerQuery;if(!t)return null;let i=new s.e;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),e.canUseTimestampForTimerQuery)i._startTimeQuery=this._createTimeQuery(),i._startTimeQuery&&t.queryCounterEXT(i._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;i._timeElapsedQuery=this._createTimeQuery(),i._timeElapsedQuery&&(t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,i._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,i._timeElapsedQuery)),this._currentNonTimestampToken=i}return i},r.ThinEngine.prototype.endTimeQuery=function(e){let t=this.getCaps(),i=t.timerQuery;if(!i||!e)return -1;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return -1;!e._endTimeQuery&&(e._endTimeQuery=this._createTimeQuery(),e._endTimeQuery&&i.queryCounterEXT(e._endTimeQuery,i.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return -1;i.endQueryEXT?i.endQueryEXT(i.TIME_ELAPSED_EXT):(this._gl.endQuery(i.TIME_ELAPSED_EXT),this._currentNonTimestampToken=null),e._timeElapsedQueryEnded=!0}let r=this._gl.getParameter(i.GPU_DISJOINT_EXT),n=!1;if(e._endTimeQuery?n=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(n=this._getTimeQueryAvailability(e._timeElapsedQuery)),n&&!r){let i=0;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return -1;let t=this._getTimeQueryResult(e._startTimeQuery);i=this._getTimeQueryResult(e._endTimeQuery)-t,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return -1;i=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1}return i}return -1},r.ThinEngine.prototype.captureGPUFrameTime=function(e){if(e!==this._captureGPUFrameTime)if(this._captureGPUFrameTime=e,e){let e=this.getGPUFrameTimeCounter();this._onBeginFrameObserver=this.onBeginFrameObservable.add(()=>{this._gpuFrameTimeToken||(this._gpuFrameTimeToken=this.startTimeQuery())}),this._onEndFrameObserver=this.onEndFrameObservable.add(()=>{if(!this._gpuFrameTimeToken)return;let t=this.endTimeQuery(this._gpuFrameTimeToken);t>-1&&(this._gpuFrameTimeToken=null,e.fetchNewFrame(),e.addCount(t,!0))})}else this.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null},r.ThinEngine.prototype._getGlAlgorithmType=function(e){return e===n.u.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED}},55541(e,t,i){var r=i(53805),n=i(31656),s=i(23808),a=i(78598);function o(e,t,i,r){let n,s=1;1===r?n=new Float32Array(t*i*4):2===r?(n=new Uint16Array(t*i*4),s=15360):n=7===r?new Uint32Array(t*i*4):new Uint8Array(t*i*4);for(let r=0;r<t;r++)for(let a=0;a<i;a++){let i=(a*t+r)*3,o=(a*t+r)*4;n[o+0]=e[i+0],n[o+1]=e[i+1],n[o+2]=e[i+2],n[o+3]=s}return n}function l(e){return function(t,i,n,s,a,o,l,u,h=null,c=0){let d=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,p=new r.h(this,e?10:11);p.baseWidth=i,p.baseHeight=n,p.baseDepth=s,p.width=i,p.height=n,p.depth=s,p.format=a,p.type=c,p.generateMipMaps=o,p.samplingMode=u,e?p.is3D=!0:p.is2DArray=!0,this._doNotHandleContextLost||(p._bufferView=t),e?this.updateRawTexture3D(p,t,a,l,h,c):this.updateRawTexture2DArray(p,t,a,l,h,c),this._bindTextureDirectly(d,p,!0);let f=this._getSamplingParameters(u,o);return this._gl.texParameteri(d,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(d,this._gl.TEXTURE_MIN_FILTER,f.min),o&&this._gl.generateMipmap(d),this._bindTextureDirectly(d,null),this._internalTexturesCache.push(p),p}}function u(e){return function(t,i,r,n,s=null,a=0){let o=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,l=this._getWebGLTextureType(a),u=this._getInternalFormat(r),h=this._getRGBABufferInternalSizedFormat(a,r);this._bindTextureDirectly(o,t,!0),this._unpackFlipY(void 0===n||!!n),this._doNotHandleContextLost||(t._bufferView=i,t.format=r,t.invertY=n,t._compression=s),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),s&&i?this._gl.compressedTexImage3D(o,0,this.getCaps().s3tc[s],t.width,t.height,t.depth,0,i):this._gl.texImage3D(o,0,h,t.width,t.height,t.depth,0,u,l,i),t.generateMipMaps&&this._gl.generateMipmap(o),this._bindTextureDirectly(o,null),t.isReady=!0}}s.ThinEngine.prototype.updateRawTexture=function(e,t,i,r,n=null,s=0,a=!1){if(!e)return;let o=this._getRGBABufferInternalSizedFormat(s,i,a),l=this._getInternalFormat(i),u=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===r||!!r),this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.type=s,e.invertY=r,e._compression=n),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),n&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[n],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,e.width,e.height,0,l,u,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0},s.ThinEngine.prototype.createRawTexture=function(e,t,i,n,s,a,o,l=null,u=0,h=0,c=!1){let d=new r.h(this,3);d.baseWidth=t,d.baseHeight=i,d.width=t,d.height=i,d.format=n,d.generateMipMaps=s,d.samplingMode=o,d.invertY=a,d._compression=l,d.type=u,d._useSRGBBuffer=this._getUseSRGBBuffer(c,!s),this._doNotHandleContextLost||(d._bufferView=e),this.updateRawTexture(d,e,n,a,l,u,d._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,d,!0);let p=this._getSamplingParameters(o,s);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,p.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,p.min),s&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(d),d},s.ThinEngine.prototype.createRawCubeTexture=function(e,t,i,s,o,l,u,h=null){let c=this._gl,d=new r.h(this,8);d.isCube=!0,d.format=i,d.type=s,this._doNotHandleContextLost||(d._bufferViewArray=e);let p=this._getWebGLTextureType(s),f=this._getInternalFormat(i);if(f===c.RGB&&(f=c.RGBA),p!==c.FLOAT||this._caps.textureFloatLinearFiltering?p!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?p!==c.FLOAT||this._caps.textureFloatRender?p!==c.HALF_FLOAT||this._caps.colorBufferFloat||(o=!1,n.V.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(o=!1,n.V.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(o=!1,u=1,n.V.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(o=!1,u=1,n.V.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")),d.width=t,d.height=t,d.invertY=l,d._compression=h,!this.needPOTTextures||(0,a.L8)(d.width)&&(0,a.L8)(d.height)||(o=!1),e)this.updateRawCubeTexture(d,e,i,s,l,h);else{let e=this._getRGBABufferInternalSizedFormat(s);this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,d,!0);for(let t=0;t<6;t++)h?c.compressedTexImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.getCaps().s3tc[h],d.width,d.height,0,void 0):c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e,d.width,d.height,0,f,p,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,d,!0),e&&o&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);let _=this._getSamplingParameters(u,o);return c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,_.mag),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,_.min),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null),d.generateMipMaps=o,d.samplingMode=u,d.isReady=!0,d},s.ThinEngine.prototype.updateRawCubeTexture=function(e,t,i,r,n,s=null,l=0){e._bufferViewArray=t,e.format=i,e.type=r,e.invertY=n,e._compression=s;let u=this._gl,h=this._getWebGLTextureType(r),c=this._getInternalFormat(i),d=this._getRGBABufferInternalSizedFormat(r),p=!1;c===u.RGB&&(c=u.RGBA,p=!0),this._bindTextureDirectly(u.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===n||!!n),e.width%4!=0&&u.pixelStorei(u.UNPACK_ALIGNMENT,1);for(let i=0;i<6;i++){let n=t[i];s?u.compressedTexImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+i,l,this.getCaps().s3tc[s],e.width,e.height,0,n):(p&&(n=o(n,e.width,e.height,r)),u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+i,l,d,e.width,e.height,0,c,h,n))}(!this.needPOTTextures||(0,a.L8)(e.width)&&(0,a.L8)(e.height))&&e.generateMipMaps&&0===l&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},s.ThinEngine.prototype.createRawCubeTextureFromUrl=function(e,t,i,r,n,s,a,l,u=null,h=null,c=3,d=!1){let p=this._gl,f=this.createRawCubeTexture(null,i,r,n,!s,d,c,null);t?.addPendingData(f),f.url=e,f.isReady=!1,this._internalTexturesCache.push(f);let _=(e,i)=>{t?.removePendingData(f),h&&e&&h(e.status+" "+e.statusText,i)},m=async e=>{if(!f._hardwareTexture)return;let i=a(e);if(!i)return;let s=i instanceof Promise?await i:i,h=f.width;if(l){let e=this._getWebGLTextureType(n),t=this._getInternalFormat(r),i=this._getRGBABufferInternalSizedFormat(n),a=!1;t===p.RGB&&(t=p.RGBA,a=!0),this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,f,!0),this._unpackFlipY(!1);let u=l(s);for(let r=0;r<u.length;r++){let s=h>>r;for(let l=0;l<6;l++){let h=u[r][l];a&&(h=o(h,s,s,n)),p.texImage2D(l,r,i,s,s,0,t,e,h)}}this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(f,s,r,n,d);f.isReady=!0,t?.removePendingData(f),f.onLoadedObservable.notifyObservers(f),f.onLoadedObservable.clear(),u&&u()};return this._loadFile(e,e=>{m(e).catch(e=>{_(void 0,e)})},void 0,t?.offlineProvider,!0,_),f},s.ThinEngine.prototype.createRawTexture2DArray=l(!1),s.ThinEngine.prototype.createRawTexture3D=l(!0),s.ThinEngine.prototype.updateRawTexture2DArray=u(!1),s.ThinEngine.prototype.updateRawTexture3D=u(!0)},87537(e,t,i){i.d(t,{k:()=>n.kZ});var r=i(23808),n=i(91178);r.ThinEngine.prototype._readTexturePixelsSync=function(e,t,i,r=-1,s=0,a=null,o=!0,l=!1,u=0,h=0){let c=this._gl;if(!c)throw Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){let e=c.createFramebuffer();if(!e)throw Error("Unable to create dummy framebuffer");this._dummyFramebuffer=e}c.bindFramebuffer(c.FRAMEBUFFER,this._dummyFramebuffer),r>-1?c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+r,e._hardwareTexture?.underlyingResource,s):c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,e._hardwareTexture?.underlyingResource,s);let d=void 0!==e.type?this._getWebGLTextureType(e.type):c.UNSIGNED_BYTE;return l?a||(a=(0,n.kZ)(e.type,4*t*i)):d===c.UNSIGNED_BYTE?(a||(a=new Uint8Array(4*t*i)),d=c.UNSIGNED_BYTE):(a||(a=new Float32Array(4*t*i)),d=c.FLOAT),o&&this.flushFramebuffer(),c.readPixels(u,h,t,i,c.RGBA,d,a),c.bindFramebuffer(c.FRAMEBUFFER,this._currentFramebuffer),a},r.ThinEngine.prototype._readTexturePixels=function(e,t,i,r=-1,n=0,s=null,a=!0,o=!1,l=0,u=0){return Promise.resolve(this._readTexturePixelsSync(e,t,i,r,n,s,a,o,l,u))}},12537(e,t,i){var r=i(53805),n=i(31656),s=i(23808),a=i(13565),o=i(25569);class l extends a.v{setDepthStencilTexture(e,t=!0){if(super.setDepthStencilTexture(e,t),!e)return;let i=this._engine,r=this._context,n=e._hardwareTexture;if(n&&e._autoMSAAManagement&&this._MSAAFramebuffer){let t=i._currentFramebuffer;i._bindUnboundFramebuffer(this._MSAAFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,(0,o.$l)(e.format)?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,r.RENDERBUFFER,n.getMSAARenderBuffer()),i._bindUnboundFramebuffer(t)}}constructor(e,t,i,r,n){super(e,t,i,r),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=n}_cloneRenderTargetWrapper(){let e=null;return this._colorTextureArray&&this._depthStencilTextureArray?(e=this._engine.createMultiviewRenderTargetTexture(this.width,this.height)).texture.isReady=!0:e=super._cloneRenderTargetWrapper(),e}_swapRenderTargetWrapper(e){super._swapRenderTargetWrapper(e),e._framebuffer=this._framebuffer,e._depthStencilBuffer=this._depthStencilBuffer,e._MSAAFramebuffer=this._MSAAFramebuffer,e._colorTextureArray=this._colorTextureArray,e._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(e=0,t=!0,i=!1,r=1,n=14,s){if(this._depthStencilBuffer){let e=this._engine,t=e._currentFramebuffer,i=this._context;e._bindUnboundFramebuffer(this._framebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,null),e._bindUnboundFramebuffer(t),i.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(e,t,i,r,n,s)}shareDepth(e){super.shareDepth(e);let t=this._context,i=this._depthStencilBuffer,r=e._MSAAFramebuffer||e._framebuffer,n=this._engine;e._depthStencilBuffer&&e._depthStencilBuffer!==i&&t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=i;let s=e._generateStencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;n._bindUnboundFramebuffer(r),t.framebufferRenderbuffer(t.FRAMEBUFFER,s,t.RENDERBUFFER,i),n._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(e,t=0,i,r=0){let n,s=e._hardwareTexture;if(!s)return;let a=this._framebuffer,o=this._engine,l=o._currentFramebuffer;if(o._bindUnboundFramebuffer(a),o.webGLVersion>1){let a=this._context;n=a["COLOR_ATTACHMENT"+t],e.is2DArray||e.is3D?(i=i??this.layerIndices?.[t]??0,a.framebufferTextureLayer(a.FRAMEBUFFER,n,s.underlyingResource,r,i)):e.isCube?(i=i??this.faceIndices?.[t]??0,a.framebufferTexture2D(a.FRAMEBUFFER,n,a.TEXTURE_CUBE_MAP_POSITIVE_X+i,s.underlyingResource,r)):a.framebufferTexture2D(a.FRAMEBUFFER,n,a.TEXTURE_2D,s.underlyingResource,r)}else{let e=this._context;n=e["COLOR_ATTACHMENT"+t+"_WEBGL"];let a=void 0!==i?e.TEXTURE_CUBE_MAP_POSITIVE_X+i:e.TEXTURE_2D;e.framebufferTexture2D(e.FRAMEBUFFER,n,a,s.underlyingResource,r)}if(e._autoMSAAManagement&&this._MSAAFramebuffer){let e=this._context;o._bindUnboundFramebuffer(this._MSAAFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,s.getMSAARenderBuffer())}o._bindUnboundFramebuffer(l)}setTexture(e,t=0,i=!0){super.setTexture(e,t,i),this._bindTextureRenderTarget(e,t)}setLayerAndFaceIndices(e,t){if(super.setLayerAndFaceIndices(e,t),!this.textures||!this.layerIndices||!this.faceIndices)return;let i=this._attachments?.length??this.textures.length;for(let e=0;e<i;e++){let t=this.textures[e];t&&(t.is2DArray||t.is3D?this._bindTextureRenderTarget(t,e,this.layerIndices[e]):t.isCube?this._bindTextureRenderTarget(t,e,this.faceIndices[e]):this._bindTextureRenderTarget(t,e))}}setLayerAndFaceIndex(e=0,t,i){if(super.setLayerAndFaceIndex(e,t,i),!this.textures||!this.layerIndices||!this.faceIndices)return;let r=this.textures[e];r.is2DArray||r.is3D?this._bindTextureRenderTarget(this.textures[e],e,this.layerIndices[e]):r.isCube&&this._bindTextureRenderTarget(this.textures[e],e,this.faceIndices[e])}resolveMSAATextures(){let e=this._engine,t=e._currentFramebuffer;e._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),e._bindUnboundFramebuffer(t)}dispose(e=this._disposeOnlyFramebuffers){let t=this._context;!e&&(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(t.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(t.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(t.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(e)}}i(32173),s.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(e,t,i){let r=new l(e,t,i,this,this._gl);return this._renderTargetWrapperCache.push(r),r},s.ThinEngine.prototype.createRenderTargetTexture=function(e,t){let i,r,n=this._createHardwareRenderTargetWrapper(!1,!1,e),s=!0,a=!1,o=!1,l=1;void 0!==t&&"object"==typeof t&&(s=t.generateDepthBuffer??!0,a=!!t.generateStencilBuffer,o=!!t.noColorAttachment,i=t.colorAttachment,l=t.samples??1,r=t.label);let u=i||(o?null:this._createInternalTexture(e,t,!0,5)),h=e.width||e,c=e.height||e,d=this._currentFramebuffer,p=this._gl,f=p.createFramebuffer();if(this._bindUnboundFramebuffer(f),n._depthStencilBuffer=this._setupFramebufferDepthAttachments(a,s,h,c),!u||u.is2DArray||u.is3D||p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,u._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(d),n.label=r??"RenderTargetWrapper",n._framebuffer=f,n._generateDepthBuffer=s,n._generateStencilBuffer=a,n.setTextures(u),i){if(n._samples=i.samples,i.samples>1){let e=i._hardwareTexture.getMSAARenderBuffer(0);n._MSAAFramebuffer=p.createFramebuffer(),this._bindUnboundFramebuffer(n._MSAAFramebuffer),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.RENDERBUFFER,e),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(n,l);return n},s.ThinEngine.prototype._createDepthStencilTexture=function(e,t,i){let s=this._gl,a=e.layers||0,l=e.depth||0,u=s.TEXTURE_2D;0!==a?u=s.TEXTURE_2D_ARRAY:0!==l&&(u=s.TEXTURE_3D);let h=new r.h(this,12);if(h.label=t.label,!this._caps.depthTextureExtension)return n.V.Error("Depth texture is not supported by your browser or hardware."),h;let c={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t};if(this._bindTextureDirectly(u,h,!0),this._setupDepthStencilTexture(h,e,0!==c.comparisonFunction&&c.bilinearFiltering,c.comparisonFunction,c.samples),void 0!==c.depthTextureFormat){if(15!==c.depthTextureFormat&&16!==c.depthTextureFormat&&17!==c.depthTextureFormat&&13!==c.depthTextureFormat&&14!==c.depthTextureFormat&&18!==c.depthTextureFormat)return n.V.Error(`Depth texture ${c.depthTextureFormat} format is not supported.`),h;h.format=c.depthTextureFormat}else h.format=c.generateStencil?13:16;let d=(0,o.$l)(h.format),p=this._getWebGLTextureTypeFromDepthTextureFormat(h.format),f=d?s.DEPTH_STENCIL:s.DEPTH_COMPONENT,_=this._getInternalFormatFromDepthTextureFormat(h.format,!0,d);return h.is2DArray?s.texImage3D(u,0,_,h.width,h.height,a,0,f,p,null):h.is3D?s.texImage3D(u,0,_,h.width,h.height,l,0,f,p,null):s.texImage2D(u,0,_,h.width,h.height,0,f,p,null),this._bindTextureDirectly(u,null),this._internalTexturesCache.push(h),i._depthStencilBuffer&&(s.deleteRenderbuffer(i._depthStencilBuffer),i._depthStencilBuffer=null),this._bindUnboundFramebuffer(i._MSAAFramebuffer??i._framebuffer),i._generateStencilBuffer=d,i._depthStencilTextureWithStencil=d,i._depthStencilBuffer=this._setupFramebufferDepthAttachments(i._generateStencilBuffer,i._generateDepthBuffer,i.width,i.height,i.samples,h.format),this._bindUnboundFramebuffer(null),h},s.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;let i=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(i.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(i.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null);let r=e.texture?._hardwareTexture;if(r?.releaseMSAARenderBuffers(),e.texture&&t>1&&"function"==typeof i.renderbufferStorageMultisample){let n=i.createFramebuffer();if(!n)throw Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=n,this._bindUnboundFramebuffer(e._MSAAFramebuffer);let s=this._createRenderBuffer(e.texture.width,e.texture.height,t,-1,this._getRGBABufferInternalSizedFormat(e.texture.type,e.texture.format,e.texture._useSRGBBuffer),i.COLOR_ATTACHMENT0,!1);if(!s)throw Error("Unable to create multi sampled framebuffer");r?.addMSAARenderBuffer(s)}this._bindUnboundFramebuffer(e._MSAAFramebuffer??e._framebuffer),e.texture&&(e.texture.samples=t),e._samples=t;let n=e._depthStencilTexture?e._depthStencilTexture.format:void 0;return e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t,n),this._bindUnboundFramebuffer(null),t},s.ThinEngine.prototype._setupDepthStencilTexture=function(e,t,i,r,n=1){let s=t.width??t,a=t.height??t,o=t.layers||0,l=t.depth||0;e.baseWidth=s,e.baseHeight=a,e.width=s,e.height=a,e.is2DArray=o>0,e.depth=o||l,e.isReady=!0,e.samples=n,e.generateMipMaps=!1,e.samplingMode=i?2:1,e.type=0,e._comparisonFunction=r;let u=this._gl,h=this._getTextureTarget(e),c=this._getSamplingParameters(e.samplingMode,!1);u.texParameteri(h,u.TEXTURE_MAG_FILTER,c.mag),u.texParameteri(h,u.TEXTURE_MIN_FILTER,c.min),u.texParameteri(h,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(h,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===r?(u.texParameteri(h,u.TEXTURE_COMPARE_FUNC,515),u.texParameteri(h,u.TEXTURE_COMPARE_MODE,u.NONE)):(u.texParameteri(h,u.TEXTURE_COMPARE_FUNC,r),u.texParameteri(h,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE)))}},85508(e,t,i){var r=i(53805),n=i(31656);i(23808).ThinEngine.prototype.createRenderTargetCubeTexture=function(e,t){let i=this._createHardwareRenderTargetWrapper(!1,!0,e),s={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...t};s.generateStencilBuffer=s.generateDepthBuffer&&s.generateStencilBuffer,(1!==s.type||this._caps.textureFloatLinearFiltering)&&(2!==s.type||this._caps.textureHalfFloatLinearFiltering)||(s.samplingMode=1);let a=this._gl,o=new r.h(this,5);this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,o,!0);let l=this._getSamplingParameters(s.samplingMode,s.generateMipMaps);1!==s.type||this._caps.textureFloat||(s.type=0,n.V.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,l.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,l.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);for(let t=0;t<6;t++)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this._getRGBABufferInternalSizedFormat(s.type,s.format),e,e,0,this._getInternalFormat(s.format),this._getWebGLTextureType(s.type),null);let u=a.createFramebuffer();return this._bindUnboundFramebuffer(u),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(s.generateStencilBuffer,s.generateDepthBuffer,e,e),s.generateMipMaps&&a.generateMipmap(a.TEXTURE_CUBE_MAP),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),i._framebuffer=u,i._generateDepthBuffer=s.generateDepthBuffer,i._generateStencilBuffer=s.generateStencilBuffer,o.width=e,o.height=e,o.isReady=!0,o.isCube=!0,o.samples=1,o.generateMipMaps=s.generateMipMaps,o.samplingMode=s.samplingMode,o.type=s.type,o.format=s.format,this._internalTexturesCache.push(o),i.setTextures(o),i}},88814(e,t,i){i(23808).ThinEngine.prototype.setDepthStencilTexture=function(e,t,i,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0,r):this._setTexture(e,null,void 0,void 0,r))}},65653(e,t,i){i.d(t,{P:()=>n});var r=i(42555),n=!0;r.N.prototype.createTransformFeedback=function(){let e=this._gl.createTransformFeedback();if(!e)throw Error("Unable to create Transform Feedback");return e},r.N.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},r.N.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},r.N.prototype.beginTransformFeedback=function(e=!0){this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},r.N.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},r.N.prototype.setTranformFeedbackVaryings=function(e,t){this._gl.transformFeedbackVaryings(e,t,this._gl.INTERLEAVED_ATTRIBS)},r.N.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e?e.underlyingResource:null)},r.N.prototype.readTransformFeedbackBuffer=function(e){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e)}},78072(e,t,i){var r=i(23808),n=i(73410);r.ThinEngine.prototype.createUniformBuffer=function(e,t){let i=this._gl.createBuffer();if(!i)throw Error("Unable to create uniform buffer");let r=new n.A(i);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},r.ThinEngine.prototype.createDynamicUniformBuffer=function(e,t){let i=this._gl.createBuffer();if(!i)throw Error("Unable to create dynamic uniform buffer");let r=new n.A(i);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},r.ThinEngine.prototype.updateUniformBuffer=function(e,t,i,r){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===r?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+r)),this.bindUniformBuffer(null)},r.ThinEngine.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},r.ThinEngine.prototype.bindUniformBufferBase=function(e,t,i){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},r.ThinEngine.prototype.bindUniformBlock=function(e,t,i){let r=e.program,n=this._gl.getUniformBlockIndex(r,t);0xffffffff!==n&&this._gl.uniformBlockBinding(r,n,i)}},36306(e,t,i){i(23808).ThinEngine.prototype.updateVideoTexture=function(e,t,i){if(!e||e._isDisabled)return;let r=this._getInternalFormat(e.format),n=this._getRGBABufferInternalSizedFormat(0,e.format),s=this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0);this._unpackFlipY(!i);try{if(void 0===this._videoTextureSupported&&(this._gl.getError(),this._gl.texImage2D(this._gl.TEXTURE_2D,0,n,r,this._gl.UNSIGNED_BYTE,t),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,n,r,this._gl.UNSIGNED_BYTE,t);else{if(!e._workingCanvas){e._workingCanvas=this.createCanvas(e.width,e.height);let t=e._workingCanvas.getContext("2d");if(!t)throw Error("Unable to get 2d context");e._workingContext=t,e._workingCanvas.width=e.width,e._workingCanvas.height=e.height}e._workingContext.clearRect(0,0,e.width,e.height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e.width,e.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,n,r,this._gl.UNSIGNED_BYTE,e._workingCanvas)}e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),s||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}catch(t){e._isDisabled=!0}}},62123(e,t,i){i.d(t,{kZ:()=>o.k,BJ:()=>n,Ph:()=>a.P}),i(25430);var r,n,s=i(87201);s.$.prototype._debugPushGroup=function(e){},s.$.prototype._debugPopGroup=function(){},s.$.prototype._debugInsertMarker=function(e){},i(57218);var a=i(65653);i(75470),i(55541),i(99688),i(36306),i(67043),i(18946),i(98454),i(12537),i(85508),i(88814),i(78072),i(26069);var o=i(87537),l=i(23808);(r=n||(n={}))[r.Texture=0]="Texture",r[r.StorageTexture=1]="StorageTexture",r[r.UniformBuffer=2]="UniformBuffer",r[r.StorageBuffer=3]="StorageBuffer",r[r.TextureWithoutSampler=4]="TextureWithoutSampler",r[r.Sampler=5]="Sampler",r[r.ExternalTexture=6]="ExternalTexture",r[r.DataBuffer=7]="DataBuffer",r[r.InternalTexture=8]="InternalTexture",l.ThinEngine.prototype.createComputeEffect=function(e,t){throw Error("createComputeEffect: This engine does not support compute shaders!")},l.ThinEngine.prototype.createComputePipelineContext=function(){throw Error("createComputePipelineContext: This engine does not support compute shaders!")},l.ThinEngine.prototype.createComputeContext=function(){},l.ThinEngine.prototype.computeDispatch=function(e,t,i,r,n,s,a){throw Error("computeDispatch: This engine does not support compute shaders!")},l.ThinEngine.prototype.computeDispatchIndirect=function(e,t,i,r,n,s){throw Error("computeDispatchIndirect: This engine does not support compute shaders!")},l.ThinEngine.prototype.areAllComputeEffectsReady=function(){return!0},l.ThinEngine.prototype.releaseComputeEffects=function(){},l.ThinEngine.prototype._prepareComputePipelineContext=function(e,t,i,r,n){},l.ThinEngine.prototype._rebuildComputeEffects=function(){},s.$.prototype._executeWhenComputeStateIsCompiled=function(e,t){t(null)},l.ThinEngine.prototype._releaseComputeEffect=function(e){},l.ThinEngine.prototype._deleteComputePipelineContext=function(e){};var u=i(42555);function h(e){if(this._excludedCompressedTextures&&this._excludedCompressedTextures.some(t=>e&&(e===t||e.match(RegExp("\\b"+t+"\\b","g")))))return e;let t=e.lastIndexOf("."),i=e.lastIndexOf("?"),r=i>-1?e.substring(i,e.length):"";return(t>-1?e.substring(0,t):e)+this._textureFormatInUse+r}Object.defineProperty(u.N.prototype,"texturesSupported",{get:function(){let e=[];return this._caps.astc&&e.push("-astc.ktx"),this._caps.s3tc&&e.push("-dxt.ktx"),this._caps.pvrtc&&e.push("-pvrtc.ktx"),this._caps.etc2&&e.push("-etc2.ktx"),this._caps.etc1&&e.push("-etc1.ktx"),e},enumerable:!0,configurable:!0}),Object.defineProperty(u.N.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse||null},enumerable:!0,configurable:!0}),u.N.prototype.setCompressedTextureExclusions=function(e){this._excludedCompressedTextures=e},u.N.prototype.setTextureFormatToUse=function(e){let t=this.texturesSupported;for(let i=0,r=t.length;i<r;i++)for(let r=0,n=e.length;r<n;r++)if(t[i]===e[r].toLowerCase())return this._transformTextureUrl=h.bind(this),this._textureFormatInUse=t[i];return this._textureFormatInUse="",this._transformTextureUrl=null,null}},33442(e,t,i){i.d(t,{n:()=>r});class r{constructor(){this.shaderLanguage=0}postProcessor(e,t,i,r,n){return n.drawBuffersExtensionDisabled&&(e=e.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")),e}}},74713(e,t,i){var r=i(87201);i(69646);var n=i(9572);n.M.prototype.setAlphaMode=function(e,t=!1,i=0){let r=this._alphaState._alphaBlend[i];if(this._alphaMode[i]===e&&(0===e&&!r||0!==e&&r)){if(!t){let t=0===e;this.depthCullingState.depthMask!==t&&(this.setDepthWrite(t),this._cacheRenderPipeline.setDepthWriteEnabled(t))}return}let n=0===e;this._alphaState.setAlphaBlend(!n,i),this._alphaState.setAlphaMode(e,i),t||(this.setDepthWrite(n),this._cacheRenderPipeline.setDepthWriteEnabled(n)),this._alphaMode[i]=e,this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState._alphaBlend,this._alphaState._numTargetEnabled),this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters)},n.M.prototype.setAlphaEquation=function(e,t=0){r.$.prototype.setAlphaEquation.call(this,e,t),this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters)}},25045(e,t,i){var r=i(53805),n=i(75337),s=i(9572);s.M.prototype._createDepthStencilCubeTexture=function(e,t){let i=new r.h(this,t.generateStencil?12:14);i.isCube=!0,i.label=t.label;let s={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,samples:1,depthTextureFormat:t.generateStencil?13:14,...t};i.format=s.depthTextureFormat,this._setupDepthStencilTexture(i,e,s.bilinearFiltering,s.comparisonFunction,s.samples),this._textureHelper.createGPUTextureForInternalTexture(i);let a=i._hardwareTexture;return i.type=n.m.GetTextureTypeFromFormat(a.format),this._internalTexturesCache.push(i),i},s.M.prototype.createCubeTexture=function(e,t,i,r,n=null,s=null,a,o=null,l=!1,u=0,h=0,c=null,d,p=!1,f=null){return this.createCubeTextureBase(e,t,i,!!r,n,s,a,o,l,u,h,c,null,(e,t)=>{let i=t[0].width;this._setCubeMapTextureParams(e,!r),e.format=a??-1;let s=this._textureHelper.createGPUTextureForInternalTexture(e,i,i);this._textureHelper.updateCubeTextures(t,s.underlyingResource,i,i,s.format,!1,!1,0,0),r||this._generateMipmaps(e,this._uploadEncoder),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),n&&n()},!!p,f)},s.M.prototype._setCubeMapTextureParams=function(e,t,i){e.samplingMode=t?3:2,e._cachedWrapU=0,e._cachedWrapV=0,i&&(e._maxLodLevel=i)},s.M.prototype.generateMipMapsForCubemap=function(e){e.generateMipMaps&&(e._hardwareTexture?.underlyingResource||this._textureHelper.createGPUTextureForInternalTexture(e),this._generateMipmaps(e))}},41216(e,t,i){i.r(t);var r=i(53805),n=i(31656),s=i(47955);s.$.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t=!1,i){i&&i(),this._endCurrentRenderPass(),e.disableAutomaticMSAAResolve||this.resolveMultiFramebuffer(e,!1),t||this.generateMipMapsMultiFramebuffer(e),this._currentRenderTarget=null,this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)},s.$.prototype.createMultipleRenderTarget=function(e,t,i){let s=!1,a=!0,o=!1,l=!1,u=15,h=1,c=1,d=[],p=[],f=[],_=[],m=[],g=[],b=[],y=[],x=[],T=[],v=!1,A=this._createHardwareRenderTargetWrapper(!0,!1,e);void 0!==t&&(s=t.generateMipMaps??!1,a=t.generateDepthBuffer??!0,o=t.generateStencilBuffer??!1,l=t.generateDepthTexture??!1,h=t.textureCount??1,u=t.depthTextureFormat??15,d=t.types||d,p=t.samplingModes||p,f=t.useSRGBBuffers||f,_=t.formats||_,m=t.targetTypes||m,g=t.faceIndex||g,b=t.layerIndex||b,y=t.layerCounts||y,x=t.labels||x,T=t.creationFlags||T,c=t.samples??c,v=t.dontCreateTextures??!1);let S=e.width??e,E=e.height??e,I=[],R=[],P=[];A.label=t?.label??"MultiRenderTargetWrapper",A._generateDepthBuffer=a,A._generateStencilBuffer=o,A._attachments=R,A._defaultAttachments=P;let M=null;(a||o||l)&&!v&&(l||(u=a&&o?13:a?14:19),M=A.createDepthStencilTexture(0,!1,o,1,u,A.label+"-DepthStencil"));let C=void 0!==t&&"object"==typeof t&&t.createMipMaps&&!s;for(let e=0;e<h;e++){let t=p[e]||3,a=d[e]||0,o=_[e]||5,l=(f[e]||!1)&&this._caps.supportSRGBBuffers,u=m[e]||3553,h=y[e]??1,c=T[e];if((1!==a||this._caps.textureFloatLinearFiltering)&&(2!==a||this._caps.textureHalfFloatLinearFiltering)||(t=1),1!==a||this._caps.textureFloat||(a=0,n.V.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),R.push(e+1),P.push(i?e+1:+(0===e)),-1===u||v)continue;let g=new r.h(this,6);switch(I[e]=g,u){case 34067:g.isCube=!0;break;case 32879:g.is3D=!0,g.baseDepth=g.depth=h;break;case 35866:g.is2DArray=!0,g.baseDepth=g.depth=h}g.baseWidth=S,g.baseHeight=E,g.width=S,g.height=E,g.isReady=!0,g.samples=1,g.generateMipMaps=s,g.samplingMode=t,g.type=a,g._cachedWrapU=0,g._cachedWrapV=0,g._useSRGBBuffer=l,g.format=o,g.label=x[e]??A.label+"-Texture"+e,this._internalTexturesCache.push(g),C&&(g.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(g,void 0,void 0,void 0,c),C&&(g.generateMipMaps=!1)}return M&&(M.incrementReferences(),I[h]=M,this._internalTexturesCache.push(M)),A.setTextures(I),A.setLayerAndFaceIndices(b,g),v?A._samples=c:this.updateMultipleRenderTargetTextureSampleCount(A,c),A},s.$.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(!e||!e.textures||0===e.textures.length||e.textures[0].samples===t)return t;let i=e.textures.length;if(0===i)return 1;t=Math.min(t,this.getCaps().maxMSAASamples);for(let t=0;t<i;++t){let i=e.textures[t]._hardwareTexture;i?.releaseMSAATextures()}for(let r=0;r<i;++r)e.textures[r].samples=t;return e._depthStencilTexture&&(e._depthStencilTexture.samples=t),e._samples=t,t},s.$.prototype.generateMipMapsMultiFramebuffer=function(e){if(!e.isMulti)return;let t=e._attachments.length;for(let i=0;i<t;i++){let t=e.textures[i];!t.generateMipMaps||t.isCube||t.is3D||this._generateMipmaps(t)}},s.$.prototype.resolveMultiFramebuffer=function(e,t=!0){this.resolveFramebuffer(e,t)},s.$.prototype.bindAttachments=function(e){0!==e.length&&this._currentRenderTarget&&(this._mrtAttachments=e,this._currentRenderPass&&this._cacheRenderPipeline.setMRTAttachments(e))},s.$.prototype.buildTextureLayout=function(e,t=!1){let i=[];if(t)i.push(1);else for(let t=0;t<e.length;t++)e[t]?i.push(t+1):i.push(0);return i},s.$.prototype.restoreSingleAttachment=function(){},s.$.prototype.restoreSingleAttachmentForRenderTarget=function(){}},92053(e,t,i){var r=i(9572),n=i(13144);i(77738),r.M.prototype.getGPUFrameTimeCounter=function(){return this._timestampQuery.gpuFrameTimeCounter},r.M.prototype.captureGPUFrameTime=function(e){this._timestampQuery.enable=e&&!!this._caps.timerQuery},r.M.prototype.createQuery=function(){return this._occlusionQuery.createQuery()},r.M.prototype.deleteQuery=function(e){return this._occlusionQuery.deleteQuery(e),this},r.M.prototype.isQueryResultAvailable=function(e){return this._occlusionQuery.isQueryResultAvailable(e)},r.M.prototype.getQueryResult=function(e){return this._occlusionQuery.getQueryResult(e)},r.M.prototype.beginOcclusionQuery=function(e,t){return this.compatibilityMode?!!this._occlusionQuery.canBeginQuery(t)&&(this._currentRenderPass?.beginOcclusionQuery(t),!0):(this._bundleList.addItem(new n.KS(t)),!0)},r.M.prototype.endOcclusionQuery=function(){return this.compatibilityMode?this._currentRenderPass?.endOcclusionQuery():this._bundleList.addItem(new n.c7),this}},60784(e,t,i){var r=i(53805),n=i(31656),s=i(9572);function a(e,t,i,r){let n,s=1;1===r?n=new Float32Array(t*i*4):2===r?(n=new Uint16Array(t*i*4),s=15360):n=7===r?new Uint32Array(t*i*4):new Uint8Array(t*i*4);for(let r=0;r<t;r++)for(let a=0;a<i;a++){let i=(a*t+r)*3,o=(a*t+r)*4;n[o+0]=e[i+0],n[o+1]=e[i+1],n[o+2]=e[i+2],n[o+3]=s}return n}s.M.prototype.createRawTexture=function(e,t,i,n,s,a,o,l=null,u=0,h=0,c=!1){let d=new r.h(this,3);return d.baseWidth=t,d.baseHeight=i,d.width=t,d.height=i,d.format=n,d.generateMipMaps=s,d.samplingMode=o,d.invertY=a,d._compression=l,d.type=u,d._creationFlags=h,d._useSRGBBuffer=c,this._doNotHandleContextLost||(d._bufferView=e),this._textureHelper.createGPUTextureForInternalTexture(d,t,i,void 0,h),this.updateRawTexture(d,e,n,a,l,u,c),this._internalTexturesCache.push(d),d},s.M.prototype.updateRawTexture=function(e,t,i,r,n=null,s=0,o=!1){if(e){if(this._doNotHandleContextLost||(e._bufferView=t,e.invertY=r,e._compression=n,e._useSRGBBuffer=o),t){let n=e._hardwareTexture;4===i&&(t=a(t,e.width,e.height,s));let o=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(o,e,e.width,e.height,e.depth,n.format,0,0,r,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder)}e.isReady=!0}},s.M.prototype.createRawCubeTexture=function(e,t,i,s,a,o,l,u=null){let h=new r.h(this,8);return 1!==s||this._caps.textureFloatLinearFiltering?2!==s||this._caps.textureHalfFloatLinearFiltering?1!==s||this._caps.textureFloatRender?2!==s||this._caps.colorBufferFloat||(a=!1,n.V.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(a=!1,n.V.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(a=!1,l=1,n.V.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(a=!1,l=1,n.V.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")),h.isCube=!0,h._originalFormat=i,h.format=4===i?5:i,h.type=s,h.generateMipMaps=a,h.width=t,h.height=t,h.samplingMode=l,this._doNotHandleContextLost||(h._bufferViewArray=e),h.invertY=o,h._compression=u,h._cachedWrapU=0,h._cachedWrapV=0,this._textureHelper.createGPUTextureForInternalTexture(h),4===i&&(h._hardwareTexture._originalFormatIsRGB=!0),e&&this.updateRawCubeTexture(h,e,i,s,o,u),h.isReady=!0,h},s.M.prototype.updateRawCubeTexture=function(e,t,i,r,n,s=null){e._bufferViewArray=t,e.invertY=n,e._compression=s;let o=e._hardwareTexture,l=o._originalFormatIsRGB,u=[0,2,4,1,3,5],h=[];for(let i=0;i<t.length;++i){let n=t[u[i]];l&&(n=a(n,e.width,e.height,r)),h.push(new Uint8Array(n.buffer,n.byteOffset,n.byteLength))}this._textureHelper.updateCubeTextures(h,o.underlyingResource,e.width,e.height,o.format,n,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder),e.isReady=!0},s.M.prototype.createRawCubeTextureFromUrl=function(e,t,i,r,n,s,o,l,u=null,h=null,c=3,d=!1){let p=this.createRawCubeTexture(null,i,r,n,!s,d,c,null);t?.addPendingData(p),p.url=e,p.isReady=!1,this._internalTexturesCache.push(p);let f=(e,i)=>{t?.removePendingData(p),h&&e&&h(e.status+" "+e.statusText,i)},_=async e=>{let i=o(e);if(!i)return;let s=i instanceof Promise?await i:i,h=p.width;if(l){let e=4===r,t=l(s),i=p._hardwareTexture,o=[0,1,2,3,4,5];for(let r=0;r<t.length;r++){let s=h>>r,l=[];for(let i=0;i<6;i++){let u=t[r][o[i]];e&&(u=a(u,s,s,n)),l.push(new Uint8Array(u.buffer,u.byteOffset,u.byteLength))}this._textureHelper.updateCubeTextures(l,i.underlyingResource,s,s,i.format,d,!1,0,0)}}else this.updateRawCubeTexture(p,s,r,n,d);p.isReady=!0,t?.removePendingData(p),u&&u()};return this._loadFile(e,e=>{_(e).catch(e=>{f(void 0,e)})},void 0,t?.offlineProvider,!0,f),p},s.M.prototype.createRawTexture3D=function(e,t,i,n,s,a,o,l,u=null,h=0,c=0){let d=new r.h(this,10);return d.baseWidth=t,d.baseHeight=i,d.baseDepth=n,d.width=t,d.height=i,d.depth=n,d.format=s,d.type=h,d.generateMipMaps=a,d.samplingMode=l,d.is3D=!0,d._creationFlags=c,this._doNotHandleContextLost||(d._bufferView=e),this._textureHelper.createGPUTextureForInternalTexture(d,t,i,void 0,c),this.updateRawTexture3D(d,e,s,o,u,h),this._internalTexturesCache.push(d),d},s.M.prototype.updateRawTexture3D=function(e,t,i,r,n=null,s=0){if(this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.invertY=r,e._compression=n),t){let n=e._hardwareTexture;4===i&&(t=a(t,e.width,e.height,s));let o=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(o,e,e.width,e.height,e.depth,n.format,0,0,r,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder)}e.isReady=!0},s.M.prototype.createRawTexture2DArray=function(e,t,i,n,s,a,o,l,u=null,h=0,c=0){let d=new r.h(this,11);return d.baseWidth=t,d.baseHeight=i,d.baseDepth=n,d.width=t,d.height=i,d.depth=n,d.format=s,d.type=h,d.generateMipMaps=a,d.samplingMode=l,d.is2DArray=!0,d._creationFlags=c,this._doNotHandleContextLost||(d._bufferView=e),this._textureHelper.createGPUTextureForInternalTexture(d,t,i,n,c),this.updateRawTexture2DArray(d,e,s,o,u,h),this._internalTexturesCache.push(d),d},s.M.prototype.updateRawTexture2DArray=function(e,t,i,r,n=null,s=0){if(this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.invertY=r,e._compression=n),t){let n=e._hardwareTexture;4===i&&(t=a(t,e.width,e.height,s));let o=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(o,e,e.width,e.height,e.depth,n.format,0,0,r,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder)}e.isReady=!0}},79962(e,t,i){var r=i(9572);r.M.prototype._readTexturePixels=function(e,t,i,r=-1,n=0,s=null,a=!0,o=!1,l=0,u=0){let h=e._hardwareTexture;return a&&this.flushFramebuffer(),this._textureHelper.readPixels(h.underlyingResource,l,u,t,i,h.format,r,n,s,o)},r.M.prototype._readTexturePixelsSync=function(){throw"_readTexturePixelsSync is unsupported in WebGPU!"}},91664(e,t,i){var r=i(53805),n=i(95254),s=i(25569);i(32173);var a=i(9572);a.M.prototype._createHardwareRenderTargetWrapper=function(e,t,i){let r=new n.H(e,t,i,this);return this._renderTargetWrapperCache.push(r),r},a.M.prototype.createRenderTargetTexture=function(e,t){let i=this._createHardwareRenderTargetWrapper(!1,!1,e),r={};void 0!==t&&"object"==typeof t?(r.generateMipMaps=t.generateMipMaps,r.generateDepthBuffer=void 0===t.generateDepthBuffer||t.generateDepthBuffer,r.generateStencilBuffer=r.generateDepthBuffer&&t.generateStencilBuffer,r.samplingMode=void 0===t.samplingMode?3:t.samplingMode,r.creationFlags=t.creationFlags??0,r.noColorAttachment=!!t.noColorAttachment,r.colorAttachment=t.colorAttachment,r.samples=t.samples,r.label=t.label,r.format=t.format,r.type=t.type):(r.generateMipMaps=t,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.samplingMode=3,r.creationFlags=0,r.noColorAttachment=!1);let n=r.colorAttachment||(r.noColorAttachment?null:this._createInternalTexture(e,r,!0,5));return i.label=r.label??"RenderTargetWrapper",i._samples=r.colorAttachment?.samples??r.samples??1,i._generateDepthBuffer=r.generateDepthBuffer,i._generateStencilBuffer=!!r.generateStencilBuffer,i.setTextures(n),(i._generateDepthBuffer||i._generateStencilBuffer)&&i.createDepthStencilTexture(0,!1,i._generateStencilBuffer,i.samples,r.generateStencilBuffer?13:14,r.label?r.label+"-DepthStencil":void 0),n&&!r.colorAttachment&&(void 0!==t&&"object"==typeof t&&t.createMipMaps&&!r.generateMipMaps&&(n.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(n,void 0,void 0,void 0,r.creationFlags),void 0!==t&&"object"==typeof t&&t.createMipMaps&&!r.generateMipMaps&&(n.generateMipMaps=!1)),i},a.M.prototype._createDepthStencilTexture=function(e,t,i){let n={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,samples:1,depthTextureFormat:t.generateStencil?13:14,...t},a=(0,s.$l)(n.depthTextureFormat);i._depthStencilTextureWithStencil=a;let o=new r.h(this,a?12:14);return o.label=t.label,o.format=n.depthTextureFormat,o.type=(0,s.GX)(o.format),this._setupDepthStencilTexture(o,e,n.bilinearFiltering,n.comparisonFunction,n.samples),this._textureHelper.createGPUTextureForInternalTexture(o),this._internalTexturesCache.push(o),o},a.M.prototype._setupDepthStencilTexture=function(e,t,i,r,n=1){let s=t.width??t,a=t.height??t,o=t.layers||0,l=t.depth||0;e.baseWidth=s,e.baseHeight=a,e.width=s,e.height=a,e.is2DArray=o>0,e.is3D=l>0,e.depth=o||l,e.isReady=!0,e.samples=n,e.generateMipMaps=!1,e.samplingMode=i?2:1,e.type=1,e._comparisonFunction=r,e._cachedWrapU=0,e._cachedWrapV=0},a.M.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(!e||!e.texture||e.samples===t)return t;t=Math.min(t,this.getCaps().maxMSAASamples);let i=e.texture._hardwareTexture;return i?.releaseMSAATextures(),e._depthStencilTexture&&(e._depthStencilTexture._hardwareTexture?.releaseMSAATextures(),e._depthStencilTexture.samples=t),e._samples=t,e.texture.samples=t,t}},10217(e,t,i){var r=i(9572),n=i(53805);r.M.prototype.createRenderTargetCubeTexture=function(e,t){let i=this._createHardwareRenderTargetWrapper(!1,!0,e),r={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,samples:1,...t};r.generateStencilBuffer=r.generateDepthBuffer&&r.generateStencilBuffer,i.label=r.label??"RenderTargetWrapper",i._generateDepthBuffer=r.generateDepthBuffer,i._generateStencilBuffer=r.generateStencilBuffer;let s=new n.h(this,5);return s.width=e,s.height=e,s.depth=0,s.isReady=!0,s.isCube=!0,s.samples=r.samples,s.generateMipMaps=r.generateMipMaps,s.samplingMode=r.samplingMode,s.type=r.type,s.format=r.format,this._internalTexturesCache.push(s),i.setTextures(s),(i._generateDepthBuffer||i._generateStencilBuffer)&&i.createDepthStencilTexture(0,void 0===r.samplingMode||2===r.samplingMode||2===r.samplingMode||3===r.samplingMode||3===r.samplingMode||5===r.samplingMode||6===r.samplingMode||7===r.samplingMode||11===r.samplingMode,i._generateStencilBuffer,i.samples),t&&t.createMipMaps&&!r.generateMipMaps&&(s.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(s),t&&t.createMipMaps&&!r.generateMipMaps&&(s.generateMipMaps=!1),i}},43901(e,t,i){i(9572).M.prototype.setDepthStencilTexture=function(e,t,i,r){i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0,r):this._setTexture(e,null,void 0,void 0,r)}},44334(e,t,i){i(74713);var r=i(31656),n=i(38131),s=i(47955);class a{getBindGroups(e,t,i){if(!i)throw Error("WebGPUComputeContext.getBindGroups: bindingsMapping is required until browsers support reflection for wgsl shaders!");if(0===this._bindGroups.length){let n=this._bindGroupEntries.length>0;for(let t in e){let s=e[t],a=i[t],o=a.group,l=a.binding,u=s.type,h=s.object,c=s.indexInGroupEntries,d=this._bindGroupEntries[o];switch(!d&&(d=this._bindGroupEntries[o]=[]),u){case 5:void 0!==c&&n?d[c].resource=this._cacheSampler.getSampler(h):(s.indexInGroupEntries=d.length,d.push({binding:l,resource:this._cacheSampler.getSampler(h)}));break;case 0:case 4:{let e=h._texture._hardwareTexture;void 0!==c&&n?(0===u&&(d[c++].resource=this._cacheSampler.getSampler(h._texture)),d[c].resource=e.view):(s.indexInGroupEntries=d.length,0===u&&d.push({binding:l-1,resource:this._cacheSampler.getSampler(h._texture)}),d.push({binding:l,resource:e.view}));break}case 8:{let e=h._hardwareTexture;void 0!==c&&n?d[c].resource=e.view:(s.indexInGroupEntries=d.length,d.push({binding:l,resource:e.view}));break}case 1:{let e=h._texture._hardwareTexture;(8&e.textureAdditionalUsages)==0&&r.V.Error(`computeDispatch: The texture (name=${h.name}, uniqueId=${h.uniqueId}) is not a storage texture!`,50),void 0!==c&&n?d[c].resource=e.viewForWriting:(s.indexInGroupEntries=d.length,d.push({binding:l,resource:e.viewForWriting}));break}case 6:{let e=h.underlyingResource;void 0!==c&&n?d[c].resource=this._device.importExternalTexture({source:e}):(s.indexInGroupEntries=d.length,d.push({binding:l,resource:this._device.importExternalTexture({source:e})}));break}case 2:case 3:case 7:{let e=7===u?h:h.getBuffer(),t=e.underlyingResource;void 0!==c&&n?(d[c].resource.buffer=t,d[c].resource.size=e.capacity):(s.indexInGroupEntries=d.length,d.push({binding:l,resource:{buffer:t,offset:0,size:e.capacity}}))}}}for(let e=0;e<this._bindGroupEntries.length;++e){let i=this._bindGroupEntries[e];if(!i){this._bindGroups[e]=void 0;continue}this._bindGroups[e]=this._device.createBindGroup({layout:t.getBindGroupLayout(e),entries:i})}this._bindGroups.length=this._bindGroupEntries.length}return this._bindGroups}constructor(e,t){this._device=e,this._cacheSampler=t,this.uniqueId=a._Counter++,this._bindGroupEntries=[],this.clear()}clear(){this._bindGroups=[]}}a._Counter=0;class o{get isAsync(){return!1}get isReady(){return this.isAsync,!1}constructor(e){this._name="unnamed",this.engine=e}_getComputeShaderCode(){return this.sources?.compute}dispose(){}}let l={};s.$.prototype.createComputeContext=function(){return new a(this._device,this._cacheSampler)},s.$.prototype.createComputeEffect=function(e,t){let i=("string"==typeof e?e:e.computeToken||e.computeSource||e.computeElement||e.compute)+"@"+t.defines;if(this._compiledComputeEffects[i]){let e=this._compiledComputeEffects[i];return t.onCompiled&&e.isReady()&&t.onCompiled(e),e}let r=new n.B(e,t,this,i);return this._compiledComputeEffects[i]=r,r},s.$.prototype.createComputePipelineContext=function(){return new o(this)},s.$.prototype.areAllComputeEffectsReady=function(){for(let e in this._compiledComputeEffects)if(!this._compiledComputeEffects[e].isReady())return!1;return!0},s.$.prototype.computeDispatch=function(e,t,i,r,n=1,s=1,a,o){this._computeDispatch(e,t,i,r,n,s,void 0,void 0,a,o)},s.$.prototype.computeDispatchIndirect=function(e,t,i,r,n=0,s,a){this._computeDispatch(e,t,i,void 0,void 0,void 0,r,n,s,a)},s.$.prototype._computeDispatch=function(e,t,i,r,n,s,a,o,u,h){this._endCurrentRenderPass();let c=e._pipelineContext;c.computePipeline||(c.computePipeline=this._device.createComputePipeline({layout:"auto",compute:c.stage})),h&&this._timestampQuery.startPass(l,this._timestampIndex);let d=this._renderEncoder.beginComputePass(l);d.setPipeline(c.computePipeline);let p=t.getBindGroups(i,c.computePipeline,u);for(let e=0;e<p.length;++e){let t=p[e];t&&d.setBindGroup(e,t)}void 0!==a?d.dispatchWorkgroupsIndirect(a.underlyingResource,o):r+n+s>0&&d.dispatchWorkgroups(r,n,s),d.end(),h&&(this._timestampQuery.endPass(this._timestampIndex,h),this._timestampIndex+=2)},s.$.prototype.releaseComputeEffects=function(){for(let e in this._compiledComputeEffects){let t=this._compiledComputeEffects[e].getPipelineContext();this._deleteComputePipelineContext(t)}this._compiledComputeEffects={}},s.$.prototype._prepareComputePipelineContext=function(e,t,i,n,s){this.dbgShowShaderCode&&(r.V.Log(n),r.V.Log(t)),e.sources={compute:t,rawCompute:i},e.stage=this._createComputePipelineStageDescriptor(t,n,s)},s.$.prototype._releaseComputeEffect=function(e){this._compiledComputeEffects[e._key]&&(delete this._compiledComputeEffects[e._key],this._deleteComputePipelineContext(e.getPipelineContext()))},s.$.prototype._rebuildComputeEffects=function(){for(let e in this._compiledComputeEffects){let t=this._compiledComputeEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}},s.$.prototype._executeWhenComputeStateIsCompiled=function(e,t){e.stage.module.getCompilationInfo().then(e=>{let i={numErrors:0,messages:[]};for(let t of e.messages)"error"===t.type&&i.numErrors++,i.messages.push({type:t.type,text:t.message,line:t.lineNum,column:t.linePos,length:t.length,offset:t.offset});t(i)})},s.$.prototype._deleteComputePipelineContext=function(e){e&&e.dispose()},s.$.prototype._createComputePipelineStageDescriptor=function(e,t,i){return t=t?"//"+t.split("\n").join("\n//")+"\n":"",{module:this._device.createShaderModule({code:t+e}),entryPoint:i}},i(25045),s.$.prototype._debugPushGroup=function(e){this._options.enableGPUDebugMarkers&&(this._currentRenderTarget&&!this._currentRenderPass&&this._startRenderTargetRenderPass(this._currentRenderTarget,!1,null,!1,!1),this._currentRenderPass?this._currentRenderPass.pushDebugGroup(e):this._renderEncoder.pushDebugGroup(e))},s.$.prototype._debugPopGroup=function(){this._options.enableGPUDebugMarkers&&(this._currentRenderTarget&&!this._currentRenderPass&&this._startRenderTargetRenderPass(this._currentRenderTarget,!1,null,!1,!1),this._currentRenderPass?this._currentRenderPass.popDebugGroup():this._renderEncoder.popDebugGroup())},s.$.prototype._debugInsertMarker=function(e){this._options.enableGPUDebugMarkers&&(this._currentRenderTarget&&!this._currentRenderPass&&this._startRenderTargetRenderPass(this._currentRenderTarget,!1,null,!1,!1),this._currentRenderPass?this._currentRenderPass.insertDebugMarker(e):this._renderEncoder.insertDebugMarker(e))};var u=i(53805),h=i(78598);s.$.prototype.createDynamicTexture=function(e,t,i,r){let n=new u.h(this,4);return n.baseWidth=e,n.baseHeight=t,i&&(e=this.needPOTTextures?(0,h.R)(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?(0,h.R)(t,this._caps.maxTextureSize):t),n.width=e,n.height=t,n.isReady=!1,n.generateMipMaps=i,n.samplingMode=r,this.updateTextureSamplingMode(r,n),this._internalTexturesCache.push(n),e&&t&&this._textureHelper.createGPUTextureForInternalTexture(n,e,t),n},s.$.prototype.updateDynamicTexture=function(e,t,i,r=!1,n,s,a){if(!e)return;let o=t.width,l=t.height,u=e._hardwareTexture;e._hardwareTexture?.underlyingResource||(u=this._textureHelper.createGPUTextureForInternalTexture(e,o,l)),this._textureHelper.updateTexture(t,e,o,l,e.depth,u.format,0,0,i,r,0,0,a),e.generateMipMaps&&this._generateMipmaps(e),e._dynamicTextureSource=t,e._premulAlpha=r,e.invertY=i||!1,e.isReady=!0},i(41216),i(92053),i(60784),i(79962),i(91664),i(10217),i(43901),s.$.prototype.updateVideoTexture=function(e,t,i){if(!e||e._isDisabled)return;void 0===this._videoTextureSupported&&(this._videoTextureSupported=!0);let r=e._hardwareTexture;if(e._hardwareTexture?.underlyingResource||(r=this._textureHelper.createGPUTextureForInternalTexture(e)),t&&void 0!==t.underlyingResource){if(t.isReady()){try{this._textureHelper.copyVideoToTexture(t,e,r.format,!i),e.generateMipMaps&&this._generateMipmaps(e)}catch(e){}e.isReady=!0}}else t&&this.createImageBitmap(t).then(t=>{this._textureHelper.updateTexture(t,e,e.width,e.height,e.depth,r.format,0,0,!i,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e),e.isReady=!0}).catch(()=>{e.isReady=!0})}},42063(e,t,i){i.d(t,{u:()=>o});var r=i(94688),n=i(74150),s=i(91178),a=i(28899);class o{static _IsGPUBuffer(e){return void 0===e.underlyingResource}static _FlagsToString(e,t=""){let i=t;for(let t=0;t<=9;++t)e&1<<t&&(i&&(i+="_"),i+=a.Sd[1<<t]);return i}constructor(e,t){this._deferredReleaseBuffers=[],this._engine=e,this._device=t}createRawBuffer(e,t,i=!1,r){let n=void 0!==e.byteLength?e.byteLength+3&-4:e+3&-4,s={label:"BabylonWebGPUDevice"+this._engine.uniqueId+"_"+o._FlagsToString(t,r??"Buffer")+"_size"+n,mappedAtCreation:i,size:n,usage:t};return this._device.createBuffer(s)}createBuffer(e,t,i){let n=void 0!==e.byteLength,s=new r.p,a="DataBufferUniqueId="+s.uniqueId;return s.buffer=this.createRawBuffer(e,t,void 0,i?a+"-"+i:a),s.references=1,s.capacity=n?e.byteLength:e,s.engineId=this._engine.uniqueId,n&&this.setSubData(s,0,e),s}setRawData(e,t,i,r,n){r+=i.byteOffset,this._device.queue.writeBuffer(e,t,i.buffer,r,n)}setSubData(e,t,i,r=0,n=0){let s=e.underlyingResource;n=n||i.byteLength-r;let a=3&t;r-=a,t-=a;let o=n;if(n=n+a+3&-4,i.buffer.byteLength-i.byteOffset<n){let e=new Uint8Array(n);e.set(new Uint8Array(i.buffer,i.byteOffset+r,o)),i=e,r=0}this.setRawData(s,t,i,r,n)}_getHalfFloatAsFloatRGBAArrayBuffer(e,t,i){i?e=Math.min(e,i.length):i=new Float32Array(e);let r=new Uint16Array(t);for(;e--;)i[e]=(0,n.SX)(r[e]);return i}readDataFromBuffer(e,t,i,r,n,a,o=0,l=0,u=null,h=!0,c=!1){let d=1===o?2:+(2===o),p=this._engine.uniqueId;return new Promise((i,f)=>{e.mapAsync(1,l,t).then(()=>{let p=e.getMappedRange(l,t),f=u;if(c)f=null===f?(0,s.kZ)(o,t,!0,p):(0,s.kZ)(o,f.buffer,void 0,p);else if(null===f)switch(d){case 0:(f=new Uint8Array(t)).set(new Uint8Array(p));break;case 1:f=this._getHalfFloatAsFloatRGBAArrayBuffer(t/2,p);break;case 2:(f=new Float32Array(t/4)).set(new Float32Array(p))}else switch(d){case 0:(f=new Uint8Array(f.buffer)).set(new Uint8Array(p,0,Math.min(f.byteLength,t)));break;case 1:f=this._getHalfFloatAsFloatRGBAArrayBuffer(t/2,p,u);break;case 2:(f=new Float32Array(f.buffer)).set(new Float32Array(p,0,f.byteLength/4))}if(n!==a){1!==d||c||(n*=2,a*=2);let e=new Uint8Array(f.buffer),t=n,i=0;for(let s=1;s<r;++s){i=s*a;for(let r=0;r<n;++r)e[t++]=e[i++]}f=0===d||c?new Uint8Array(e.buffer,0,t):new Float32Array(e.buffer,0,t/4)}e.unmap(),h&&this.releaseBuffer(e),i(f)},e=>{this._engine.isDisposed||this._engine.uniqueId!==p?i(new Uint8Array):f(e)})})}releaseBuffer(e){return o._IsGPUBuffer(e)?(this._deferredReleaseBuffers.push(e),!0):(e.references--,0===e.references&&(this._deferredReleaseBuffers.push(e.underlyingResource),!0))}destroyDeferredBuffers(){for(let e=0;e<this._deferredReleaseBuffers.length;++e)this._deferredReleaseBuffers[e].destroy();this._deferredReleaseBuffers.length=0}}},13144(e,t,i){i.d(t,{Eb:()=>n,KS:()=>l,c7:()=>u,d_:()=>c,h1:()=>a,qY:()=>o,w$:()=>s});var r=i(75337);class n{constructor(e,t,i,r){this.x=Math.floor(e),this.y=Math.floor(t),this.w=Math.floor(i),this.h=Math.floor(r)}run(e){e.setViewport(this.x,this.y,this.w,this.h,0,1)}clone(){return new n(this.x,this.y,this.w,this.h)}}class s{constructor(e,t,i,r){this.x=e,this.y=t,this.w=i,this.h=r}run(e){e.setScissorRect(this.x,this.y,this.w,this.h)}clone(){return new s(this.x,this.y,this.w,this.h)}}class a{constructor(e){this.ref=e}run(e){e.setStencilReference(this.ref)}clone(){return new a(this.ref)}}class o{constructor(e){this.color=e}run(e){e.setBlendConstant(this.color)}clone(){return new o(this.color)}}class l{constructor(e){this.query=e}run(e){e.beginOcclusionQuery(this.query)}clone(){return new l(this.query)}}class u{constructor(){}run(e){e.endOcclusionQuery()}clone(){return new u}}class h{constructor(){this.bundles=[]}run(e){e.executeBundles(this.bundles)}clone(){let e=new h;return e.bundles=this.bundles,e}}class c{constructor(e){this.numDrawCalls=0,this._device=e,this._list=Array(10),this._listLength=0}addBundle(e){if(!this._currentItemIsBundle){let e=new h;this._list[this._listLength++]=e,this._currentBundleList=e.bundles,this._currentItemIsBundle=!0}e&&this._currentBundleList.push(e)}_finishBundle(){this._currentItemIsBundle&&this._bundleEncoder&&(this._currentBundleList.push(this._bundleEncoder.finish()),this._bundleEncoder=void 0,this._currentItemIsBundle=!1)}addItem(e){this._finishBundle(),this._list[this._listLength++]=e,this._currentItemIsBundle=!1}getBundleEncoder(e,t,i){return this._currentItemIsBundle||(this.addBundle(),this._bundleEncoder=this._device.createRenderBundleEncoder({colorFormats:e,depthStencilFormat:t,sampleCount:r.m.GetSample(i)})),this._bundleEncoder}close(){this._finishBundle()}run(e){this.close();for(let t=0;t<this._listLength;++t)this._list[t].run(e)}reset(){this._listLength=0,this._currentItemIsBundle=!1,this.numDrawCalls=0}clone(){this.close();let e=new c(this._device);e._list=Array(this._listLength),e._listLength=this._listLength,e.numDrawCalls=this.numDrawCalls;for(let t=0;t<this._listLength;++t)e._list[t]=this._list[t].clone();return e}}},71128(e,t,i){i.d(t,{N:()=>d});var r=i(42830),n=i(54931),s=i(75337),a=i(56058),o=i(56863);let l="clearQuadVertexShader",u=`uniform depthValue: f32;const pos=array(
vec2f(-1.0,1.0),
vec2f(1.0,1.0),
vec2f(-1.0,-1.0),
vec2f(1.0,-1.0)
);
#define CUSTOM_VERTEX_DEFINITIONS
@vertex
fn main(input : VertexInputs)->FragmentInputs {
#define CUSTOM_VERTEX_MAIN_BEGIN
vertexOutputs.position=vec4f(pos[input.vertexIndex],uniforms.depthValue,1.0);
#define CUSTOM_VERTEX_MAIN_END
}
`;o.l.ShadersStoreWGSL[l]||(o.l.ShadersStoreWGSL[l]=u);let h="clearQuadPixelShader",c=`uniform color: vec4f;@fragment
fn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=uniforms.color;}
`;o.l.ShadersStoreWGSL[h]||(o.l.ShadersStoreWGSL[h]=c);class d{setDepthStencilFormat(e){this._depthTextureFormat=e,this._cacheRenderPipeline.setDepthStencilFormat(e)}setColorFormat(e){this._cacheRenderPipeline.setColorFormat(e)}setMRTAttachments(e,t,i){this._cacheRenderPipeline.setMRT(t,i),this._cacheRenderPipeline.setMRTAttachments(e)}constructor(e,t,i){this._bindGroups={},this._bundleCache={},this._keyTemp=[],this._device=e,this._engine=t,this._cacheRenderPipeline=new r.V(this._device,i),this._cacheRenderPipeline.setDepthTestEnabled(!1),this._cacheRenderPipeline.setStencilReadMask(255),this._effect=t.createEffect("clearQuad",[],["color","depthValue"],void 0,void 0,void 0,void 0,void 0,void 0,1)}clear(e,t,i,r,o=1){let l,u,h=null,c=!!this._engine._currentRenderTarget;if(e)l=e;else{let e=0;this._keyTemp.length=0;for(let t=0;t<this._cacheRenderPipeline.colorFormats.length;++t)this._keyTemp[e++]=a.g[this._cacheRenderPipeline.colorFormats[t]??""];let n=a.g[this._depthTextureFormat??0];if(this._keyTemp[e]=(t?t.r+256*t.g+256*t.b*256+256*t.a*65536:0)+0x100000000*!!i+0x200000000*!!r+0x400000000*!!this._engine.useReverseDepthBuffer+0x800000000*!!c+0x1000000000*(o>1)+0x2000000000*n,u=this._keyTemp.join("_"),h=this._bundleCache[u])return h;l=this._device.createRenderBundleEncoder({label:"clearQuadRenderBundle",colorFormats:this._cacheRenderPipeline.colorFormats,depthStencilFormat:this._depthTextureFormat,sampleCount:s.m.GetSample(o)})}this._cacheRenderPipeline.setDepthWriteEnabled(!!i),this._cacheRenderPipeline.setStencilEnabled(!!r&&!!this._depthTextureFormat&&s.m.HasStencilAspect(this._depthTextureFormat)),this._cacheRenderPipeline.setStencilWriteMask(255*!!r),this._cacheRenderPipeline.setStencilCompare(r?519:512),this._cacheRenderPipeline.setStencilPassOp(r?7681:7680),this._cacheRenderPipeline.setWriteMask(15*!!t);let d=this._cacheRenderPipeline.getRenderPipeline(7,this._effect,o),p=this._effect._pipelineContext;t&&this._effect.setDirectColor4("color",t),this._effect.setFloat("depthValue",this._engine.useReverseDepthBuffer?this._engine._clearReverseDepthValue:this._engine._clearDepthValue),p.uniformBuffer.update();let f=c?this._engine._ubInvertY:this._engine._ubDontInvertY,_=p.uniformBuffer.getBuffer(),m=_.uniqueId+"-"+f.uniqueId,g=this._bindGroups[m];if(!g){let e=p.bindGroupLayouts[0];(g=this._bindGroups[m]=[]).push(this._device.createBindGroup({label:`clearQuadBindGroup0-${m}`,layout:e[0],entries:[]})),n.E._SimplifiedKnownBindings||g.push(this._device.createBindGroup({label:`clearQuadBindGroup1-${m}`,layout:e[1],entries:[]})),g.push(this._device.createBindGroup({label:`clearQuadBindGroup${n.E._SimplifiedKnownBindings?1:2}-${m}`,layout:e[n.E._SimplifiedKnownBindings?1:2],entries:[{binding:0,resource:{buffer:f.underlyingResource,size:f.capacity}},{binding:1,resource:{buffer:_.underlyingResource,size:_.capacity}}]}))}l.setPipeline(d);for(let e=0;e<g.length;++e)l.setBindGroup(e,g[e]);return l.draw(4,1,0,0),e||(h=l.finish(),this._bundleCache[u]=h),h}}},33246(e,t,i){i.d(t,{H:()=>n});var r=i(56248);class n extends r.N{constructor(e){super(!1),this._cache=e,this.reset()}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0,this._cache.setDepthBiasSlopeScale(e))}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0,this._cache.setDepthBias(e))}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0,this._cache.setCullFace(e??1))}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0,this._cache.setCullEnabled(!!e))}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0,this._cache.setDepthCompare(e))}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0,this._cache.setDepthWriteEnabled(e))}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0,this._cache.setDepthTestEnabled(e))}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0,this._cache.setFrontFace(e??2))}reset(){super.reset(),this._cache.resetDepthCullingState()}apply(){}}},25864(e,t,i){i.d(t,{J:()=>n});var r=i(62539);class n extends r.r{constructor(e){super(e)}}},97845(e,t,i){i.d(t,{Q:()=>s});var r=i(39058),n=i(75337);class s{get underlyingResource(){return this._webgpuTexture}getMSAATexture(e,t=0){return this._webgpuMSAATexture[t]||this._createMSAATexture(e,t),this._webgpuMSAATexture[t]}releaseMSAATextures(){for(let e of this._webgpuMSAATexture)e&&this._engine._textureHelper.releaseTexture(e);this._webgpuMSAATexture.length=0}constructor(e,t=null){this._engine=e,this._originalFormatIsRGB=!1,this.format="rgba8unorm",this.originalFormat="rgba8unorm",this.textureUsages=0,this.textureAdditionalUsages=0,this._webgpuTexture=t,this._webgpuMSAATexture=[],this.view=null,this.viewForWriting=null}set(e){this._webgpuTexture=e}setUsage(e,t,i,s,a,o,l,u){let h="2d",c=1;s?(h=i?"cube-array":"cube",c=6*(u||1)):a?(h="3d",c=1):i&&(h="2d-array",c=u);let d=n.m.GetDepthFormatOnly(this.format),p=n.m.HasDepthAndStencilAspects(this.format)?"depth-only":"all";this.createView({label:`TextureView${a?"3D":s?"Cube":"2D"}${i?"_Array"+c:""}_${o}x${l}_${t?"wmips":"womips"}_${this.format}_${h}`,format:d,dimension:h,mipLevelCount:t?(0,r.ILog2)(Math.max(o,l))+1:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:c,aspect:p})}createView(e,t=!1){if(this.view=this._webgpuTexture.createView(e),t&&e){let t=e.mipLevelCount;e.mipLevelCount=1,this.viewForWriting=this._webgpuTexture.createView(e),e.mipLevelCount=t}}reset(){this._webgpuTexture=null,this._webgpuMSAATexture.length=0,this.view=null,this.viewForWriting=null}release(){this._webgpuTexture?.destroy(),this.releaseMSAATextures(),this._copyInvertYTempTexture?.destroy(),this.reset()}_createMSAATexture(e,t){if(!this._webgpuTexture)throw Error("Cannot create GPU MSAA texture because underlying GPU texture is not created yet.");this._webgpuMSAATexture||(this._webgpuMSAATexture=[]),this._webgpuMSAATexture[t]=this._engine._textureHelper.createMSAATexture(this._webgpuTexture,this.originalFormat,e)}}},13398(e,t,i){i.d(t,{r:()=>s});var r=i(62539),n=i(26566);class s{get forceBindGroupCreation(){return this._numExternalTextures>0}get hasFloatOrDepthTextures(){return this._numFloatOrDepthTextures>0}constructor(){this.useVertexPulling=!1,this.uniqueId=s._Counter++,this.updateId=0,this.textureState=0,this.reset()}reset(){this.samplers={},this.textures={},this.isDirty=!0,this._numFloatOrDepthTextures=0,this._numExternalTextures=0}setSampler(e,t){let i=this.samplers[e],r=-1;i?r=i.hashCode:this.samplers[e]=i={sampler:t,hashCode:0},i.sampler=t,i.hashCode=t?n.R.GetSamplerHashCode(t):0;let s=r!==i.hashCode;s&&this.updateId++,this.isDirty||(this.isDirty=s)}setTexture(e,t){let i=this.textures[e],n=-1;i?n=i.texture?.uniqueId??-1:this.textures[e]=i={texture:t,isFloatOrDepthTexture:!1,isExternalTexture:!1},i.isExternalTexture&&this._numExternalTextures--,i.isFloatOrDepthTexture&&this._numFloatOrDepthTextures--,t?(i.isFloatOrDepthTexture=1===t.type||t.format>=13&&t.format<=18,i.isExternalTexture=r.r.IsExternalTexture(t),i.isFloatOrDepthTexture&&this._numFloatOrDepthTextures++,i.isExternalTexture&&this._numExternalTextures++):(i.isFloatOrDepthTexture=!1,i.isExternalTexture=!1),i.texture=t;let s=n!==(t?.uniqueId??-1);s&&this.updateId++,this.isDirty||(this.isDirty=s)}}s._Counter=0},29303(e,t,i){i.d(t,{e:()=>n});var r=i(73604);class n{get querySet(){return this._querySet.querySet}get hasQueries(){return this._currentTotalIndices!==this._availableIndices.length}canBeginQuery(e){if(this._frameQuerySetIsDirty===this._engine.frameId||this._queryFrameId[e]===this._engine.frameId)return!1;let t=void 0!==this._engine._getCurrentRenderPassWrapper().renderPassDescriptor.occlusionQuerySet;return t&&(this._queryFrameId[e]=this._engine.frameId),t}constructor(e,t,i,r=50,n=100){this._availableIndices=[],this._frameQuerySetIsDirty=-1,this._queryFrameId=[],this._engine=e,this._device=t,this._bufferManager=i,this._frameLastBuffer=-1,this._currentTotalIndices=0,this._countIncrement=n,this._allocateNewIndices(r)}createQuery(){0===this._availableIndices.length&&this._allocateNewIndices();let e=this._availableIndices[this._availableIndices.length-1];return this._availableIndices.length--,e}deleteQuery(e){this._availableIndices[this._availableIndices.length]=e}isQueryResultAvailable(e){return this._retrieveQueryBuffer(),!!this._lastBuffer&&e<this._lastBuffer.length}getQueryResult(e){return Number(this._lastBuffer?.[e]??-1)}_retrieveQueryBuffer(){this._lastBuffer&&this._frameLastBuffer===this._engine.frameId||this._frameLastBuffer!==this._engine.frameId&&(this._frameLastBuffer=this._engine.frameId,this._querySet.readValues(0,this._currentTotalIndices).then(e=>{this._lastBuffer=e}))}_allocateNewIndices(e){e=e??this._countIncrement,this._delayQuerySetDispose();for(let t=0;t<e;++t)this._availableIndices.push(this._currentTotalIndices+t);this._currentTotalIndices+=e,this._querySet=new r.L(this._engine,this._currentTotalIndices,"occlusion",this._device,this._bufferManager,!1,"QuerySet_OcclusionQuery_count_"+this._currentTotalIndices),this._frameQuerySetIsDirty=this._engine.frameId}_delayQuerySetDispose(){let e=this._querySet;e&&setTimeout(()=>e.dispose,1e3)}dispose(){this._querySet?.dispose(),this._availableIndices.length=0}}},93695(e,t,i){i.d(t,{e:()=>n});var r=i(9711);class n{constructor(){this._gpuTimeInFrameId=-1,this.counter=new r.A}_addDuration(e,t){e<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==e?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(t,!1),this._gpuTimeInFrameId=e):this.counter.addCount(t,!1))}}},73604(e,t,i){i.d(t,{L:()=>n});var r=i(28899);class n{get querySet(){return this._querySet}constructor(e,t,i,n,s,a=!0,o){this._dstBuffers=[],this._engine=e,this._device=n,this._bufferManager=s,this._count=t,this._canUseMultipleBuffers=a,this._querySet=n.createQuerySet({label:o??"QuerySet",type:i,count:t}),this._queryBuffer=s.createRawBuffer(8*t,r.Sd.QueryResolve|r.Sd.CopySrc,void 0,"QueryBuffer"),a||this._dstBuffers.push(this._bufferManager.createRawBuffer(8*this._count,r.Sd.MapRead|r.Sd.CopyDst,void 0,"QueryBufferNoMultipleBuffers"))}_getBuffer(e,t){let i;if(!this._canUseMultipleBuffers&&0===this._dstBuffers.length)return null;let n=this._device.createCommandEncoder();return 0===this._dstBuffers.length?i=this._bufferManager.createRawBuffer(8*this._count,r.Sd.MapRead|r.Sd.CopyDst,void 0,"QueryBufferAdditionalBuffer"):(i=this._dstBuffers[this._dstBuffers.length-1],this._dstBuffers.length--),n.resolveQuerySet(this._querySet,e,t,this._queryBuffer,0),n.copyBufferToBuffer(this._queryBuffer,0,i,0,8*t),this._device.queue.submit([n.finish()]),i}async readValues(e=0,t=1){let i=this._getBuffer(e,t);if(null===i)return null;let r=this._engine.uniqueId;try{await i.mapAsync(1);let e=new BigUint64Array(i.getMappedRange()).slice();return i.unmap(),this._dstBuffers[this._dstBuffers.length]=i,e}catch(e){if(this._engine.isDisposed||this._engine.uniqueId!==r)return null;throw e}}async readValue(e=0){let t=this._getBuffer(e,1);if(null===t)return null;let i=this._engine.uniqueId;try{await t.mapAsync(1);let e=new BigUint64Array(t.getMappedRange()),i=Number(e[0]);return t.unmap(),this._dstBuffers[this._dstBuffers.length]=t,i}catch(e){if(this._engine.isDisposed||this._engine.uniqueId!==i)return 0;throw e}}async readTwoValuesAndSubtract(e=0){let t=this._getBuffer(e,2);if(null===t)return null;let i=this._engine.uniqueId;try{await t.mapAsync(1);let e=new BigUint64Array(t.getMappedRange()),i=Number(e[1]-e[0]);return t.unmap(),this._dstBuffers[this._dstBuffers.length]=t,i}catch(e){if(this._engine.isDisposed||this._engine.uniqueId!==i)return 0;throw e}}dispose(){this._querySet.destroy(),this._bufferManager.releaseBuffer(this._queryBuffer);for(let e=0;e<this._dstBuffers.length;++e)this._bufferManager.releaseBuffer(this._dstBuffers[e])}}},54931(e,t,i){i.d(t,{E:()=>n});let r={mat2:2,mat3:3,mat4:4,mat2x2:2,mat3x3:3,mat4x4:4};class n{static get KnownUBOs(){return n._SimplifiedKnownBindings?n._SimplifiedKnownUBOs:n._KnownUBOs}constructor(e,t=!1){this.vertexBufferKindToNumberOfComponents={},this.shaderLanguage=e,this._attributeNextLocation=0,this._varyingNextLocation=0,this.freeGroupIndex=0,this.freeBindingIndex=0,this.availableVaryings={},this.availableAttributes={},this.availableBuffers={},this.availableTextures={},this.availableSamplers={},this.orderedAttributes=[],this.bindGroupLayoutEntries=[],this.bindGroupLayoutEntryInfo=[],this.bindGroupEntries=[],this.bufferNames=[],this.textureNames=[],this.samplerNames=[],this.leftOverUniforms=[],t||this._findStartingGroupBinding()}_findStartingGroupBinding(){let e=n.KnownUBOs,t=[];for(let i in e){let r=e[i].binding;-1!==r.groupIndex&&(void 0===t[r.groupIndex]?t[r.groupIndex]=r.bindingIndex:t[r.groupIndex]=Math.max(t[r.groupIndex],r.bindingIndex))}this.freeGroupIndex=t.length-1,0===this.freeGroupIndex?(this.freeGroupIndex++,this.freeBindingIndex=0):this.freeBindingIndex=t[t.length-1]+1}getAttributeNextLocation(e,t=0){let i=this._attributeNextLocation;return this._attributeNextLocation+=(r[e]??1)*(t||1),i}getVaryingNextLocation(e,t=0){let i=this._varyingNextLocation;return this._varyingNextLocation+=(r[e]??1)*(t||1),i}getNextFreeUBOBinding(){return this._getNextFreeBinding(1)}_getNextFreeBinding(e){if(this.freeBindingIndex>65536-e&&(this.freeGroupIndex++,this.freeBindingIndex=0),4===this.freeGroupIndex)throw"Too many textures or UBOs have been declared and it is not supported in WebGPU.";let t={groupIndex:this.freeGroupIndex,bindingIndex:this.freeBindingIndex};return this.freeBindingIndex+=e,t}}n._SimplifiedKnownBindings=!0,n._SimplifiedKnownUBOs={Scene:{binding:{groupIndex:0,bindingIndex:0}},Light0:{binding:{groupIndex:-1,bindingIndex:-1}},Light1:{binding:{groupIndex:-1,bindingIndex:-1}},Light2:{binding:{groupIndex:-1,bindingIndex:-1}},Light3:{binding:{groupIndex:-1,bindingIndex:-1}},Light4:{binding:{groupIndex:-1,bindingIndex:-1}},Light5:{binding:{groupIndex:-1,bindingIndex:-1}},Light6:{binding:{groupIndex:-1,bindingIndex:-1}},Light7:{binding:{groupIndex:-1,bindingIndex:-1}},Light8:{binding:{groupIndex:-1,bindingIndex:-1}},Light9:{binding:{groupIndex:-1,bindingIndex:-1}},Light10:{binding:{groupIndex:-1,bindingIndex:-1}},Light11:{binding:{groupIndex:-1,bindingIndex:-1}},Light12:{binding:{groupIndex:-1,bindingIndex:-1}},Light13:{binding:{groupIndex:-1,bindingIndex:-1}},Light14:{binding:{groupIndex:-1,bindingIndex:-1}},Light15:{binding:{groupIndex:-1,bindingIndex:-1}},Light16:{binding:{groupIndex:-1,bindingIndex:-1}},Light17:{binding:{groupIndex:-1,bindingIndex:-1}},Light18:{binding:{groupIndex:-1,bindingIndex:-1}},Light19:{binding:{groupIndex:-1,bindingIndex:-1}},Light20:{binding:{groupIndex:-1,bindingIndex:-1}},Light21:{binding:{groupIndex:-1,bindingIndex:-1}},Light22:{binding:{groupIndex:-1,bindingIndex:-1}},Light23:{binding:{groupIndex:-1,bindingIndex:-1}},Light24:{binding:{groupIndex:-1,bindingIndex:-1}},Light25:{binding:{groupIndex:-1,bindingIndex:-1}},Light26:{binding:{groupIndex:-1,bindingIndex:-1}},Light27:{binding:{groupIndex:-1,bindingIndex:-1}},Light28:{binding:{groupIndex:-1,bindingIndex:-1}},Light29:{binding:{groupIndex:-1,bindingIndex:-1}},Light30:{binding:{groupIndex:-1,bindingIndex:-1}},Light31:{binding:{groupIndex:-1,bindingIndex:-1}},Material:{binding:{groupIndex:-1,bindingIndex:-1}},Mesh:{binding:{groupIndex:-1,bindingIndex:-1}},Internals:{binding:{groupIndex:-1,bindingIndex:-1}}},n._KnownUBOs={Scene:{binding:{groupIndex:0,bindingIndex:0}},Light0:{binding:{groupIndex:1,bindingIndex:0}},Light1:{binding:{groupIndex:1,bindingIndex:1}},Light2:{binding:{groupIndex:1,bindingIndex:2}},Light3:{binding:{groupIndex:1,bindingIndex:3}},Light4:{binding:{groupIndex:1,bindingIndex:4}},Light5:{binding:{groupIndex:1,bindingIndex:5}},Light6:{binding:{groupIndex:1,bindingIndex:6}},Light7:{binding:{groupIndex:1,bindingIndex:7}},Light8:{binding:{groupIndex:1,bindingIndex:8}},Light9:{binding:{groupIndex:1,bindingIndex:9}},Light10:{binding:{groupIndex:1,bindingIndex:10}},Light11:{binding:{groupIndex:1,bindingIndex:11}},Light12:{binding:{groupIndex:1,bindingIndex:12}},Light13:{binding:{groupIndex:1,bindingIndex:13}},Light14:{binding:{groupIndex:1,bindingIndex:14}},Light15:{binding:{groupIndex:1,bindingIndex:15}},Light16:{binding:{groupIndex:1,bindingIndex:16}},Light17:{binding:{groupIndex:1,bindingIndex:17}},Light18:{binding:{groupIndex:1,bindingIndex:18}},Light19:{binding:{groupIndex:1,bindingIndex:19}},Light20:{binding:{groupIndex:1,bindingIndex:20}},Light21:{binding:{groupIndex:1,bindingIndex:21}},Light22:{binding:{groupIndex:1,bindingIndex:22}},Light23:{binding:{groupIndex:1,bindingIndex:23}},Light24:{binding:{groupIndex:1,bindingIndex:24}},Light25:{binding:{groupIndex:1,bindingIndex:25}},Light26:{binding:{groupIndex:1,bindingIndex:26}},Light27:{binding:{groupIndex:1,bindingIndex:27}},Light28:{binding:{groupIndex:1,bindingIndex:28}},Light29:{binding:{groupIndex:1,bindingIndex:29}},Light30:{binding:{groupIndex:1,bindingIndex:30}},Light31:{binding:{groupIndex:1,bindingIndex:31}},Material:{binding:{groupIndex:2,bindingIndex:0}},Mesh:{binding:{groupIndex:2,bindingIndex:1}},Internals:{binding:{groupIndex:2,bindingIndex:2}}}},68428(e,t,i){i.d(t,{I:()=>o});var r=i(54931),n=i(31656),s=i(33781),a=i(16447);class o extends s.q{constructor(){super(...arguments),this._missingVaryings=[],this._textureArrayProcessing=[],this._vertexIsGLES3=!1,this._fragmentIsGLES3=!1,this.shaderLanguage=0,this.parseGLES3=!0}_getArraySize(e,t,i){let r=0,n=e.indexOf("["),s=e.indexOf("]");if(n>0&&s>0){let t=e.substring(n+1,s);isNaN(r=+t)&&(r=+i[t.trim()]),e=e.substring(0,n)}return[e,t,r]}initializeShaders(e){this._webgpuProcessingContext=e,this._missingVaryings.length=0,this._textureArrayProcessing.length=0,this.attributeKeywordName=void 0,this.varyingVertexKeywordName=void 0,this.varyingFragmentKeywordName=void 0}preProcessShaderCode(e,t){let i=`// Internals UBO
uniform ${s.q.InternalsUBOName} {
float yFactor_;
float textureOutputHeight_;
};
`,r=-1!==e.indexOf("// Internals UBO");return t?(this._fragmentIsGLES3=-1!==e.indexOf("#version 3"),this._fragmentIsGLES3&&(this.varyingFragmentKeywordName="in"),r?e:i+"##INJECTCODE##\n"+e):(this._vertexIsGLES3=-1!==e.indexOf("#version 3"),this._vertexIsGLES3&&(this.attributeKeywordName="in",this.varyingVertexKeywordName="out"),r?e:i+e)}varyingCheck(e,t){return(t&&this._fragmentIsGLES3?/(flat\s)?\s*\bin\b/:!t&&this._vertexIsGLES3?/(flat\s)?\s*\bout\b/:/(flat\s)?\s*\bvarying\b/).test(e)}varyingProcessor(e,t,i){this._preProcessors=i;let r=(t&&this._fragmentIsGLES3?/\s*(flat)?\s*in\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm:!t&&this._vertexIsGLES3?/\s*(flat)?\s*out\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm:/\s*(flat)?\s*varying\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm).exec(e);if(null!==r){let s,a=r[1]??"",o=r[2],l=r[3];t?(s=this._webgpuProcessingContext.availableVaryings[l],this._missingVaryings[s]="",void 0===s&&n.V.Warn(`Invalid fragment shader: The varying named "${l}" is not declared in the vertex shader! This declaration will be ignored.`)):(s=this._webgpuProcessingContext.getVaryingNextLocation(o,this._getArraySize(l,o,i)[2]),this._webgpuProcessingContext.availableVaryings[l]=s,this._missingVaryings[s]=`layout(location = ${s}) ${a} in ${o} ${l};`),e=e.replace(r[0],void 0===s?"":`layout(location = ${s}) ${a} ${t?"in":"out"} ${o} ${l};`)}return e}attributeProcessor(e,t){this._preProcessors=t;let i=(this._vertexIsGLES3?/\s*in\s+(\S+)\s+(\S+)\s*;/gm:/\s*attribute\s+(\S+)\s+(\S+)\s*;/gm).exec(e);if(null!==i){let r=i[1],n=i[2],s=this._webgpuProcessingContext.getAttributeNextLocation(r,this._getArraySize(n,r,t)[2]);this._webgpuProcessingContext.availableAttributes[n]=s,this._webgpuProcessingContext.orderedAttributes[s]=n;let a=this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents[n];if(void 0!==a){let t=`_int_${n}_`;e=e.replace(i[0],`layout(location = ${s}) in ${a<0?-1===a?"int":"ivec"+-a:1===a?"uint":"uvec"+a} ${t}; ${r} ${n} = ${r}(${t});`)}else e=e.replace(i[0],`layout(location = ${s}) in ${r} ${n};`)}return e}uniformProcessor(e,t,i){this._preProcessors=i;let r=/\s*uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm.exec(e);if(null!==r){let n=r[1],a=r[2];if(0===n.indexOf("sampler")||1===n.indexOf("sampler")){let r=0;[a,n,r]=this._getArraySize(a,n,i);let o=this._webgpuProcessingContext.availableTextures[a];if(!o){o={autoBindSampler:!0,isTextureArray:r>0,isStorageTexture:!1,textures:[],sampleType:"float"};for(let e=0;e<(r||1);++e)o.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding())}let l=s.q._SamplerTypeByWebGLSamplerType[n]??"sampler",u=!!s.q._IsComparisonSamplerByWebGPUSamplerType[l],h=a+"Sampler",c=this._webgpuProcessingContext.availableSamplers[h];c||(c={binding:this._webgpuProcessingContext.getNextFreeUBOBinding(),type:u?"comparison":"filtering"});let d="u"===n.charAt(0)?"u":"i"===n.charAt(0)?"i":"";d&&(n=n.substring(1)),o.sampleType=u?"depth":"u"===d?"uint":"i"===d?"sint":"float";let p=r>0,f=c.binding.groupIndex,_=c.binding.bindingIndex,m=s.q._SamplerFunctionByWebGLSamplerType[n],g=s.q._TextureTypeByWebGLSamplerType[n],b=s.q._GpuTextureViewDimensionByWebGPUTextureType[g];if(p){let t=[];t.push(`layout(set = ${f}, binding = ${_}) uniform ${d}${l} ${h};`),e=`
`;for(let i=0;i<r;++i){let r=o.textures[i].groupIndex,n=o.textures[i].bindingIndex;t.push(`layout(set = ${r}, binding = ${n}) uniform ${g} ${a}Texture${i};`),e+=`${i>0?"\n":""}#define ${a}${i} ${d}${m}(${a}Texture${i}, ${h})`}e=t.join("\n")+e,this._textureArrayProcessing.push(a)}else r=1,e=`layout(set = ${f}, binding = ${_}) uniform ${l} ${h};
                        layout(set = ${o.textures[0].groupIndex}, binding = ${o.textures[0].bindingIndex}) uniform ${d}${g} ${a}Texture;
                        #define ${a} ${d}${m}(${a}Texture, ${h})`;this._webgpuProcessingContext.availableTextures[a]=o,this._webgpuProcessingContext.availableSamplers[h]=c,this._addSamplerBindingDescription(h,c,!t);for(let e=0;e<r;++e)this._addTextureBindingDescription(a,o,e,b,null,!t)}else this._addUniformToLeftOverUBO(a,n,i),e=""}return e}uniformBufferProcessor(e,t){let i=/uniform\s+(\w+)/gm.exec(e);if(null!==i){let n=i[1],s=this._webgpuProcessingContext.availableBuffers[n];if(!s){let e=r.E.KnownUBOs[n];s={binding:e&&-1!==e.binding.groupIndex?e.binding:this._webgpuProcessingContext.getNextFreeUBOBinding()},this._webgpuProcessingContext.availableBuffers[n]=s}this._addBufferBindingDescription(n,s,"uniform",!t),e=e.replace("uniform",`layout(set = ${s.binding.groupIndex}, binding = ${s.binding.bindingIndex}) uniform`)}return e}postProcessor(e,t,i,r,n,s){let o=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),i){let t=e.indexOf("gl_FragCoord")>=0,i=`
                glFragCoord_ = gl_FragCoord;
                if (yFactor_ == 1.) {
                    glFragCoord_.y = textureOutputHeight_ - glFragCoord_.y;
                }
            `,r=-1!==e.search(/layout *\(location *= *0\) *out/g);if(e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/gl_FragCoord/g,"glFragCoord_"),this._fragmentIsGLES3){let t=/^\s*out\s+\S+\s+\S+\s*;/gm.exec(e);null!==t&&(e=e.substring(0,t.index)+"layout(location = 0) "+e.substring(t.index))}else e=e.replace(/void\s+?main\s*\(/g,(o||r?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(");e=(e=e.replace(/dFdy/g,"(-yFactor_)*dFdy")).replace("##INJECTCODE##",t?"vec4 glFragCoord_;\n":""),t&&(e=(0,a.bI)(e,"void main",i))}else if("VERTEXOUTPUT_INVARIANT"in s&&(e="invariant gl_Position;\n"+e),e=(e=e.replace(/gl_InstanceID/g,"gl_InstanceIndex")).replace(/gl_VertexID/g,"gl_VertexIndex"),-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;if(!i){let t=e.lastIndexOf("}");e=e.substring(0,t)+"gl_Position.y *= yFactor_;\n}"}return e}_applyTextureArrayProcessing(e,t){let i=RegExp(t+"\\s*\\[(.+)?\\]","gm"),r=i.exec(e);for(;null!==r;){let n=r[1],s=+n;this._preProcessors&&isNaN(s)&&(s=+this._preProcessors[n.trim()]),e=e.replace(r[0],t+s),r=i.exec(e)}return e}_generateLeftOverUBOCode(e,t){let i=`layout(set = ${t.binding.groupIndex}, binding = ${t.binding.bindingIndex}) uniform ${e} {
    `;for(let e of this._webgpuProcessingContext.leftOverUniforms)e.length>0?i+=`    ${e.type} ${e.name}[${e.length}];
`:i+=`    ${e.type} ${e.name};
`;return i+"};\n\n"}finalizeShaders(e,t){for(let i=0;i<this._textureArrayProcessing.length;++i){let r=this._textureArrayProcessing[i];e=this._applyTextureArrayProcessing(e,r),t=this._applyTextureArrayProcessing(t,r)}for(let e=0;e<this._missingVaryings.length;++e){let i=this._missingVaryings[e];i&&i.length>0&&(t=i+"\n"+t)}let i=this._buildLeftOverUBO();return e=i+e,t=i+t,this._collectBindingNames(),this._preCreateBindGroupEntries(),this._preProcessors=null,this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents={},{vertexCode:e,fragmentCode:t}}}},69849(e,t,i){i.d(t,{z:()=>u});var r=i(54931),n=i(31656),s=i(33781),a=i(16447);i(37811),i(70927),i(78054),i(46014),i(75185),i(57087),i(40151),i(2384),i(92137);let o="fragmentOutputs.fragDepth",l={texture_1d:"1d",texture_2d:"2d",texture_2d_array:"2d-array",texture_3d:"3d",texture_cube:"cube",texture_cube_array:"cube-array",texture_multisampled_2d:"2d",texture_depth_2d:"2d",texture_depth_2d_array:"2d-array",texture_depth_cube:"cube",texture_depth_cube_array:"cube-array",texture_depth_multisampled_2d:"2d",texture_storage_1d:"1d",texture_storage_2d:"2d",texture_storage_2d_array:"2d-array",texture_storage_3d:"3d",texture_external:null};class u extends s.q{constructor(){super(...arguments),this.shaderLanguage=1,this.uniformRegexp=/uniform\s+(\w+)\s*:\s*(.+)\s*;/,this.textureRegexp=/var\s+(\w+)\s*:\s*((array<\s*)?(texture_\w+)\s*(<\s*(.+)\s*>)?\s*(,\s*\w+\s*>\s*)?);/,this.noPrecision=!0,this.pureMode=!1}_getArraySize(e,t,i){let r=0,n=t.lastIndexOf(">");if(t.indexOf("array")>=0&&n>0){let e=n;for(;e>0&&" "!==t.charAt(e)&&","!==t.charAt(e);)e--;let s=t.substring(e+1,n);for(isNaN(r=+s)&&(r=+i[s.trim()]);e>0&&(" "===t.charAt(e)||","===t.charAt(e));)e--;t=t.substring(t.indexOf("<")+1,e+1)}return[e,t,r]}initializeShaders(e){this._webgpuProcessingContext=e,this._attributesInputWGSL=[],this._attributesWGSL=[],this._attributesConversionCodeWGSL=[],this._hasNonFloatAttribute=!1,this._varyingsWGSL=[],this._varyingNamesWGSL=[],this._stridedUniformArrays=[]}preProcessShaderCode(e){let t=this.pureMode?"":`struct ${s.q.InternalsUBOName} {
  yFactor_: f32,
  textureOutputHeight_: f32,
};
var<uniform> internals : ${s.q.InternalsUBOName};
`;return -1!==e.indexOf(t)?e:t+(0,a.RJ)(e)}varyingCheck(e){return/(flat|linear|perspective)?\s*(center|centroid|sample)?\s*\bvarying\b/.test(e)}varyingProcessor(e,t,i){let r=/\s*(flat|linear|perspective)?\s*(center|centroid|sample)?\s*varying\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s*:\s*(.+)\s*;/gm.exec(e);if(null!==r){let s,a=r[1]??"perspective",o=r[2]??"center",l=r[4],u=r[3],h="flat"===a?`@interpolate(${a})`:`@interpolate(${a}, ${o})`;t?void 0===(s=this._webgpuProcessingContext.availableVaryings[u])&&n.V.Warn(`Invalid fragment shader: The varying named "${u}" is not declared in the vertex shader! This declaration will be ignored.`):(s=this._webgpuProcessingContext.getVaryingNextLocation(l,this._getArraySize(u,l,i)[2]),this._webgpuProcessingContext.availableVaryings[u]=s,this._varyingsWGSL.push(`  @location(${s}) ${h} ${u} : ${l},`),this._varyingNamesWGSL.push(u)),e=""}return e}attributeProcessor(e,t){let i=/\s*attribute\s+(\S+)\s*:\s*(.+)\s*;/gm.exec(e);if(null!==i){let r=i[2],n=i[1],s=this._webgpuProcessingContext.getAttributeNextLocation(r,this._getArraySize(n,r,t)[2]);this._webgpuProcessingContext.availableAttributes[n]=s,this._webgpuProcessingContext.orderedAttributes[s]=n;let a=this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents[n];if(void 0!==a){let e=`_int_${n}_`;this._attributesInputWGSL.push(`@location(${s}) ${e} : ${a<0?-1===a?"i32":"vec"+-a+"<i32>":1===a?"u32":"vec"+a+"<u32>"},`),this._attributesWGSL.push(`${n} : ${r},`),this._attributesConversionCodeWGSL.push(`vertexInputs.${n} = ${r}(vertexInputs_.${e});`),this._hasNonFloatAttribute=!0}else this._attributesInputWGSL.push(`@location(${s}) ${n} : ${r},`),this._attributesWGSL.push(`${n} : ${r},`),this._attributesConversionCodeWGSL.push(`vertexInputs.${n} = vertexInputs_.${n};`);e=""}return e}uniformProcessor(e,t,i){let r=this.uniformRegexp.exec(e);if(null!==r){let t=r[2],n=r[1];this._addUniformToLeftOverUBO(n,t,i),e=""}return e}textureProcessor(e,t,i){let r=this.textureRegexp.exec(e);if(null!==r){let n=r[1],s=r[2],a=!!r[3],o=r[4],u=o.indexOf("storage")>0,h=r[6],c=u?h.substring(0,h.indexOf(",")).trim():null,d=a?this._getArraySize(n,s,i)[2]:0,p=this._webgpuProcessingContext.availableTextures[n];if(p)d=p.textures.length;else{p={isTextureArray:d>0,isStorageTexture:u,textures:[],sampleType:"float"},d=d||1;for(let e=0;e<d;++e)p.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding())}this._webgpuProcessingContext.availableTextures[n]=p;let f=o.indexOf("depth")>0,_=l[o],m=f?"depth":"u32"===h?"uint":"i32"===h?"sint":"float";if(p.sampleType=m,void 0===_)throw`Can't get the texture dimension corresponding to the texture function "${o}"!`;for(let i=0;i<d;++i){let{groupIndex:r,bindingIndex:s}=p.textures[i];0===i&&(e=`@group(${r}) @binding(${s}) ${e}`),this._addTextureBindingDescription(n,p,i,_,c,!t)}}return e}_convertDefinesToConst(e){let t="";for(let i in e){let r=e[i];!i.startsWith("__")&&(isNaN(parseInt(r))&&isNaN(parseFloat(r))?i&&""===r&&(t+=`const ${i} = true;
`):t+=`const ${i} = ${r};
`)}return t}postProcessor(e,t,i,r,n,s,a){let o=[];for(let e in a)"true"!==a[e]&&o.push(e);for(let t of(o.sort((e,t)=>e.length-t.length>0?-1:+(e.length!==t.length)),o)){let i=e.indexOf("#define "+t),r=e.indexOf("\n",i);-1===r&&(r=e.length);let n=e.substring(i+8+t.length+1,r);e=e.replace(RegExp(t,"g"),n)}return e=this._convertDefinesToConst(s)+e,"VERTEXOUTPUT_INVARIANT"in s&&(e="#define VERTEXOUTPUT_INVARIANT\n"+e),e}finalizeShaders(e,t){let i=[],r=t.indexOf("fragmentInputs.position")>=0&&!this.pureMode?`
            if (internals.yFactor_ == 1.) {
                fragmentInputs.position.y = internals.textureOutputHeight_ - fragmentInputs.position.y;
            }
        `:"";e=this._processSamplers(e,!0),t=this._processSamplers(t,!1),e=this._processCustomBuffers(e,!0),t=this._processCustomBuffers(t,!1);let n=this._buildLeftOverUBO();e=n+e,t=n+t,e=e.replace(/#define /g,"//#define "),e=this._processStridedUniformArrays(e);let s="struct VertexInputs {\n  @builtin(vertex_index) vertexIndex : u32,\n  @builtin(instance_index) instanceIndex : u32,\n";this._attributesInputWGSL.length>0&&(s+=this._attributesInputWGSL.join("\n")),s+="\n};\nvar<private> vertexInputs"+(this._hasNonFloatAttribute?"_":"")+" : VertexInputs;\n",this._hasNonFloatAttribute&&(s+="struct VertexInputs_ {\n  vertexIndex : u32, instanceIndex : u32,\n",s+=this._attributesWGSL.join("\n"),s+="\n};\nvar<private> vertexInputs : VertexInputs_;\n");let l="struct FragmentInputs {\n  @builtin(position)"+(e.indexOf("#define VERTEXOUTPUT_INVARIANT")>=0?" @invariant":"")+" position : vec4<f32>,\n";this._varyingsWGSL.length>0&&(l+=this._varyingsWGSL.join("\n")),l+="\n};\nvar<private> vertexOutputs : FragmentInputs;\n",e=s+l+e;let u=`
  vertexInputs${this._hasNonFloatAttribute?"_":""} = input;
`;this._hasNonFloatAttribute&&(u+="vertexInputs.vertexIndex = vertexInputs_.vertexIndex;\nvertexInputs.instanceIndex = vertexInputs_.instanceIndex;\n",u+=this._attributesConversionCodeWGSL.join("\n"),u+="\n");let h=this.pureMode?"  return vertexOutputs;":`  vertexOutputs.position.y = vertexOutputs.position.y * internals.yFactor_;
  return vertexOutputs;`,c=-1!==e.indexOf("#define DISABLE_UNIFORMITY_ANALYSIS");e=(c?"diagnostic(off, derivative_uniformity);\n":"")+"diagnostic(off, chromium.unreachable_code);\n"+(0,a.bI)(e,"fn main",u,h),t=t.replace(/#define /g,"//#define "),t=this._processStridedUniformArrays(t),this.pureMode||(t=t.replace(/dpdy/g,"(-internals.yFactor_)*dpdy"));let d="struct FragmentInputs {\n  @builtin(position) position : vec4<f32>,\n  @builtin(front_facing) frontFacing : bool,\n";this._varyingsWGSL.length>0&&(d+=this._varyingsWGSL.join("\n")),d+="\n};\nvar<private> fragmentInputs : FragmentInputs;\n";let p="struct FragmentOutputs {\n",f="fragmentOutputs\\.fragData",_=t.match(RegExp(f+"0","g")),m=0;if(_){p+=` @location(${m}) fragData0 : vec4<f32>,
`,m++;for(let e=1;e<8;e++)(_=t.match(RegExp(f+e,"g")))&&(p+=` @location(${m}) fragData${m} : vec4<f32>,
`,m++);-1!==t.indexOf("MRT_AND_COLOR")&&(p+=`  @location(${m}) color : vec4<f32>,
`,m++)}(_=t.match(/oitDepthSampler/))&&(p+=` @location(${m++}) depth : vec2<f32>,
 @location(${m++}) frontColor : vec4<f32>,
 @location(${m++}) backColor : vec4<f32>,
`),0===m&&(-1!==t.indexOf("DUAL_SOURCE_BLENDING")?(i.push("dual_source_blending"),p+="  @location(0) @blend_src(0) color : vec4<f32>,\n  @location(0) @blend_src(1) color2 : vec4<f32>,\n"):p+="  @location(0) color : vec4<f32>,\n",m++);let g=!1,b=0;for(;!g&&!((b=t.indexOf(o,b))<0);){let e=b;for(g=!0;b>1&&"\n"!==t.charAt(b);){if("/"===t.charAt(b)&&"/"===t.charAt(b-1)){g=!1;break}b--}b=e+o.length}return g&&(p+="  @builtin(frag_depth) fragDepth: f32,\n"),p+="};\nvar<private> fragmentOutputs : FragmentOutputs;\n",c=-1!==(t=d+p+t).indexOf("#define DISABLE_UNIFORMITY_ANALYSIS"),i.length>0&&(t="enable "+i.join(";\nenable ")+";\n"+t),t=(c?"diagnostic(off, derivative_uniformity);\n":"")+"diagnostic(off, chromium.unreachable_code);\n"+(0,a.bI)(t,"fn main","  fragmentInputs = input;\n  "+r,"  return fragmentOutputs;"),this._collectBindingNames(),this._preCreateBindGroupEntries(),this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents={},{vertexCode:e,fragmentCode:t}}_generateLeftOverUBOCode(e,t){let i="",r=`struct ${e} {
`;for(let t of this._webgpuProcessingContext.leftOverUniforms){let n=t.type.replace(/^(.*?)(<.*>)?$/,"$1"),a=s.q.UniformSizes[n];if(t.length>0)if(a<=2){let s=`${e}_${this._stridedUniformArrays.length}_strided_arr`;i+=`struct ${s} {
                        @size(16)
                        el: ${n},
                    }`,this._stridedUniformArrays.push(t.name),r+=` @align(16) ${t.name} : array<${s}, ${t.length}>,
`}else r+=` ${t.name} : array<${t.type}, ${t.length}>,
`;else r+=`  ${t.name} : ${t.type},
`}return r+="};\n",r=`${i}
${r}@group(${t.binding.groupIndex}) @binding(${t.binding.bindingIndex}) var<uniform> uniforms : ${e};
`}_processSamplers(e,t){let i=/var\s+(\w+Sampler)\s*:\s*(sampler|sampler_comparison)\s*;/gm;for(;;){let r=i.exec(e);if(null===r)break;let n=r[1],s=r[2],a=n.length-7,o=n.lastIndexOf("Sampler")===a?n.substring(0,a):null,l="sampler_comparison"===s?"comparison":"filtering";if(o){let e=this._webgpuProcessingContext.availableTextures[o];e&&(e.autoBindSampler=!0)}let u=this._webgpuProcessingContext.availableSamplers[n];u||(u={binding:this._webgpuProcessingContext.getNextFreeUBOBinding(),type:l},this._webgpuProcessingContext.availableSamplers[n]=u),this._addSamplerBindingDescription(n,u,t);let h=e.substring(0,r.index),c=`@group(${u.binding.groupIndex}) @binding(${u.binding.bindingIndex}) `;e=h+c+e.substring(r.index),i.lastIndex+=c.length}return e}_processCustomBuffers(e,t){let i=/var<\s*(uniform|storage)\s*(,\s*(read|read_write)\s*)?>\s+(\S+)\s*:\s*(\S+)\s*;/gm;for(;;){let n=i.exec(e);if(null===n)break;let s=n[1],a=n[3],o=n[4],l=n[5],u=this._webgpuProcessingContext.availableBuffers[o];if(!u){let e,t="uniform"===s?r.E.KnownUBOs[l]:null;t?(o=l,-1===(e=t.binding).groupIndex&&((e=this._webgpuProcessingContext.availableBuffers[o]?.binding)||(e=this._webgpuProcessingContext.getNextFreeUBOBinding()))):e=this._webgpuProcessingContext.getNextFreeUBOBinding(),u={binding:e},this._webgpuProcessingContext.availableBuffers[o]=u}this._addBufferBindingDescription(o,this._webgpuProcessingContext.availableBuffers[o],"read_write"===a?"storage":"storage"===s?"read-only-storage":"uniform",t);let h=u.binding.groupIndex,c=u.binding.bindingIndex,d=e.substring(0,n.index),p=`@group(${h}) @binding(${c}) `;e=d+p+e.substring(n.index),i.lastIndex+=p.length}return e}_processStridedUniformArrays(e){for(let t of this._stridedUniformArrays)e=e.replace(RegExp(`${t}\\s*\\[(.*?)\\]`,"g"),`${t}[$1].el`);return e}}},28858(e,t,i){i.d(t,{V:()=>n});var r=i(31656);class n{constructor(e,t,i){this._record=!1,this._play=!1,this._playBundleListIndex=0,this._allBundleLists=[],this._enabled=!1,this.showDebugLogs=!1,this._engine=e,this._mode=t,this._bundleList=i}get enabled(){return this._enabled}get play(){return this._play}get record(){return this._record}set enabled(e){this._log("enabled",`activate=${e}, mode=${this._mode}`),this._allBundleLists.length=0,this._record=this._enabled=e,this._play=!1,e&&(this._modeSaved=this._mode,this._mode=0)}get mode(){return this._mode}set mode(e){this._record?this._modeSaved=e:this._mode=e}endRenderPass(e){if(!this._record&&!this._play)return!1;let t=null;return this._record?(t=this._bundleList.clone(),this._allBundleLists.push(t),this._bundleList.reset(),this._log("endRenderPass",`bundleList recorded at position #${this._allBundleLists.length-1}`)):this._playBundleListIndex>=this._allBundleLists.length?this._log("endRenderPass",`empty or out-of-sync bundleList (_allBundleLists.length=${this._allBundleLists.length}, playBundleListIndex=${this._playBundleListIndex})`):(this._log("endRenderPass",`run bundleList #${this._playBundleListIndex}`),t=this._allBundleLists[this._playBundleListIndex++]),t&&(t.run(e),1===this._mode&&this._engine._reportDrawCall(t.numDrawCalls)),!0}endFrame(){this._record&&(this._record=!1,this._play=!0,this._mode=this._modeSaved,this._log("endFrame","bundles recorded, switching to play mode")),this._playBundleListIndex=0}reset(){this._log("reset","called"),this._record&&(this._mode=this._modeSaved),this.enabled=!1,this.enabled=!0}_log(e,t){this.showDebugLogs&&r.V.Log(`[Frame: ${this._engine.frameId}] WebGPUSnapshotRendering:${e} - ${t}`)}}},36943(e,t,i){i.d(t,{K:()=>n});var r=i(31369);class n extends r.u{constructor(e){super(!1),this._cache=e,this.reset()}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._cache.setStencilCompare(e))}get backFunc(){return this._backFunc}set backFunc(e){this._backFunc!==e&&(this._backFunc=e,this._cache.setStencilBackCompare(e))}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._cache.setStencilReadMask(e))}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._cache.setStencilFailOp(e))}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._cache.setStencilDepthFailOp(e))}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._cache.setStencilPassOp(e))}get backOpStencilFail(){return this._backOpStencilFail}set backOpStencilFail(e){this._backOpStencilFail!==e&&(this._backOpStencilFail=e,this._cache.setStencilBackFailOp(e))}get backOpDepthFail(){return this._backOpDepthFail}set backOpDepthFail(e){this._backOpDepthFail!==e&&(this._backOpDepthFail=e,this._cache.setStencilBackDepthFailOp(e))}get backOpStencilDepthPass(){return this._backOpStencilDepthPass}set backOpStencilDepthPass(e){this._backOpStencilDepthPass!==e&&(this._backOpStencilDepthPass=e,this._cache.setStencilBackPassOp(e))}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._cache.setStencilWriteMask(e))}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._cache.setStencilEnabled(e))}reset(){super.reset(),this._cache.resetStencilState()}apply(){let e=!this.useStencilGlobalOnly&&!!this.stencilMaterial?.enabled;this.enabled=e?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.enabled&&(this.mask=e?this.stencilMaterial.mask:this.stencilGlobal.mask,this.funcRef=e?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=e?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.func=e?this.stencilMaterial.func:this.stencilGlobal.func,this.opStencilFail=e?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=e?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=e?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.backFunc=e?this.stencilMaterial.backFunc:this.stencilGlobal.backFunc,this.backOpStencilFail=e?this.stencilMaterial.backOpStencilFail:this.stencilGlobal.backOpStencilFail,this.backOpDepthFail=e?this.stencilMaterial.backOpDepthFail:this.stencilGlobal.backOpDepthFail,this.backOpStencilDepthPass=e?this.stencilMaterial.backOpStencilDepthPass:this.stencilGlobal.backOpStencilDepthPass)}}},75337(e,t,i){i.d(t,{m:()=>n});var r=i(39058);class n{static ComputeNumMipmapLevels(e,t){return(0,r.ILog2)(Math.max(e,t))+1}static GetTextureTypeFromFormat(e){switch(e){case"r8unorm":case"r8uint":case"rg8unorm":case"rg8uint":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8uint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb10a2uint":case"rgb10a2unorm":case"rgb9e5ufloat":case"rg11b10ufloat":case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc5-rg-unorm":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc4-r-unorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"eac-r11unorm":case"eac-rg11unorm":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":case"stencil8":break;case"r8snorm":case"r8sint":case"rg8snorm":case"rg8sint":case"rgba8snorm":case"rgba8sint":case"bc6h-rgb-float":case"bc5-rg-snorm":case"bc4-r-snorm":case"eac-r11snorm":case"eac-rg11snorm":return 3;case"r16uint":case"r16unorm":case"rg16unorm":case"rgba16unorm":case"rg16uint":case"rgba16uint":case"depth16unorm":return 5;case"r16sint":case"r16snorm":case"rg16snorm":case"rgba16snorm":case"rg16sint":case"rgba16sint":return 4;case"r16float":case"rg16float":case"rgba16float":return 2;case"r32uint":case"rg32uint":case"rgba32uint":case"r32sint":case"rg32sint":case"rgba32sint":return 7;case"r32float":case"rg32float":case"rgba32float":case"depth32float":case"depth32float-stencil8":case"depth24plus":case"depth24plus-stencil8":return 1}return 0}static GetBlockInformationFromFormat(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16unorm":case"r16snorm":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rg16unorm":case"rg16snorm":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2uint":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":break;case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":case"rgba16unorm":case"rgba16snorm":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw"No fixed size for Stencil8 format!";case"depth24plus":throw"No fixed size for Depth24Plus format!";case"depth24plus-stencil8":throw"No fixed size for Depth24PlusStencil8 format!";case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc5-rg-unorm":case"bc5-rg-snorm":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"eac-rg11unorm":case"eac-rg11snorm":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"eac-r11unorm":case"eac-r11snorm":return{width:4,height:4,length:8};case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":return{width:5,height:4,length:16};case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":return{width:5,height:5,length:16};case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":return{width:6,height:5,length:16};case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":return{width:6,height:6,length:16};case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":return{width:8,height:5,length:16};case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":return{width:8,height:6,length:16};case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":return{width:8,height:8,length:16};case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":return{width:10,height:5,length:16};case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":return{width:10,height:6,length:16};case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":return{width:10,height:8,length:16};case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":return{width:10,height:10,length:16};case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":return{width:12,height:10,length:16};case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":return{width:12,height:12,length:16}}return{width:1,height:1,length:4}}static IsHardwareTexture(e){return!!e.release}static IsInternalTexture(e){return!!e.dispose}static IsImageBitmap(e){return void 0!==e.close}static IsImageBitmapArray(e){return Array.isArray(e)&&void 0!==e[0].close}static IsCompressedFormat(e){switch(e){case"bc7-rgba-unorm-srgb":case"bc7-rgba-unorm":case"bc6h-rgb-float":case"bc6h-rgb-ufloat":case"bc5-rg-snorm":case"bc5-rg-unorm":case"bc4-r-snorm":case"bc4-r-unorm":case"bc3-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc1-rgba-unorm-srgb":case"bc1-rgba-unorm":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"eac-r11unorm":case"eac-r11snorm":case"eac-rg11unorm":case"eac-rg11snorm":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":return!0}return!1}static GetWebGPUTextureFormat(e,t,i=!1){switch(t){case 15:return"depth16unorm";case 16:return"depth24plus";case 13:return"depth24plus-stencil8";case 14:return"depth32float";case 18:return"depth32float-stencil8";case 19:return"stencil8";case 36492:return i?"bc7-rgba-unorm-srgb":"bc7-rgba-unorm";case 36495:return"bc6h-rgb-ufloat";case 36494:return"bc6h-rgb-float";case 33779:return i?"bc3-rgba-unorm-srgb":"bc3-rgba-unorm";case 33778:return i?"bc2-rgba-unorm-srgb":"bc2-rgba-unorm";case 33777:case 33776:return i?"bc1-rgba-unorm-srgb":"bc1-rgba-unorm";case 37808:return i?"astc-4x4-unorm-srgb":"astc-4x4-unorm";case 36196:case 37492:return i?"etc2-rgb8unorm-srgb":"etc2-rgb8unorm";case 37496:return i?"etc2-rgba8unorm-srgb":"etc2-rgba8unorm"}switch(e){case 3:switch(t){case 6:return"r8snorm";case 7:return"rg8snorm";case 4:throw"RGB format not supported in WebGPU";case 8:return"r8sint";case 9:return"rg8sint";case 10:throw"RGB_INTEGER format not supported in WebGPU";case 11:return"rgba8sint";default:return"rgba8snorm"}case 0:switch(t){case 6:return"r8unorm";case 7:return"rg8unorm";case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case 5:return i?"rgba8unorm-srgb":"rgba8unorm";case 12:return i?"bgra8unorm-srgb":"bgra8unorm";case 8:return"r8uint";case 9:return"rg8uint";case 10:throw"RGB_INTEGER format not supported in WebGPU";case 11:return"rgba8uint";case 0:throw"TEXTUREFORMAT_ALPHA format not supported in WebGPU";case 1:throw"TEXTUREFORMAT_LUMINANCE format not supported in WebGPU";case 2:throw"TEXTUREFORMAT_LUMINANCE_ALPHA format not supported in WebGPU";default:return"rgba8unorm"}case 4:switch(t){case 8:return"r16sint";case 9:return"rg16sint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return"rgba16sint"}case 5:switch(t){case 8:return"r16uint";case 9:return"rg16uint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return"rgba16uint"}case 6:switch(t){case 8:return"r32sint";case 9:return"rg32sint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return"rgba32sint"}case 7:switch(t){case 8:return"r32uint";case 9:return"rg32uint";case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return"rgba32uint"}case 1:switch(t){case 6:return"r32float";case 7:return"rg32float";case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";default:return"rgba32float"}case 2:switch(t){case 6:return"r16float";case 7:return"rg16float";case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";default:return"rgba16float"}case 10:throw"TEXTURETYPE_UNSIGNED_SHORT_5_6_5 format not supported in WebGPU";case 13:switch(t){case 5:default:return"rg11b10ufloat";case 11:throw"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV"}case 14:switch(t){case 5:default:return"rgb9e5ufloat";case 11:throw"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV"}case 8:throw"TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 format not supported in WebGPU";case 9:throw"TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 format not supported in WebGPU";case 11:switch(t){case 5:default:return"rgb10a2unorm";case 11:return"rgb10a2uint"}}return i?"rgba8unorm-srgb":"rgba8unorm"}static GetNumChannelsFromWebGPUTextureFormat(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":case"bc4-r-unorm":case"bc4-r-snorm":case"r16uint":case"r16sint":case"depth16unorm":case"r16float":case"r16unorm":case"r16snorm":case"r32uint":case"r32sint":case"r32float":case"depth32float":case"stencil8":case"depth24plus":case"eac-r11unorm":case"eac-r11snorm":return 1;case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth32float-stencil8":case"bc5-rg-unorm":case"bc5-rg-snorm":case"rg16uint":case"rg16sint":case"rg16float":case"rg16unorm":case"rg16snorm":case"rg32uint":case"rg32sint":case"rg32float":case"depth24plus-stencil8":case"eac-rg11unorm":case"eac-rg11snorm":return 2;case"rgb9e5ufloat":case"rg11b10ufloat":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"etc2-rgb8unorm":case"etc2-rgb8unorm-srgb":return 3;case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgba16unorm":case"rgba16snorm":case"rgb10a2uint":case"rgb10a2unorm":case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":case"rgba16uint":case"rgba16sint":case"rgba16float":case"rgba32uint":case"rgba32sint":case"rgba32float":case"etc2-rgb8a1unorm":case"etc2-rgb8a1unorm-srgb":case"etc2-rgba8unorm":case"etc2-rgba8unorm-srgb":case"astc-4x4-unorm":case"astc-4x4-unorm-srgb":case"astc-5x4-unorm":case"astc-5x4-unorm-srgb":case"astc-5x5-unorm":case"astc-5x5-unorm-srgb":case"astc-6x5-unorm":case"astc-6x5-unorm-srgb":case"astc-6x6-unorm":case"astc-6x6-unorm-srgb":case"astc-8x5-unorm":case"astc-8x5-unorm-srgb":case"astc-8x6-unorm":case"astc-8x6-unorm-srgb":case"astc-8x8-unorm":case"astc-8x8-unorm-srgb":case"astc-10x5-unorm":case"astc-10x5-unorm-srgb":case"astc-10x6-unorm":case"astc-10x6-unorm-srgb":case"astc-10x8-unorm":case"astc-10x8-unorm-srgb":case"astc-10x10-unorm":case"astc-10x10-unorm-srgb":case"astc-12x10-unorm":case"astc-12x10-unorm-srgb":case"astc-12x12-unorm":case"astc-12x12-unorm-srgb":return 4}throw`Unknown format ${e}!`}static HasStencilAspect(e){switch(e){case"stencil8":case"depth32float-stencil8":case"depth24plus-stencil8":return!0}return!1}static HasDepthAspect(e){switch(e){case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":return!0}return!1}static HasDepthAndStencilAspects(e){switch(e){case"depth32float-stencil8":case"depth24plus-stencil8":return!0}return!1}static GetDepthFormatOnly(e){switch(e){case"depth16unorm":return"depth16unorm";case"depth24plus":case"depth24plus-stencil8":return"depth24plus";case"depth32float":case"depth32float-stencil8":return"depth32float"}return e}static GetSample(e){return e>1?4:1}}},56058(e,t,i){i.d(t,{g:()=>S,n:()=>E});var r,n,s,a,o=i(28899),l=i(97845),u=i(75337),h=i(39543);let c=`
    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));
    const tex = array<vec2<f32>, 4>( vec2f(0.0f, 0.0f),  vec2f(1.0f, 0.0f),  vec2f(0.0f, 1.0f),  vec2f(1.0f, 1.0f));

    varying vTex: vec2f;

    @vertex
    fn main(input : VertexInputs) -> FragmentInputs {
        vertexOutputs.vTex = tex[input.vertexIndex];
        vertexOutputs.position = vec4f(pos[input.vertexIndex], 0.0, 1.0);
    }
    `,d=`
    var imgSampler: sampler;
    var img: texture_2d<f32>;

    varying vTex: vec2f;

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
        fragmentOutputs.color = textureSample(img, imgSampler, input.vTex);
    }
    `,p=`
    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));
    const tex = array<vec2<f32>, 4>( vec2f(0.0f, 0.0f),  vec2f(1.0f, 0.0f),  vec2f(0.0f, 1.0f),  vec2f(1.0f, 1.0f));

    var img: texture_2d<f32>;

    #ifdef INVERTY
        varying vTextureSize: vec2f;
    #endif

    @vertex
    fn main(input : VertexInputs) -> FragmentInputs {
        #ifdef INVERTY
            vertexOutputs.vTextureSize = vec2f(textureDimensions(img, 0));
        #endif
        vertexOutputs.position =  vec4f(pos[input.vertexIndex], 0.0, 1.0);
    }
    `,f=`
    var img: texture_2d<f32>;

    #ifdef INVERTY
        varying vTextureSize: vec2f;
    #endif

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
    #ifdef INVERTY
        var color: vec4f = textureLoad(img, vec2i(i32(input.position.x), i32(input.vTextureSize.y - input.position.y)), 0);
    #else
        var color: vec4f = textureLoad(img, vec2i(input.position.xy), 0);
    #endif
    #ifdef PREMULTIPLYALPHA
        color = vec4f(color.rgb * color.a, color.a);
    #endif
        fragmentOutputs.color = color;
    }
    `,_=`
    var img: texture_2d<f32>;
    uniform ofstX: f32;
    uniform ofstY: f32;
    uniform width: f32;
    uniform height: f32;

    #ifdef INVERTY
        varying vTextureSize: vec2f;
    #endif

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
        if (input.position.x < uniforms.ofstX || input.position.x >= uniforms.ofstX + uniforms.width) {
            discard;
        }
        if (input.position.y < uniforms.ofstY || input.position.y >= uniforms.ofstY + uniforms.height) {
            discard;
        }
    #ifdef INVERTY
        var color: vec4f = textureLoad(img, vec2i(i32(input.position.x), i32(uniforms.ofstY + uniforms.height - (input.position.y - uniforms.ofstY))), 0);
    #else
        var color: vec4f = textureLoad(img, vec2i(input.position.xy), 0);
    #endif
    #ifdef PREMULTIPLYALPHA
        color = vec4f(color.rgb * color.a, color.a);
    #endif
        fragmentOutputs.color = color;
    }
    `,m=`
    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));

    @vertex
    fn main(input : VertexInputs) -> FragmentInputs {
        vertexOutputs.position =  vec4f(pos[input.vertexIndex], 0.0, 1.0);
    }
    `,g=`
    uniform color: vec4f;

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
        fragmentOutputs.color = uniforms.color;
    }
    `,b=`
    struct VertexOutput {
        @builtin(position) Position : vec4<f32>,
        @location(0) fragUV : vec2<f32>
    }

    @vertex
    fn main(
        @builtin(vertex_index) VertexIndex : u32
    ) -> VertexOutput {
        var pos = array<vec2<f32>, 4>(
            vec2(-1.0,  1.0),
            vec2( 1.0,  1.0),
            vec2(-1.0, -1.0),
            vec2( 1.0, -1.0)
        );
        var tex = array<vec2<f32>, 4>(
            vec2(0.0, 0.0),
            vec2(1.0, 0.0),
            vec2(0.0, 1.0),
            vec2(1.0, 1.0)
        );

        var output: VertexOutput;

        output.Position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);
        output.fragUV = tex[VertexIndex];

        return output;
    }
    `,y=`
    @group(0) @binding(0) var videoSampler: sampler;
    @group(0) @binding(1) var videoTexture: texture_external;

    @fragment
    fn main(
        @location(0) fragUV: vec2<f32>
    ) -> @location(0) vec4<f32> {
        return textureSampleBaseClampToEdge(videoTexture, videoSampler, fragUV);
    }
    `,x=`
    @group(0) @binding(0) var videoSampler: sampler;
    @group(0) @binding(1) var videoTexture: texture_external;

    @fragment
    fn main(
        @location(0) fragUV: vec2<f32>
    ) -> @location(0) vec4<f32> {
        return textureSampleBaseClampToEdge(videoTexture, videoSampler, vec2<f32>(fragUV.x, 1.0 - fragUV.y));
    }
    `,T=`
    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));

    @vertex
    fn main(input : VertexInputs) -> FragmentInputs {
        vertexOutputs.position = vec4f(pos[input.vertexIndex], 0.0, 1.0);
    }
    `,v=`
    var msaaDepthTexture: texture_depth_multisampled_2d;

    @fragment
    fn main(input: FragmentInputs) -> FragmentOutputs {
    #ifdef USE_MIN
        let numSamples = textureNumSamples(msaaDepthTexture);
        var depth = 1.0;

        for (var i = 0u; i < numSamples; i = i + 1u) {
            depth = min(depth, textureLoad(msaaDepthTexture, vec2u(input.position.xy), i));
        }
        
        fragmentOutputs.color = vec4f(depth);
    #else
        fragmentOutputs.color = vec4f(textureLoad(msaaDepthTexture, vec2u(input.position.xy), 0)); // do like WebGL, take the first sample
    #endif
    }
    `;(r=s||(s={}))[r.MipMap=0]="MipMap",r[r.InvertYPremultiplyAlpha=1]="InvertYPremultiplyAlpha",r[r.Clear=2]="Clear",r[r.InvertYPremultiplyAlphaWithOfst=3]="InvertYPremultiplyAlphaWithOfst",r[r.ResolveDepth=4]="ResolveDepth",(n=a||(a={}))[n.DontInvertY=0]="DontInvertY",n[n.InvertY=1]="InvertY";let A=[{vertex:c,fragment:d},{vertex:p,fragment:f},{vertex:m,fragment:g},{vertex:p,fragment:_},{vertex:T,fragment:v}],S={"":0,r8unorm:1,r8uint:2,r8sint:3,r16uint:4,r16sint:5,r16float:6,rg8unorm:7,rg8uint:8,rg8sint:9,r32uint:10,r32sint:11,r32float:12,rg16uint:13,rg16sint:14,rg16float:15,rgba8unorm:16,"rgba8unorm-srgb":17,rgba8uint:18,rgba8sint:19,bgra8unorm:20,"bgra8unorm-srgb":21,rgb10a2uint:22,rgb10a2unorm:23,rg32uint:24,rg32sint:25,rg32float:26,rgba16uint:27,rgba16sint:28,rgba16float:29,rgba32uint:30,rgba32sint:31,rgba32float:32,stencil8:33,depth16unorm:34,depth24plus:35,"depth24plus-stencil8":36,depth32float:37,"depth32float-stencil8":38,r16unorm:39,rg16unorm:40,rgba16unorm:41,r16snorm:42,rg16snorm:43,rgba16snorm:44};class E{constructor(e,t,i,r){if(this._pipelines={},this._compiledShaders=[],this._videoPipelines={},this._videoCompiledShaders=[],this._deferredReleaseTextures=[],this._engine=e,this._device=t,this._bufferManager=i,-1!==r.indexOf("rg11b10ufloat-renderable")){const e=Object.keys(S);S.rg11b10ufloat=S[e[e.length-1]]+1}this._mipmapSampler=t.createSampler({minFilter:"linear"}),this._videoSampler=t.createSampler({minFilter:"linear"}),this._ubCopyWithOfst=this._bufferManager.createBuffer(16,o.Sd.Uniform|o.Sd.CopyDst,"UBCopyWithOffset").underlyingResource,this._getPipeline("rgba8unorm"),this._getVideoPipeline("rgba8unorm")}_getPipeline(e,t=s.MipMap,i){let r=t===s.MipMap?1:t===s.InvertYPremultiplyAlpha?(!!i.invertY<<1)+(!!i.premultiplyAlpha<<2):t===s.Clear?8:t===s.InvertYPremultiplyAlphaWithOfst?(!!i.invertY<<4)+(!!i.premultiplyAlpha<<5):64*(t===s.ResolveDepth);this._pipelines[e]||(this._pipelines[e]=[]);let n=this._pipelines[e][r];if(!n){let a="";(t===s.InvertYPremultiplyAlpha||t===s.InvertYPremultiplyAlphaWithOfst)&&(i.invertY&&(a+="#define INVERTY\n"),i.premultiplyAlpha&&(a+="#define PREMULTIPLYALPHA\n"));let o=this._compiledShaders[r];if(!o){let e=A[t].vertex,i=A[t].fragment,n={defines:a.split("\n"),indexParameters:null,isFragment:!1,shouldUseHighPrecisionShader:!0,processor:this._engine._getShaderProcessor(1),supportsUniformBuffers:!0,shadersRepository:"",includesShadersStore:{},version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._engine._getShaderProcessingContext(1,!0),isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer};(0,h.pB)(n),n.processor.pureMode=!0,(0,h.M0)(e,n,t=>{e=t},this._engine),n.isFragment=!0,(0,h.M0)(i,n,e=>{i=e},this._engine);let s=(0,h.nO)(e,i,n);n.processor.pureMode=!1;let l=this._device.createShaderModule({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalVertexShader_${r}`,code:s.vertexCode}),u=this._device.createShaderModule({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalFragmentShader_${r}`,code:s.fragmentCode});o=this._compiledShaders[r]=[l,u]}let l=this._device.createRenderPipeline({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalPipeline_${e}_${r}`,layout:"auto",vertex:{module:o[0],entryPoint:"main"},fragment:{module:o[1],entryPoint:"main",targets:[{format:e}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint16"}});n=this._pipelines[e][r]=[l,l.getBindGroupLayout(0)]}return n}_getVideoPipeline(e,t=a.DontInvertY){let i=+(t===a.InvertY);this._videoPipelines[e]||(this._videoPipelines[e]=[]);let r=this._videoPipelines[e][i];if(!r){let t=this._videoCompiledShaders[i];if(!t){let e=this._device.createShaderModule({code:b,label:`BabylonWebGPUDevice${this._engine.uniqueId}_CopyVideoToTexture_VertexShader`}),r=this._device.createShaderModule({code:0===i?y:x,label:`BabylonWebGPUDevice${this._engine.uniqueId}_CopyVideoToTexture_FragmentShader_${0===i?"DontInvertY":"InvertY"}`});t=this._videoCompiledShaders[i]=[e,r]}let n=this._device.createRenderPipeline({label:`BabylonWebGPUDevice${this._engine.uniqueId}_InternalVideoPipeline_${e}_${0===i?"DontInvertY":"InvertY"}`,layout:"auto",vertex:{module:t[0],entryPoint:"main"},fragment:{module:t[1],entryPoint:"main",targets:[{format:e}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint16"}});r=this._videoPipelines[e][i]=[n,n.getBindGroupLayout(0)]}return r}setCommandEncoder(e){this._commandEncoderForCreation=e}copyVideoToTexture(e,t,i,r=!1,n){let s=void 0===n,[o,l]=this._getVideoPipeline(i,r?a.InvertY:a.DontInvertY);s&&(n=this._device.createCommandEncoder({})),n.pushDebugGroup(`copy video to texture (invertY=${r})`);let u=t._hardwareTexture,h={label:`BabylonWebGPUDevice${this._engine.uniqueId}_copyVideoToTexture_${i}_${r?"InvertY":"DontInvertY"}${t.label?"_"+t.label:""}`,colorAttachments:[{view:u.underlyingResource.createView({format:i,dimension:"2d",mipLevelCount:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:1,aspect:"all"}),loadOp:"load",storeOp:"store"}]},c=n.beginRenderPass(h),d={layout:l,entries:[{binding:0,resource:this._videoSampler},{binding:1,resource:this._device.importExternalTexture({source:e.underlyingResource})}]},p=this._device.createBindGroup(d);c.setPipeline(o),c.setBindGroup(0,p),c.draw(4,1,0,0),c.end(),n.popDebugGroup(),s&&(this._device.queue.submit([n.finish()]),n=null)}invertYPreMultiplyAlpha(e,t,i,r,n=!1,a=!1,o=0,l=0,h=1,c=0,d=0,p=0,f=0,_,m){let g,b=0!==p,y=void 0===_,[x,T]=this._getPipeline(r,b?s.InvertYPremultiplyAlphaWithOfst:s.InvertYPremultiplyAlpha,{invertY:n,premultiplyAlpha:a});if(o=Math.max(o,0),y&&(_=this._device.createCommandEncoder({})),u.m.IsHardwareTexture(e)?(g=e.underlyingResource,n&&!a&&1===h&&0===o||(e=void 0)):(g=e,e=void 0),!g)return;_.pushDebugGroup(`internal process texture "${g.label}" (invertY=${n} premultiplyAlpha=${a})`),b&&this._bufferManager.setRawData(this._ubCopyWithOfst,0,new Float32Array([c,d,p,f]),0,16);let v=e,A=v?._copyInvertYTempTexture??this.createTexture({width:t,height:i,layers:1},!1,!1,!1,!1,!1,r,1,_,21,void 0,"TempTextureForCopyWithInvertY"),S=v?._copyInvertYRenderPassDescr??{label:`BabylonWebGPUDevice${this._engine.uniqueId}_invertYPreMultiplyAlpha_${r}_${n?"InvertY":"DontInvertY"}_${a?"PremultiplyAlpha":"DontPremultiplyAlpha"}`,colorAttachments:[{view:A.createView({format:r,dimension:"2d",baseMipLevel:0,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:0}),loadOp:"load",storeOp:"store"}]},E=_.beginRenderPass(S),I=b?v?._copyInvertYBindGroupWithOfst:v?._copyInvertYBindGroup;if(!I){let e={layout:T,entries:[{binding:0,resource:g.createView({format:r,dimension:"2d",baseMipLevel:l,mipLevelCount:1,arrayLayerCount:h,baseArrayLayer:o})}]};b&&e.entries.push({binding:1,resource:{buffer:this._ubCopyWithOfst}}),I=this._device.createBindGroup(e)}E.setPipeline(x),E.setBindGroup(0,I),E.draw(4,1,0,0),E.end(),_.copyTextureToTexture({texture:A},{texture:g,mipLevel:l,origin:{x:0,y:0,z:o}},{width:p||t,height:f||i,depthOrArrayLayers:1}),v?(v._copyInvertYTempTexture=A,v._copyInvertYRenderPassDescr=S,b?v._copyInvertYBindGroupWithOfst=I:v._copyInvertYBindGroup=I):this._deferredReleaseTextures.push([A,null]),_.popDebugGroup(),y&&(this._device.queue.submit([_.finish()]),_=null)}createTexture(e,t=!1,i=!1,r=!1,n=!1,s=!1,a="rgba8unorm",o=1,l,h=-1,c=0,d){o=u.m.GetSample(o);let p=e.layers||1,f={width:e.width,height:e.height,depthOrArrayLayers:p},_=16*!!S[a],m=u.m.IsCompressedFormat(a),g=t?u.m.ComputeNumMipmapLevels(e.width,e.height):1;c|=t&&!m?1|_:0,m||s||(c|=2|_);let b=this._device.createTexture({label:`BabylonWebGPUDevice${this._engine.uniqueId}_Texture${s?"3D":"2D"}_${d?d+"_":""}${f.width}x${f.height}x${f.depthOrArrayLayers}_${t?"wmips":"womips"}_${a}_samples${o}`,size:f,dimension:s?"3d":"2d",format:a,usage:(h>=0?h:7)|c,sampleCount:o,mipLevelCount:g});return u.m.IsImageBitmap(e)&&(this.updateTexture(e,b,e.width,e.height,p,a,0,0,r,n,0,0),t&&i&&this.generateMipmaps(b,g,0,l)),b}createCubeTexture(e,t=!1,i=!1,r=!1,n=!1,s="rgba8unorm",a=1,o,l=-1,h=0,c){a=u.m.GetSample(a);let d=u.m.IsImageBitmapArray(e)?e[0].width:e.width,p=u.m.IsImageBitmapArray(e)?e[0].height:e.height,f=u.m.IsImageBitmapArray(e)?1:e.layers,_=16*!!S[s],m=u.m.IsCompressedFormat(s),g=t?u.m.ComputeNumMipmapLevels(d,p):1;h|=t&&!m?1|_:0,m||(h|=2|_);let b=this._device.createTexture({label:`BabylonWebGPUDevice${this._engine.uniqueId}_TextureCube_${c?c+"_":""}${d}x${p}x${f}_${t?"wmips":"womips"}_${s}_samples${a}`,size:{width:d,height:p,depthOrArrayLayers:6*f},dimension:"2d",format:s,usage:(l>=0?l:7)|h,sampleCount:a,mipLevelCount:g});return u.m.IsImageBitmapArray(e)&&(this.updateCubeTextures(e,b,d,p,s,r,n,0,0),t&&i&&this.generateCubeMipmaps(b,g,o)),b}generateCubeMipmaps(e,t,i){let r=void 0===i,n=u.m.IsHardwareTexture(e)?e.underlyingResource:e;r&&(i=this._device.createCommandEncoder({})),i.pushDebugGroup(`create cube mipmaps for "${n.label}" (${t} levels)`);for(let r=0;r<n.depthOrArrayLayers;++r)this.generateMipmaps(e,t,r,i);i.popDebugGroup(),r&&(this._device.queue.submit([i.finish()]),i=null)}generateMipmaps(e,t,i=0,r){let n,s=void 0===r;if(i=Math.max(i,0),s&&(r=this._device.createCommandEncoder({})),u.m.IsHardwareTexture(e)?(n=e.underlyingResource,e._mipmapGenRenderPassDescr=e._mipmapGenRenderPassDescr||[],e._mipmapGenBindGroup=e._mipmapGenBindGroup||[]):(n=e,e=void 0),!n)return;r.pushDebugGroup(`create mipmaps for "${n.label}" (face #${i} - ${t} levels)`);let a=n.format,[o,l]=this._getPipeline(a),h="3d"===n.dimension,c=e;for(let e=1;e<t;++e){let t=c?._mipmapGenRenderPassDescr[i]?.[e-1]??{label:`BabylonWebGPUDevice${this._engine.uniqueId}_generateMipmaps_${a}_faceIndex${i}_level${e}`,colorAttachments:[{view:n.createView({format:a,dimension:h?"3d":"2d",baseMipLevel:e,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:i}),loadOp:"load",storeOp:"store"}]};c&&(c._mipmapGenRenderPassDescr[i]=c._mipmapGenRenderPassDescr[i]||[],c._mipmapGenRenderPassDescr[i][e-1]=t);let s=r.beginRenderPass(t),u=c?._mipmapGenBindGroup[i]?.[e-1]??this._device.createBindGroup({layout:l,entries:[{binding:0,resource:n.createView({format:a,dimension:h?"3d":"2d",baseMipLevel:e-1,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:i})},{binding:1,resource:this._mipmapSampler}]});c&&(c._mipmapGenBindGroup[i]=c._mipmapGenBindGroup[i]||[],c._mipmapGenBindGroup[i][e-1]=u),s.setPipeline(o),s.setBindGroup(0,u),s.draw(4,1,0,0),s.end()}r.popDebugGroup(),s&&(this._device.queue.submit([r.finish()]),r=null)}createGPUTextureForInternalTexture(e,t,i,r,n){let s;e._hardwareTexture||(e._hardwareTexture=new l.Q(this._engine)),void 0===t&&(t=e.width),void 0===i&&(i=e.height),void 0===r&&(r=e.depth),e.width=e.baseWidth=t,e.height=e.baseHeight=i,e.depth=e.baseDepth=r;let a=e._hardwareTexture,o=((n??0)&1)!=0;if(a.format=a.originalFormat=u.m.GetWebGPUTextureFormat(e.type,e.format,e._useSRGBBuffer),e.samples>1)switch(a.format){case"depth16unorm":a.format="r16unorm";break;case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":a.format="r32float"}a.textureUsages=5===e._source||6===e.source?21:12===e._source?20:-1,a.textureAdditionalUsages=8*!!o;let h=e.generateMipMaps,c=r||1;if(s=null!==e._maxLodLevel?e._maxLodLevel:h?u.m.ComputeNumMipmapLevels(t,i):1,e.isCube){let r=this.createCubeTexture({width:t,height:i,layers:c},e.generateMipMaps,e.generateMipMaps,e.invertY,!1,a.format,1,this._commandEncoderForCreation,a.textureUsages,a.textureAdditionalUsages,e.label);a.set(r);let n=u.m.GetDepthFormatOnly(a.format),l=u.m.HasDepthAndStencilAspects(a.format)?"depth-only":"all",d=e.is2DArray?"cube-array":"cube";a.createView({label:`BabylonWebGPUDevice${this._engine.uniqueId}_TextureViewCube${e.is2DArray?"_Array"+c:""}_${t}x${i}_${h?"wmips":"womips"}_${n}_${d}_${l}_${e.label??"noname"}`,format:n,dimension:d,mipLevelCount:s,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:6*c,aspect:l},o)}else{let r=this.createTexture({width:t,height:i,layers:c},e.generateMipMaps,e.generateMipMaps,e.invertY,!1,e.is3D,a.format,1,this._commandEncoderForCreation,a.textureUsages,a.textureAdditionalUsages,e.label);a.set(r);let n=e.is3D?1:c,l=u.m.GetDepthFormatOnly(a.format),d=u.m.HasDepthAndStencilAspects(a.format)?"depth-only":"all",p=e.is2DArray?"2d-array":e.is3D?"3d":"2d";a.createView({label:`BabylonWebGPUDevice${this._engine.uniqueId}_TextureView${e.is3D?"3D":"2D"}${e.is2DArray?"_Array"+n:""}_${t}x${i}${e.is3D?"x"+c:""}_${h?"wmips":"womips"}_${l}_${p}_${d}_${e.label??"noname"}`,format:l,dimension:p,mipLevelCount:s,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:n,aspect:d},o)}return a}createMSAATexture(e,t,i){return this.createTexture({width:e.width,height:e.height,layers:1},!1,!1,!1,!1,!1,t,i,this._commandEncoderForCreation,20,0,e.label?e.label+" (MSAA)":"MSAA")}resolveMSAADepthTexture(e,t,i){let r=t.format,n=void 0===i,[a,o]=this._getPipeline(r,s.ResolveDepth);n&&(i=this._device.createCommandEncoder({})),i.pushDebugGroup(`resolve MSAA Depth texture "${e.label}" to "${t.label}"`);let l={label:`BabylonWebGPUDevice${this._engine.uniqueId}_resolveMSAADepthTexture${e.label?"_"+e.label:""}`,colorAttachments:[{view:t,loadOp:"load",storeOp:"store"}]},h=i.beginRenderPass(l),c={layout:o,entries:[{binding:0,resource:e.createView({format:u.m.GetDepthFormatOnly(e.format),dimension:"2d",mipLevelCount:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:1,aspect:"depth-only"})}]},d=this._device.createBindGroup(c);h.setPipeline(a),h.setBindGroup(0,d),h.draw(4,1,0,0),h.end(),i.popDebugGroup(),n&&(this._device.queue.submit([i.finish()]),i=null)}updateCubeTextures(e,t,i,r,n,s=!1,a=!1,o=0,l=0){let u=[0,3,1,4,2,5];for(let h=0;h<u.length;++h){let c=e[u[h]];this.updateTexture(c,t,i,r,1,n,h,0,s,a,o,l)}}updateTexture(e,t,i,r,n,s,a=0,l=0,h=!1,c=!1,d=0,p=0,f){let _=u.m.IsInternalTexture(t)?t._hardwareTexture.underlyingResource:t,m=u.m.GetBlockInformationFromFormat(s),g=u.m.IsInternalTexture(t)?t._hardwareTexture:t,b={texture:_,origin:{x:d,y:p,z:Math.max(a,0)},mipLevel:l,premultipliedAlpha:c},y={width:Math.ceil(i/m.width)*m.width,height:Math.ceil(r/m.height)*m.height,depthOrArrayLayers:n||1};if(void 0!==e.byteLength){let x=Math.ceil(i/m.width)*m.length;if(256*Math.ceil(x/256)===x){let t=this._device.createCommandEncoder({}),i=this._bufferManager.createRawBuffer(e.byteLength,o.Sd.MapWrite|o.Sd.CopySrc,!0,"TempBufferForUpdateTexture"+(_?"_"+_.label:""));new Uint8Array(i.getMappedRange()).set(e),i.unmap(),t.copyBufferToTexture({buffer:i,offset:0,bytesPerRow:x,rowsPerImage:y.height/m.height},b,y),this._device.queue.submit([t.finish()]),this._bufferManager.releaseBuffer(i)}else this._device.queue.writeTexture(b,e,{offset:0,bytesPerRow:x,rowsPerImage:y.height/m.height},y);if(h||c)if(u.m.IsInternalTexture(t)){let e=0===d&&0===p&&i===t.width&&r===t.height;this.invertYPreMultiplyAlpha(g,t.width,t.height,s,h,c,a,l,n||1,d,p,e?0:i,e?0:r,void 0,f)}else throw"updateTexture: Can't process the texture data because a GPUTexture was provided instead of an InternalTexture!"}else this._device.queue.copyExternalImageToTexture({source:e,flipY:h},b,y)}readPixels(e,t,i,r,n,s,a=0,l=0,h=null,c=!1){let d=u.m.GetBlockInformationFromFormat(s),p=Math.ceil(r/d.width)*d.length,f=256*Math.ceil(p/256),_=f*n,m=this._bufferManager.createRawBuffer(_,o.Sd.MapRead|o.Sd.CopyDst,void 0,"TempBufferForReadPixels"+(e.label?"_"+e.label:"")),g=this._device.createCommandEncoder({});return g.copyTextureToBuffer({texture:e,mipLevel:l,origin:{x:t,y:i,z:Math.max(a,0)}},{buffer:m,offset:0,bytesPerRow:f},{width:r,height:n,depthOrArrayLayers:1}),this._device.queue.submit([g.finish()]),this._bufferManager.readDataFromBuffer(m,_,r,n,p,f,u.m.GetTextureTypeFromFormat(s),0,h,!0,c)}releaseTexture(e){if(u.m.IsInternalTexture(e)){let t=e._hardwareTexture,i=e._irradianceTexture;this._deferredReleaseTextures.push([t,i])}else this._deferredReleaseTextures.push([e,null])}destroyDeferredTextures(){for(let e=0;e<this._deferredReleaseTextures.length;++e){let[t,i]=this._deferredReleaseTextures[e];t&&(u.m.IsHardwareTexture(t)?t.release():t.destroy()),i?.dispose()}this._deferredReleaseTextures.length=0}}},7852(e,t,i){i.d(t,{e:()=>a});var r=i(9711),n=i(73604),s=i(31656);class a{get gpuFrameTimeCounter(){return this._gpuFrameTimeCounter}constructor(e,t,i){this._enabled=!1,this._gpuFrameTimeCounter=new r.A,this._measureDurationState=0,this._engine=e,this._device=t,this._bufferManager=i}get enable(){return this._enabled}set enable(e){if(this._enabled!==e)if(this._enabled=e,this._measureDurationState=0,e)try{this._measureDuration=new o(this._engine,this._device,this._bufferManager,2e3,"QuerySet_TimestampQuery")}catch(e){this._enabled=!1,s.V.Error("Could not create a WebGPUDurationMeasure!\nError: "+e.message+"\nMake sure timestamp query is supported and enabled in your browser.");return}else this._measureDuration.dispose()}startFrame(e){this._enabled&&0===this._measureDurationState&&(this._measureDuration.start(e),this._measureDurationState=1)}endFrame(e){1===this._measureDurationState&&(this._measureDurationState=2,this._measureDuration.stop(e).then(e=>{null!==e&&e>=0&&(this._gpuFrameTimeCounter.fetchNewFrame(),this._gpuFrameTimeCounter.addCount(e,!0)),this._measureDurationState=0}))}startPass(e,t){this._enabled?this._measureDuration.startPass(e,t):e.timestampWrites=void 0}endPass(e,t){if(!this._enabled||!t)return;let i=this._engine.frameId;this._measureDuration.stopPass(e).then(e=>{t._addDuration(i,null!==e&&e>0?e:0)})}dispose(){this._measureDuration?.dispose()}}class o{constructor(e,t,i,r=2,s){this._count=r,this._querySet=new n.L(e,r,"timestamp",t,i,!0,s)}start(e){e.writeTimestamp?.(this._querySet.querySet,0)}async stop(e){return e.writeTimestamp?.(this._querySet.querySet,1),e.writeTimestamp?await this._querySet.readTwoValuesAndSubtract(0):0}startPass(e,t){if(t+3>this._count)throw Error("WebGPUDurationMeasure: index out of range ("+t+")");e.timestampWrites={querySet:this._querySet.querySet,beginningOfPassWriteIndex:t+2,endOfPassWriteIndex:t+3}}async stopPass(e){return await this._querySet.readTwoValuesAndSubtract(e+2)}dispose(){this._querySet.dispose()}}},7836(e,t,i){i.d(t,{Y:()=>r});class r{}r.AUTOSAMPLERSUFFIX="Sampler",r.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",r.ALPHA_DISABLE=0,r.ALPHA_ADD=1,r.ALPHA_COMBINE=2,r.ALPHA_SUBTRACT=3,r.ALPHA_MULTIPLY=4,r.ALPHA_MAXIMIZED=5,r.ALPHA_ONEONE=6,r.ALPHA_PREMULTIPLIED=7,r.ALPHA_PREMULTIPLIED_PORTERDUFF=8,r.ALPHA_INTERPOLATE=9,r.ALPHA_SCREENMODE=10,r.ALPHA_ONEONE_ONEONE=11,r.ALPHA_ALPHATOCOLOR=12,r.ALPHA_REVERSEONEMINUS=13,r.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,r.ALPHA_ONEONE_ONEZERO=15,r.ALPHA_EXCLUSION=16,r.ALPHA_LAYER_ACCUMULATE=17,r.ALPHA_MIN=18,r.ALPHA_MAX=19,r.ALPHA_DUAL_SRC0_ADD_SRC1xDST=20,r.ALPHA_EQUATION_ADD=0,r.ALPHA_EQUATION_SUBSTRACT=1,r.ALPHA_EQUATION_REVERSE_SUBTRACT=2,r.ALPHA_EQUATION_MAX=3,r.ALPHA_EQUATION_MIN=4,r.ALPHA_EQUATION_DARKEN=5,r.DELAYLOADSTATE_NONE=0,r.DELAYLOADSTATE_LOADED=1,r.DELAYLOADSTATE_LOADING=2,r.DELAYLOADSTATE_NOTLOADED=4,r.NEVER=512,r.ALWAYS=519,r.LESS=513,r.EQUAL=514,r.LEQUAL=515,r.GREATER=516,r.GEQUAL=518,r.NOTEQUAL=517,r.KEEP=7680,r.ZERO=0,r.REPLACE=7681,r.INCR=7682,r.DECR=7683,r.INVERT=5386,r.INCR_WRAP=34055,r.DECR_WRAP=34056,r.TEXTURE_CLAMP_ADDRESSMODE=0,r.TEXTURE_WRAP_ADDRESSMODE=1,r.TEXTURE_MIRROR_ADDRESSMODE=2,r.TEXTURE_CREATIONFLAG_STORAGE=1,r.TEXTUREFORMAT_ALPHA=0,r.TEXTUREFORMAT_LUMINANCE=1,r.TEXTUREFORMAT_LUMINANCE_ALPHA=2,r.TEXTUREFORMAT_RGB=4,r.TEXTUREFORMAT_RGBA=5,r.TEXTUREFORMAT_RED=6,r.TEXTUREFORMAT_R=6,r.TEXTUREFORMAT_R16_UNORM=33322,r.TEXTUREFORMAT_RG16_UNORM=33324,r.TEXTUREFORMAT_RGB16_UNORM=32852,r.TEXTUREFORMAT_RGBA16_UNORM=32859,r.TEXTUREFORMAT_R16_SNORM=36760,r.TEXTUREFORMAT_RG16_SNORM=36761,r.TEXTUREFORMAT_RGB16_SNORM=36762,r.TEXTUREFORMAT_RGBA16_SNORM=36763,r.TEXTUREFORMAT_RG=7,r.TEXTUREFORMAT_RED_INTEGER=8,r.TEXTUREFORMAT_R_INTEGER=8,r.TEXTUREFORMAT_RG_INTEGER=9,r.TEXTUREFORMAT_RGB_INTEGER=10,r.TEXTUREFORMAT_RGBA_INTEGER=11,r.TEXTUREFORMAT_BGRA=12,r.TEXTUREFORMAT_DEPTH24_STENCIL8=13,r.TEXTUREFORMAT_DEPTH32_FLOAT=14,r.TEXTUREFORMAT_DEPTH16=15,r.TEXTUREFORMAT_DEPTH24=16,r.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,r.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,r.TEXTUREFORMAT_STENCIL8=19,r.TEXTUREFORMAT_UNDEFINED=0xffffffff,r.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,r.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,r.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,r.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,r.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,r.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,r.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,r.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,r.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,r.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,r.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,r.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,r.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,r.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,r.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,r.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,r.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,r.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,r.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,r.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,r.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,r.TEXTURETYPE_UNSIGNED_BYTE=0,r.TEXTURETYPE_UNSIGNED_INT=0,r.TEXTURETYPE_FLOAT=1,r.TEXTURETYPE_HALF_FLOAT=2,r.TEXTURETYPE_BYTE=3,r.TEXTURETYPE_SHORT=4,r.TEXTURETYPE_UNSIGNED_SHORT=5,r.TEXTURETYPE_INT=6,r.TEXTURETYPE_UNSIGNED_INTEGER=7,r.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,r.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,r.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,r.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,r.TEXTURETYPE_UNSIGNED_INT_24_8=12,r.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,r.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,r.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,r.TEXTURETYPE_UNDEFINED=16,r.TEXTURE_2D=3553,r.TEXTURE_2D_ARRAY=35866,r.TEXTURE_CUBE_MAP=34067,r.TEXTURE_CUBE_MAP_ARRAY=0xdeadbeef,r.TEXTURE_3D=32879,r.TEXTURE_NEAREST_SAMPLINGMODE=1,r.TEXTURE_NEAREST_NEAREST=1,r.TEXTURE_BILINEAR_SAMPLINGMODE=2,r.TEXTURE_LINEAR_LINEAR=2,r.TEXTURE_TRILINEAR_SAMPLINGMODE=3,r.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,r.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,r.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,r.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,r.TEXTURE_NEAREST_LINEAR=7,r.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,r.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,r.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,r.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,r.TEXTURE_LINEAR_NEAREST=12,r.TEXTURE_EXPLICIT_MODE=0,r.TEXTURE_SPHERICAL_MODE=1,r.TEXTURE_PLANAR_MODE=2,r.TEXTURE_CUBIC_MODE=3,r.TEXTURE_PROJECTION_MODE=4,r.TEXTURE_SKYBOX_MODE=5,r.TEXTURE_INVCUBIC_MODE=6,r.TEXTURE_EQUIRECTANGULAR_MODE=7,r.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,r.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,r.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,r.TEXTURE_FILTERING_QUALITY_HIGH=64,r.TEXTURE_FILTERING_QUALITY_MEDIUM=16,r.TEXTURE_FILTERING_QUALITY_LOW=8,r.SCALEMODE_FLOOR=1,r.SCALEMODE_NEAREST=2,r.SCALEMODE_CEILING=3,r.MATERIAL_TextureDirtyFlag=1,r.MATERIAL_LightDirtyFlag=2,r.MATERIAL_FresnelDirtyFlag=4,r.MATERIAL_AttributesDirtyFlag=8,r.MATERIAL_MiscDirtyFlag=16,r.MATERIAL_PrePassDirtyFlag=32,r.MATERIAL_ImageProcessingDirtyFlag=64,r.MATERIAL_AllDirtyFlag=127,r.MATERIAL_TriangleFillMode=0,r.MATERIAL_WireFrameFillMode=1,r.MATERIAL_PointFillMode=2,r.MATERIAL_PointListDrawMode=3,r.MATERIAL_LineListDrawMode=4,r.MATERIAL_LineLoopDrawMode=5,r.MATERIAL_LineStripDrawMode=6,r.MATERIAL_TriangleStripDrawMode=7,r.MATERIAL_TriangleFanDrawMode=8,r.MATERIAL_ClockWiseSideOrientation=0,r.MATERIAL_CounterClockWiseSideOrientation=1,r.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,r.MATERIAL_DIFFUSE_MODEL_BURLEY=1,r.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,r.MATERIAL_DIFFUSE_MODEL_LEGACY=3,r.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,r.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,r.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,r.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,r.ACTION_NothingTrigger=0,r.ACTION_OnPickTrigger=1,r.ACTION_OnLeftPickTrigger=2,r.ACTION_OnRightPickTrigger=3,r.ACTION_OnCenterPickTrigger=4,r.ACTION_OnPickDownTrigger=5,r.ACTION_OnDoublePickTrigger=6,r.ACTION_OnPickUpTrigger=7,r.ACTION_OnPickOutTrigger=16,r.ACTION_OnLongPressTrigger=8,r.ACTION_OnPointerOverTrigger=9,r.ACTION_OnPointerOutTrigger=10,r.ACTION_OnEveryFrameTrigger=11,r.ACTION_OnIntersectionEnterTrigger=12,r.ACTION_OnIntersectionExitTrigger=13,r.ACTION_OnKeyDownTrigger=14,r.ACTION_OnKeyUpTrigger=15,r.PARTICLES_BILLBOARDMODE_Y=2,r.PARTICLES_BILLBOARDMODE_ALL=7,r.PARTICLES_BILLBOARDMODE_STRETCHED=8,r.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,r.MESHES_CULLINGSTRATEGY_STANDARD=0,r.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,r.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,r.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,r.SCENELOADER_NO_LOGGING=0,r.SCENELOADER_MINIMAL_LOGGING=1,r.SCENELOADER_SUMMARY_LOGGING=2,r.SCENELOADER_DETAILED_LOGGING=3,r.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,r.PREPASS_POSITION_TEXTURE_TYPE=1,r.PREPASS_VELOCITY_TEXTURE_TYPE=2,r.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,r.PREPASS_COLOR_TEXTURE_TYPE=4,r.PREPASS_DEPTH_TEXTURE_TYPE=5,r.PREPASS_NORMAL_TEXTURE_TYPE=6,r.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,r.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,r.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,r.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,r.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,r.PREPASS_ALBEDO_TEXTURE_TYPE=12,r.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,r.BUFFER_CREATIONFLAG_READ=1,r.BUFFER_CREATIONFLAG_WRITE=2,r.BUFFER_CREATIONFLAG_READWRITE=3,r.BUFFER_CREATIONFLAG_UNIFORM=4,r.BUFFER_CREATIONFLAG_VERTEX=8,r.BUFFER_CREATIONFLAG_INDEX=16,r.BUFFER_CREATIONFLAG_STORAGE=32,r.BUFFER_CREATIONFLAG_INDIRECT=64,r.RENDERPASS_MAIN=0,r.INPUT_ALT_KEY=18,r.INPUT_CTRL_KEY=17,r.INPUT_META_KEY1=91,r.INPUT_META_KEY2=92,r.INPUT_META_KEY3=93,r.INPUT_SHIFT_KEY=16,r.SNAPSHOTRENDERING_STANDARD=0,r.SNAPSHOTRENDERING_FAST=1,r.PERSPECTIVE_CAMERA=0,r.ORTHOGRAPHIC_CAMERA=1,r.FOVMODE_VERTICAL_FIXED=0,r.FOVMODE_HORIZONTAL_FIXED=1,r.RIG_MODE_NONE=0,r.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,r.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,r.RIG_MODE_STEREOSCOPIC_INTERLACED=14,r.RIG_MODE_VR=20,r.RIG_MODE_CUSTOM=22,r.MAX_SUPPORTED_UV_SETS=6,r.GL_ALPHA_EQUATION_ADD=32774,r.GL_ALPHA_EQUATION_MIN=32775,r.GL_ALPHA_EQUATION_MAX=32776,r.GL_ALPHA_EQUATION_SUBTRACT=32778,r.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,r.GL_ALPHA_FUNCTION_SRC=768,r.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,r.GL_ALPHA_FUNCTION_SRC_ALPHA=770,r.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,r.GL_ALPHA_FUNCTION_DST_ALPHA=772,r.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,r.GL_ALPHA_FUNCTION_DST_COLOR=774,r.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,r.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,r.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,r.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,r.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,r.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,r.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,r.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,r.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,r.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,r.SnippetUrl="https://snippet.babylonjs.com",r.FOGMODE_NONE=0,r.FOGMODE_EXP=1,r.FOGMODE_EXP2=2,r.FOGMODE_LINEAR=3,r.BYTE=5120,r.UNSIGNED_BYTE=5121,r.SHORT=5122,r.UNSIGNED_SHORT=5123,r.INT=5124,r.UNSIGNED_INT=5125,r.FLOAT=5126,r.PositionKind="position",r.NormalKind="normal",r.TangentKind="tangent",r.UVKind="uv",r.UV2Kind="uv2",r.UV3Kind="uv3",r.UV4Kind="uv4",r.UV5Kind="uv5",r.UV6Kind="uv6",r.ColorKind="color",r.ColorInstanceKind="instanceColor",r.MatricesIndicesKind="matricesIndices",r.MatricesWeightsKind="matricesWeights",r.MatricesIndicesExtraKind="matricesIndicesExtra",r.MatricesWeightsExtraKind="matricesWeightsExtra",r.ANIMATIONTYPE_FLOAT=0,r.ANIMATIONTYPE_VECTOR3=1,r.ANIMATIONTYPE_QUATERNION=2,r.ANIMATIONTYPE_MATRIX=3,r.ANIMATIONTYPE_COLOR3=4,r.ANIMATIONTYPE_COLOR4=7,r.ANIMATIONTYPE_VECTOR2=5,r.ANIMATIONTYPE_SIZE=6,r.ShadowMinZ=0,r.ShadowMaxZ=1e4},56863(e,t,i){i.d(t,{l:()=>r});class r{static GetShadersRepository(e=0){return 0===e?r.ShadersRepository:r.ShadersRepositoryWGSL}static GetShadersStore(e=0){return 0===e?r.ShadersStore:r.ShadersStoreWGSL}static GetIncludesShadersStore(e=0){return 0===e?r.IncludesShadersStore:r.IncludesShadersStoreWGSL}}r.ShadersRepository="src/Shaders/",r.ShadersStore={},r.IncludesShadersStore={},r.ShadersRepositoryWGSL="src/ShadersWGSL/",r.ShadersStoreWGSL={},r.IncludesShadersStoreWGSL={}},9572(e,t,i){i.d(t,{M:()=>o});var r=i(87201),n=i(31656),s=i(75337),a=i(93695);class o extends r.${constructor(){super(...arguments),this.dbgShowShaderCode=!1,this.dbgSanityChecks=!0,this.dbgVerboseLogsNumFrames=10,this.dbgLogIfNotDrawWrapper=!0,this.dbgShowEmptyEnableEffectCalls=!0,this.dbgVerboseLogsForFirstFrames=!1,this._currentRenderPass=null,this._snapshotRenderingMode=0,this._timestampIndex=0}get enableGPUTimingMeasurements(){return this._timestampQuery.enable}set enableGPUTimingMeasurements(e){this._timestampQuery.enable!==e&&(this.gpuTimeInFrameForMainPass=e?new a.e:void 0,this._timestampQuery.enable=e)}_currentPassIsMainPass(){return null===this._currentRenderTarget}_endCurrentRenderPass(){if(!this._currentRenderPass)return 0;let e=this._currentPassIsMainPass()?2:1;return this._snapshotRendering.endRenderPass(this._currentRenderPass)||this.compatibilityMode||(this._bundleList.run(this._currentRenderPass),this._bundleList.reset()),this._currentRenderPass.end(),this._timestampQuery.endPass(this._timestampIndex,this._currentRenderTarget&&this._currentRenderTarget.gpuTimeInFrame?this._currentRenderTarget.gpuTimeInFrame:this.gpuTimeInFrameForMainPass),this._timestampIndex+=2,this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&n.V.Log("frame #"+this._count+" - "+(2===e?"main":"render target")+" end pass"+(1===e?" - internalTexture.uniqueId="+this._currentRenderTarget?.texture?.uniqueId:""))),this._currentRenderPass=null,e}_generateMipmaps(e,t){t=t??this._renderEncoder;let i=e._hardwareTexture;if(!i)return;t===this._renderEncoder&&this._endCurrentRenderPass();let r=s.m.ComputeNumMipmapLevels(e.width,e.height);this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&n.V.Log("frame #"+this._count+" - generate mipmaps - width="+e.width+", height="+e.height+", isCube="+e.isCube+", command encoder="+(t===this._renderEncoder?"render":"copy"))),e.isCube?this._textureHelper.generateCubeMipmaps(i,r,t):this._textureHelper.generateMipmaps(i,r,0,t)}}},45507(e,t,i){i.d(t,{M:()=>n});var r=i(56849);class n extends r.w{constructor(e,t){if(super(e),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),t)for(const e of t)this._eventsSignalOutputs[e]=this._registerSignalOutput(e+"Event")}_executeOnTick(e){}_startPendingTasks(e){e._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(e),this._resetAfterCanceled(e)),this._preparePendingTasks(e),e._addPendingBlock(this),this.out._activateSignal(e),e._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(e){e._deleteExecutionVariable(this,"_initialized"),e._removePendingBlock(this)}}},56849(e,t,i){i.d(t,{w:()=>n});var r=i(12785);class n extends r.u{constructor(e){super(e),this.out=this._registerSignalOutput("out")}}},15315(e,t,i){i.d(t,{T:()=>n});var r=i(3107);class n extends r.L{constructor(){super(...arguments),this._layerAndFaceIndicesUpdated=!1}setOutputLayerAndFaceIndices(e){this._outputLayerAndFaceIndices=e,this._layerAndFaceIndicesUpdated=e.length>0}_updateLayerAndFaceIndices(e){this._layerAndFaceIndicesUpdated&&(e.setOutputLayerAndFaceIndices(this._outputLayerAndFaceIndices),this._layerAndFaceIndicesUpdated=!1)}}},8438(e,t,i){i.d(t,{K:()=>h});var r=i(9633),n=i(75318),s=i(64798),a=i(3765),o=i(83580),l=i(34380),u=i(76971);Object.defineProperty(r.Z.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new s.b(this);let e=this._getComponent(n.v.NAME_GAMEPAD);e||(e=new h(this),this._addComponent(e))}return this._gamepadManager},enumerable:!0,configurable:!0}),a.s.prototype.addGamepad=function(){return this.add(new o.t),this},l.H.prototype.addGamepad=function(){return this.add(new u.Y),this};class h{constructor(e){this.name=n.v.NAME_GAMEPAD,this.scene=e}register(){}rebuild(){}dispose(){let e=this.scene._gamepadManager;e&&(e.dispose(),this.scene._gamepadManager=null)}}},53030(e,t,i){i.d(t,{z:()=>m});var r=i(31656),n=i(9633),s=i(70134),a=i(49578),o=i(35666),l=i(85822),u=i(51776),h=i(35702),c=i(76921),d=i(2062),p=i(77479);i(49207),i(42121),i(82955);var f=i(77194),_=i(76759),m=!0;n.Z.prototype.createDefaultLight=function(e=!1){if(e&&this.lights)for(let e=0;e<this.lights.length;e++)this.lights[e].dispose();0===this.lights.length&&new u.g("default light",s.Pq.Up(),this)},n.Z.prototype.createDefaultCamera=function(e=!1,t=!1,i=!1){if(t&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){let t,r=this.getWorldExtends(e=>e.isVisible&&e.isEnabled()),n=r.max.subtract(r.min),a=r.min.add(n.scale(.5)),o=1.5*n.length();if(isFinite(o)&&0!==o||(o=1,a.copyFromFloats(0,0,0)),e){let e=new d.Lq("default camera",-(Math.PI/2),Math.PI/2,o,a,this);e.lowerRadiusLimit=.01*o,e.wheelPrecision=100/o,t=e}else{let e=new c.S("default camera",new s.Pq(a.x,a.y,-o),this);e.setTarget(a),t=e}t.minZ=.01*o,t.maxZ=1e3*o,t.speed=.2*o,this.activeCamera=t,i&&t.attachControl()}},n.Z.prototype.createDefaultCameraOrLight=function(e=!1,t=!1,i=!1){this.createDefaultLight(t),this.createDefaultCamera(e,t,i)},n.Z.prototype.createDefaultSkybox=function(e,t=!1,i=1e3,n=0,s=!0){if(!e)return r.V.Warn("Can not create default skybox without environment texture."),null;s&&e&&(this.environmentTexture=e);let u=(0,f.an)("hdrSkyBox",{size:i},this);if(t){let t=new l.PBRMaterial("skyBox",this);t.backFaceCulling=!1,t.reflectionTexture=e.clone(),t.reflectionTexture&&(t.reflectionTexture.coordinatesMode=a.g.SKYBOX_MODE),t.microSurface=1-n,t.disableLighting=!0,t.twoSidedLighting=!0,u.material=t}else{let t=new o.F("skyBox",this);t.backFaceCulling=!1,t.reflectionTexture=e.clone(),t.reflectionTexture&&(t.reflectionTexture.coordinatesMode=a.g.SKYBOX_MODE),t.disableLighting=!0,u.material=t}return u.isPickable=!1,u.infiniteDistance=!0,u.ignoreCameraMaxZ=!0,u},n.Z.prototype.createDefaultEnvironment=function(e){return h.y?new h.y(e,this):null},n.Z.prototype.createDefaultVRExperience=function(e={}){return new p.L(this,e)},n.Z.prototype.createDefaultXRExperienceAsync=async function(e={}){return await _.u.CreateAsync(this,e)}},95669(e,t,i){i.d(t,{d:()=>r});class r{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}},50690(e,t,i){i.d(t,{e:()=>f});var r=i(555),n=i(90734),s=i(81520),a=i(70134),o=i(96691),l=i(15047),u=i(46042),h=i(52040),c=i(94470),d=i(90368);class p{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(e){this._singleClick=e}set doubleClick(e){this._doubleClick=e}set hasSwiped(e){this._hasSwiped=e}set ignore(e){this._ignore=e}}class f{constructor(e){if(this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=[],this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new a.I9(0,0),this._previousStartingPointerPosition=new a.I9(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=e||c.q.LastCreatedScene,!this._scene)return}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(e){return this._meshUnderPointerId[e]||null}get unTranslatedPointer(){return new a.I9(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(e){this._pointerX=e}get pointerY(){return this._pointerY}set pointerY(e){this._pointerY=e}_updatePointerPosition(e){let t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(e,t){let i,n=this._scene,s=n.getEngine(),a=s.getInputElement();for(let i of(a&&(a.tabIndex=s.canvasTabIndex,n.doNotHandleCursors||(a.style.cursor=n.defaultCursor)),this._setCursorAndPointerOverMesh(e,t,n),n._pointerMoveStage)){e=e||this._pickMove(t);let r=!!e?.pickedMesh;e=i.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,r,a)}let o=t.inputIndex>=u.ST.MouseWheelX&&t.inputIndex<=u.ST.MouseWheelZ?r.Zp.POINTERWHEEL:r.Zp.POINTERMOVE;n.onPointerMove&&(e=e||this._pickMove(t),n.onPointerMove(t,e,o)),e?(i=new r.mx(o,t,e),this._setRayOnPointerInfo(e,t)):(i=new r.mx(o,t,null,this),this._movePointerInfo=i),n.onPointerObservable.hasObservers()&&n.onPointerObservable.notifyObservers(i,o)}_setRayOnPointerInfo(e,t){let i=this._scene;e&&d.h._IsPickingAvailable&&!e.ray&&(e.ray=i.createPickingRay(t.offsetX,t.offsetY,a.uq.Identity(),i.activeCamera))}_addCameraPointerObserver(e,t){return this._cameraObserverCount++,this._scene.onPointerObservable.add(e,t)}_removeCameraPointerObserver(e){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(e)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(e,t,i){let n=this._scene,s=new r.tT(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(s.originalPickingInfo=e,s.ray=e.ray,"xr-near"===t.pointerType&&e.originMesh&&(s.nearInteractionPickingInfo=e)),n.onPrePointerObservable.notifyObservers(s,i),!!s.skipOnPointerObservable}_pickMove(e){let t=this._scene,i=t.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerMovePredicate,t.pointerMoveFastCheck,t.cameraToUseForPointers,t.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(i,e,t),i}_setCursorAndPointerOverMesh(e,t,i){let r=i.getEngine().getInputElement();if(e?.pickedMesh){if(this.setPointerOverMesh(e.pickedMesh,t.pointerId,e,t),!i.doNotHandleCursors&&r&&this._pointerOverMesh){let e=this._pointerOverMesh._getActionManagerForTrigger();e&&e.hasPointerTriggers&&(r.style.cursor=e.hoverCursor||i.hoverCursor)}}else this.setPointerOverMesh(null,t.pointerId,e,t)}simulatePointerMove(e,t){let i=new PointerEvent("pointermove",t);i.inputIndex=u.ST.Move,this._checkPrePointerObservable(e,i,r.Zp.POINTERMOVE)||this._processPointerMove(e,i)}simulatePointerDown(e,t){let i=new PointerEvent("pointerdown",t);i.inputIndex=i.button+2,this._checkPrePointerObservable(e,i,r.Zp.POINTERDOWN)||this._processPointerDown(e,i)}_processPointerDown(e,t){let i,n=this._scene;if(e?.pickedMesh){this._pickedDownMesh=e.pickedMesh;let i=e.pickedMesh._getActionManagerForTrigger();if(i){if(i.hasPickTriggers)switch(i.processTrigger(5,new o.X(e.pickedMesh,n.pointerX,n.pointerY,e.pickedMesh,t,e)),t.button){case 0:i.processTrigger(2,new o.X(e.pickedMesh,n.pointerX,n.pointerY,e.pickedMesh,t,e));break;case 1:i.processTrigger(4,new o.X(e.pickedMesh,n.pointerX,n.pointerY,e.pickedMesh,t,e));break;case 2:i.processTrigger(3,new o.X(e.pickedMesh,n.pointerX,n.pointerY,e.pickedMesh,t,e))}i.hasSpecificTrigger(8)&&window.setTimeout(()=>{let e=n.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,e=>e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===this._pickedDownMesh,!1,n.cameraToUseForPointers);e?.pickedMesh&&i&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>f.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,i.processTrigger(8,o.X.CreateNew(e.pickedMesh,t)))},f.LongPressDelay)}}else for(let i of n._pointerDownStage)e=i.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,!1);let s=r.Zp.POINTERDOWN;e?(n.onPointerDown&&n.onPointerDown(t,e,s),i=new r.mx(s,t,e),this._setRayOnPointerInfo(e,t)):i=new r.mx(s,t,null,this),n.onPointerObservable.hasObservers()&&n.onPointerObservable.notifyObservers(i,s)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(e,t,i){let n=new PointerEvent("pointerup",t);n.inputIndex=u.ST.Move;let s=new p;i?s.doubleClick=!0:s.singleClick=!0,this._checkPrePointerObservable(e,n,r.Zp.POINTERUP)||this._processPointerUp(e,n,s)}_processPointerUp(e,t,i){let n=this._scene;if(e?.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(n.onPointerPick&&n.onPointerPick(t,e),i.singleClick&&!i.ignore&&n.onPointerObservable.observers.length>this._cameraObserverCount)){let i=r.Zp.POINTERPICK,s=new r.mx(i,t,e);this._setRayOnPointerInfo(e,t),n.onPointerObservable.notifyObservers(s,i)}let s=e.pickedMesh._getActionManagerForTrigger();if(s&&!i.ignore){s.processTrigger(7,o.X.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&s.processTrigger(1,o.X.CreateNew(e.pickedMesh,t,e));let r=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&r&&r.processTrigger(6,o.X.CreateNew(e.pickedMesh,t,e))}}else if(!i.ignore)for(let r of n._pointerUpStage)e=r.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,i.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){let e=this._pickedDownMesh._getActionManagerForTrigger(16);e&&e.processTrigger(16,o.X.CreateNew(this._pickedDownMesh,t))}if(!i.ignore){let s=new r.mx(r.Zp.POINTERUP,t,e);if(this._setRayOnPointerInfo(e,t),n.onPointerObservable.notifyObservers(s,r.Zp.POINTERUP),n.onPointerUp&&n.onPointerUp(t,e,r.Zp.POINTERUP),!i.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let s=0;if(i.singleClick?s=r.Zp.POINTERTAP:i.doubleClick&&(s=r.Zp.POINTERDOUBLETAP),s){let i=new r.mx(s,t,e);n.onPointerObservable.hasObservers()&&n.onPointerObservable.hasSpecificMask(s)&&n.onPointerObservable.notifyObservers(i,s)}}}}isPointerCaptured(e=0){return this._pointerCaptures[e]}attachControl(e=!0,t=!0,i=!0,a=null){let c=this._scene,d=c.getEngine();a||(a=d.getInputElement()),this._alreadyAttached&&this.detachControl(),a&&(this._alreadyAttachedTo=a),this._deviceSourceManager=new h.Z(d),this._initActionManager=e=>{if(!this._meshPickProceed){let t=!c.skipPointerUpPicking&&(0!==c._registeredActions||this._checkForPicking()||c.onPointerUp)?c.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,c.pointerUpPredicate,c.pointerUpFastCheck,c.cameraToUseForPointers,c.pointerUpTrianglePredicate):null;this._currentPickResult=t,t&&(e=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return e},this._delayedSimpleClick=(e,t,i)=>{if((Date.now()-this._previousStartingPointerTime>f.DoubleClickDelay&&!this._doubleClickOccured||e!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1,this._delayedClicks[e])){let t=this._delayedClicks[e].evt,i=r.Zp.POINTERTAP,n=new r.mx(i,t,this._currentPickResult);c.onPointerObservable.hasObservers()&&c.onPointerObservable.hasSpecificMask(i)&&c.onPointerObservable.notifyObservers(n,i),this._delayedClicks[e]=null}},this._initClickEvent=(e,t,i,s)=>{let a=new p;this._currentPickResult=null;let o=null,l=e.hasSpecificMask(r.Zp.POINTERPICK)||t.hasSpecificMask(r.Zp.POINTERPICK)||e.hasSpecificMask(r.Zp.POINTERTAP)||t.hasSpecificMask(r.Zp.POINTERTAP)||e.hasSpecificMask(r.Zp.POINTERDOUBLETAP)||t.hasSpecificMask(r.Zp.POINTERDOUBLETAP);!l&&n.G&&(o=this._initActionManager(o,a))&&(l=o.hasPickTriggers);let u=!1;if(l=l&&!this._isMultiTouchGesture){let l=i.button;if(a.hasSwiped=this._isPointerSwiping(),!a.hasSwiped){let h=!f.ExclusiveDoubleClickMode;if(!h&&(h=!e.hasSpecificMask(r.Zp.POINTERDOUBLETAP)&&!t.hasSpecificMask(r.Zp.POINTERDOUBLETAP))&&!n.G.HasSpecificTrigger(6)&&(o=this._initActionManager(o,a))&&(h=!o.hasSpecificTrigger(6)),h)(Date.now()-this._previousStartingPointerTime>f.DoubleClickDelay||l!==this._previousButtonPressed)&&(a.singleClick=!0,s(a,this._currentPickResult),u=!0);else{let e={evt:i,clickInfo:a,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,l,a,s),f.DoubleClickDelay)};this._delayedClicks[l]=e}let c=e.hasSpecificMask(r.Zp.POINTERDOUBLETAP)||t.hasSpecificMask(r.Zp.POINTERDOUBLETAP);!c&&n.G.HasSpecificTrigger(6)&&(o=this._initActionManager(o,a))&&(c=o.hasSpecificTrigger(6)),c&&(l===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<f.DoubleClickDelay&&!this._doubleClickOccured?(a.hasSwiped||this._isPointerSwiping()?(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=l,f.ExclusiveDoubleClickMode?(this._delayedClicks[l]&&(clearTimeout(this._delayedClicks[l]?.timeoutId),this._delayedClicks[l]=null),s(a,this._previousPickResult)):s(a,this._currentPickResult)):(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,a.doubleClick=!0,a.ignore=!1,f.ExclusiveDoubleClickMode&&this._delayedClicks[l]&&(clearTimeout(this._delayedClicks[l]?.timeoutId),this._delayedClicks[l]=null),s(a,this._currentPickResult)),u=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=l))}}u||s(a,this._currentPickResult)},this._onPointerMove=e=>{if(this._updatePointerPosition(e),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>f.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>f.DragMovementThreshold),d.isPointerLock&&d._verifyPointerLock(),this._checkPrePointerObservable(null,e,e.inputIndex>=u.ST.MouseWheelX&&e.inputIndex<=u.ST.MouseWheelZ?r.Zp.POINTERWHEEL:r.Zp.POINTERMOVE)||!c.cameraToUseForPointers&&!c.activeCamera)return;if(c.skipPointerMovePicking)return void this._processPointerMove(new s.G,e);c.pointerMovePredicate||(c.pointerMovePredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||c.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!c.cameraToUseForPointers||(c.cameraToUseForPointers.layerMask&e.layerMask)!=0));let t=c._registeredActions>0||c.constantlyUpdateMeshUnderPointer?this._pickMove(e):null;this._processPointerMove(t,e)},this._onPointerDown=e=>{let t,i=this._activePointerIds.indexOf(-1);if(-1===i?this._activePointerIds.push(e.pointerId):this._activePointerIds[i]=e.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,f.ExclusiveDoubleClickMode){for(let t=0;t<this._delayedClicks.length;t++)if(this._delayedClicks[t])if(e.button===t)clearTimeout(this._delayedClicks[t]?.timeoutId);else{let e=this._delayedClicks[t].clickInfo;this._doubleClickOccured=!1,e.singleClick=!0,e.ignore=!1;let i=this._delayedClicks[t].evt,n=r.Zp.POINTERTAP,s=new r.mx(n,i,this._currentPickResult);c.onPointerObservable.hasObservers()&&c.onPointerObservable.hasSpecificMask(n)&&c.onPointerObservable.notifyObservers(s,n),this._delayedClicks[t]=null}}this._updatePointerPosition(e),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=e.button),c.preventDefaultOnPointerDown&&a&&(e.preventDefault(),a.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,e,r.Zp.POINTERDOWN)||(c.cameraToUseForPointers||c.activeCamera)&&(this._pointerCaptures[e.pointerId]=!0,c.pointerDownPredicate||(c.pointerDownPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!c.cameraToUseForPointers||(c.cameraToUseForPointers.layerMask&e.layerMask)!=0)),this._pickedDownMesh=null,t=!c.skipPointerDownPicking&&(0!==c._registeredActions||this._checkForPicking()||c.onPointerDown)?c.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,c.pointerDownPredicate,c.pointerDownFastCheck,c.cameraToUseForPointers,c.pointerDownTrianglePredicate):new s.G,this._processPointerDown(t,e))},this._onPointerUp=e=>{let t=this._activePointerIds.indexOf(e.pointerId);-1!==t&&(this._activePointerIds[t]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(e),c.preventDefaultOnPointerUp&&a&&(e.preventDefault(),a.focus()),this._initClickEvent(c.onPrePointerObservable,c.onPointerObservable,e,(t,i)=>{if(c.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!t.ignore)){if(this._checkPrePointerObservable(null,e,r.Zp.POINTERUP)){this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1);return}!t.hasSwiped&&(t.singleClick&&c.onPrePointerObservable.hasSpecificMask(r.Zp.POINTERTAP)&&this._checkPrePointerObservable(null,e,r.Zp.POINTERTAP)&&(this._skipPointerTap=!0),t.doubleClick&&c.onPrePointerObservable.hasSpecificMask(r.Zp.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,e,r.Zp.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}if(!this._pointerCaptures[e.pointerId]){this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1);return}0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1),(c.cameraToUseForPointers||c.activeCamera)&&(c.pointerUpPredicate||(c.pointerUpPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!c.cameraToUseForPointers||(c.cameraToUseForPointers.layerMask&e.layerMask)!=0)),!this._meshPickProceed&&(n.G&&n.G.HasTriggers||this._checkForPicking()||c.onPointerUp)&&this._initActionManager(null,t),i||(i=this._currentPickResult),this._processPointerUp(i,e,t),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))}))},this._onKeyDown=e=>{let t=l.TB.KEYDOWN;if(c.onPreKeyboardObservable.hasObservers()){let i=new l.Bu(t,e);if(c.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(c.onKeyboardObservable.hasObservers()){let i=new l.W0(t,e);c.onKeyboardObservable.notifyObservers(i,t)}c.actionManager&&c.actionManager.processTrigger(14,o.X.CreateNewFromScene(c,e))},this._onKeyUp=e=>{let t=l.TB.KEYUP;if(c.onPreKeyboardObservable.hasObservers()){let i=new l.Bu(t,e);if(c.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(c.onKeyboardObservable.hasObservers()){let i=new l.W0(t,e);c.onKeyboardObservable.notifyObservers(i,t)}c.actionManager&&c.actionManager.processTrigger(15,o.X.CreateNewFromScene(c,e))},this._deviceSourceManager.onDeviceConnectedObservable.add(r=>{r.deviceType===u.bq.Mouse?r.onInputChangedObservable.add(n=>{this._originMouseEvent=n,n.inputIndex===u.ST.LeftClick||n.inputIndex===u.ST.MiddleClick||n.inputIndex===u.ST.RightClick||n.inputIndex===u.ST.BrowserBack||n.inputIndex===u.ST.BrowserForward?t&&1===r.getInput(n.inputIndex)?this._onPointerDown(n):e&&0===r.getInput(n.inputIndex)&&this._onPointerUp(n):i&&(n.inputIndex===u.ST.Move?this._onPointerMove(n):(n.inputIndex===u.ST.MouseWheelX||n.inputIndex===u.ST.MouseWheelY||n.inputIndex===u.ST.MouseWheelZ)&&this._onPointerMove(n))}):r.deviceType===u.bq.Touch?r.onInputChangedObservable.add(n=>{n.inputIndex===u.ST.LeftClick&&(t&&1===r.getInput(n.inputIndex)?(this._onPointerDown(n),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):e&&0===r.getInput(n.inputIndex)&&(this._onPointerUp(n),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),i&&n.inputIndex===u.ST.Move&&this._onPointerMove(n)}):r.deviceType===u.bq.Keyboard&&r.onInputChangedObservable.add(e=>{"keydown"===e.type?this._onKeyDown(e):"keyup"===e.type&&this._onKeyUp(e)})}),this._alreadyAttached=!0}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(e,t=0,i,r){let n;if(this._meshUnderPointerId[t]===e&&(!e||!e._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;let s=this._meshUnderPointerId[t];s&&(n=s._getActionManagerForTrigger(10))&&n.processTrigger(10,new o.X(s,this._pointerX,this._pointerY,e,r,{pointerId:t})),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,(n=e._getActionManagerForTrigger(9))&&n.processTrigger(9,new o.X(e,this._pointerX,this._pointerY,e,r,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:e,pointerId:t})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(e){for(let t in this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]}}f.DragMovementThreshold=10,f.LongPressDelay=500,f.DoubleClickDelay=300,f.ExclusiveDoubleClickMode=!1},10701(e,t,i){i.d(t,{U:()=>o});var r=i(26623),n=i(75318),s=i(59194),a=i(94470);(0,i(30403).ji)(n.v.NAME_EFFECTLAYER,(e,t,i,r)=>{if(e.effectLayers){i.effectLayers||(i.effectLayers=[]);for(let n=0;n<e.effectLayers.length;n++){let a=s.p.Parse(e.effectLayers[n],t,r);i.effectLayers.push(a)}}});class o{constructor(e){if(this.name=n.v.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=e||a.q.LastCreatedScene,!this.scene)return;this._engine=this.scene.getEngine()}register(){this.scene._isReadyForMeshStage.registerStep(n.v.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(n.v.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(n.v.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(n.v.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(n.v.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(n.v.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)}rebuild(){for(let e of this.scene.effectLayers)e._rebuild()}serialize(e){for(let t of(e.effectLayers=[],this.scene.effectLayers))t.serialize&&e.effectLayers.push(t.serialize())}addFromContainer(e){if(e.effectLayers)for(let t of e.effectLayers)this.scene.addEffectLayer(t)}removeFromContainer(e,t){if(e.effectLayers)for(let i of e.effectLayers)this.scene.removeEffectLayer(i),t&&i.dispose()}dispose(){let e=this.scene.effectLayers;for(;e.length;)e[0].dispose()}_isReadyForMesh(e,t){let i=this._engine.currentRenderPassId;for(let r of this.scene.effectLayers){if(!r.hasMesh(e))continue;let n=r._mainTexture;for(let s of(this._engine.currentRenderPassId=n.renderPassId,e.subMeshes))if(!r.isReady(s,t))return this._engine.currentRenderPassId=i,!1}return this._engine.currentRenderPassId=i,!0}_renderMainTexture(e){this._renderEffects=!1,this._needStencil=!1;let t=!1,i=this.scene.effectLayers;if(i&&i.length>0){for(let n of(this._previousStencilState=this._engine.getStencilBuffer(),i))if(n.shouldRender()&&(!n.camera||n.camera.cameraRigMode===r.i.RIG_MODE_NONE&&e===n.camera||n.camera.cameraRigMode!==r.i.RIG_MODE_NONE&&n.camera._rigCameras.indexOf(e)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||n.needStencil();let e=n._mainTexture;e._shouldRender()&&(this.scene.incrementRenderId(),e.render(!1,!1),t=!0)}this.scene.incrementRenderId()}return t}_setStencil(){this._needStencil&&this._engine.setStencilBuffer(!0)}_setStencilBack(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)}_draw(e){if(this._renderEffects){this._engine.setDepthBuffer(!1);let t=this.scene.effectLayers;for(let i=0;i<t.length;i++){let r=t[i];r.renderingGroupId===e&&r.shouldRender()&&r.render()}this._engine.setDepthBuffer(!0)}}_drawCamera(){this._renderEffects&&this._draw(-1)}_drawRenderingGroup(e){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(e)}}s.p._SceneComponentInitialization=e=>{let t=e._getComponent(n.v.NAME_EFFECTLAYER);t||(t=new o(e),e._addComponent(t))}},23211(e,t,i){i.d(t,{d:()=>a});var r=i(75318),n=i(52559),s=i(58926);class a{constructor(e){this.name=r.v.NAME_CLUSTEREDLIGHTING,this._gatherActiveCameraRenderTargets=e=>{for(let t of this.scene.lights)t.getTypeID()===s.c.LIGHTTYPEID_CLUSTERED_CONTAINER&&t.isSupported&&e.push(t._updateBatches())},this.scene=e}dispose(){}rebuild(){}register(){this.scene._gatherActiveCameraRenderTargetsStage.registerStep(r.v.STEP_GATHERACTIVECAMERARENDERTARGETS_CLUSTEREDLIGHTING,this,this._gatherActiveCameraRenderTargets)}}n.H._SceneComponentInitialization=e=>{e._getComponent(r.v.NAME_CLUSTEREDLIGHTING)||e._addComponent(new a(e))}},80775(e,t,i){i.d(t,{D:()=>n});var r=i(32997);async function n(){let e=new Uint16Array(16384),t=new Uint16Array(16384),i=new Uint16Array(await r.S0.LoadFileAsync(r.S0.GetAssetUrl("https://assets.babylonjs.com/core/areaLights/areaLightsLTC.bin"))),n=i.length/8;for(let r=0;r<n;r++)e[4*r]=i[8*r],e[4*r+1]=i[8*r+1],e[4*r+2]=i[8*r+2],e[4*r+3]=i[8*r+3],t[4*r]=i[8*r+4],t[4*r+1]=i[8*r+5],t[4*r+2]=i[8*r+6],t[4*r+3]=i[8*r+7];return[e,t]}},84165(e,t,i){i.d(t,{Qn:()=>D,Ss:()=>H,lF:()=>N});var r=i(31656),n=i(26623),s=i(70134),a=i(19002),o=i(66886),l=i(23487),u=i(60871),h=i(21383),c=i(2340),d=i(22253),p=i(70731),f=i(65748),_=i(51527),m=i(75318),g=i(89389),b=i(94902),y=i(66578),x=i(26520),T=i(72218),v=i(71572),A=i(13961),S=i(52204),E=i(50518),I=i(80396),R=i(27371),P=i(32997),M=i(74266),C=i(42236),O=i(30403),w=i(52969),D=!0;class N{}N.LoaderInjectedPhysicsEngine=void 0;let L={},F={},B={},k=(e,t,i,r)=>{if(!t.materials)return null;for(let n=0,s=t.materials.length;n<s;n++){let s=t.materials[n];if(e(s))return{parsedMaterial:s,material:h.i.Parse(s,i,r)}}return null},U=(e,t,i)=>{for(let r in t)if(e.name===t[r])return i.push(e.id),!0;return void 0!==e.parentId&&-1!==i.indexOf(e.parentId)&&(i.push(e.id),!0)},V=(e,t)=>e+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown"),G=(e,t)=>{if(t._waitingData.lods){if(t._waitingData.lods.ids&&t._waitingData.lods.ids.length>0){let i=t._waitingData.lods.ids,r=t.isEnabled(!1);if(t._waitingData.lods.distances){let n=t._waitingData.lods.distances;if(n.length>=i.length){let s=n.length>i.length?n[n.length-1]:0;t.setEnabled(!1);for(let r=0;r<i.length;r++){let s=i[r],a=e.getMeshById(s);null!=a&&t.addLODLevel(n[r],a)}s>0&&t.addLODLevel(s,null),!0===r&&t.setEnabled(!0)}else P.S0.Warn("Invalid level of detail distances for "+t.name)}}t._waitingData.lods=null}},z=(e,t,i)=>{if("number"!=typeof e){let r=i.getLastEntryById(e);return r&&null!=t?r.instances[parseInt(t)]:r}let r=L[e];return r&&null!=t?r.instances[parseInt(t)]:r},$=(e,t)=>"number"!=typeof e?t.getLastMaterialById(e,!0):F[e];function H(e,t,i){return W(e,t,i)}let W=(e,t,i,s,a=!1)=>{let m=new y.WZ(e);a||(e._blockEntityCollection=!0);let g="importScene has failed JSON parse";try{let r,s;var A="object"==typeof t?t:JSON.parse(t);g="";let y=3===b.B.loggingLevel;if(void 0!==A.environmentTexture&&null!==A.environmentTexture){let t=void 0===A.isPBR||A.isPBR;if(A.environmentTextureType&&"BABYLON.HDRCubeTexture"===A.environmentTextureType){let r=A.environmentTextureSize?A.environmentTextureSize:128,n=new p.H((A.environmentTexture.match(/https?:\/\//g)?"":i)+A.environmentTexture,e,r,!0,!t,void 0,A.environmentTexturePrefilterOnLoad);A.environmentTextureRotationY&&(n.rotationY=A.environmentTextureRotationY),e.environmentTexture=n}else if("object"==typeof A.environmentTexture){let t=d.b.Parse(A.environmentTexture,e,i);e.environmentTexture=t}else if(A.environmentTexture.endsWith(".env")){let t=new d.b((A.environmentTexture.match(/https?:\/\//g)?"":i)+A.environmentTexture,e,A.environmentTextureForcedExtension);A.environmentTextureRotationY&&(t.rotationY=A.environmentTextureRotationY),e.environmentTexture=t}else{let t=d.b.CreateFromPrefilteredData((A.environmentTexture.match(/https?:\/\//g)?"":i)+A.environmentTexture,e,A.environmentTextureForcedExtension);A.environmentTextureRotationY&&(t.rotationY=A.environmentTextureRotationY),e.environmentTexture=t}if(!0===A.createDefaultSkybox){let i=void 0!==e.activeCamera&&null!==e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1e3,r=A.skyboxBlurLevel||0;e.createDefaultSkybox(e.environmentTexture,t,i,r)}m.environmentTexture=e.environmentTexture}if(void 0!==A.environmentIntensity&&null!==A.environmentIntensity&&(e.environmentIntensity=A.environmentIntensity),void 0!==A.iblIntensity&&null!==A.iblIntensity&&(e.iblIntensity=A.iblIntensity),void 0!==A.lights&&null!==A.lights)for(r=0,s=A.lights.length;r<s;r++){let t=A.lights[r],i=_.v.Parse(t,e);i&&(L[t.uniqueId]=i,m.lights.push(i),i._parentContainer=m,g+=(0===r?"\n	Lights:":"")+"\n		"+i.toString(y))}if(void 0!==A.reflectionProbes&&null!==A.reflectionProbes)for(r=0,s=A.reflectionProbes.length;r<s;r++){let t=A.reflectionProbes[r],n=I.a.Parse(t,e,i);n&&(m.reflectionProbes.push(n),n._parentContainer=m,g+=(0===r?"\n	Reflection Probes:":"")+"\n		"+n.toString(y))}if(void 0!==A.animations&&null!==A.animations)for(r=0,s=A.animations.length;r<s;r++){let t=A.animations[r],i=(0,R.n9)("BABYLON.Animation");if(i){let n=i.Parse(t);e.animations.push(n),m.animations.push(n),g+=(0===r?"\n	Animations:":"")+"\n		"+n.toString(y)}}if(void 0!==A.materials&&null!==A.materials)for(r=0,s=A.materials.length;r<s;r++){let t=A.materials[r],n=h.i.Parse(t,e,i);if(n)for(let e of(F[t.uniqueId||t.id]=n,m.materials.push(n),n._parentContainer=m,g+=(0===r?"\n	Materials:":"")+"\n		"+n.toString(y),n.getActiveTextures()))-1==m.textures.indexOf(e)&&(m.textures.push(e),e._parentContainer=m)}if(void 0!==A.multiMaterials&&null!==A.multiMaterials)for(r=0,s=A.multiMaterials.length;r<s;r++){let t=A.multiMaterials[r],i=c.F.ParseMultiMaterial(t,e);for(let e of(F[t.uniqueId||t.id]=i,m.multiMaterials.push(i),i._parentContainer=m,g+=(0===r?"\n	MultiMaterials:":"")+"\n		"+i.toString(y),i.getActiveTextures()))-1==m.textures.indexOf(e)&&(m.textures.push(e),e._parentContainer=m)}if(void 0!==A.morphTargetManagers&&null!==A.morphTargetManagers)for(let t of A.morphTargetManagers){let i=v.j.Parse(t,e);B[t.id]=i,m.morphTargetManagers.push(i),i._parentContainer=m}if(void 0!==A.skeletons&&null!==A.skeletons)for(r=0,s=A.skeletons.length;r<s;r++){let t=A.skeletons[r],i=T.E.Parse(t,e);m.skeletons.push(i),i._parentContainer=m,g+=(0===r?"\n	Skeletons:":"")+"\n		"+i.toString(y)}let S=A.geometries;if(null!=S){let t=[],n=S.vertexData;if(null!=n)for(r=0,s=n.length;r<s;r++){let s=n[r];e._blockEntityCollection=!1;let o=e.onNewGeometryAddedObservable;e.onNewGeometryAddedObservable=new w.cP,t.push(l.V.Parse(s,e,i)),e.onNewGeometryAddedObservable=o,e._blockEntityCollection=!a}for(let e of t)e&&(m.geometries.push(e),e._parentContainer=m)}if(void 0!==A.transformNodes&&null!==A.transformNodes)for(r=0,s=A.transformNodes.length;r<s;r++){let t=A.transformNodes[r],n=u.V.Parse(t,e,i);L[t.uniqueId]=n,m.transformNodes.push(n),n._parentContainer=m}if(void 0!==A.meshes&&null!==A.meshes)for(r=0,s=A.meshes.length;r<s;r++){let t=A.meshes[r],n=o.e.Parse(t,e,i);if(L[t.uniqueId]=n,m.meshes.push(n),n._parentContainer=m,n.hasInstances)for(let e of n.instances)m.meshes.push(e),e._parentContainer=m;g+=(0===r?"\n	Meshes:":"")+"\n		"+n.toString(y)}if(void 0!==A.cameras&&null!==A.cameras)for(r=0,s=A.cameras.length;r<s;r++){let t=A.cameras[r],i=n.i.Parse(t,e);L[t.uniqueId]=i,m.cameras.push(i),i._parentContainer=m,g+=(0===r?"\n	Cameras:":"")+"\n		"+i.toString(y)}if(void 0!==A.postProcesses&&null!==A.postProcesses)for(r=0,s=A.postProcesses.length;r<s;r++){let t=A.postProcesses[r],n=M.w.Parse(t,e,i);n&&(m.postProcesses.push(n),n._parentContainer=m,g+=(0===r?"\nPostprocesses:":"")+"\n		"+n.toString())}if(void 0!==A.animationGroups&&null!==A.animationGroups&&A.animationGroups.length){let t=new Map;for(let i=0;i<e.meshes.length;i++)t.has(e.meshes[i].id)||t.set(e.meshes[i].id,e.meshes[i]);for(let i=0;i<e.transformNodes.length;i++)t.has(e.transformNodes[i].id)||t.set(e.transformNodes[i].id,e.transformNodes[i]);for(let i=0;i<e.lights.length;i++)t.has(e.lights[i].id)||t.set(e.lights[i].id,e.lights[i]);for(let i=0;i<e.cameras.length;i++)t.has(e.cameras[i].id)||t.set(e.cameras[i].id,e.cameras[i]);for(let i=0;i<e.skeletons.length;i++){let r=e.skeletons[i];for(let e=0;e<r.bones.length;e++)t.has(r.bones[e].id)||t.set(r.bones[e].id,r.bones[e])}for(r=0,s=A.animationGroups.length;r<s;r++){let i=A.animationGroups[r],n=f.AnimationGroup.Parse(i,e,t);m.animationGroups.push(n),n._parentContainer=m,g+=(0===r?"\n	AnimationGroups:":"")+"\n		"+n.toString(y)}}if(A.spriteManagers)for(let t=0,r=A.spriteManagers.length;t<r;t++){let r=A.spriteManagers[t],n=C.x.Parse(r,e,i);m.spriteManagers.push(n),n._parentContainer=m,g+="\n		SpriteManager "+n.name}for(r=0,s=e.cameras.length;r<s;r++){let t=e.cameras[r];null!==t._waitingParentId&&(t.parent=z(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null)}for(r=0,s=e.lights.length;r<s;r++){let t=e.lights[r];t&&null!==t._waitingParentId&&(t.parent=z(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null)}for(r=0,s=e.transformNodes.length;r<s;r++){let t=e.transformNodes[r];null!==t._waitingParentId&&(t.parent=z(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null)}for(r=0,s=e.meshes.length;r<s;r++){let t=e.meshes[r];null!==t._waitingParentId&&(t.parent=z(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null),t._waitingData.lods&&G(e,t)}for(let t of e.multiMaterials){for(let i of t._waitingSubMaterialsUniqueIds)t.subMaterials.push($(i,e));t._waitingSubMaterialsUniqueIds=[]}for(let t of e.meshes)null!==t._waitingMaterialId&&(t.material=$(t._waitingMaterialId,e),t._waitingMaterialId=null);for(let t of e.meshes)null!==t._waitingMorphTargetManagerId&&(t.morphTargetManager=B[t._waitingMorphTargetManagerId],t._waitingMorphTargetManagerId=null);for(r=0,s=e.skeletons.length;r<s;r++){let t=e.skeletons[r];if(t._hasWaitingData){if(null!=t.bones){for(let i of t.bones)if(i._waitingTransformNodeId){let t=e.getLastEntryById(i._waitingTransformNodeId);t&&i.linkTransformNode(t),i._waitingTransformNodeId=null}}t._hasWaitingData=null}}for(r=0,s=e.meshes.length;r<s;r++){let t=e.meshes[r];t._waitingData.freezeWorldMatrix?(t.freezeWorldMatrix(),t._waitingData.freezeWorldMatrix=null):t.computeWorldMatrix(!0)}for(r=0,s=e.lights.length;r<s;r++){let t=e.lights[r];if(t._excludedMeshesIds.length>0){for(let i=0;i<t._excludedMeshesIds.length;i++){let r=e.getMeshById(t._excludedMeshesIds[i]);r&&t.excludedMeshes.push(r)}t._excludedMeshesIds=[]}if(t._includedOnlyMeshesIds.length>0){for(let i=0;i<t._includedOnlyMeshesIds.length;i++){let r=e.getMeshById(t._includedOnlyMeshesIds[i]);r&&t.includedOnlyMeshes.push(r)}t._includedOnlyMeshesIds=[]}}for(let t of e.geometries)t._loadedUniqueId="";for((0,O.oj)(A,e,m,i),r=0,s=e.meshes.length;r<s;r++){let t=e.meshes[r];t._waitingData.actions&&(x.m.Parse(t._waitingData.actions,t,e),t._waitingData.actions=null)}void 0!==A.actions&&null!==A.actions&&x.m.Parse(A.actions,null,e)}catch(t){let e=V("loadAssets",A?A.producer:"Unknown")+g;if(s)s(e,t);else throw r.V.Log(e),t}finally{L={},F={},B={},a||(m.removeAllFromScene(),e._blockEntityCollection=!1),null!==g&&0!==b.B.loggingLevel&&r.V.Log(V("loadAssets",A?A.producer:"Unknown")+(1!==b.B.loggingLevel?g:""))}return m};(0,g.qS)({name:"babylon.js",extensions:".babylon",canDirectLoad:e=>-1!==e.indexOf("babylon"),importMesh:(e,t,i,n,s,a,h,d)=>{let p="importMesh has failed JSON parse";try{var f=JSON.parse(i);p="";let d=3===b.B.loggingLevel;e?Array.isArray(e)||(e=[e]):e=null;let _=[],g=new Map,y=[];if(void 0!==f.transformNodes&&null!==f.transformNodes)for(let e=0,i=f.transformNodes.length;e<i;e++){let i=f.transformNodes[e],r=u.V.Parse(i,t,n);y.push(r),g.set(r._waitingParsedUniqueId,r),r._waitingParsedUniqueId=null}if(void 0!==f.meshes&&null!==f.meshes){let i,a=[],u=[],m=[],b=[];for(let i=0,y=f.meshes.length;i<y;i++){let y=f.meshes[i];if(null===e||U(y,e,_)){if(null!==e&&delete e[e.indexOf(y.name)],void 0!==y.geometryId&&null!==y.geometryId&&void 0!==f.geometries&&null!==f.geometries){let e=!1;for(let i of["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"])if(f.geometries[i]&&Array.isArray(f.geometries[i])){for(let r of f.geometries[i])if(r.id===y.geometryId){"vertexData"===i&&l.V.Parse(r,t,n),e=!0;break}if(e)break}!1===e&&r.V.Warn("Geometry not found for mesh "+y.id)}if(y.materialUniqueId||y.materialId){let e=y.materialUniqueId?m:u,i=-1!==e.indexOf(y.materialUniqueId||y.materialId);if(!1===i&&void 0!==f.multiMaterials&&null!==f.multiMaterials){let r=(i,r)=>{e.push(i);let s=k(r,f,t,n);s&&s.material&&(F[s.parsedMaterial.uniqueId||s.parsedMaterial.id]=s.material,p+="\n	Material "+s.material.toString(d))};for(let n=0,s=f.multiMaterials.length;n<s;n++){let s=f.multiMaterials[n];if(y.materialUniqueId&&s.uniqueId===y.materialUniqueId||s.id===y.materialId){if(s.materialsUniqueIds)for(let e of s.materialsUniqueIds)r(e,t=>t.uniqueId===e);else for(let e of s.materials)r(e,t=>t.id===e);e.push(s.uniqueId||s.id);let n=c.F.ParseMultiMaterial(s,t);F[s.uniqueId||s.id]=n,n&&(i=!0,p+="\n	Multi-Material "+n.toString(d));break}}}if(!1===i){e.push(y.materialUniqueId||y.materialId);let i=k(e=>y.materialUniqueId&&e.uniqueId===y.materialUniqueId||e.id===y.materialId,f,t,n);i&&i.material?(F[i.parsedMaterial.uniqueId||i.parsedMaterial.id]=i.material,p+="\n	Material "+i.material.toString(d)):r.V.Warn("Material not found for mesh "+y.id)}}if(null!==y.skeletonId&&void 0!==y.skeletonId&&-1!==f.skeletonId&&void 0!==f.skeletons&&null!==f.skeletons&&!(a.indexOf(y.skeletonId)>-1))for(let e=0,i=f.skeletons.length;e<i;e++){let i=f.skeletons[e];if(i.id===y.skeletonId){let e=T.E.Parse(i,t);h.push(e),a.push(i.id),p+="\n	Skeleton "+e.toString(d)}}if(y.morphTargetManagerId>-1&&void 0!==f.morphTargetManagers&&null!==f.morphTargetManagers&&!(b.indexOf(y.morphTargetManagerId)>-1))for(let e=0;e<f.morphTargetManagers.length;e++){let i=f.morphTargetManagers[e];if(i.id===y.morphTargetManagerId){let e=v.j.Parse(i,t);B[i.id]=e,b.push(i.id),p+="\nMorph target manager"+e.toString()}}let i=o.e.Parse(y,t,n);s.push(i),g.set(i._waitingParsedUniqueId,i),i._waitingParsedUniqueId=null,p+="\n	Mesh "+i.toString(d)}}for(let e of t.multiMaterials){for(let i of e._waitingSubMaterialsUniqueIds)e.subMaterials.push($(i,t));e._waitingSubMaterialsUniqueIds=[]}for(let e of t.meshes)null!==e._waitingMaterialId&&(e.material=$(e._waitingMaterialId,t),e._waitingMaterialId=null);for(let e of t.meshes)null!==e._waitingMorphTargetManagerId&&(e.morphTargetManager=B[e._waitingMorphTargetManagerId],e._waitingMorphTargetManagerId=null);for(let e=0,i=t.transformNodes.length;e<i;e++){let i=t.transformNodes[e];if(null!==i._waitingParentId){let e=g.get(parseInt(i._waitingParentId))||null;null===e&&(e=t.getLastEntryById(i._waitingParentId));let r=e;i._waitingParentInstanceIndex&&(r=e.instances[parseInt(i._waitingParentInstanceIndex)],i._waitingParentInstanceIndex=null),i.parent=r,i._waitingParentId=null}}for(let e=0,r=t.meshes.length;e<r;e++){if((i=t.meshes[e])._waitingParentId){let e=g.get(parseInt(i._waitingParentId))||null;null===e&&(e=t.getLastEntryById(i._waitingParentId));let r=e;i._waitingParentInstanceIndex&&(r=e.instances[parseInt(i._waitingParentInstanceIndex)],i._waitingParentInstanceIndex=null),i.parent=r,i._waitingParentId=null}i._waitingData.lods&&G(t,i)}for(let e of y)e.getChildMeshes(!1).length||e.dispose();for(let e=0,i=t.skeletons.length;e<i;e++){let i=t.skeletons[e];if(i._hasWaitingData){if(null!=i.bones){for(let e of i.bones)if(e._waitingTransformNodeId){let i=t.getLastEntryById(e._waitingTransformNodeId);i&&e.linkTransformNode(i),e._waitingTransformNodeId=null}}i._hasWaitingData=null}}for(let e=0,r=t.meshes.length;e<r;e++)(i=t.meshes[e])._waitingData.freezeWorldMatrix?(i.freezeWorldMatrix(),i._waitingData.freezeWorldMatrix=null):i.computeWorldMatrix(!0)}if(void 0!==f.particleSystems&&null!==f.particleSystems){let e=(0,O.LO)(m.v.NAME_PARTICLESYSTEM);if(e)for(let i=0,r=f.particleSystems.length;i<r;i++){let r=f.particleSystems[i];-1!==_.indexOf(r.emitterId)&&a.push(e(r,t,n))}}for(let e of t.geometries)e._loadedUniqueId="";return!0}catch(t){let e=V("importMesh",f?f.producer:"Unknown")+p;if(d)d(e,t);else throw r.V.Log(e),t}finally{null!==p&&0!==b.B.loggingLevel&&r.V.Log(V("importMesh",f?f.producer:"Unknown")+(1!==b.B.loggingLevel?p:"")),F={},B={}}return!1},load:(e,t,i,n)=>{let o="importScene has failed JSON parse";try{var l=JSON.parse(t);switch(o="",void 0!==l.useDelayedTextureLoading&&null!==l.useDelayedTextureLoading&&(e.useDelayedTextureLoading=l.useDelayedTextureLoading&&!b.B.ForceFullSceneLoadingForIncremental),void 0!==l.autoClear&&null!==l.autoClear&&(e.autoClear=l.autoClear),void 0!==l.clearColor&&null!==l.clearColor&&(e.clearColor=a.ov.FromArray(l.clearColor)),void 0!==l.ambientColor&&null!==l.ambientColor&&(e.ambientColor=a.v9.FromArray(l.ambientColor)),void 0!==l.gravity&&null!==l.gravity&&(e.gravity=s.Pq.FromArray(l.gravity)),void 0!==l.useRightHandedSystem&&(e.useRightHandedSystem=!!l.useRightHandedSystem),void 0!==l.fogMode&&null!==l.fogMode&&(e.fogMode=l.fogMode),void 0!==l.fogColor&&null!==l.fogColor&&(e.fogColor=a.v9.FromArray(l.fogColor)),void 0!==l.fogStart&&null!==l.fogStart&&(e.fogStart=l.fogStart),void 0!==l.fogEnd&&null!==l.fogEnd&&(e.fogEnd=l.fogEnd),void 0!==l.fogDensity&&null!==l.fogDensity&&(e.fogDensity=l.fogDensity),o+="	Fog mode for scene:  ",e.fogMode){case 0:o+="none\n";break;case 1:o+="exp\n";break;case 2:o+="exp2\n";break;case 3:o+="linear\n"}if(l.physicsEnabled){let t;"cannon"===l.physicsEngine||l.physicsEngine===A.O.name?t=new A.O(void 0,void 0,N.LoaderInjectedPhysicsEngine):"oimo"===l.physicsEngine||l.physicsEngine===S.z.name?t=new S.z(void 0,N.LoaderInjectedPhysicsEngine):("ammo"===l.physicsEngine||l.physicsEngine===E.v.name)&&(t=new E.v(void 0,N.LoaderInjectedPhysicsEngine,void 0)),o="	Physics engine "+(l.physicsEngine?l.physicsEngine:"oimo")+" enabled\n";let i=l.gravity?s.Pq.FromArray(l.gravity):l.physicsGravity?s.Pq.FromArray(l.physicsGravity):null;e.enablePhysics(i,t)}if(void 0!==l.metadata&&null!==l.metadata&&(e.metadata=l.metadata),void 0!==l.collisionsEnabled&&null!==l.collisionsEnabled&&(e.collisionsEnabled=l.collisionsEnabled),!W(e,t,i,n,!0))return!1;return l.autoAnimate&&e.beginAnimation(e,l.autoAnimateFrom,l.autoAnimateTo,l.autoAnimateLoop,l.autoAnimateSpeed||1),void 0!==l.activeCameraID&&null!==l.activeCameraID&&e.setActiveCameraById(l.activeCameraID),!0}catch(t){let e=V("importScene",l?l.producer:"Unknown")+o;if(n)n(e,t);else throw r.V.Log(e),t}finally{null!==o&&0!==b.B.loggingLevel&&r.V.Log(V("importScene",l?l.producer:"Unknown")+(1!==b.B.loggingLevel?o:""))}return!1},loadAssetContainer:(e,t,i,r)=>W(e,t,i,r)})},41358(e,t,i){i.d(t,{q:()=>s});var r=i(87201),n=i(94470);class s{constructor(e,t="",i="black"){this._renderingCanvas=e,this._loadingText=t,this._loadingDivBackgroundColor=i,this._loadingDivToRenderingCanvasMap=new Map,this._resizeLoadingUI=()=>{this._isLoading&&this._loadingDivToRenderingCanvasMap.forEach(([e,t],i)=>{let r=e.getBoundingClientRect();if(this._isCanvasLayoutChanged(t,r)){let t=window.getComputedStyle(e).position;i.style.position="fixed"===t?"fixed":"absolute",i.style.left=r.left+window.scrollX+"px",i.style.top=r.top+window.scrollY+"px",i.style.width=r.width+"px",i.style.height=r.height+"px",this._loadingDivToRenderingCanvasMap.set(i,[e,r])}})}}displayLoadingUI(){if(this._isLoading)return;this._isLoading=!0,this._engine=n.q.Instances.find(e=>e.getRenderingCanvas()===this._renderingCanvas);let e=document.createElement("div");e.id="babylonjsLoadingDiv",e.style.opacity="0",e.style.transition="opacity 1.5s ease",e.style.pointerEvents="none",e.style.display="grid",e.style.gridTemplateRows="100%",e.style.gridTemplateColumns="100%",e.style.justifyItems="center",e.style.alignItems="center",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.style.zIndex="1",this._loadingTextDiv.innerHTML="Loading",e.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText,this._style=document.createElement("style");let t=`@-webkit-keyframes spin1 {\
                            0% { -webkit-transform: rotate(0deg);}
                            100% { -webkit-transform: rotate(360deg);}
                        }\
                        @keyframes spin1 {\
                            0% { transform: rotate(0deg);}
                            100% { transform: rotate(360deg);}
                        }`;this._style.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(this._style);let i=!!window.SVGSVGElement,r=new Image;s.DefaultLogoUrl?r.src=s.DefaultLogoUrl:r.src=i?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+":"https://cdn.babylonjs.com/Assets/babylonLogo.png",r.style.width="150px",r.style.gridColumn="1",r.style.gridRow="1",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)",r.style.position="absolute";let a=document.createElement("div");a.style.width="300px",a.style.gridColumn="1",a.style.gridRow="1",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.position="absolute";let o=new Image;s.DefaultSpinnerUrl?o.src=s.DefaultSpinnerUrl:o.src=i?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==":"https://cdn.babylonjs.com/Assets/loadingIcon.png",o.style.animation="spin1 0.75s infinite linear",o.style.transformOrigin="50% 50%",i||(r.style.width="16vh",r.style.height="18.5vh",r.style.left=`calc(50% - ${8}vh)`,r.style.top=`calc(50% - ${9.25}vh)`,o.style.width="30vh",o.style.height="30vh",o.style.left=`calc(50% - ${15}vh)`,o.style.top=`calc(50% - ${15}vh)`),a.appendChild(o),e.appendChild(r),e.appendChild(a),e.style.backgroundColor=this._loadingDivBackgroundColor,e.style.opacity="1";let l=[],u=this._engine.views;if(u?.length)for(let e of u)e.enabled&&l.push(e.target);else l.push(this._renderingCanvas);for(let t=0;t<l.length;t++){let i=l[t],r=e.cloneNode(!0);r.id+=`-${t}`,this._loadingDivToRenderingCanvasMap.set(r,[i,null])}this._resizeLoadingUI(),this._resizeObserver=this._engine.onResizeObservable.add(()=>{this._resizeLoadingUI()}),this._loadingDivToRenderingCanvasMap.forEach((e,t)=>{document.body.appendChild(t)})}hideLoadingUI(){if(!this._isLoading)return;let e=0,t=i=>{let r=i.target;this._loadingDivToRenderingCanvasMap.has(r)&&(e++,r.remove(),e===this._loadingDivToRenderingCanvasMap.size&&(this._loadingTextDiv&&(this._loadingTextDiv.remove(),this._loadingTextDiv=null),this._style&&(this._style.remove(),this._style=null),window.removeEventListener("transitionend",t),this._engine.onResizeObservable.remove(this._resizeObserver),this._loadingDivToRenderingCanvasMap.clear(),this._engine=null,this._isLoading=!1))};this._loadingDivToRenderingCanvasMap.forEach((e,t)=>{t.style.opacity="0"}),window.addEventListener("transitionend",t)}set loadingUIText(e){this._loadingText=e,this._loadingTextDiv&&this._loadingDivToRenderingCanvasMap.forEach((e,t)=>{t.children[0].innerHTML=this._loadingText})}get loadingUIText(){return this._loadingText}get loadingUIBackgroundColor(){return this._loadingDivBackgroundColor}set loadingUIBackgroundColor(e){this._loadingDivBackgroundColor=e,this._isLoading&&this._loadingDivToRenderingCanvasMap.forEach((e,t)=>{t.style.backgroundColor=this._loadingDivBackgroundColor})}_isCanvasLayoutChanged(e,t){return!e||e.left!==t.left||e.top!==t.top||e.right!==t.right||e.bottom!==t.bottom||e.width!==t.width||e.height!==t.height||e.x!==t.x||e.y!==t.y}}s.DefaultLogoUrl="",s.DefaultSpinnerUrl="",r.$.DefaultLoadingScreenFactory=e=>new s(e)},53510(e,t,i){var r,n,s,a,o,l;i.d(t,{Yq:()=>s,ZB:()=>n,yo:()=>r}),(a=r||(r={}))[a.MATERIAL_TYPE_STANDARD=0]="MATERIAL_TYPE_STANDARD",a[a.MATERIAL_TYPE_PBR=1]="MATERIAL_TYPE_PBR",a[a.MATERIAL_TYPE_SIMPLE=2]="MATERIAL_TYPE_SIMPLE",(o=n||(n={}))[o.COLOR_MODE_SET=0]="COLOR_MODE_SET",o[o.COLOR_MODE_ADD=1]="COLOR_MODE_ADD",o[o.COLOR_MODE_MULTIPLY=2]="COLOR_MODE_MULTIPLY",(l=s||(s={}))[l.COLOR_DISTRIBUTION_TYPE_SEGMENT=0]="COLOR_DISTRIBUTION_TYPE_SEGMENT",l[l.COLOR_DISTRIBUTION_TYPE_LINE=1]="COLOR_DISTRIBUTION_TYPE_LINE"},97707(e,t,i){i.d(t,{L:()=>r});function r(e,t){if("vertex"===e){let e={CUSTOM_VERTEX_DEFINITIONS:`
                attribute float grl_widths;
                attribute vec3 grl_offsets;
                attribute float grl_colorPointers;
                varying float grlCounters;
                varying float grlColorPointer;

                #ifdef GREASED_LINE_CAMERA_FACING
                    attribute vec4 grl_previousAndSide;
                    attribute vec4 grl_nextAndCounters;

                    vec2 grlFix( vec4 i, float aspect ) {
                        vec2 res = i.xy / i.w;
                        res.x *= aspect;
                        return res;
                    }
                #else
                    attribute vec3 grl_slopes;
                    attribute float grl_counters;
                #endif
                `,CUSTOM_VERTEX_UPDATE_POSITION:`
                #ifdef GREASED_LINE_CAMERA_FACING
                    vec3 grlPositionOffset = grl_offsets;
                    positionUpdated += grlPositionOffset;
                #else
                    positionUpdated = (positionUpdated + grl_offsets) + (grl_slopes * grl_widths);
                #endif
                `,CUSTOM_VERTEX_MAIN_END:`
                grlColorPointer = grl_colorPointers;

                #ifdef GREASED_LINE_CAMERA_FACING

                    float grlAspect = grl_aspect_resolution_lineWidth.x;
                    float grlBaseWidth = grl_aspect_resolution_lineWidth.w;

                    vec3 grlPrevious = grl_previousAndSide.xyz;
                    float grlSide = grl_previousAndSide.w;

                    vec3 grlNext = grl_nextAndCounters.xyz;
                    grlCounters = grl_nextAndCounters.w;
                    float grlWidth = grlBaseWidth * grl_widths;
                    
                    vec3 worldDir = normalize(grlNext - grlPrevious);
                    vec3 nearPosition = positionUpdated + (worldDir * 0.01);
                    mat4 grlMatrix = viewProjection * finalWorld;
                    vec4 grlFinalPosition = grlMatrix * vec4(positionUpdated , 1.0);
                    vec4 screenNearPos = grlMatrix * vec4(nearPosition, 1.0);
                    vec2 grlLinePosition = grlFix(grlFinalPosition, grlAspect);
                    vec2 grlLineNearPosition = grlFix(screenNearPos, grlAspect);
                    vec2 grlDir = normalize(grlLineNearPosition - grlLinePosition);

                    vec4 grlNormal = vec4(-grlDir.y, grlDir.x, 0., 1.);

                    #ifdef GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM
                        grlNormal.xy *= -.5 * grlWidth;
                    #else
                        grlNormal.xy *= .5 * grlWidth;
                    #endif

                    grlNormal *= grl_projection;

                    #ifdef GREASED_LINE_SIZE_ATTENUATION
                        grlNormal.xy *= grlFinalPosition.w;
                        grlNormal.xy /= (vec4(grl_aspect_resolution_lineWidth.yz, 0., 1.) * grl_projection).xy;
                    #endif

                    grlFinalPosition.xy += grlNormal.xy * grlSide;
                    gl_Position = grlFinalPosition;

                    vPositionW = vec3(grlFinalPosition);
                #else
                    grlCounters = grl_counters;
                #endif
                `};return t&&(e["!gl_Position\\=viewProjection\\*worldPos;"]="//"),e}return"fragment"===e?{CUSTOM_FRAGMENT_DEFINITIONS:`
                    #ifdef PBR
                         #define grlFinalColor finalColor
                    #else
                         #define grlFinalColor color
                    #endif

                    varying float grlCounters;
                    varying float grlColorPointer;
                    uniform sampler2D grl_colors;
                `,CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR:`
                    float grlColorMode = grl_colorMode_visibility_colorsWidth_useColors.x;
                    float grlVisibility = grl_colorMode_visibility_colorsWidth_useColors.y;
                    float grlColorsWidth = grl_colorMode_visibility_colorsWidth_useColors.z;
                    float grlUseColors = grl_colorMode_visibility_colorsWidth_useColors.w;

                    float grlUseDash = grl_dashOptions.x;
                    float grlDashArray = grl_dashOptions.y;
                    float grlDashOffset = grl_dashOptions.z;
                    float grlDashRatio = grl_dashOptions.w;

                    grlFinalColor.a *= step(grlCounters, grlVisibility);
                    if(grlFinalColor.a == 0.) discard;

                    if(grlUseDash == 1.){
                        grlFinalColor.a *= ceil(mod(grlCounters + grlDashOffset, grlDashArray) - (grlDashArray * grlDashRatio));
                        if (grlFinalColor.a == 0.) discard;
                    }

                    #ifdef GREASED_LINE_HAS_COLOR
                        if (grlColorMode == 0.) {
                            grlFinalColor.rgb = grl_singleColor;
                        } else if (grlColorMode == 1.) {
                            grlFinalColor.rgb += grl_singleColor;
                        } else if (grlColorMode == 2.) {
                            grlFinalColor.rgb *= grl_singleColor;
                        }
                    #else
                        if (grlUseColors == 1.) {
                            #ifdef GREASED_LINE_COLOR_DISTRIBUTION_TYPE_LINE
                                vec4 grlColor = texture2D(grl_colors, vec2(grlCounters, 0.), 0.);
                            #else
                                vec2 lookup = vec2(fract(grlColorPointer / grl_textureSize.x), 1.0 - floor(grlColorPointer / grl_textureSize.x) / max(grl_textureSize.y - 1.0, 1.0));
                                vec4 grlColor = texture2D(grl_colors, lookup, 0.0);
                            #endif
                            if (grlColorMode == 0.) {
                                grlFinalColor = grlColor;
                            } else if (grlColorMode == 1.) {
                                grlFinalColor += grlColor;
                            } else if (grlColorMode == 2.) {
                                grlFinalColor *= grlColor;
                            }
                        }
                    #endif
                `}:null}},36218(e,t,i){i.d(t,{L:()=>r});function r(e,t){if("vertex"===e){let e={CUSTOM_VERTEX_DEFINITIONS:`
                attribute grl_widths: f32;
                attribute grl_colorPointers: f32;
                varying grlCounters: f32;
                varying grlColorPointer: f32;

                #ifdef GREASED_LINE_USE_OFFSETS
                    attribute grl_offsets: vec3f;   
                #endif

                #ifdef GREASED_LINE_CAMERA_FACING
                    attribute grl_previousAndSide : vec4f;
                    attribute grl_nextAndCounters : vec4f;

                    fn grlFix(i: vec4f, aspect: f32) -> vec2f {
                        var res = i.xy / i.w;
                        res.x *= aspect;
                        return res;
                    }
                #else
                    attribute grl_slopes: f32;
                    attribute grl_counters: f32;
                #endif


                `,CUSTOM_VERTEX_UPDATE_POSITION:`
                #ifdef GREASED_LINE_USE_OFFSETS
                    var grlPositionOffset: vec3f = input.grl_offsets;
                #else
                    var grlPositionOffset = vec3f(0.);
                #endif

                #ifdef GREASED_LINE_CAMERA_FACING
                    positionUpdated += grlPositionOffset;
                #else
                    positionUpdated = (positionUpdated + grlPositionOffset) + (input.grl_slopes * input.grl_widths);
                #endif
                `,CUSTOM_VERTEX_MAIN_END:`
                vertexOutputs.grlColorPointer = input.grl_colorPointers;

                #ifdef GREASED_LINE_CAMERA_FACING

                    let grlAspect: f32 = uniforms.grl_aspect_resolution_lineWidth.x;
                    let grlBaseWidth: f32 = uniforms.grl_aspect_resolution_lineWidth.w;

                    let grlPrevious: vec3f = input.grl_previousAndSide.xyz;
                    let grlSide: f32 = input.grl_previousAndSide.w;

                    let grlNext: vec3f = input.grl_nextAndCounters.xyz;
                    vertexOutputs.grlCounters = input.grl_nextAndCounters.w;

                    let grlWidth: f32 = grlBaseWidth * input.grl_widths;

                    let worldDir: vec3f = normalize(grlNext - grlPrevious);
                    let nearPosition: vec3f = positionUpdated + (worldDir * 0.01);
                    let grlMatrix: mat4x4f = uniforms.viewProjection * finalWorld;
                    let grlFinalPosition: vec4f = grlMatrix * vec4f(positionUpdated, 1.0); 
                    let screenNearPos: vec4f = grlMatrix * vec4(nearPosition, 1.0);
                    let grlLinePosition: vec2f = grlFix(grlFinalPosition, grlAspect);
                    let grlLineNearPosition: vec2f = grlFix(screenNearPos, grlAspect);
                    let grlDir: vec2f = normalize(grlLineNearPosition - grlLinePosition);

                    var grlNormal: vec4f = vec4f(-grlDir.y, grlDir.x, 0.0, 1.0);

                    let grlHalfWidth: f32 = 0.5 * grlWidth;
                    #if defined(GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM)
                        grlNormal.x *= -grlHalfWidth;
                        grlNormal.y *= -grlHalfWidth;
                    #else
                        grlNormal.x *= grlHalfWidth;
                        grlNormal.y *= grlHalfWidth;
                    #endif

                    grlNormal *= uniforms.grl_projection;

                    #if defined(GREASED_LINE_SIZE_ATTENUATION)
                        grlNormal.x *= grlFinalPosition.w;
                        grlNormal.y *= grlFinalPosition.w;

                        let pr = vec4f(uniforms.grl_aspect_resolution_lineWidth.yz, 0.0, 1.0) * uniforms.grl_projection;
                        grlNormal.x /= pr.x;
                        grlNormal.y /= pr.y;
                    #endif

                    vertexOutputs.position = vec4f(grlFinalPosition.xy + grlNormal.xy * grlSide, grlFinalPosition.z, grlFinalPosition.w);
                    vertexOutputs.vPositionW = vertexOutputs.position.xyz;
                
                #else
                    vertexOutputs.grlCounters = input.grl_counters;
                #endif
                `};return t&&(e["!vertexOutputs\\.position\\s=\\sscene\\.viewProjection\\s\\*\\sworldPos;"]="//"),e}return"fragment"===e?{CUSTOM_FRAGMENT_DEFINITIONS:`
                    #ifdef PBR
                         #define grlFinalColor finalColor
                    #else
                         #define grlFinalColor color
                    #endif

                    varying grlCounters: f32;
                    varying grlColorPointer: 32;

                    var grl_colors: texture_2d<f32>;
                    var grl_colorsSampler: sampler;
                `,CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR:`
                    let grlColorMode: f32 = uniforms.grl_colorMode_visibility_colorsWidth_useColors.x;
                    let grlVisibility: f32 = uniforms.grl_colorMode_visibility_colorsWidth_useColors.y;
                    let grlColorsWidth: f32 = uniforms.grl_colorMode_visibility_colorsWidth_useColors.z;
                    let grlUseColors: f32 = uniforms.grl_colorMode_visibility_colorsWidth_useColors.w;

                    let grlUseDash: f32 = uniforms.grl_dashOptions.x;
                    let grlDashArray: f32 = uniforms.grl_dashOptions.y;
                    let grlDashOffset: f32 = uniforms.grl_dashOptions.z;
                    let grlDashRatio: f32 = uniforms.grl_dashOptions.w;

                    grlFinalColor.a *= step(fragmentInputs.grlCounters, grlVisibility);
                    if (grlFinalColor.a == 0.0) {
                        discard;
                    }

                    if (grlUseDash == 1.0) {
                        let dashPosition = (fragmentInputs.grlCounters + grlDashOffset) % grlDashArray;
                        grlFinalColor.a *= ceil(dashPosition - (grlDashArray * grlDashRatio));

                        if (grlFinalColor.a == 0.0) {
                            discard;
                        }
                    }

                    #ifdef GREASED_LINE_HAS_COLOR
                        if (grlColorMode == 0.) {
                            grlFinalColor = vec4f(uniforms.grl_singleColor, grlFinalColor.a);
                        } else if (grlColorMode == 1.) {
                            grlFinalColor += vec4f(uniforms.grl_singleColor, grlFinalColor.a);
                        } else if (grlColorMode == 2.) {
                            grlFinalColor *= vec4f(uniforms.grl_singleColor, grlFinalColor.a);
                        }
                    #else
                        if (grlUseColors == 1.) {
                            #ifdef GREASED_LINE_COLOR_DISTRIBUTION_TYPE_LINE
                                let grlColor: vec4f = textureSample(grl_colors, grl_colorsSampler, vec2f(fragmentInputs.grlCounters, 0.));
                            #else
                                let lookup: vec2f = vec2(fract(fragmentInputs.grlColorPointer / uniforms.grl_textureSize.x), 1.0 - floor(fragmentInputs.grlColorPointer / uniforms.grl_textureSize.x) / max(uniforms.grl_textureSize.y - 1.0, 1.0));
                                let grlColor: vec4f = textureSample(grl_colors, grl_colorsSampler, lookup);
                            #endif
                            if (grlColorMode == 0.) {
                                grlFinalColor = grlColor;
                            } else if (grlColorMode == 1.) {
                                grlFinalColor += grlColor;
                            } else if (grlColorMode == 2.) {
                                grlFinalColor *= grlColor;
                            }
                        }
                    #endif


                `}:null}},44715(e,t,i){i.d(t,{J:()=>o});var r=i(65511),n=i(45509),s=i(40154),a=i(27371);class o extends r.N{constructor(e){super(e,s.n.Fragment),this.registerOutput("output",n.y.Float,s.n.Fragment)}getClassName(){return"FrontFacingBlock"}get output(){return this._outputs[0]}_buildBlock(e){if(super._buildBlock(e),e.target===s.n.Vertex)return e.sharedData.raiseBuildError("FrontFacingBlock must only be used in a fragment shader"),this;let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary("1.0","0.0",0===e.shaderLanguage?"gl_FrontFacing":"fragmentInputs.frontFacing")};
`,this}}(0,a.Y5)("BABYLON.FrontFacingBlock",o)},16414(e,t,i){i.d(t,{z:()=>o});var r=i(65511),n=i(45509),s=i(40154),a=i(27371);class o extends r.N{constructor(e){super(e,s.n.Neutral),this.registerInput("x",n.y.Float),this.registerInput("y",n.y.Float),this.registerOutput("output",n.y.Float)}getClassName(){return"ArcTan2Block"}get x(){return this._inputs[0]}get y(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0],i=1===e.shaderLanguage?"atan2":"atan";return e.compilationString+=e._declareOutput(t)+` = ${i}(${this.x.associatedVariableName}, ${this.y.associatedVariableName});
`,this}}(0,a.Y5)("BABYLON.ArcTan2Block",o)},8408(e,t,i){i.d(t,{l:()=>a});var r=i(40154),n=i(65511),s=i(45509);class a extends n.N{constructor(e){super(e,r.n.Neutral),this.registerInput("left",s.y.AutoDetect),this.registerInput("right",s.y.AutoDetect),this.registerOutput("output",s.y.BasedOnInput),this.output._typeConnectionSource=this.left,this._linkConnectionTypes(0,1,!0),this.left.acceptedConnectionPointTypes.push(s.y.Float),this.right.acceptedConnectionPointTypes.push(s.y.Float),this._connectionObservers=[this.left.onTypeChangedObservable.add(()=>this._updateInputOutputTypes()),this.right.onTypeChangedObservable.add(()=>this._updateInputOutputTypes())]}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===s.y.Int||this.left.type===s.y.Float&&this.right.type!==s.y.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(let[e,t]of[[this.left,this.right],[this.right,this.left]])e.acceptedConnectionPointTypes=[s.y.Int,s.y.Float],t.isConnected&&(e.acceptedConnectionPointTypes.push(t.type),(t.type===s.y.Int||t.type===s.y.Float)&&e.acceptedConnectionPointTypes.push(s.y.Vector2,s.y.Vector3,s.y.Vector4,s.y.Color3,s.y.Color4,s.y.Matrix))}dispose(){for(let e of(super.dispose(),this._connectionObservers))e.remove();this._connectionObservers.length=0}}},46523(e,t,i){i.d(t,{u:()=>o});var r=i(65511),n=i(45509),s=i(40154),a=i(27371);class o extends r.N{constructor(e){super(e,s.n.Neutral),this.registerInput("rgba",n.y.Color4,!0),this.registerInput("rgb ",n.y.Color3,!0),this.registerOutput("rgb",n.y.Color3),this.registerOutput("r",n.y.Float),this.registerOutput("g",n.y.Float),this.registerOutput("b",n.y.Float),this.registerOutput("a",n.y.Float),this.inputsAreExclusive=!0}getClassName(){return"ColorSplitterBlock"}get rgba(){return this._inputs[0]}get rgbIn(){return this._inputs[1]}get rgbOut(){return this._outputs[0]}get r(){return this._outputs[1]}get g(){return this._outputs[2]}get b(){return this._outputs[3]}get a(){return this._outputs[4]}_inputRename(e){return"rgb "===e?"rgbIn":e}_outputRename(e){return"rgb"===e?"rgbOut":e}_buildBlock(e){super._buildBlock(e);let t=this.rgba.isConnected?this.rgba:this.rgbIn;if(!t.isConnected)return;let i=this._outputs[0],r=this._outputs[1],n=this._outputs[2],s=this._outputs[3],a=this._outputs[4];return i.hasEndpoints&&(e.compilationString+=e._declareOutput(i)+` = ${t.associatedVariableName}.rgb;
`),r.hasEndpoints&&(e.compilationString+=e._declareOutput(r)+` = ${t.associatedVariableName}.r;
`),n.hasEndpoints&&(e.compilationString+=e._declareOutput(n)+` = ${t.associatedVariableName}.g;
`),s.hasEndpoints&&(e.compilationString+=e._declareOutput(s)+` = ${t.associatedVariableName}.b;
`),a.hasEndpoints&&(e.compilationString+=e._declareOutput(a)+` = ${t.associatedVariableName}.a;
`),this}}(0,a.Y5)("BABYLON.ColorSplitterBlock",o)},45201(e,t,i){i.d(t,{g:()=>o});var r=i(65511),n=i(45509),s=i(40154),a=i(27371);class o extends r.N{constructor(e){super(e,s.n.Neutral),this.registerInput("left",n.y.AutoDetect),this.registerInput("right",n.y.AutoDetect),this.registerOutput("output",n.y.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1)}getClassName(){return"MaxBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = max(${this.left.associatedVariableName}, ${this.right.associatedVariableName});
`,this}}(0,a.Y5)("BABYLON.MaxBlock",o)},32772(e,t,i){i.d(t,{P:()=>f});var r=i(39545),n=i(65511),s=i(45509),a=i(40154),o=i(52220),l=i(27371),u=i(49578);i(56754);var h=i(76898),c=i(1600),d=i(94470),p=i(91817);class f extends n.N{get texture(){return this.source.isConnected?(this.source.connectedPoint?.ownerBlock).texture:this._texture}set texture(e){if(this._texture===e)return;let t=e?.getScene()??d.q.LastCreatedScene;!e&&t&&t.markAllMaterialsAsDirty(1,e=>e.hasTexture(this._texture)),this._texture=e,e&&t&&t.markAllMaterialsAsDirty(1,t=>t.hasTexture(e))}get textureY(){return this.sourceY.isConnected?(this.sourceY.connectedPoint?.ownerBlock).texture:null}get textureZ(){return this.sourceZ?.isConnected?(this.sourceY.connectedPoint?.ownerBlock).texture:null}_getImageSourceBlock(e){return e?.isConnected?e.connectedPoint.ownerBlock:null}get samplerName(){let e=this._getImageSourceBlock(this.source);return e?e.samplerName:this._samplerName}get samplerYName(){return this._getImageSourceBlock(this.sourceY)?.samplerName??null}get samplerZName(){return this._getImageSourceBlock(this.sourceZ)?.samplerName??null}get hasImageSource(){return this.source.isConnected}set convertToGammaSpace(e){if(e!==this._convertToGammaSpace&&(this._convertToGammaSpace=e,this.texture)){let e=this.texture.getScene()??d.q.LastCreatedScene;e?.markAllMaterialsAsDirty(1,e=>e.hasTexture(this.texture))}}get convertToGammaSpace(){return this._convertToGammaSpace}set convertToLinearSpace(e){if(e!==this._convertToLinearSpace&&(this._convertToLinearSpace=e,this.texture)){let e=this.texture.getScene()??d.q.LastCreatedScene;e?.markAllMaterialsAsDirty(1,e=>e.hasTexture(this.texture))}}get convertToLinearSpace(){return this._convertToLinearSpace}constructor(e,t=!1){super(e,a.n.Neutral),this.projectAsCube=!1,this._convertToGammaSpace=!1,this._convertToLinearSpace=!1,this.disableLevelMultiplication=!1,this.registerInput("position",s.y.AutoDetect,!1),this.registerInput("normal",s.y.AutoDetect,!1),this.registerInput("sharpness",s.y.Float,!0),this.registerInput("source",s.y.Object,!0,a.n.VertexAndFragment,new c.s("source",this,0,h.k,"ImageSourceBlock")),this.registerInput("sourceY",s.y.Object,!0,a.n.VertexAndFragment,new c.s("sourceY",this,0,h.k,"ImageSourceBlock")),t||this.registerInput("sourceZ",s.y.Object,!0,a.n.VertexAndFragment,new c.s("sourceZ",this,0,h.k,"ImageSourceBlock")),this.registerOutput("rgba",s.y.Color4,a.n.Neutral),this.registerOutput("rgb",s.y.Color3,a.n.Neutral),this.registerOutput("r",s.y.Float,a.n.Neutral),this.registerOutput("g",s.y.Float,a.n.Neutral),this.registerOutput("b",s.y.Float,a.n.Neutral),this.registerOutput("a",s.y.Float,a.n.Neutral),this.registerOutput("level",s.y.Float,a.n.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(s.y.Color3|s.y.Vector3|s.y.Vector4),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(s.y.Color3|s.y.Vector3|s.y.Vector4)}getClassName(){return"TriPlanarBlock"}get position(){return this._inputs[0]}get normal(){return this._inputs[1]}get sharpness(){return this._inputs[2]}get source(){return this._inputs[3]}get sourceY(){return this._inputs[4]}get sourceZ(){return this._inputs[5]}get rgba(){return this._outputs[0]}get rgb(){return this._outputs[1]}get r(){return this._outputs[2]}get g(){return this._outputs[3]}get b(){return this._outputs[4]}get a(){return this._outputs[5]}get level(){return this._outputs[6]}prepareDefines(e){if(!e._areTexturesDirty)return;let t=this.convertToGammaSpace&&this.texture&&!this.texture.gammaSpace,i=this.convertToLinearSpace&&this.texture&&this.texture.gammaSpace;e.setValue(this._linearDefineName,t,!0),e.setValue(this._gammaDefineName,i,!0)}isReady(){return!this.texture||!!this.texture.isReadyOrNotBlocking()}bind(e){this.texture&&(e.setFloat4(this._textureInfoName,this.texture.level,this.texture.uAng,this.texture.vAng,this.texture.wAng),e.setFloat4(this._textureInfoName2,this.texture.uOffset,this.texture.vOffset,this.texture.uScale,this.texture.vScale),this._imageSource||e.setTexture(this._samplerName,this.texture))}_samplerFunc(e){return 1===e.shaderLanguage?"textureSample":"texture2D"}_generateTextureSample(e,t,i){return 1===i.shaderLanguage?`${this._samplerFunc(i)}(${e},${e+"Sampler"}, ${t})`:`${this._samplerFunc(i)}(${e}, ${t})`}_generateTextureLookup(e){let t=this.samplerName,i=this.samplerYName??t,r=this.samplerZName??t,n=this.sharpness.isConnected?this.sharpness.associatedVariableName:"1.0",a=e._getFreeVariableName("x"),o=e._getFreeVariableName("y"),l=e._getFreeVariableName("z"),u=e._getFreeVariableName("w"),h=e._getFreeVariableName("n"),c=e._getFreeVariableName("uvx"),d=e._getFreeVariableName("uvy"),p=e._getFreeVariableName("uvz");e.compilationString+=`
            ${e._declareLocalVar(h,s.y.Vector3)} = ${this.normal.associatedVariableName}.xyz;

            ${e._declareLocalVar(c,s.y.Vector2)} = ${this.position.associatedVariableName}.yz;
            ${e._declareLocalVar(d,s.y.Vector2)} = ${this.position.associatedVariableName}.zx;
            ${e._declareLocalVar(p,s.y.Vector2)} = ${this.position.associatedVariableName}.xy;
        `,this.projectAsCube&&(e.compilationString+=`
                ${c}.xy = ${c}.yx;

                if (${h}.x >= 0.0) {
                    ${c}.x = -${c}.x;
                }
                if (${h}.y < 0.0) {
                    ${d}.y = -${d}.y;
                }
                if (${h}.z < 0.0) {
                    ${p}.x = -${p}.x;
                }
            `);let f=e.fSuffix;e.compilationString+=`
            // apply rotation
            {
            float cosAngle = cos(${this._textureInfoName}.y);
            float sinAngle = sin(${this._textureInfoName}.y);
            ${c} = mat2${f}(cosAngle, -sinAngle, sinAngle, cosAngle) * ${c};
            cosAngle = cos(${this._textureInfoName}.z);
            sinAngle = sin(${this._textureInfoName}.z);
            ${d} = mat2${f}(cosAngle, sinAngle, -sinAngle, cosAngle) * ${d};
            cosAngle = cos(${this._textureInfoName}.w);
            sinAngle = sin(${this._textureInfoName}.w);
            ${p} = mat2${f}(cosAngle, -sinAngle, sinAngle, cosAngle) * ${p};

            // apply scaling
            vec2${f} uvScale = vec2${f}(${this._textureInfoName2}.z, ${this._textureInfoName2}.w);
            ${c} = ${c} * uvScale;
            ${d} = ${d} * uvScale;
            ${p} = ${p} * uvScale;

            // apply offset
            vec2${f} offset = vec2${f}(${this._textureInfoName2}.x, ${this._textureInfoName2}.y);
            ${c} = ${c} + offset;
            ${d} = ${d} + offset;
            ${p} = ${p} + offset;
            }
        `,e.compilationString+=`
            ${e._declareLocalVar(a,s.y.Vector4)} = ${this._generateTextureSample(t,c,e)};
            ${e._declareLocalVar(o,s.y.Vector4)} = ${this._generateTextureSample(i,d,e)};
            ${e._declareLocalVar(l,s.y.Vector4)} = ${this._generateTextureSample(r,p,e)};
           
            // blend weights
            ${e._declareLocalVar(u,s.y.Vector3)} = pow(abs(${h}), vec3${f}(${n}));

            // blend and return
            ${e._declareLocalVar(this._tempTextureRead,s.y.Vector4)} = (${a}*${u}.x + ${o}*${u}.y + ${l}*${u}.z) / (${u}.x + ${u}.y + ${u}.z);        
        `}_generateConversionCode(e,t,i){let r="";1===e.shaderLanguage&&(t.type===s.y.Vector3||t.type===s.y.Color3)&&(r="Vec3"),"a"!==i&&(this.texture&&this.texture.gammaSpace||(e.compilationString+=`#ifdef ${this._linearDefineName}
                    ${t.associatedVariableName} = toGammaSpace${r}(${t.associatedVariableName});
                    #endif
                `),e.compilationString+=`#ifdef ${this._gammaDefineName}
                ${t.associatedVariableName} = toLinearSpace${r}(${t.associatedVariableName});
                #endif
            `)}_writeOutput(e,t,i){let r="";this.disableLevelMultiplication||(r=` * ${1===e.shaderLanguage?"uniforms.":""}${this._textureInfoName}.x`),e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i}${r};
`,this._generateConversionCode(e,t,i)}_buildBlock(e){super._buildBlock(e),this.source.isConnected?this._imageSource=this.source.connectedPoint.ownerBlock:this._imageSource=null,this._textureInfoName=e._getFreeVariableName("textureInfoName"),this._textureInfoName2=e._getFreeVariableName("textureInfoName2"),this.level.associatedVariableName=(1===e.shaderLanguage?"uniforms.":"")+this._textureInfoName+".x",this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA"),this._imageSource||(this._samplerName=e._getFreeVariableName(this.name+"Texture"),e._emit2DSampler(this._samplerName)),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this);let t=`//${this.name}`;for(let i of(e._emitFunctionFromInclude("helperFunctions",t),e._emitUniformFromString(this._textureInfoName,s.y.Vector4),e._emitUniformFromString(this._textureInfoName2,s.y.Vector4),this._generateTextureLookup(e),this._outputs))i.hasEndpoints&&"level"!==i.name&&this._writeOutput(e,i,i.name);return this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return(e+=`${this._codeVariableName}.convertToGammaSpace = ${this.convertToGammaSpace};
`,e+=`${this._codeVariableName}.convertToLinearSpace = ${this.convertToLinearSpace};
`,e+=`${this._codeVariableName}.disableLevelMultiplication = ${this.disableLevelMultiplication};
`,e+=`${this._codeVariableName}.projectAsCube = ${this.projectAsCube};
`,this.texture)?(e+=`${this._codeVariableName}.texture = new BABYLON.Texture("${this.texture.name}", null, ${this.texture.noMipmap}, ${this.texture.invertY}, ${this.texture.samplingMode});
`,e+=`${this._codeVariableName}.texture.wrapU = ${this.texture.wrapU};
`,e+=`${this._codeVariableName}.texture.wrapV = ${this.texture.wrapV};
`,e+=`${this._codeVariableName}.texture.uAng = ${this.texture.uAng};
`,e+=`${this._codeVariableName}.texture.vAng = ${this.texture.vAng};
`,e+=`${this._codeVariableName}.texture.wAng = ${this.texture.wAng};
`,e+=`${this._codeVariableName}.texture.uOffset = ${this.texture.uOffset};
`,e+=`${this._codeVariableName}.texture.vOffset = ${this.texture.vOffset};
`,e+=`${this._codeVariableName}.texture.uScale = ${this.texture.uScale};
`,e+=`${this._codeVariableName}.texture.vScale = ${this.texture.vScale};
`,e+=`${this._codeVariableName}.texture.coordinatesMode = ${this.texture.coordinatesMode};
`):e}serialize(){let e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,e.disableLevelMultiplication=this.disableLevelMultiplication,e.projectAsCube=this.projectAsCube,this.hasImageSource||!this.texture||this.texture.isRenderTarget||"VideoTexture"===this.texture.getClassName()||(e.texture=this.texture.serialize()),e}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,this.disableLevelMultiplication=!!e.disableLevelMultiplication,this.projectAsCube=!!e.projectAsCube,e.texture&&!o.M.IgnoreTexturesAtLoadTime&&void 0!==e.texture.url&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=u.g.Parse(e.texture,t,i))}}(0,r.Cg)([(0,p.u)("Project as cube",0,"ADVANCED",{embedded:!0,notifiers:{update:!0}})],f.prototype,"projectAsCube",void 0),(0,l.Y5)("BABYLON.TriPlanarBlock",f)},4889(e,t,i){i.d(t,{W:()=>u});var r=i(65511),n=i(45509),s=i(40154),a=i(27371),o=i(87912),l=i(54658);class u extends r.N{constructor(e){super(e,s.n.Neutral),this.registerInput("worldPosition",n.y.Vector4),this.registerInput("cameraPosition",n.y.Vector3),this.registerOutput("output",n.y.Vector3)}getClassName(){return"ViewDirectionBlock"}get worldPosition(){return this._inputs[0]}get cameraPosition(){return this._inputs[1]}get output(){return this._outputs[0]}autoConfigure(e,t=()=>!0){if(!this.cameraPosition.isConnected){let i=e.getInputBlockByPredicate(e=>e.systemValue===o.Z.CameraPosition&&t(e));i||(i=new l.O("cameraPosition")).setAsSystemValue(o.Z.CameraPosition),i.output.connectTo(this.cameraPosition)}}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = normalize(${this.cameraPosition.associatedVariableName} - ${this.worldPosition.associatedVariableName}.xyz);
`,this}}(0,a.Y5)("BABYLON.ViewDirectionBlock",u)},19921(e,t,i){i.d(t,{f:()=>u});var r=i(45509),n=i(40154),s=i(56863),a=i(39543),o=i(33442),l=i(31656);class u{constructor(){this.supportUniformBuffers=!1,this.attributes=[],this.uniforms=[],this.constants=[],this.samplers=[],this.functions={},this.extensions={},this.prePassOutput={},this.counters={},this._terminalBlocks=new Set,this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._injectAtEnd="",this._injectAtTop="",this._customEntryHeader="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}get shaderLanguage(){return this.sharedData.nodeMaterial.shaderLanguage}get fSuffix(){return 1===this.shaderLanguage?"f":""}async getProcessedShaderAsync(e){if(!this._builtCompilationString)return l.V.Error("getProcessedShaderAsync: Shader not built yet."),"";let t=this.sharedData.nodeMaterial.getScene().getEngine(),i={defines:e.split("\n"),indexParameters:void 0,isFragment:this.target===n.n.Fragment,shouldUseHighPrecisionShader:t._shouldUseHighPrecisionShader,processor:t._getShaderProcessor(this.shaderLanguage),supportsUniformBuffers:t.supportsUniformBuffers,shadersRepository:s.l.GetShadersRepository(this.shaderLanguage),includesShadersStore:s.l.GetIncludesShadersStore(this.shaderLanguage),version:(100*t.version).toString(),platformName:t.shaderPlatformName,processingContext:null,isNDCHalfZRange:t.isNDCHalfZRange,useReverseDepthBuffer:t.useReverseDepthBuffer};return!t.isWebGPU&&t.version>1&&(i.processor=new o.n),await new Promise(e=>{(0,a.M0)(this._builtCompilationString,i,(t,i)=>{e(t)},t)})}finalize(e){let t=e.sharedData.emitComments,i=this.target===n.n.Fragment,r=`
${t?"//Entry point\n":""}`;this._customEntryHeader?r+=this._customEntryHeader:1===this.shaderLanguage?i?r+=`@fragment
fn main(input: FragmentInputs) -> FragmentOutputs {
${this.sharedData.varyingInitializationsFragment}`:r+=`@vertex
fn main(input: VertexInputs) -> FragmentInputs{
`:r+=`void main(void) {
`,this.compilationString=r+this.compilationString,this._constantDeclaration&&(this.compilationString=`
${t?"//Constants\n":""}${this._constantDeclaration}
${this.compilationString}`);let s="";for(let e in this.functions)s+=this.functions[e]+`
`;if(this.compilationString=`
${s}
${this.compilationString}`,!i&&this._varyingTransfer&&(this.compilationString=`${this.compilationString}
${this._varyingTransfer}`),this._injectAtEnd&&(this.compilationString=`${this.compilationString}
${this._injectAtEnd}`),this.compilationString=`${this.compilationString}
}`,this.sharedData.varyingDeclaration&&(this.compilationString=`
${t?"//Varyings\n":""}${i?this.sharedData.varyingDeclarationFragment:this.sharedData.varyingDeclaration}
${this.compilationString}`),this._samplerDeclaration&&(this.compilationString=`
${t?"//Samplers\n":""}${this._samplerDeclaration}
${this.compilationString}`),this._uniformDeclaration&&(this.compilationString=`
${t?"//Uniforms\n":""}${this._uniformDeclaration}
${this.compilationString}`),this._attributeDeclaration&&!i&&(this.compilationString=`
${t?"//Attributes\n":""}${this._attributeDeclaration}
${this.compilationString}`),1!==this.shaderLanguage)for(let e in this.compilationString="precision highp float;\n"+this.compilationString,this.compilationString="#if defined(WEBGL2) || defined(WEBGPU)\nprecision highp sampler2DArray;\n#endif\n"+this.compilationString,i&&(this.compilationString="#if defined(PREPASS)\r\n#extension GL_EXT_draw_buffers : require\r\nlayout(location = 0) out highp vec4 glFragData[SCENE_MRT_COUNT];\r\nhighp vec4 gl_FragColor;\r\n#endif\r\n"+this.compilationString),this.extensions){let t=this.extensions[e];this.compilationString=`
${t}
${this.compilationString}`}this._injectAtTop&&(this.compilationString=`${this._injectAtTop}
${this.compilationString}`),this._builtCompilationString=this.compilationString}get _repeatableContentAnchor(){return`###___ANCHOR${this._repeatableContentAnchorIndex++}___###`}_getFreeVariableName(e){return(e=this.sharedData.formatConfig.formatVariablename(e),void 0===this.sharedData.variableNames[e])?(this.sharedData.variableNames[e]=0,"output"===e||"texture"===e)?e+this.sharedData.variableNames[e]:e:(this.sharedData.variableNames[e]++,e+this.sharedData.variableNames[e])}_getFreeDefineName(e){return void 0===this.sharedData.defineNames[e]?this.sharedData.defineNames[e]=0:this.sharedData.defineNames[e]++,e+this.sharedData.defineNames[e]}_excludeVariableName(e){this.sharedData.variableNames[e]=0}_emit2DSampler(e,t="",i=!1,r,n,s){(0>this.samplers.indexOf(e)||i)&&(t&&(this._samplerDeclaration+=`#if ${t}
`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;
`,this._samplerDeclaration+=`var ${e}: texture_2d<${n?"u":"f"}32>;
`):this._samplerDeclaration+=`uniform ${s??""} ${n?"u":""}sampler2D ${e}; ${r||""}
`,t&&(this._samplerDeclaration+=`#endif
`),i||this.samplers.push(e))}_emitCubeSampler(e,t="",i=!1){(0>this.samplers.indexOf(e)||i)&&(t&&(this._samplerDeclaration+=`#if ${t}
`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;
`,this._samplerDeclaration+=`var ${e}: texture_cube<f32>;
`):this._samplerDeclaration+=`uniform samplerCube ${e};
`,t&&(this._samplerDeclaration+=`#endif
`),i||this.samplers.push(e))}_emit2DArraySampler(e){0>this.samplers.indexOf(e)&&(1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;
`,this._samplerDeclaration+=`var ${e}: texture_2d_array<f32>;
`):this._samplerDeclaration+=`uniform sampler2DArray ${e};
`,this.samplers.push(e))}_getGLType(e){switch(e){case r.y.Float:return"float";case r.y.Int:return"int";case r.y.Vector2:return"vec2";case r.y.Color3:case r.y.Vector3:return"vec3";case r.y.Color4:case r.y.Vector4:return"vec4";case r.y.Matrix:return"mat4"}return""}_getShaderType(e){let t=1===this.shaderLanguage;switch(e){case r.y.Float:return t?"f32":"float";case r.y.Int:return t?"i32":"int";case r.y.Vector2:return t?"vec2f":"vec2";case r.y.Color3:case r.y.Vector3:return t?"vec3f":"vec3";case r.y.Color4:case r.y.Vector4:return t?"vec4f":"vec4";case r.y.Matrix:return t?"mat4x4f":"mat4"}return""}_emitExtension(e,t,i=""){this.extensions[e]||(i&&(t=`#if ${i}
${t}
#endif`),this.extensions[e]=t)}_emitFunction(e,t,i){this.functions[e]||(this.sharedData.emitComments&&(t=i+`
`+t),this.functions[e]=t)}_emitCodeFromInclude(e,t,i){let r=s.l.GetIncludesShadersStore(this.shaderLanguage);if(i&&i.repeatKey)return`#include<${e}>${i.substitutionVars?"("+i.substitutionVars+")":""}[0..${i.repeatKey}]
`;let n=r[e]+"\n";if(this.sharedData.emitComments&&(n=t+`
`+n),!i)return n;if(i.replaceStrings)for(let e=0;e<i.replaceStrings.length;e++){let t=i.replaceStrings[e];n=n.replace(t.search,t.replace)}return n}_emitFunctionFromInclude(e,t,i,r=""){let n=e+r;if(this.functions[n])return;let a=s.l.GetIncludesShadersStore(this.shaderLanguage);if(!i||!i.removeAttributes&&!i.removeUniforms&&!i.removeVaryings&&!i.removeIfDef&&!i.replaceStrings){i&&i.repeatKey?this.functions[n]=`#include<${e}>${i.substitutionVars?"("+i.substitutionVars+")":""}[0..${i.repeatKey}]
`:this.functions[n]=`#include<${e}>${i?.substitutionVars?"("+i?.substitutionVars+")":""}
`,this.sharedData.emitComments&&(this.functions[n]=t+`
`+this.functions[n]);return}if(this.functions[n]=a[e],this.sharedData.emitComments&&(this.functions[n]=t+`
`+this.functions[n]),i.removeIfDef&&(this.functions[n]=this.functions[n].replace(/^\s*?#ifdef.+$/gm,""),this.functions[n]=this.functions[n].replace(/^\s*?#endif.*$/gm,""),this.functions[n]=this.functions[n].replace(/^\s*?#else.*$/gm,""),this.functions[n]=this.functions[n].replace(/^\s*?#elif.*$/gm,"")),i.removeAttributes&&(this.functions[n]=this.functions[n].replace(/\s*?attribute .+?;/g,"\n")),i.removeUniforms&&(this.functions[n]=this.functions[n].replace(/\s*?uniform .*?;/g,"\n")),i.removeVaryings&&(this.functions[n]=this.functions[n].replace(/\s*?(varying|in) .+?;/g,"\n")),i.replaceStrings)for(let e=0;e<i.replaceStrings.length;e++){let t=i.replaceStrings[e];this.functions[n]=this.functions[n].replace(t.search,t.replace)}}_registerTempVariable(e){return -1===this.sharedData.temps.indexOf(e)&&(this.sharedData.temps.push(e),!0)}_emitDefineStart(e,t=!1){let i="";return e&&(i=e.startsWith("defined(")?`#if ${e}
`:`${t?"#ifndef":"#ifdef"} ${e}
`),i}_emitDefineEnd(e){return e?`#endif
`:""}_emitVaryingFromString(e,t,i="",r=!1){if(-1!==this.sharedData.varyings.indexOf(e))return!1;this.sharedData.varyings.push(e);let n=this._getShaderType(t),s=(t=!1)=>{let s=this._emitDefineStart(i,r);if(1===this.shaderLanguage)switch(n){case"i32":case"f32":case"vec2f":case"vec3f":case"vec4f":s+=`varying ${e}: ${n};
`,t&&(s+=`var<private> ${e}: ${n};
`,this.sharedData.varyingInitializationsFragment+=this._emitDefineStart(i,r)+`${e} = fragmentInputs.${e};
`+this._emitDefineEnd(i));break;case"mat4x4f":s+=`varying ${e}_r0: vec4f;
`,s+=`varying ${e}_r1: vec4f;
`,s+=`varying ${e}_r2: vec4f;
`,s+=`varying ${e}_r3: vec4f;
`,t&&(s+=`var<private> ${e}: mat4x4f;
`,this.sharedData.varyingInitializationsFragment+=this._emitDefineStart(i,r)+`${e} = mat4x4f(fragmentInputs.${e}_r0, fragmentInputs.${e}_r1, fragmentInputs.${e}_r2, fragmentInputs.${e}_r3);
`+this._emitDefineEnd(i));break;default:s+=`varying ${e}: ${n};
`}else s+=`varying ${n} ${e};
`;return s+this._emitDefineEnd(i)};if(1===this.shaderLanguage)this.sharedData.varyingDeclaration+=s(!1),this.sharedData.varyingDeclarationFragment+=s(!0);else{let e=s();this.sharedData.varyingDeclaration+=e,this.sharedData.varyingDeclarationFragment+=e}return!0}_getVaryingName(e){return 1===this.shaderLanguage?(this.target!==n.n.Fragment?"vertexOutputs.":"fragmentInputs.")+e:e}_emitUniformFromString(e,t,i="",r=!1){if(-1!==this.uniforms.indexOf(e))return;this.uniforms.push(e),i&&(i.startsWith("defined(")?this._uniformDeclaration+=`#if ${i}
`:this._uniformDeclaration+=`${r?"#ifndef":"#ifdef"} ${i}
`),this.sharedData.formatConfig.getUniformAnnotation&&(this._uniformDeclaration+=this.sharedData.formatConfig.getUniformAnnotation(e));let n=this._getShaderType(t);1===this.shaderLanguage?this._uniformDeclaration+=`uniform ${e}: ${n};
`:this._uniformDeclaration+=`uniform ${n} ${e};
`,i&&(this._uniformDeclaration+=`#endif
`)}_generateTernary(e,t,i){return 1===this.shaderLanguage?`select(${t}, ${e}, ${i})`:`(${i}) ? ${e} : ${t}`}_emitFloat(e){return e.toString()===e.toFixed(0)?`${e}.0`:e.toString()}_declareOutput(e,t){return this._declareLocalVar(e.associatedVariableName,e.type,t)}_declareLocalVar(e,t,i,r){return 1===this.shaderLanguage?`${i?"const":"var"+(r?"<private>":"")} ${e}: ${this._getShaderType(t)}`:`${i?"const ":""}${this._getShaderType(t)} ${e}`}_samplerCubeFunc(){return 1===this.shaderLanguage?"textureSample":"textureCube"}_samplerFunc(){return 1===this.shaderLanguage?"textureSample":"texture2D"}_samplerLODFunc(){return 1===this.shaderLanguage?"textureSampleLevel":"texture2DLodEXT"}_toLinearSpace(e){return 1===this.shaderLanguage&&(e.type===r.y.Color3||e.type===r.y.Vector3)?`toLinearSpaceVec3(${e.associatedVariableName})`:`toLinearSpace(${e.associatedVariableName})`}_generateTextureSample(e,t){return 1===this.shaderLanguage?`${this._samplerFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerFunc()}(${t}, ${e})`}_generateTextureSampleLOD(e,t,i){return 1===this.shaderLanguage?`${this._samplerLODFunc()}(${t},${t+"Sampler"}, ${e}, ${i})`:`${this._samplerLODFunc()}(${t}, ${e}, ${i})`}_generateTextureSampleCube(e,t){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerCubeFunc()}(${t}, ${e})`}_generateTextureSampleCubeLOD(e,t,i){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e}, ${i})`:`${this._samplerCubeFunc()}(${t}, ${e}, ${i})`}_convertVariableDeclarationToWGSL(e,t,i){return i.replace(RegExp(`(${e})\\s+(\\w+)`,"g"),`var $2: ${t}`)}_convertVariableConstructorsToWGSL(e,t,i){return i.replace(RegExp(`(${e})\\(`,"g"),` ${t}(`)}_convertOutParametersToWGSL(e){return e.replace(RegExp("out\\s+var\\s+(\\w+)\\s*:\\s*(\\w+)","g"),"$1: ptr<function, $2>")}_convertTernaryOperandsToWGSL(e){return e.replace(RegExp("\\[(.*?)\\?(.*?):(.*)\\]","g"),(e,t,i,r)=>`select(${r}, ${i}, ${t})`)}_convertModOperatorsToWGSL(e){return e.replace(RegExp("mod\\((.+?),\\s*(.+?)\\)","g"),(e,t,i)=>`((${t})%(${i}))`)}_convertConstToWGSL(e){return e.replace(RegExp("const var","g"),"const")}_convertInnerFunctionsToWGSL(e){return e.replace(/inversesqrt/g,"inverseSqrt")}_convertFunctionsToWGSL(e){let t,i=/var\s+(\w+)\s*:\s*(\w+)\((.*)\)/g;for(;null!==(t=i.exec(e));){let i=t[1],r=t[2],n=t[3].replace(/var\s/g,"");e=e.replace(t[0],`fn ${i}(${n}) -> ${r}`)}return e}_babylonSLtoWGSL(e){return e=this._convertVariableDeclarationToWGSL("void","voidnull",e),e=this._convertVariableDeclarationToWGSL("bool","bool",e),e=this._convertVariableDeclarationToWGSL("int","i32",e),e=this._convertVariableDeclarationToWGSL("uint","u32",e),e=this._convertVariableDeclarationToWGSL("float","f32",e),e=this._convertVariableDeclarationToWGSL("vec2","vec2f",e),e=this._convertVariableDeclarationToWGSL("vec3","vec3f",e),e=this._convertVariableDeclarationToWGSL("vec4","vec4f",e),e=this._convertVariableDeclarationToWGSL("mat2","mat2x2f",e),e=this._convertVariableDeclarationToWGSL("mat3","mat3x3f",e),e=this._convertVariableDeclarationToWGSL("mat4","mat4x4f",e),e=this._convertVariableConstructorsToWGSL("float","f32",e),e=this._convertVariableConstructorsToWGSL("vec2","vec2f",e),e=this._convertVariableConstructorsToWGSL("vec3","vec3f",e),e=this._convertVariableConstructorsToWGSL("vec4","vec4f",e),e=this._convertVariableConstructorsToWGSL("mat2","mat2x2f",e),e=this._convertVariableConstructorsToWGSL("mat3","mat3x3f",e),e=this._convertVariableConstructorsToWGSL("mat4","mat4x4f",e),e=this._convertTernaryOperandsToWGSL(e),e=this._convertModOperatorsToWGSL(e),e=this._convertConstToWGSL(e),e=this._convertInnerFunctionsToWGSL(e),e=(e=this._convertOutParametersToWGSL(e)).replace(/\[\*\]/g,"*"),e=(e=(e=(e=this._convertFunctionsToWGSL(e)).replace(/\s->\svoidnull/g,"")).replace(/dFdx/g,"dpdx")).replace(/dFdy/g,"dpdy")}_convertTernaryOperandsToGLSL(e){return e.replace(RegExp("\\[(.+?)\\?(.+?):(.+)\\]","g"),(e,t,i,r)=>`${t} ? ${i} : ${r}`)}_babylonSLtoGLSL(e){return e=e.replace(/\[\*\]/g,""),e=this._convertTernaryOperandsToGLSL(e)}}},51320(e,t,i){i.d(t,{Y:()=>n});var r=i(31656);class n{constructor(){this.temps=[],this.varyings=[],this.varyingDeclaration="",this.varyingDeclarationFragment="",this.varyingInitializationsFragment="",this.inputBlocks=[],this.textureBlocks=[],this.bindableBlocks=[],this.forcedBindableBlocks=[],this.blocksWithFallbacks=[],this.blocksWithDefines=[],this.repeatableContentBlocks=[],this.dynamicUniformBlocks=[],this.blockingBlocks=[],this.animatedInputs=[],this.defines={},this.formatConfig={getUniformAnnotation:null,formatVariablename:e=>e.replace(/[^a-zA-Z_]+/g,"")},this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:[],customErrors:[]},this.allowEmptyVertexProgram=!1,this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.view=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}raiseBuildError(e){-1!==this.checks.customErrors.indexOf(e)&&this.checks.customErrors.push(e)}emitErrors(){let e="";for(let t of(this.checks.emitVertex||this.allowEmptyVertexProgram||(e+="NodeMaterial does not have a vertex output. You need to at least add a block that generates a position value.\n"),this.checks.emitFragment||(e+="NodeMaterial does not have a fragment output. You need to at least add a block that generates a color value.\n"),this.checks.notConnectedNonOptionalInputs))e+=`input ${t.name} from block ${t.ownerBlock.name}[${t.ownerBlock.getClassName()}] is not connected and is not optional.
`;for(let t of this.checks.customErrors)e+=t+"\n";return!e||(e="Node material build failed: \n"+e,r.V.Error(e),this.nodeMaterial.onBuildErrorObservable.notifyObservers(e),!1)}}},82824(e,t,i){i.d(t,{X:()=>l});var r=i(51275),n=i(39058),s=i(12797),a=i(58368),o=i(34767);class l{constructor(e,t={}){this.quality=4096,this.hdrScale=1,this.useCdf=!1,this._engine=e,this.hdrScale=t.hdrScale||this.hdrScale,this.quality=t.quality||this.quality,this.useCdf=t.useCdf||this.useCdf}_createRenderTarget(e){let t=0;this._engine.getCaps().textureHalfFloatRender?t=2:this._engine.getCaps().textureFloatRender&&(t=1);let i=this._engine.createRenderTargetCubeTexture(e,{format:5,type:t,createMipMaps:!1,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:2,label:"HDR_Irradiance_Filtering_Target"});return this._engine.updateTextureWrappingMode(i.texture,0,0,0),i}_prefilterInternal(e){let t=e.getSize().width,i=(0,n.ILog2)(t),a=this._effectWrapper.effect,o=Math.max(32,1<<(0,n.ILog2)(t>>3)),l=this._createRenderTarget(o);this._effectRenderer.saveStates(),this._effectRenderer.setViewport(),this._effectRenderer.applyEffectWrapper(this._effectWrapper);let u=[[new r.Pq(0,0,-1),new r.Pq(0,-1,0),new r.Pq(1,0,0)],[new r.Pq(0,0,1),new r.Pq(0,-1,0),new r.Pq(-1,0,0)],[new r.Pq(1,0,0),new r.Pq(0,0,1),new r.Pq(0,1,0)],[new r.Pq(1,0,0),new r.Pq(0,0,-1),new r.Pq(0,-1,0)],[new r.Pq(1,0,0),new r.Pq(0,-1,0),new r.Pq(0,0,1)],[new r.Pq(-1,0,0),new r.Pq(0,-1,0),new r.Pq(0,0,-1)]];a.setFloat("hdrScale",this.hdrScale),a.setFloat2("vFilteringInfo",e.getSize().width,i),a.setTexture("inputTexture",e),this._cdfGenerator&&a.setTexture("icdfTexture",this._cdfGenerator.getIcdfTexture());for(let e=0;e<6;e++)a.setVector3("up",u[e][0]),a.setVector3("right",u[e][1]),a.setVector3("front",u[e][2]),this._engine.bindFramebuffer(l,e,void 0,void 0,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper),this._effectRenderer.draw();this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),a.setTexture("inputTexture",null),a.setTexture("icdfTexture",null);let h=new s.t(e.getScene(),l.texture);return h.name=e.name+"_irradiance",h.displayName=e.name+"_irradiance",h.gammaSpace=!1,h}_createEffect(e,t){let r=[];e.gammaSpace&&r.push("#define GAMMA_INPUT"),r.push("#define NUM_SAMPLES "+this.quality+"u");let n=this._engine.isWebGPU,s=["inputTexture"];return this._cdfGenerator&&(s.push("icdfTexture"),r.push("#define IBL_CDF_FILTERING")),new a.$({engine:this._engine,name:"HDRIrradianceFiltering",vertexShader:"hdrIrradianceFiltering",fragmentShader:"hdrIrradianceFiltering",samplerNames:s,uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale"],useShaderStore:!0,defines:r,onCompiled:t,shaderLanguage:+!!n,extraInitializationsAsync:async()=>{n?await Promise.all([i.e("6060").then(i.bind(i,23591)),Promise.all([i.e("7186"),i.e("4622")]).then(i.bind(i,57133))]):await Promise.all([i.e("8499").then(i.bind(i,32974)),Promise.all([i.e("2421"),i.e("6473")]).then(i.bind(i,59136))])}})}isReady(e){return e.isReady()&&this._effectWrapper.effect.isReady()}async prefilter(e){if(!this._engine._features.allowTexturePrefiltering)throw Error("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead.");this.useCdf&&(this._cdfGenerator=new o.O(this._engine),this._cdfGenerator.iblSource=e,await this._cdfGenerator.renderWhenReady()),this._effectRenderer=new a.J(this._engine),this._effectWrapper=this._createEffect(e),await this._effectWrapper.effect.whenCompiledAsync();let t=this._prefilterInternal(e);return this.useCdf&&await this._cdfGenerator.findDominantDirection().then(e=>{t._dominantDirection=e}),this._effectRenderer.dispose(),this._effectWrapper.dispose(),this._cdfGenerator?.dispose(),t}}},49207(e,t,i){i.d(t,{_DDSTextureLoader:()=>s});var r=i(13468),n=i(97319);class s{constructor(){this.supportCascades=!0}loadCubeData(e,t,i,s){let a,o=t.getEngine(),l=!1,u=1e3;if(Array.isArray(e))for(let i=0;i<e.length;i++){let r=e[i];t.width=(a=n.DDSTools.GetDDSInfo(r)).width,t.height=a.height,l=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&t.generateMipMaps,o._unpackFlipY(a.isCompressed),n.DDSTools.UploadDDSLevels(o,t,r,a,l,6,-1,i),a.isFourCC||1!==a.mipmapCount?u=a.mipmapCount-1:o.generateMipMapsForCubemap(t)}else t.width=(a=n.DDSTools.GetDDSInfo(e)).width,t.height=a.height,i&&(a.sphericalPolynomial=new r.Q),l=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&t.generateMipMaps,o._unpackFlipY(a.isCompressed),n.DDSTools.UploadDDSLevels(o,t,e,a,l,6),a.isFourCC||1!==a.mipmapCount?u=a.mipmapCount-1:o.generateMipMapsForCubemap(t,!1);o._setCubeMapTextureParams(t,l,u),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),s&&s({isDDS:!0,width:t.width,info:a,data:e,texture:t})}loadData(e,t,i){let r=n.DDSTools.GetDDSInfo(e),s=(r.isRGB||r.isLuminance||r.mipmapCount>1)&&t.generateMipMaps&&Math.max(r.width,r.height)>>r.mipmapCount-1==1;i(r.width,r.height,s,r.isFourCC,()=>{n.DDSTools.UploadDDSLevels(t.getEngine(),t,e,r,s,1)})}}},42121(e,t,i){i.d(t,{_ENVTextureLoader:()=>n});var r=i(30105);class n{constructor(){this.supportCascades=!1}loadCubeData(e,t,i,n,s){if(Array.isArray(e))return;let a=(0,r.cU)(e);if(a){t.width=a.width,t.height=a.width;try{(0,r.ow)(t,a),(0,r.o5)(t,e,a).then(()=>{t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),n&&n()},e=>{s?.("Can not upload environment levels",e)})}catch(e){s?.("Can not upload environment file",e)}}else s&&s("Can not parse the environment file",null)}loadData(){throw".env not supported in 2d."}}},82955(e,t,i){i.d(t,{_KTXTextureLoader:()=>a});var r=i(52348),n=i(21612),s=i(31656);class a{constructor(){this.supportCascades=!1}loadCubeData(e,t,i,n){if(Array.isArray(e))return;t._invertVScale=!t.invertY;let s=t.getEngine(),a=new r.H(e,6),o=a.numberOfMipmapLevels>1&&t.generateMipMaps;s._unpackFlipY(!0),a.uploadLevels(t,t.generateMipMaps),t.width=a.pixelWidth,t.height=a.pixelHeight,s._setCubeMapTextureParams(t,o,a.numberOfMipmapLevels-1),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),n&&n()}loadData(e,t,i,a){if(r.H.IsValid(e)){t._invertVScale=!t.invertY;let n=new r.H(e,1),s=function(e){switch(e){case 35916:return 33776;case 35918:return 33778;case 35919:return 33779;case 37493:return 37492;case 37497:return 37496;case 37495:return 37494;case 37840:return 37808;case 36493:return 36492}return null}(n.glInternalFormat);s?(t.format=s,t._useSRGBBuffer=t.getEngine()._getUseSRGBBuffer(!0,t.generateMipMaps),t._gammaSpace=!0):t.format=n.glInternalFormat,i(n.pixelWidth,n.pixelHeight,t.generateMipMaps,!0,()=>{n.uploadLevels(t,t.generateMipMaps)},n.isInvalid)}else n.Z.IsValid(e)?new n.Z(t.getEngine())._uploadAsync(e,t,a).then(()=>{i(t.width,t.height,t.generateMipMaps,!0,()=>{},!1)},e=>{s.V.Warn(`Failed to load KTX2 texture data: ${e.message}`),i(0,0,!1,!1,()=>{},!0)}):(s.V.Error("texture missing KTX identifier"),i(0,0,!1,!1,()=>{},!0))}}},91621(e,t,i){var r=i(76752),n=i(12797);n.t.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(n.t.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;this._texture.isReady&&(this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=r.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then(e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0})))}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})},22253(e,t,i){i.d(t,{b:()=>d});var r=i(39545),n=i(61646),s=i(32997),a=i(70134),o=i(12797),l=i(49578),u=i(27371),h=i(52969),c=i(57176);i(43946);class d extends o.t{set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;let t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(a.uq.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(e,t,i){let r="";for(let t of e)r+=t;return new d(r,t,null,i,e)}static CreateFromPrefilteredData(e,t,i=null,r=!0){let n=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;let s=new d(e,t,null,!1,null,null,null,void 0,!0,i,r);return t.useDelayedTextureLoading=n,s}constructor(e,t,i=null,r=!1,n=null,s=null,o=null,u=5,c=!1,d=null,p=!1,f=.8,_=0,m,g){super(t),this.onLoadObservable=new h.cP,this.boundingBoxPosition=a.Pq.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new a.uq,this._buffer=null,this.name=e,this.url=e,this._noMipmap=r,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=a.uq.Identity(),this.coordinatesMode=l.g.CUBIC_MODE;let b=null,y=null;if(null===i||Array.isArray(i)?(this._noMipmap=r,this._format=u,this._createPolynomials=p,b=i,this._loaderOptions=m,this._useSRGBBuffer=g,this._lodScale=f,this._lodOffset=_):(b=i.extensions??null,this._noMipmap=i.noMipmap??!1,n=i.files??null,y=i.buffer??null,this._format=i.format??5,c=i.prefiltered??!1,d=i.forcedExtension??null,this._createPolynomials=i.createPolynomials??!1,this._lodScale=i.lodScale??.8,this._lodOffset=i.lodOffset??0,this._loaderOptions=i.loaderOptions,this._useSRGBBuffer=i.useSRGBBuffer,s=i.onLoad??null,o=i.onError??null),!e&&!n)return;this.updateURL(e,d,s,c,o,b,this.getScene()?.useDelayedTextureLoading,n,y)}getClassName(){return"CubeTexture"}updateURL(e,t=null,i=null,r=!1,n=null,s=null,a=!1,o=null,l=null){(!this.name||this.name.startsWith("data:"))&&(this.name=e),this.url=e,t&&(this._forcedExtension=t);let u=e.lastIndexOf("."),h=t||(u>-1?e.substring(u).toLowerCase():""),c=0===h.indexOf(".dds"),d=0===h.indexOf(".env"),p=0===h.indexOf(".basis");if(d?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=r,r&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),o)this._files=o;else if(p||d||c||s||(s=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,s){for(let t=0;t<s.length;t++)this._files.push(e+s[t]);this._extensions=s}this._buffer=l,a?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=n):this._loadTexture(i,n)}delayLoad(e){4===this.delayLoadState&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(e){if(e.updateFlag===this._textureMatrix.updateFlag||(e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene()?.markAllMaterialsAsDirty(1,e=>-1!==e.getActiveTextures().indexOf(this)),this._textureMatrix=e,!this.getScene()?.useRightHandedSystem))return;let t=a.AA.Vector3["0"],i=a.AA.Quaternion["0"],r=a.AA.Vector3["1"];this._textureMatrix.decompose(t,i,r),i.z*=-1,i.w*=-1,a.uq.ComposeToRef(t,i,r,this._textureMatrixRefraction)}getRefractionTextureMatrix(){return this.getScene()?.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(e=null,t=null){let i=this.getScene(),r=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);let n=()=>{this.onLoadObservable.notifyObservers(this),r&&(r.dispose(),this.getScene()?.markAllMaterialsAsDirty(1)),e&&e()},a=(e,i)=>{this._loadingError=!0,this._errorObject={message:e,exception:i},t&&t(e,i),l.g.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?s.S0.SetImmediate(()=>n()):this._texture.onLoadedObservable.add(()=>n()):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,e,a,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,e,a,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),this._texture?.onLoadedObservable.add(()=>this.onLoadObservable.notifyObservers(this)))}static Parse(e,t,i){let r=c.p.Parse(()=>{let r=!1;return e.prefiltered&&(r=e.prefiltered),new d(i+(e.url??e.name),t,e.extensions,!1,e.files||null,null,null,void 0,r,e.forcedExtension)},e,t);if(e.boundingBoxPosition&&(r.boundingBoxPosition=a.Pq.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(r.boundingBoxSize=a.Pq.FromArray(e.boundingBoxSize)),e.animations)for(let t=0;t<e.animations.length;t++){let i=e.animations[t],n=(0,u.n9)("BABYLON.Animation");n&&r.animations.push(n.Parse(i))}return r}clone(){let e=0,t=c.p.Clone(()=>{let t=new d(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return e=t.uniqueId,t},this);return t.uniqueId=e,t}}(0,r.Cg)([(0,n.lK)()],d.prototype,"url",void 0),(0,r.Cg)([(0,n.P_)()],d.prototype,"boundingBoxPosition",void 0),(0,r.Cg)([(0,n.P_)()],d.prototype,"boundingBoxSize",null),(0,r.Cg)([(0,n.lK)("rotationY")],d.prototype,"rotationY",null),(0,r.Cg)([(0,n.lK)("files")],d.prototype,"_files",void 0),(0,r.Cg)([(0,n.lK)("forcedExtension")],d.prototype,"_forcedExtension",void 0),(0,r.Cg)([(0,n.lK)("extensions")],d.prototype,"_extensions",void 0),(0,r.Cg)([(0,n.GG)("textureMatrix")],d.prototype,"_textureMatrix",void 0),(0,r.Cg)([(0,n.GG)("textureMatrixRefraction")],d.prototype,"_textureMatrixRefraction",void 0),l.g._CubeTextureParser=d.Parse,(0,u.Y5)("BABYLON.CubeTexture",d)},48696(e,t,i){i.d(t,{I:()=>n});var r=i(49578);class n extends r.g{constructor(e,t,i,n,s,a=!0,o=!1,l=3,u=0,h,c,d){if(super(null,s,!a,o,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,h),this.format=n,!this._engine)return;this._engine._caps.textureFloatLinearFiltering||1!==u||(l=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==u||(l=1),this._texture=this._engine.createRawTexture(e,t,i,n,a,o,l,null,u,h??0,c??!1),this.wrapU=r.g.CLAMP_ADDRESSMODE,this.wrapV=r.g.CLAMP_ADDRESSMODE,this._waitingForData=!!d&&!e}update(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();let e=new n(null,this.getSize().width,this.getSize().height,this.format,this.getScene(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return e._texture=this._texture,this._texture.incrementReferences(),e}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(e,t,i,r,s=!0,a=!1,o=3){return new n(e,t,i,1,r,s,a,o)}static CreateLuminanceAlphaTexture(e,t,i,r,s=!0,a=!1,o=3){return new n(e,t,i,2,r,s,a,o)}static CreateAlphaTexture(e,t,i,r,s=!0,a=!1,o=3){return new n(e,t,i,0,r,s,a,o)}static CreateRGBTexture(e,t,i,r,s=!0,a=!1,o=3,l=0,u=0,h=!1){return new n(e,t,i,4,r,s,a,o,l,u,h)}static CreateRGBATexture(e,t,i,r,s=!0,a=!1,o=3,l=0,u=0,h=!1,c=!1){return new n(e,t,i,5,r,s,a,o,l,u,h,c)}static CreateRGBAStorageTexture(e,t,i,r,s=!0,a=!1,o=3,l=0,u=!1){return new n(e,t,i,5,r,s,a,o,l,1,u)}static CreateRTexture(e,t,i,s,a=!0,o=!1,l=r.g.TRILINEAR_SAMPLINGMODE,u=1){return new n(e,t,i,6,s,a,o,l,u)}static CreateRStorageTexture(e,t,i,s,a=!0,o=!1,l=r.g.TRILINEAR_SAMPLINGMODE,u=1){return new n(e,t,i,6,s,a,o,l,u,1)}}},78629(e,t,i){i.d(t,{$:()=>c});var r=i(52969),n=i(70134),s=i(49578),a=i(18199),o=i(78598),l=i(54859),u=i(31656),h=i(15548);l.M.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)};class c extends s.g{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(e){this._objectRenderer.renderListPredicate=e}get renderList(){return this._objectRenderer.renderList}set renderList(e){this._objectRenderer.renderList=e}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(e){this._objectRenderer.particleSystemList=e}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(e){this._objectRenderer.getCustomRenderList=e}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(e){this._objectRenderer.renderParticles=e}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(e){this._objectRenderer.renderSprites=e}get enableBoundingBoxRendering(){return this._objectRenderer.enableBoundingBoxRendering}set enableBoundingBoxRendering(e){this._objectRenderer.enableBoundingBoxRendering=e}get enableOutlineRendering(){return this._objectRenderer.enableOutlineRendering}set enableOutlineRendering(e){this._objectRenderer.enableOutlineRendering=e}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(e){this._objectRenderer.forceLayerMaskCheck=e}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(e){this._objectRenderer.activeCamera=e}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(e){this._objectRenderer.cameraForLOD=e}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(e){this._objectRenderer.disableImageProcessing=e}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(e){this._objectRenderer.customIsReadyFunction=e}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(e){this._objectRenderer.customRenderFunction=e}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}set onClear(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(e){this._objectRenderer._waitingRenderList=e}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(e,t){this._objectRenderer.setMaterialForRendering(e,t)}get isMulti(){return this._renderTarget?.isMulti??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;let t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){return this._renderTarget?._depthStencilTexture??null}constructor(e,t,i,a=!1,o=!0,l=0,c=!1,d=s.g.TRILINEAR_SAMPLINGMODE,p=!0,f=!1,_=!1,m=5,g=!1,b,y,x=!1,T=!1){let v,A,S=!0,E=!1;if("object"==typeof a){const e=a;a=!!e.generateMipMaps,o=e.doNotChangeAspectRatio??!0,l=e.type??0,c=!!e.isCube,d=e.samplingMode??s.g.TRILINEAR_SAMPLINGMODE,p=e.generateDepthBuffer??!0,f=!!e.generateStencilBuffer,_=!!e.isMulti,m=e.format??5,g=!!e.delayAllocation,b=e.samples,y=e.creationFlags,x=!!e.noColorAttachment,T=!!e.useSRGBBuffer,v=e.colorAttachment,S=e.gammaSpace??S,A=e.existingObjectRenderer,E=!!e.enableClusteredLights}if(super(null,i,!a,void 0,d,void 0,void 0,void 0,void 0,m),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new r.cP,this.onAfterUnbindObservable=new r.cP,this.onClearObservable=new r.cP,this.onResizeObservable=new r.cP,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=n.Pq.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(i=this.getScene()))return;const I=this.getScene().getEngine();if(this._gammaSpace=S,this._coordinatesMode=s.g.PROJECTION_MODE,this.name=e,this.isRenderTarget=!0,this._initialSizeParameter=t,this._dontDisposeObjectRenderer=!!A,this._processSizeParameter(t),this._objectRenderer=A??new h.P(e,i,{numPasses:c?6:this.getRenderLayers()||1,doNotChangeAspectRatio:o,enableClusteredLights:E}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add(()=>{if(!this._disableEngineStages)for(let e of this._scene._beforeRenderTargetClearStage)e.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(I):this.skipInitialClear||I.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(let e of this._scene._beforeRenderTargetDrawStage)e.action(this,this._currentFaceIndex,this._currentLayer);I._debugPushGroup?.(`Render to ${this.name} (face #${this._currentFaceIndex} layer #${this._currentLayer})`)}),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add(()=>{if(I._debugPopGroup?.(),!this._disableEngineStages)for(let e of this._scene._afterRenderTargetDrawStage)e.action(this,this._currentFaceIndex,this._currentLayer);let e=this._texture?.generateMipMaps??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(let e of this._scene._afterRenderTargetPostProcessStage)e.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=e),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),I):u.V.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add(()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(I):this.skipInitialClear||I.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)}),this._resizeObserver=I.onResizeObservable.add(()=>{}),this._generateMipMaps=!!a,this._doNotChangeAspectRatio=o,_)return;this._renderTargetOptions={generateMipMaps:a,type:l,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:p,generateStencilBuffer:f,samples:b,creationFlags:y,noColorAttachment:x,useSRGBBuffer:T,colorAttachment:v,label:this.name},this.samplingMode===s.g.NEAREST_SAMPLINGMODE&&(this.wrapU=s.g.CLAMP_ADDRESSMODE,this.wrapV=s.g.CLAMP_ADDRESSMODE),g||(c?(this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=s.g.INVCUBIC_MODE,this._textureMatrix=n.uq.Identity()):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==b&&(this.samples=b))}createDepthStencilTexture(e=0,t=!0,i=!1,r=1,n=14,s){this._renderTarget?.createDepthStencilTexture(e,t,i,r,n,s)}_processSizeParameter(e){if(e.ratio){this._sizeRatio=e.ratio;let t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e}get samples(){return this._renderTarget?.samples??this._samples}set samples(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))}addPostProcess(e){if(!this._postProcessManager){let e=this.getScene();if(!e)return;this._postProcessManager=new a.X(e),this._postProcesses=[]}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1}clearPostProcesses(e=!1){if(this._postProcesses){if(e)for(let e of this._postProcesses)e.dispose();this._postProcesses=[]}}removePostProcess(e){if(!this._postProcesses)return;let t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(e){this._objectRenderer.refreshRate=e}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){let e=this._size.layers;if(e)return e;let t=this._size.depth;return t||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(e){let t=Math.max(1,this.getRenderSize()*e);this.resize(t)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(e){let t=this.isCube;this._renderTarget?.dispose(),this._renderTarget=null;let i=this.getScene();i&&(this._processSizeParameter(e),t?this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(e=!1,t=!1){this._render(e,t)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(i.bind(i,69219)).then(e=>this._dumpTools=e)),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());let e=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),e}_render(e=!1,t=!1){let i=this.getScene();if(i){if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),(this.is2DArray||this.is3D)&&!this.isMulti)for(let r=0;r<this.getRenderLayers();r++)this._renderToTarget(0,e,t,r),i.incrementRenderId(),i.resetCachedMaterial();else if(this.isCube&&!this.isMulti)for(let r=0;r<6;r++)this._renderToTarget(r,e,t),i.incrementRenderId(),i.resetCachedMaterial();else this._renderToTarget(0,e,t);this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(e,t){let i=e*t,r=(0,o.OG)(i+16384/(128+i));return Math.min((0,o.C4)(e),r)}_bindFrameBuffer(e=0,t=0){let i=this.getScene();if(!i)return;let r=i.getEngine();this._renderTarget&&r.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}_unbindFrameBuffer(e,t){this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,()=>{this.onAfterRenderObservable.notifyObservers(t)})}_prepareFrame(e,t,i,r){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(t,i):r&&e.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,i)}_renderToTarget(e,t,i,r=0){let n=this.getScene();if(!n)return;let s=n.getEngine();this._currentFaceIndex=e,this._currentLayer=r,this._currentUseCameraPostProcess=t,this._currentDumpForDebug=i,this._prepareFrame(n,e,r,t),this._objectRenderer.render(e+r,!0),this._unbindFrameBuffer(s,e),this._texture&&this.isCube&&5===e&&s.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(e,t=null,i=null,r=null){this._objectRenderer.setRenderingOrder(e,t,i,r)}setRenderingAutoClearDepthStencil(e,t){this._objectRenderer.setRenderingAutoClearDepthStencil(e,t)}clone(){let e=this.getSize(),t=new c(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t}serialize(){if(!this.name)return null;let e=super.serialize();if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(let t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e}disposeFramebufferObjects(){this._renderTarget?.dispose(!0)}releaseInternalTexture(){this._renderTarget?.releaseTextures(),this._texture=null}dispose(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);let e=this.getScene();if(!e)return;let t=e.customRenderTargets.indexOf(this);for(let i of(t>=0&&e.customRenderTargets.splice(t,1),e.cameras))(t=i.customRenderTargets.indexOf(this))>=0&&i.customRenderTargets.splice(t,1);this._renderTarget?.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}c.REFRESHRATE_RENDER_ONCE=h.P.REFRESHRATE_RENDER_ONCE,c.REFRESHRATE_RENDER_ONEVERYFRAME=h.P.REFRESHRATE_RENDER_ONEVERYFRAME,c.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=h.P.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,s.g._CreateRenderTargetTexture=(e,t,i,r,n)=>new c(e,t,i,r)},49578(e,t,i){i.d(t,{g:()=>g});var r=i(39545),n=i(61646),s=i(52969),a=i(70134),o=i(12797),l=i(27371),u=i(39446),h=i(26675),c=i(99512),d=i(51551),p=i(78898),f=i(96534),_=i(59820),m=i(57176);class g extends o.t{static _CreateVideoTexture(e,t,i,r=!1,n=!1,s=g.TRILINEAR_SAMPLINGMODE,a={},o,l=5){throw(0,u.n)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(e,t,i,r,n=g.TRILINEAR_SAMPLINGMODE,a=null,o=null,l=null,u=!1,c,d,p,f,m){let b;super(t),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new s.cP,this._isBlocking=!0,this.name=e||"",this.url=e;let y=!1,x=null,T=!0;"object"==typeof i&&null!==i?(b=i.noMipmap??!1,r=i.invertY??!_.rX,n=i.samplingMode??g.TRILINEAR_SAMPLINGMODE,a=i.onLoad??null,o=i.onError??null,l=i.buffer??null,u=i.deleteBuffer??!1,c=i.format,d=i.mimeType,p=i.loaderOptions,f=i.creationFlags,y=i.useSRGBBuffer??!1,x=i.internalTexture??null,T=i.gammaSpace??T,m=i.forcedExtension??m):b=!!i,this._gammaSpace=T,this._noMipmap=b,this._invertY=void 0===r?!_.rX:r,this._initialSamplingMode=n,this._buffer=l,this._deleteBuffer=u,this._mimeType=d,this._loaderOptions=p,this._creationFlags=f,this._useSRGBBuffer=y,this._forcedExtension=m,void 0!==c&&(this._format=c);const v=this.getScene(),A=this._getEngine();if(!A)return;A.onBeforeTextureInitObservable.notifyObservers(this);const S=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),a&&a(),!this.isBlocking&&v&&v.resetCachedMaterial()},E=(e,t)=>{this._loadingError=!0,this._errorObject={message:e,exception:t},o&&o(e,t),g.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!x){this._delayedOnLoad=S,this._delayedOnError=E;return}if(this._texture=x??this._getFromCache(this.url,b,n,this._invertY,y,this.isCube),this._texture)if(this._texture.isReady)h._.SetImmediate(()=>S());else{const e=this._texture.onLoadedObservable.add(S);this._texture.onErrorObservable.add(t=>{E(t.message,t.exception),this._texture?.onLoadedObservable.remove(e)})}else if(v&&v.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=S,this._delayedOnError=E;else{try{this._texture=A.createTexture(this.url,b,this._invertY,v,n,S,E,this._buffer,void 0,this._format,this._forcedExtension,d,p,f,y)}catch(e){throw E("error loading",e),e}u&&(this._buffer=null)}}updateURL(e,t=null,i,r){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,e=>e.hasTexture(this))),(!this.name||this.name.startsWith("data:"))&&(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=r,this.delayLoadState=4;let n=this._delayedOnLoad,s=()=>{n?n():this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),i&&i()};this._delayedOnLoad=s,this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;let e=this.getScene();if(!e)return;let t=this.url;!t&&(this.name.indexOf("://")>0||this.name.startsWith("data:"))&&(t=this.name),this.delayLoadState=1,this._texture=this._getFromCache(t,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?h._.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(t,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null}_prepareRowForTextureGeneration(e,t,i,r){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,a.Pq.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,r),r.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,r.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,r.z+=this.wRotationCenter}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=a.uq.Zero(),this._rowGenerationMatrix=new a.uq,this._t0=a.Pq.Zero(),this._t1=a.Pq.Zero(),this._t2=a.Pq.Zero()),a.uq.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(a.uq.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,a.AA.Matrix["0"]),a.uq.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,a.AA.Matrix["1"]),a.uq.ScalingToRef(this._cachedUScale,this._cachedVScale,0,a.AA.Matrix["2"]),a.uq.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,a.AA.Matrix["3"]),a.AA.Matrix["0"].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.AA.Matrix["1"],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.AA.Matrix["2"],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.AA.Matrix["3"],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),a.uq.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));let t=this.getScene();if(!t)return this._cachedTextureMatrix;let i=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&i!==this._cachedIdentity3x2&&t.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)),this._cachedTextureMatrix}getReflectionTextureMatrix(){let e=this.getScene();if(!e)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==g.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;else if(this._cachedReflectionProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=a.uq.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=a.uq.Zero());let t=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case g.PLANAR_MODE:a.uq.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case g.PROJECTION_MODE:{a.uq.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);let t=e.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=t.updateFlag,t.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:a.uq.IdentityToRef(this._cachedReflectionTextureMatrix)}return t&&e.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)),this._cachedReflectionTextureMatrix}clone(){let e={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return m.p.Clone(()=>new g(this._texture?this._texture.url:null,this.getScene(),e),this)}serialize(){let e=this.name;!g.SerializeBuffers&&this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");let t=super.serialize(g._SerializeInternalTextureUniqueId);if(!t)return null;if(g.SerializeBuffers||g.ForceSerializeBuffers)if("string"==typeof this._buffer&&this._buffer.startsWith("data:"))t.base64String=this._buffer,t.name=t.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){let e=this.mimeType||"image/png";t.base64String=`data:${e};base64,${(0,p.EL)(this._buffer)}`}else(g.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?(0,f.lP)(this):(0,f.nh)(this));return t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,g._SerializeInternalTextureUniqueId&&(t.internalTextureUniqueId=this._texture?.uniqueId),t.internalTextureLabel=this._texture?.label,t.noMipmap=this._noMipmap,this.name=e,t}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(e,t,i){let r;if(e.customType){let r=c.n.Instantiate(e.customType).Parse(e,t,i);return e.samplingMode&&r.updateSamplingMode&&r._samplingMode&&r._samplingMode!==e.samplingMode&&r.updateSamplingMode(e.samplingMode),r}if(e.isCube&&!e.isRenderTarget)return g._CubeTextureParser(e,t,i);let n=void 0!==e.internalTextureUniqueId;if(!e.name&&!e.isRenderTarget&&!n)return null;if(n){for(let i of t.getEngine().getLoadedTexturesCache())if(i.uniqueId===e.internalTextureUniqueId){r=i;break}}let s=t=>{if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),e.samplingMode){let i=e.samplingMode;t&&t.samplingMode!==i&&t.updateSamplingMode(i)}if(t&&e.animations)for(let i=0;i<e.animations.length;i++){let r=e.animations[i],n=(0,l.n9)("BABYLON.Animation");n&&t.animations.push(n.Parse(r))}t&&t._texture&&(n&&!r&&t._texture._setUniqueId(e.internalTextureUniqueId),t._texture.label=e.internalTextureLabel)};return m.p.Parse(()=>{let n=!0;if(e.noMipmap&&(n=!1),e.mirrorPlane){let i=g._CreateMirror(e.name,e.renderTargetSize,t,n);return i._waitingRenderList=e.renderList,i.mirrorPlane=d.Z.FromArray(e.mirrorPlane),s(i),i}if(e.isRenderTarget&&!e.base64String){let i=null;if(e.isCube){if(t.reflectionProbes)for(let i=0;i<t.reflectionProbes.length;i++){let r=t.reflectionProbes[i];if(r.name===e.name)return r.cubeTexture}}else(i=g._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,n,e._creationFlags??0))._waitingRenderList=e.renderList;return s(i),i}if(e.isVideo){let r=g._CreateVideoTexture(i+(e.url||e.name),i+(e.src||e.url),t,n,e.invertY,e.samplingMode,e.settings||{});return s(r),r}{let a;if(e.base64String&&!r)(a=g.CreateFromBase64String(e.base64String,e.base64String,t,!n,e.invertY,e.samplingMode,()=>{s(a)},e._creationFlags??0,e._useSRGBBuffer??!1)).name=e.name;else{let o;o=e.name&&(e.name.indexOf("://")>0||e.name.startsWith("data:"))?e.name:i+e.name,e.url&&(e.url.startsWith("data:")||g.UseSerializedUrlIfAny)&&(o=e.url),a=new g(o,t,{noMipmap:!n,invertY:e.invertY,samplingMode:e.samplingMode,onLoad:()=>{s(a)},internalTexture:r})}return a}},e,t)}static CreateFromBase64String(e,t,i,r,n,s=g.TRILINEAR_SAMPLINGMODE,a=null,o=null,l=5,u,h){return new g("data:"+t,i,r,n,s,a,o,e,!1,l,void 0,void 0,u,h)}static LoadFromDataString(e,t,i,r=!1,n,s=!0,a=g.TRILINEAR_SAMPLINGMODE,o=null,l=null,u=5,h,c){return"data:"!==e.substring(0,5)&&(e="data:"+e),new g(e,i,n,s,a,o,l,t,r,u,void 0,void 0,h,c)}}g.SerializeBuffers=!0,g.ForceSerializeBuffers=!1,g.OnTextureLoadErrorObservable=new s.cP,g._SerializeInternalTextureUniqueId=!1,g._CubeTextureParser=(e,t,i)=>{throw(0,u.n)("CubeTexture")},g._CreateMirror=(e,t,i,r)=>{throw(0,u.n)("MirrorTexture")},g._CreateRenderTargetTexture=(e,t,i,r,n)=>{throw(0,u.n)("RenderTargetTexture")},g.NEAREST_SAMPLINGMODE=1,g.NEAREST_NEAREST_MIPLINEAR=8,g.BILINEAR_SAMPLINGMODE=2,g.LINEAR_LINEAR_MIPNEAREST=11,g.TRILINEAR_SAMPLINGMODE=3,g.LINEAR_LINEAR_MIPLINEAR=3,g.NEAREST_NEAREST_MIPNEAREST=4,g.NEAREST_LINEAR_MIPNEAREST=5,g.NEAREST_LINEAR_MIPLINEAR=6,g.NEAREST_LINEAR=7,g.NEAREST_NEAREST=1,g.LINEAR_NEAREST_MIPNEAREST=9,g.LINEAR_NEAREST_MIPLINEAR=10,g.LINEAR_LINEAR=2,g.LINEAR_NEAREST=12,g.EXPLICIT_MODE=0,g.SPHERICAL_MODE=1,g.PLANAR_MODE=2,g.CUBIC_MODE=3,g.PROJECTION_MODE=4,g.SKYBOX_MODE=5,g.INVCUBIC_MODE=6,g.EQUIRECTANGULAR_MODE=7,g.FIXED_EQUIRECTANGULAR_MODE=8,g.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,g.CLAMP_ADDRESSMODE=0,g.WRAP_ADDRESSMODE=1,g.MIRROR_ADDRESSMODE=2,g.UseSerializedUrlIfAny=!1,(0,r.Cg)([(0,n.lK)()],g.prototype,"url",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"uOffset",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"vOffset",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"uScale",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"vScale",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"uAng",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"vAng",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"wAng",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"uRotationCenter",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"vRotationCenter",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"wRotationCenter",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"homogeneousRotationInUVTransform",void 0),(0,r.Cg)([(0,n.lK)()],g.prototype,"isBlocking",null),(0,l.Y5)("BABYLON.Texture",g),m.p._TextureParser=g.Parse},69900(e,t,i){i.d(t,{B:()=>r});function r(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}},82628(e,t,i){i.d(t,{W:()=>n,l:()=>s});var r=i(97167);function n(e){return class extends e{constructor(){super(...arguments),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1}}}class s extends r.M{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}},82677(e,t,i){i.d(t,{C:()=>s,_:()=>n});var r=i(69900);function n(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),(t.VIGNETTE||t.DITHER)&&e.push("vInverseScreenSize"),t.VIGNETTE&&(e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&(0,r.B)(e),t.DITHER&&e.push("ditherIntensity")}function s(e,t){t.COLORGRADING&&e.push("txColorTransform")}},98932(e,t,i){i.d(t,{J:()=>r});class r{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(e){}bindForSubMesh(e,t,i,r,n){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&(-1!==t.prePassRenderer.getIndex(2)||-1!==t.prePassRenderer.getIndex(11))){this.previousWorldMatrices[i.uniqueId]||(this.previousWorldMatrices[i.uniqueId]=r.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());let n=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=n.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==n.frameId&&(this._lastUpdateFrameId=n.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[i.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[i.uniqueId]=r.clone()}}}},35666(e,t,i){i.d(t,{F:()=>M,f:()=>R});var r=i(39545),n=i(61646),s=i(44394),a=i(9633),o=i(19002),l=i(95435),u=i(98932),h=i(82628),c=i(60766),d=i(21383),p=i(97167),f=i(63751),_=i(27371),m=i(54256),g=i(47144),b=i(27896),y=i(70817),x=i(35052),T=i(57176),v=i(49697),A=i(89451),S=i(69874);let E={effect:null,subMesh:null};class I extends(0,A.F)(p.M){}class R extends(0,h.W)(I){constructor(e){super(e),this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.USE_VERTEX_PULLING=!1,this.RIGHT_HANDED=!1,this.CLUSTLIGHT_SLICES=0,this.CLUSTLIGHT_BATCH=0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}}class P extends(0,S.O)(f.E){}class M extends P{get isPrePassCapable(){return!this.disableDepthWrite}get canRenderToMRT(){return!0}constructor(e,t,i=!1){super(e,t,void 0,i||M.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new o.v9(0,0,0),this.diffuseColor=new o.v9(1,1,1),this.specularColor=new o.v9(1,1,1),this.emissiveColor=new o.v9(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new s.L(16),this._globalAmbientColor=new o.v9(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new b.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new u.J,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),M.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),M.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!M.ReflectionTextureEnabled&&!!this._reflectionTexture&&!!this._reflectionTexture.isRenderTarget||!!M.RefractionTextureEnabled&&!!this._refractionTexture&&!!this._refractionTexture.isRenderTarget||this._cacheHasRenderTargetTextures}getClassName(){return"StandardMaterial"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===d.i.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==d.i.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(e,t,r=!1){this._uniformBufferLayoutBuilt||this.buildUniformLayout();let n=t._drawWrapper;if(n.effect&&this.isFrozen&&n._wasPreviouslyReady&&n._wasPreviouslyUsingInstances===r)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new R(this._eventInfo.defineNames));let s=this.getScene(),a=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;let o=s.getEngine();a._needNormals=(0,x.az)(s,e,a,!0,this._maxSimultaneousLights,this._disableLighting),(0,x.VO)(s,a);let h=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if((0,x.N4)(s,a,this.canRenderToMRT&&!h),(0,x.Nc)(s,a,h),v.m.PrepareDefines(o.currentRenderPassId,e,a),a._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,a._needUVs=!1;for(let e=1;e<=6;++e)a["MAINUV"+e]=!1;if(s.texturesEnabled){if(a.DIFFUSEDIRECTUV=0,a.BUMPDIRECTUV=0,a.AMBIENTDIRECTUV=0,a.OPACITYDIRECTUV=0,a.EMISSIVEDIRECTUV=0,a.SPECULARDIRECTUV=0,a.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&M.DiffuseTextureEnabled)if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;else(0,x.YT)(this._diffuseTexture,a,"DIFFUSE");else a.DIFFUSE=!1;if(this._ambientTexture&&M.AmbientTextureEnabled)if(!this._ambientTexture.isReadyOrNotBlocking())return!1;else(0,x.YT)(this._ambientTexture,a,"AMBIENT");else a.AMBIENT=!1;if(this._opacityTexture&&M.OpacityTextureEnabled)if(!this._opacityTexture.isReadyOrNotBlocking())return!1;else(0,x.YT)(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB;else a.OPACITY=!1;if(this._reflectionTexture&&M.ReflectionTextureEnabled?(a.ROUGHNESS=this._roughness>0,a.REFLECTIONOVERALPHA=this._useReflectionOverAlpha):(a.ROUGHNESS=!1,a.REFLECTIONOVERALPHA=!1),!(0,x.kz)(s,this._reflectionTexture,a))return!1;if(this._emissiveTexture&&M.EmissiveTextureEnabled)if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;else(0,x.YT)(this._emissiveTexture,a,"EMISSIVE");else a.EMISSIVE=!1;if(this._lightmapTexture&&M.LightmapTextureEnabled)if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;else(0,x.YT)(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,a.RGBDLIGHTMAP=this._lightmapTexture.isRGBD;else a.LIGHTMAP=!1;if(this._specularTexture&&M.SpecularTextureEnabled)if(!this._specularTexture.isReadyOrNotBlocking())return!1;else(0,x.YT)(this._specularTexture,a,"SPECULAR"),a.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha;else a.SPECULAR=!1;if(s.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&M.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,x.YT)(this._bumpTexture,a,"BUMP"),a.PARALLAX=this._useParallax,a.PARALLAX_RHS=s.useRightHandedSystem,a.PARALLAXOCCLUSION=this._useParallaxOcclusion,a.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else a.BUMP=!1,a.PARALLAX=!1,a.PARALLAX_RHS=!1,a.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&M.RefractionTextureEnabled)if(!this._refractionTexture.isReadyOrNotBlocking())return!1;else a._needUVs=!0,a.REFRACTION=!0,a.REFRACTIONMAP_3D=this._refractionTexture.isCube,a.RGBDREFRACTION=this._refractionTexture.isRGBD,a.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize;else a.REFRACTION=!1;a.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else a.DIFFUSE=!1,a.AMBIENT=!1,a.OPACITY=!1,a.REFLECTION=!1,a.EMISSIVE=!1,a.LIGHTMAP=!1,a.BUMP=!1,a.REFRACTION=!1;a.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),a.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,a.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,a.SPECULAROVERALPHA=this._useSpecularOverAlpha,a.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,a.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,a.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(e)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=a,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(a._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a),a.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,a.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(a._areFresnelDirty&&(M.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(a.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,a.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,a.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,a.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,a.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,a.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,a._needNormals=!0,a.FRESNEL=!0):a.FRESNEL=!1),a.AREALIGHTUSED||a.CLUSTLIGHT_BATCH){for(let t=0;t<e.lightSources.length;t++)if(!e.lightSources[t]._isReady())return!1}(0,x.fm)(e,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),a,this._applyDecalMapAfterDetailMap,this._useVertexPulling,t.getRenderingMesh(),this._isVertexOutputInvariant),(0,x.OR)(s,o,this,a,r,null,t.getRenderingMesh().hasThinInstances),this._eventInfo.defines=a,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,x.qB)(e,a,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let d=!1;if(a.isDirty){let r=a._areLightsDisposed;a.markAsProcessed();let n=new g.J;a.REFLECTION&&n.addFallback(0,"REFLECTION"),a.SPECULAR&&n.addFallback(0,"SPECULAR"),a.BUMP&&n.addFallback(0,"BUMP"),a.PARALLAX&&n.addFallback(1,"PARALLAX"),a.PARALLAX_RHS&&n.addFallback(1,"PARALLAX_RHS"),a.PARALLAXOCCLUSION&&n.addFallback(0,"PARALLAXOCCLUSION"),a.SPECULAROVERALPHA&&n.addFallback(0,"SPECULAROVERALPHA"),a.FOG&&n.addFallback(1,"FOG"),a.POINTSIZE&&n.addFallback(0,"POINTSIZE"),a.LOGARITHMICDEPTH&&n.addFallback(0,"LOGARITHMICDEPTH"),(0,x.c4)(a,n,this._maxSimultaneousLights),a.SPECULARTERM&&n.addFallback(0,"SPECULARTERM"),a.DIFFUSEFRESNEL&&n.addFallback(1,"DIFFUSEFRESNEL"),a.OPACITYFRESNEL&&n.addFallback(2,"OPACITYFRESNEL"),a.REFLECTIONFRESNEL&&n.addFallback(3,"REFLECTIONFRESNEL"),a.EMISSIVEFRESNEL&&n.addFallback(4,"EMISSIVEFRESNEL"),a.FRESNEL&&n.addFallback(4,"FRESNEL"),a.MULTIVIEW&&n.addFallback(0,"MULTIVIEW");let h=[l.R.PositionKind];a.NORMAL&&h.push(l.R.NormalKind),a.TANGENT&&h.push(l.R.TangentKind);for(let e=1;e<=6;++e)a["UV"+e]&&h.push(`uv${1===e?"":e}`);a.VERTEXCOLOR&&h.push(l.R.ColorKind),(0,x.ni)(h,e,a,n),(0,x.ER)(h,a),(0,x.IF)(h,e,a),(0,x.J2)(h,e,a);let p="default",f=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],_=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"];(0,x.B1)(f,_,!1);let m=["Material","Scene","Mesh"],b={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=n,this._eventInfo.fallbackRank=0,this._eventInfo.defines=a,this._eventInfo.uniforms=f,this._eventInfo.attributes=h,this._eventInfo.samplers=_,this._eventInfo.uniformBuffersNames=m,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=b,this._callbackPluginEventGeneric(128,this._eventInfo),v.m.AddUniformsAndSamplers(f,_),u.J.AddUniforms(f),u.J.AddSamplers(_),c.p&&(c.p.PrepareUniforms(f,a),c.p.PrepareSamplers(_,a)),(0,x.Bb)({uniformsNames:f,uniformBuffersNames:m,samplers:_,defines:a,maxSimultaneousLights:this._maxSimultaneousLights}),(0,y.Ll)(f);let T={};this.customShaderNameResolve&&(p=this.customShaderNameResolve(p,f,m,_,a,h,T));let A=a.toString(),S=t.effect,I=s.getEngine().createEffect(p,{attributes:h,uniformsNames:f,uniformBuffersNames:m,samplers:_,defines:A,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:b,processFinalCode:T.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:a.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([i.e("5026").then(i.bind(i,72457)),Promise.all([i.e("8997"),i.e("1101"),i.e("4765"),i.e("170")]).then(i.bind(i,10300))]):await Promise.all([i.e("1909").then(i.bind(i,54532)),Promise.all([i.e("9574"),i.e("7402"),i.e("9738"),i.e("1048")]).then(i.bind(i,59985))]),this._shadersLoaded=!0}},o);if(this._eventInfo.customCode=void 0,I)if(this._onEffectCreatedObservable&&(E.effect=I,E.subMesh=t,this._onEffectCreatedObservable.notifyObservers(E)),this.allowShaderHotSwapping&&S&&!I.isReady()){if(I=S,a.markAsUnprocessed(),d=this.isFrozen,r)return a._areLightsDisposed=!0,!1}else s.resetCachedMaterial(),t.setEffect(I,a,this._materialContext)}return!!t.effect&&!!t.effect.isReady()&&(a._renderId=s.getRenderId(),n._wasPreviouslyReady=!d,n._wasPreviouslyUsingInstances=r,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){let e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),e.addUniform("cameraInfo",4),(0,x.G$)(e,!1,!0),super.buildUniformLayout()}bindForSubMesh(e,t,i){let r=this.getScene(),n=i.materialDefines;if(!n)return;let s=i.effect;if(!s)return;this._activeEffect=s,t.getMeshUniformBuffer().bindToEffect(s,"Mesh"),t.transferToEffect(e),this._uniformBuffer.bindToEffect(s,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,r,t,e,this.isFrozen),v.m.Bind(r.getEngine().currentRenderPassId,this._activeEffect,t,e,this);let l=r.activeCamera;l?this._uniformBuffer.updateFloat4("cameraInfo",l.minZ,l.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),n.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));let u=this._mustRebind(r,s,i,t.visibility);(0,x.f$)(t,s);let h=this._uniformBuffer;if(u){if(this.bindViewProjection(s),!h.useUbo||!this.isFrozen||!h.isSync||i._drawWrapper._forceRebindOnNextCall){if(M.FresnelEnabled&&n.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(h.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),h.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&h.updateColor4("opacityParts",new o.v9(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(h.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),h.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(h.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),h.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(h.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),h.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),r.texturesEnabled&&(this._diffuseTexture&&M.DiffuseTextureEnabled&&(h.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,x.mA)(this._diffuseTexture,h,"diffuse")),this._ambientTexture&&M.AmbientTextureEnabled&&(h.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,x.mA)(this._ambientTexture,h,"ambient")),this._opacityTexture&&M.OpacityTextureEnabled&&(h.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,x.mA)(this._opacityTexture,h,"opacity")),this._hasAlphaChannel()&&h.updateFloat("alphaCutOff",this.alphaCutOff),(0,x.X8)(r,n,h,o.v9.White(),this._reflectionTexture,!1,!1,!0,!1,!1,!1,this.roughness),this._reflectionTexture&&M.ReflectionTextureEnabled||h.updateFloat2("vReflectionInfos",0,this.roughness),this._emissiveTexture&&M.EmissiveTextureEnabled&&(h.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,x.mA)(this._emissiveTexture,h,"emissive")),this._lightmapTexture&&M.LightmapTextureEnabled&&(h.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,x.mA)(this._lightmapTexture,h,"lightmap")),this._specularTexture&&M.SpecularTextureEnabled&&(h.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,x.mA)(this._specularTexture,h,"specular")),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&M.BumpTextureEnabled&&(h.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,x.mA)(this._bumpTexture,h,"bump"),r._mirroredCameraPosition?h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&M.RefractionTextureEnabled)){let e=1;if(!this._refractionTexture.isCube&&(h.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(e=this._refractionTexture.depth)),h.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,e,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){let e=this._refractionTexture;h.updateVector3("vRefractionPosition",e.boundingBoxPosition),h.updateVector3("vRefractionSize",e.boundingBoxSize)}}this.pointsCloud&&h.updateFloat("pointSize",this.pointSize),h.updateColor4("vSpecularColor",this.specularColor,this.specularPower),h.updateColor3("vEmissiveColor",M.EmissiveTextureEnabled?this.emissiveColor:o.v9.BlackReadOnly),h.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),r.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),h.updateColor3("vAmbientColor",this._globalAmbientColor)}r.texturesEnabled&&(this._diffuseTexture&&M.DiffuseTextureEnabled&&s.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&M.AmbientTextureEnabled&&s.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&M.OpacityTextureEnabled&&s.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&M.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?s.setTexture("reflectionCubeSampler",this._reflectionTexture):s.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&M.EmissiveTextureEnabled&&s.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&M.LightmapTextureEnabled&&s.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&M.SpecularTextureEnabled&&s.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&M.BumpTextureEnabled&&s.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&M.RefractionTextureEnabled&&(this._refractionTexture.isCube?s.setTexture("refractionCubeSampler",this._refractionTexture):s.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(s),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,y.ij)(s,this,r),this.bindEyePosition(s)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);(u||!this.isFrozen)&&(r.lightsEnabled&&!this._disableLighting&&(0,x.RL)(r,t,s,n,this._maxSimultaneousLights),(r.fogEnabled&&t.applyFog&&r.fogMode!==a.Z.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||t.receiveShadows||n.PREPASS||n.CLUSTLIGHT_BATCH)&&this.bindView(s),(0,x.Yy)(r,t,s),n.NUM_MORPH_INFLUENCERS&&(0,x.nR)(t,s),n.BAKED_VERTEX_ANIMATION_TEXTURE&&t.bakedVertexAnimationManager?.bind(s,n.INSTANCES),this.useLogarithmicDepth&&(0,x.DL)(n,s,r),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect,i),h.update()}getAnimatables(){let e=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}hasTexture(e){return!!super.hasTexture(e)||this._diffuseTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._specularTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this._refractionTexture===e||!1}dispose(e,t){t&&(this._diffuseTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._specularTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._refractionTexture?.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}clone(e,t=!0,i=""){let r=T.p.Clone(()=>new M(e,this.getScene()),this,{cloneTexturesOnlyOnce:t});return r.name=e,r.id=e,this.stencil.copyTo(r.stencil),this._clonePlugins(r,i),r}static Parse(e,t,i){let r=T.p.Parse(()=>new M(e.name,t),e,t,i);return e.stencil&&r.stencil.parse(e.stencil,t,i),d.i._ParsePlugins(e,r,t,i),r}static get DiffuseTextureEnabled(){return m.h.DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){m.h.DiffuseTextureEnabled=e}static get DetailTextureEnabled(){return m.h.DetailTextureEnabled}static set DetailTextureEnabled(e){m.h.DetailTextureEnabled=e}static get AmbientTextureEnabled(){return m.h.AmbientTextureEnabled}static set AmbientTextureEnabled(e){m.h.AmbientTextureEnabled=e}static get OpacityTextureEnabled(){return m.h.OpacityTextureEnabled}static set OpacityTextureEnabled(e){m.h.OpacityTextureEnabled=e}static get ReflectionTextureEnabled(){return m.h.ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){m.h.ReflectionTextureEnabled=e}static get EmissiveTextureEnabled(){return m.h.EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){m.h.EmissiveTextureEnabled=e}static get SpecularTextureEnabled(){return m.h.SpecularTextureEnabled}static set SpecularTextureEnabled(e){m.h.SpecularTextureEnabled=e}static get BumpTextureEnabled(){return m.h.BumpTextureEnabled}static set BumpTextureEnabled(e){m.h.BumpTextureEnabled=e}static get LightmapTextureEnabled(){return m.h.LightmapTextureEnabled}static set LightmapTextureEnabled(e){m.h.LightmapTextureEnabled=e}static get RefractionTextureEnabled(){return m.h.RefractionTextureEnabled}static set RefractionTextureEnabled(e){m.h.RefractionTextureEnabled=e}static get ColorGradingTextureEnabled(){return m.h.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){m.h.ColorGradingTextureEnabled=e}static get FresnelEnabled(){return m.h.FresnelEnabled}static set FresnelEnabled(e){m.h.FresnelEnabled=e}}M.ForceGLSL=!1,(0,r.Cg)([(0,n.uM)("diffuseTexture")],M.prototype,"_diffuseTexture",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"diffuseTexture",void 0),(0,r.Cg)([(0,n.uM)("ambientTexture")],M.prototype,"_ambientTexture",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientTexture",void 0),(0,r.Cg)([(0,n.uM)("opacityTexture")],M.prototype,"_opacityTexture",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"opacityTexture",void 0),(0,r.Cg)([(0,n.uM)("reflectionTexture")],M.prototype,"_reflectionTexture",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectionTexture",void 0),(0,r.Cg)([(0,n.uM)("emissiveTexture")],M.prototype,"_emissiveTexture",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"emissiveTexture",void 0),(0,r.Cg)([(0,n.uM)("specularTexture")],M.prototype,"_specularTexture",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"specularTexture",void 0),(0,r.Cg)([(0,n.uM)("bumpTexture")],M.prototype,"_bumpTexture",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"bumpTexture",void 0),(0,r.Cg)([(0,n.uM)("lightmapTexture")],M.prototype,"_lightmapTexture",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"lightmapTexture",void 0),(0,r.Cg)([(0,n.uM)("refractionTexture")],M.prototype,"_refractionTexture",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionTexture",void 0),(0,r.Cg)([(0,n.jT)("ambient")],M.prototype,"ambientColor",void 0),(0,r.Cg)([(0,n.jT)("diffuse")],M.prototype,"diffuseColor",void 0),(0,r.Cg)([(0,n.jT)("specular")],M.prototype,"specularColor",void 0),(0,r.Cg)([(0,n.jT)("emissive")],M.prototype,"emissiveColor",void 0),(0,r.Cg)([(0,n.lK)()],M.prototype,"specularPower",void 0),(0,r.Cg)([(0,n.lK)("useAlphaFromDiffuseTexture")],M.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"useAlphaFromDiffuseTexture",void 0),(0,r.Cg)([(0,n.lK)("useEmissiveAsIllumination")],M.prototype,"_useEmissiveAsIllumination",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useEmissiveAsIllumination",void 0),(0,r.Cg)([(0,n.lK)("linkEmissiveWithDiffuse")],M.prototype,"_linkEmissiveWithDiffuse",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"linkEmissiveWithDiffuse",void 0),(0,r.Cg)([(0,n.lK)("useSpecularOverAlpha")],M.prototype,"_useSpecularOverAlpha",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useSpecularOverAlpha",void 0),(0,r.Cg)([(0,n.lK)("useReflectionOverAlpha")],M.prototype,"_useReflectionOverAlpha",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useReflectionOverAlpha",void 0),(0,r.Cg)([(0,n.lK)("disableLighting")],M.prototype,"_disableLighting",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsLightsDirty")],M.prototype,"disableLighting",void 0),(0,r.Cg)([(0,n.lK)("useObjectSpaceNormalMap")],M.prototype,"_useObjectSpaceNormalMap",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useObjectSpaceNormalMap",void 0),(0,r.Cg)([(0,n.lK)("useParallax")],M.prototype,"_useParallax",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useParallax",void 0),(0,r.Cg)([(0,n.lK)("useParallaxOcclusion")],M.prototype,"_useParallaxOcclusion",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useParallaxOcclusion",void 0),(0,r.Cg)([(0,n.lK)()],M.prototype,"parallaxScaleBias",void 0),(0,r.Cg)([(0,n.lK)("roughness")],M.prototype,"_roughness",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"roughness",void 0),(0,r.Cg)([(0,n.lK)()],M.prototype,"indexOfRefraction",void 0),(0,r.Cg)([(0,n.lK)()],M.prototype,"invertRefractionY",void 0),(0,r.Cg)([(0,n.lK)()],M.prototype,"alphaCutOff",void 0),(0,r.Cg)([(0,n.lK)("useLightmapAsShadowmap")],M.prototype,"_useLightmapAsShadowmap",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useLightmapAsShadowmap",void 0),(0,r.Cg)([(0,n.Y9)("diffuseFresnelParameters")],M.prototype,"_diffuseFresnelParameters",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"diffuseFresnelParameters",void 0),(0,r.Cg)([(0,n.Y9)("opacityFresnelParameters")],M.prototype,"_opacityFresnelParameters",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelAndMiscDirty")],M.prototype,"opacityFresnelParameters",void 0),(0,r.Cg)([(0,n.Y9)("reflectionFresnelParameters")],M.prototype,"_reflectionFresnelParameters",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"reflectionFresnelParameters",void 0),(0,r.Cg)([(0,n.Y9)("refractionFresnelParameters")],M.prototype,"_refractionFresnelParameters",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"refractionFresnelParameters",void 0),(0,r.Cg)([(0,n.Y9)("emissiveFresnelParameters")],M.prototype,"_emissiveFresnelParameters",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"emissiveFresnelParameters",void 0),(0,r.Cg)([(0,n.lK)("useReflectionFresnelFromSpecular")],M.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"useReflectionFresnelFromSpecular",void 0),(0,r.Cg)([(0,n.lK)("useGlossinessFromSpecularMapAlpha")],M.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,r.Cg)([(0,n.lK)("maxSimultaneousLights")],M.prototype,"_maxSimultaneousLights",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsLightsDirty")],M.prototype,"maxSimultaneousLights",void 0),(0,r.Cg)([(0,n.lK)("invertNormalMapX")],M.prototype,"_invertNormalMapX",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertNormalMapX",void 0),(0,r.Cg)([(0,n.lK)("invertNormalMapY")],M.prototype,"_invertNormalMapY",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertNormalMapY",void 0),(0,r.Cg)([(0,n.lK)("twoSidedLighting")],M.prototype,"_twoSidedLighting",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"twoSidedLighting",void 0),(0,r.Cg)([(0,n.lK)("applyDecalMapAfterDetailMap")],M.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,r.Cg)([(0,n.$z)("_markAllSubMeshesAsMiscDirty")],M.prototype,"applyDecalMapAfterDetailMap",void 0),(0,_.Y5)("BABYLON.StandardMaterial",M),a.Z.DefaultMaterialFactory=e=>new M("default material",e)},19002(e,t,i){i.d(t,{IG:()=>p,ov:()=>d,v9:()=>c});var r=i(70728),n=i(27371),s=i(26108),a=i(39058);function o(e){return Math.pow(e,s.tk)}function l(e){return e<=.04045?.0773993808*e:Math.pow(.947867299*(e+.055),2.4)}function u(e){return Math.pow(e,s.rv)}function h(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class c{constructor(e=0,t=0,i=0){this.r=e,this.g=t,this.b=i}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let e=255*this.r|0;return 397*(e=397*e^255*this.g)^255*this.b}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}fromArray(e,t=0){return c.FromArrayToRef(e,t,this),this}toColor4(e=1){return new d(this.r,this.g,this.b,e)}asArray(){return[this.r,this.g,this.b]}toLuminance(){return .3*this.r+.59*this.g+.11*this.b}multiply(e){return new c(this.r*e.r,this.g*e.g,this.b*e.b)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyByFloats(e,t,i){return new c(this.r*e,this.g*t,this.b*i)}divide(e){throw ReferenceError("Can not divide a color")}divideToRef(e,t){throw ReferenceError("Can not divide a color")}divideInPlace(e){throw ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.r,e.g,e.b)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.r,e.g,e.b)}minimizeInPlaceFromFloats(e,t,i){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this}maximizeInPlaceFromFloats(e,t,i){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this}floorToRef(e){throw ReferenceError("Can not floor a color")}floor(){throw ReferenceError("Can not floor a color")}fractToRef(e){throw ReferenceError("Can not fract a color")}fract(){throw ReferenceError("Can not fract a color")}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}equalsFloats(e,t,i){return this.equalsToFloats(e,t,i)}equalsToFloats(e,t,i){return this.r===e&&this.g===t&&this.b===i}equalsWithEpsilon(e,t=s.bH){return(0,a.WithinEpsilon)(this.r,e.r,t)&&(0,a.WithinEpsilon)(this.g,e.g,t)&&(0,a.WithinEpsilon)(this.b,e.b,t)}negate(){throw ReferenceError("Can not negate a color")}negateInPlace(){throw ReferenceError("Can not negate a color")}negateToRef(e){throw ReferenceError("Can not negate a color")}scale(e){return new c(this.r*e,this.g*e,this.b*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t}clampToRef(e=0,t=1,i){return i.r=(0,a.Clamp)(this.r,e,t),i.g=(0,a.Clamp)(this.g,e,t),i.b=(0,a.Clamp)(this.b,e,t),i}add(e){return new c(this.r+e.r,this.g+e.g,this.b+e.b)}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addInPlaceFromFloats(e,t,i){return this.r+=e,this.g+=t,this.b+=i,this}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t}subtract(e){return new c(this.r-e.r,this.g-e.g,this.b-e.b)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this}subtractFromFloats(e,t,i){return new c(this.r-e,this.g-t,this.b-i)}subtractFromFloatsToRef(e,t,i,r){return r.r=this.r-e,r.g=this.g-t,r.b=this.b-i,r}clone(){return new c(this.r,this.g,this.b)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyFromFloats(e,t,i){return this.r=e,this.g=t,this.b=i,this}set(e,t,i){return this.copyFromFloats(e,t,i)}setAll(e){return this.r=this.g=this.b=e,this}toHexString(){let e=Math.round(255*this.r),t=Math.round(255*this.g),i=Math.round(255*this.b);return"#"+(0,a.ToHex)(e)+(0,a.ToHex)(t)+(0,a.ToHex)(i)}fromHexString(e){return"#"!==e.substring(0,1)||7!==e.length||(this.r=parseInt(e.substring(1,3),16)/255,this.g=parseInt(e.substring(3,5),16)/255,this.b=parseInt(e.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new c)}toHSVToRef(e){let t=this.r,i=this.g,r=this.b,n=Math.max(t,i,r),s=Math.min(t,i,r),a=0,o=0,l=n-s;return 0!==n&&(o=l/n),n!=s&&(n==t?(a=(i-r)/l,i<r&&(a+=6)):n==i?a=(r-t)/l+2:n==r&&(a=(t-i)/l+4),a*=60),e.r=a,e.g=o,e.b=n,e}toLinearSpace(e=!1){let t=new c;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e,t=!1){return t?(e.r=l(this.r),e.g=l(this.g),e.b=l(this.b)):(e.r=o(this.r),e.g=o(this.g),e.b=o(this.b)),this}toGammaSpace(e=!1){let t=new c;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e,t=!1){return t?(e.r=h(this.r),e.g=h(this.g),e.b=h(this.b)):(e.r=u(this.r),e.g=u(this.g),e.b=u(this.b)),this}static HSVtoRGBToRef(e,t,i,r){let n=i*t,s=e/60,a=n*(1-Math.abs(s%2-1)),o=0,l=0,u=0;s>=0&&s<=1?(o=n,l=a):s>=1&&s<=2?(o=a,l=n):s>=2&&s<=3?(l=n,u=a):s>=3&&s<=4?(l=a,u=n):s>=4&&s<=5?(o=a,u=n):s>=5&&s<=6&&(o=n,u=a);let h=i-n;return r.r=o+h,r.g=l+h,r.b=u+h,r}static FromHSV(e,t,i){let r=new c(0,0,0);return c.HSVtoRGBToRef(e,t,i,r),r}static FromHexString(e){return new c(0,0,0).fromHexString(e)}static FromArray(e,t=0){return new c(e[t],e[t+1],e[t+2])}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2]}static FromInts(e,t,i){return new c(e/255,t/255,i/255)}static Lerp(e,t,i){let r=new c(0,0,0);return c.LerpToRef(e,t,i,r),r}static LerpToRef(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i}static Hermite(e,t,i,r,n){let s=n*n,a=n*s,o=2*a-3*s+1,l=-2*a+3*s,u=a-2*s+n,h=a-s;return new c(e.r*o+i.r*l+t.r*u+r.r*h,e.g*o+i.g*l+t.g*u+r.g*h,e.b*o+i.b*l+t.b*u+r.b*h)}static Hermite1stDerivative(e,t,i,r,n){let s=c.Black();return this.Hermite1stDerivativeToRef(e,t,i,r,n,s),s}static Hermite1stDerivativeToRef(e,t,i,r,n,s){let a=n*n;s.r=(a-n)*6*e.r+(3*a-4*n+1)*t.r+(-a+n)*6*i.r+(3*a-2*n)*r.r,s.g=(a-n)*6*e.g+(3*a-4*n+1)*t.g+(-a+n)*6*i.g+(3*a-2*n)*r.g,s.b=(a-n)*6*e.b+(3*a-4*n+1)*t.b+(-a+n)*6*i.b+(3*a-2*n)*r.b}static Red(){return new c(1,0,0)}static Green(){return new c(0,1,0)}static Blue(){return new c(0,0,1)}static Black(){return new c(0,0,0)}static get BlackReadOnly(){return c._BlackReadOnly}static White(){return new c(1,1,1)}static Purple(){return new c(.5,0,.5)}static Magenta(){return new c(1,0,1)}static Yellow(){return new c(1,1,0)}static Gray(){return new c(.5,.5,.5)}static Teal(){return new c(0,1,1)}static Random(){return new c(Math.random(),Math.random(),Math.random())}}c._V8PerformanceHack=new c(.5,.5,.5),c._BlackReadOnly=c.Black(),Object.defineProperties(c.prototype,{dimension:{value:[3]},rank:{value:1}});class d{constructor(e=0,t=0,i=0,r=1){this.r=e,this.g=t,this.b=i,this.a=r}asArray(){return[this.r,this.g,this.b,this.a]}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this.a=e[t+3],this}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}add(e){return new d(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t.a=this.a+e.a,t}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}addInPlaceFromFloats(e,t,i,r){return this.r+=e,this.g+=t,this.b+=i,this.a+=r,this}subtract(e){return new d(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this.a-=e.a,this}subtractFromFloats(e,t,i,r){return new d(this.r-e,this.g-t,this.b-i,this.a-r)}subtractFromFloatsToRef(e,t,i,r,n){return n.r=this.r-e,n.g=this.g-t,n.b=this.b-i,n.a=this.a-r,n}scale(e){return new d(this.r*e,this.g*e,this.b*e,this.a*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,t}clampToRef(e=0,t=1,i){return i.r=(0,a.Clamp)(this.r,e,t),i.g=(0,a.Clamp)(this.g,e,t),i.b=(0,a.Clamp)(this.b,e,t),i.a=(0,a.Clamp)(this.a,e,t),i}multiply(e){return new d(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a,this}multiplyByFloats(e,t,i,r){return new d(this.r*e,this.g*t,this.b*i,this.a*r)}divide(e){throw ReferenceError("Can not divide a color")}divideToRef(e,t){throw ReferenceError("Can not divide a color")}divideInPlace(e){throw ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.r=Math.min(this.r,e.r),this.g=Math.min(this.g,e.g),this.b=Math.min(this.b,e.b),this.a=Math.min(this.a,e.a),this}maximizeInPlace(e){return this.r=Math.max(this.r,e.r),this.g=Math.max(this.g,e.g),this.b=Math.max(this.b,e.b),this.a=Math.max(this.a,e.a),this}minimizeInPlaceFromFloats(e,t,i,r){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this.a=Math.min(r,this.a),this}maximizeInPlaceFromFloats(e,t,i,r){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this.a=Math.max(r,this.a),this}floorToRef(e){throw ReferenceError("Can not floor a color")}floor(){throw ReferenceError("Can not floor a color")}fractToRef(e){throw ReferenceError("Can not fract a color")}fract(){throw ReferenceError("Can not fract a color")}negate(){throw ReferenceError("Can not negate a color")}negateInPlace(){throw ReferenceError("Can not negate a color")}negateToRef(e){throw ReferenceError("Can not negate a color")}equalsWithEpsilon(e,t=s.bH){return(0,a.WithinEpsilon)(this.r,e.r,t)&&(0,a.WithinEpsilon)(this.g,e.g,t)&&(0,a.WithinEpsilon)(this.b,e.b,t)&&(0,a.WithinEpsilon)(this.a,e.a,t)}equalsToFloats(e,t,i,r){return this.r===e&&this.g===t&&this.b===i&&this.a===r}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let e=255*this.r|0;return 397*(e=397*(e=397*e^255*this.g)^255*this.b)^255*this.a}clone(){return new d().copyFrom(this)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}copyFromFloats(e,t,i,r){return this.r=e,this.g=t,this.b=i,this.a=r,this}set(e,t,i,r){return this.copyFromFloats(e,t,i,r)}setAll(e){return this.r=this.g=this.b=this.a=e,this}toHexString(e=!1){let t=Math.round(255*this.r),i=Math.round(255*this.g),r=Math.round(255*this.b);if(e)return"#"+(0,a.ToHex)(t)+(0,a.ToHex)(i)+(0,a.ToHex)(r);let n=Math.round(255*this.a);return"#"+(0,a.ToHex)(t)+(0,a.ToHex)(i)+(0,a.ToHex)(r)+(0,a.ToHex)(n)}fromHexString(e){return"#"!==e.substring(0,1)||9!==e.length&&7!==e.length||(this.r=parseInt(e.substring(1,3),16)/255,this.g=parseInt(e.substring(3,5),16)/255,this.b=parseInt(e.substring(5,7),16)/255,9===e.length&&(this.a=parseInt(e.substring(7,9),16)/255)),this}toLinearSpace(e=!1){let t=new d;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e,t=!1){return t?(e.r=l(this.r),e.g=l(this.g),e.b=l(this.b)):(e.r=o(this.r),e.g=o(this.g),e.b=o(this.b)),e.a=this.a,this}toGammaSpace(e=!1){let t=new d;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e,t=!1){return t?(e.r=h(this.r),e.g=h(this.g),e.b=h(this.b)):(e.r=u(this.r),e.g=u(this.g),e.b=u(this.b)),e.a=this.a,this}static FromHexString(e){return"#"!==e.substring(0,1)||9!==e.length&&7!==e.length?new d(0,0,0,0):new d(0,0,0,1).fromHexString(e)}static Lerp(e,t,i){return d.LerpToRef(e,t,i,new d)}static LerpToRef(e,t,i,r){return r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i,r.a=e.a+(t.a-e.a)*i,r}static Hermite(e,t,i,r,n){let s=n*n,a=n*s,o=2*a-3*s+1,l=-2*a+3*s,u=a-2*s+n,h=a-s;return new d(e.r*o+i.r*l+t.r*u+r.r*h,e.g*o+i.g*l+t.g*u+r.g*h,e.b*o+i.b*l+t.b*u+r.b*h,e.a*o+i.a*l+t.a*u+r.a*h)}static Hermite1stDerivative(e,t,i,r,n){let s=new d;return this.Hermite1stDerivativeToRef(e,t,i,r,n,s),s}static Hermite1stDerivativeToRef(e,t,i,r,n,s){let a=n*n;s.r=(a-n)*6*e.r+(3*a-4*n+1)*t.r+(-a+n)*6*i.r+(3*a-2*n)*r.r,s.g=(a-n)*6*e.g+(3*a-4*n+1)*t.g+(-a+n)*6*i.g+(3*a-2*n)*r.g,s.b=(a-n)*6*e.b+(3*a-4*n+1)*t.b+(-a+n)*6*i.b+(3*a-2*n)*r.b,s.a=(a-n)*6*e.a+(3*a-4*n+1)*t.a+(-a+n)*6*i.a+(3*a-2*n)*r.a}static FromColor3(e,t=1){return new d(e.r,e.g,e.b,t)}static FromArray(e,t=0){return new d(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]}static FromInts(e,t,i,r){return new d(e/255,t/255,i/255,r/255)}static CheckColors4(e,t){if(e.length===3*t){let t=[];for(let i=0;i<e.length;i+=3){let r=i/3*4;t[r]=e[i],t[r+1]=e[i+1],t[r+2]=e[i+2],t[r+3]=1}return t}return e}}d._V8PerformanceHack=new d(.5,.5,.5,.5),Object.defineProperties(d.prototype,{dimension:{value:[4]},rank:{value:1}});class p{}p.Color3=(0,r.mI)(3,c.Black),p.Color4=(0,r.mI)(3,()=>new d(0,0,0,0)),(0,n.Y5)("BABYLON.Color3",c),(0,n.Y5)("BABYLON.Color4",d)},26108(e,t,i){i.d(t,{a6:()=>s,bH:()=>a,rv:()=>r,tk:()=>n});let r=1/2.2,n=2.2,s=(1+Math.sqrt(5))/2,a=.001},20515(e,t,i){i.d(t,{P:()=>n});var r=i(51551);class n{static GetPlanes(e){let t=[];for(let e=0;e<6;e++)t.push(new r.Z(0,0,0,0));return n.GetPlanesToRef(e,t),t}static GetNearPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()}static GetFarPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()}static GetLeftPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()}static GetRightPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()}static GetTopPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()}static GetBottomPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()}static GetPlanesToRef(e,t){n.GetNearPlaneToRef(e,t[0]),n.GetFarPlaneToRef(e,t[1]),n.GetLeftPlaneToRef(e,t[2]),n.GetRightPlaneToRef(e,t[3]),n.GetTopPlaneToRef(e,t[4]),n.GetBottomPlaneToRef(e,t[5])}static IsPointInFrustum(e,t){for(let i=0;i<6;i++)if(0>t[i].dotCoordinate(e))return!1;return!0}}},59022(e,t,i){i.d(t,{Cu:()=>c,Xy:()=>h,jj:()=>p,t4:()=>n,tO:()=>d,uM:()=>u,vr:()=>l});var r,n,s=i(39058),a=i(70134),o=i(26108);(r=n||(n={}))[r.CW=0]="CW",r[r.CCW=1]="CCW";class l{static Interpolate(e,t,i,r,n){if(0===e)return 0;let s=1-3*r+3*t,a=3*r-6*t,o=3*t,l=e;for(let t=0;t<5;t++){let t=l*l,i=t*l*s+a*t+o*l,r=1/(3*s*t+2*a*l+o);l-=(i-e)*r,l=Math.min(1,Math.max(0,l))}return 3*Math.pow(1-l,2)*l*i+3*(1-l)*Math.pow(l,2)*n+Math.pow(l,3)}}class u{constructor(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(e,t){let i=t.subtract(e);return new u(Math.atan2(i.y,i.x))}static BetweenTwoVectors(e,t){let i=e.lengthSquared()*t.lengthSquared();if(0===i)return new u(Math.PI/2);i=Math.sqrt(i);let r=e.dot(t)/i;return new u(Math.acos(r=(0,s.Clamp)(r,-1,1)))}static FromRadians(e){return new u(e)}static FromDegrees(e){return new u(e*Math.PI/180)}}class h{constructor(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;const r=Math.pow(t.x,2)+Math.pow(t.y,2),n=(Math.pow(e.x,2)+Math.pow(e.y,2)-r)/2,s=(r-Math.pow(i.x,2)-Math.pow(i.y,2))/2,o=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new a.I9((n*(t.y-i.y)-s*(e.y-t.y))/o,((e.x-t.x)*s-(t.x-i.x)*n)/o),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=u.BetweenTwoPoints(this.centerPoint,this.startPoint);const l=this.startAngle.degrees();let h=u.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),c=u.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();h-l>180&&(h-=360),h-l<-180&&(h+=360),c-h>180&&(c-=360),c-h<-180&&(c+=360),this.orientation=h-l<0?0:1,this.angle=u.FromDegrees(0===this.orientation?l-c:c-l)}}class c{constructor(e,t){this._points=[],this._length=0,this.closed=!1,this._points.push(new a.I9(e,t))}addLineTo(e,t){if(this.closed)return this;let i=new a.I9(e,t),r=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(r).length(),this}addArcTo(e,t,i,r,n=36){if(this.closed)return this;let s=new h(this._points[this._points.length-1],new a.I9(e,t),new a.I9(i,r)),o=s.angle.radians()/n;0===s.orientation&&(o*=-1);let l=s.startAngle.radians()+o;for(let e=0;e<n;e++){let e=Math.cos(l)*s.radius+s.centerPoint.x,t=Math.sin(l)*s.radius+s.centerPoint.y;this.addLineTo(e,t),l+=o}return this}addQuadraticCurveTo(e,t,i,r,n=36){if(this.closed)return this;let s=(e,t,i,r)=>(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r,a=this._points[this._points.length-1];for(let o=0;o<=n;o++){let l=o/n,u=s(l,a.x,e,i),h=s(l,a.y,t,r);this.addLineTo(u,h)}return this}addBezierCurveTo(e,t,i,r,n,s,a=36){if(this.closed)return this;let o=(e,t,i,r,n)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n,l=this._points[this._points.length-1];for(let u=0;u<=a;u++){let h=u/a,c=o(h,l.x,e,i,n),d=o(h,l.y,t,r,s);this.addLineTo(c,d)}return this}isPointInside(e){let t=!1,i=this._points.length;for(let r=i-1,n=0;n<i;r=n++){let i=this._points[r],s=this._points[n],a=s.x-i.x,o=s.y-i.y;if(Math.abs(o)>Number.EPSILON){if(o<0&&(i=this._points[n],a=-a,s=this._points[r],o=-o),e.y<i.y||e.y>s.y)continue;if(e.y===i.y&&e.x===i.x)return!0;{let r=o*(e.x-i.x)-a*(e.y-i.y);if(0===r)return!0;if(r<0)continue;t=!t}}else{if(e.y!==i.y)continue;if(s.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=s.x)return!0}}return t}close(){return this.closed=!0,this}length(){let e=this._length;if(this.closed){let t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e}area(){let e=this._points.length,t=0;for(let i=e-1,r=0;r<e;i=r++)t+=this._points[i].x*this._points[r].y-this._points[r].x*this._points[i].y;return .5*t}getPoints(){return this._points}getPointAtLengthPosition(e){if(e<0||e>1)return a.I9.Zero();let t=e*this.length(),i=0;for(let e=0;e<this._points.length;e++){let r=(e+1)%this._points.length,n=this._points[e],s=this._points[r].subtract(n),o=s.length()+i;if(t>=i&&t<=o){let e=s.normalize(),r=t-i;return new a.I9(n.x+e.x*r,n.y+e.y*r)}i=o}return a.I9.Zero()}static StartingAt(e,t){return new c(e,t)}}class d{constructor(e,t=null,i,r=!1){this.path=e,this._curve=[],this._distances=[],this._tangents=[],this._normals=[],this._binormals=[],this._pointAtData={id:0,point:a.Pq.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:a.uq.Identity()};for(let t=0;t<e.length;t++)this._curve[t]=e[t].clone();this._raw=i||!1,this._alignTangentsWithPath=r,this._compute(t,r)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(e){return this._updatePointAtData(e).point}getTangentAt(e,t=!1){return this._updatePointAtData(e,t),t?a.Pq.TransformCoordinates(a.Pq.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(e,t=!1){return this._updatePointAtData(e,t),t?a.Pq.TransformCoordinates(a.Pq.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(e,t=!1){return this._updatePointAtData(e,t),t?a.Pq.TransformCoordinates(a.Pq.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(e){return this.length()*e}getPreviousPointIndexAt(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex}getSubPositionAt(e){return this._updatePointAtData(e),this._pointAtData.subPosition}getClosestPositionTo(e){let t=Number.MAX_VALUE,i=0;for(let r=0;r<this._curve.length-1;r++){let n=this._curve[r+0],s=this._curve[r+1].subtract(n).normalize(),o=this._distances[r+1]-this._distances[r+0],l=Math.min(Math.max(a.Pq.Dot(s,e.subtract(n).normalize()),0)*a.Pq.Distance(n,e)/o,1),u=a.Pq.Distance(n.add(s.scale(l*o)),e);u<t&&(t=u,i=(this._distances[r+0]+o*l)/this.length())}return i}slice(e=0,t=1){if(e<0&&(e=1- -1*e%1),t<0&&(t=1- -1*t%1),e>t){let i=e;e=t,t=i}let i=this.getCurve(),r=this.getPointAt(e),n=this.getPreviousPointIndexAt(e),s=this.getPointAt(t),a=this.getPreviousPointIndexAt(t)+1,o=[];return 0!==e&&(n++,o.push(r)),o.push(...i.slice(n,a)),(1!==t||1===e)&&o.push(s),new d(o,this.getNormalAt(e),this._raw,this._alignTangentsWithPath)}update(e,t=null,i=!1){for(let t=0;t<e.length;t++)this._curve[t].x=e[t].x,this._curve[t].y=e[t].y,this._curve[t].z=e[t].z;return this._compute(t,i),this}_compute(e,t=!1){let i,r,n,s,o,l=this._curve.length;if(l<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[l-1]=this._curve[l-1].subtract(this._curve[l-2]),this._raw||this._tangents[l-1].normalize();let u=this._tangents[0],h=this._normalVector(u,e);this._normals[0]=h,this._raw||this._normals[0].normalize(),this._binormals[0]=a.Pq.Cross(u,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let e=1;e<l;e++)i=this._getLastNonNullVector(e),e<l-1&&(r=this._getFirstNonNullVector(e),this._tangents[e]=t?r:i.add(r),this._tangents[e].normalize()),this._distances[e]=this._distances[e-1]+this._curve[e].subtract(this._curve[e-1]).length(),n=this._tangents[e],o=this._binormals[e-1],this._normals[e]=a.Pq.Cross(o,n),this._raw||(0===this._normals[e].length()?(s=this._normals[e-1],this._normals[e]=s.clone()):this._normals[e].normalize()),this._binormals[e]=a.Pq.Cross(n,this._normals[e]),this._raw||this._binormals[e].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(e){let t=1,i=this._curve[e+t].subtract(this._curve[e]);for(;0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i}_getLastNonNullVector(e){let t=1,i=this._curve[e].subtract(this._curve[e-t]);for(;0===i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i}_normalVector(e,t){let i,r=e.length();if(0===r&&(r=1),null==t){let t;t=(0,s.WithinEpsilon)(Math.abs(e.y)/r,1,o.bH)?(0,s.WithinEpsilon)(Math.abs(e.x)/r,1,o.bH)?(0,s.WithinEpsilon)(Math.abs(e.z)/r,1,o.bH)?a.Pq.Zero():new a.Pq(0,0,1):new a.Pq(1,0,0):new a.Pq(0,-1,0),i=a.Pq.Cross(e,t)}else i=a.Pq.Cross(e,t),a.Pq.CrossToRef(i,e,i);return i.normalize(),i}_updatePointAtData(e,t=!1){let i;if(this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;let r=this.getPoints();if(e<=0)return this._setPointAtData(0,0,r[0],0,t);if(e>=1)return this._setPointAtData(1,1,r[r.length-1],r.length-1,t);let n=r[0],s=0,o=e*this.length();for(let l=1;l<r.length;l++){i=r[l];let u=a.Pq.Distance(n,i);if((s+=u)===o)return this._setPointAtData(e,1,i,l,t);if(s>o){let r=(s-o)/u,a=n.subtract(i),h=i.add(a.scaleInPlace(r));return this._setPointAtData(e,1-r,h,l-1,t)}n=i}return this._pointAtData}_setPointAtData(e,t,i,r,n){return this._pointAtData.point=i,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=r,this._pointAtData.interpolateReady=n,n&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=a.uq.Identity();let e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){let t=e+1,i=this._tangents[e].clone(),r=this._normals[e].clone(),n=this._binormals[e].clone(),s=this._tangents[t].clone(),o=this._normals[t].clone(),l=this._binormals[t].clone(),u=a.PT.RotationQuaternionFromAxis(r,n,i),h=a.PT.RotationQuaternionFromAxis(o,l,s);a.PT.Slerp(u,h,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class p{static CreateQuadraticBezier(e,t,i,r){r=r>2?r:3;let n=[],s=(e,t,i,r)=>(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;for(let o=0;o<=r;o++)n.push(new a.Pq(s(o/r,e.x,t.x,i.x),s(o/r,e.y,t.y,i.y),s(o/r,e.z,t.z,i.z)));return new p(n)}static CreateCubicBezier(e,t,i,r,n){n=n>3?n:4;let s=[],o=(e,t,i,r,n)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n;for(let l=0;l<=n;l++)s.push(new a.Pq(o(l/n,e.x,t.x,i.x,r.x),o(l/n,e.y,t.y,i.y,r.y),o(l/n,e.z,t.z,i.z,r.z)));return new p(s)}static CreateHermiteSpline(e,t,i,r,n){let s=[],o=1/n;for(let l=0;l<=n;l++)s.push(a.Pq.Hermite(e,t,i,r,l*o));return new p(s)}static CreateCatmullRomSpline(e,t,i){let r=[],n=1/t,s=0;if(i){let i=e.length;for(let o=0;o<i;o++){s=0;for(let l=0;l<t;l++)r.push(a.Pq.CatmullRom(e[o%i],e[(o+1)%i],e[(o+2)%i],e[(o+3)%i],s)),s+=n}r.push(r[0])}else{let i=[];i.push(e[0].clone()),Array.prototype.push.apply(i,e),i.push(e[e.length-1].clone());let o=0;for(;o<i.length-3;o++){s=0;for(let e=0;e<t;e++)r.push(a.Pq.CatmullRom(i[o],i[o+1],i[o+2],i[o+3],s)),s+=n}o--,r.push(a.Pq.CatmullRom(i[o],i[o+1],i[o+2],i[o+3],s))}return new p(r)}static ArcThru3Points(e,t,i,r=32,n=!1,s=!1){let o=[],l=t.subtract(e),u=i.subtract(t),h=e.subtract(i),c=a.Pq.Cross(l,u),d=c.length();if(d<1e-8)return new p(o);let f=l.lengthSquared(),_=u.lengthSquared(),m=h.lengthSquared(),g=c.lengthSquared(),b=.5*l.length()*u.length()*h.length()/d,y=a.Pq.Dot(l,h),x=a.Pq.Dot(l,u),T=a.Pq.Dot(u,h),v=e.scale(-.5*_*y/g).add(t.scale(-.5*m*x/g)).add(i.scale(-.5*f*T/g)),A=e.subtract(v).normalize(),S=a.Pq.Cross(c,A).normalize();if(s){let t=2*Math.PI/r;for(let e=0;e<=2*Math.PI;e+=t)o.push(v.add(A.scale(b*Math.cos(e)).add(S.scale(b*Math.sin(e)))));o.push(e)}else{let t=1/r,s=0,l=a.Pq.Zero();do l=v.add(A.scale(b*Math.cos(s)).add(S.scale(b*Math.sin(s)))),o.push(l),s+=t;while(!l.equalsWithEpsilon(i,b*t*1.1));o.push(i),n&&o.push(e)}return new p(o)}constructor(e){this._length=0,this._points=e,this._length=this._computeLength(e)}getPoints(){return this._points}length(){return this._length}continue(e){let t=this._points[this._points.length-1],i=this._points.slice(),r=e.getPoints();for(let e=1;e<r.length;e++)i.push(r[e].subtract(r[0]).add(t));return new p(i)}_computeLength(e){let t=0;for(let i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t}}},51551(e,t,i){i.d(t,{Z:()=>n});var r=i(70134);class n{constructor(e,t,i,n){this.normal=new r.Pq(e,t,i),this.d=n}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new n(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let e=this.normal.getHashCode();return 397*e^this.d}normalize(){let e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}transform(e){let t=n._TmpMatrix;e.invertToRef(t);let i=t.m,r=this.normal.x,s=this.normal.y,a=this.normal.z,o=this.d;return new n(r*i[0]+s*i[1]+a*i[2]+o*i[3],r*i[4]+s*i[5]+a*i[6]+o*i[7],r*i[8]+s*i[9]+a*i[10]+o*i[11],r*i[12]+s*i[13]+a*i[14]+o*i[15])}dotCoordinate(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}copyFromPoints(e,t,i){let r,n=t.x-e.x,s=t.y-e.y,a=t.z-e.z,o=i.x-e.x,l=i.y-e.y,u=i.z-e.z,h=s*u-a*l,c=a*o-n*u,d=n*l-s*o,p=Math.sqrt(h*h+c*c+d*d);return r=0!==p?1/p:0,this.normal.x=h*r,this.normal.y=c*r,this.normal.z=d*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}isFrontFacingTo(e,t){return r.Pq.Dot(this.normal,e)<=t}signedDistanceTo(e){return r.Pq.Dot(e,this.normal)+this.d}static FromArray(e){return new n(e[0],e[1],e[2],e[3])}static FromPoints(e,t,i){let r=new n(0,0,0,0);return r.copyFromPoints(e,t,i),r}static FromPositionAndNormal(e,t){let i=new n(0,0,0,0);return this.FromPositionAndNormalToRef(e,t,i)}static FromPositionAndNormalToRef(e,t,i){return i.normal.copyFrom(t),i.normal.normalize(),i.d=-e.dot(i.normal),i}static SignedDistanceToPlaneFromPositionAndNormal(e,t,i){let n=-(t.x*e.x+t.y*e.y+t.z*e.z);return r.Pq.Dot(i,t)+n}}n._TmpMatrix=r.uq.Identity()},39058(e,t,i){function r(e){return parseInt(e.toString().replace(/\W/g,""))}function n(e,t,i=1401298e-51){return Math.abs(e-t)<=i}function s(e,t,i,r=1401298e-51){return e<t-r||e>i+r}function a(e,t){return e===t?e:Math.random()*(t-e)+e}function o(e,t,i){return e+(t-e)*i}function l(e,t,i){let r=m(t-e,360);return r>180&&(r-=360),e+r*d(i)}function u(e,t,i){return e!=t?d((i-e)/(t-e)):0}function h(e,t,i,r,n){let s=n*n,a=n*s;return e*(2*a-3*s+1)+i*(-2*a+3*s)+t*(a-2*s+n)+r*(a-s)}function c(e,t,i,r,n){let s=n*n;return(s-n)*6*e+(3*s-4*n+1)*t+(-s+n)*6*i+(3*s-2*n)*r}function d(e,t=0,i=1){return Math.min(i,Math.max(t,e))}function p(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function f(e){let t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()}function _(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;let t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t}function m(e,t){return e-Math.floor(e/t)*t}function g(e,t,i){return(e-t)/(i-t)}function b(e,t,i){return e*(i-t)+t}function y(e,t){let i=m(t-e,360);return i>180&&(i-=360),i}function x(e,t){let i=m(e,2*t);return t-Math.abs(i-t)}function T(e,t,i){let r=d(i);return t*(r=-2*r*r*r+3*r*r)+e*(1-r)}function v(e,t,i){return Math.abs(t-e)<=i?t:e+Math.sign(t-e)*i}function A(e,t,i){let r=y(e,t),n=0;return-i<r&&r<i?n=t:(t=e+r,n=v(e,t,i)),n}function S(e,t,i){return(e-t)/(i-t)}function E(e,t,i){return(i-t)*e+t}i.r(t),i.d(t,{Clamp:()=>d,DeltaAngle:()=>y,Denormalize:()=>b,ExtractAsInt:()=>r,Hermite:()=>h,Hermite1stDerivative:()=>c,HighestCommonFactor:()=>function e(t,i){let r=t%i;return 0===r?i:e(i,r)},ILog2:()=>_,InverseLerp:()=>u,Lerp:()=>o,LerpAngle:()=>l,MoveTowards:()=>v,MoveTowardsAngle:()=>A,Normalize:()=>g,NormalizeRadians:()=>p,OutsideRange:()=>s,PercentToRange:()=>E,PingPong:()=>x,RandomRange:()=>a,RangeToPercent:()=>S,Repeat:()=>m,SmoothStep:()=>T,ToHex:()=>f,WithinEpsilon:()=>n})},89092(e,t,i){i.d(t,{o:()=>r});class r{constructor(e,t){this.width=e,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let e=0|this.width;return 397*e^this.height}copyFrom(e){this.width=e.width,this.height=e.height}copyFromFloats(e,t){return this.width=e,this.height=t,this}set(e,t){return this.copyFromFloats(e,t)}multiplyByFloats(e,t){return new r(this.width*e,this.height*t)}clone(){return new r(this.width,this.height)}equals(e){return!!e&&this.width===e.width&&this.height===e.height}get surface(){return this.width*this.height}static Zero(){return new r(0,0)}add(e){return new r(this.width+e.width,this.height+e.height)}subtract(e){return new r(this.width-e.width,this.height-e.height)}scale(e){return new r(this.width*e,this.height*e)}static Lerp(e,t,i){return new r(e.width+(t.width-e.width)*i,e.height+(t.height-e.height)*i)}}},76172(e,t,i){i.d(t,{B:()=>n,k:()=>s});var r=i(70134);class n{constructor(e=r.Pq.Zero(),t=r.Pq.Up()){this.position=e,this.normal=t}clone(){return new n(this.position.clone(),this.normal.clone())}}class s{constructor(e=r.Pq.Zero(),t=r.Pq.Up(),i=r.I9.Zero()){this.position=e,this.normal=t,this.uv=i}clone(){return new s(this.position.clone(),this.normal.clone(),this.uv.clone())}}},6175(e,t,i){i.d(t,{L:()=>r});class r{constructor(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}toGlobal(e,t){return new r(this.x*e,this.y*t,this.width*e,this.height*t)}toGlobalToRef(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this}clone(){return new r(this.x,this.y,this.width,this.height)}}},79900(e,t,i){i.d(t,{SM:()=>x,_f:()=>s,hh:()=>b,lA:()=>m,qc:()=>g,rT:()=>a,vx:()=>y});var r,n,s,a,o=i(35666),l=i(85822),u=i(16909),h=i(94470),c=i(45020),d=i(31410),p=i(59301),f=i(54389),_=i(27768);function m(e,t,i){let r;switch(i=i??h.q.LastCreatedScene,t.materialType){case 1:r=new l.PBRMaterial(e,i,t.forceGLSL),new f.o(r,i,t);break;case 2:r=new c.h(e,i,t);break;default:r=new o.F(e,i,t.forceGLSL),new f.o(r,i,t)}return r}function g(e,t,i,r){let n;r=r??h.q.LastCreatedScene;let s=d.F.ConvertPoints(t.points,t.pointsOptions);t.widthDistribution=t.widthDistribution??3,t.ribbonOptions&&(t.ribbonOptions.facesMode=t.ribbonOptions.facesMode??1,t.ribbonOptions.pointsMode=t.ribbonOptions.pointsMode??0,t.ribbonOptions.directionsAutoMode=t.ribbonOptions.directionsAutoMode??99*!!t.ribbonOptions.directions),(i=i??{color:_.T.DEFAULT_COLOR}).createAndAssignMaterial=i.createAndAssignMaterial??!0,i.colorDistribution=i?.colorDistribution??3,i.materialType=i.materialType??0;let a=b(s),o=y(a,t.widths??[],t.widthDistribution),l=i?.colors?x(a,i.colors,i.colorDistribution,i.color??_.T.DEFAULT_COLOR):void 0,c={points:s,updatable:t.updatable,widths:o,lazy:t.lazy,ribbonOptions:t.ribbonOptions,uvs:t.uvs,colorPointers:t.colorPointers};if(c.ribbonOptions&&0===c.ribbonOptions.pointsMode&&(c.ribbonOptions.width=i.width??c.ribbonOptions.width??_.T.DEFAULT_WIDTH),t.instance)if((n=t.instance)instanceof p.z)n.addPoints(s,c);else{let e=n.widths;if(e){let t=e.slice();for(let e of o)t.push(e);n.widths=t}else n.widths=o;if(n.addPoints(s),t.uvs){let e=n.uvs;if(e){let i=new Float32Array(e.length+t.uvs.length);i.set(e,0),i.set(t.uvs,e.length),n.uvs=i}else n.uvs=t.uvs}}else if(n=c.ribbonOptions?new p.z(e,r,c):new u.X(e,r,c),i){let s={materialType:i.materialType,dashCount:i.dashCount,dashOffset:i.dashOffset,dashRatio:i.dashRatio,resolution:i.resolution,sizeAttenuation:i.sizeAttenuation,useColors:i.useColors,useDash:i.useDash,visibility:i.visibility,width:i.width,color:i.color,colorMode:i.colorMode,colorsSampling:i.colorsSampling,colorDistributionType:i.colorDistributionType,colors:l,cameraFacing:!t.ribbonOptions,colorsTexture:i.colorsTexture};if(i.createAndAssignMaterial){let i=m(e,s,r);n.material=i,t.ribbonOptions?.facesMode===1&&(i.backFaceCulling=!1)}}if(l&&t.instance&&t.instance.greasedLineMaterial){let e=t.instance.greasedLineMaterial.colors;if(e){let i=e.concat(l);t.instance.greasedLineMaterial.setColors(i,n.isLazy())}}return n}function b(e){let t=0;for(let i of e)t+=i.length/3;return t}function y(e,t,i,r=1,n=1){let s=e-t.length/2,a=[];if(s<0)return t.slice(0,2*e);if(s>0){if(t.length%2!=0&&t.push(r),5===i){let e=Math.floor(t.length/2);for(let i=0,r=0;i<e-1;i++)a.push(t[r++]),a.push(t[r++]);let i=t[e/2],r=t[e/2+1];for(let e=0;e<s;e++)a.push(r),a.push(i);for(let i=e;i<t.length;i+=2)a.push(t[i]),a.push(t[i+1])}else if(3===i){for(let e=0;e<t.length;e+=2)a.push(t[e]),a.push(t[e+1]);for(let e=0;e<s;e++)a.push(r),a.push(n)}else if(4===i){for(let e=0;e<s;e++)a.push(r),a.push(n);for(let e=0;e<t.length;e+=2)a.push(t[e]),a.push(t[e+1])}else if(1===i){let i=0;for(let r=0;r<e;r++)a.push(t[i++]),a.push(t[i++]),i===t.length&&(i=0)}else if(2===i){let i=0,r=t.length/((e-1)*2);for(let n=0;n<e;n++){let e=Math.floor(i);a.push(t[e]),a.push(t[e+1]),i+=r}}}else for(let e=0;e<t.length;e++)a.push(t[e]);return a}function x(e,t,i,r){let n=(e=Math.max(t.length,e))-t.length;if(n<0)return t.slice(0,e);let s=[];if(n>0){if(5===i){let e=Math.floor(t.length/2);for(let i=0;i<e;i++)s.push(t[i]);for(let e=0;e<n-1;e++)s.push(r);for(let i=e;i<t.length;i++)s.push(t[i])}else if(3===i){for(let e=0;e<t.length;e++)s.push(t[e]);for(let e=0;e<n;e++)s.push(r)}else if(4===i){for(let e=0;e<n-1;e++)s.push(r);for(let e=0;e<t.length;e++)s.push(t[e])}else if(1===i){let i=0;for(let r=0;r<e;r++)s.push(t[i]),++i===t.length&&(i=0)}else if(2===i){let i=0,r=t.length/(e-1);for(let n=0;n<e-1;n++){let e=Math.floor(i);s.push(t[e]),i+=r}}else if(0===i)for(let e=0;e<t.length;e++)s.push(t[e])}else for(let i=0;i<e;i++)s.push(t[i]);return s}(r=s||(s={}))[r.COLOR_DISTRIBUTION_NONE=0]="COLOR_DISTRIBUTION_NONE",r[r.COLOR_DISTRIBUTION_REPEAT=1]="COLOR_DISTRIBUTION_REPEAT",r[r.COLOR_DISTRIBUTION_EVEN=2]="COLOR_DISTRIBUTION_EVEN",r[r.COLOR_DISTRIBUTION_START=3]="COLOR_DISTRIBUTION_START",r[r.COLOR_DISTRIBUTION_END=4]="COLOR_DISTRIBUTION_END",r[r.COLOR_DISTRIBUTION_START_END=5]="COLOR_DISTRIBUTION_START_END",(n=a||(a={}))[n.WIDTH_DISTRIBUTION_NONE=0]="WIDTH_DISTRIBUTION_NONE",n[n.WIDTH_DISTRIBUTION_REPEAT=1]="WIDTH_DISTRIBUTION_REPEAT",n[n.WIDTH_DISTRIBUTION_EVEN=2]="WIDTH_DISTRIBUTION_EVEN",n[n.WIDTH_DISTRIBUTION_START=3]="WIDTH_DISTRIBUTION_START",n[n.WIDTH_DISTRIBUTION_END=4]="WIDTH_DISTRIBUTION_END",n[n.WIDTH_DISTRIBUTION_START_END=5]="WIDTH_DISTRIBUTION_START_END"},62102(e,t,i){i.d(t,{EH:()=>d,LL:()=>b,RI:()=>g,k:()=>p,km:()=>_,ol:()=>m,r_:()=>f});var r=i(70134),n=i(19002),s=i(66886),a=i(48256),o=i(36177),l=i(32997),u=i(94470),h=i(26108),c=i(59820);function d(e){let t,i,n=[],s=[],o=[],l=[],u=e.width||e.size||1,h=e.height||e.size||1,d=0|(e.subdivisionsX||e.subdivisions||1),p=0|(e.subdivisionsY||e.subdivisions||1);for(t=0;t<=p;t++)for(i=0;i<=d;i++){let e=new r.Pq(i*u/d-u/2,0,(p-t)*h/p-h/2),n=new r.Pq(0,1,0);s.push(e.x,e.y,e.z),o.push(n.x,n.y,n.z),l.push(i/d,c.rX?t/p:1-t/p)}for(t=0;t<p;t++)for(i=0;i<d;i++)n.push(i+1+(t+1)*(d+1)),n.push(i+1+t*(d+1)),n.push(i+t*(d+1)),n.push(i+(t+1)*(d+1)),n.push(i+1+(t+1)*(d+1)),n.push(i+t*(d+1));let f=new a.P;return f.indices=n,f.positions=s,f.normals=o,f.uvs=l,f}function p(e){let t,i,n,s,o=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,l=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,u=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,h=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,c=e.subdivisions||{w:1,h:1},d=e.precision||{w:1,h:1},p=[],f=[],_=[],m=[];c.h=c.h<1?1:c.h,c.w=c.w<1?1:c.w,d.w=d.w<1?1:d.w,d.h=d.h<1?1:d.h;let g={w:(u-o)/c.w,h:(h-l)/c.h};for(n=0;n<c.h;n++)for(s=0;s<c.w;s++)!function(e,n,s,a){let o=f.length/3,l=d.w+1;for(t=0;t<d.h;t++)for(i=0;i<d.w;i++){let e=[o+i+t*l,o+(i+1)+t*l,o+(i+1)+(t+1)*l,o+i+(t+1)*l];p.push(e[1]),p.push(e[2]),p.push(e[3]),p.push(e[0]),p.push(e[1]),p.push(e[3])}let u=r.Pq.Zero(),h=new r.Pq(0,1,0);for(t=0;t<=d.h;t++)for(i=0,u.z=t*(a-n)/d.h+n;i<=d.w;i++)u.x=i*(s-e)/d.w+e,u.y=0,f.push(u.x,u.y,u.z),_.push(h.x,h.y,h.z),m.push(i/d.w,t/d.h)}(o+s*g.w,l+n*g.h,o+(s+1)*g.w,l+(n+1)*g.h);let b=new a.P;return b.indices=p,b.positions=f,b.normals=_,b.uvs=m,b}function f(e){let t,i,s=[],o=[],l=[],u=[],c=e.colorFilter||new n.v9(.3,.59,.11),d=e.alphaFilter||0,p=!1;if(e.minHeight>e.maxHeight){p=!0;let t=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=t}for(t=0;t<=e.subdivisions;t++)for(i=0;i<=e.subdivisions;i++){let n=new r.Pq(i*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-t)*e.height/e.subdivisions-e.height/2),s=(((n.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(n.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth)*4,a=e.buffer[s]/255,f=e.buffer[s+1]/255,_=e.buffer[s+2]/255,m=e.buffer[s+3]/255;p&&(a=1-a,f=1-f,_=1-_);let g=a*c.r+f*c.g+_*c.b;m>=d?n.y=e.minHeight+(e.maxHeight-e.minHeight)*g:n.y=e.minHeight-h.bH,e.heightBuffer&&(e.heightBuffer[t*(e.subdivisions+1)+i]=n.y),o.push(n.x,n.y,n.z),l.push(0,0,0),u.push(i/e.subdivisions,1-t/e.subdivisions)}for(t=0;t<e.subdivisions;t++)for(i=0;i<e.subdivisions;i++){let r=i+1+(t+1)*(e.subdivisions+1),n=i+1+t*(e.subdivisions+1),a=i+t*(e.subdivisions+1),l=i+(t+1)*(e.subdivisions+1),u=o[3*r+1]>=e.minHeight,h=o[3*n+1]>=e.minHeight,c=o[3*a+1]>=e.minHeight;u&&h&&c&&(s.push(r),s.push(n),s.push(a)),o[3*l+1]>=e.minHeight&&u&&c&&(s.push(l),s.push(r),s.push(a))}a.P.ComputeNormals(o,s,l);let f=new a.P;return f.indices=s,f.positions=o,f.normals=l,f.uvs=u,f}function _(e,t={},i){let r=new o.f(e,i);return r._setReady(!1),r._subdivisionsX=t.subdivisionsX||t.subdivisions||1,r._subdivisionsY=t.subdivisionsY||t.subdivisions||1,r._width=t.width||1,r._height=t.height||1,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,d(t).applyToMesh(r,t.updatable),r._setReady(!0),r}function m(e,t,i=null){let r=new s.e(e,i);return p(t).applyToMesh(r,t.updatable),r}function g(e,t,i={},r=null){let s,a=i.width||10,h=i.height||10,c=i.subdivisions||1,d=i.minHeight||0,p=i.maxHeight||1,_=i.colorFilter||new n.v9(.3,.59,.11),m=i.alphaFilter||0,b=i.updatable,y=i.onReady;r=r||u.q.LastCreatedScene;let x=new o.f(e,r);x._subdivisionsX=c,x._subdivisionsY=c,x._width=a,x._height=h,x._maxX=x._width/2,x._maxZ=x._height/2,x._minX=-x._maxX,x._minZ=-x._maxZ,x._setReady(!1),i.passHeightBufferInCallback&&(s=new Float32Array((c+1)*(c+1)));let T=(e,t,i)=>{f({width:a,height:h,subdivisions:c,minHeight:d,maxHeight:p,colorFilter:_,buffer:e,bufferWidth:t,bufferHeight:i,alphaFilter:m,heightBuffer:s}).applyToMesh(x,b),y&&y(x,s),x._setReady(!0)};return"string"==typeof t?l.S0.LoadImage(t,e=>{let t=e.width,i=e.height;r.isDisposed||T(r?.getEngine().resizeImageBitmap(e,t,i),t,i)},i.onError?i.onError:()=>{},r.offlineProvider):T(t.data,t.width,t.height),x}let b={CreateGround:_,CreateGroundFromHeightMap:g,CreateTiledGround:m};a.P.CreateGround=d,a.P.CreateTiledGround=p,a.P.CreateGroundFromHeightMap=f,s.e.CreateGround=(e,t,i,r,n,s)=>_(e,{width:t,height:i,subdivisions:r,updatable:s},n),s.e.CreateTiledGround=(e,t,i,r,n,s,a,o,l)=>m(e,{xmin:t,zmin:i,xmax:r,zmax:n,subdivisions:s,precision:a,updatable:l},o),s.e.CreateGroundFromHeightMap=(e,t,i,r,n,s,a,o,l,u,h)=>g(e,t,{width:i,height:r,subdivisions:n,minHeight:s,maxHeight:a,updatable:l,onReady:u,alphaFilter:h},o)},38252(e,t,i){i.d(t,{NX:()=>p,dT:()=>f,e8:()=>u,nP:()=>h,sh:()=>d,uz:()=>c});var r=i(70134),n=i(66886),s=i(48256),a=i(48185),o=i(95435),l=i(31656);function u(e){let t=[],i=[],r=e.lines,n=e.colors,a=[],o=0;for(let e=0;e<r.length;e++){let s=r[e];for(let r=0;r<s.length;r++){let{x:l,y:u,z:h}=s[r];if(i.push(l,u,h),n){let{r:t,g:i,b:s,a:o}=n[e][r];a.push(t,i,s,o)}r>0&&(t.push(o-1),t.push(o)),o++}}let l=new s.P;return l.indices=t,l.positions=i,n&&(l.colors=a),l}function h(e){let t=e.dashSize||3,i=e.gapSize||1,n=e.dashNb||200,a=e.points,o=[],l=[],u=r.Pq.Zero(),h=0,c=0,d=0,p=0,f=0,_=0,m=0;for(m=0;m<a.length-1;m++)a[m+1].subtractToRef(a[m],u),h+=u.length();for(m=0,p=t*(d=h/n)/(t+i);m<a.length-1;m++){a[m+1].subtractToRef(a[m],u),c=Math.floor(u.length()/d),u.normalize();for(let e=0;e<c;e++)f=d*e,o.push(a[m].x+f*u.x,a[m].y+f*u.y,a[m].z+f*u.z),o.push(a[m].x+(f+p)*u.x,a[m].y+(f+p)*u.y,a[m].z+(f+p)*u.z),l.push(_,_+1),_+=2}let g=new s.P;return g.positions=o,g.indices=l,g}function c(e,t,i=null){let r=t.instance,n=t.lines,s=t.colors;if(r){let e,t,i=r.getVerticesData(o.R.PositionKind);s&&(e=r.getVerticesData(o.R.ColorKind));let a=0,l=0;for(let r=0;r<n.length;r++){let o=n[r];for(let n=0;n<o.length;n++)i[a]=o[n].x,i[a+1]=o[n].y,i[a+2]=o[n].z,s&&e&&(t=s[r],e[l]=t[n].r,e[l+1]=t[n].g,e[l+2]=t[n].b,e[l+3]=t[n].a,l+=4),a+=3}return r.updateVerticesData(o.R.PositionKind,i,!1,!1),s&&e&&r.updateVerticesData(o.R.ColorKind,e,!1,!1),r.refreshBoundingInfo(),r}let l=!!s,h=new a.l(e,i,null,void 0,void 0,l,t.useVertexAlpha,t.material);return u(t).applyToMesh(h,t.updatable),h}function d(e,t,i=null){let r=t.colors?[t.colors]:null;return c(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:r,useVertexAlpha:t.useVertexAlpha,material:t.material},i)}function p(e,t,i=null){let s=t.points,o=t.instance,u=t.gapSize||1,c=t.dashSize||3;if(o)return(t.dashNb||t.dashSize||t.gapSize||t.useVertexAlpha||t.material)&&l.V.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),o.updateMeshPositions(e=>{let t=r.Pq.Zero(),i=e.length/6,n=0,a=0,l=0,u=0,h=0,c=0,d=0,p=0;for(d=0;d<s.length-1;d++)s[d+1].subtractToRef(s[d],t),n+=t.length();l=n/i;let f=o._creationDataStorage.dashSize;for(d=0,u=f*l/(f+o._creationDataStorage.gapSize);d<s.length-1;d++)for(s[d+1].subtractToRef(s[d],t),a=Math.floor(t.length()/l),t.normalize(),p=0;p<a&&c<e.length;)h=l*p,e[c]=s[d].x+h*t.x,e[c+1]=s[d].y+h*t.y,e[c+2]=s[d].z+h*t.z,e[c+3]=s[d].x+(h+u)*t.x,e[c+4]=s[d].y+(h+u)*t.y,e[c+5]=s[d].z+(h+u)*t.z,c+=6,p++;for(;c<e.length;)e[c]=s[d].x,e[c+1]=s[d].y,e[c+2]=s[d].z,c+=3},!1),o;let d=new a.l(e,i,null,void 0,void 0,void 0,t.useVertexAlpha,t.material);return h(t).applyToMesh(d,t.updatable),d._creationDataStorage=new n.Ez,d._creationDataStorage.dashSize=c,d._creationDataStorage.gapSize=u,d}let f={CreateDashedLines:p,CreateLineSystem:c,CreateLines:d};s.P.CreateLineSystem=u,s.P.CreateDashedLines=h,n.e.CreateLines=(e,t,i=null,r=!1,n=null)=>d(e,{points:t,updatable:r,instance:n},i),n.e.CreateDashedLines=(e,t,i,r,n,s=null,a,o)=>p(e,{points:t,dashSize:i,gapSize:r,dashNb:n,updatable:a,instance:o},s)},90911(e,t,i){i.d(t,{To:()=>c,qg:()=>f,sV:()=>p,v1:()=>d});var r=i(70134),n=i(19002),s=i(66886),a=i(48256),o=i(29612),l=i(95435),u=i(94470),h=i(59820);function c(e,t,i,s,o,u,c){let d=i||[,,,],p=[],f=c||!1;for(let e=0;e<3;e++)void 0===d[e]&&(d[e]=new r.IU(0,0,1,1)),s&&void 0===s[e]&&(s[e]=new n.ov(1,1,1,1));let _=e.getVerticesData(l.R.PositionKind),m=e.getVerticesData(l.R.NormalKind),g=e.getVerticesData(l.R.UVKind),b=e.getIndices(),y=_.length/9,x=0,T=0,v=0,A=0,S=[0];if(f)for(let e=y;e<_.length/3;e+=4)S.push(A+=Math.sqrt((T=_[3*(e+2)]-_[3*e])*T+(v=_[3*(e+2)+2]-_[3*e+2])*v));let E=0,I=0;for(let e=0;e<m.length;e+=3).001>Math.abs(m[e+1])&&(I=1),.001>Math.abs(m[e+1]-1)&&(I=0),.001>Math.abs(m[e+1]+1)&&(I=2),E=e/3,1===I?((x=E-y)%4<1.5?f?g[2*E]=d[I].x+(d[I].z-d[I].x)*S[Math.floor(x/4)]/A:g[2*E]=d[I].x:f?g[2*E]=d[I].x+(d[I].z-d[I].x)*S[Math.floor(x/4)+1]/A:g[2*E]=d[I].z,x%2==0?g[2*E+1]=h.rX?1-d[I].w:d[I].w:g[2*E+1]=h.rX?1-d[I].y:d[I].y):(g[2*E]=(1-g[2*E])*d[I].x+g[2*E]*d[I].z,g[2*E+1]=(1-g[2*E+1])*d[I].y+g[2*E+1]*d[I].w,h.rX&&(g[2*E+1]=1-g[2*E+1])),s&&p.push(s[I].r,s[I].g,s[I].b,s[I].a);a.P._ComputeSides(t,_,b,m,g,o,u);let R=new a.P;return R.indices=b,R.positions=_,R.normals=m,R.uvs=g,s&&(R.colors=t===a.P.DOUBLESIDE?p.concat(p):p),R}function d(e,t,i=null,n=earcut){t.sideOrientation=s.e._GetDefaultSideOrientation(t.sideOrientation);let a=t.shape,l=t.holes||[],h=t.depth||0,p=t.smoothingThreshold||2,f=[],_=[];for(let e=0;e<a.length;e++)f[e]=new r.I9(a[e].x,a[e].z);f[0].equalsWithEpsilon(f[f.length-1],1e-8)&&f.pop();let m=new o.L(e,f,i||u.q.LastCreatedScene,n);for(let e=0;e<l.length;e++){_=[];for(let t=0;t<l[e].length;t++)_.push(new r.I9(l[e][t].x,l[e][t].z));m.addHole(_)}let g=m.build(!1,h,p);return g._originalBuilderSideOrientation=t.sideOrientation,c(g,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs,t.wrap).applyToMesh(g,t.updatable),g}function p(e,t,i=null,r=earcut){return d(e,t,i,r)}let f={ExtrudePolygon:p,CreatePolygon:d};a.P.CreatePolygon=c,s.e.CreatePolygon=(e,t,i,r,n,s,a=earcut)=>d(e,{shape:t,holes:r,updatable:n,sideOrientation:s},i,a),s.e.ExtrudePolygon=(e,t,i,r,n,s,a,o=earcut)=>p(e,{shape:t,holes:n,depth:i,updatable:s,sideOrientation:a},r,o)},97435(e,t,i){i.d(t,{$Y:()=>o,AA:()=>l,E5:()=>a});var r=i(32997),n=i(88316),s=i(79581);function a(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function o(e){return!!(e.wasmUrl&&(e.wasmBinary||e.wasmBinaryUrl)&&"object"==typeof WebAssembly||e.fallbackUrl)}class l{constructor(e){if(e.workerPool){this._workerPoolPromise=Promise.resolve(e.workerPool);return}const t=e.wasmBinary,i=e.numWorkers??a(),o=i&&"function"==typeof Worker&&"function"==typeof URL,l=o||!e.jsModule,u=e.wasmUrl&&e.wasmBinaryUrl&&"object"==typeof WebAssembly?{url:l?r.S0.GetBabylonScriptURL(e.wasmUrl,!0):"",wasmBinaryPromise:t?Promise.resolve(t):r.S0.LoadFileAsync(r.S0.GetBabylonScriptURL(e.wasmBinaryUrl,!0))}:{url:l?r.S0.GetBabylonScriptURL(e.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};o?this._workerPoolPromise=u.wasmBinaryPromise.then(e=>{let t=this._getWorkerContent(),r=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));return new n.h(i,()=>{let t=new Worker(r);return(0,s.TD)(t,e,u.url)})}):this._modulePromise=u.wasmBinaryPromise.then(async t=>{if(!this._isModuleAvailable()&&!e.jsModule){if(!u.url)throw Error("Draco codec module is not available");await r.S0.LoadBabylonScriptAsync(u.url)}return await this._createModuleAsync(t,e.jsModule)})}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then(e=>{e.dispose()}),delete this._workerPoolPromise,delete this._modulePromise}}},79581(e,t,i){function r(e,t,i,r){let n=null,s=null,a=null,o=null,l={},u=t.find(e=>"POSITION"===e.dracoName);if(!u)throw Error("Position attribute is required for Draco encoding");if(!i){let e=u.data.length/u.size;i=new(e>65535?Uint32Array:Uint16Array)(e);for(let t=0;t<e;t++)i[t]=t}try{n=new e.Encoder,s=new e.MeshBuilder,a=new e.Mesh,s.AddFacesToMesh(a,i.length/3,i);let u=new Map([[Float32Array,(e,t,i,r,n,s)=>e.AddFloatAttribute(t,i,r,n,s)],[Uint32Array,(e,t,i,r,n,s)=>e.AddUInt32Attribute(t,i,r,n,s)],[Uint16Array,(e,t,i,r,n,s)=>e.AddUInt16Attribute(t,i,r,n,s)],[Uint8Array,(e,t,i,r,n,s)=>e.AddUInt8Attribute(t,i,r,n,s)],[Int32Array,(e,t,i,r,n,s)=>e.AddInt32Attribute(t,i,r,n,s)],[Int16Array,(e,t,i,r,n,s)=>e.AddInt16Attribute(t,i,r,n,s)],[Int8Array,(e,t,i,r,n,s)=>e.AddInt8Attribute(t,i,r,n,s)]]);for(let i of t){i.data instanceof Uint8ClampedArray&&(i.data=new Uint8Array(i.data));let t=u.get(i.data.constructor),o=i.data.length/i.size;l[i.kind]=t(s,a,e[i.dracoName],o,i.size,i.data),r.quantizationBits&&r.quantizationBits[i.dracoName]&&n.SetAttributeQuantization(e[i.dracoName],r.quantizationBits[i.dracoName])}r.method&&n.SetEncodingMethod(e[r.method]),void 0!==r.encodeSpeed&&void 0!==r.decodeSpeed&&n.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),o=new e.DracoInt8Array;let h=n.EncodeMeshToDracoBuffer(a,o);if(h<=0)throw Error("Draco encoding failed.");let c=new Int8Array(h);for(let e=0;e<h;e++)c[e]=o.GetValue(e);return{data:c,attributeIds:l}}finally{a&&e.destroy(a),s&&e.destroy(s),n&&e.destroy(n),o&&e.destroy(o)}}function n(){let e;onmessage=t=>{let i=t.data;switch(i.id){case"init":i.url&&importScripts(i.url),e=DracoEncoderModule(i.wasmBinary?{wasmBinary:i.wasmBinary}:{}),postMessage({id:"initDone"});break;case"encodeMesh":if(!e)throw Error("Draco encoder module is not available");e.then(e=>{let t=r(e,i.attributes,i.indices,i.options);postMessage({id:"encodeMeshDone",encodedMeshData:t},t?[t.data.buffer]:void 0)})}}}function s(e,t,i,r,n){let s=null,a=null,o=null;try{let l;s=new e.Decoder,(a=new e.DecoderBuffer).Init(t,t.byteLength);let u=s.GetEncodedGeometryType(a);switch(u){case e.TRIANGULAR_MESH:{let t=new e.Mesh;if(!(l=s.DecodeBufferToMesh(a,t)).ok()||0===t.ptr)throw Error(l.error_msg());let i=t.num_faces(),n=3*i,u=4*n,h=e._malloc(u);try{s.GetTrianglesUInt32Array(t,u,h);let i=new Uint32Array(n);i.set(new Uint32Array(e.HEAPF32.buffer,h,n)),r(i)}finally{e._free(h)}o=t;break}case e.POINT_CLOUD:{let t=new e.PointCloud;if(!(l=s.DecodeBufferToPointCloud(a,t)).ok()||!t.ptr)throw Error(l.error_msg());o=t;break}default:throw Error(`Invalid geometry type ${u}`)}let h=o.num_points(),c=(t,i,r,s)=>{let a=s.data_type(),o=s.num_components(),l=s.normalized(),u=s.byte_stride(),c=s.byte_offset(),d={[e.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:e.HEAPF32},[e.DT_INT8]:{typedArrayConstructor:Int8Array,heap:e.HEAP8},[e.DT_INT16]:{typedArrayConstructor:Int16Array,heap:e.HEAP16},[e.DT_INT32]:{typedArrayConstructor:Int32Array,heap:e.HEAP32},[e.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:e.HEAPU8},[e.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:e.HEAPU16},[e.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:e.HEAPU32}}[a];if(!d)throw Error(`Invalid data type ${a}`);let p=h*o,f=p*d.typedArrayConstructor.BYTES_PER_ELEMENT,_=e._malloc(f);try{t.GetAttributeDataArrayForAllPoints(i,s,a,f,_);let e=new d.typedArrayConstructor(d.heap.buffer,_,p);n(r,e.slice(),o,c,u,l)}finally{e._free(_)}};if(i)for(let e in i){let t=i[e],r=s.GetAttributeByUniqueId(o,t);c(s,o,e,r)}else{let t={position:e.POSITION,normal:e.NORMAL,color:e.COLOR,uv:e.TEX_COORD};for(let e in t){let i=s.GetAttributeId(o,t[e]);if(-1!==i){let t=s.GetAttribute(o,i);c(s,o,e,t)}}}return h}finally{o&&e.destroy(o),a&&e.destroy(a),s&&e.destroy(s)}}function a(){let e;onmessage=t=>{let i=t.data;switch(i.id){case"init":i.url&&importScripts(i.url),e=DracoDecoderModule(i.wasmBinary?{wasmBinary:i.wasmBinary}:{}),postMessage({id:"initDone"});break;case"decodeMesh":if(!e)throw Error("Draco decoder module is not available");e.then(e=>{let t=s(e,i.dataView,i.attributes,e=>{postMessage({id:"indices",data:e},[e.buffer])},(e,t,i,r,n,s)=>{postMessage({id:"attribute",kind:e,data:t,size:i,byteOffset:r,byteStride:n,normalized:s},[t.buffer])});postMessage({id:"decodeMeshDone",totalVertices:t})})}}}async function o(e,t,i){return await new Promise((r,n)=>{let s=t=>{e.removeEventListener("error",s),e.removeEventListener("message",a),n(t)},a=t=>{"initDone"===t.data.id&&(e.removeEventListener("error",s),e.removeEventListener("message",a),r(e))};if(e.addEventListener("error",s),e.addEventListener("message",a),t){let r=t.slice(0);e.postMessage({id:"init",url:i,wasmBinary:r},[r])}else e.postMessage({id:"init",url:i})})}i.d(t,{Ct:()=>r,GX:()=>s,TD:()=>o,ho:()=>a,t:()=>n})},75376(e,t,i){i.d(t,{X:()=>o});var r=i(39545),n=i(4101),s=i(32462),a=i(91817);class o extends n.A{constructor(e){super(e),this.evaluateContext=!0,this.registerInput("instance",s.J.Geometry,!0),this.registerInput("count",s.J.Int,!0,1),this.registerOutput("output",s.J.Geometry)}getInstanceIndex(){return this._currentIndex}getExecutionIndex(){return this._currentIndex}getExecutionLoopIndex(){return this._currentIndex}getExecutionFaceIndex(){return 0}getClassName(){return"InstantiateBaseBlock"}get instance(){return this._inputs[0]}get count(){return this._inputs[1]}get output(){return this._outputs[0]}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){let e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),void 0!==e.evaluateContext&&(this.evaluateContext=e.evaluateContext)}}(0,r.Cg)([(0,a.u)("Evaluate context",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],o.prototype,"evaluateContext",void 0)},58932(){},70309(e,t,i){Object.defineProperty(i(31804).u.prototype,"decalMap",{get:function(){return this._decalMap},set:function(e){this._decalMap=e},enumerable:!0,configurable:!0})},66886(e,t,i){i.d(t,{Ez:()=>I,_h:()=>M,e:()=>D});var r=i(52969),n=i(32997),s=i(94088),a=i(60017),o=i(20744),l=i(26623),u=i(70134),h=i(19002),c=i(45973),d=i(95435),p=i(48256),f=i(23487),_=i(31804),m=i(5088),g=i(21383),b=i(2340),y=i(94902),x=i(57176),T=i(31656),v=i(27371),A=i(39446),S=i(75318),E=i(76425);class I{}class R{constructor(){this.batchCache=new M(this),this.batchCacheReplacementModeInFrozenMode=new M(this),this.instancesBufferSize=2048}}class P{constructor(){this.renderPasses={}}}class M{constructor(e){this.parent=e,this.mustReturn=!1,this.visibleInstances=[],this.renderSelf=[],this.hardwareInstancedRendering=[]}}class C{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class O{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=[],this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}let w={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class D extends _.u{static _GetDefaultSideOrientation(e){return e||D.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(e){this._internalMeshDataInfo._useLODScreenCoverage=e,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(d.R.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(d.R.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new r.cP),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new r.cP),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new r.cP),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new r.cP),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new r.cP),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(e){this._internalMeshDataInfo._forcedInstanceCount=e}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(e){this._internalMeshDataInfo._sideOrientation=e,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===e||!this._scene.useRightHandedSystem&&0===e}get _effectiveSideOrientation(){return this._internalMeshDataInfo._effectiveSideOrientation}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(e){this.sideOrientation=e,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(e){this._internalMeshDataInfo._overrideRenderingFillMode=e}get material(){return this._internalAbstractMeshDataInfo._material}set material(e){e&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(e.sideOrientation=null),this._setMaterial(e)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){let e=this._instanceDataStorage.renderPasses[this._instanceDataStorage.engine.isWebGPU?this._instanceDataStorage.engine.currentRenderPassId:0];return e?e.instancesData:void 0}get previousWorldMatrixInstancedBuffer(){let e=this._instanceDataStorage.renderPasses[this._instanceDataStorage.engine.isWebGPU?this._instanceDataStorage.engine.currentRenderPassId:0];return e?e.instancesPreviousData:void 0}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(e){this._instanceDataStorage.manualUpdate=e}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(e){this._instanceDataStorage.previousManualUpdate=e}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(e){this._instanceDataStorage.forceMatrixUpdates=e}_copySource(e,t,i=!0,r=!1){let n=this.getScene();if(e._geometry&&e._geometry.applyToMesh(this),s.r.DeepCopy(e,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=e,n.useClonedMeshMap&&(e._internalMeshDataInfo.meshMap||(e._internalMeshDataInfo.meshMap={}),e._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=e._originalBuilderSideOrientation,this._creationDataStorage=e._creationDataStorage,e._ranges){let t=e._ranges;for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&t[e]&&this.createAnimationRange(e,t[e].from,t[e].to)}if(e.metadata&&e.metadata.clone?this.metadata=e.metadata.clone():this.metadata=e.metadata,this._internalMetadata=e._internalMetadata,a.Y&&a.Y.HasTags(e)&&a.Y.AddTagsTo(this,a.Y.GetTags(e,!0)),this.setEnabled(e.isEnabled(!1)),this.parent=e.parent,this.setPivotMatrix(e.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+e.id,this.material=e.material,!t){let n=e.getDescendants(!0);for(let e=0;e<n.length;e++){let s=n[e];s._isMesh?(w.parent=this,w.doNotCloneChildren=t,w.clonePhysicsImpostor=i,w.cloneThinInstances=r,s.clone(this.name+"."+s.name,w)):s.clone&&s.clone(this.name+"."+s.name,this)}}if(e.morphTargetManager&&(this.morphTargetManager=e.morphTargetManager),n.getPhysicsEngine){let t=n.getPhysicsEngine();if(i&&t)if(1===t.getPluginVersion()){let i=t.getImpostorForPhysicsObject(e);i&&(this.physicsImpostor=i.clone(this))}else 2===t.getPluginVersion()&&e.physicsBody&&e.physicsBody.clone(this)}for(let t=0;t<n.particleSystems.length;t++){let i=n.particleSystems[t];i.emitter===e&&i.clone(i.name,this)}if(this.skeleton=e.skeleton,r&&(e._thinInstanceDataStorage.matrixData?(this.thinInstanceSetBuffer("matrix",new Float32Array(e._thinInstanceDataStorage.matrixData),16,!e._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=e._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=e._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=e._thinInstanceDataStorage.matrixBufferSize,e._userThinInstanceBuffersStorage)){let t=e._userThinInstanceBuffersStorage;for(let e in t.data)this.thinInstanceSetBuffer(e,new Float32Array(t.data[e]),t.strides[e],!t.vertexBuffers?.[e]?.isUpdatable()),this._userThinInstanceBuffersStorage.sizes[e]=t.sizes[e]}this.refreshBoundingInfo(!0,!0),this.computeWorldMatrix(!0)}constructor(e,t=null,i=null,n=null,s,a=!0){super(e,t),this._internalMeshDataInfo=new O,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._thinInstanceDataStorage=new C,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=D.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,t=this.getScene(),this._instanceDataStorage=new P,this._instanceDataStorage.engine=t.getEngine(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(e,t,i)=>{e&&i&&(this._uniformBuffer?this.transferToEffect(t):i.bindOnlyWorldMatrix(t))};let o=null,l=!1;i&&void 0===i._addToSceneRootNodes?(o=i.parent??null,n=i.source??null,s=i.doNotCloneChildren??!1,a=i.clonePhysicsImpostor??!0,l=i.cloneThinInstances??!1):o=i,n&&this._copySource(n,s,a,l),null!==o&&(this.parent=o),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=e=>{e.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add(()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))}))},this.onMeshReadyObservable=new r.cP(this._internalMeshDataInfo._onMeshReadyObserverAdded),n&&n.onClonedObservable.notifyObservers(this)}instantiateHierarchy(e=null,t,i){let r=0===this.getTotalVertices()||t&&t.doNotInstantiate&&(!0===t.doNotInstantiate||t.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));for(let n of(r.parent=e||this.parent,r.position=this.position.clone(),r.scaling=this.scaling.clone(),this.rotationQuaternion?r.rotationQuaternion=this.rotationQuaternion.clone():r.rotation=this.rotation.clone(),i&&i(this,r),this.getChildTransformNodes(!0)))"InstancedMesh"===n.getClassName()&&"Mesh"===r.getClassName()&&n.sourceMesh===this?n.instantiateHierarchy(r,{doNotInstantiate:t&&t.doNotInstantiate||!1,newSourcedMesh:r},i):n.instantiateHierarchy(r,t,i);return r}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(e){let t=super.toString(e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);if(e)if(this._geometry){let e=this.getIndices(),i=this.getVerticesData(d.R.PositionKind);i&&e&&(t+=", flat shading: "+(i.length/3===e.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t}_unBindEffect(){for(let e of(super._unBindEffect(),this.instances))e._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){let e=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort((t,i)=>t.distanceOrScreenCoverage<i.distanceOrScreenCoverage?e:t.distanceOrScreenCoverage>i.distanceOrScreenCoverage?-e:0)}addLODLevel(e,t){if(t&&t._masterMesh)return T.V.Warn("You cannot use a mesh as LOD level twice"),this;let i=new E.L(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(e){let t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++){let r=t._LODLevels[i];if(r.distanceOrScreenCoverage===e)return r.mesh}return null}removeLODLevel(e){let t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this}getLOD(e,t){let i=this._internalMeshDataInfo;if(!i._LODLevels||0===i._LODLevels.length)return this;let r=t||this.getBoundingInfo().boundingSphere,n=e.mode===l.i.ORTHOGRAPHIC_CAMERA?e.minZ:r.centerWorld.subtract(e.globalPosition).length(),s=n,a=1;if(i._useLODScreenCoverage){let t=e.screenArea,i=r.radiusWorld*e.minZ/n;s=(i=i*i*Math.PI)/t,a=-1}if(a*i._LODLevels[i._LODLevels.length-1].distanceOrScreenCoverage>a*s)return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this;for(let e=0;e<i._LODLevels.length;e++){let t=i._LODLevels[e];if(a*t.distanceOrScreenCoverage<a*s){if(t.mesh){if(4===t.mesh.delayLoadState)return t.mesh._checkDelayState(),this;if(2===t.mesh.delayLoadState)return this;t.mesh._preActivate(),t.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,t.mesh),t.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this}get geometry(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(e,t,i,r){if(!this._geometry)return null;let n=r?void 0:this._userInstancedBuffersStorage?.vertexBuffers[e]?.getFloatData(this.instances.length+1,i||t&&1!==this._geometry.meshes.length);return n||(n=this._geometry.getVerticesData(e,t,i)),n}copyVerticesData(e,t){this._geometry&&this._geometry.copyVerticesData(e,t)}getVertexBuffer(e,t){return this._geometry?(t?void 0:this._userInstancedBuffersStorage?.vertexBuffers[e])??this._geometry.getVertexBuffer(e):null}isVerticesDataPresent(e,t){return this._geometry?!t&&this._userInstancedBuffersStorage?.vertexBuffers[e]!==void 0||this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}isVertexBufferUpdatable(e,t){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(e);if(!t){let t=this._userInstancedBuffersStorage?.vertexBuffers[e];if(t)return t.isUpdatable()}return this._geometry.isVertexBufferUpdatable(e)}getVerticesDataKinds(e){if(!this._geometry){let e=[];if(this._delayInfo)for(let t of this._delayInfo)e.push(t);return e}let t=this._geometry.getVerticesDataKinds();if(!e&&this._userInstancedBuffersStorage)for(let e in this._userInstancedBuffersStorage.vertexBuffers)-1===t.indexOf(e)&&t.push(e);return t}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}getIndices(e,t){return this._geometry?this._geometry.getIndices(e,t):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(e=!1,t=!1){if(2===this.delayLoadState||!super.isReady(e))return!1;if(!this.subMeshes||0===this.subMeshes.length||!e)return!0;let i=this.getEngine(),r=this.getScene(),n=t||i.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();let s=this.material||r.defaultMaterial;if(s){if(s._storeEffectOnSubMeshes)for(let e of this.subMeshes){let t=e.getMaterial();if(t){if(t._storeEffectOnSubMeshes){if(!t.isReadyForSubMesh(this,e,n))return!1}else if(!t.isReady(this,n))return!1}}else if(!s.isReady(this,n))return!1}let a=i.currentRenderPassId;for(let e of this.lightSources){let t=e.getShadowGenerators();if(!t)continue;let r=t.values();for(let e=r.next();!0!==e.done;e=r.next()){let t=e.value;if(t&&(!t.getShadowMap()?.renderList||t.getShadowMap()?.renderList&&t.getShadowMap()?.renderList?.indexOf(this)!==-1)){let e=t.getShadowMap().renderPassIds??[i.currentRenderPassId];for(let r=0;r<e.length;++r)for(let s of(i.currentRenderPassId=e[r],this.subMeshes))if(!t.isReady(s,n,s.getMaterial()?.needAlphaBlendingForMesh(this)??!1))return i.currentRenderPassId=a,!1;i.currentRenderPassId=a}}}for(let e of this._internalMeshDataInfo._LODLevels)if(e.mesh&&!e.mesh.isReady(n))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}freezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(e){this._instanceDataStorage.overridenInstanceCount=e}_getInstanceDataStorage(){let e=this._instanceDataStorage.engine.isWebGPU?this._instanceDataStorage.engine.currentRenderPassId:0,t=this._instanceDataStorage.renderPasses[e];return t||(t=new R,this._instanceDataStorage.renderPasses[e]=t),t}_preActivate(){let e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._getInstanceDataStorage().visibleInstances=null),this}_preActivateForIntermediateRendering(e){let t=this._getInstanceDataStorage();return t.visibleInstances&&(t.visibleInstances.intermediateDefaultRenderId=e),this}_registerInstanceForRenderId(e,t){let i=this._getInstanceDataStorage();return i.visibleInstances||(i.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId,intermediateDefaultRenderId:-1}),i.visibleInstances[t]||(void 0!==i.previousRenderId&&this._instanceDataStorage.isFrozen&&(i.visibleInstances[i.previousRenderId]=null),i.previousRenderId=t,i.visibleInstances[t]=[]),i.visibleInstances[t].push(e),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let i=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getData("object"==typeof e?e:{applySkeleton:e,applyMorph:t},null,d.R.PositionKind),i),this}_createGlobalSubMesh(e){let t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){let i=this.getIndices();if(!i)return null;let r=i.length,n=!1;if(e)n=!0;else for(let e of this.subMeshes)if(e.indexStart+e.indexCount>r||e.verticesStart+e.verticesCount>t){n=!0;break}if(!n)return this.subMeshes[0]}return this.releaseSubMeshes(),new m.K(0,0,t,0,this.getTotalIndices()||(this.isUnIndexed?t:0),this)}subdivide(e){if(e<1)return;let t=this.getTotalIndices(),i=t/e|0,r=0;for(;i%3!=0;)i++;this.releaseSubMeshes();for(let n=0;n<e&&!(r>=t);n++)m.K.CreateFromIndices(0,r,n===e-1?t-r:i,this,void 0,!1),r+=i;this.refreshBoundingInfo(),this.synchronizeInstances()}setVerticesData(e,t,i=!1,r){if(this._geometry)this._geometry.setVerticesData(e,t,i,r);else{let r=new p.P;r.set(t,e);let n=this.getScene();new f.V(f.V.RandomId(),n,r,i,this)}return this}removeVerticesData(e){this._geometry&&this._geometry.removeVerticesData(e)}markVerticesDataAsUpdatable(e,t=!0){let i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)}setVerticesBuffer(e,t=!0,i=null){return this._geometry||(this._geometry=f.V.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e,i,t),this}updateVerticesData(e,t,i,r){return this._geometry&&(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i)),this}updateMeshPositions(e,t=!0){let i=this.getVerticesData(d.R.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData(d.R.PositionKind,i,!1,!1),t){let e=this.getIndices(),t=this.getVerticesData(d.R.NormalKind);if(!t)return this;p.P.ComputeNormals(i,e,t),this.updateVerticesData(d.R.NormalKind,t,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry||1===this._geometry.meshes.length)return this;let e=this._geometry,t=this._geometry.copy(f.V.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this}setIndexBuffer(e,t,i,r=null){let n=this._geometry;n||(n=new f.V(f.V.RandomId(),this.getScene(),void 0,void 0,this)),n.setIndexBuffer(e,t,i,r)}setIndices(e,t=null,i=!1,r=!1){if(this._geometry)this._geometry.setIndices(e,t,i,r);else{let r=new p.P;r.indices=e;let n=this.getScene();new f.V(f.V.RandomId(),n,r,i,this,t)}return this}updateIndices(e,t,i=!1){return this._geometry&&this._geometry.updateIndices(e,t,i),this}toLeftHanded(){return this._geometry&&this._geometry.toLeftHanded(),this}_bind(e,t,i,r=!0){let n;if(!this._geometry)return this;let s=this.getScene().getEngine();if(this._unIndexed)n=this._getRenderingFillMode(i)===g.i.WireFrameFillMode?e._getLinesIndexBuffer(this.getIndices(),s):null;else switch(this._getRenderingFillMode(i)){case g.i.PointFillMode:n=null;break;case g.i.WireFrameFillMode:n=e._getLinesIndexBuffer(this.getIndices(),s);break;default:case g.i.TriangleFillMode:n=this._geometry.getIndexBuffer()}return this._bindDirect(t,n,r)}_bindDirect(e,t,i=!0){if(!this._geometry)return this;if(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(e),i&&this._userInstancedBuffersStorage&&!this.hasThinInstances){if(this._instanceDataStorage.engine.isWebGPU&&this._userInstancedBuffersStorage.renderPasses&&this._userInstancedBuffersStorage.renderPasses[this._instanceDataStorage.engine.currentRenderPassId]){let e=this._userInstancedBuffersStorage.renderPasses[this._instanceDataStorage.engine.currentRenderPassId];for(let t in e)this._userInstancedBuffersStorage.vertexBuffers[t]=e[t]}this._geometry._bind(e,t,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects)}else this._geometry._bind(e,t);return this}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);let r=this.getScene().getEngine(),n=r._currentMaterialContext,s=n&&n.useVertexPulling;return this._unIndexed&&t!==g.i.WireFrameFillMode||t==g.i.PointFillMode?r.drawArraysType(t,e.verticesStart,e.verticesCount,this.forcedInstanceCount||i):t==g.i.WireFrameFillMode?r.drawElementsType(t,0,e._linesIndexCount,this.forcedInstanceCount||i):s?r.drawArraysType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||i):r.drawElementsType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||i),this}registerBeforeRender(e){return this.onBeforeRenderObservable.add(e),this}unregisterBeforeRender(e){return this.onBeforeRenderObservable.removeCallback(e),this}registerAfterRender(e){return this.onAfterRenderObservable.add(e),this}unregisterAfterRender(e){return this.onAfterRenderObservable.removeCallback(e),this}_getInstancesRenderList(e,t=!1){let i=this._getInstanceDataStorage();if(this._instanceDataStorage.isFrozen){if(t)return i.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[e]=!1,i.batchCacheReplacementModeInFrozenMode.renderSelf[e]=!0,i.batchCacheReplacementModeInFrozenMode;if(i.previousBatch)return i.previousBatch}let r=this.getScene(),n=r._isInIntermediateRendering(),s=n?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,a=i.batchCache;if(a.mustReturn=!1,a.renderSelf[e]=t||!s&&this.isEnabled()&&this.isVisible,a.visibleInstances[e]=null,i.visibleInstances&&!t){let t=i.visibleInstances,s=r.getRenderId(),o=n?t.intermediateDefaultRenderId:t.defaultRenderId;a.visibleInstances[e]=t[s],!a.visibleInstances[e]&&o&&(a.visibleInstances[e]=t[o])}return a.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==a.visibleInstances[e]&&void 0!==a.visibleInstances[e],i.previousBatch=a,a}_updateInstancedBuffers(e,t,i,r,n,s){let a=t.visibleInstances[e._id],o=a?a.length:0,l=t.parent,h=this._instanceDataStorage,c=l.instancesBuffer,p=l.instancesPreviousBuffer,f=0,_=0,m=t.renderSelf[e._id],g=this._scene.floatingOriginOffset,b=!c||i!==l.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!l.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||h.isFrozen&&!b)_=+!!m+o;else{let t=this.getWorldMatrix();if(m&&(this._scene.needsPreviousWorldMatrices&&(h.masterMeshPreviousWorldMatrix?(h.masterMeshPreviousWorldMatrix.copyToArray(l.instancesPreviousData,f),h.masterMeshPreviousWorldMatrix.copyFrom(t)):(h.masterMeshPreviousWorldMatrix=t.clone(),h.masterMeshPreviousWorldMatrix.copyToArray(l.instancesPreviousData,f))),t.copyToArray(l.instancesData,f),l.instancesData[f+12]-=g.x,l.instancesData[f+13]-=g.y,l.instancesData[f+14]-=g.z,f+=16,_++),a){if(D.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&e.getMaterial()?.needAlphaBlendingForMesh(e.getRenderingMesh())){let e=this._scene.activeCamera.globalPosition;for(let t=0;t<a.length;t++){let i=a[t];i._distanceToCamera=u.Pq.Distance(i.getBoundingInfo().boundingSphere.centerWorld,e)}a.sort((e,t)=>e._distanceToCamera>t._distanceToCamera?-1:+(e._distanceToCamera<t._distanceToCamera))}for(let e=0;e<a.length;e++){let t=a[e],i=t.getWorldMatrix();i.copyToArray(l.instancesData,f),this._scene.needsPreviousWorldMatrices&&(t._previousWorldMatrix?(t._previousWorldMatrix.copyToArray(l.instancesPreviousData,f),t._previousWorldMatrix.copyFrom(i)):(t._previousWorldMatrix=i.clone(),t._previousWorldMatrix.copyToArray(l.instancesPreviousData,f))),l.instancesData[f+12]-=g.x,l.instancesData[f+13]-=g.y,l.instancesData[f+14]-=g.z,f+=16,_++}}}if(b){let e;if(c&&c.dispose(),p&&p.dispose(),c=new d.h(r,l.instancesData,!0,16,!1,!0),l.instancesBuffer=c,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._instanceDataStorage.engine.isWebGPU){this._userInstancedBuffersStorage.renderPasses||(this._userInstancedBuffersStorage.renderPasses={});let t=this._instanceDataStorage.engine.currentRenderPassId;(e=this._userInstancedBuffersStorage.renderPasses[t])||(this._userInstancedBuffersStorage.renderPasses[t]=e={})}else e=this._userInstancedBuffersStorage.vertexBuffers;e.world0=c.createVertexBuffer("world0",0,4),e.world1=c.createVertexBuffer("world1",4,4),e.world2=c.createVertexBuffer("world2",8,4),e.world3=c.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(p=new d.h(r,l.instancesPreviousData,!0,16,!1,!0),l.instancesPreviousBuffer=p,e.previousWorld0=p.createVertexBuffer("previousWorld0",0,4),e.previousWorld1=p.createVertexBuffer("previousWorld1",4,4),e.previousWorld2=p.createVertexBuffer("previousWorld2",8,4),e.previousWorld3=p.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()}else(!this._instanceDataStorage.isFrozen||this._instanceDataStorage.forceMatrixUpdates)&&(c.updateDirectly(l.instancesData,0,_),this._scene.needsPreviousWorldMatrices&&(!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.previousManualUpdate)&&p.updateDirectly(l.instancesPreviousData,0,_));this._processInstancedBuffers(a,m),s&&void 0!==n&&(this.getScene()._activeIndices.addCount(e.indexCount*_,!1),r._currentDrawContext&&(r._currentDrawContext.useInstancing=!0),this._bind(e,s,n),this._draw(e,n,_)),this._scene.needsPreviousWorldMatrices&&!b&&this._instanceDataStorage.manualUpdate&&(!this._instanceDataStorage.isFrozen||this._instanceDataStorage.forceMatrixUpdates)&&!this._instanceDataStorage.previousManualUpdate&&p.updateDirectly(l.instancesData,0,_)}_renderWithInstances(e,t,i,r,n){let s=i.visibleInstances[e._id],a=s?s.length:0,o=i.parent,l=o.instancesBufferSize,u=16*(a+1)*4;for(;o.instancesBufferSize<u;)o.instancesBufferSize*=2;return o.instancesData&&l==o.instancesBufferSize||(o.instancesData=new Float32Array(o.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!o.instancesPreviousData||l!=o.instancesBufferSize)&&(o.instancesPreviousData=new Float32Array(o.instancesBufferSize/4)),this._updateInstancedBuffers(e,i,l,n,t,r),n.unbindInstanceAttributes(),this}_renderWithThinInstances(e,t,i,r){let n=this._thinInstanceDataStorage?.instancesCount??0;this.getScene()._activeIndices.addCount(e.indexCount*n,!1),r._currentDrawContext&&(r._currentDrawContext.useInstancing=!0),this._bind(e,i,t),this._draw(e,t,n),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,n):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),r.unbindInstanceAttributes()}_processInstancedBuffers(e,t){}_processRendering(e,t,i,r,n,s,a,o){let l=this.getScene(),u=l.getEngine();if(r=this._getRenderingFillMode(r),s&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,r,i,u),this;if(s)this._renderWithInstances(t,r,n,i,u);else{u._currentDrawContext&&(u._currentDrawContext.useInstancing=!1);let i=0;n.renderSelf[t._id]&&(a&&a(!1,e.getWorldMatrix(),o),i++,this._draw(t,r,this._instanceDataStorage.overridenInstanceCount));let s=n.visibleInstances[t._id];if(s){let e=s.length;i+=e;for(let i=0;i<e;i++){let e=s[i].getWorldMatrix();a&&a(!0,e,o),this._draw(t,r)}}l._activeIndices.addCount(t.indexCount*i,!1)}return this}_rebuild(e=!1){for(let t in this._instanceDataStorage.renderPasses){let i=this._instanceDataStorage.renderPasses[t];i.instancesBuffer&&(e&&i.instancesBuffer.dispose(),i.instancesBuffer=null)}if(this._userInstancedBuffersStorage){for(let t in this._userInstancedBuffersStorage.vertexBuffers){let i=this._userInstancedBuffersStorage.vertexBuffers[t];i&&(e&&i.dispose(),this._userInstancedBuffersStorage.vertexBuffers[t]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(e)}_freeze(){if(this.subMeshes){for(let e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){for(let e in this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.renderPasses)this._instanceDataStorage.renderPasses[e].previousBatch=null}renderWithRenderPassId(e,t,i,r,n=!0){let s=this._scene.getEngine(),a=s.currentRenderPassId;if(void 0!==e&&(s.currentRenderPassId=e),r)(!n||n&&r.isInFrustum(this._scene._frustumPlanes))&&this.render(r,!!t,i);else for(let e=0;e<this.subMeshes.length;e++){let r=this.subMeshes[e];(!n||n&&r.isInFrustum(this._scene._frustumPlanes))&&this.render(r,!!t,i)}return void 0!==e&&(s.currentRenderPassId=a),this}directRender(){if(!this.subMeshes)return this;for(let e of this.subMeshes)this.render(e,!1);return this}render(e,t,i){let r,n,s=this.getScene();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;let a=s.activeCameras?.length??0;if((a>1&&s.activeCamera===s.activeCameras[0]||a<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;let o=this._getInstancesRenderList(e._id,!!i);if(o.mustReturn||!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;let l=s.getEngine(),u=0,h=null;this.ignoreCameraMaxZ&&s.activeCamera&&!s._isInIntermediateRendering()&&(u=s.activeCamera.maxZ,h=s.activeCamera,s.activeCamera.maxZ=0,s.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);let c=e.getRenderingMesh(),d=o.hardwareInstancedRendering[e._id]||c.hasThinInstances||!!this._userInstancedBuffersStorage&&!e.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,p=this._instanceDataStorage,f=e.getMaterial();if(!f)return h&&(h.maxZ=u,s.updateTransformMatrix(!0)),this;if(p.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===f){if(f._storeEffectOnSubMeshes&&!e._drawWrapper?._wasPreviouslyReady||!f._storeEffectOnSubMeshes&&!f._getDrawWrapper()._wasPreviouslyReady)return h&&(h.maxZ=u,s.updateTransformMatrix(!0)),this}else{if(f._storeEffectOnSubMeshes){if(!f.isReadyForSubMesh(this,e,d))return h&&(h.maxZ=u,s.updateTransformMatrix(!0)),this}else if(!f.isReady(this,d))return h&&(h.maxZ=u,s.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=f}if(t){let e=this._internalMeshDataInfo._effectiveMaterial;if(1===e.alphaModes.length)l.setAlphaMode(e.alphaMode);else for(let t=0;t<e.alphaModes.length;t++){let i=e.alphaModes[t];l.setAlphaMode(void 0!==i?i:2,!1,t)}}r=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?e._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();let _=r?.effect??null;for(let t of s._beforeRenderingMeshStage)t.action(this,e,o,_);if(!r||!_)return h&&(h.maxZ=u,s.updateTransformMatrix(!0)),this;let m=i||this;if(!p.isFrozen&&(this._internalMeshDataInfo._effectiveMaterial.backFaceCulling||null!==this._internalMeshDataInfo._effectiveMaterial.sideOrientation||this._internalMeshDataInfo._effectiveMaterial._twoSidedLighting)){let e=m._getWorldMatrixDeterminant();n=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),e<0&&(n=n===g.i.ClockWiseSideOrientation?g.i.CounterClockWiseSideOrientation:g.i.ClockWiseSideOrientation),this._internalMeshDataInfo._effectiveSideOrientation=n}else n=this._internalMeshDataInfo._effectiveSideOrientation;let b=this._internalMeshDataInfo._effectiveMaterial._preBind(r,this._internalMeshDataInfo._effectiveSideOrientation);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&l.setDepthWrite(!0);let y=this._internalMeshDataInfo._effectiveMaterial,x=y.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),d||this._bind(e,_,x,!1);let T=m.getWorldMatrix();for(let t of(y._storeEffectOnSubMeshes?y.bindForSubMesh(T,this,e):y.bind(T,this),!y.backFaceCulling&&y.separateCullingPass&&(l.setState(!0,y.zOffset,!1,!b,y.cullBackFaces,y.stencil,y.zOffsetUnits),this._processRendering(this,e,_,x,o,d,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),l.setState(!0,y.zOffset,!1,b,y.cullBackFaces,y.stencil,y.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(e)),this._processRendering(this,e,_,x,o,d,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind(),s._afterRenderingMeshStage))t.action(this,e,o,_);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),h&&(h.maxZ=u,s.updateTransformMatrix(!0)),2!==s.performancePriority||p.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(d.R.MatricesWeightsKind)&&(this.isVerticesDataPresent(d.R.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){let e=this.getVerticesData(d.R.MatricesWeightsKind),t=e.length;for(let i=0;i<t;i+=4){let t=e[i]+e[i+1]+e[i+2]+e[i+3];if(0===t)e[i]=1;else{let r=1/t;e[i]*=r,e[i+1]*=r,e[i+2]*=r,e[i+3]*=r}}this.setVerticesData(d.R.MatricesWeightsKind,e)}_normalizeSkinWeightsAndExtra(){let e=this.getVerticesData(d.R.MatricesWeightsExtraKind),t=this.getVerticesData(d.R.MatricesWeightsKind),i=t.length;for(let r=0;r<i;r+=4){let i=t[r]+t[r+1]+t[r+2]+t[r+3];if(0===(i+=e[r]+e[r+1]+e[r+2]+e[r+3]))t[r]=1;else{let n=1/i;t[r]*=n,t[r+1]*=n,t[r+2]*=n,t[r+3]*=n,e[r]*=n,e[r+1]*=n,e[r+2]*=n,e[r+3]*=n}}this.setVerticesData(d.R.MatricesWeightsKind,t),this.setVerticesData(d.R.MatricesWeightsKind,e)}validateSkinning(){let e=this.getVerticesData(d.R.MatricesWeightsExtraKind),t=this.getVerticesData(d.R.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};let i=t.length,r=0,n=0,s=0,a=0,o=null===e?4:8,l=[];for(let e=0;e<=o;e++)l[e]=0;for(let u=0;u<i;u+=4){let i=t[u],h=i,c=+(0!==h);for(let n=1;n<o;n++){let s=n<4?t[u+n]:e[u+n-4];s>i&&r++,0!==s&&c++,h+=s,i=s}if(l[c]++,c>s&&(s=c),0===h)n++;else{let i=1/h,r=0;for(let n=0;n<o;n++)n<4?r+=Math.abs(t[u+n]-t[u+n]*i):r+=Math.abs(e[u+n-4]-e[u+n-4]*i);r>.001&&a++}}let u=this.skeleton.bones.length,h=this.getVerticesData(d.R.MatricesIndicesKind),c=this.getVerticesData(d.R.MatricesIndicesExtraKind),p=0;for(let e=0;e<i;e+=4)for(let t=0;t<o;t++){let i=t<4?h[e+t]:c[e+t-4];(i>=u||i<0)&&p++}let f="Number of Weights = "+i/4+"\nMaximum influences = "+s+"\nMissing Weights = "+n+"\nNot Sorted = "+r+"\nNot Normalized = "+a+"\nWeightCounts = ["+l+"]\nNumber of bones = "+u+"\nBad Bone Indices = "+p;return{skinned:!0,valid:0===n&&0===a&&0===p,report:f}}_checkDelayState(){let e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this}_queueLoad(e){e.addPendingData(this);let t=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return n.S0.LoadFile(this.delayLoadingFile,t=>{for(let e of(t instanceof ArrayBuffer?this._delayLoadingFunction(t,this):this._delayLoadingFunction(JSON.parse(t),this),this.instances))e.refreshBoundingInfo(),e._syncSubMeshes();this.delayLoadState=1,e.removePendingData(this)},()=>{},e.offlineProvider,t),this}isInFrustum(e){return 2!==this.delayLoadState&&!!super.isInFrustum(e)&&(this._checkDelayState(),!0)}setMaterialById(e){let t,i=this.getScene().materials;for(t=i.length-1;t>-1;t--)if(i[t].id===e)return this.material=i[t],this;let r=this.getScene().multiMaterials;for(t=r.length-1;t>-1;t--)if(r[t].id===e){this.material=r[t];break}return this}getAnimatables(){let e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e}bakeTransformIntoVertices(e){let t;if(!this.isVerticesDataPresent(d.R.PositionKind))return this;let i=this.subMeshes.splice(0);this._resetPointsArrayCache();let r=this.getVerticesData(d.R.PositionKind),n=u.Pq.Zero();for(t=0;t<r.length;t+=3)u.Pq.TransformCoordinatesFromFloatsToRef(r[t],r[t+1],r[t+2],e,n).toArray(r,t);if(this.setVerticesData(d.R.PositionKind,r,this.getVertexBuffer(d.R.PositionKind).isUpdatable()),this.isVerticesDataPresent(d.R.NormalKind)){for(t=0,r=this.getVerticesData(d.R.NormalKind);t<r.length;t+=3)u.Pq.TransformNormalFromFloatsToRef(r[t],r[t+1],r[t+2],e,n).normalize().toArray(r,t);this.setVerticesData(d.R.NormalKind,r,this.getVertexBuffer(d.R.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(d.R.TangentKind)){for(t=0,r=this.getVerticesData(d.R.TangentKind);t<r.length;t+=4)u.Pq.TransformNormalFromFloatsToRef(r[t],r[t+1],r[t+2],e,n).normalize().toArray(r,t);this.setVerticesData(d.R.TangentKind,r,this.getVertexBuffer(d.R.TangentKind).isUpdatable())}return 0>e.determinant()&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=i,this}bakeCurrentTransformIntoVertices(e=!0,t=!1){return t&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(e="",t=null,i,r=!0){return t&&void 0===t._addToSceneRootNodes?(w.source=this,w.doNotCloneChildren=t.doNotCloneChildren,w.clonePhysicsImpostor=t.clonePhysicsImpostor,w.cloneThinInstances=t.cloneThinInstances,new D(e,this.getScene(),w)):new D(e,this.getScene(),t,this,i,r)}dispose(e,t=!1){this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);let i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),i._onBetweenPassObservable&&i._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(i.meshMap)for(let e in i.meshMap){let t=i.meshMap[e];t&&(t._internalMeshDataInfo._source=null,i.meshMap[e]=void 0)}i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(let e of this.getScene().meshes)e._internalMeshDataInfo&&e._internalMeshDataInfo._source&&e._internalMeshDataInfo._source===this&&(e._internalMeshDataInfo._source=null);i._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(e,t)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(e,t,i,r,s,a,o=!1,l){let u=this.getScene(),h=e=>{let n=e.width,l=e.height,u=this.getEngine().createCanvas(n,l).getContext("2d");u.drawImage(e,0,0);let h=u.getImageData(0,0,n,l).data;this.applyDisplacementMapFromBuffer(h,n,l,t,i,s,a,o),r&&r(this)};return n.S0.LoadImage(e,h,l||(()=>{}),u.offlineProvider),this}applyDisplacementMapFromBuffer(e,t,i,r,n,s,a,o=!1){if(!this.isVerticesDataPresent(d.R.PositionKind)||!this.isVerticesDataPresent(d.R.NormalKind)||!this.isVerticesDataPresent(d.R.UVKind))return T.V.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;let l=this.getVerticesData(d.R.PositionKind,!0,!0),h=this.getVerticesData(d.R.NormalKind),c=this.getVerticesData(d.R.UVKind),f=u.Pq.Zero(),_=u.Pq.Zero(),m=u.I9.Zero();s=s||u.I9.Zero(),a=a||new u.I9(1,1);for(let o=0;o<l.length;o+=3){u.Pq.FromArrayToRef(l,o,f),u.Pq.FromArrayToRef(h,o,_),u.I9.FromArrayToRef(c,o/3*2,m);let d=((Math.abs(m.x*a.x+s.x%1)*(t-1)%t|0)+(Math.abs(m.y*a.y+s.y%1)*(i-1)%i|0)*t)*4,p=.3*(e[d]/255)+.59*(e[d+1]/255)+.11*(e[d+2]/255);_.normalize(),_.scaleInPlace(r+(n-r)*p),(f=f.add(_)).toArray(l,o)}return p.P.ComputeNormals(l,this.getIndices(),h),o?(this.setVerticesData(d.R.PositionKind,l),this.setVerticesData(d.R.NormalKind,h),this.setVerticesData(d.R.UVKind,c)):(this.updateVerticesData(d.R.PositionKind,l),this.updateVerticesData(d.R.NormalKind,h)),this}_getFlattenedNormals(e,t){let i=new Float32Array(3*e.length),r=0,n=this.sideOrientation===+!!this._scene.useRightHandedSystem;for(let s=0;s<e.length;s+=3){let a=u.Pq.FromArray(t,3*e[s]),o=u.Pq.FromArray(t,3*e[s+1]),l=u.Pq.FromArray(t,3*e[s+2]),h=a.subtract(o),c=l.subtract(o),d=u.Pq.Normalize(u.Pq.Cross(h,c));n&&d.scaleInPlace(-1);for(let e=0;e<3;e++)i[r++]=d.x,i[r++]=d.y,i[r++]=d.z}return i}_convertToUnIndexedMesh(e=!1){let t=this.getVerticesDataKinds().filter(e=>!this.getVertexBuffer(e)?.getIsInstanced()),i=this.getIndices(!1,!0),r={},n=(e,t)=>{let r=new Float32Array(i.length*t),n=0;for(let s=0;s<i.length;s++)for(let a=0;a<t;a++)r[n++]=e[i[s]*t+a];return r},s=this.getBoundingInfo(),a=this.geometry?this.subMeshes.slice(0):[];for(let e of t)r[e]=this.getVerticesData(e);for(let s of t){let t=this.getVertexBuffer(s),a=t.getSize();if(e&&s===d.R.NormalKind){let e=this._getFlattenedNormals(i,r[d.R.PositionKind]);this.setVerticesData(d.R.NormalKind,e,t.isUpdatable(),a)}else this.setVerticesData(s,n(r[s],a),t.isUpdatable(),a)}if(this.morphTargetManager){for(let t=0;t<this.morphTargetManager.numTargets;t++){let r=this.morphTargetManager.getTarget(t),s=r.getPositions();r.setPositions(n(s,3));let a=r.getNormals();a&&r.setNormals(e?this._getFlattenedNormals(i,s):n(a,3));let o=r.getTangents();o&&r.setTangents(n(o,3));let l=r.getUVs();l&&r.setUVs(n(l,2));let u=r.getColors();u&&r.setColors(n(u,4))}this.morphTargetManager.synchronize()}for(let e=0;e<i.length;e++)i[e]=e;for(let e of(this.setIndices(i),this._unIndexed=!0,this.releaseSubMeshes(),a)){let t=e.getBoundingInfo();m.K.AddToMesh(e.materialIndex,e.indexStart,e.indexCount,e.indexStart,e.indexCount,this).setBoundingInfo(t)}return this.setBoundingInfo(s),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(e=!1){let t,i=p.P.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(d.R.NormalKind)&&i.normals){for(t=0;t<i.normals.length;t++)i.normals[t]*=-1;this.setVerticesData(d.R.NormalKind,i.normals,this.isVertexBufferUpdatable(d.R.NormalKind))}if(i.indices){let e;for(t=0;t<i.indices.length;t+=3)e=i.indices[t+1],i.indices[t+1]=i.indices[t+2],i.indices[t+2]=e;this.setIndices(i.indices,null,this.isVertexBufferUpdatable(d.R.PositionKind),!0)}return this}increaseVertices(e=1){let t=p.P.ExtractFromMesh(this),i=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,r=t.positions&&!Array.isArray(t.positions)&&Array.from?Array.from(t.positions):t.positions,n=t.uvs&&!Array.isArray(t.uvs)&&Array.from?Array.from(t.uvs):t.uvs,s=t.normals&&!Array.isArray(t.normals)&&Array.from?Array.from(t.normals):t.normals;if(i&&r){let a,o,l,h,c;t.indices=i,t.positions=r,n&&(t.uvs=n),s&&(t.normals=s);let p=e+1,f=[];for(let e=0;e<p+1;e++)f[e]=[];let _=new u.Pq(0,0,0),m=new u.Pq(0,0,0),g=new u.I9(0,0),b=[],y=[],x=[],T=r.length;n&&(h=n.length),s&&(c=s.length);for(let e=0;e<i.length;e+=3){y[0]=i[e],y[1]=i[e+1],y[2]=i[e+2];for(let e=0;e<3;e++)if(a=y[e],o=y[(e+1)%3],void 0===x[a]&&void 0===x[o]?(x[a]=[],x[o]=[]):(void 0===x[a]&&(x[a]=[]),void 0===x[o]&&(x[o]=[])),void 0===x[a][o]&&void 0===x[o][a]){x[a][o]=[],_.x=(r[3*o]-r[3*a])/p,_.y=(r[3*o+1]-r[3*a+1])/p,_.z=(r[3*o+2]-r[3*a+2])/p,s&&(m.x=(s[3*o]-s[3*a])/p,m.y=(s[3*o+1]-s[3*a+1])/p,m.z=(s[3*o+2]-s[3*a+2])/p),n&&(g.x=(n[2*o]-n[2*a])/p,g.y=(n[2*o+1]-n[2*a+1])/p),x[a][o].push(a);for(let e=1;e<p;e++)x[a][o].push(r.length/3),r[T++]=r[3*a]+e*_.x,r[T++]=r[3*a+1]+e*_.y,r[T++]=r[3*a+2]+e*_.z,s&&(s[c++]=s[3*a]+e*m.x,s[c++]=s[3*a+1]+e*m.y,s[c++]=s[3*a+2]+e*m.z),n&&(n[h++]=n[2*a]+e*g.x,n[h++]=n[2*a+1]+e*g.y);x[a][o].push(o),x[o][a]=[],l=x[a][o].length;for(let e=0;e<l;e++)x[o][a][e]=x[a][o][l-1-e]}f[0][0]=i[e],f[1][0]=x[i[e]][i[e+1]][1],f[1][1]=x[i[e]][i[e+2]][1];for(let t=2;t<p;t++){f[t][0]=x[i[e]][i[e+1]][t],f[t][t]=x[i[e]][i[e+2]][t],_.x=(r[3*f[t][t]]-r[3*f[t][0]])/t,_.y=(r[3*f[t][t]+1]-r[3*f[t][0]+1])/t,_.z=(r[3*f[t][t]+2]-r[3*f[t][0]+2])/t,s&&(m.x=(s[3*f[t][t]]-s[3*f[t][0]])/t,m.y=(s[3*f[t][t]+1]-s[3*f[t][0]+1])/t,m.z=(s[3*f[t][t]+2]-s[3*f[t][0]+2])/t),n&&(g.x=(n[2*f[t][t]]-n[2*f[t][0]])/t,g.y=(n[2*f[t][t]+1]-n[2*f[t][0]+1])/t);for(let e=1;e<t;e++)f[t][e]=r.length/3,r[T++]=r[3*f[t][0]]+e*_.x,r[T++]=r[3*f[t][0]+1]+e*_.y,r[T++]=r[3*f[t][0]+2]+e*_.z,s&&(s[c++]=s[3*f[t][0]]+e*m.x,s[c++]=s[3*f[t][0]+1]+e*m.y,s[c++]=s[3*f[t][0]+2]+e*m.z),n&&(n[h++]=n[2*f[t][0]]+e*g.x,n[h++]=n[2*f[t][0]+1]+e*g.y)}f[p]=x[i[e+1]][i[e+2]],b.push(f[0][0],f[1][0],f[1][1]);for(let e=1;e<p;e++){let t;for(t=0;t<e;t++)b.push(f[e][t],f[e+1][t],f[e+1][t+1]),b.push(f[e][t],f[e+1][t+1],f[e][t+1]);b.push(f[e][t],f[e+1][t],f[e+1][t+1])}}t.indices=b,t.applyToMesh(this,this.isVertexBufferUpdatable(d.R.PositionKind))}else T.V.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){let e=p.P.ExtractFromMesh(this),t=e.uvs,i=e.indices,r=e.positions,n=e.colors,s=e.matricesIndices,a=e.matricesWeights,o=e.matricesIndicesExtra,l=e.matricesWeightsExtra;if(void 0===i||void 0===r||null===i||null===r)T.V.Warn("VertexData contains empty entries");else{let u,h,c=[],f=[],_=[],m=[],g=[],b=[],y=[],x=[],T=[],v=0,A={};for(let e=0;e<i.length;e+=3){h=[i[e],i[e+1],i[e+2]],T=[];for(let e=0;e<3;e++){T[e]="";for(let t=0;t<3;t++)1e-8>Math.abs(r[3*h[e]+t])&&(r[3*h[e]+t]=0),T[e]+=r[3*h[e]+t]+"|"}if(T[0]!=T[1]&&T[0]!=T[2]&&T[1]!=T[2])for(let e=0;e<3;e++){if(void 0===(u=A[T[e]])){A[T[e]]=v,u=v++;for(let t=0;t<3;t++)c.push(r[3*h[e]+t]);if(null!=n)for(let t=0;t<4;t++)m.push(n[4*h[e]+t]);if(null!=t)for(let i=0;i<2;i++)_.push(t[2*h[e]+i]);if(null!=s)for(let t=0;t<4;t++)g.push(s[4*h[e]+t]);if(null!=a)for(let t=0;t<4;t++)b.push(a[4*h[e]+t]);if(null!=o)for(let t=0;t<4;t++)y.push(o[4*h[e]+t]);if(null!=l)for(let t=0;t<4;t++)x.push(l[4*h[e]+t])}f.push(u)}}let S=[];p.P.ComputeNormals(c,f,S),e.positions=c,e.indices=f,e.normals=S,null!=t&&(e.uvs=_),null!=n&&(e.colors=m),null!=s&&(e.matricesIndices=g),null!=a&&(e.matricesWeights=b),null!=o&&(e.matricesIndicesExtra=y),null!=a&&(e.matricesWeightsExtra=x),e.applyToMesh(this,this.isVertexBufferUpdatable(d.R.PositionKind))}}static _instancedMeshFactory(e,t){throw(0,A.n)("InstancedMesh")}static _PhysicsImpostorParser(e,t,i){throw(0,A.n)("PhysicsImpostor")}createInstance(e){let t=D._instancedMeshFactory(e,this);return t.parent=this.parent,t}synchronizeInstances(){for(let e=0;e<this.instances.length;e++)this.instances[e]._syncSubMeshes();return this}optimizeIndices(e){let t=this.getIndices(),i=this.getVerticesData(d.R.PositionKind);if(!i||!t)return this;let r=[];for(let e=0;e<i.length;e+=3)r.push(u.Pq.FromArray(i,e));let s=[];return n.LV.SyncAsyncForLoop(r.length,40,e=>{let t=r.length-1-e,i=r[t];for(let e=0;e<t;++e){let n=r[e];if(i.equals(n)){s[t]=e;break}}},()=>{for(let e=0;e<t.length;++e)t[e]=s[t[e]]||t[e];let i=this.subMeshes.slice(0);this.setIndices(t),this.subMeshes=i,e&&e(this)}),this}serialize(e={}){e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,e.type=this.getClassName(),a.Y&&a.Y.HasTags(this)&&(e.tags=a.Y.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.alwaysSelectAsActiveMesh=this.alwaysSelectAsActiveMesh,e.checkCollisions=this.checkCollisions,e.ellipsoid=this.ellipsoid.asArray(),e.ellipsoidOffset=this.ellipsoidOffset.asArray(),e.doNotSyncBoundingInfo=this.doNotSyncBoundingInfo,e.isBlocker=this.isBlocker,e.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(e),e.isUnIndexed=this.isUnIndexed;let t=this._geometry;if(t&&this.subMeshes){e.geometryUniqueId=t.uniqueId,e.geometryId=t.id,e.subMeshes=[];for(let t=0;t<this.subMeshes.length;t++){let i=this.subMeshes[t];e.subMeshes.push({materialIndex:i.materialIndex,verticesStart:i.verticesStart,verticesCount:i.verticesCount,indexStart:i.indexStart,indexCount:i.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialUniqueId=this.material.uniqueId,e.materialId=this.material.id):(this.material=null,e.materialUniqueId=this._scene.defaultMaterial.uniqueId,e.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(S.v.NAME_PHYSICSENGINE)){let t=this.getPhysicsImpostor();t&&(e.physicsMass=t.getParam("mass"),e.physicsFriction=t.getParam("friction"),e.physicsRestitution=t.getParam("mass"),e.physicsImpostor=t.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(let t=0;t<this.instances.length;t++){let i=this.instances[t];if(i.doNotSerialize)continue;let r={name:i.name,id:i.id,isEnabled:i.isEnabled(!1),isVisible:i.isVisible,isPickable:i.isPickable,checkCollisions:i.checkCollisions,position:i.position.asArray(),scaling:i.scaling.asArray()};if(i.parent&&i.parent._serializeAsParent(r),i.rotationQuaternion?r.rotationQuaternion=i.rotationQuaternion.asArray():i.rotation&&(r.rotation=i.rotation.asArray()),this.getScene()._getComponent(S.v.NAME_PHYSICSENGINE)){let e=i.getPhysicsImpostor();e&&(r.physicsMass=e.getParam("mass"),r.physicsFriction=e.getParam("friction"),r.physicsRestitution=e.getParam("mass"),r.physicsImpostor=e.type)}i.metadata&&(r.metadata=i.metadata),i.actionManager&&(r.actions=i.actionManager.serialize(i.name)),e.instances.push(r),x.p.AppendSerializedAnimations(i,r),r.ranges=i.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){let t={data:{},sizes:{},strides:{}};for(let e in this._userThinInstanceBuffersStorage.data)t.data[e]=Array.from(this._userThinInstanceBuffersStorage.data[e]),t.sizes[e]=this._userThinInstanceBuffersStorage.sizes[e],t.strides[e]=this._userThinInstanceBuffersStorage.strides[e];e.thinInstances.userThinInstance=t}return x.p.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name)),e}_syncGeometryWithMorphTargetManager(){if(!this.geometry)return;this._markSubMeshesAsAttributesDirty();let e=this._internalAbstractMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices()){T.V.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),this.morphTargetManager=null;return}if(e.isUsingTextureForTargets)return;for(let t=0;t<e.numInfluencers;t++){let i=e.getActiveTarget(t),r=i.getPositions();if(!r)return void T.V.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(d.R.PositionKind+t,r,!1,3);let n=i.getNormals();n&&this.geometry.setVerticesData(d.R.NormalKind+t,n,!1,3);let s=i.getTangents();s&&this.geometry.setVerticesData(d.R.TangentKind+t,s,!1,3);let a=i.getUVs();a&&this.geometry.setVerticesData(d.R.UVKind+"_"+t,a,!1,2);let o=i.getUV2s();o&&this.geometry.setVerticesData(d.R.UV2Kind+"_"+t,o,!1,2);let l=i.getColors();l&&this.geometry.setVerticesData(d.R.ColorKind+t,l,!1,4)}}else{let e=0;for(;this.geometry.isVerticesDataPresent(d.R.PositionKind+e);)this.geometry.removeVerticesData(d.R.PositionKind+e),this.geometry.isVerticesDataPresent(d.R.NormalKind+e)&&this.geometry.removeVerticesData(d.R.NormalKind+e),this.geometry.isVerticesDataPresent(d.R.TangentKind+e)&&this.geometry.removeVerticesData(d.R.TangentKind+e),this.geometry.isVerticesDataPresent(d.R.UVKind+e)&&this.geometry.removeVerticesData(d.R.UVKind+"_"+e),this.geometry.isVerticesDataPresent(d.R.UV2Kind+e)&&this.geometry.removeVerticesData(d.R.UV2Kind+"_"+e),this.geometry.isVerticesDataPresent(d.R.ColorKind+e)&&this.geometry.removeVerticesData(d.R.ColorKind+e),e++}}static Parse(e,t,i){let r;if((r=e.type&&"LinesMesh"===e.type?D._LinesMeshParser(e,t):e.type&&"GroundMesh"===e.type?D._GroundMeshParser(e,t):e.type&&"GoldbergMesh"===e.type?D._GoldbergMeshParser(e,t):e.type&&"GreasedLineMesh"===e.type?D._GreasedLineMeshParser(e,t):e.type&&"TrailMesh"===e.type?D._TrailMeshParser(e,t):new D(e.name,t)).id=e.id,r._waitingParsedUniqueId=e.uniqueId,a.Y&&a.Y.AddTagsTo(r,e.tags),r.position=u.Pq.FromArray(e.position),void 0!==e.metadata&&(r.metadata=e.metadata),e.rotationQuaternion?r.rotationQuaternion=u.PT.FromArray(e.rotationQuaternion):e.rotation&&(r.rotation=u.Pq.FromArray(e.rotation)),r.scaling=u.Pq.FromArray(e.scaling),e.localMatrix?r.setPreTransformMatrix(u.uq.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(u.uq.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r.isVisible=e.isVisible,r.infiniteDistance=e.infiniteDistance,r.alwaysSelectAsActiveMesh=!!e.alwaysSelectAsActiveMesh,r.showBoundingBox=e.showBoundingBox,r.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(r.applyFog=e.applyFog),void 0!==e.pickable&&(r.isPickable=e.pickable),void 0!==e.alphaIndex&&(r.alphaIndex=e.alphaIndex),r.receiveShadows=e.receiveShadows,void 0!==e.billboardMode&&(r.billboardMode=e.billboardMode),void 0!==e.visibility&&(r.visibility=e.visibility),r.checkCollisions=e.checkCollisions,r.doNotSyncBoundingInfo=!!e.doNotSyncBoundingInfo,e.ellipsoid&&(r.ellipsoid=u.Pq.FromArray(e.ellipsoid)),e.ellipsoidOffset&&(r.ellipsoidOffset=u.Pq.FromArray(e.ellipsoidOffset)),null!=e.overrideMaterialSideOrientation&&(r.sideOrientation=e.overrideMaterialSideOrientation),void 0!==e.sideOrientation&&(r.sideOrientation=e.sideOrientation),void 0!==e.isBlocker&&(r.isBlocker=e.isBlocker),r._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(r._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.actions&&(r._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(r.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(r.overlayColor=h.v9.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(r.renderOverlay=e.renderOverlay),r.isUnIndexed=!!e.isUnIndexed,r.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+e.delayLoadingFile,r.buildBoundingInfo(u.Pq.FromArray(e.boundingBoxMinimum),u.Pq.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(r._binaryInfo=e._binaryInfo),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(d.R.UVKind),e.hasUVs2&&r._delayInfo.push(d.R.UV2Kind),e.hasUVs3&&r._delayInfo.push(d.R.UV3Kind),e.hasUVs4&&r._delayInfo.push(d.R.UV4Kind),e.hasUVs5&&r._delayInfo.push(d.R.UV5Kind),e.hasUVs6&&r._delayInfo.push(d.R.UV6Kind),e.hasColors&&r._delayInfo.push(d.R.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(d.R.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(d.R.MatricesWeightsKind),r._delayLoadingFunction=f.V._ImportGeometry,y.B.ForceFullSceneLoadingForIncremental&&r._checkDelayState()):f.V._ImportGeometry(e,r),e.materialUniqueId?r._waitingMaterialId=e.materialUniqueId:e.materialId&&(r._waitingMaterialId=e.materialId),e.morphTargetManagerId>-1&&(r._waitingMorphTargetManagerId=e.morphTargetManagerId),void 0!==e.skeletonId&&null!==e.skeletonId&&(r.skeleton=t.getLastSkeletonById(e.skeletonId),e.numBoneInfluencers&&(r.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(let t=0;t<e.animations.length;t++){let i=e.animations[t],n=(0,v.n9)("BABYLON.Animation");n&&r.animations.push(n.Parse(i))}c.b.ParseAnimationRanges(r,e,t)}if(e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?r.layerMask=Math.abs(parseInt(e.layerMask)):r.layerMask=0xfffffff,e.physicsImpostor&&(r.physicsImpostor=D._PhysicsImpostorParser(t,r,e)),e.lodMeshIds&&(r._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(let i=0;i<e.instances.length;i++){let n=e.instances[i],s=r.createInstance(n.name);if(n.id&&(s.id=n.id),a.Y&&(n.tags?a.Y.AddTagsTo(s,n.tags):a.Y.AddTagsTo(s,e.tags)),s.position=u.Pq.FromArray(n.position),void 0!==n.metadata&&(s.metadata=n.metadata),void 0!==n.parentId&&(s._waitingParentId=n.parentId),void 0!==n.parentInstanceIndex&&(s._waitingParentInstanceIndex=n.parentInstanceIndex),void 0!==n.isEnabled&&null!==n.isEnabled&&s.setEnabled(n.isEnabled),void 0!==n.isVisible&&null!==n.isVisible&&(s.isVisible=n.isVisible),void 0!==n.isPickable&&null!==n.isPickable&&(s.isPickable=n.isPickable),n.rotationQuaternion?s.rotationQuaternion=u.PT.FromArray(n.rotationQuaternion):n.rotation&&(s.rotation=u.Pq.FromArray(n.rotation)),s.scaling=u.Pq.FromArray(n.scaling),void 0!=n.checkCollisions&&null!=n.checkCollisions&&(s.checkCollisions=n.checkCollisions),void 0!=n.pickable&&null!=n.pickable&&(s.isPickable=n.pickable),void 0!=n.showBoundingBox&&null!=n.showBoundingBox&&(s.showBoundingBox=n.showBoundingBox),void 0!=n.showSubMeshesBoundingBox&&null!=n.showSubMeshesBoundingBox&&(s.showSubMeshesBoundingBox=n.showSubMeshesBoundingBox),void 0!=n.alphaIndex&&null!=n.showSubMeshesBoundingBox&&(s.alphaIndex=n.alphaIndex),n.physicsImpostor&&(s.physicsImpostor=D._PhysicsImpostorParser(t,s,n)),void 0!==n.actions&&(s._waitingData.actions=n.actions),n.animations){for(let e=0;e<n.animations.length;e++){let t=n.animations[e],i=(0,v.n9)("BABYLON.Animation");i&&s.animations.push(i.Parse(t))}c.b.ParseAnimationRanges(s,n,t),n.autoAnimate&&t.beginAnimation(s,n.autoAnimateFrom,n.autoAnimateTo,n.autoAnimateLoop,n.autoAnimateSpeed||1)}}if(e.thinInstances){let t=e.thinInstances;if(r.thinInstanceEnablePicking=!!t.enablePicking,t.matrixData?(r.thinInstanceSetBuffer("matrix",new Float32Array(t.matrixData),16,!1),r._thinInstanceDataStorage.matrixBufferSize=t.matrixBufferSize,r._thinInstanceDataStorage.instancesCount=t.instancesCount):r._thinInstanceDataStorage.matrixBufferSize=t.matrixBufferSize,e.thinInstances.userThinInstance){let t=e.thinInstances.userThinInstance;for(let e in t.data)r.thinInstanceSetBuffer(e,new Float32Array(t.data[e]),t.strides[e],!1),r._userThinInstanceBuffersStorage.sizes[e]=t.sizes[e]}}return r}setPositionsForCPUSkinning(){let e=this._internalMeshDataInfo;if(!e._sourcePositions){let t=this.getVerticesData(d.R.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(d.R.PositionKind)||this.setVerticesData(d.R.PositionKind,t,!0)}return e._sourcePositions}setNormalsForCPUSkinning(){let e=this._internalMeshDataInfo;if(!e._sourceNormals){let t=this.getVerticesData(d.R.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(d.R.NormalKind)||this.setVerticesData(d.R.NormalKind,t,!0)}return e._sourceNormals}applySkeleton(e){let t;if(!this.geometry||this.geometry._softwareSkinningFrameId==this.getScene().getFrameId()||(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(d.R.PositionKind)||!this.isVerticesDataPresent(d.R.MatricesIndicesKind)||!this.isVerticesDataPresent(d.R.MatricesWeightsKind)))return this;let i=this.isVerticesDataPresent(d.R.NormalKind),r=this._internalMeshDataInfo;if(!r._sourcePositions){let e=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=e}i&&!r._sourceNormals&&this.setNormalsForCPUSkinning();let n=this.getVerticesData(d.R.PositionKind);if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n));let s=this.getVerticesData(d.R.NormalKind);if(i){if(!s)return this;s instanceof Float32Array||(s=new Float32Array(s))}let a=this.getVerticesData(d.R.MatricesIndicesKind),o=this.getVerticesData(d.R.MatricesWeightsKind);if(!o||!a)return this;let l=this.numBoneInfluencers>4,h=l?this.getVerticesData(d.R.MatricesIndicesExtraKind):null,c=l?this.getVerticesData(d.R.MatricesWeightsExtraKind):null,p=e.getTransformMatrices(this),f=u.Pq.Zero(),_=new u.uq,m=new u.uq,g=0;for(let e=0;e<n.length;e+=3,g+=4){let d;for(t=0;t<4;t++)(d=o[g+t])>0&&(u.uq.FromFloat32ArrayToRefScaled(p,Math.floor(16*a[g+t]),d,m),_.addToSelf(m));if(l)for(t=0;t<4;t++)(d=c[g+t])>0&&(u.uq.FromFloat32ArrayToRefScaled(p,Math.floor(16*h[g+t]),d,m),_.addToSelf(m));u.Pq.TransformCoordinatesFromFloatsToRef(r._sourcePositions[e],r._sourcePositions[e+1],r._sourcePositions[e+2],_,f),f.toArray(n,e),i&&(u.Pq.TransformNormalFromFloatsToRef(r._sourceNormals[e],r._sourceNormals[e+1],r._sourceNormals[e+2],_,f),f.toArray(s,e)),_.reset()}return this.updateVerticesData(d.R.PositionKind,n),i&&this.updateVerticesData(d.R.NormalKind,s),this}static MinMax(e){let t=null,i=null;for(let r of e){let e=r.getBoundingInfo().boundingBox;t&&i?(t.minimizeInPlace(e.minimumWorld),i.maximizeInPlace(e.maximumWorld)):(t=e.minimumWorld.clone(),i=e.maximumWorld.clone())}return t&&i?{min:t,max:i}:{min:u.Pq.Zero(),max:u.Pq.Zero()}}static Center(e){let t=e instanceof Array?D.MinMax(e):e;return u.Pq.Center(t.min,t.max)}static MergeMeshes(e,t=!0,i,r,n,s){return(0,o.V1)(D._MergeMeshesCoroutine(e,t,i,r,n,s,!1))}static async MergeMeshesAsync(e,t=!0,i,r,n,s){return await (0,o.kj)(D._MergeMeshesCoroutine(e,t,i,r,n,s,!0),(0,o.VP)())}static*_MergeMeshesCoroutine(e,t=!0,i,r,n,s,a){let o;if(0===(e=e.filter(Boolean)).length)return null;if(!i){let t=0;for(o=0;o<e.length;o++)if((t+=e[o].getTotalVertices())>=65536)return T.V.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}s&&(n=!1);let l=[],u=[],h=[],c=e[0].sideOrientation;for(o=0;o<e.length;o++){let t=e[o];if(t.isAnInstance)return T.V.Warn("Cannot merge instance meshes."),null;if(c!==t.sideOrientation)return T.V.Warn("Cannot merge meshes with different sideOrientation values."),null;if(n&&h.push({start:0,count:t.getTotalIndices()}),s){let e=h.reduce((e,t)=>Math.max(e,t.start+t.count),0);if(t.material){let i=t.material;if(i instanceof b.F){for(let e=0;e<i.subMaterials.length;e++)0>l.indexOf(i.subMaterials[e])&&l.push(i.subMaterials[e]);for(let r=0;r<t.subMeshes.length;r++)u.push(l.indexOf(i.subMaterials[t.subMeshes[r].materialIndex])),h.push({start:e+t.subMeshes[r].indexStart,count:t.subMeshes[r].indexCount})}else{0>l.indexOf(i)&&l.push(i);for(let r=0;r<t.subMeshes.length;r++)u.push(l.indexOf(i)),h.push({start:e+t.subMeshes[r].indexStart,count:t.subMeshes[r].indexCount})}}else for(let i=0;i<t.subMeshes.length;i++)u.push(0),h.push({start:e+t.subMeshes[i].indexStart,count:t.subMeshes[i].indexCount})}}let d=e[0],f=e=>{let t=e.computeWorldMatrix(!0);return{vertexData:p.P.ExtractFromMesh(e,!1,!1),transform:t}},{vertexData:_,transform:g}=f(d);a&&(yield);let y=Array(e.length-1);for(let t=1;t<e.length;t++)y[t-1]=f(e[t]),a&&(yield);let x=_._mergeCoroutine(g,y,i,a,!t),v=x.next();for(;!v.done;)a&&(yield),v=x.next();let A=v.value;r||(r=new D(d.name+"_merged",d.getScene()));let S=A._applyToCoroutine(r,void 0,a),E=S.next();for(;!E.done;)a&&(yield),E=S.next();if(r.checkCollisions=d.checkCollisions,r.sideOrientation=d.sideOrientation,t)for(o=0;o<e.length;o++)e[o].dispose();if(n||s){for(r.releaseSubMeshes(),o=0;o<h.length;)m.K.CreateFromIndices(0,h[o].start,h[o].count,r,void 0,!1),o++;for(let e of r.subMeshes)e.refreshBoundingInfo();r.computeWorldMatrix(!0)}if(s){let e=new b.F(d.name+"_merged",d.getScene());e.subMaterials=l;for(let e=0;e<r.subMeshes.length;e++)r.subMeshes[e].materialIndex=u[e];r.material=e}else r.material=d.material;return r}addInstance(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)}removeInstance(e){let t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){let e=this.instances[this.instances.length-1];this.instances[t]=e,e._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===g.i.CounterClockWiseSideOrientation}_getRenderingFillMode(e){let t=this.getScene();return t.forcePointsCloud?g.i.PointFillMode:t.forceWireframe?g.i.WireFrameFillMode:this.overrideRenderingFillMode??e}setMaterialByID(e){return this.setMaterialById(e)}static CreateRibbon(e,t,i,r,n,s,a,o,l){throw Error("Import MeshBuilder to populate this function")}static CreateDisc(e,t,i,r,n,s){throw Error("Import MeshBuilder to populate this function")}static CreateBox(e,t,i,r,n){throw Error("Import MeshBuilder to populate this function")}static CreateSphere(e,t,i,r,n,s){throw Error("Import MeshBuilder to populate this function")}static CreateHemisphere(e,t,i,r){throw Error("Import MeshBuilder to populate this function")}static CreateCylinder(e,t,i,r,n,s,a,o,l){throw Error("Import MeshBuilder to populate this function")}static CreateTorus(e,t,i,r,n,s,a){throw Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(e,t,i,r,n,s,a,o,l,u){throw Error("Import MeshBuilder to populate this function")}static CreateLines(e,t,i,r,n){throw Error("Import MeshBuilder to populate this function")}static CreateDashedLines(e,t,i,r,n,s,a,o){throw Error("Import MeshBuilder to populate this function")}static CreatePolygon(e,t,i,r,n,s,a){throw Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(e,t,i,r,n,s,a,o){throw Error("Import MeshBuilder to populate this function")}static ExtrudeShape(e,t,i,r,n,s,a,o,l,u){throw Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(e,t,i,r,n,s,a,o,l,u,h,c){throw Error("Import MeshBuilder to populate this function")}static CreateLathe(e,t,i,r,n,s,a){throw Error("Import MeshBuilder to populate this function")}static CreatePlane(e,t,i,r,n){throw Error("Import MeshBuilder to populate this function")}static CreateGround(e,t,i,r,n,s){throw Error("Import MeshBuilder to populate this function")}static CreateTiledGround(e,t,i,r,n,s,a,o,l){throw Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(e,t,i,r,n,s,a,o,l,u,h){throw Error("Import MeshBuilder to populate this function")}static CreateTube(e,t,i,r,n,s,a,o,l,u){throw Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(e,t,i){throw Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(e,t,i){throw Error("Import MeshBuilder to populate this function")}static CreateDecal(e,t,i,r,n,s){throw Error("Import MeshBuilder to populate this function")}static CreateCapsule(e,t,i){throw Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(e){throw Error("Import MeshBuilder to populate this function")}}D.FRONTSIDE=p.P.FRONTSIDE,D.BACKSIDE=p.P.BACKSIDE,D.DOUBLESIDE=p.P.DOUBLESIDE,D.DEFAULTSIDE=p.P.DEFAULTSIDE,D.NO_CAP=0,D.CAP_START=1,D.CAP_END=2,D.CAP_ALL=3,D.NO_FLIP=0,D.FLIP_TILE=1,D.ROTATE_TILE=2,D.FLIP_ROW=3,D.ROTATE_ROW=4,D.FLIP_N_ROTATE_TILE=5,D.FLIP_N_ROTATE_ROW=6,D.CENTER=0,D.LEFT=1,D.RIGHT=2,D.TOP=3,D.BOTTOM=4,D.INSTANCEDMESH_SORT_TRANSPARENT=!1,D._GroundMeshParser=(e,t)=>{throw(0,A.n)("GroundMesh")},D._GoldbergMeshParser=(e,t)=>{throw(0,A.n)("GoldbergMesh")},D._LinesMeshParser=(e,t)=>{throw(0,A.n)("LinesMesh")},D._GreasedLineMeshParser=(e,t)=>{throw(0,A.n)("GreasedLineMesh")},D._GreasedLineRibbonMeshParser=(e,t)=>{throw(0,A.n)("GreasedLineRibbonMesh")},D._TrailMeshParser=(e,t)=>{throw(0,A.n)("TrailMesh")},(0,v.Y5)("BABYLON.Mesh",D)},88483(e,t,i){var r=i(70134),n=i(5088);n.K.prototype._projectOnTrianglesToRef=function(e,t,i,n,s,a){let o=r.AA.Vector3["0"],l=r.AA.Vector3["1"],u=Infinity;for(let a=this.indexStart;a<this.indexStart+this.indexCount-(3-n);a+=n){let n=i[a],h=i[a+1],c=i[a+2];if(s&&0xffffffff===c){a+=2;continue}let d=t[n],p=t[h],f=t[c];if(!d||!p||!f)continue;let _=r.Pq.ProjectOnTriangleToRef(e,d,p,f,l);_<u&&(o.copyFrom(l),u=_)}return a.copyFrom(o),u},n.K.prototype._projectOnUnIndexedTrianglesToRef=function(e,t,i,n){let s=r.AA.Vector3["0"],a=r.AA.Vector3["1"],o=Infinity;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=3){let n=t[i],l=t[i+1],u=t[i+2],h=r.Pq.ProjectOnTriangleToRef(e,n,l,u,a);h<o&&(s.copyFrom(a),o=h)}return n.copyFrom(s),o},n.K.prototype.projectToRef=function(e,t,i,r){let n=this.getMaterial();if(!n)return -1;let s=3,a=!1;switch(n.fillMode){case 3:case 5:case 6:case 8:return -1;case 7:s=1,a=!0}return 4===n.fillMode?-1:!i.length&&this._mesh._unIndexed?this._projectOnUnIndexedTrianglesToRef(e,t,i,r):this._projectOnTrianglesToRef(e,t,i,s,a,r)}},97878(e,t,i){var r=i(66886),n=i(95435),s=i(70134),a=i(31656),o=i(53956);r.e.prototype.thinInstanceAdd=function(e,t=!0){if(!this.getScene().getEngine().getCaps().instancedArrays)return a.V.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(e)?e.length:1);let i=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(e))for(let i=0;i<e.length;++i)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e[i],i===e.length-1&&t);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e,t);return i},r.e.prototype.thinInstanceAddSelf=function(e=!0){return this.thinInstanceAdd(s.uq.IdentityReadOnly,e)},r.e.prototype.thinInstanceRegisterAttribute=function(e,t){e===n.R.ColorKind&&(e=n.R.ColorInstanceKind),this.removeVerticesData(e),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[e]=t,this._userThinInstanceBuffersStorage.sizes[e]=t*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[e]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[e]),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new n.R(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])},r.e.prototype.thinInstanceSetMatrixAt=function(e,t,i=!0){if(!this._thinInstanceDataStorage.matrixData||e>=this._thinInstanceDataStorage.instancesCount)return!1;let r=this._thinInstanceDataStorage.matrixData;return t.copyToArray(r,16*e),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[e]=t),i&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},r.e.prototype.thinInstanceSetAttributeAt=function(e,t,i,r=!0){return e===n.R.ColorKind&&(e=n.R.ColorInstanceKind),!!this._userThinInstanceBuffersStorage&&!!this._userThinInstanceBuffersStorage.data[e]&&!(t>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(e,0),this._userThinInstanceBuffersStorage.data[e].set(i,t*this._userThinInstanceBuffersStorage.strides[e]),r&&this.thinInstanceBufferUpdated(e),!0)},Object.defineProperty(r.e.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(e){let t=this._thinInstanceDataStorage.matrixData??this.source?._thinInstanceDataStorage.matrixData;e<=(t?t.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=e)},enumerable:!0,configurable:!0}),r.e.prototype._thinInstanceCreateMatrixBuffer=function(e,t,i=!0){let r=new n.h(this.getEngine(),t,!i,16,!1,!0);for(let t=0;t<4;t++)this.setVerticesBuffer(r.createVertexBuffer(e+t,4*t,4));return r},r.e.prototype.thinInstanceSetBuffer=function(e,t,i=0,r=!0){if(i=i||16,"matrix"===e)this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=t?t.length:32*i,this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.worldMatrices=null,null!==t?(this._thinInstanceDataStorage.instancesCount=t.length/i,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",t,r),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo());else if("previousMatrix"===e)this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=t,null!==t&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",t,r));else if("splatIndex"===e&&t){this._thinInstanceInitializeUserStorage(),this._thinInstanceDataStorage.instancesCount=t.length/i,this._userThinInstanceBuffersStorage.data[e]=t,this._userThinInstanceBuffersStorage.strides[e]=i,this._userThinInstanceBuffersStorage.sizes[e]=t.length;let r=new n.h(this.getEngine(),t,!0,16,!1,!0);this._thinInstanceDataStorage.matrixBuffer=r;for(let t=0;t<4;t++)this.setVerticesBuffer(r.createVertexBuffer(e+t,4*t,4))}else e===n.R.ColorKind&&(e=n.R.ColorInstanceKind),null===t?this._userThinInstanceBuffersStorage?.data[e]&&(this.removeVerticesData(e),delete this._userThinInstanceBuffersStorage.data[e],delete this._userThinInstanceBuffersStorage.strides[e],delete this._userThinInstanceBuffersStorage.sizes[e],delete this._userThinInstanceBuffersStorage.vertexBuffers[e]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[e]=t,this._userThinInstanceBuffersStorage.strides[e]=i,this._userThinInstanceBuffersStorage.sizes[e]=t.length,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new n.R(this.getEngine(),t,e,!r,!1,i,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))},r.e.prototype.thinInstanceBufferUpdated=function(e){"matrix"===e?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._thinInstanceDataStorage.matrixBuffer?.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount)):"previousMatrix"===e?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._thinInstanceDataStorage.previousMatrixBuffer?.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)):"splatIndex"===e?this._thinInstanceDataStorage.matrixBuffer?.updateDirectly(this._userThinInstanceBuffersStorage.data[e],0,this._thinInstanceDataStorage.instancesCount):(e===n.R.ColorKind&&(e=n.R.ColorInstanceKind),this._userThinInstanceBuffersStorage?.vertexBuffers[e]&&(this.thinInstanceAllowAutomaticStaticBufferRecreation&&!this._userThinInstanceBuffersStorage.vertexBuffers[e].isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(this._userThinInstanceBuffersStorage.data[e],0)))},r.e.prototype.thinInstancePartialBufferUpdate=function(e,t,i){"matrix"===e?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t,i):(e===n.R.ColorKind&&(e=n.R.ColorInstanceKind),this._userThinInstanceBuffersStorage?.vertexBuffers[e]&&this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(t,i))},r.e.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];let e=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let t=0;t<this._thinInstanceDataStorage.instancesCount;++t)this._thinInstanceDataStorage.worldMatrices[t]=s.uq.FromArray(e,16*t)}return this._thinInstanceDataStorage.worldMatrices},r.e.prototype.thinInstanceRefreshBoundingInfo=function(e=!1,t=!1,i=!1){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;let r=this._thinInstanceDataStorage.boundingVectors;if(e||!this.rawBoundingInfo){r.length=0,this.refreshBoundingInfo(t,i);let e=this.getBoundingInfo();this.rawBoundingInfo=new o.j(e.minimum,e.maximum)}let n=this.getBoundingInfo(),a=this._thinInstanceDataStorage.matrixData;if(0===r.length)for(let e=0;e<n.boundingBox.vectors.length;++e)r.push(n.boundingBox.vectors[e].clone());s.AA.Vector3["0"].setAll(1/0),s.AA.Vector3["1"].setAll(-1/0);for(let e=0;e<this._thinInstanceDataStorage.instancesCount;++e){s.uq.FromArrayToRef(a,16*e,s.AA.Matrix["0"]);for(let e=0;e<r.length;++e)s.Pq.TransformCoordinatesToRef(r[e],s.AA.Matrix["0"],s.AA.Vector3["2"]),s.AA.Vector3["0"].minimizeInPlace(s.AA.Vector3["2"]),s.AA.Vector3["1"].maximizeInPlace(s.AA.Vector3["2"])}n.reConstruct(s.AA.Vector3["0"],s.AA.Vector3["1"]),this._updateBoundingInfo()},r.e.prototype._thinInstanceRecreateBuffer=function(e,t=!0){"matrix"===e?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,t)):"previousMatrix"===e?this._scene.needsPreviousWorldMatrices&&(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,t)):(e===n.R.ColorKind&&(e=n.R.ColorInstanceKind),this._userThinInstanceBuffersStorage.vertexBuffers[e]?.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new n.R(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!t,!1,this._userThinInstanceBuffersStorage.strides[e],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))},r.e.prototype._thinInstanceUpdateBufferSize=function(e,t=1){e===n.R.ColorKind&&(e=n.R.ColorInstanceKind);let i="matrix"===e;if(!i&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[e]))return;let r=i?16:this._userThinInstanceBuffersStorage.strides[e],s=i?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[e],a=i?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[e],o=(this._thinInstanceDataStorage.instancesCount+t)*r,l=s;for(;l<o;)l*=2;if(!a||s!=l){if(a){let e=new Float32Array(l);e.set(a,0),a=e}else a=new Float32Array(l);i?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",a,!1),this._thinInstanceDataStorage.matrixData=a,this._thinInstanceDataStorage.matrixBufferSize=l,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",a,!1))):(this._userThinInstanceBuffersStorage.vertexBuffers[e]?.dispose(),this._userThinInstanceBuffersStorage.data[e]=a,this._userThinInstanceBuffersStorage.sizes[e]=l,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new n.R(this.getEngine(),a,e,!0,!1,r,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))}},r.e.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},r.e.prototype._disposeThinInstanceSpecificData=function(){this._thinInstanceDataStorage?.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null),this._thinInstanceDataStorage?.previousMatrixBuffer&&(this._thinInstanceDataStorage.previousMatrixBuffer.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null)}},60871(e,t,i){i.d(t,{V:()=>h});var r=i(39545),n=i(61646),s=i(57176),a=i(52969),o=i(70134),l=i(45973),u=i(27371);class h extends l.b{get billboardMode(){return this._billboardMode}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._cache.useBillboardPosition=(this._billboardMode&h.BILLBOARDMODE_USE_POSITION)!=0)}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)}constructor(e,t=null,i=!0){super(e,t,!1),this._forward=new o.Pq(0,0,1),this._up=new o.Pq(0,1,0),this._right=new o.Pq(1,0,0),this._position=o.Pq.Zero(),this._rotation=o.Pq.Zero(),this._rotationQuaternion=null,this._scaling=o.Pq.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=h.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=o.uq.Zero(),this._usePivotMatrix=!1,this._absolutePosition=o.Pq.Zero(),this._absoluteScaling=o.Pq.Zero(),this._absoluteRotationQuaternion=o.PT.Identity(),this._pivotMatrix=o.uq.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new a.cP,this._nonUniformScaling=!1,i&&this.getScene().addTransformNode(this)}getClassName(){return"TransformNode"}get position(){return this._position}set position(e){this._position=e,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(e){this._rotation=e,this._rotationQuaternion=null,this._markAsDirtyInternal()}get scaling(){return this._scaling}set scaling(e){this._scaling=e,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){!this._isDirty&&(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return o.Pq.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return o.Pq.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return o.Pq.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(e){return this._poseMatrix?this._poseMatrix.copyFrom(e):this._poseMatrix=e.clone(),this}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=o.uq.Identity()),this._poseMatrix}_isSynchronized(){let e=this._cache;return this._billboardMode===e.billboardMode&&this._billboardMode===h.BILLBOARDMODE_NONE&&!e.pivotMatrixUpdated&&!this._infiniteDistance&&!this._position._isDirty&&!this._scaling._isDirty&&(!this._rotationQuaternion||!this._rotationQuaternion._isDirty)&&!this._rotation._isDirty&&!0}_initCache(){super._initCache();let e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1,e.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(e){return this.setPivotMatrix(e,!1)}setPivotMatrix(e,t=!0){return this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=o.uq.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(e=null,t,i){let r=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);for(let e of(r&&i&&i(this,r),this.getChildTransformNodes(!0)))e.instantiateHierarchy(r,t,i);return r}freezeWorldMatrix(e=null,t=!1){return e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||o.PT.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}setAbsolutePosition(e){let t,i,r;if(!e)return this;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],i=arguments[1],r=arguments[2]}else t=e.x,i=e.y,r=e.z;if(this.parent){let e=o.AA.Matrix["0"];this.parent.getWorldMatrix().invertToRef(e),o.Pq.TransformCoordinatesFromFloatsToRef(t,i,r,e,this.position)}else this.position.x=t,this.position.y=i,this.position.z=r;return this._absolutePosition.copyFrom(e),this}setPositionWithLocalVector(e){return this.computeWorldMatrix(),this.position=o.Pq.TransformNormal(e,this._localMatrix),this}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();let e=o.AA.Matrix["0"];return this._localMatrix.invertToRef(e),o.Pq.TransformNormal(this.position,e)}locallyTranslate(e){return this.computeWorldMatrix(!0),this.position=o.Pq.TransformCoordinates(e,this._localMatrix),this}lookAt(e,t=0,i=0,r=0,n=0){let s=h._LookAtVectorCache,a=0===n?this.position:this.getAbsolutePosition();if(e.subtractToRef(a,s),this.setDirection(s,t,i,r),1===n&&this.parent)if(this.rotationQuaternion){let e=o.AA.Matrix["0"];this.rotationQuaternion.toRotationMatrix(e);let t=o.AA.Matrix["1"];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.invert(),e.multiplyToRef(t,e),this.rotationQuaternion.fromRotationMatrix(e)}else{let e=o.AA.Quaternion["0"];o.PT.FromEulerVectorToRef(this.rotation,e);let t=o.AA.Matrix["0"];e.toRotationMatrix(t);let i=o.AA.Matrix["1"];this.parent.getWorldMatrix().getRotationMatrixToRef(i),i.invert(),t.multiplyToRef(i,t),e.fromRotationMatrix(t),e.toEulerAnglesToRef(this.rotation)}return this}getDirection(e){let t=o.Pq.Zero();return this.getDirectionToRef(e,t),t}getDirectionToRef(e,t){return o.Pq.TransformNormalToRef(e,this.getWorldMatrix(),t),this}setDirection(e,t=0,i=0,r=0){let n=-Math.atan2(e.z,e.x)+Math.PI/2,s=Math.sqrt(e.x*e.x+e.z*e.z),a=-Math.atan2(e.y,s);return this.rotationQuaternion?o.PT.RotationYawPitchRollToRef(n+t,a+i,r,this.rotationQuaternion):(this.rotation.x=a+i,this.rotation.y=n+t,this.rotation.z=r),this}setPivotPoint(e,t=0){0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);let i=this.getWorldMatrix();if(1==t){let t=o.AA.Matrix["0"];i.invertToRef(t),e=o.Pq.TransformCoordinates(e,t)}return this.setPivotMatrix(o.uq.Translation(-e.x,-e.y,-e.z),!0)}getPivotPoint(){let e=o.Pq.Zero();return this.getPivotPointToRef(e),e}getPivotPointToRef(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){let e=o.Pq.Zero();return this.getAbsolutePivotPointToRef(e),e}getAbsolutePivotPointToRef(e){return this.getPivotPointToRef(e),o.Pq.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this}markAsDirty(e){if(this._isDirty)return this;if(this._children)for(let t of this._children)t.markAsDirty(e);return super.markAsDirty(e)}setParent(e,t=!1,i=!1){if(!e&&!this.parent)return this;let r=o.AA.Quaternion["0"],n=o.AA.Vector3["0"],s=o.AA.Vector3["1"],a=o.AA.Matrix["1"];o.uq.IdentityToRef(a);let l=o.AA.Matrix["0"];this.computeWorldMatrix(!0);let u=this.rotationQuaternion;return u||(u=h._TmpRotation,o.PT.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,u)),o.uq.ComposeToRef(this.scaling,u,this.position,l),this.parent&&l.multiplyToRef(this.parent.computeWorldMatrix(!0),l),e&&(e.computeWorldMatrix(!0).invertToRef(a),l.multiplyToRef(a,l)),l.decompose(s,r,n,t?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(r):r.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(s),this.position.copyFrom(n),this.parent=e,i&&this.setPivotMatrix(o.uq.Identity()),this}addChild(e,t=!1){return e.setParent(this,t),this}removeChild(e,t=!1){return e.parent!==this||e.setParent(null,t),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)}attachToBone(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(!0),0>e.getFinalMatrix().determinant()&&(this.scalingDeterminant*=-1),this}detachFromBone(e=!1){return this.parent?(0>this.parent.getWorldMatrix().determinant()&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,e?this.parent=this._currentParentWhenAttachingToBone:this.parent=null):e&&(this.parent=this._currentParentWhenAttachingToBone),this}rotate(e,t,i){let r;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&0!==i){if(this.parent){let i=this.parent.getWorldMatrix(),r=o.AA.Matrix["0"];i.invertToRef(r),e=o.Pq.TransformNormal(e,r),0>i.determinant()&&(t*=-1)}(r=o.PT.RotationAxisToRef(e,t,h._RotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else r=o.PT.RotationAxisToRef(e,t,h._RotationAxisCache),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion);return this}rotateAround(e,t,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=o.PT.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));let r=o.AA.Vector3["0"],n=o.AA.Vector3["1"],s=o.AA.Vector3["2"],a=o.AA.Quaternion["0"],l=o.AA.Matrix["0"],u=o.AA.Matrix["1"],h=o.AA.Matrix["2"],c=o.AA.Matrix["3"];return e.subtractToRef(this.position,r),o.uq.TranslationToRef(r.x,r.y,r.z,l),o.uq.TranslationToRef(-r.x,-r.y,-r.z,u),o.uq.RotationAxisToRef(t,i,h),u.multiplyToRef(h,c),c.multiplyToRef(l,c),c.decompose(n,a,s),this.position.addInPlace(s),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(e,t,i){let r=e.scale(t);if(i&&0!==i)this.setAbsolutePosition(this.getAbsolutePosition().add(r));else{let e=this.getPositionExpressedInLocalSpace().add(r);this.setPositionWithLocalVector(e)}return this}addRotation(e,t,i){let r;this.rotationQuaternion?r=this.rotationQuaternion:(r=o.AA.Quaternion["1"],o.PT.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,r));let n=o.AA.Quaternion["0"];return o.PT.RotationYawPitchRollToRef(t,e,i,n),r.multiplyInPlace(n),this.rotationQuaternion||r.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==h.BILLBOARDMODE_NONE}computeWorldMatrix(e=!1,t=null){let i;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;let r=this.getScene().getRenderId();if(!this._isDirty&&!e&&(this._currentRenderId===r||this.isSynchronized()))return this._currentRenderId=r,this._worldMatrix;t=t||this.getScene().activeCamera,this._updateCache();let n=this._cache;n.pivotMatrixUpdated=!1,n.billboardMode=this.billboardMode,n.infiniteDistance=this.infiniteDistance,n.parent=this._parentNode,this._currentRenderId=r,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;let s=this._getEffectiveParent(),a=h._TmpScaling,l=this._position;if(this._infiniteDistance&&!this.parent&&t){let e=t.getWorldMatrix(),i=new o.Pq(e.m[12],e.m[13],e.m[14]);(l=h._TmpTranslation).copyFromFloats(this._position.x+i.x,this._position.y+i.y,this._position.z+i.z)}if(a.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,i=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(o.PT.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(i=h._TmpRotation,o.PT.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,i)),this._usePivotMatrix){let e=o.AA.Matrix["1"];o.uq.ScalingToRef(a.x,a.y,a.z,e);let t=o.AA.Matrix["0"];i.toRotationMatrix(t),this._pivotMatrix.multiplyToRef(e,o.AA.Matrix["4"]),o.AA.Matrix["4"].multiplyToRef(t,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(l.x,l.y,l.z)}else o.uq.ComposeToRef(a,i,l,this._localMatrix);if(s&&s.getWorldMatrix){if(e&&s.computeWorldMatrix(e),this.billboardMode){if(this._transformToBoneReferal){let e=this.parent;e.getSkeleton().prepare(),e.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),o.AA.Matrix["7"])}else o.AA.Matrix["7"].copyFrom(s.getWorldMatrix());let e=o.AA.Vector3["5"],t=o.AA.Vector3["6"],i=o.AA.Quaternion["0"];o.AA.Matrix["7"].decompose(t,i,e),o.uq.ScalingToRef(t.x,t.y,t.z,o.AA.Matrix["7"]),o.AA.Matrix["7"].setTranslation(e),h.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(i,e),this._localMatrix.setTranslation(e)),this._localMatrix.multiplyToRef(o.AA.Matrix["7"],this._worldMatrix)}else if(this._transformToBoneReferal){let e=this.parent;e.getSkeleton().prepare(),this._localMatrix.multiplyToRef(e.getFinalMatrix(),o.AA.Matrix["6"]),o.AA.Matrix["6"].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(s.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(t&&this.billboardMode)if(n.useBillboardPosition){let e=o.AA.Vector3["0"];this._worldMatrix.getTranslationToRef(e);let i=t.globalPosition;this._worldMatrix.invertToRef(o.AA.Matrix["1"]);let r=o.AA.Vector3["1"];o.Pq.TransformCoordinatesToRef(i,o.AA.Matrix["1"],r),r.normalize();let n=-Math.atan2(r.z,r.x)+Math.PI/2,s=Math.sqrt(r.x*r.x+r.z*r.z),a=-Math.atan2(r.y,s);if(o.PT.RotationYawPitchRollToRef(n,a,0,o.AA.Quaternion["0"]),(this.billboardMode&h.BILLBOARDMODE_ALL)!==h.BILLBOARDMODE_ALL){let e=o.AA.Vector3["1"];o.AA.Quaternion["0"].toEulerAnglesToRef(e),(this.billboardMode&h.BILLBOARDMODE_X)!==h.BILLBOARDMODE_X&&(e.x=0),(this.billboardMode&h.BILLBOARDMODE_Y)!==h.BILLBOARDMODE_Y&&(e.y=0),(this.billboardMode&h.BILLBOARDMODE_Z)!==h.BILLBOARDMODE_Z&&(e.z=0),o.uq.RotationYawPitchRollToRef(e.y,e.x,e.z,o.AA.Matrix["0"])}else o.uq.FromQuaternionToRef(o.AA.Quaternion["0"],o.AA.Matrix["0"]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(o.AA.Matrix["0"],this._worldMatrix),this._worldMatrix.setTranslation(o.AA.Vector3["0"])}else{let e=o.AA.Vector3["0"];this._worldMatrix.getTranslationToRef(e),o.AA.Matrix["1"].copyFrom(t.getViewMatrix());let i=this.getScene().useRightHandedSystem;if(i&&o.AA.Matrix["1"].multiplyToRef(h._TmpRHRestore,o.AA.Matrix["1"]),o.AA.Matrix["1"].setTranslationFromFloats(0,0,0),o.AA.Matrix["1"].invertToRef(o.AA.Matrix["0"]),(this.billboardMode&h.BILLBOARDMODE_ALL)!==h.BILLBOARDMODE_ALL){o.AA.Matrix["0"].decompose(void 0,o.AA.Quaternion["0"],void 0);let e=o.AA.Vector3["1"];o.AA.Quaternion["0"].toEulerAnglesToRef(e),(this.billboardMode&h.BILLBOARDMODE_X)!==h.BILLBOARDMODE_X&&(e.x=0),(this.billboardMode&h.BILLBOARDMODE_Y)!==h.BILLBOARDMODE_Y&&(e.y=0),(this.billboardMode&h.BILLBOARDMODE_Z)!==h.BILLBOARDMODE_Z&&(e.z=0),i&&(e.y+=Math.PI),o.uq.RotationYawPitchRollToRef(e.y,e.x,e.z,o.AA.Matrix["0"])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(o.AA.Matrix["0"],this._worldMatrix),this._worldMatrix.setTranslation(o.AA.Vector3["0"])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):s&&s._nonUniformScaling?this._updateNonUniformScalingState(s._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=o.uq.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(e=!0){if(this.computeWorldMatrix(),e){let e=this.getChildren();for(let t=0;t<e.length;++t){let i=e[t];if(i){i.computeWorldMatrix();let e=o.AA.Matrix["0"];i._localMatrix.multiplyToRef(this._localMatrix,e);let t=o.AA.Quaternion["0"];e.decompose(i.scaling,t,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(i.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=o.PT.Identity()),this._worldMatrix=o.uq.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this}unregisterAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this}getPositionInCameraSpace(e=null){return e||(e=this.getScene().activeCamera),o.Pq.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())}getDistanceToCamera(e=null){return e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()}clone(e,t,i){let r=s.p.Clone(()=>new h(e,this.getScene()),this);if(r.name=e,r.id=e,t&&(r.parent=t),!i){let t=this.getDescendants(!0);for(let i=0;i<t.length;i++){let n=t[i];n.clone&&n.clone(e+"."+n.name,r)}}return r}serialize(e){let t=s.p.Serialize(this,e);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),s.p.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t}static Parse(e,t,i){let r=s.p.Parse(()=>new h(e.name,t),e,t,i);if(e.localMatrix?r.setPreTransformMatrix(o.uq.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(o.uq.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r._waitingParsedUniqueId=e.uniqueId,void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),e.animations){for(let t=0;t<e.animations.length;t++){let i=e.animations[t],n=(0,u.n9)("BABYLON.Animation");n&&r.animations.push(n.Parse(i))}l.b.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),r}getChildTransformNodes(e,t){let i=[];return this._getDescendants(i,e,e=>(!t||t(e))&&e instanceof h),i}dispose(e,t=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){let e=this._parentContainer.transformNodes.indexOf(this);e>-1&&this._parentContainer.transformNodes.splice(e,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),e)for(let e of this.getChildTransformNodes(!0))e.parent=null,e.computeWorldMatrix(!0);super.dispose(e,t)}normalizeToUnitCube(e=!0,t=!1,i){let r=null,n=null;t&&(this.rotationQuaternion?(n=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(r=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));let s=this.getHierarchyBoundingVectors(e,i),a=s.max.subtract(s.min),o=Math.max(a.x,a.y,a.z);return 0===o||(this.scaling.scaleInPlace(1/o),t&&(this.rotationQuaternion&&n?this.rotationQuaternion.copyFrom(n):this.rotation&&r&&this.rotation.copyFrom(r))),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}h.BILLBOARDMODE_NONE=0,h.BILLBOARDMODE_X=1,h.BILLBOARDMODE_Y=2,h.BILLBOARDMODE_Z=4,h.BILLBOARDMODE_ALL=7,h.BILLBOARDMODE_USE_POSITION=128,h.BillboardUseParentOrientation=!1,h._TmpRotation=o.PT.Zero(),h._TmpScaling=o.Pq.Zero(),h._TmpTranslation=o.Pq.Zero(),h._TmpRHRestore=o.uq.Scaling(1,1,-1),h._LookAtVectorCache=new o.Pq(0,0,0),h._RotationAxisCache=new o.PT,(0,r.Cg)([(0,n.P_)("position")],h.prototype,"_position",void 0),(0,r.Cg)([(0,n.P_)("rotation")],h.prototype,"_rotation",void 0),(0,r.Cg)([(0,n.bR)("rotationQuaternion")],h.prototype,"_rotationQuaternion",void 0),(0,r.Cg)([(0,n.P_)("scaling")],h.prototype,"_scaling",void 0),(0,r.Cg)([(0,n.lK)("billboardMode")],h.prototype,"_billboardMode",void 0),(0,r.Cg)([(0,n.lK)()],h.prototype,"scalingDeterminant",void 0),(0,r.Cg)([(0,n.lK)("infiniteDistance")],h.prototype,"_infiniteDistance",void 0),(0,r.Cg)([(0,n.lK)()],h.prototype,"ignoreNonUniformScaling",void 0),(0,r.Cg)([(0,n.lK)()],h.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},70728(e,t,i){function r(e,t){let i=[];for(let r=0;r<e;++r)i.push(t());return i}function n(e,t){return r(e,t)}i.d(t,{lL:()=>a,ln:()=>n,mI:()=>r});let s=["push","splice","pop","shift","unshift"];function a(e,t){let i=s.map(i=>(function(e,t,i){let r=e[t];if("function"!=typeof r)return null;let n=function(){let r=e.length,s=n.previous.apply(e,arguments);return i(t,r),s};return r.next=n,n.previous=r,e[t]=n,()=>{let i=n.previous;if(!i)return;let r=n.next;r?(i.next=r,r.previous=i):(i.next=void 0,e[t]=i),n.next=void 0,n.previous=void 0}})(e,i,t));return()=>{for(let e of i)e?.()}}},16447(e,t,i){function r(e,t,i,r){let n=r,s=0,a="";for(;n<i.length;){let r=i.charAt(n);if(a)r===a?'"'===a||"'"===a?"\\"!==i.charAt(n-1)&&(a=""):a="":"*/"===a&&"*"===r&&n+1<i.length&&("/"===i.charAt(n+1)&&(a=""),""===a&&n++);else switch(r){case e:s++;break;case t:s--;break;case'"':case"'":case"`":a=r;break;case"/":if(n+1<i.length){let e=i.charAt(n+1);"/"===e?a="\n":"*"===e&&(a="*/")}}if(n++,0===s)break}return 0===s?n-1:-1}function n(e,t){for(;t<e.length;){let i=e[t];if(" "!==i&&"\n"!==i&&"\r"!==i&&"	"!==i&&"\n"!==i&&"\xa0"!==i)break;t++}return t}function s(e){let t=e.charCodeAt(0);return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||95==t}function a(e){let t=0,i="",r=!1,n=[];for(;t<e.length;){let s=e.charAt(t);if(i)s===i?'"'===i||"'"===i?("\\"!==e.charAt(t-1)&&(i=""),n.push(s)):(i="",r=!1):"*/"===i&&"*"===s&&t+1<e.length?("/"===e.charAt(t+1)&&(i=""),""===i&&(r=!1,t++)):r||n.push(s);else{switch(s){case'"':case"'":case"`":i=s;break;case"/":if(t+1<e.length){let n=e.charAt(t+1);"/"===n?(i="\n",r=!0):"*"===n&&(i="*/",r=!0)}}r||n.push(s)}t++}return n.join("")}function o(e,t,i,r){for(;t>=0&&e.charAt(t)!==i&&(!r||e.charAt(t)!==r);)t--;return t}function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function u(e,t,i,r){let n=e.indexOf(t);if(n<0)return e;if(i){for(;n++<e.length&&"{"!=e.charAt(n););n<e.length&&(e=e.substring(0,n+1)+i+e.substring(n+1))}if(r){let t=e.lastIndexOf("}");e=e.substring(0,t)+(r+"\n}")}return e}i.d(t,{RJ:()=>a,V3:()=>l,VW:()=>r,_Z:()=>s,bI:()=>u,rU:()=>o,sz:()=>n})},77349(e,t,i){i.d(t,{B:()=>s,K:()=>a});let r={},n={};function s(e){let t=e.getClassName();return n[t]||(n[t]={}),n[t]}function a(e){let t=e.getClassName();if(r[t])return r[t];r[t]={};let i=r[t],s=e,a=t;for(;a;){let e,t=n[a];for(let e in t)i[e]=t[e];let r=!1;do{if(!(e=Object.getPrototypeOf(s)).getClassName){r=!0;break}if(e.getClassName()!==a)break;s=e}while(e);if(r)break;a=e.getClassName(),s=e}return i}},69219(e,t,i){i.r(t),i.d(t,{Dispose:()=>y,DumpData:()=>b,DumpDataAsync:()=>g,DumpFramebuffer:()=>m,DumpTools:()=>x,EncodeImageAsync:()=>_});var r=i(39545),n=i(58368),s=i(32997),a=i(39058),o=i(94470),l=i(31656),u=i(78898),h=i(61646);let c=null;async function d(){let e=o.q.LastCreatedEngine?.createCanvas(100,100)??new OffscreenCanvas(100,100);e instanceof OffscreenCanvas&&l.V.Warn("DumpData: OffscreenCanvas will be used for dumping data. This may result in lossy alpha values.");let{ThinEngine:t}=await Promise.resolve().then(i.bind(i,23808));if(!t.IsSupported)throw Error("DumpData: No WebGL context available. Cannot dump data.");let r=new t(e,!1,{preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1});o.q.Instances.pop(),o.q.OnEnginesDisposedObservable.add(e=>{r&&e!==r&&!r.isDisposed&&0===o.q.Instances.length&&y()}),r.getCaps().parallelShaderCompile=void 0;let s=new n.J(r),{passPixelShader:a}=await i.e("1018").then(i.bind(i,27057)),u=new n.$({engine:r,name:a.name,fragmentShader:a.shader,samplerNames:["textureSampler"]});return{canvas:e,dumpEngine:{engine:r,renderer:s,wrapper:u}}}async function p(){return c||(c=d()),await c}class f{static async EncodeImageAsync(e,t,i,r,n,a){let o=await p(),l=o.dumpEngine;l.engine.setSize(t,i,!0);let u=l.engine.createRawTexture(e,t,i,5,!1,!n,1);return l.renderer.setViewport(),l.renderer.applyEffectWrapper(l.wrapper),l.wrapper.effect._bindTexture("textureSampler",u),l.renderer.draw(),u.dispose(),await new Promise((e,t)=>{s.S0.ToBlob(o.canvas,i=>{i?e(i):t(Error("EncodeImageAsync: Failed to convert canvas to blob."))},r,a)})}}(0,r.Cg)([h.Cx],f,"EncodeImageAsync",null);let _=f.EncodeImageAsync;async function m(e,t,i,r,n="image/png",s,a){let o=new Uint8Array((await i.readPixels(0,0,e,t)).buffer);b(e,t,o,r,n,s,!0,void 0,a)}async function g(e,t,i,r="image/png",n,o=!1,h=!1,c){if(i instanceof Float32Array){let e=new Uint8Array(i.length),t=i.length;for(;t--;){let r=i[t];e[t]=Math.round(255*(0,a.Clamp)(r))}i=e}let d=await f.EncodeImageAsync(i,e,t,r,o,c);void 0!==n&&s.S0.DownloadBlob(d,n),d.type!==r&&l.V.Warn(`DumpData: The requested mimeType '${r}' is not supported. The result has mimeType '${d.type}' instead.`);let p=await d.arrayBuffer();return h?p:`data:${r};base64,${(0,u.EL)(p)}`}function b(e,t,i,r,n="image/png",s,a=!1,o=!1,l){void 0!==s||r||(s=""),g(e,t,i,n,s,a,o,l).then(e=>{r&&r(e)})}function y(){c&&(c?.then(e=>{e.canvas instanceof HTMLCanvasElement&&e.canvas.remove(),e.dumpEngine&&(e.dumpEngine.engine.dispose(),e.dumpEngine.renderer.dispose(),e.dumpEngine.wrapper.dispose())}),c=null)}let x={DumpData:b,DumpDataAsync:g,DumpFramebuffer:m,Dispose:y};s.S0.DumpData=b,s.S0.DumpDataAsync=g,s.S0.DumpFramebuffer=m},74102(e,t,i){function r(e,t){let i=t?.jsDecoderModule||KTX2DECODER;e&&(e.wasmBaseUrl&&(i.Transcoder.WasmBaseUrl=e.wasmBaseUrl),e.wasmUASTCToASTC&&(i.LiteTranscoder_UASTC_ASTC.WasmModuleURL=e.wasmUASTCToASTC),e.wasmUASTCToBC7&&(i.LiteTranscoder_UASTC_BC7.WasmModuleURL=e.wasmUASTCToBC7),e.wasmUASTCToRGBA_UNORM&&(i.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=e.wasmUASTCToRGBA_UNORM),e.wasmUASTCToRGBA_SRGB&&(i.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=e.wasmUASTCToRGBA_SRGB),e.wasmUASTCToR8_UNORM&&(i.LiteTranscoder_UASTC_R8_UNORM.WasmModuleURL=e.wasmUASTCToR8_UNORM),e.wasmUASTCToRG8_UNORM&&(i.LiteTranscoder_UASTC_RG8_UNORM.WasmModuleURL=e.wasmUASTCToRG8_UNORM),e.jsMSCTranscoder&&(i.MSCTranscoder.JSModuleURL=e.jsMSCTranscoder),e.wasmMSCTranscoder&&(i.MSCTranscoder.WasmModuleURL=e.wasmMSCTranscoder),e.wasmZSTDDecoder&&(i.ZSTDDecoder.WasmModuleURL=e.wasmZSTDDecoder)),t&&(t.wasmUASTCToASTC&&(i.LiteTranscoder_UASTC_ASTC.WasmBinary=t.wasmUASTCToASTC),t.wasmUASTCToBC7&&(i.LiteTranscoder_UASTC_BC7.WasmBinary=t.wasmUASTCToBC7),t.wasmUASTCToRGBA_UNORM&&(i.LiteTranscoder_UASTC_RGBA_UNORM.WasmBinary=t.wasmUASTCToRGBA_UNORM),t.wasmUASTCToRGBA_SRGB&&(i.LiteTranscoder_UASTC_RGBA_SRGB.WasmBinary=t.wasmUASTCToRGBA_SRGB),t.wasmUASTCToR8_UNORM&&(i.LiteTranscoder_UASTC_R8_UNORM.WasmBinary=t.wasmUASTCToR8_UNORM),t.wasmUASTCToRG8_UNORM&&(i.LiteTranscoder_UASTC_RG8_UNORM.WasmBinary=t.wasmUASTCToRG8_UNORM),t.jsMSCTranscoder&&(i.MSCTranscoder.JSModule=t.jsMSCTranscoder),t.wasmMSCTranscoder&&(i.MSCTranscoder.WasmBinary=t.wasmMSCTranscoder),t.wasmZSTDDecoder&&(i.ZSTDDecoder.WasmBinary=t.wasmZSTDDecoder))}function n(e){let t;void 0===e&&"undefined"!=typeof KTX2DECODER&&(e=KTX2DECODER),onmessage=i=>{if(i.data)switch(i.data.action){case"init":{let n=i.data.urls;n&&(n.jsDecoderModule&&void 0===e&&(importScripts(n.jsDecoderModule),e=KTX2DECODER),r(n)),i.data.wasmBinaries&&r(void 0,{...i.data.wasmBinaries,jsDecoderModule:e}),t=new e.KTX2Decoder,postMessage({action:"init"});break}case"setDefaultDecoderOptions":e.KTX2Decoder.DefaultDecoderOptions=i.data.options;break;case"decode":t.decode(i.data.data,i.data.caps,i.data.options).then(e=>{let t=[];for(let i=0;i<e.mipmaps.length;++i){let r=e.mipmaps[i];r&&r.data&&t.push(r.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:e},t)}).catch(e=>{postMessage({action:"decoded",success:!1,msg:e})})}}}async function s(e,t,i){return await new Promise((r,n)=>{let s=t=>{e.removeEventListener("error",s),e.removeEventListener("message",a),n(t)},a=t=>{"init"===t.data.action&&(e.removeEventListener("error",s),e.removeEventListener("message",a),r(e))};e.addEventListener("error",s),e.addEventListener("message",a),e.postMessage({action:"init",urls:i,wasmBinaries:t})})}i.d(t,{TD:()=>s,XE:()=>n,x2:()=>r})},31656(e,t,i){i.d(t,{V:()=>r});class r{static _CheckLimit(e,t){let i=r._LogLimitOutputs[e];return i?i.current++:(i={limit:t,current:1},r._LogLimitOutputs[e]=i),i.current<=i.limit}static _GenerateLimitMessage(e,t=1){let i=r._LogLimitOutputs[e];if(!i||!r.MessageLimitReached)return;let n=this._Levels[t];i.current===i.limit&&r[n.name](r.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,n.name??""))}static _AddLogEntry(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)}static _FormatMessage(e){let t=e=>e<10?"0"+e:""+e,i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e}static _LogDisabled(e,t){}static _LogEnabled(e=1,t,i){let n=Array.isArray(t)?t[0]:t;if(void 0!==i&&!r._CheckLimit(n,i))return;let s=r._FormatMessage(n),a=this._Levels[e],o=Array.isArray(t)?t.slice(1):[];a.logFunc&&a.logFunc("BJS - "+s,...o);let l=`<div style='color:${a.color}'>${s}</div><br>`;r._AddLogEntry(l),r._GenerateLimitMessage(n,e)}static get LogCache(){return r._LogCache}static ClearLogCache(){r._LogCache="",r._LogLimitOutputs={},r.errorsCount=0}static set LogLevels(e){for(let t of(r.Log=r._LogDisabled,r.Warn=r._LogDisabled,r.Error=r._LogDisabled,[r.MessageLogLevel,r.WarningLogLevel,r.ErrorLogLevel]))(e&t)===t&&(r[this._Levels[t].name]=r._LogEnabled.bind(r,t))}}r.NoneLogLevel=0,r.MessageLogLevel=1,r.WarningLogLevel=2,r.ErrorLogLevel=4,r.AllLogLevel=7,r.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",r._LogCache="",r._LogLimitOutputs={},r._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],r.errorsCount=0,r.Log=r._LogEnabled.bind(r,r.MessageLogLevel),r.Warn=r._LogEnabled.bind(r,r.WarningLogLevel),r.Error=r._LogEnabled.bind(r,r.ErrorLogLevel)},52969(e,t,i){i.d(t,{cP:()=>a,nu:()=>s,qO:()=>n});let r="undefined"!=typeof WeakRef;class n{constructor(e,t=!1,i,r){this.initialize(e,t,i,r)}initialize(e,t=!1,i,r){return this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=r,this}}class s{constructor(e,t,i=null){this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(e=!1){this._remove&&this._remove(e)}}class a{static FromPromise(e,t){let i=new a;return e.then(e=>{i.notifyObservers(e)}).catch(e=>{if(t)t.notifyObservers(e);else throw e}),i}get observers(){return this._observers}constructor(e,t=!1){this.notifyIfTriggered=t,this._observers=[],this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new n(0),e&&(this._onObserverAdded=e)}add(e,t=-1,i=!1,n=null,a=!1){if(!e)return null;let o=new s(e,t,n);o.unregisterOnNextCall=a,i?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(o,this._lastNotifiedValue);let l=r?new WeakRef(this):{deref:()=>this};return o._remove=(e=!1)=>{let t=l.deref();t&&(e?t.remove(o):t._remove(o))},o}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}remove(e){return!!e&&(e._remove=null,-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))}removeCallback(e,t){for(let i=0;i<this._observers.length;i++){let r=this._observers[i];if(!r._willBeUnregistered&&r.callback===e&&(!t||t===r.scope))return this._deferUnregister(r),!0}return!1}_deferUnregister(e){e._willBeUnregistered||(this._numObserversMarkedAsDeleted++,e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(()=>{this._remove(e)},0))}_remove(e,t=!0){if(!e)return!1;let i=this._observers.indexOf(e);return -1!==i&&(t&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0)}makeObserverTopPriority(e){this._remove(e,!1),this._observers.unshift(e)}makeObserverBottomPriority(e){this._remove(e,!1),this._observers.push(e)}notifyObservers(e,t=-1,i,r,n){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),!this._observers.length)return!0;let s=this._eventState;for(let a of(s.mask=t,s.target=i,s.currentTarget=r,s.skipNextObservers=!1,s.lastReturnValue=e,s.userInfo=n,this._observers))if(!a._willBeUnregistered&&(a.mask&t&&(a.unregisterOnNextCall&&this._deferUnregister(a),a.scope?s.lastReturnValue=a.callback.apply(a.scope,[e,s]):s.lastReturnValue=a.callback(e,s)),s.skipNextObservers))return!1;return!0}notifyObserver(e,t,i=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),e._willBeUnregistered)return;let r=this._eventState;r.mask=i,r.skipNextObservers=!1,e.unregisterOnNextCall&&this._deferUnregister(e),e.callback(t,r)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){let e=this._observers.pop();e&&(e._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){let e=new a;return e._observers=this._observers.slice(0),e}hasSpecificMask(e=-1){for(let t of this._observers)if(t.mask&e||t.mask===e)return!0;return!1}}},7369(e,t,i){i.d(t,{bP:()=>T,fM:()=>g,fP:()=>m,km:()=>x,r8:()=>b,s2:()=>y,w3:()=>A});var r=i(49578),n=i(78629),s=i(6866),a=i(31656),o=i(32997),l=i(69219),u=i(74150),h=i(26675),c=i(44589),d=i(79731),p=i(86566),f=i(43345);let _=null;function m(e,t,i,r,n="image/png",s=!1,l,u=!1,h=!1){let{height:c,width:d}=v(e,t,i);if(!(c&&d))return void a.V.Error("Invalid 'size' parameter !");let p=t.getScene(),g=p.activeCamera!==t;if(p.frameGraph){let e=f.Fd.FindMainObjectRenderer(p.frameGraph);e&&(g=e.camera!==t)}g?y(e,t,i,e=>{if(s){let t=new Blob([e]);o.S0.DownloadBlob(t),r&&r("")}else r&&r(e)},n,1,e.getCreationOptions().antialias,void 0,void 0,void 0,void 0,l):e.onEndFrameObservable.addOnce(()=>{_||(_=document.createElement("canvas")),_.width=d,_.height=c;let t=_.getContext("2d"),i=e.getRenderingCanvas();if(!t||!i)return void a.V.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");let f=i.width,m=i.height,g=_.width,b=_.height,y=g/f,x=b/m,T=u?Math.max(y,x):Math.min(y,x),v=f*T,A=m*T;t.save(),t.fillStyle=h?p.clearColor.toHexString():"rgba(0, 0, 0, 0)",t.fillRect(0,0,d,c),t.restore(),t.drawImage(i,0,0,f,m,(g-v)/2,(b-A)/2,v,A),s?(o.S0.EncodeScreenshotCanvasData(_,void 0,n,void 0,l),r&&r("")):o.S0.EncodeScreenshotCanvasData(_,r,n,void 0,l)})}async function g(e,t,i,r="image/png",n,s=!1,a=!1,o=!1){return await new Promise((l,u)=>{m(e,t,i,e=>{void 0!==e?l(e):u(Error("Data is undefined"))},r,o,n,s,a)})}async function b(e,t,i,r,n="image/png",s,a=!1){return await new Promise(o=>{m(e,t,{width:i,height:r},()=>{o()},n,!0,s,a)})}function y(e,t,o,c,d="image/png",p=1,f=!1,_,m=!1,g=!1,b=!0,x,A,S,E=3e4,I){let R=t.getScene();if(R.frameGraph)return void T(R.frameGraph,t,o,d,p,f,_,x,S,!c).then(e=>{c&&c(e)});let{height:P,width:M,finalWidth:C,finalHeight:O}=v(e,t,o);if(!(P&&M))return void a.V.Error("Invalid 'size' parameter !");e.skipFrameRender=!0;let w=e.getRenderWidth,D=e.getRenderHeight;e.getRenderWidth=(t=!1)=>!t&&e._currentRenderTarget?e._currentRenderTarget.width:M,e.getRenderHeight=(t=!1)=>!t&&e._currentRenderTarget?e._currentRenderTarget.height:P,e.onResizeObservable.hasObservers()&&e.onResizeObservable.notifyObservers(e);let N=new n.$("screenShot",{width:M,height:P},R,!1,!1,0,!1,r.g.BILINEAR_SAMPLINGMODE,void 0,g,void 0,void 0,void 0,p);N.renderList=R.meshes.slice(),N.samples=p,N.renderSprites=m,N.activeCamera=t,N.forceLayerMaskCheck=b,A?.(N);let L=S||l.DumpData,F=()=>{R.incrementRenderId(),R.resetCachedMaterial(),(0,h.B)(()=>N.isReadyForRendering()&&t.isReady(!0),()=>{e.onEndFrameObservable.addOnce(()=>{C===M&&O===P?N.readPixels(void 0,void 0,void 0,!1).then(e=>{L(M,P,e,c,d,_,!0,void 0,x),N.dispose()}):(e.isWebGPU?i.e("8369").then(i.bind(i,36792)):i.e("1018").then(i.bind(i,27057))).then(async()=>await (0,u.Qs)("pass",N.getInternalTexture(),R,void 0,void 0,void 0,C,O).then(t=>{e._readTexturePixels(t,C,O,-1,0,null,!0,!1,0,0).then(e=>{L(C,O,e,c,d,_,!0,void 0,x),t.dispose()})}))}),R.incrementRenderId(),R.resetCachedMaterial();let r=R.activeCamera,n=R.activeCameras,s=t.outputRenderTarget,a=R.spritesEnabled;R.activeCamera=t,R.activeCameras=null,t.outputRenderTarget=N,R.spritesEnabled=m;let o=R.meshes;R.meshes=N.renderList||R.meshes;try{R.render()}finally{R.activeCamera=r,R.activeCameras=n,t.outputRenderTarget=s,R.spritesEnabled=a,R.meshes=o,e.getRenderWidth=w,e.getRenderHeight=D,e.onResizeObservable.hasObservers()&&e.onResizeObservable.notifyObservers(e),t.getProjectionMatrix(!0),e.skipFrameRender=!1}},()=>{e.skipFrameRender=!1,e.getRenderWidth=w,e.getRenderHeight=D,I?.()},void 0,E)};if(f){let e=new s.a("antialiasing",1,R.activeCamera);N.addPostProcess(e),e.autoClear=!0,e.onEffectCreatedObservable.addOnce(e=>{e.isReady()?F():e.onCompiled=()=>{F()}})}else F()}async function x(e,t,i,r="image/png",n=1,s=!1,a,o=!1,l=!1,u=!0,h,c,d){return await new Promise((p,f)=>{y(e,t,i,e=>{void 0!==e?p(e):f(Error("Data is undefined"))},r,n,s,a,o,l,u,h,c,d)})}async function T(e,t,i,r="image/png",n=1,s=!1,a,o,u,h=!1,_){let m=e.engine,g=e.textureManager,{height:b,width:y,finalWidth:x,finalHeight:A}=v(m,t,i),S={width:y,height:b},E=u||l.DumpData,I=e.tasks,R=I.length,P=e.pausedExecution,M=m.getCaps().parallelShaderCompile;g.setBackBufferTextures(0,0,{size:S,options:{createMipMaps:!1,samples:n,types:[0],formats:[5],useSRGBBuffers:[!1],creationFlags:[0],labels:["screenshot color"]},sizeIsPercentage:!1},{size:S,options:{createMipMaps:!1,samples:n,types:[0],formats:[m.isStencilEnable?13:14],useSRGBBuffers:[!1],creationFlags:[0],labels:["screenshot depth"]},sizeIsPercentage:!1});let C=c.O;if(s){let t=new d.$("fxaa",e);t.sourceTexture=C,C=t.outputTexture,e.addTask(t)}if(x!==y||A!==b){let t=new p.m("pass",e);t.sourceTexture=C,t.targetTexture=e.textureManager.createRenderTargetTexture("pass_output",{size:{width:x,height:A},options:{createMipMaps:!1,types:[0],formats:[5],samples:1,labels:["screenshot_final_texture"],useSRGBBuffers:[!1]},sizeIsPercentage:!1}),C=t.outputTexture,e.addTask(t)}let O=f.Fd.FindMainObjectRenderer(e),w=null;O&&(w=O.camera,O.camera=t),m.getCaps().parallelShaderCompile=void 0,await e.buildAsync();let D=_??(g.hasHistoryTextures?32:1);for(let t=0;t<D;++t)e.execute();e.pausedExecution=!0,m.getCaps().parallelShaderCompile=M;for(let t=R;t<I.length;++t)e.tasks[t].dispose();e.tasks.length=R,O&&w&&(O.camera=w);let N=e.textureManager.getTextureFromHandle(C);return N.incrementReferences(),g.resetBackBufferTextures(),await e.buildAsync(),e.pausedExecution=P,new Promise(e=>{m._readTexturePixels(N,x,A,-1,0,null,!0,!1,0,0).then(async t=>{N.dispose(),E(x,A,t,h?void 0:t=>e(t),r,a,!0,void 0,o),h&&e(null)})})}function v(e,t,i){let r=0,n=0,s=0,a=0;if("object"==typeof i){let o=i.precision?Math.abs(i.precision):1;i.width&&i.height?(r=i.height*o,n=i.width*o):i.width&&!i.height?r=Math.round((n=i.width*o)/e.getAspectRatio(t)):i.height&&!i.width?n=Math.round((r=i.height*o)*e.getAspectRatio(t)):r=Math.round((n=Math.round(e.getRenderWidth()*o))/e.getAspectRatio(t)),i.finalWidth&&i.finalHeight?(a=i.finalHeight,s=i.finalWidth):i.finalWidth&&!i.finalHeight?a=Math.round((s=i.finalWidth)/e.getAspectRatio(t)):i.finalHeight&&!i.finalWidth?s=Math.round((a=i.finalHeight)*e.getAspectRatio(t)):(s=n,a=r)}else isNaN(i)||(r=i,n=i,s=i,a=i);return n&&(n=Math.floor(n)),r&&(r=Math.floor(r)),s&&(s=Math.floor(s)),a&&(a=Math.floor(a)),{height:0|r,width:0|n,finalWidth:0|s,finalHeight:0|a}}let A={CreateScreenshot:m,CreateScreenshotAsync:g,CreateScreenshotWithResizeAsync:b,CreateScreenshotUsingRenderTarget:y,CreateScreenshotUsingRenderTargetAsync:x,CreateScreenshotForFrameGraphAsync:T};o.S0.CreateScreenshot=m,o.S0.CreateScreenshotAsync=g,o.S0.CreateScreenshotUsingRenderTarget=y,o.S0.CreateScreenshotUsingRenderTargetAsync=x},74150(e,t,i){let r,n;i.d(t,{EE:()=>h,LO:()=>g,LZ:()=>d,Oz:()=>m,Qs:()=>c,SX:()=>p,v9:()=>f});var s=i(49578),a=i(78629),o=i(93541),l=i(74266),u=i(39058);function h(e,t,i,r=!0){let n=e.getScene(),l=n.getEngine(),u=new a.$("resized"+e.name,{width:t,height:i},n,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);u.wrapU=e.wrapU,u.wrapV=e.wrapV,u.uOffset=e.uOffset,u.vOffset=e.vOffset,u.uScale=e.uScale,u.vScale=e.vScale,u.uAng=e.uAng,u.vAng=e.vAng,u.wAng=e.wAng,u.coordinatesIndex=e.coordinatesIndex,u.level=e.level,u.anisotropicFilteringLevel=e.anisotropicFilteringLevel,u._texture.isReady=!1,e.wrapU=s.g.CLAMP_ADDRESSMODE,e.wrapV=s.g.CLAMP_ADDRESSMODE;let c=new o.v("pass",1,null,r?s.g.BILINEAR_SAMPLINGMODE:s.g.NEAREST_SAMPLINGMODE,l,!1,0);return c.externalTextureSamplerBinding=!0,c.onEffectCreatedObservable.addOnce(t=>{t.executeWhenCompiled(()=>{c.onApply=function(t){t.setTexture("textureSampler",e)};let t=u.renderTarget;t&&(n.postProcessManager.directRender([c],t),l.unBindFramebuffer(t),u.disposeFramebufferObjects(),c.dispose(),u.getInternalTexture().isReady=!0)})}),u}function c(e,t,i,r,n,s,a,o){let u=t.getEngine();return t.isReady=!1,n=n??t.samplingMode,r=r??t.type,s=s??t.format,a=a??t.width,o=o??t.height,-1===r&&(r=0),new Promise(h=>{let c=new l.w("postprocess",e,null,null,1,null,n,u,!1,void 0,r,void 0,null,!1,s);c.externalTextureSamplerBinding=!0;let d=u.createRenderTargetTexture({width:a,height:o},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:n,type:r,format:s});c.onEffectCreatedObservable.addOnce(e=>{e.executeWhenCompiled(()=>{c.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},i.postProcessManager.directRender([c],d,!0),u.restoreDefaultFramebuffer(),u._releaseTexture(t),c&&c.dispose(),d._swapAndDie(t),t.type=r,t.format=5,t.isReady=!0,h(t)})})})}function d(e){r||(n=new Int32Array((r=new Float32Array(1)).buffer)),r[0]=e;let t=n[0],i=t>>16&32768,s=t>>12&2047,a=t>>23&255;return a<103?i:a>142?(i|=31744,i|=+(255!=a)&&8388607&t):a<113?(s|=2048,i|=(s>>114-a)+(s>>113-a&1)):(i|=a-112<<10|s>>1,i+=1&s)}function p(e){let t=(32768&e)>>15,i=(31744&e)>>10,r=1023&e;return 0===i?(t?-1:1)*6103515625e-14*(r/1024):31==i?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,i-15)*(1+r/1024)}async function f(e){if(e.isReady())return;if(e.loadingError)throw Error(e.errorObject?.message||`Texture ${e.name} errored while loading.`);let t=e.onLoadObservable;if(t)return await new Promise(e=>t.addOnce(()=>e()));let i=e._texture?.onLoadedObservable;if(i)return await new Promise(e=>i.addOnce(()=>e()));throw Error(`Cannot determine readiness of texture ${e.name}.`)}async function _(e,t,r,n,o){let u,h=e.getScene(),c=h.getEngine();c.isWebGPU?e.isCube?await i.e("5526").then(i.bind(i,63989)):await i.e("6471").then(i.bind(i,13466)):e.isCube?await i.e("7099").then(i.bind(i,88966)):await i.e("4634").then(i.bind(i,83953)),u=e.isCube?new l.w("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:s.g.NEAREST_NEAREST_MIPNEAREST,engine:c,defines:["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"][n],shaderLanguage:+!!c.isWebGPU}):new l.w("lod","lod",{uniforms:["lod","gamma"],samplingMode:s.g.NEAREST_NEAREST_MIPNEAREST,engine:c,shaderLanguage:+!!c.isWebGPU}),await new Promise(e=>{u.onEffectCreatedObservable.addOnce(t=>{t.executeWhenCompiled(()=>{e(0)})})});let d=new a.$("temp",{width:t,height:r},h,!1);u.onApply=function(t){t.setTexture("textureSampler",e),t.setFloat("lod",o),t.setInt("gamma",+!!e.gammaSpace)};let p=e.getInternalTexture();try{if(d.renderTarget&&p){let i=p.samplingMode;0!==o?e.updateSamplingMode(s.g.NEAREST_NEAREST_MIPNEAREST):e.updateSamplingMode(s.g.NEAREST_NEAREST),h.postProcessManager.directRender([u],d.renderTarget,!0),e.updateSamplingMode(i);let n=await c.readPixels(0,0,t,r),a=new Uint8Array(n.buffer,0,n.byteLength);return c.unBindFramebuffer(d.renderTarget),a}throw Error("Render to texture failed.")}finally{d.dispose(),u.dispose()}}async function m(e,t,i,r=0,n=0){await f(e);let{width:s,height:a}=e.getSize(),o=t??s,l=i??a;if(function(e){switch(e){case 36492:case 36493:case 36495:case 36494:case 33779:case 35919:case 33778:case 35918:case 33777:case 33776:case 35917:case 35916:case 37808:case 37840:case 36196:case 37492:case 37493:case 37494:case 37495:case 37496:case 37497:return!0;default:return!1}}(e.textureFormat)||o!==s||l!==a)return await _(e,o,l,r,n);let h=await e.readPixels(r,n);if(!h)throw Error(`Failed to read pixels from texture ${e.name}.`);if(h instanceof Float32Array){let e=new Uint8Array(h.length),t=h.length;for(;t--;){let i=h[t];e[t]=Math.round(255*(0,u.Clamp)(i))}h=e}return h}let g={CreateResizedCopy:h,ApplyPostProcess:c,ToHalfFloat:d,FromHalfFloat:p,GetTextureDataAsync:m}},18709(e,t,i){i.d(t,{W:()=>n});var r=i(66443);async function n(e,t){let i=t.method||"GET";return await new Promise((n,s)=>{let a=new r.u;a.addEventListener("readystatechange",()=>{if(4==a.readyState)if(200==a.status){let e={};if(t.responseHeaders)for(let i of t.responseHeaders)e[i]=a.getResponseHeader(i)||"";n({response:a.response,headerValues:e})}else s(`Unable to fetch data from ${e}. Error code: ${a.status}`)}),a.open(i,e),a.send()})}},76191(e,t,i){i.d(t,{d:()=>n});var r=i(70134);class n{constructor(){this._hasHit=!1,this._hitNormal=r.Pq.Zero(),this._hitPoint=r.Pq.Zero(),this._triangleIndex=-1}get hitPoint(){return this._hitPoint}get hitNormal(){return this._hitNormal}get hasHit(){return this._hasHit}get triangleIndex(){return this._triangleIndex}setHitData(e,t,i){this._hasHit=!0,this._hitNormal.set(e.x,e.y,e.z),this._hitPoint.set(t.x,t.y,t.z),this._triangleIndex=i??-1}reset(){this._hasHit=!1,this._hitNormal.setAll(0),this._hitPoint.setAll(0),this._triangleIndex=-1,this.body=void 0,this.bodyIndex=void 0,this.shape=void 0}}},94321(e,t,i){var r=i(31656),n=i(52969),s=i(75318),a=i(9633),o=i(16526),l=i(65423);a.Z.prototype.getPhysicsEngine=function(){return this._physicsEngine??null},a.Z.prototype.enablePhysics=function(e=null,t){if(this._physicsEngine)return!0;let i=this._getComponent(s.v.NAME_PHYSICSENGINE);i||(i=new u(this),this._addComponent(i));try{if(t&&t?.getPluginVersion()!==1)if(t?.getPluginVersion()===2)this._physicsEngine=new l.A(e,t);else throw Error("Unsupported Physics plugin version.");else this._physicsEngine=new o.A(e,t);return this._physicsTimeAccumulator=0,!0}catch(e){return r.V.Error(e.message),!1}},a.Z.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},a.Z.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},a.Z.prototype.deleteCompoundImpostor=function(e){let t=e.parts[0].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},a.Z.prototype._advancePhysicsEngineStep=function(e){if(this._physicsEngine){let t=this._physicsEngine.getSubTimeStep();if(t>0)for(this._physicsTimeAccumulator+=e;this._physicsTimeAccumulator>t;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=t;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}};class u{constructor(e){this.name=s.v.NAME_PHYSICSENGINE,this.scene=e,this.scene.onBeforePhysicsObservable=new n.cP,this.scene.onAfterPhysicsObservable=new n.cP,this.scene.getDeterministicFrameTime=()=>this.scene._physicsEngine?1e3*this.scene._physicsEngine.getTimeStep():1e3/60}register(){}rebuild(){}dispose(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()}}i(29207);var h=i(60871);Object.defineProperty(h.V.prototype,"physicsBody",{get:function(){return this._physicsBody},set:function(e){this._physicsBody!==e&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsBody=e,e&&(this._disposePhysicsObserver=this.onDisposeObservable.add(()=>{this.physicsBody&&(this.physicsBody.dispose(),this.physicsBody=null)})))},enumerable:!0,configurable:!0}),h.V.prototype.getPhysicsBody=function(){return this.physicsBody},h.V.prototype.applyImpulse=function(e,t){if(!this.physicsBody)throw Error("No Physics Body for TransformNode");return this.physicsBody.applyImpulse(e,t),this},h.V.prototype.applyAngularImpulse=function(e){if(!this.physicsBody)throw Error("No Physics Body for TransformNode");return this.physicsBody.applyAngularImpulse(e),this},h.V.prototype.applyTorque=function(e){if(!this.physicsBody)throw Error("No Physics Body for TransformNode");return this.physicsBody.applyTorque(e),this}},29207(e,t,i){var r=i(31804),n=i(63582);Object.defineProperty(r.u.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(e){this._physicsImpostor!==e&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=e,e&&(this._disposePhysicsObserver=this.onDisposeObservable.add(()=>{this.physicsImpostor&&(this.physicsImpostor.dispose(),this.physicsImpostor=null)})))},enumerable:!0,configurable:!0}),r.u.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},r.u.prototype.applyImpulse=function(e,t){return this.physicsImpostor&&this.physicsImpostor.applyImpulse(e,t),this},r.u.prototype.setPhysicsLinkWith=function(e,t,i,r){return this.physicsImpostor&&e.physicsImpostor&&this.physicsImpostor.createJoint(e.physicsImpostor,n.W$.HingeJoint,{mainPivot:t,connectedPivot:i,nativeParams:r}),this}},60167(e,t,i){var r,n,s,a,o,l,u,h,c,d,p,f,_,m,g,b,y,x;i.d(t,{AH:()=>u,DK:()=>a,Y1:()=>n,YK:()=>l,f9:()=>h,nC:()=>c,oE:()=>o,vX:()=>s,yc:()=>r}),(d=r||(r={}))[d.FREE=0]="FREE",d[d.LIMITED=1]="LIMITED",d[d.LOCKED=2]="LOCKED",(p=n||(n={}))[p.LINEAR_X=0]="LINEAR_X",p[p.LINEAR_Y=1]="LINEAR_Y",p[p.LINEAR_Z=2]="LINEAR_Z",p[p.ANGULAR_X=3]="ANGULAR_X",p[p.ANGULAR_Y=4]="ANGULAR_Y",p[p.ANGULAR_Z=5]="ANGULAR_Z",p[p.LINEAR_DISTANCE=6]="LINEAR_DISTANCE",(f=s||(s={}))[f.BALL_AND_SOCKET=1]="BALL_AND_SOCKET",f[f.DISTANCE=2]="DISTANCE",f[f.HINGE=3]="HINGE",f[f.SLIDER=4]="SLIDER",f[f.LOCK=5]="LOCK",f[f.PRISMATIC=6]="PRISMATIC",f[f.SIX_DOF=7]="SIX_DOF",(_=a||(a={}))[_.SPHERE=0]="SPHERE",_[_.CAPSULE=1]="CAPSULE",_[_.CYLINDER=2]="CYLINDER",_[_.BOX=3]="BOX",_[_.CONVEX_HULL=4]="CONVEX_HULL",_[_.CONTAINER=5]="CONTAINER",_[_.MESH=6]="MESH",_[_.HEIGHTFIELD=7]="HEIGHTFIELD",(m=o||(o={}))[m.NONE=0]="NONE",m[m.VELOCITY=1]="VELOCITY",m[m.POSITION=2]="POSITION",(g=l||(l={})).COLLISION_STARTED="COLLISION_STARTED",g.COLLISION_CONTINUED="COLLISION_CONTINUED",g.COLLISION_FINISHED="COLLISION_FINISHED",g.TRIGGER_ENTERED="TRIGGER_ENTERED",g.TRIGGER_EXITED="TRIGGER_EXITED",(b=u||(u={}))[b.STATIC=0]="STATIC",b[b.ANIMATED=1]="ANIMATED",b[b.DYNAMIC=2]="DYNAMIC",(y=h||(h={}))[y.DISABLED=0]="DISABLED",y[y.TELEPORT=1]="TELEPORT",y[y.ACTION=2]="ACTION",(x=c||(c={}))[x.SIMULATION_CONTROLLED=0]="SIMULATION_CONTROLLED",x[x.ALWAYS_ACTIVE=1]="ALWAYS_ACTIVE",x[x.ALWAYS_INACTIVE=2]="ALWAYS_INACTIVE"},73869(e,t,i){i.d(t,{P:()=>y});var r=i(70134),n=i(60167),s=i(69638),a=i(31656),o=i(96028),l=i(37331),u=i(66886),h=i(51371),c=i(95435),d=i(70728),p=i(52969);class f{constructor(e,t,i){this._vertices=[],this._indices=[],this._isRightHanded=i.useRightHandedSystem,this._collectIndices=t}addNodeMeshes(e,t){e.computeWorldMatrix(!0);let i=r.AA.Matrix["0"];if(r.uq.ScalingToRef(e.absoluteScaling.x,e.absoluteScaling.y,e.absoluteScaling.z,i),e instanceof u.e?this._addMesh(e,i):e instanceof h.Z&&this._addMesh(e.sourceMesh,i),t){let t=r.AA.Matrix["1"];e.computeWorldMatrix().invertToRef(t);let n=r.AA.Matrix["2"];for(let s of(t.multiplyToRef(i,n),e.getChildMeshes(!1).filter(e=>!e.physicsBody))){let e=s.computeWorldMatrix(),t=r.AA.Matrix["3"];e.multiplyToRef(n,t),s instanceof u.e?this._addMesh(s,t):s instanceof h.Z&&this._addMesh(s.sourceMesh,t)}}}_addMesh(e,t){let i=e.getVerticesData(c.R.PositionKind)||[],n=i.length/3,s=this._vertices.length;for(let e=0;e<n;e++){let n=new r.Pq(i[3*e+0],i[3*e+1],i[3*e+2]);this._vertices.push(r.Pq.TransformCoordinates(n,t))}if(this._collectIndices){let t=e.getIndices();if(t)for(let e=0;e<t.length;e+=3)this._isRightHanded?(this._indices.push(t[e+0]+s),this._indices.push(t[e+1]+s),this._indices.push(t[e+2]+s)):(this._indices.push(t[e+2]+s),this._indices.push(t[e+1]+s),this._indices.push(t[e+0]+s))}}getVertices(e){let t=3*this._vertices.length,i=e._malloc(4*t),r=new Float32Array(e.HEAPU8.buffer,i,t);for(let e=0;e<this._vertices.length;e++)r[3*e+0]=this._vertices[e].x,r[3*e+1]=this._vertices[e].y,r[3*e+2]=this._vertices[e].z;return{offset:i,numObjects:t}}freeBuffer(e,t){e._free(t.offset)}getTriangles(e){let t=4*this._indices.length,i=e._malloc(t),r=new Int32Array(e.HEAPU8.buffer,i,this._indices.length);for(let e=0;e<this._indices.length;e++)r[e]=this._indices[e];return{offset:i,numObjects:this._indices.length}}}class _{constructor(e){this.hpBodyId=e,this.userMassProps={centerOfMass:void 0,mass:void 0,inertia:void 0,inertiaOrientation:void 0}}}class m{constructor(){this.bodyId=BigInt(0),this.position=new r.Pq,this.normal=new r.Pq}}class g{constructor(){this.contactOnA=new m,this.contactOnB=new m,this.impulseApplied=0,this.type=0}static readToRef(e,t,i){let r=new Int32Array(e,t),n=new Float32Array(e,t);i.contactOnA.bodyId=BigInt(r[2]),i.contactOnA.position.set(n[10],n[11],n[12]),i.contactOnA.normal.set(n[13],n[14],n[15]),i.contactOnB.bodyId=BigInt(r[18]),i.contactOnB.position.set(n[26],n[27],n[28]),i.contactOnB.normal.set(n[29],n[30],n[31]),i.impulseApplied=n[34],i.type=r[0]}}class b{constructor(){this.bodyIdA=BigInt(0),this.bodyIdB=BigInt(0),this.type=0}static readToRef(e,t,i){let r=new Int32Array(e,t);i.type=r[0],i.bodyIdA=BigInt(r[2]),i.bodyIdB=BigInt(r[6])}}class y{constructor(e=!0,t=HK,i={}){if(this._useDeltaForWorldStep=e,this._hknp={},this.name="HavokPlugin",this._multiQueryCollector=void 0,this._fixedTimeStep=1/60,this._maxQueryCollectorHits=1,this._tmpVec3=(0,d.mI)(3,r.Pq.Zero),this._bodies=new Map,this._shapes=new Map,this._bodyCollisionObservable=new Map,this._constraintToBodyIdPair=new Map,this._bodyCollisionEndedObservable=new Map,this.onCollisionObservable=new p.cP,this.onCollisionEndedObservable=new p.cP,this.onTriggerCollisionObservable=new p.cP,"function"==typeof t)return void a.V.Error("Havok is not ready. Please make sure you await HK() before using the plugin.");if(this._hknp=t,!this.isSupported())return void a.V.Error("Havok is not available. Please make sure you included the js file.");this.world=this._hknp.HP_World_Create()[1],this._queryCollector=this._hknp.HP_QueryCollector_Create(1)[1],this.setMaxQueryCollectorHits(i.maxQueryCollectorHits??1)}isSupported(){return void 0!==this._hknp}setGravity(e){this._hknp.HP_World_SetGravity(this.world,this._bVecToV3(e))}setTimeStep(e){this._fixedTimeStep=e}getTimeStep(){return this._fixedTimeStep}setMaxQueryCollectorHits(e){e!==this._maxQueryCollectorHits&&(this._multiQueryCollector&&(this._hknp.HP_QueryCollector_Release(this._multiQueryCollector),this._multiQueryCollector=void 0),e>1&&(this._multiQueryCollector=this._hknp.HP_QueryCollector_Create(e)[1]))}getMaxQueryCollectorHits(){return this._maxQueryCollectorHits}executeStep(e,t){for(let e of t)e.disablePreStep||this.setPhysicsBodyTransformation(e,e.transformNode);let i=this._useDeltaForWorldStep?e:this._fixedTimeStep;for(let e of(this._hknp.HP_World_SetIdealStepTime(this.world,i),this._hknp.HP_World_Step(this.world,i),this._bodyBuffer=this._hknp.HP_World_GetBodyBuffer(this.world)[1],t))e.disableSync||this.sync(e);this._notifyCollisions(),this._notifyTriggers()}getPluginVersion(){return 2}setVelocityLimits(e,t){this._hknp.HP_World_SetSpeedLimit(this.world,e,t)}getMaxLinearVelocity(){return this._hknp.HP_World_GetSpeedLimit(this.world)[1]}getMaxAngularVelocity(){return this._hknp.HP_World_GetSpeedLimit(this.world)[2]}initBody(e,t,i,r){e._pluginData=new _(this._hknp.HP_Body_Create()[1]),this._internalSetMotionType(e._pluginData,t);let n=[this._bVecToV3(i),this._bQuatToV4(r)];this._hknp.HP_Body_SetQTransform(e._pluginData.hpBodyId,n),this._hknp.HP_World_AddBody(this.world,e._pluginData.hpBodyId,e.startAsleep),this._bodies.set(e._pluginData.hpBodyId[0],{body:e,index:0})}removeBody(e){if(e._pluginDataInstances&&e._pluginDataInstances.length>0)for(let t of e._pluginDataInstances)this._bodyCollisionObservable.delete(t.hpBodyId[0]),this._hknp.HP_World_RemoveBody(this.world,t.hpBodyId),this._bodies.delete(t.hpBodyId[0]);e._pluginData&&(this._bodyCollisionObservable.delete(e._pluginData.hpBodyId[0]),this._hknp.HP_World_RemoveBody(this.world,e._pluginData.hpBodyId),this._bodies.delete(e._pluginData.hpBodyId[0]))}initBodyInstances(e,t,i){let r=i._thinInstanceDataStorage?.instancesCount??0,n=i._thinInstanceDataStorage.matrixData;if(n){this._createOrUpdateBodyInstances(e,t,n,0,r,!1);for(let t=0;t<e._pluginDataInstances.length;t++){let i=e._pluginDataInstances[t];this._bodies.set(i.hpBodyId[0],{body:e,index:t})}}}_createOrUpdateBodyInstances(e,t,i,n,s,a){let o=r.AA.Quaternion["0"],l=r.uq.Identity();for(let u=n;u<s;u++){let n,s=[i[16*u+12],i[16*u+13],i[16*u+14]];n=a?e._pluginDataInstances[u].hpBodyId:this._hknp.HP_Body_Create()[1],l.setRowFromFloats(0,i[16*u+0],i[16*u+1],i[16*u+2],0),l.setRowFromFloats(1,i[16*u+4],i[16*u+5],i[16*u+6],0),l.setRowFromFloats(2,i[16*u+8],i[16*u+9],i[16*u+10],0),r.PT.FromRotationMatrixToRef(l,o);let h=[s,[o.x,o.y,o.z,o.w]];if(this._hknp.HP_Body_SetQTransform(n,h),!a){let i=new _(n);e._pluginDataInstances.length&&(i.userMassProps=e._pluginDataInstances[0].userMassProps),this._internalSetMotionType(i,t),this._internalUpdateMassProperties(i),e._pluginDataInstances.push(i),this._hknp.HP_World_AddBody(this.world,n,e.startAsleep),i.worldTransformOffset=this._hknp.HP_Body_GetWorldTransformOffset(n)[1]}}}updateBodyInstances(e,t){let i=t._thinInstanceDataStorage?.instancesCount??0,r=t._thinInstanceDataStorage.matrixData;if(!r)return;let n=e._pluginDataInstances.length,s=this.getMotionType(e);if(i>n){this._createOrUpdateBodyInstances(e,s,r,n,i,!1);let t=this._hknp.HP_Body_GetShape(e._pluginDataInstances[0].hpBodyId)[1];t[0]||(t[0]=e.shape?._pluginData[0]);for(let r=n;r<i;r++)this._hknp.HP_Body_SetShape(e._pluginDataInstances[r].hpBodyId,t),this._internalUpdateMassProperties(e._pluginDataInstances[r]),this._bodies.set(e._pluginDataInstances[r].hpBodyId[0],{body:e,index:r})}else if(i<n){let t=n-i;for(let i=0;i<t;i++){let t=e._pluginDataInstances.pop();this._bodies.delete(t.hpBodyId[0]),this._hknp.HP_World_RemoveBody(this.world,t.hpBodyId),this._hknp.HP_Body_Release(t.hpBodyId)}this._createOrUpdateBodyInstances(e,s,r,0,i,!0)}}sync(e){this.syncTransform(e,e.transformNode)}syncTransform(e,t){if(e._pluginDataInstances.length){let i=t._thinInstanceDataStorage.matrixData;if(!i)return;let r=e._pluginDataInstances.length;for(let t=0;t<r;t++){let r=e._pluginDataInstances[t].worldTransformOffset,n=new Float32Array(this._hknp.HEAPU8.buffer,this._bodyBuffer+r,16),s=16*t;for(let e=0;e<15;e++)(3&e)!=3&&(i[s+e]=n[e]);i[s+15]=1}t.thinInstanceBufferUpdated("matrix")}else try{let i=this._hknp.HP_Body_GetQTransform(e._pluginData.hpBodyId)[1],n=i[0],s=i[1],a=r.AA.Quaternion["0"];a.set(s[0],s[1],s[2],s[3]);let o=t.parent;if(o&&!o.getWorldMatrix().isIdentity()){o.computeWorldMatrix(!0),r.AA.Vector3["1"].copyFrom(t.scaling),a.normalize();let e=r.AA.Matrix["0"],i=r.AA.Vector3["0"];i.copyFromFloats(n[0],n[1],n[2]),r.uq.ComposeToRef(t.absoluteScaling,a,i,e);let s=r.AA.Matrix["1"];o.getWorldMatrix().invertToRef(s);let l=r.AA.Matrix["2"];e.multiplyToRef(s,l),l.decomposeToTransformNode(t),t.rotationQuaternion?.normalize(),t.scaling.copyFrom(r.AA.Vector3["1"])}else t.position.set(n[0],n[1],n[2]),t.rotationQuaternion?t.rotationQuaternion.copyFrom(a):a.toEulerAnglesToRef(t.rotation)}catch(e){a.V.Error(`Syncing transform failed for node ${t.name}: ${e.message}...`)}}setShape(e,t){let i=t&&t._pluginData?t._pluginData:BigInt(0);if(!(e.transformNode instanceof u.e)||!e.transformNode._thinInstanceDataStorage?.matrixData){this._hknp.HP_Body_SetShape(e._pluginData.hpBodyId,i),this._internalUpdateMassProperties(e._pluginData);return}let r=e.transformNode,n=r._thinInstanceDataStorage?.instancesCount??0;for(let t=0;t<n;t++)this._hknp.HP_Body_SetShape(e._pluginDataInstances[t].hpBodyId,i),this._internalUpdateMassProperties(e._pluginDataInstances[t])}_getPluginReference(e,t){return e._pluginDataInstances?.length?e._pluginDataInstances[t??0]:e._pluginData}getShape(e){let t=this._getPluginReference(e),i=this._hknp.HP_Body_GetShape(t.hpBodyId)[1];if(0!=i){let t=e.transformNode.getScene();return new o.JN({pluginData:i},t)}return null}getShapeType(e){return e.type?e.type:this._hknp.HP_Shape_GetType(e._pluginData)}setEventMask(e,t,i){this._applyToBodyOrInstances(e,e=>{this._hknp.HP_Body_SetEventMask(e.hpBodyId,t)},i)}getEventMask(e,t){let i=this._getPluginReference(e,t);return this._hknp.HP_Body_GetEventMask(i.hpBodyId)[1]}_fromMassPropertiesTuple(e){return{centerOfMass:r.Pq.FromArray(e[0]),mass:e[1],inertia:r.Pq.FromArray(e[2]),inertiaOrientation:r.PT.FromArray(e[3])}}_internalUpdateMassProperties(e){let t=this._internalComputeMassProperties(e),i=e.userMassProps;i.centerOfMass&&(t[0]=i.centerOfMass.asArray()),void 0!=i.mass&&(t[1]=i.mass),i.inertia&&(t[2]=i.inertia.asArray()),i.inertiaOrientation&&(t[3]=i.inertiaOrientation.asArray()),this._hknp.HP_Body_SetMassProperties(e.hpBodyId,t)}_internalSetMotionType(e,t){switch(t){case 0:this._hknp.HP_Body_SetMotionType(e.hpBodyId,this._hknp.MotionType.STATIC);break;case 1:this._hknp.HP_Body_SetMotionType(e.hpBodyId,this._hknp.MotionType.KINEMATIC);break;case 2:this._hknp.HP_Body_SetMotionType(e.hpBodyId,this._hknp.MotionType.DYNAMIC)}}setMotionType(e,t,i){this._applyToBodyOrInstances(e,e=>{this._internalSetMotionType(e,t)},i)}getMotionType(e,t){let i=this._getPluginReference(e,t),r=this._hknp.HP_Body_GetMotionType(i.hpBodyId)[1];switch(r){case this._hknp.MotionType.STATIC:return 0;case this._hknp.MotionType.KINEMATIC:return 1;case this._hknp.MotionType.DYNAMIC:return 2}throw Error("Unknown motion type: "+r)}setActivationControl(e,t){switch(t){case 1:this._hknp.HP_Body_SetActivationControl(e._pluginData.hpBodyId,this._hknp.ActivationControl.ALWAYS_ACTIVE);break;case 2:this._hknp.HP_Body_SetActivationControl(e._pluginData.hpBodyId,this._hknp.ActivationControl.ALWAYS_INACTIVE);break;case 0:this._hknp.HP_Body_SetActivationControl(e._pluginData.hpBodyId,this._hknp.ActivationControl.SIMULATION_CONTROLLED)}}_internalComputeMassProperties(e){let t=this._hknp.HP_Body_GetShape(e.hpBodyId);if(t[0]==this._hknp.Result.RESULT_OK){let e=this._hknp.HP_Shape_BuildMassProperties(t[1]);if(e[0]==this._hknp.Result.RESULT_OK)return e[1]}return[[0,0,0],1,[1,1,1],[0,0,0,1]]}computeMassProperties(e,t){let i=this._getPluginReference(e,t),r=this._internalComputeMassProperties(i);return this._fromMassPropertiesTuple(r)}setMassProperties(e,t,i){this._applyToBodyOrInstances(e,e=>{e.userMassProps=t,this._internalUpdateMassProperties(e)},i)}getMassProperties(e,t){let i=this._getPluginReference(e,t),r=this._hknp.HP_Body_GetMassProperties(i.hpBodyId)[1];return this._fromMassPropertiesTuple(r)}setLinearDamping(e,t,i){this._applyToBodyOrInstances(e,e=>{this._hknp.HP_Body_SetLinearDamping(e.hpBodyId,t)},i)}getLinearDamping(e,t){let i=this._getPluginReference(e,t);return this._hknp.HP_Body_GetLinearDamping(i.hpBodyId)[1]}setAngularDamping(e,t,i){this._applyToBodyOrInstances(e,e=>{this._hknp.HP_Body_SetAngularDamping(e.hpBodyId,t)},i)}getAngularDamping(e,t){let i=this._getPluginReference(e,t);return this._hknp.HP_Body_GetAngularDamping(i.hpBodyId)[1]}setLinearVelocity(e,t,i){this._applyToBodyOrInstances(e,e=>{this._hknp.HP_Body_SetLinearVelocity(e.hpBodyId,this._bVecToV3(t))},i)}getLinearVelocityToRef(e,t,i){let r=this._getPluginReference(e,i),n=this._hknp.HP_Body_GetLinearVelocity(r.hpBodyId)[1];this._v3ToBvecRef(n,t)}_applyToBodyOrInstances(e,t,i){if(e._pluginDataInstances?.length>0&&void 0===i)for(let i=0;i<e._pluginDataInstances.length;i++)t(e._pluginDataInstances[i]);else t(this._getPluginReference(e,i))}applyImpulse(e,t,i,r){this._applyToBodyOrInstances(e,e=>{this._hknp.HP_Body_ApplyImpulse(e.hpBodyId,this._bVecToV3(i),this._bVecToV3(t))},r)}applyAngularImpulse(e,t,i){this._applyToBodyOrInstances(e,e=>{this._hknp.HP_Body_ApplyAngularImpulse(e.hpBodyId,this._bVecToV3(t))},i)}applyForce(e,t,i,r){t.scaleToRef(this.getTimeStep(),this._tmpVec3[0]),this.applyImpulse(e,this._tmpVec3[0],i,r)}applyTorque(e,t,i){t.scaleToRef(this.getTimeStep(),this._tmpVec3[0]),this.applyAngularImpulse(e,this._tmpVec3[0],i)}setAngularVelocity(e,t,i){this._applyToBodyOrInstances(e,e=>{this._hknp.HP_Body_SetAngularVelocity(e.hpBodyId,this._bVecToV3(t))},i)}getAngularVelocityToRef(e,t,i){let r=this._getPluginReference(e,i),n=this._hknp.HP_Body_GetAngularVelocity(r.hpBodyId)[1];this._v3ToBvecRef(n,t)}setPhysicsBodyTransformation(e,t){if(e.getPrestepType()==n.f9.TELEPORT){let i=e.transformNode;if(e.numInstances>0){let t=i._thinInstanceDataStorage.matrixData;if(!t)return;let r=e.numInstances;this._createOrUpdateBodyInstances(e,e.getMotionType(),t,0,r,!0)}else this._hknp.HP_Body_SetQTransform(e._pluginData.hpBodyId,this._getTransformInfos(t))}else e.getPrestepType()==n.f9.ACTION?this.setTargetTransform(e,t.absolutePosition,t.absoluteRotationQuaternion):e.getPrestepType()==n.f9.DISABLED?a.V.Warn("Prestep type is set to DISABLED. Unable to set physics body transformation."):a.V.Warn("Invalid prestep type set to physics body.")}setTargetTransform(e,t,i,r){this._applyToBodyOrInstances(e,e=>{this._hknp.HP_Body_SetTargetQTransform(e.hpBodyId,[this._bVecToV3(t),this._bQuatToV4(i)])},r)}setGravityFactor(e,t,i){this._applyToBodyOrInstances(e,e=>{this._hknp.HP_Body_SetGravityFactor(e.hpBodyId,t)},i)}getGravityFactor(e,t){let i=this._getPluginReference(e,t);return this._hknp.HP_Body_GetGravityFactor(i.hpBodyId)[1]}disposeBody(e){if(e._pluginDataInstances&&e._pluginDataInstances.length>0)for(let t of e._pluginDataInstances)this._hknp.HP_Body_Release(t.hpBodyId),t.hpBodyId=void 0;e._pluginData&&(this._hknp.HP_Body_Release(e._pluginData.hpBodyId),e._pluginData.hpBodyId=void 0)}_createOptionsFromGroundMesh(e){let t,i=e.groundMesh;if(!i)return;let n=i.getVerticesData(c.R.PositionKind),s=i.computeWorldMatrix(!0),a=[];for(t=0;t<n.length;t+=3)r.Pq.FromArrayToRef(n,t,r.AA.Vector3["0"]),r.Pq.TransformCoordinatesToRef(r.AA.Vector3["0"],s,r.AA.Vector3["1"]),r.AA.Vector3["1"].toArray(a,t);let o=~~(Math.sqrt((n=a).length/3)-1),l=i.getBoundingInfo(),u=Math.min(l.boundingBox.extendSizeWorld.x,l.boundingBox.extendSizeWorld.z),h=l.boundingBox.minimumWorld.x,d=l.boundingBox.minimumWorld.y,p=l.boundingBox.minimumWorld.z,f=new Float32Array((o+1)*(o+1)),_=2*u/o;for(let e=0;e<f.length;e++)f[e]=d;for(let e=0;e<n.length;e+=3){let t=Math.round((n[e+0]-h)/_),i=o-Math.round((n[e+2]-p)/_),r=n[e+1]-d;f[i*(o+1)+t]=r}e.numHeightFieldSamplesX=o+1,e.numHeightFieldSamplesZ=o+1,e.heightFieldSizeX=2*l.boundingBox.extendSizeWorld.x,e.heightFieldSizeZ=2*l.boundingBox.extendSizeWorld.z,e.heightFieldData=f}initShape(e,t,i){switch(t){case 0:{let t=i.radius||1,r=i.center?this._bVecToV3(i.center):[0,0,0];e._pluginData=this._hknp.HP_Shape_CreateSphere(r,t)[1]}break;case 3:{let t=i.rotation?this._bQuatToV4(i.rotation):[0,0,0,1],r=i.extents?this._bVecToV3(i.extents):[1,1,1],n=i.center?this._bVecToV3(i.center):[0,0,0];e._pluginData=this._hknp.HP_Shape_CreateBox(n,t,r)[1]}break;case 1:{let t=i.pointA?this._bVecToV3(i.pointA):[0,0,0],r=i.pointB?this._bVecToV3(i.pointB):[0,1,0],n=i.radius||0;e._pluginData=this._hknp.HP_Shape_CreateCapsule(t,r,n)[1]}break;case 5:e._pluginData=this._hknp.HP_Shape_CreateContainer()[1];break;case 2:{let t=i.pointA?this._bVecToV3(i.pointA):[0,0,0],r=i.pointB?this._bVecToV3(i.pointB):[0,1,0],n=i.radius||0;e._pluginData=this._hknp.HP_Shape_CreateCylinder(t,r,n)[1]}break;case 4:case 6:{let r=i.mesh;if(r){let n=!!i.includeChildMeshes,s=new f(r,4!=t,r?.getScene());s.addNodeMeshes(r,n);let a=s.getVertices(this._hknp),o=a.numObjects/3;if(4==t)e._pluginData=this._hknp.HP_Shape_CreateConvexHull(a.offset,o)[1];else{let t=s.getTriangles(this._hknp),i=t.numObjects/3;e._pluginData=this._hknp.HP_Shape_CreateMesh(a.offset,o,t.offset,i)[1],s.freeBuffer(this._hknp,t)}s.freeBuffer(this._hknp,a)}else throw Error("No mesh provided to create physics shape.")}break;case 7:if(i.groundMesh&&this._createOptionsFromGroundMesh(i),i.numHeightFieldSamplesX&&i.numHeightFieldSamplesZ&&i.heightFieldSizeX&&i.heightFieldSizeZ&&i.heightFieldData){let t=i.numHeightFieldSamplesX*i.numHeightFieldSamplesZ,r=this._hknp._malloc(4*t),n=new Float32Array(this._hknp.HEAPU8.buffer,r,t);for(let e=0;e<i.numHeightFieldSamplesX;e++)for(let t=0;t<i.numHeightFieldSamplesZ;t++){let r=t*i.numHeightFieldSamplesX+e,s=(i.numHeightFieldSamplesX-1-e)*i.numHeightFieldSamplesZ+t;n[r]=i.heightFieldData[s]}let s=i.heightFieldSizeX/(i.numHeightFieldSamplesX-1),a=i.heightFieldSizeZ/(i.numHeightFieldSamplesZ-1);e._pluginData=this._hknp.HP_Shape_CreateHeightField(i.numHeightFieldSamplesX,i.numHeightFieldSamplesZ,[s,1,a],r)[1],this._hknp._free(r)}else throw Error("Missing required heightfield parameters");break;default:throw Error("Unsupported Shape Type.")}this._shapes.set(e._pluginData[0],e)}setShapeFilterMembershipMask(e,t){let i=this._hknp.HP_Shape_GetFilterInfo(e._pluginData)[1][1];this._hknp.HP_Shape_SetFilterInfo(e._pluginData,[t,i])}getShapeFilterMembershipMask(e){return this._hknp.HP_Shape_GetFilterInfo(e._pluginData)[1][0]}setShapeFilterCollideMask(e,t){let i=this._hknp.HP_Shape_GetFilterInfo(e._pluginData)[1][0];this._hknp.HP_Shape_SetFilterInfo(e._pluginData,[i,t])}getShapeFilterCollideMask(e){return this._hknp.HP_Shape_GetFilterInfo(e._pluginData)[1][1]}setMaterial(e,t){let i=t.friction??.5,r=t.staticFriction??i,n=t.restitution??0,s=t.frictionCombine??1,a=t.restitutionCombine??2,o=[r,i,n,this._materialCombineToNative(s),this._materialCombineToNative(a)];this._hknp.HP_Shape_SetMaterial(e._pluginData,o)}getMaterial(e){let t=this._hknp.HP_Shape_GetMaterial(e._pluginData)[1];return{staticFriction:t[0],friction:t[1],restitution:t[2],frictionCombine:this._nativeToMaterialCombine(t[3]),restitutionCombine:this._nativeToMaterialCombine(t[4])}}setDensity(e,t){this._hknp.HP_Shape_SetDensity(e._pluginData,t)}getDensity(e){return this._hknp.HP_Shape_GetDensity(e._pluginData)[1]}_getTransformInfos(e){if(e.parent)return e.computeWorldMatrix(!0),[this._bVecToV3(e.absolutePosition),this._bQuatToV4(e.absoluteRotationQuaternion)];let t=r.AA.Quaternion["0"];if(e.rotationQuaternion)t=e.rotationQuaternion;else{let i=e.rotation;r.PT.FromEulerAnglesToRef(i.x,i.y,i.z,t)}return[this._bVecToV3(e.position),this._bQuatToV4(t)]}addChild(e,t,i,r,n){let s=[i?this._bVecToV3(i):[0,0,0],r?this._bQuatToV4(r):[0,0,0,1],n?this._bVecToV3(n):[1,1,1]];this._hknp.HP_Shape_AddChild(e._pluginData,t._pluginData,s)}removeChild(e,t){this._hknp.HP_Shape_RemoveChild(e._pluginData,t)}getNumChildren(e){return this._hknp.HP_Shape_GetNumChildren(e._pluginData)[1]}setTrigger(e,t){this._hknp.HP_Shape_SetTrigger(e._pluginData,t)}getBoundingBox(e){let t=this._hknp.HP_Shape_GetBoundingBox(e._pluginData,[[0,0,0],[0,0,0,1]])[1];return r.AA.Vector3["0"].set(t[0][0],t[0][1],t[0][2]),r.AA.Vector3["1"].set(t[1][0],t[1][1],t[1][2]),new l.I(r.AA.Vector3["0"],r.AA.Vector3["1"],r.uq.IdentityReadOnly)}getBodyBoundingBox(e){let t=this.getBoundingBox(e.shape);return new l.I(t.minimum,t.maximum,e.transformNode.getWorldMatrix())}getBodyGeometry(e){let t=e._pluginDataInstances?.length>0?e._pluginDataInstances[0]:e._pluginData,i=this._hknp.HP_Body_GetShape(t.hpBodyId)[1],r=this._hknp.HP_Shape_CreateDebugDisplayGeometry(i);if(r[0]!=this._hknp.Result.RESULT_OK)return{positions:[],indices:[]};let n=this._hknp.HP_DebugGeometry_GetInfo(r[1])[1],s=new Float32Array(this._hknp.HEAPU8.buffer,n[0],3*n[1]),a=new Uint32Array(this._hknp.HEAPU8.buffer,n[2],3*n[3]),o=s.slice(0),l=a.slice(0);return this._hknp.HP_DebugGeometry_Release(r[1]),{positions:o,indices:l}}disposeShape(e){this._shapes.delete(e._pluginData[0]),this._hknp.HP_Shape_Release(e._pluginData),e._pluginData=void 0}initConstraint(e,t,i,n,s){let o=e.type,l=e.options;if(!o||!l)return void a.V.Warn("No constraint type or options. Constraint is invalid.");if(t._pluginDataInstances.length>0&&void 0===n||i._pluginDataInstances.length>0&&void 0===s)return void a.V.Warn("Body is instanced but no instance index was specified. Constraint will not be applied.");e._pluginData=e._pluginData??[];let u=this._hknp.HP_Constraint_Create()[1];e._pluginData.push(u);let h=this._getPluginReference(t,n).hpBodyId,c=this._getPluginReference(i,s).hpBodyId;this._hknp.HP_Constraint_SetParentBody(u,h),this._hknp.HP_Constraint_SetChildBody(u,c),this._constraintToBodyIdPair.set(u[0],[h[0],c[0]]);let d=l.pivotA?this._bVecToV3(l.pivotA):this._bVecToV3(r.Pq.Zero()),p=l.axisA??new r.Pq(1,0,0),f=this._tmpVec3[0];l.perpAxisA?f.copyFrom(l.perpAxisA):p.getNormalToRef(f),this._hknp.HP_Constraint_SetAnchorInParent(u,d,this._bVecToV3(p),this._bVecToV3(f));let _=l.pivotB?this._bVecToV3(l.pivotB):this._bVecToV3(r.Pq.Zero()),m=l.axisB??new r.Pq(1,0,0),g=this._tmpVec3[0];if(l.perpAxisB?g.copyFrom(l.perpAxisB):m.getNormalToRef(g),this._hknp.HP_Constraint_SetAnchorInChild(u,_,this._bVecToV3(m),this._bVecToV3(g)),e._initOptions||(e._initOptions={axisA:p.clone(),axisB:m.clone(),perpAxisA:f.clone(),perpAxisB:g.clone(),pivotA:new r.Pq(d[0],d[1],d[2]),pivotB:new r.Pq(_[0],_[1],_[2])}),5==o)this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.ANGULAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(2==o){let e=l.maxDistance||0,t=this._hknp.ConstraintAxis.LINEAR_DISTANCE;this._hknp.HP_Constraint_SetAxisMode(u,t,this._hknp.ConstraintAxisLimitMode.LIMITED),this._hknp.HP_Constraint_SetAxisMinLimit(u,t,e),this._hknp.HP_Constraint_SetAxisMaxLimit(u,t,e)}else if(3==o)this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(6==o)this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.ANGULAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(4==o)this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(1==o)this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(u,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(7==o)for(let t of e.limits){let e=this._constraintAxisToNative(t.axis);(t.minLimit??-1)==0&&(t.maxLimit??-1)==0?this._hknp.HP_Constraint_SetAxisMode(u,e,this._hknp.ConstraintAxisLimitMode.LOCKED):(void 0!=t.minLimit&&(this._hknp.HP_Constraint_SetAxisMode(u,e,this._hknp.ConstraintAxisLimitMode.LIMITED),this._hknp.HP_Constraint_SetAxisMinLimit(u,e,t.minLimit)),void 0!=t.maxLimit&&(this._hknp.HP_Constraint_SetAxisMode(u,e,this._hknp.ConstraintAxisLimitMode.LIMITED),this._hknp.HP_Constraint_SetAxisMaxLimit(u,e,t.maxLimit))),t.stiffness&&this._hknp.HP_Constraint_SetAxisStiffness(u,e,t.stiffness),t.damping&&this._hknp.HP_Constraint_SetAxisDamping(u,e,t.damping)}else throw Error("Unsupported Constraint Type.");let b=!!l.collision;this._hknp.HP_Constraint_SetCollisionsEnabled(u,b),this._hknp.HP_Constraint_SetEnabled(u,!0)}getBodiesUsingConstraint(e){let t=[];for(let i of e._pluginData){let e=this._constraintToBodyIdPair.get(i[0]);if(e){let i=this._bodies.get(e[0]),r=this._bodies.get(e[1]);i&&r&&t.push({parentBody:i.body,parentBodyIndex:i.index,childBody:r.body,childBodyIndex:r.index})}}return t}addConstraint(e,t,i,r,n){this.initConstraint(i,e,t,r,n)}setEnabled(e,t){for(let i of e._pluginData)this._hknp.HP_Constraint_SetEnabled(i,t)}getEnabled(e){let t=e._pluginData&&e._pluginData[0];return!!t&&this._hknp.HP_Constraint_GetEnabled(t)[1]}setCollisionsEnabled(e,t){for(let i of e._pluginData)this._hknp.HP_Constraint_SetCollisionsEnabled(i,t)}getCollisionsEnabled(e){let t=e._pluginData&&e._pluginData[0];return!!t&&this._hknp.HP_Constraint_GetCollisionsEnabled(t)[1]}setAxisFriction(e,t,i){for(let r of e._pluginData)this._hknp.HP_Constraint_SetAxisFriction(r,this._constraintAxisToNative(t),i)}getAxisFriction(e,t){let i=e._pluginData&&e._pluginData[0];return i?this._hknp.HP_Constraint_GetAxisFriction(i,this._constraintAxisToNative(t))[1]:null}setAxisMode(e,t,i){for(let r of e._pluginData)this._hknp.HP_Constraint_SetAxisMode(r,this._constraintAxisToNative(t),this._limitModeToNative(i))}getAxisMode(e,t){let i=e._pluginData&&e._pluginData[0];if(i){let e=this._hknp.HP_Constraint_GetAxisMode(i,this._constraintAxisToNative(t))[1];return this._nativeToLimitMode(e)}return null}setAxisMinLimit(e,t,i){for(let r of e._pluginData)this._hknp.HP_Constraint_SetAxisMinLimit(r,this._constraintAxisToNative(t),i)}getAxisMinLimit(e,t){let i=e._pluginData&&e._pluginData[0];return i?this._hknp.HP_Constraint_GetAxisMinLimit(i,this._constraintAxisToNative(t))[1]:null}setAxisMaxLimit(e,t,i){for(let r of e._pluginData)this._hknp.HP_Constraint_SetAxisMaxLimit(r,this._constraintAxisToNative(t),i)}getAxisMaxLimit(e,t){let i=e._pluginData&&e._pluginData[0];return i?this._hknp.HP_Constraint_GetAxisMaxLimit(i,this._constraintAxisToNative(t))[1]:null}setAxisMotorType(e,t,i){for(let r of e._pluginData)this._hknp.HP_Constraint_SetAxisMotorType(r,this._constraintAxisToNative(t),this._constraintMotorTypeToNative(i))}getAxisMotorType(e,t){let i=e._pluginData&&e._pluginData[0];return i?this._nativeToMotorType(this._hknp.HP_Constraint_GetAxisMotorType(i,this._constraintAxisToNative(t))[1]):null}setAxisMotorTarget(e,t,i){for(let r of e._pluginData)this._hknp.HP_Constraint_SetAxisMotorTarget(r,this._constraintAxisToNative(t),i)}getAxisMotorTarget(e,t){return e._pluginData&&e._pluginData[0]?this._hknp.HP_Constraint_GetAxisMotorTarget(e._pluginData,this._constraintAxisToNative(t))[1]:null}setAxisMotorMaxForce(e,t,i){for(let r of e._pluginData)this._hknp.HP_Constraint_SetAxisMotorMaxForce(r,this._constraintAxisToNative(t),i)}getAxisMotorMaxForce(e,t){let i=e._pluginData&&e._pluginData[0];return i?this._hknp.HP_Constraint_GetAxisMotorMaxForce(i,this._constraintAxisToNative(t))[1]:null}disposeConstraint(e){for(let t of e._pluginData)this._hknp.HP_Constraint_SetEnabled(t,!1),this._hknp.HP_Constraint_Release(t);e._pluginData.length=0}_populateHitData(e,t){let i=this._bodies.get(e[0][0]);t.body=i?.body,t.bodyIndex=i?.index,t.shape=this._shapes.get(e[1][0]);let r=e[3],n=e[4],s=e[5];t.setHitData({x:n[0],y:n[1],z:n[2]},{x:r[0],y:r[1],z:r[2]},s)}raycast(e,t,i,r){let n=r?.membership??-1,a=r?.collideWith??-1,o=r?.shouldHitTriggers??!1,l=r?.ignoreBody?[BigInt(r.ignoreBody._pluginData.hpBodyId[0])]:[BigInt(0)],u=Array.isArray(i)?i:[i];for(let i of u)i.reset(e,t);let h=[this._bVecToV3(e),this._bVecToV3(t),[n,a],o,l],c=1!==u.length&&this._multiQueryCollector?this._multiQueryCollector:this._queryCollector;this._hknp.HP_World_CastRayWithCollector(this.world,c,h);let d=this._hknp.HP_QueryCollector_GetNumHits(c)[1];if(d<=0)return;if(!u.length)for(let i=0;i<d;i++){let i=new s.G;i.reset(e,t),u.push(i)}let p=Array(d);for(let t=0;t<d;t++){let[,i]=this._hknp.HP_QueryCollector_GetCastRayResult(c,t)[1],r=i[3];e.subtractFromFloatsToRef(r[0],r[1],r[2],this._tmpVec3[0]);let n=this._tmpVec3[0].lengthSquared();p[t]={hitData:i,distance:n}}p.sort((e,t)=>e.distance-t.distance);for(let e=0;e<Math.min(d,u.length);e++){let t=u[e],i=p[e];this._populateHitData(i.hitData,t),t.setHitDistance(Math.sqrt(i.distance))}}pointProximity(e,t){let i=e?.collisionFilter?.membership??-1,r=e?.collisionFilter?.collideWith??-1;t.reset();let n=e.ignoreBody?[BigInt(e.ignoreBody._pluginData.hpBodyId[0])]:[BigInt(0)],s=[this._bVecToV3(e.position),e.maxDistance,[i,r],e.shouldHitTriggers,n];if(this._hknp.HP_World_PointProximityWithCollector(this.world,this._queryCollector,s),this._hknp.HP_QueryCollector_GetNumHits(this._queryCollector)[1]>0){let[e,i]=this._hknp.HP_QueryCollector_GetPointProximityResult(this._queryCollector,0)[1];this._populateHitData(i,t),t.setHitDistance(e)}}shapeProximity(e,t,i){t.reset(),i.reset();let r=e.shape._pluginData,n=e.ignoreBody?[BigInt(e.ignoreBody._pluginData.hpBodyId[0])]:[BigInt(0)],s=[r,this._bVecToV3(e.position),this._bQuatToV4(e.rotation),e.maxDistance,e.shouldHitTriggers,n];if(this._hknp.HP_World_ShapeProximityWithCollector(this.world,this._queryCollector,s),this._hknp.HP_QueryCollector_GetNumHits(this._queryCollector)[1]>0){let[e,r,n]=this._hknp.HP_QueryCollector_GetShapeProximityResult(this._queryCollector,0)[1];this._populateHitData(r,t),this._populateHitData(n,i),t.setHitDistance(e),i.setHitDistance(e)}}shapeCast(e,t,i){t.reset(),i.reset();let r=e.shape._pluginData,n=e.ignoreBody?[BigInt(e.ignoreBody._pluginData.hpBodyId[0])]:[BigInt(0)],s=[r,this._bQuatToV4(e.rotation),this._bVecToV3(e.startPosition),this._bVecToV3(e.endPosition),e.shouldHitTriggers,n];if(this._hknp.HP_World_ShapeCastWithCollector(this.world,this._queryCollector,s),this._hknp.HP_QueryCollector_GetNumHits(this._queryCollector)[1]>0){let[e,r,n]=this._hknp.HP_QueryCollector_GetShapeCastResult(this._queryCollector,0)[1];this._populateHitData(r,t),this._populateHitData(n,i),t.setHitFraction(e),i.setHitFraction(e)}}getCollisionObservable(e){let t=e._pluginData.hpBodyId[0],i=this._bodyCollisionObservable.get(t);return i||(i=new p.cP,this._bodyCollisionObservable.set(t,i)),i}getCollisionEndedObservable(e){let t=e._pluginData.hpBodyId[0],i=this._bodyCollisionEndedObservable.get(t);return i||(i=new p.cP,this._bodyCollisionEndedObservable.set(t,i)),i}setCollisionCallbackEnabled(e,t){let i=this._hknp.EventType.COLLISION_STARTED.value|this._hknp.EventType.COLLISION_CONTINUED.value|this._hknp.EventType.COLLISION_FINISHED.value;if(e._pluginDataInstances&&e._pluginDataInstances.length)for(let r=0;r<e._pluginDataInstances.length;r++){let n=e._pluginDataInstances[r];this._hknp.HP_Body_SetEventMask(n.hpBodyId,t?i:0)}else e._pluginData&&this._hknp.HP_Body_SetEventMask(e._pluginData.hpBodyId,t?i:0)}setCollisionEndedCallbackEnabled(e,t){let i=this._getPluginReference(e),r=this._hknp.HP_Body_GetEventMask(i.hpBodyId)[1];if(r=t?r|this._hknp.EventType.COLLISION_FINISHED.value:r&~this._hknp.EventType.COLLISION_FINISHED.value,e._pluginDataInstances&&e._pluginDataInstances.length)for(let t=0;t<e._pluginDataInstances.length;t++){let i=e._pluginDataInstances[t];this._hknp.HP_Body_SetEventMask(i.hpBodyId,r)}else e._pluginData&&this._hknp.HP_Body_SetEventMask(e._pluginData.hpBodyId,r)}_notifyTriggers(){let e=this._hknp.HP_World_GetTriggerEvents(this.world)[1],t=new b;for(;e;){b.readToRef(this._hknp.HEAPU8.buffer,e,t);let i=this._bodies.get(t.bodyIdA),r=this._bodies.get(t.bodyIdB);if(i&&r){let e={collider:i.body,colliderIndex:i.index,collidedAgainst:r.body,collidedAgainstIndex:r.index,type:this._nativeTriggerCollisionValueToCollisionType(t.type)};this.onTriggerCollisionObservable.notifyObservers(e)}e=this._hknp.HP_World_GetNextTriggerEvent(this.world,e)}}_notifyCollisions(){let e=this._hknp.HP_World_GetCollisionEvents(this.world)[1],t=new g,i=Number(this.world);for(;e;){g.readToRef(this._hknp.HEAPU8.buffer,e,t);let n=this._bodies.get(t.contactOnA.bodyId),s=this._bodies.get(t.contactOnB.bodyId);if(n&&s){let e={collider:n.body,colliderIndex:n.index,collidedAgainst:s.body,collidedAgainstIndex:s.index,type:this._nativeCollisionValueToCollisionType(t.type)};if("COLLISION_FINISHED"===e.type)this.onCollisionEndedObservable.notifyObservers(e);else{t.contactOnB.position.subtractToRef(t.contactOnA.position,this._tmpVec3[0]);let i=r.Pq.Dot(this._tmpVec3[0],t.contactOnA.normal);e.point=t.contactOnA.position,e.distance=i,e.impulse=t.impulseApplied,e.normal=t.contactOnA.normal,this.onCollisionObservable.notifyObservers(e)}if(this._bodyCollisionObservable.size&&"COLLISION_FINISHED"!==e.type){let i=this._bodyCollisionObservable.get(t.contactOnA.bodyId),a=this._bodyCollisionObservable.get(t.contactOnB.bodyId);t.contactOnA.position.subtractToRef(t.contactOnB.position,this._tmpVec3[0]);let o=r.Pq.Dot(this._tmpVec3[0],t.contactOnB.normal);if(i&&i.notifyObservers(e),a){let e={collider:s.body,colliderIndex:s.index,collidedAgainst:n.body,collidedAgainstIndex:n.index,point:t.contactOnB.position,distance:o,impulse:t.impulseApplied,normal:t.contactOnB.normal,type:this._nativeCollisionValueToCollisionType(t.type)};a.notifyObservers(e)}}else if(this._bodyCollisionEndedObservable.size){let i=this._bodyCollisionEndedObservable.get(t.contactOnA.bodyId),a=this._bodyCollisionEndedObservable.get(t.contactOnB.bodyId);t.contactOnA.position.subtractToRef(t.contactOnB.position,this._tmpVec3[0]);let o=r.Pq.Dot(this._tmpVec3[0],t.contactOnB.normal);if(i&&i.notifyObservers(e),a){let e={collider:s.body,colliderIndex:s.index,collidedAgainst:n.body,collidedAgainstIndex:n.index,point:t.contactOnB.position,distance:o,impulse:t.impulseApplied,normal:t.contactOnB.normal,type:this._nativeCollisionValueToCollisionType(t.type)};a.notifyObservers(e)}}}e=this._hknp.HP_World_GetNextCollisionEvent(i,e)}}get numBodies(){return this._hknp.HP_World_GetNumBodies(this.world)[1]}dispose(){this._queryCollector&&(this._hknp.HP_QueryCollector_Release(this._queryCollector),this._queryCollector=void 0),this._multiQueryCollector&&(this._hknp.HP_QueryCollector_Release(this._multiQueryCollector),this._multiQueryCollector),this.world&&(this._hknp.HP_World_Release(this.world),this.world=void 0)}_v3ToBvecRef(e,t){t.set(e[0],e[1],e[2])}_bVecToV3(e){return[e._x,e._y,e._z]}_bQuatToV4(e){return[e._x,e._y,e._z,e._w]}_constraintMotorTypeToNative(e){switch(e){case 2:return this._hknp.ConstraintMotorType.POSITION;case 1:return this._hknp.ConstraintMotorType.VELOCITY}return this._hknp.ConstraintMotorType.NONE}_nativeToMotorType(e){switch(e){case this._hknp.ConstraintMotorType.POSITION:return 2;case this._hknp.ConstraintMotorType.VELOCITY:return 1}return 0}_materialCombineToNative(e){switch(e){case 0:return this._hknp.MaterialCombine.GEOMETRIC_MEAN;case 1:return this._hknp.MaterialCombine.MINIMUM;case 2:return this._hknp.MaterialCombine.MAXIMUM;case 3:return this._hknp.MaterialCombine.ARITHMETIC_MEAN;case 4:return this._hknp.MaterialCombine.MULTIPLY}}_nativeToMaterialCombine(e){switch(e){case this._hknp.MaterialCombine.GEOMETRIC_MEAN:return 0;case this._hknp.MaterialCombine.MINIMUM:return 1;case this._hknp.MaterialCombine.MAXIMUM:return 2;case this._hknp.MaterialCombine.ARITHMETIC_MEAN:return 3;case this._hknp.MaterialCombine.MULTIPLY:return 4;default:return}}_constraintAxisToNative(e){switch(e){case 0:return this._hknp.ConstraintAxis.LINEAR_X;case 1:return this._hknp.ConstraintAxis.LINEAR_Y;case 2:return this._hknp.ConstraintAxis.LINEAR_Z;case 3:return this._hknp.ConstraintAxis.ANGULAR_X;case 4:return this._hknp.ConstraintAxis.ANGULAR_Y;case 5:return this._hknp.ConstraintAxis.ANGULAR_Z;case 6:return this._hknp.ConstraintAxis.LINEAR_DISTANCE}}_nativeToLimitMode(e){switch(e){case this._hknp.ConstraintAxisLimitMode.FREE:break;case this._hknp.ConstraintAxisLimitMode.LIMITED:return 1;case this._hknp.ConstraintAxisLimitMode.LOCKED:return 2}return 0}_limitModeToNative(e){switch(e){case 0:return this._hknp.ConstraintAxisLimitMode.FREE;case 1:return this._hknp.ConstraintAxisLimitMode.LIMITED;case 2:return this._hknp.ConstraintAxisLimitMode.LOCKED}}_nativeCollisionValueToCollisionType(e){switch(e){case this._hknp.EventType.COLLISION_STARTED.value:break;case this._hknp.EventType.COLLISION_FINISHED.value:return"COLLISION_FINISHED";case this._hknp.EventType.COLLISION_CONTINUED.value:return"COLLISION_CONTINUED"}return"COLLISION_STARTED"}_nativeTriggerCollisionValueToCollisionType(e){switch(e){case 8:break;case 16:return"TRIGGER_EXITED"}return"TRIGGER_ENTERED"}}},10023(e,t,i){i.d(t,{P:()=>r.P});var r=i(73869)},69103(e,t,i){i.d(t,{Z:()=>s,l:()=>g});var r,n,s,a,o=i(70134),l=i(80001),u=i(96028),h=i(70728),c=i(60871),d=i(52969);(r=s||(s={}))[r.UNSUPPORTED=0]="UNSUPPORTED",r[r.SLIDING=1]="SLIDING",r[r.SUPPORTED=2]="SUPPORTED",(n=a||(a={}))[n.OK=0]="OK",n[n.FAILURE_3D=1]="FAILURE_3D",n[n.FAILURE_2D=2]="FAILURE_2D";class p{}class f{copyFrom(e){this.index=e.index,this.constraint=e.constraint,this.interaction=e.interaction}}class _{constructor(){this.supportPlanes=[,,,,],this.numSupportPlanes=0,this.currentTime=0}getOutput(e){return this.outputInteractions[this.inputConstraints.indexOf(e)]}}function m(e,t,i,r,n){let s=e._bodies,a=o.Pq.FromArray(t[4]),l=-r*i.dot(a);return{position:o.Pq.FromArray(t[3]),normal:a,distance:l,fraction:r,bodyB:s.get(t[0][0]),allowedPenetration:Math.min(Math.max(n-l,0),n)}}class g{constructor(e,t,i){this._orientation=o.PT.Identity(),this._manifold=[],this._contactAngleSensitivity=10,this._tmpMatrix=new o.uq,this._tmpVecs=(0,h.mI)(32,o.Pq.Zero),this.keepDistance=.05,this.keepContactTolerance=.1,this.maxCastIterations=10,this.penetrationRecoverySpeed=1,this.staticFriction=0,this.dynamicFriction=1,this.maxSlopeCosine=.5,this.maxCharacterSpeedForSolver=10,this.up=new o.Pq(0,1,0),this.characterStrength=1e38,this.acceleration=.05,this.maxAcceleration=50,this.characterMass=0,this.onTriggerCollisionObservable=new d.cP,this._displacementEps=1e-4,this._bodyPositionTracking=new Map,this._position=e.clone(),this._velocity=o.Pq.Zero(),this._lastVelocity=o.Pq.Zero();const r=t.capsuleRadius??.6,n=t.capsuleHeight??1.8;this._tmpVecs[0].set(0,.5*n-r,0),this._tmpVecs[1].set(0,-(.5*n)+r,0),this._ownShape=!t.shape,this._shape=t.shape??new u.cw(this._tmpVecs[0],this._tmpVecs[1],r,i),this._transformNode=new c.V("CCTransformNode",i),this._transformNode.position.copyFrom(this._position),this._body=new l.a(this._transformNode,1,!1,i),this._body.setMassProperties({inertia:o.Pq.ZeroReadOnly}),this._body.shape=this._shape,this._body.disablePreStep=!1,this._lastInvDeltaTime=1/60,this._lastDisplacement=o.Pq.Zero(),this._scene=i;const s=this._scene.getPhysicsEngine().getPhysicsPlugin()._hknp;this._startCollector=s.HP_QueryCollector_Create(16)[1],this._castCollector=s.HP_QueryCollector_Create(16)[1]}dispose(){this._ownShape&&this._shape.dispose(),this._body.dispose(),this._transformNode.dispose();let e=this._scene.getPhysicsEngine().getPhysicsPlugin()._hknp;e.HP_QueryCollector_Release(this._startCollector),e.HP_QueryCollector_Release(this._castCollector)}get shape(){return this._shape}set shape(e){this._body.shape=this._shape,this._ownShape&&this._shape.dispose(),this._shape=e,this._ownShape=!1}getPosition(){return this._position}setPosition(e){this._position.copyFrom(e),this._transformNode.position.copyFrom(this._position)}getVelocity(){return this._velocity}setVelocity(e){this._velocity.copyFrom(e)}_validateManifold(){let e=[];for(let t=0;t<this._manifold.length;t++)this._manifold[t].bodyB.body.isDisposed||e.push(this._manifold[t]);this._manifold=e}_getPointVelocityToRef(e,t,i){let r=this._tmpVecs[10];this._getComWorldToRef(e,r);let n=this._tmpVecs[11];t.subtractToRef(r,n);let s=this._tmpVecs[12];e.body.getAngularVelocityToRef(s,e.index);let a=this._tmpVecs[13];o.Pq.CrossToRef(s,n,a),a.addToRef(e.body.getLinearVelocity(e.index),i)}_compareContacts(e,t){let i=(1-e.normal.dot(t.normal))*this._contactAngleSensitivity*this._contactAngleSensitivity,r=(e.distance-t.distance)*(e.distance*t.distance),n=this._tmpVecs[7];this._getPointVelocityToRef(e.bodyB,e.position,n);let s=this._tmpVecs[8];this._getPointVelocityToRef(t.bodyB,t.position,s);let a=this._tmpVecs[9];return n.subtractToRef(s,a),10*i+.1*a.lengthSquared()+r}_findContact(e,t,i){let r=-1,n=i;for(let i=0;i<t.length;i++){let s=this._compareContacts(e,t[i]);s<n&&(n=s,r=i)}return r}_updateManifold(e,t,i){let r=this._scene.getPhysicsEngine().getPhysicsPlugin(),n=r._hknp,s=n.HP_QueryCollector_GetNumHits(e)[1];if(s>0){let t=[],i=1e38,a=r._bodies;for(let r=0;r<s;r++){let[s,,l]=n.HP_QueryCollector_GetShapeProximityResult(e,r)[1];i=Math.min(i,s),t.push({position:o.Pq.FromArray(l[3]),normal:o.Pq.FromArray(l[4]),distance:s,fraction:0,bodyB:a.get(l[0][0]),allowedPenetration:Math.min(Math.max(this.keepDistance-s,0),this.keepDistance)})}for(let e=this._manifold.length-1;e>=0;e--){let i=this._manifold[e],r=this._findContact(i,t,1.1);if(r>=0){let n=Math.min(Math.max(this.keepDistance-t[r].distance,0),i.allowedPenetration);this._manifold[e]=t[r],this._manifold[e].allowedPenetration=n,t.splice(r,1)}else this._manifold.splice(e,1)}let l=t.findIndex(e=>e.distance==i);if(l>=0){let e=this._findContact(t[l],this._manifold,.1);if(e>=0){let i=Math.min(Math.max(this.keepDistance-t[l].distance,0),this._manifold[e].allowedPenetration);this._manifold[e]=t[l],this._manifold[e].allowedPenetration=i}else this._manifold.push(t[l])}}else this._manifold.length=0;let a=0,l=n.HP_QueryCollector_GetNumHits(t)[1];if(l>0){let e=null;for(let s=0;s<l;s++){let[o,,l]=n.HP_QueryCollector_GetShapeCastResult(t,s)[1];if(null==e){let t=m(r,l,i,o,this.keepDistance);if(e=l[0][0],-1==this._findContact(t,this._manifold,.1)&&this._manifold.push(t),0==t.bodyB.body.getMotionType(t.bodyB.index))break}else if(e._pluginData&&l[0]!=e._pluginData.hpBodyId){a++;break}}}for(let e=this._manifold.length-1;e>=0;e--){let t=e-1;for(;t>=0&&!(.1>this._compareContacts(this._manifold[e],this._manifold[t]));t--);t>=0&&this._manifold.slice(e,1)}return a}_createSurfaceConstraint(e,t,i){let r={planeNormal:t.normal.clone(),planeDistance:t.distance,staticFriction:this.staticFriction,dynamicFriction:this.dynamicFriction,extraUpStaticFriction:0,extraDownStaticFriction:0,velocity:o.Pq.Zero(),angularVelocity:o.Pq.Zero(),priority:0},n=Math.max(this.maxSlopeCosine,.1),s=t.normal.dot(this.up),a=t.position.clone();if(s>n){let e=this.getPosition(),i=this._tmpVecs[20];t.position.subtractToRef(e,i);let r=t.normal.dot(i);a.x=e.x+this.up.x*r,a.y=e.y+this.up.y*r,a.z=e.z+this.up.z*r}let l=t.bodyB.body.getMotionType(t.bodyB.index),u=r.velocity.dot(r.planeNormal)*i;if(r.planeDistance-=u,0==l)r.priority=2;else if(1==l){let i=t.bodyB.body.transformNode.uniqueId,n=this._bodyPositionTracking.get(i),s=t.bodyB.body.transformNode.getWorldMatrix(),a=this._scene.getFrameId();if(n){if(n.frameId+1===a){let t=n.prevWorldMatrix,i=o.AA.Matrix["1"];s.invertToRef(i);let a=this.getPosition(),l=this._tmpVecs[21];o.Pq.TransformCoordinatesToRef(a,i,l);let u=this._tmpVecs[22];o.Pq.TransformCoordinatesToRef(l,t,u);let h=this._tmpVecs[23];a.subtractToRef(u,h),r.velocity.copyFrom(h),r.velocity.scaleInPlace(1/e),r.priority=1}n.prevWorldMatrix.copyFrom(s),n.frameId=a}else n={prevWorldMatrix:s.clone(),frameId:a},this._bodyPositionTracking.set(i,n)}return r}_addMaxSlopePlane(e,t,i,r,n){let s=r[i].planeNormal.dot(t);if(s>.01&&s<e){let e={planeNormal:r[i].planeNormal.clone(),planeDistance:r[i].planeDistance,velocity:r[i].velocity.clone(),angularVelocity:r[i].angularVelocity.clone(),priority:r[i].priority,dynamicFriction:r[i].dynamicFriction,staticFriction:r[i].staticFriction,extraDownStaticFriction:r[i].extraDownStaticFriction,extraUpStaticFriction:r[i].extraUpStaticFriction},a=e.planeDistance;return e.planeNormal.subtractInPlace(t.scale(s)),e.planeNormal.normalize(),a>=0?e.planeDistance=a*e.planeNormal.dot(r[i].planeNormal):(e.planeDistance=Math.min(0,a+n)/e.planeNormal.dot(r[i].planeNormal),r[i].planeDistance=0,this._resolveConstraintPenetration(e,this.penetrationRecoverySpeed)),r.push(e),!0}return!1}_resolveConstraintPenetration(e,t){e.planeDistance<-1e-6&&(e.planeNormal.scaleToRef(e.planeDistance*t,this._tmpVecs[6]),e.velocity.subtractInPlace(this._tmpVecs[6]))}_createConstraintsFromManifold(e,t){let i=[];for(let r=0;r<this._manifold.length;r++){let n=this._createSurfaceConstraint(e,this._manifold[r],t);i.push(n),this._addMaxSlopePlane(this.maxSlopeCosine,this.up,r,i,this._manifold[r].allowedPenetration),this._resolveConstraintPenetration(n,this.penetrationRecoverySpeed)}return i}_simplexSolverSortInfo(e){for(let t=0;t<e.numSupportPlanes-1;t++)for(let i=t+1;i<e.numSupportPlanes;i++){let r=e.supportPlanes[t],n=e.supportPlanes[i];if(!(r.constraint.priority<n.constraint.priority)){if(r.constraint.priority==n.constraint.priority&&r.constraint.velocity.lengthSquared()<n.constraint.velocity.lengthSquared())continue;e.supportPlanes[t]=n,e.supportPlanes[i]=r}}}_simplexSolverSolve1d(e,t,i,r){let n=t.velocity,s=this._tmpVecs[22];i.subtractToRef(n,s);let a=s.dot(t.planeNormal),o=s.lengthSquared();s.subtractInPlace(t.planeNormal.scale(a));{let e=a*a,i=s.dot(this.up)>0?t.extraUpStaticFriction:t.extraDownStaticFriction;if(i>0){let a=this.up.cross(t.planeNormal),l=a.lengthSquared(),u=0;if(l>1e-5){a.scaleInPlace(1/Math.sqrt(l)),u=s.dot(a);{let i=u*u;e*(t.staticFriction*t.staticFriction)>=i&&(s.subtractInPlace(a.scale(u)),u=0)}}{let s=o-u*u-e;if(e*((t.staticFriction+i)*(t.staticFriction+i))>=s&&0==u)return void r.copyFrom(n)}}else if(e*(1+t.staticFriction*t.staticFriction)>=o)return void r.copyFrom(n)}if(t.dynamicFriction<1){let e=s.lengthSquared();if(e>=1e-5&&e>1e-4*o){let i=Math.sqrt(o/e);i=t.dynamicFriction+(1-t.dynamicFriction)*i,s.scaleInPlace(i);let r=t.planeNormal.dot(s);s.subtractInPlace(t.planeNormal.scale(r))}}r.copyFrom(s),r.addInPlace(n)}_simplexSolverSolveTest1d(e,t){let i=this._tmpVecs[23];return t.subtractToRef(e.velocity,i),-.001>i.dot(e.planeNormal)}_simplexSolverSolve2d(e,t,i,r,n,s){let a=i.planeNormal.cross(r.planeNormal),l=a.lengthSquared(),u=!1,h=null;for(;;){if(l<=1e-5||u){e.getOutput(i).status=2,e.getOutput(r).status=2,i.priority>r.priority?(this._simplexSolverSolve1d(e,r,n,s),this._simplexSolverSolve1d(e,i,n,s)):(this._simplexSolverSolve1d(e,i,n,s),this._simplexSolverSolve1d(e,r,n,s));return}let c=1/Math.sqrt(l);a.scaleInPlace(c);{let e=i.planeNormal.cross(r.planeNormal),n=r.planeNormal.cross(a),s=a.cross(i.planeNormal),l=i.velocity.add(r.velocity),d=this._tmpVecs[2];d.set(.5*a.dot(l),i.planeNormal.dot(i.velocity),r.planeNormal.dot(r.velocity));let p=o.uq.FromValues(e.x,n.x,s.x,0,e.y,n.y,s.y,0,e.z,n.z,s.z,0,0,0,0,1);if((h=o.Pq.TransformNormal(d,p)).scaleInPlace(c),Math.abs(h.x)>t.x||Math.abs(h.y)>t.y||Math.abs(h.z)>t.z)u=!0;else break}}let c=h,d=this._tmpVecs[24];n.subtractToRef(c,d);let p=d.lengthSquared(),f=this.up.dot(a),_=d.dot(a),m=i.staticFriction+r.staticFriction;f*_>0?m+=(i.extraUpStaticFriction+r.extraUpStaticFriction)*f:m+=(i.extraDownStaticFriction+r.extraDownStaticFriction)*f,m*=.5;let g=(i.dynamicFriction+r.dynamicFriction)*.5,b=_*_;if(m*m*(p-b)>=b)return void s.copyFrom(c);if(g<1&&_*_>1e-4*p){let e=Math.abs(1/_)*Math.sqrt(p)*(1-g)+g;_*=e}s.copyFrom(c),s.addInPlace(a.scale(_))}_simplexSolverSolve3d(e,t,i,r,n,s,a,l){let u=null;{let h=r.planeNormal.cross(n.planeNormal),c=n.planeNormal.cross(i.planeNormal),d=i.planeNormal.cross(r.planeNormal),p=h.dot(i.planeNormal),f=!1;for(;;){if(1e-5>Math.abs(p)||f){s&&(this._simplexSolverSortInfo(e),i=e.supportPlanes[0].constraint,r=e.supportPlanes[1].constraint,n=e.supportPlanes[2].constraint),e.getOutput(i).status=1,e.getOutput(r).status=1,e.getOutput(n).status=1;let o=e.numSupportPlanes;this._simplexSolverSolve2d(e,t,i,r,a,l),o==e.numSupportPlanes&&this._simplexSolverSolve2d(e,t,i,n,a,l),o==e.numSupportPlanes&&this._simplexSolverSolve2d(e,t,r,n,a,l);return}let _=this._tmpVecs[2];_.set(i.planeNormal.dot(i.velocity),r.planeNormal.dot(r.velocity),n.planeNormal.dot(n.velocity));let m=o.uq.FromValues(h.x,h.y,h.z,0,c.x,c.y,c.z,0,d.x,d.y,d.z,0,0,0,0,1);if((u=o.Pq.TransformNormal(_,m)).scaleInPlace(1/p),Math.abs(u.x)>t.x||Math.abs(u.y)>t.y||Math.abs(u.z)>t.z)f=!0;else break}}l.copyFrom(u)}_simplexSolverExamineActivePlanes(e,t,i,r){for(;;)switch(e.numSupportPlanes){case 1:{let t=e.supportPlanes[0].constraint;this._simplexSolverSolve1d(e,t,i,r);return}case 2:{let n=o.Pq.Zero();this._simplexSolverSolve1d(e,e.supportPlanes[1].constraint,i,n),this._simplexSolverSolveTest1d(e.supportPlanes[0].constraint,n)?this._simplexSolverSolve2d(e,t,e.supportPlanes[0].constraint,e.supportPlanes[1].constraint,i,r):(e.supportPlanes[0].copyFrom(e.supportPlanes[1]),e.numSupportPlanes=1,r.copyFrom(n));return}case 3:{let t=o.Pq.Zero();if(this._simplexSolverSolve1d(e,e.supportPlanes[2].constraint,i,r),!this._simplexSolverSolveTest1d(e.supportPlanes[0].constraint,t)&&!this._simplexSolverSolveTest1d(e.supportPlanes[1].constraint,t)){r.copyFrom(t),e.supportPlanes[0].copyFrom(e.supportPlanes[2]),e.numSupportPlanes=1;continue}}{let n=!1;for(let s=0;s<2;s++){let a=o.Pq.Zero();if(this._simplexSolverSolve2d(e,t,e.supportPlanes[s].constraint,e.supportPlanes[2].constraint,i,r),!this._simplexSolverSolveTest1d(e.supportPlanes[1-s].constraint,a)){e.supportPlanes[0].copyFrom(e.supportPlanes[s]),e.supportPlanes[1].copyFrom(e.supportPlanes[2]),e.numSupportPlanes--,n=!0;break}}if(n)continue}this._simplexSolverSolve3d(e,t,e.supportPlanes[0].constraint,e.supportPlanes[1].constraint,e.supportPlanes[2].constraint,!0,i,r);return;case 4:{this._simplexSolverSortInfo(e);let n=!1;for(let r=0;r<3;r++){let s=o.Pq.Zero();if(this._simplexSolverSolve3d(e,t,e.supportPlanes[(r+1)%3].constraint,e.supportPlanes[(r+2)%3].constraint,e.supportPlanes[3].constraint,!1,i,s),!this._simplexSolverSolveTest1d(e.supportPlanes[r].constraint,s)){e.supportPlanes[r].copyFrom(e.supportPlanes[2]),e.supportPlanes[2].copyFrom(e.supportPlanes[3]),e.numSupportPlanes=3,n=!0;break}}if(n)continue;{let n=i.clone(),s=e.supportPlanes[0].constraint,a=e.supportPlanes[1].constraint,o=e.supportPlanes[2].constraint,l=e.supportPlanes[3].constraint,u=e.numSupportPlanes;u==e.numSupportPlanes?this._simplexSolverSolve3d(e,t,s,a,o,!1,n,n):u==e.numSupportPlanes?this._simplexSolverSolve3d(e,t,s,a,l,!1,n,n):u==e.numSupportPlanes?this._simplexSolverSolve3d(e,t,s,o,l,!1,n,n):u==e.numSupportPlanes&&this._simplexSolverSolve3d(e,t,a,o,l,!1,n,n),r.copyFrom(n)}{let t=0;for(let i=0;i<4;i++)t=Math.max(t,e.supportPlanes[i].interaction.status);let i=0;for(;i<4;i++){if(t==e.supportPlanes[i].interaction.status){e.supportPlanes[i].copyFrom(e.supportPlanes[3]);break}e.numSupportPlanes--}}for(let t=0;t<3;t++)e.supportPlanes[t].interaction.status=0;continue}}}_simplexSolverSolve(e,t,i,r,n,s){let a=new p;a.position=o.Pq.Zero(),a.velocity=t.clone(),a.planeInteractions=[];let l=i;for(let t=0;t<e.length;t++)a.planeInteractions.push({touched:!1,stopped:!1,surfaceTime:0,penaltyDistance:0,status:0});let u=new _;for(u.inputConstraints=e,u.outputInteractions=a.planeInteractions,u.supportPlanes[0]=new f,u.supportPlanes[1]=new f,u.supportPlanes[2]=new f,u.supportPlanes[3]=new f;l>0;){let n=-1,o=l;for(let t=0;t<e.length;t++){if(u.numSupportPlanes>=1&&u.supportPlanes[0].index==t||u.numSupportPlanes>=2&&u.supportPlanes[1].index==t||u.numSupportPlanes>=3&&u.supportPlanes[2].index==t||0!=a.planeInteractions[t].status)continue;let i=e[t],r=this._tmpVecs[25];a.velocity.subtractToRef(i.velocity,r);let s=-r.dot(i.planeNormal);if(s<=0)continue;let l=this._tmpVecs[26];i.velocity.scaleToRef(u.currentTime,this._tmpVecs[27]),a.position.subtractToRef(this._tmpVecs[27],l);let h=i.planeNormal.dot(l),c=a.planeInteractions[t].penaltyDistance;c<1e-6&&(h=0),(h+=c)<o*s&&(o=h/s,n=t)}if(o>1e-4){u.currentTime+=o,l-=o,a.position.addInPlace(a.velocity.scale(o));for(let e=0;e<u.numSupportPlanes;e++)u.supportPlanes[e].interaction.surfaceTime+=o,u.supportPlanes[e].interaction.touched=!0;if(a.deltaTime=u.currentTime,u.currentTime>r)break}if(n<0){a.deltaTime=i;break}let h=u.supportPlanes[u.numSupportPlanes++];h.constraint=e[n],h.interaction=a.planeInteractions[n],h.interaction.penaltyDistance=(h.interaction.penaltyDistance+1e-6)*2,h.index=n,this._simplexSolverExamineActivePlanes(u,s,t,a.velocity)}return a}checkSupport(e,t){let i={isSurfaceDynamic:!1,supportedState:0,averageSurfaceNormal:o.Pq.Zero(),averageSurfaceVelocity:o.Pq.Zero(),averageAngularSurfaceVelocity:o.Pq.Zero()};return this.checkSupportToRef(e,t,i),i}checkSupportToRef(e,t,i){this._validateManifold();let r=this._createConstraintsFromManifold(e,0),n=[];for(let e=0;e<r.length;e++)n.push(r[e].velocity.clone()),r[e].velocity.setAll(0);let s=this._tmpVecs[3];s.set(this.maxCharacterSpeedForSolver,this.maxCharacterSpeedForSolver,this.maxCharacterSpeedForSolver);let a=this._simplexSolverSolve(r,t,e,e,this.up,s);if(i.averageSurfaceVelocity.setAll(0),i.averageAngularSurfaceVelocity.setAll(0),i.averageSurfaceNormal.setAll(0),i.isSurfaceDynamic=!1,a.velocity.equalsWithEpsilon(t,1e-4)){i.supportedState=0;return}if(1e-4>a.velocity.lengthSquared())i.supportedState=2;else{a.velocity.normalize();let e=a.velocity.dot(t);1-e*e<this.maxSlopeCosine*this.maxSlopeCosine?i.supportedState=1:i.supportedState=2}let o=0;for(let e=-0;e<r.length;e++)a.planeInteractions[e].touched&&-.08>r[e].planeNormal.dot(t)&&(i.averageSurfaceNormal.addInPlace(r[e].planeNormal),i.averageSurfaceVelocity.addInPlace(n[e]),i.averageAngularSurfaceVelocity.addInPlace(r[e].angularVelocity),o++);if(o>0&&(i.averageSurfaceNormal.normalize(),i.averageSurfaceVelocity.scaleInPlace(1/o),i.averageAngularSurfaceVelocity.scaleInPlace(1/o)),2==i.supportedState)for(let e=0;e<this._manifold.length;e++){let r=this._manifold[e].bodyB;if(-.08>this._manifold[e].normal.dot(t)&&2==r.body.getMotionType(0)){i.isSurfaceDynamic=!0;break}}}_castWithCollectors(e,t,i,r){let n=this._scene.getPhysicsEngine().getPhysicsPlugin(),s=n._hknp,a=[e.x,e.y,e.z],o=[this._orientation.x,this._orientation.y,this._orientation.z,this._orientation.w];if(null!=r){let e=[this._shape._pluginData,a,o,this.keepDistance+this.keepContactTolerance,!1,[this._body._pluginData.hpBodyId[0]]];s.HP_World_ShapeProximityWithCollector(n.world,r,e)}{let e=[this._shape._pluginData,o,a,[t.x,t.y,t.z],!1,[this._body._pluginData.hpBodyId[0]]];s.HP_World_ShapeCastWithCollector(n.world,i,e)}}_resolveContacts(e,t){for(let i=0;i<this._manifold.length;i++){let r=this._manifold[i],n=this._manifold[i].bodyB;if(2==n.body.getMotionType(n.index)){let i=0,s=o.Pq.Zero(),a=r.position,l=this._tmpVecs[19];this._getPointVelocityToRef(n,r.position,l),l.subtractInPlace(this._velocity);let u=l.dot(r.normal),h=-(.9*u);if(r.distance<0&&(h+=.4*r.distance/e),h<0){let t=this._getInverseInertiaWorld(n),a=this._tmpVecs[15];this._getComWorldToRef(n,a);let l=this._tmpVecs[16];r.position.subtractToRef(a,l);let u=this._tmpVecs[17];o.Pq.CrossToRef(l,r.normal,u);let c=this._tmpVecs[18];o.Pq.TransformNormalToRef(u,t,c),i=h/(c.dot(u)+this._getInvMass(n));let d=-this.characterStrength*e;i<d&&(i=d),s=r.normal.scale(i)}else i=0,this._getInvMass(n);{let i=r.normal.dot(t.scale(e));u<0&&(i-=u),i<-1e-12&&s.addInPlace(r.normal.scale(this.characterMass*i))}let c={collider:n.body,colliderIndex:n.index,impulse:s,impulsePosition:a};this.onTriggerCollisionObservable.notifyObservers(c),n.body.applyImpulse(s,a,n.index)}}}_getInverseInertiaWorld(e){let t=e.body.getMassProperties(e.index);if(!t.inertia||!t.inertiaOrientation)return o.uq.IdentityReadOnly;let i=o.uq.FromQuaternionToRef(t.inertiaOrientation,o.AA.Matrix["0"]).invert(),r=o.AA.Matrix["1"],n=i.getRowToRef(0,o.AA.Vector4["0"]);return r.setRowFromFloats(0,t.inertia.x*n.x,t.inertia.x*n.y,t.inertia.x*n.z,0),i.getRowToRef(1,n),r.setRowFromFloats(0,t.inertia.y*n.x,t.inertia.y*n.y,t.inertia.y*n.z,0),i.getRowToRef(2,n),r.setRowFromFloats(0,t.inertia.z*n.x,t.inertia.z*n.y,t.inertia.z*n.z,0),i.multiplyToRef(r,this._tmpMatrix),this._tmpMatrix}_getComWorldToRef(e,t){let i=e.body.getMassProperties(e.index);o.Pq.TransformCoordinatesToRef(i.centerOfMass,e.body.transformNode.getWorldMatrix(),t)}_getInvMass(e){return 1/e.body.getMassProperties(e.index).mass}_integrateManifolds(e,t){let i=this._scene.getPhysicsEngine().getPhysicsPlugin(),r=o.Pq.Zero(),n=e;this._validateManifold();for(let s=0;s<this.maxCastIterations&&n>1e-5;s++){this._castWithCollectors(this._position,this._position.add(this._lastDisplacement),this._castCollector,this._startCollector);let s=this._updateManifold(this._startCollector,this._castCollector,this._lastDisplacement),a=this._createConstraintsFromManifold(e,e-n),o=this._tmpVecs[3];o.set(this.maxCharacterSpeedForSolver,this.maxCharacterSpeedForSolver,this.maxCharacterSpeedForSolver);let l=0==this._velocity.lengthSquared()?0:.5*this.keepDistance/this._velocity.length(),u=this._simplexSolverSolve(a,this._velocity,n,l,this.up,o),h=u.position,c=u.deltaTime;r=u.velocity,this._resolveContacts(e,t);let d=-1;if(0!=s||h.lengthSquared()>1e-8&&!this._lastDisplacement.equalsWithEpsilon(h,this._displacementEps)){this._castWithCollectors(this._position,this._position.add(h),this._castCollector,this._startCollector);let e=i._hknp,t=e.HP_QueryCollector_GetNumHits(this._castCollector)[1];if(t>0)for(let r=0;r<t;r++){let[t,n,s]=e.HP_QueryCollector_GetShapeCastResult(this._castCollector,r)[1],a=m(i,s,h,t,this.keepDistance);if(-1==this._findContact(a,this._manifold,.1)){d=this._manifold.length,this._manifold.push(a);break}}}if(d>=0){let e=this._manifold[d],t=1/h.length(),i=h.dot(e.normal)*t,r=-(this.keepDistance/i),s=e.fraction-r*t;s=Math.min(Math.max(s,0),1);let a=h.scale(s);this._position.addInPlace(a),n-=c*s}else this._position.addInPlace(h),n-=c;this._lastDisplacement.copyFrom(h)}this._velocity.copyFrom(r),this._transformNode.position.copyFrom(this._position)}moveWithCollisions(e){if(void 0==this._scene.deltaTime)return;let t=this._scene.deltaTime/1e3,i=1/t;e.scaleToRef(1/t,this._velocity),this._lastDisplacement.copyFrom(e),this._lastVelocity.copyFrom(this._velocity),this._lastInvDeltaTime=i,this._integrateManifolds(t,o.Pq.ZeroReadOnly)}integrate(e,t,i){let r=1/e;{let i=this._displacementEps*r;if(this._velocity.equalsWithEpsilon(this._lastVelocity,i))this._lastDisplacement.scaleInPlace(e*this._lastInvDeltaTime);else{let i=this._velocity;if(2==t.supportedState){let e=this._tmpVecs[28];this._velocity.subtractToRef(t.averageSurfaceVelocity,e);let r=t.averageSurfaceNormal.dot(e);r<0&&(e.subtractInPlace(t.averageSurfaceNormal.scale(r)),i.copyFrom(e),i.addInPlace(t.averageSurfaceVelocity))}this._lastDisplacement.copyFrom(i),this._lastDisplacement.scaleInPlace(e)}this._lastVelocity.copyFrom(this._velocity),this._lastInvDeltaTime=r}this._integrateManifolds(e,i)}calculateMovementToRef(e,t,i,r,n,s,a,l){let u=t.cross(a);if(1e-5>u.lengthSquared())return!1;u.normalize();let h=u.cross(i);h.normalize(),(u=h.cross(i)).normalize();let c=o.uq.FromValues(h.x,h.y,h.z,0,u.x,u.y,u.z,0,i.x,i.y,i.z,0,0,0,0,1),d=c.clone().invert();r.subtractToRef(n,this._tmpVecs[29]);let p=this._tmpVecs[30];o.Pq.TransformNormalToRef(this._tmpVecs[29],d,p);let f=a.cross(t),_=s.dot(t),m=s.dot(f),g=s.length(),b=this._tmpVecs[4];b.set(-_,m,0),b.normalize(),b.scaleInPlace(g);let y=this._tmpVecs[5];b.subtractToRef(p,y);{let t,i=y.lengthSquared(),r=this.maxAcceleration*e;t=i*this.acceleration*this.acceleration>r*r?r/Math.sqrt(i):this.acceleration,y.scaleInPlace(t)}return p.addInPlace(y),o.Pq.TransformNormalToRef(p,c,l),l.addInPlace(n),!0}calculateMovement(e,t,i,r,n,s,a){let l=new o.Pq(0,0,0);return this.calculateMovementToRef(e,t,i,r,n,s,a,l),l}}},93234(e,t,i){i.d(t,{L:()=>u});var r=i(80001),n=i(96028),s=i(31656),a=i(70134),o=i(39058),l=i(37331);class u{constructor(e,t,i={mass:0},a){if(this.transformNode=e,this.type=t,this._options=i,this._scene=a,this._disposeShapeWhenDisposed=!0,!this.transformNode)return void s.V.Error("No object was provided. A physics object is obligatory");if(this.transformNode.parent&&0!==this._options.mass&&e.hasThinInstances&&s.V.Warn("A physics body has been created for an object which has a parent and thin instances. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&e.getScene&&(this._scene=e.getScene()),!this._scene)return;this._options.mass=void 0===i.mass?0:i.mass,this._options.friction=void 0===i.friction?.2:i.friction,this._options.restitution=void 0===i.restitution?.2:i.restitution;const o=2*(0!==this._options.mass),l=this._options.startAsleep??!1;this.body=new r.a(e,o,l,this._scene),this._addSizeOptions(),t.getClassName&&"PhysicsShape"===t.getClassName()?(this.shape=t,this._disposeShapeWhenDisposed=!1):this.shape=new n.JN({type:t,parameters:this._options},this._scene),this._options.isTriggerShape&&(this.shape.isTrigger=!0),this.material={friction:this._options.friction,restitution:this._options.restitution},this.body.shape=this.shape,this.shape.material=this.material,this.body.setMassProperties({mass:this._options.mass}),this._nodeDisposeObserver=this.transformNode.onDisposeObservable.add(()=>{this.dispose()})}_getObjectBoundingBox(){return this.transformNode.getRawBoundingInfo?this.transformNode.getRawBoundingInfo().boundingBox:new l.I(new a.Pq(-.5,-.5,-.5),new a.Pq(.5,.5,.5))}_hasVertices(e){return e?.getTotalVertices()>0}_addSizeOptions(){this.transformNode.computeWorldMatrix(!0);let e=this._getObjectBoundingBox(),t=a.AA.Vector3["0"];t.copyFrom(e.extendSize),t.scaleInPlace(2),t.multiplyInPlace(this.transformNode.absoluteScaling),t.x=Math.abs(t.x),t.y=Math.abs(t.y),t.z=Math.abs(t.z);let i=a.AA.Vector3["1"];if(i.copyFrom(e.minimum),i.multiplyInPlace(this.transformNode.absoluteScaling),!this._options.center){let t=new a.Pq;t.copyFrom(e.center),t.multiplyInPlace(this.transformNode.absoluteScaling),this._options.center=t}switch(this.type){case 0:!this._options.radius&&(0,o.WithinEpsilon)(t.x,t.y,1e-4)&&(0,o.WithinEpsilon)(t.x,t.z,1e-4)?this._options.radius=t.x/2:this._options.radius||(s.V.Warn("Non uniform scaling is unsupported for sphere shapes. Setting the radius to the biggest bounding box extent."),this._options.radius=Math.max(t.x,t.y,t.z)/2);break;case 1:{let e=t.x/2;this._options.radius=this._options.radius??e,this._options.pointA=this._options.pointA??new a.Pq(0,i.y+e,0),this._options.pointB=this._options.pointB??new a.Pq(0,i.y+t.y-e,0)}break;case 2:{let e=t.x/2;this._options.radius=this._options.radius??e,this._options.pointA=this._options.pointA??new a.Pq(0,i.y,0),this._options.pointB=this._options.pointB??new a.Pq(0,i.y+t.y,0)}break;case 6:case 4:case 7:if(!this._options.mesh&&this._hasVertices(this.transformNode))this._options.mesh=this.transformNode;else if(!this._options.mesh||!this._hasVertices(this._options.mesh))throw Error("No valid mesh was provided for mesh or convex hull shape parameter. Please provide a mesh with valid geometry (number of vertices greater than 0).");break;case 3:this._options.extents=this._options.extents??new a.Pq(t.x,t.y,t.z),this._options.rotation=this._options.rotation??a.PT.Identity()}}dispose(){this._nodeDisposeObserver&&(this.body.transformNode.onDisposeObservable.remove(this._nodeDisposeObserver),this._nodeDisposeObserver=null),this.body.dispose(),this._disposeShapeWhenDisposed&&this.shape.dispose()}}},80001(e,t,i){i.d(t,{a:()=>s});var r=i(60167),n=i(70134);class s{get disablePreStep(){return this._prestepType==r.f9.DISABLED}set disablePreStep(e){this._prestepType=e?r.f9.DISABLED:r.f9.TELEPORT}constructor(e,t,i,s){if(this._pluginData=void 0,this._pluginDataInstances=[],this._collisionCBEnabled=!1,this._collisionEndedCBEnabled=!1,this.disableSync=!1,this._isDisposed=!1,this._shape=null,this._prestepType=r.f9.DISABLED,!s)return;const a=s.getPhysicsEngine();if(!a)throw Error("No Physics Engine available.");if(this._physicsEngine=a,2!=a.getPluginVersion())throw Error("Plugin version is incorrect. Expected version 2.");const o=a.getPhysicsPlugin();if(!o)throw Error("No Physics Plugin available.");this._physicsPlugin=o,e.rotationQuaternion||(e.rotationQuaternion=n.PT.FromEulerAngles(e.rotation.x,e.rotation.y,e.rotation.z)),this.startAsleep=i,this.disableSync=0==t,e.hasThinInstances?this._physicsPlugin.initBodyInstances(this,t,e):(e.parent&&e.computeWorldMatrix(!0),this._physicsPlugin.initBody(this,t,e.absolutePosition,e.absoluteRotationQuaternion)),this.transformNode=e,e.physicsBody=this,a.addBody(this),this._nodeDisposeObserver=e.onDisposeObservable.add(()=>{this.dispose()})}getClassName(){return"PhysicsBody"}clone(e){let t=new s(e,this.getMotionType(),this.startAsleep,this.transformNode.getScene());return t.shape=this.shape,t.setMassProperties(this.getMassProperties()),t.setLinearDamping(this.getLinearDamping()),t.setAngularDamping(this.getAngularDamping()),t}updateBodyInstances(){let e=this.transformNode;e.hasThinInstances&&this._physicsPlugin.updateBodyInstances(this,e)}get numInstances(){return this._pluginDataInstances.length}get motionType(){return this._physicsPlugin.getMotionType(this)}set shape(e){this._shape=e,e&&this._physicsPlugin.setShape(this,e)}get shape(){return this._shape}getBoundingBox(){return this._physicsPlugin.getBodyBoundingBox(this)}setEventMask(e,t){this._physicsPlugin.setEventMask(this,e,t)}getEventMask(e){return this._physicsPlugin.getEventMask(this,e)}setMotionType(e,t){this.disableSync=void 0===t&&0==e,this._physicsPlugin.setMotionType(this,e,t)}getMotionType(e){return this._physicsPlugin.getMotionType(this,e)}setPrestepType(e){this._prestepType=e}getPrestepType(){return this._prestepType}computeMassProperties(e){return this._physicsPlugin.computeMassProperties(this,e)}setMassProperties(e,t){this._physicsPlugin.setMassProperties(this,e,t)}getMassProperties(e){return this._physicsPlugin.getMassProperties(this,e)}setLinearDamping(e,t){this._physicsPlugin.setLinearDamping(this,e,t)}getLinearDamping(e){return this._physicsPlugin.getLinearDamping(this,e)}setAngularDamping(e,t){this._physicsPlugin.setAngularDamping(this,e,t)}getAngularDamping(e){return this._physicsPlugin.getAngularDamping(this,e)}setLinearVelocity(e,t){this._physicsPlugin.setLinearVelocity(this,e,t)}getLinearVelocityToRef(e,t){this._physicsPlugin.getLinearVelocityToRef(this,e,t)}getLinearVelocity(e){let t=new n.Pq;return this.getLinearVelocityToRef(t,e),t}setAngularVelocity(e,t){this._physicsPlugin.setAngularVelocity(this,e,t)}getAngularVelocityToRef(e,t){this._physicsPlugin.getAngularVelocityToRef(this,e,t)}getAngularVelocity(e){let t=new n.Pq;return this.getAngularVelocityToRef(t,e),t}applyImpulse(e,t,i){this._physicsPlugin.applyImpulse(this,e,t,i)}applyAngularImpulse(e,t){this._physicsPlugin.applyAngularImpulse(this,e,t)}applyTorque(e,t){this._physicsPlugin.applyTorque(this,e,t)}applyForce(e,t,i){this._physicsPlugin.applyForce(this,e,t,i)}getGeometry(){return this._physicsPlugin.getBodyGeometry(this)}getCollisionObservable(){return this._physicsPlugin.getCollisionObservable(this)}getCollisionEndedObservable(){return this._physicsPlugin.getCollisionEndedObservable(this)}setCollisionCallbackEnabled(e){this._collisionCBEnabled=e,this._physicsPlugin.setCollisionCallbackEnabled(this,e)}setCollisionEndedCallbackEnabled(e){this._collisionEndedCBEnabled=e,this._physicsPlugin.setCollisionEndedCallbackEnabled(this,e)}getObjectCenterWorld(e){let t=new n.Pq;return this.getObjectCenterWorldToRef(t,e)}getObjectCenterWorldToRef(e,t){if(this._pluginDataInstances?.length>0){let i=t||0,r=this.transformNode._thinInstanceDataStorage.matrixData;r&&e.set(r[16*i+12],r[16*i+13],r[16*i+14])}else e.copyFrom(this.transformNode.position);return e}addConstraint(e,t,i,r){this._physicsPlugin.addConstraint(this,e,t,i,r)}syncWithBone(e,t,i,r,s,a){let o=this.transformNode;if(o.rotationQuaternion)if(s){let i=n.AA.Quaternion["0"];e.getRotationQuaternionToRef(1,t,i),i.multiplyToRef(s,o.rotationQuaternion)}else e.getRotationQuaternionToRef(1,t,o.rotationQuaternion);let l=n.AA.Vector3["0"],u=n.AA.Vector3["1"];a||((a=n.AA.Vector3["2"]).x=0,a.y=1,a.z=0),e.getDirectionToRef(a,t,u),e.getAbsolutePositionToRef(t,l),null==r&&i&&(r=i.length()),null!=r&&(l.x+=u.x*r,l.y+=u.y*r,l.z+=u.z*r),o.setAbsolutePosition(l)}iterateOverAllInstances(e){if(this._pluginDataInstances?.length>0)for(let t=0;t<this._pluginDataInstances.length;t++)e(this,t);else e(this,void 0)}setGravityFactor(e,t){this._physicsPlugin.setGravityFactor(this,e,t)}getGravityFactor(e){return this._physicsPlugin.getGravityFactor(this,e)}setTargetTransform(e,t,i){this._physicsPlugin.setTargetTransform(this,e,t,i)}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._collisionCBEnabled&&this.setCollisionCallbackEnabled(!1),this._collisionEndedCBEnabled&&this.setCollisionEndedCallbackEnabled(!1),this._nodeDisposeObserver&&(this.transformNode.onDisposeObservable.remove(this._nodeDisposeObserver),this._nodeDisposeObserver=null),this._physicsEngine.removeBody(this),this._physicsPlugin.removeBody(this),this._physicsPlugin.disposeBody(this),this.transformNode.physicsBody=null,this._pluginData=null,this._pluginDataInstances.length=0,this._isDisposed=!0,this.shape=null)}}},72610(e,t,i){i.d(t,{G8:()=>n,Hy:()=>u,IX:()=>c,JT:()=>a,Ji:()=>o,Jn:()=>d,Lk:()=>l,Nc:()=>r,lC:()=>h,w6:()=>s});class r{constructor(e,t,i){if(this._pluginData=void 0,!i)throw Error("Missing scene parameter for constraint constructor.");const r=i.getPhysicsEngine();if(!r)throw Error("No Physics Engine available.");if(2!=r.getPluginVersion())throw Error("Plugin version is incorrect. Expected version 2.");const n=r.getPhysicsPlugin();if(!n)throw Error("No Physics Plugin available.");this._physicsPlugin=n,this._options=t,this._type=e}get type(){return this._type}get options(){return this._options}set isEnabled(e){this._physicsPlugin.setEnabled(this,e)}get isEnabled(){return this._physicsPlugin.getEnabled(this)}set isCollisionsEnabled(e){this._physicsPlugin.setCollisionsEnabled(this,e)}get isCollisionsEnabled(){return this._physicsPlugin.getCollisionsEnabled(this)}getBodiesUsingConstraint(){return this._physicsPlugin.getBodiesUsingConstraint(this)}dispose(){this._physicsPlugin.disposeConstraint(this)}}class n{}class s extends r{constructor(e,t,i){super(7,e,i),this.limits=t}setAxisFriction(e,t){this._physicsPlugin.setAxisFriction(this,e,t)}getAxisFriction(e){return this._physicsPlugin.getAxisFriction(this,e)}setAxisMode(e,t){this._physicsPlugin.setAxisMode(this,e,t)}getAxisMode(e){return this._physicsPlugin.getAxisMode(this,e)}setAxisMinLimit(e,t){this._physicsPlugin.setAxisMinLimit(this,e,t)}getAxisMinLimit(e){return this._physicsPlugin.getAxisMinLimit(this,e)}setAxisMaxLimit(e,t){this._physicsPlugin.setAxisMaxLimit(this,e,t)}getAxisMaxLimit(e){return this._physicsPlugin.getAxisMaxLimit(this,e)}setAxisMotorType(e,t){this._physicsPlugin.setAxisMotorType(this,e,t)}getAxisMotorType(e){return this._physicsPlugin.getAxisMotorType(this,e)}setAxisMotorTarget(e,t){this._physicsPlugin.setAxisMotorTarget(this,e,t)}getAxisMotorTarget(e){return this._physicsPlugin.getAxisMotorTarget(this,e)}setAxisMotorMaxForce(e,t){this._physicsPlugin.setAxisMotorMaxForce(this,e,t)}getAxisMotorMaxForce(e){return this._physicsPlugin.getAxisMotorMaxForce(this,e)}}class a extends r{constructor(e,t,i,r,n){super(1,{pivotA:e,pivotB:t,axisA:i,axisB:r},n)}}class o extends r{constructor(e,t){super(2,{maxDistance:e},t)}}class l extends r{constructor(e,t,i,r,n){super(3,{pivotA:e,pivotB:t,axisA:i,axisB:r},n)}}class u extends r{constructor(e,t,i,r,n){super(4,{pivotA:e,pivotB:t,axisA:i,axisB:r},n)}}class h extends r{constructor(e,t,i,r,n){super(5,{pivotA:e,pivotB:t,axisA:i,axisB:r},n)}}class c extends r{constructor(e,t,i,r,n){super(6,{pivotA:e,pivotB:t,axisA:i,axisB:r},n)}}class d extends s{constructor(e,t,i,r,n,s,a,o,l){super({pivotA:e,pivotB:t,axisA:i,axisB:r},[{axis:6,minLimit:n,maxLimit:s,stiffness:a,damping:o}],l)}}},65423(e,t,i){i.d(t,{A:()=>a});var r=i(70134),n=i(69638),s=i(39446);class a{getPluginVersion(){return this._physicsPlugin.getPluginVersion()}static DefaultPluginFactory(){throw(0,s.n)("")}constructor(e,t=a.DefaultPluginFactory()){this._physicsPlugin=t,this._physicsBodies=[],this._subTimeStep=0,e=e||new r.Pq(0,-9.807,0),this.setGravity(e),this.setTimeStep()}setGravity(e){this.gravity=e,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(e=1/60){this._physicsPlugin.setTimeStep(e)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(e=0){this._subTimeStep=e}getSubTimeStep(){return this._subTimeStep}dispose(){this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}setVelocityLimits(e,t){this._physicsPlugin.setVelocityLimits(e,t)}getMaxLinearVelocity(){return this._physicsPlugin.getMaxLinearVelocity()}getMaxAngularVelocity(){return this._physicsPlugin.getMaxAngularVelocity()}_step(e){e>.1?e=.1:e<=0&&(e=1/60),this._physicsPlugin.executeStep(e,this._physicsBodies)}addBody(e){this._physicsBodies.push(e)}removeBody(e){let t=this._physicsBodies.indexOf(e);t>-1&&this._physicsBodies.splice(t,1)}getBodies(){return this._physicsBodies}getPhysicsPlugin(){return this._physicsPlugin}raycastToRef(e,t,i,r){this._physicsPlugin.raycast(e,t,i,r)}raycast(e,t,i){let r=new n.G;return this._physicsPlugin.raycast(e,t,r,i),r}raycastMulti(e,t,i){let r=[];return this._physicsPlugin.raycast(e,t,r,i),r}}},70692(e,t,i){var r,n;i.d(t,{F:()=>r}),(n=r||(r={}))[n.GEOMETRIC_MEAN=0]="GEOMETRIC_MEAN",n[n.MINIMUM=1]="MINIMUM",n[n.MAXIMUM=2]="MAXIMUM",n[n.ARITHMETIC_MEAN=3]="ARITHMETIC_MEAN",n[n.MULTIPLY=4]="MULTIPLY"},96028(e,t,i){i.d(t,{Ei:()=>s,JN:()=>n,P8:()=>u,Uy:()=>c,WH:()=>h,XT:()=>o,cL:()=>l,cw:()=>a,fp:()=>p,yA:()=>d});var r=i(70134);class n{constructor(e,t){if(this._pluginData=void 0,this._isTrigger=!1,this._isDisposed=!1,!t)return;const i=t.getPhysicsEngine();if(!i)throw Error("No Physics Engine available.");if(2!=i.getPluginVersion())throw Error("Plugin version is incorrect. Expected version 2.");const r=i.getPhysicsPlugin();if(!r)throw Error("No Physics Plugin available.");if(this._physicsPlugin=r,void 0!==e.pluginData&&null!==e.pluginData)this._pluginData=e.pluginData,this._type=this._physicsPlugin.getShapeType(this);else if(void 0!==e.type&&null!==e.type){this._type=e.type;const t=e.parameters??{};this._physicsPlugin.initShape(this,e.type,t)}}getClassName(){return"PhysicsShape"}get type(){return this._type}set filterMembershipMask(e){this._physicsPlugin.setShapeFilterMembershipMask(this,e)}get filterMembershipMask(){return this._physicsPlugin.getShapeFilterMembershipMask(this)}set filterCollideMask(e){this._physicsPlugin.setShapeFilterCollideMask(this,e)}get filterCollideMask(){return this._physicsPlugin.getShapeFilterCollideMask(this)}set material(e){this._physicsPlugin.setMaterial(this,e),this._material=e}get material(){return this._material||(this._material=this._physicsPlugin.getMaterial(this)),this._material}set density(e){this._physicsPlugin.setDensity(this,e)}get density(){return this._physicsPlugin.getDensity(this)}addChildFromParent(e,t,i){let n=i.computeWorldMatrix(!0),s=e.computeWorldMatrix(!0),a=r.AA.Matrix["0"];n.multiplyToRef(r.uq.Invert(s),a);let o=r.AA.Vector3["0"],l=r.AA.Quaternion["0"],u=r.AA.Vector3["1"];a.decompose(u,l,o),this._physicsPlugin.addChild(this,t,o,l,u)}addChild(e,t,i,r){this._physicsPlugin.addChild(this,e,t,i,r)}removeChild(e){this._physicsPlugin.removeChild(this,e)}getNumChildren(){return this._physicsPlugin.getNumChildren(this)}getBoundingBox(){return this._physicsPlugin.getBoundingBox(this)}set isTrigger(e){this._isTrigger!==e&&(this._isTrigger=e,this._physicsPlugin.setTrigger(this,e))}get isTrigger(){return this._isTrigger}dispose(){this._isDisposed||(this._physicsPlugin.disposeShape(this),this._isDisposed=!0)}}class s extends n{constructor(e,t,i){super({type:0,parameters:{center:e,radius:t}},i)}static FromMesh(e){let t=e.getBoundingInfo(),i=t.boundingSphere.center,r=t.boundingBox.extendSize;return new s(i,Math.max(r.x,r.y,r.z),e.getScene())}}class a extends n{constructor(e,t,i,r){super({type:1,parameters:{pointA:e,pointB:t,radius:i}},r)}static FromMesh(e){let t=e.getBoundingInfo(),i=t.boundingBox.extendSize.x,n=new r.Pq(0,t.boundingBox.extendSize.y-i,0);return new a(t.boundingBox.center.add(n),t.boundingBox.center.subtract(n),i,e.getScene())}}class o extends n{constructor(e,t,i,r){super({type:2,parameters:{pointA:e,pointB:t,radius:i}},r)}static FromMesh(e){let t=e.getBoundingInfo(),i=t.boundingBox.extendSize.x,n=new r.Pq(0,t.boundingBox.extendSize.y,0);return new o(t.boundingBox.center.add(n),t.boundingBox.center.subtract(n),i,e.getScene())}}class l extends n{constructor(e,t,i,r){super({type:3,parameters:{center:e,rotation:t,extents:i}},r)}static FromMesh(e){let t=e.getBoundingInfo(),i=t.boundingBox.center,n=t.boundingBox.extendSize.scale(2);return new l(i,r.PT.Identity(),n,e.getScene())}}class u extends n{constructor(e,t){super({type:4,parameters:{mesh:e}},t)}}class h extends n{constructor(e,t){super({type:6,parameters:{mesh:e}},t)}}class c extends n{constructor(e){super({type:5,parameters:{}},e)}}class d extends n{constructor(e,t,i,r,n,s){super({type:7,parameters:{heightFieldSizeX:e,heightFieldSizeZ:t,numHeightFieldSamplesX:i,numHeightFieldSamplesZ:r,heightFieldData:n}},s)}}class p extends n{constructor(e,t){super({type:7,parameters:{groundMesh:e}},t)}}},33263(e,t,i){i.d(t,{V:()=>u,k:()=>h});var r=i(70134),n=i(93234),s=i(72610),a=i(59624),o=i(31656),l=i(60871);class u{}class h{constructor(e,t,i){this._boxConfigs=[],this._constraints=[],this._bones=[],this._initialRotation=[],this._initialRotation2=[],this._boneNames=[],this._transforms=[],this._aggregates=[],this._ragdollMode=!1,this._rootBoneName="",this._rootBoneIndex=-1,this._mass=10,this._restitution=0,this._beforeRenderObserver=null,this.pauseSync=!1,this._defaultJoint=3,this._defaultJointMin=-90,this._defaultJointMax=90,this._skeleton=e,this._scene=e.getScene(),this._rootTransformNode=t,this._config=i,this._boxConfigs=[],this._putBoxesInBoneCenter=!1,this._defaultJoint=3,this._init()}getConstraints(){return this._constraints}getAggregate(e){return e<0||e>=this._aggregates.length?this._aggregates[this._rootBoneIndex]:this._aggregates[e]}_createColliders(){this._rootTransformNode.computeWorldMatrix(),this._skeleton.computeAbsoluteMatrices(!0),this._skeleton.prepare(!0);let e=this._config;for(let t=0;t<e.length;t++){let i=void 0!==e[t].bone?[e[t].bone]:e[t].bones;for(let s=0;s<i.length;s++){let u=this._skeleton.bones[this._skeleton.getBoneIndexByName(i[s])];if(void 0==u)return;let h={width:this._config[t].width,depth:this._config[t].depth,height:this._config[t].height,size:this._config[t].size};h.width=h.width??h.size,h.depth=h.depth??h.size,h.height=h.height??h.size;let c=new l.V(i[s]+"_transform",this._scene);h.joint=void 0!==e[t].joint?e[t].joint:this._defaultJoint,h.rotationAxis=void 0!==e[t].rotationAxis?e[t].rotationAxis:a._0.X,h.min=void 0!==e[t].min?e[t].min:this._defaultJointMin,h.max=void 0!==e[t].max?e[t].max:this._defaultJointMax;let d=0;void 0!==e[t].putBoxInBoneCenter&&e[t].putBoxInBoneCenter||this._putBoxesInBoneCenter?(void 0===u.length&&o.V.Log("The length property is not defined for bone "+u.name),d=u.length/2):void 0!==e[t].boxOffset&&(d=e[t].boxOffset),h.boxOffset=d;let p=void 0!==e[t].boneOffsetAxis?e[t].boneOffsetAxis:a._0.Y,f=u.getDirection(p,this._rootTransformNode);h.boneOffsetAxis=p,c.position=u.getAbsolutePosition(this._rootTransformNode).add(f.scale(d));let _=void 0!==e[t].mass?e[t].mass:this._mass,m=void 0!==e[t].restitution?e[t].restitution:this._restitution,g=new n.L(c,3,{mass:_,restitution:m,friction:.6,extents:new r.Pq(h.width,h.height,h.depth)},this._scene);g.body.setCollisionCallbackEnabled(!0),g.body.disablePreStep=!1,g.body.setMotionType(1),this._aggregates.push(g),this._bones.push(u),this._boneNames.push(u.name),this._transforms.push(c),this._boxConfigs.push(h),this._initialRotation.push(u.getRotationQuaternion(1,this._rootTransformNode)),this._initialRotation2.push(u.getRotationQuaternion(1))}}}_initJoints(){this._rootTransformNode.computeWorldMatrix();for(let e=0;e<this._bones.length;e++){if(e==this._rootBoneIndex)continue;let t=this._findNearestParent(e);if(null==t)return void o.V.Warn("Couldn't find a nearest parent bone in the configs for bone called "+this._boneNames[e]);let i=this._boneNames.indexOf(t.name),n=this._bones[e].getAbsolutePosition(this._rootTransformNode).subtract(this._transforms[i].position),a=this._transforms[i].computeWorldMatrix(),l=r.uq.Invert(a);n=r.Pq.TransformCoordinates(this._bones[e].getAbsolutePosition(this._rootTransformNode),l);let u=this._bones[e].getAbsolutePosition(this._rootTransformNode),h=this._transforms[e].position.clone(),c=u.subtract(h),d=this._boxConfigs[e].joint??this._defaultJoint,p=new s.Nc(d,{pivotA:n,pivotB:c,axisA:this._boxConfigs[e].rotationAxis,axisB:this._boxConfigs[e].rotationAxis,collision:!1},this._scene);this._aggregates[i].body.addConstraint(this._aggregates[e].body,p),p.isEnabled=!1,this._constraints.push(p)}}_syncBonesToPhysics(){let e=this._rootTransformNode.getWorldMatrix();for(let t=0;t<this._bones.length;t++){let i=this._aggregates[t].transformNode,n=this._bones[t].getAbsolutePosition();r.Pq.TransformCoordinatesToRef(n,e,i.position),this._bones[t].getDirectionToRef(this._boxConfigs[t].boneOffsetAxis,this._rootTransformNode,r.AA.Vector3["0"]),r.AA.Vector3["0"].scaleInPlace(this._boxConfigs[t].boxOffset??0),i.position.addInPlace(r.AA.Vector3["0"]),this._setBoneOrientationToBody(t)}}_setBoneOrientationToBody(e){let t=this._aggregates[e].transformNode,i=this._bones[e];this._initialRotation[e].conjugateToRef(r.AA.Quaternion["0"]),i.getRotationQuaternionToRef(1,this._rootTransformNode,r.AA.Quaternion["1"]),r.AA.Quaternion["1"].multiplyToRef(r.AA.Quaternion["0"],t.rotationQuaternion),t.rotationQuaternion.normalize()}_syncBonesAndBoxes(){if(!this.pauseSync)if(this._ragdollMode){this._setBodyOrientationToBone(this._rootBoneIndex);let e=this._aggregates[this._rootBoneIndex].body.transformNode.position;this._rootTransformNode.getWorldMatrix().invertToRef(r.AA.Matrix["0"]),r.Pq.TransformCoordinatesToRef(e,r.AA.Matrix["0"],r.AA.Vector3["0"]),this._bones[this._rootBoneIndex].setAbsolutePosition(r.AA.Vector3["0"]);for(let e=0;e<this._bones.length;e++)e!=this._rootBoneIndex&&this._setBodyOrientationToBone(e)}else this._syncBonesToPhysics()}_setBodyOrientationToBone(e){let t=this._rootTransformNode.rotationQuaternion??r.PT.FromEulerAngles(this._rootTransformNode.rotation.x,this._rootTransformNode.rotation.y,this._rootTransformNode.rotation.z),i=this._initialRotation2[e],n=this._aggregates[e].body?.transformNode?.rotationQuaternion;t.multiplyToRef(i,r.AA.Quaternion["1"]),n?.multiplyToRef(r.AA.Quaternion["1"],r.AA.Quaternion["0"]),this._bones[e].setRotationQuaternion(r.AA.Quaternion["0"],1,this._rootTransformNode)}_defineRootBone(){let e=this._skeleton.getChildren();return 1!=e.length?(o.V.Log("Ragdoll creation failed: there can only be one root in the skeleton."),!1):(this._rootBoneName=e[0].name,this._rootBoneIndex=this._boneNames.indexOf(this._rootBoneName),-1!=this._rootBoneIndex||(o.V.Log("Ragdoll creation failed: the array boneNames doesn't have the root bone. The root bone is "+this._skeleton.getChildren()),!1))}_findNearestParent(e){let t=this._bones[e].getParent();do{if(null!=t&&this._boneNames.includes(t.name))break;t=t?.getParent()}while(null!=t);return t}_init(){this._createColliders(),this._defineRootBone()&&(this._initJoints(),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(()=>{this._syncBonesAndBoxes()}),this._syncBonesToPhysics())}ragdoll(){for(let e of(this._ragdollMode=!0,this._skeleton.bones))e.linkTransformNode(null);for(let e=0;e<this._constraints.length;e++)this._constraints[e].isEnabled=!0;for(let e=0;e<this._aggregates.length;e++)this._aggregates[e].body.setMotionType(2)}dispose(){for(let e of this._aggregates)e.dispose();for(let e of(this._aggregates.length=0,this._transforms))e.dispose();for(let e of(this._transforms.length=0,this._constraints))e.dispose();this._constraints.length=0,this._beforeRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this._beforeRenderObserver=null)}}},16221(e,t,i){i.d(t,{w:()=>s});var r=i(75318),n=i(44618);Object.defineProperty(i(9633).Z.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){let e=this._getComponent(r.v.NAME_POSTPROCESSRENDERPIPELINEMANAGER);e||(e=new s(this),this._addComponent(e)),this._postProcessRenderPipelineManager=new n.R}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});class s{constructor(e){this.name=r.v.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=e}register(){this.scene._gatherRenderTargetsStage.registerStep(r.v.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)}rebuild(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()}dispose(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()}_gatherRenderTargets(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()}}},93541(e,t,i){i.d(t,{s:()=>c,v:()=>h});var r=i(39545),n=i(74266),s=i(87201),a=i(27371),o=i(57176),l=i(23616),u=i(61646);class h extends n.w{getClassName(){return"PassPostProcess"}constructor(e,t,i=null,r,n,s,a=0,o=!1){const u={size:"number"==typeof t?t:void 0,camera:i,samplingMode:r,engine:n,reusable:s,textureType:a,blockCompilation:o,...t};super(e,l.m.FragmentUrl,{effectWrapper:"number"!=typeof t&&t.effectWrapper?void 0:new l.m(e,n,u),...u})}static _Parse(e,t,i,r){return o.p.Parse(()=>new h(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable),e,i,r)}}(0,a.Y5)("BABYLON.PassPostProcess",h);class c extends n.w{get face(){return this._effectWrapper.face}set face(e){this._effectWrapper.face=e}getClassName(){return"PassCubePostProcess"}constructor(e,t,i=null,r,n,s,a=0,o=!1){const u={size:"number"==typeof t?t:void 0,camera:i,samplingMode:r,engine:n,reusable:s,textureType:a,blockCompilation:o,...t};super(e,l.m.FragmentUrl,{effectWrapper:"number"!=typeof t&&t.effectWrapper?void 0:new l.V(e,n,u),...u})}static _Parse(e,t,i,r){return o.p.Parse(()=>new c(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable),e,i,r)}}(0,r.Cg)([(0,u.lK)()],c.prototype,"face",null),s.$._RescalePostProcessFactory=e=>new h("rescale",1,null,2,e,!1,0)},38307(e,t,i){i.d(t,{E:()=>a});var r=i(9633),n=i(72152),s=i(75318);r.Z.prototype.enableDepthRenderer=function(e,t=!1,i=!1,r=3,s=!1,a){if(!(e=e||this.activeCamera))throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[e.id]){let o=!!this.getEngine().getCaps().textureFloatRender,l=0;l=!this.getEngine().getCaps().textureHalfFloatRender||i&&o?+!!o:2,this._depthRenderer[e.id]=new n.d(this,l,e,t,r,s,void 0,a)}return this._depthRenderer[e.id]},r.Z.prototype.disableDepthRenderer=function(e){(e=e||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[e.id]&&this._depthRenderer[e.id].dispose()};class a{constructor(e){this.name=s.v.NAME_DEPTHRENDERER,this.scene=e}register(){this.scene._gatherRenderTargetsStage.registerStep(s.v.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(s.v.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)}rebuild(){}dispose(){for(let e in this.scene._depthRenderer)this.scene._depthRenderer[e].dispose()}_gatherRenderTargets(e){if(this.scene._depthRenderer)for(let t in this.scene._depthRenderer){let i=this.scene._depthRenderer[t];i.enabled&&!i.useOnlyInActiveCamera&&e.push(i.getDepthMap())}}_gatherActiveCameraRenderTargets(e){if(this.scene._depthRenderer)for(let t in this.scene._depthRenderer){let i=this.scene._depthRenderer[t];i.enabled&&i.useOnlyInActiveCamera&&this.scene.activeCamera.id===t&&e.push(i.getDepthMap())}}}n.d._SceneComponentInitialization=e=>{let t=e._getComponent(s.v.NAME_DEPTHRENDERER);t||(t=new a(e),e._addComponent(t))}},81255(e,t,i){i.d(t,{o:()=>f,s:()=>p});var r=i(95435),n=i(31804),s=i(48185),a=i(70134),o=i(21383),l=i(13890),u=i(26623),h=i(44394),c=i(99765);n.u.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},n.u.prototype.enableEdgesRendering=function(e=.95,t=!1,i){return this.disableEdgesRendering(),this._edgesRenderer=new p(this,e,t,!0,i),this},Object.defineProperty(n.u.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),s.l.prototype.enableEdgesRendering=function(e=.95,t=!1){return this.disableEdgesRendering(),this._edgesRenderer=new f(this,e,t),this},s.Q.prototype.enableEdgesRendering=function(e=.95,t=!1){return s.l.prototype.enableEdgesRendering.apply(this,arguments),this};class d{constructor(){this.edges=[],this.edgesConnectedCount=0}}class p{get linesPositions(){return this._linesPositions}get linesNormals(){return this._linesNormals}get linesIndices(){return this._linesIndices}get lineShader(){return this._lineShader}set lineShader(e){this._lineShader=e}static _GetShader(e,t){if(!e._edgeRenderLineShader){let r=new l.B("lineShader",e,"line",{attributes:["position","normal"],uniforms:["world","viewProjection","color","width","aspectRatio"],uniformBuffers:["Scene","Mesh"],shaderLanguage:t,extraInitializationsAsync:async()=>{1===t?await Promise.all([i.e("568").then(i.bind(i,11147)),i.e("5290").then(i.bind(i,84033))]):await Promise.all([i.e("2469").then(i.bind(i,24756)),i.e("5085").then(i.bind(i,75916))])}},!1);r.disableDepthWrite=!0,r.backFaceCulling=!1,r.checkReadyOnEveryCall=e.getEngine().isWebGPU,e._edgeRenderLineShader=r,e.onDisposeObservable.add(()=>{e._edgeRenderLineShader.dispose(),e._edgeRenderLineShader=null})}return e._edgeRenderLineShader}get shaderLanguage(){return this._shaderLanguage}constructor(e,t=.95,i=!1,r=!0,n){this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=[],this._linesNormals=[],this._linesIndices=[],this._buffers={},this._buffersForInstances={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this.customInstances=new h.L(32),this._shaderLanguage=0,this._source=e,this._checkVerticesInsteadOfIndices=i,this._options=n??null,this._epsilon=t;const s=this._source.getScene().getEngine();s.isWebGPU&&(this._drawWrapper=new c.E(s),this._shaderLanguage=1),this._prepareResources(),r&&(n?.useAlternateEdgeFinder??!0?this._generateEdgesLinesAlternate():this._generateEdgesLines()),this._meshRebuildObserver=this._source.onRebuildObservable.add(()=>{this._rebuild()}),this._meshDisposeObserver=this._source.onDisposeObservable.add(()=>{this.dispose()})}_prepareResources(){this._lineShader||(this._lineShader=p._GetShader(this._source.getScene(),this._shaderLanguage))}_rebuild(){let e=this._buffers[r.R.PositionKind];e&&e._rebuild(),(e=this._buffers[r.R.NormalKind])&&e._rebuild();let t=this._source.getScene().getEngine();this._ib=t.createIndexBuffer(this._linesIndices)}dispose(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);let e=this._buffers[r.R.PositionKind];e&&(e.dispose(),this._buffers[r.R.PositionKind]=null),(e=this._buffers[r.R.NormalKind])&&(e.dispose(),this._buffers[r.R.NormalKind]=null),this._ib&&this._source.getScene().getEngine()._releaseBuffer(this._ib),this._drawWrapper?.dispose()}_processEdgeForAdjacencies(e,t,i,r,n){return e===i&&t===r||e===r&&t===i?0:e===r&&t===n||e===n&&t===r?1:e===n&&t===i||e===i&&t===n?2:-1}_processEdgeForAdjacenciesWithVertices(e,t,i,r,n){return e.equalsWithEpsilon(i,1e-10)&&t.equalsWithEpsilon(r,1e-10)||e.equalsWithEpsilon(r,1e-10)&&t.equalsWithEpsilon(i,1e-10)?0:e.equalsWithEpsilon(r,1e-10)&&t.equalsWithEpsilon(n,1e-10)||e.equalsWithEpsilon(n,1e-10)&&t.equalsWithEpsilon(r,1e-10)?1:e.equalsWithEpsilon(n,1e-10)&&t.equalsWithEpsilon(i,1e-10)||e.equalsWithEpsilon(i,1e-10)&&t.equalsWithEpsilon(n,1e-10)?2:-1}_checkEdge(e,t,i,r,n){(void 0===t||a.Pq.Dot(i[e],i[t])<this._epsilon)&&this.createLine(r,n,this._linesPositions.length/3)}createLine(e,t,i){this._linesPositions.push(e.x,e.y,e.z,e.x,e.y,e.z,t.x,t.y,t.z,t.x,t.y,t.z),this._linesNormals.push(t.x,t.y,t.z,-1,t.x,t.y,t.z,1,e.x,e.y,e.z,-1,e.x,e.y,e.z,1),this._linesIndices.push(i,i+1,i+2,i,i+2,i+3)}_tessellateTriangle(e,t,i,r){let n=(e,t,i)=>{i>=0&&t.push(i);for(let i=0;i<e.length;++i)t.push(e[i][0])},s=0;e[1].length>=e[0].length&&e[1].length>=e[2].length?s=1:e[2].length>=e[0].length&&e[2].length>=e[1].length&&(s=2);for(let t=0;t<3;++t)t===s?e[t].sort((e,t)=>e[1]<t[1]?-1:+(e[1]>t[1])):e[t].sort((e,t)=>e[1]>t[1]?-1:+(e[1]<t[1]));let a=[],o=[];n(e[s],a,-1);let l=a.length;for(let a=s+2;a>=s+1;--a)n(e[a%3],o,a!==s+2?r[i[t+(a+1)%3]]:-1);let u=o.length;i.push(r[i[t+s]],a[0],o[0]),i.push(r[i[t+(s+1)%3]],o[u-1],a[l-1]);let h=l<=u,c=h?l:u,d=h?u:l,p=h?l-1:u-1,f=+!h,_=l+u-2,m=0,g=0,b=h?a:o,y=h?o:a,x=0;for(;_-- >0;){let e;f?i.push(b[m],y[g]):i.push(y[g],b[m]),(x+=c)>=d&&m<p?(e=b[++m],x-=d):e=y[++g],i.push(e)}i[t+0]=i[i.length-3],i[t+1]=i[i.length-2],i[t+2]=i[i.length-1],i.length=i.length-3}_generateEdgesLinesAlternate(){let e=this._source.getVerticesData(r.R.PositionKind),t=this._source.getIndices();if(!t||!e)return;Array.isArray(t)||(t=Array.from(t));let i=this._options?.useFastVertexMerger??!0,n=i?Math.round(-Math.log(this._options?.epsilonVertexMerge??1e-6)/Math.log(10)):this._options?.epsilonVertexMerge??1e-6,s=[],o=[];if(i){let t={};for(let i=0;i<e.length;i+=3){let r=e[i+0],a=e[i+1],l=e[i+2],u=r.toFixed(n)+"|"+a.toFixed(n)+"|"+l.toFixed(n);if(void 0!==t[u])s.push(t[u]);else{let e=i/3;t[u]=e,s.push(e),o.push(e)}}}else for(let t=0;t<e.length;t+=3){let i=e[t+0],r=e[t+1],a=e[t+2],l=!1;for(let o=0;o<t&&!l;o+=3){let t=e[o+0],u=e[o+1],h=e[o+2];if(Math.abs(i-t)<n&&Math.abs(r-u)<n&&Math.abs(a-h)<n){s.push(o/3),l=!0;break}}l||(s.push(t/3),o.push(t/3))}if(this._options?.applyTessellation){let i=this._options?.epsilonVertexAligned??1e-6,r=[];for(let n=0;n<t.length;n+=3){let a;for(let l=0;l<3;++l){let u=s[t[n+l]],h=s[t[n+(l+1)%3]],c=s[t[n+(l+2)%3]];if(u===h)continue;let d=e[3*u+0],p=e[3*u+1],f=e[3*u+2],_=e[3*h+0],m=e[3*h+1],g=e[3*h+2],b=Math.sqrt((_-d)*(_-d)+(m-p)*(m-p)+(g-f)*(g-f));for(let t=0;t<o.length-1;t++){let s=o[t];if(s===u||s===h||s===c)continue;let y=e[3*s+0],x=e[3*s+1],T=e[3*s+2],v=Math.sqrt((y-d)*(y-d)+(x-p)*(x-p)+(T-f)*(T-f));Math.abs(v+Math.sqrt((y-_)*(y-_)+(x-m)*(x-m)+(T-g)*(T-g))-b)<i&&(a||(a={index:n,edgesPoints:[[],[],[]]},r.push(a)),a.edgesPoints[l].push([s,v]))}}}for(let e=0;e<r.length;++e){let i=r[e];this._tessellateTriangle(i.edgesPoints,i.index,t,s)}r.length=0}let l={};for(let i=0;i<t.length;i+=3){let r;for(let n=0;n<3;++n){let o=s[t[i+n]],u=s[t[i+(n+1)%3]],h=s[t[i+(n+2)%3]];if(o===u||(o===h||u===h)&&this._options?.removeDegeneratedTriangles)continue;if(a.AA.Vector3["0"].copyFromFloats(e[3*o+0],e[3*o+1],e[3*o+2]),a.AA.Vector3["1"].copyFromFloats(e[3*u+0],e[3*u+1],e[3*u+2]),a.AA.Vector3["2"].copyFromFloats(e[3*h+0],e[3*h+1],e[3*h+2]),r||(a.AA.Vector3["1"].subtractToRef(a.AA.Vector3["0"],a.AA.Vector3["3"]),a.AA.Vector3["2"].subtractToRef(a.AA.Vector3["1"],a.AA.Vector3["4"]),(r=a.Pq.Cross(a.AA.Vector3["3"],a.AA.Vector3["4"])).normalize()),o>u){let e=o;o=u,u=e}let c=o+"_"+u,d=l[c];d?d.done||(a.Pq.Dot(r,d.normal)<this._epsilon&&this.createLine(a.AA.Vector3["0"],a.AA.Vector3["1"],this._linesPositions.length/3),d.done=!0):l[c]={normal:r,done:!1,index:i,i:n}}}for(let i in l){let r=l[i];if(!r.done){let i=s[t[r.index+r.i]],n=s[t[r.index+(r.i+1)%3]];a.AA.Vector3["0"].copyFromFloats(e[3*i+0],e[3*i+1],e[3*i+2]),a.AA.Vector3["1"].copyFromFloats(e[3*n+0],e[3*n+1],e[3*n+2]),this.createLine(a.AA.Vector3["0"],a.AA.Vector3["1"],this._linesPositions.length/3)}}let u=this._source.getScene().getEngine();this._buffers[r.R.PositionKind]=new r.R(u,this._linesPositions,r.R.PositionKind,!1),this._buffers[r.R.NormalKind]=new r.R(u,this._linesNormals,r.R.NormalKind,!1,!1,4),this._buffersForInstances[r.R.PositionKind]=this._buffers[r.R.PositionKind],this._buffersForInstances[r.R.NormalKind]=this._buffers[r.R.NormalKind],this._ib=u.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}_generateEdgesLines(){let e,t,i=this._source.getVerticesData(r.R.PositionKind),n=this._source.getIndices();if(!n||!i)return;let s=[],o=[];for(e=0;e<n.length;e+=3){t=new d;let r=n[e],l=n[e+1],u=n[e+2];t.p0=new a.Pq(i[3*r],i[3*r+1],i[3*r+2]),t.p1=new a.Pq(i[3*l],i[3*l+1],i[3*l+2]),t.p2=new a.Pq(i[3*u],i[3*u+1],i[3*u+2]);let h=a.Pq.Cross(t.p1.subtract(t.p0),t.p2.subtract(t.p1));h.normalize(),o.push(h),s.push(t)}for(e=0;e<s.length;e++){t=s[e];for(let i=e+1;i<s.length;i++){let r=s[i];if(3===t.edgesConnectedCount)break;if(3===r.edgesConnectedCount)continue;let a=n[3*i],o=n[3*i+1],l=n[3*i+2];for(let s=0;s<3;s++){let u=0;if(void 0===t.edges[s]){switch(s){case 0:u=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(t.p0,t.p1,r.p0,r.p1,r.p2):this._processEdgeForAdjacencies(n[3*e],n[3*e+1],a,o,l);break;case 1:u=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(t.p1,t.p2,r.p0,r.p1,r.p2):this._processEdgeForAdjacencies(n[3*e+1],n[3*e+2],a,o,l);break;case 2:u=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(t.p2,t.p0,r.p0,r.p1,r.p2):this._processEdgeForAdjacencies(n[3*e+2],n[3*e],a,o,l)}if(-1!==u&&(t.edges[s]=i,r.edges[u]=e,t.edgesConnectedCount++,r.edgesConnectedCount++,3===t.edgesConnectedCount))break}}}}for(e=0;e<s.length;e++){let t=s[e];this._checkEdge(e,t.edges[0],o,t.p0,t.p1),this._checkEdge(e,t.edges[1],o,t.p1,t.p2),this._checkEdge(e,t.edges[2],o,t.p2,t.p0)}let l=this._source.getScene().getEngine();this._buffers[r.R.PositionKind]=new r.R(l,this._linesPositions,r.R.PositionKind,!1),this._buffers[r.R.NormalKind]=new r.R(l,this._linesNormals,r.R.NormalKind,!1,!1,4),this._buffersForInstances[r.R.PositionKind]=this._buffers[r.R.PositionKind],this._buffersForInstances[r.R.NormalKind]=this._buffers[r.R.NormalKind],this._ib=l.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}isReady(){return this._lineShader.isReady(this._source,this._source.hasInstances&&this.customInstances.length>0||this._source.hasThinInstances)}render(){let e=this._source.getScene(),t=e.floatingOriginOffset,i=this._lineShader._getDrawWrapper();if(this._drawWrapper&&this._lineShader._setDrawWrapper(this._drawWrapper),!this.isReady()||!e.activeCamera)return void this._lineShader._setDrawWrapper(i);let r=this._source.hasInstances&&this.customInstances.length>0,n=r||this._source.hasThinInstances,s=0;if(n)if(this._buffersForInstances.world0=this._source.getVertexBuffer("world0"),this._buffersForInstances.world1=this._source.getVertexBuffer("world1"),this._buffersForInstances.world2=this._source.getVertexBuffer("world2"),this._buffersForInstances.world3=this._source.getVertexBuffer("world3"),r){let e=this._source._getInstanceDataStorage(),i=this._source._instanceDataStorage.isFrozen;if(s=this.customInstances.length,!e.instancesData){this._source.getScene()._activeMeshesFrozen||this.customInstances.reset();return}if(!i){let i=0;for(let r=0;r<s;++r)this.customInstances.data[r].copyToArray(e.instancesData,i),e.instancesData[i+12]-=t.x,e.instancesData[i+13]-=t.y,e.instancesData[i+14]-=t.z,i+=16;e.instancesBuffer.updateDirectly(e.instancesData,0,s)}}else s=this._source.thinInstanceCount;let a=e.getEngine();this._lineShader._preBind(),1!==this._source.edgesColor.a?a.setAlphaMode(2):a.setAlphaMode(0),a.bindBuffers(n?this._buffersForInstances:this._buffers,this._ib,this._lineShader.getEffect()),e.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),e.activeCamera.mode===u.i.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",a.getAspectRatio(e.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix(),this._source),a.drawElementsType(o.i.TriangleFillMode,0,this._indicesCount,s),this._lineShader.unbind(),n&&a.unbindInstanceAttributes(),this._source.getScene()._activeMeshesFrozen||this.customInstances.reset(),this._lineShader._setDrawWrapper(i)}}class f extends p{constructor(e,t=.95,i=!1){super(e,t,i,!1),this._generateEdgesLines()}_generateEdgesLines(){let e=this._source.getVerticesData(r.R.PositionKind),t=this._source.getIndices();if(!t||!e)return;let i=a.AA.Vector3["0"],n=a.AA.Vector3["1"],s=t.length-1;for(let r=0,o=0;r<s;r+=2,o+=4)a.Pq.FromArrayToRef(e,3*t[r],i),a.Pq.FromArrayToRef(e,3*t[r+1],n),this.createLine(i,n,o);let o=this._source.getScene().getEngine();this._buffers[r.R.PositionKind]=new r.R(o,this._linesPositions,r.R.PositionKind,!1),this._buffers[r.R.NormalKind]=new r.R(o,this._linesNormals,r.R.NormalKind,!1,!1,4),this._ib=o.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}}},88806(e,t,i){var r=i(56863);let n="bakedVertexAnimation",s=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
{
#ifdef INSTANCES
#define BVASNAME bakedVertexAnimationSettingsInstanced
#else
#define BVASNAME bakedVertexAnimationSettings
#endif
float VATStartFrame=BVASNAME.x;float VATEndFrame=BVASNAME.y;float VATOffsetFrame=BVASNAME.z;float VATSpeed=BVASNAME.w;float totalFrames=VATEndFrame-VATStartFrame+1.0;float time=bakedVertexAnimationTime*VATSpeed/totalFrames;float frameCorrection=time<1.0 ? 0.0 : 1.0;float numOfFrames=totalFrames-frameCorrection;float VATFrameNum=fract(time)*numOfFrames;VATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);VATFrameNum=floor(VATFrameNum);VATFrameNum+=VATStartFrame+frameCorrection;mat4 VATInfluence;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];
#endif
finalWorld=finalWorld*VATInfluence;}
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},50480(e,t,i){var r=i(56863);let n="bakedVertexAnimationDeclaration",s=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
uniform float bakedVertexAnimationTime;uniform vec2 bakedVertexAnimationTextureSizeInverted;uniform vec4 bakedVertexAnimationSettings;uniform sampler2D bakedVertexAnimationTexture;
#ifdef INSTANCES
attribute vec4 bakedVertexAnimationSettingsInstanced;
#endif
#define inline
mat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)
{float offset=index*4.0;float frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;float dx=bakedVertexAnimationTextureSizeInverted.x;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));return mat4(m0,m1,m2,m3);}
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},53114(e,t,i){i.r(t),i.d(t,{bonesDeclaration:()=>a});var r=i(56863);let n="bonesDeclaration",s=`#if NUM_BONE_INFLUENCERS>0
attribute vec4 matricesIndices;attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;attribute vec4 matricesWeightsExtra;
#endif
#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#ifdef BONETEXTURE
uniform highp sampler2D boneSampler;uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#endif
#ifdef BONES_VELOCITY_ENABLED
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#ifdef BONETEXTURE
#define inline
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{float offset=index *4.0;float dx=1.0/boneTextureWidth;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));return mat4(m0,m1,m2,m3);}
#endif
#endif
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},54202(e,t,i){i.r(t),i.d(t,{bonesVertex:()=>a});var r=i(56863);let n="bonesVertex",s=`#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},64023(e,t,i){i.r(t),i.d(t,{clipPlaneFragment:()=>a});var r=i(56863);let n="clipPlaneFragment",s=`#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
if (false) {}
#endif
#ifdef CLIPPLANE
else if (fClipDistance>0.0)
{discard;}
#endif
#ifdef CLIPPLANE2
else if (fClipDistance2>0.0)
{discard;}
#endif
#ifdef CLIPPLANE3
else if (fClipDistance3>0.0)
{discard;}
#endif
#ifdef CLIPPLANE4
else if (fClipDistance4>0.0)
{discard;}
#endif
#ifdef CLIPPLANE5
else if (fClipDistance5>0.0)
{discard;}
#endif
#ifdef CLIPPLANE6
else if (fClipDistance6>0.0)
{discard;}
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},8779(e,t,i){i.r(t),i.d(t,{clipPlaneFragmentDeclaration:()=>a});var r=i(56863);let n="clipPlaneFragmentDeclaration",s=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},75793(e,t,i){i.r(t),i.d(t,{clipPlaneVertex:()=>a});var r=i(56863);let n="clipPlaneVertex",s=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},48145(e,t,i){i.r(t),i.d(t,{clipPlaneVertexDeclaration:()=>a});var r=i(56863);let n="clipPlaneVertexDeclaration",s=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;varying float fClipDistance6;
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},98999(e,t,i){var r=i(56863);let n="fogFragment",s=`#ifdef FOG
float fog=CalcFogFactor();
#ifdef PBR
fog=toLinearSpace(fog);
#endif
color.rgb=mix(vFogColor,color.rgb,fog);
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},47083(e,t,i){i.r(t),i.d(t,{fogFragmentDeclaration:()=>a});var r=i(56863);let n="fogFragmentDeclaration",s=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()
{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)
{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}
else if (FOGMODE_EXP==vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}
else if (FOGMODE_EXP2==vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}
return clamp(fogCoeff,0.0,1.0);}
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},28049(e,t,i){var r=i(56863);let n="fogVertex",s=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},31377(e,t,i){var r=i(56863);let n="fogVertexDeclaration",s=`#ifdef FOG
varying vec3 vFogDistance;
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},38550(e,t,i){var r=i(56863);let n="gaussianSplatting",s=`#if !defined(WEBGL2) && !defined(WEBGPU) && !defined(NATIVE)
mat3 transpose(mat3 matrix) {return mat3(matrix[0][0],matrix[1][0],matrix[2][0],
matrix[0][1],matrix[1][1],matrix[2][1],
matrix[0][2],matrix[1][2],matrix[2][2]);}
#endif
vec2 getDataUV(float index,vec2 textureSize) {float y=floor(index/textureSize.x);float x=index-y*textureSize.x;return vec2((x+0.5)/textureSize.x,(y+0.5)/textureSize.y);}
#if SH_DEGREE>0
ivec2 getDataUVint(float index,vec2 textureSize) {float y=floor(index/textureSize.x);float x=index-y*textureSize.x;return ivec2(uint(x+0.5),uint(y+0.5));}
#endif
struct Splat {vec4 center;vec4 color;vec4 covA;vec4 covB;
#if SH_DEGREE>0
uvec4 sh0; 
#endif
#if SH_DEGREE>1
uvec4 sh1;
#endif
#if SH_DEGREE>2
uvec4 sh2;
#endif
};float getSplatIndex(int localIndex)
{float splatIndex;switch (localIndex)
{case 0: splatIndex=splatIndex0.x; break;case 1: splatIndex=splatIndex0.y; break;case 2: splatIndex=splatIndex0.z; break;case 3: splatIndex=splatIndex0.w; break;case 4: splatIndex=splatIndex1.x; break;case 5: splatIndex=splatIndex1.y; break;case 6: splatIndex=splatIndex1.z; break;case 7: splatIndex=splatIndex1.w; break;case 8: splatIndex=splatIndex2.x; break;case 9: splatIndex=splatIndex2.y; break;case 10: splatIndex=splatIndex2.z; break;case 11: splatIndex=splatIndex2.w; break;case 12: splatIndex=splatIndex3.x; break;case 13: splatIndex=splatIndex3.y; break;case 14: splatIndex=splatIndex3.z; break;case 15: splatIndex=splatIndex3.w; break;}
return splatIndex;}
Splat readSplat(float splatIndex)
{Splat splat;vec2 splatUV=getDataUV(splatIndex,dataTextureSize);splat.center=texture2D(centersTexture,splatUV);splat.color=texture2D(colorsTexture,splatUV);splat.covA=texture2D(covariancesATexture,splatUV)*splat.center.w;splat.covB=texture2D(covariancesBTexture,splatUV)*splat.center.w;
#if SH_DEGREE>0
ivec2 splatUVint=getDataUVint(splatIndex,dataTextureSize);splat.sh0=texelFetch(shTexture0,splatUVint,0);
#endif
#if SH_DEGREE>1
splat.sh1=texelFetch(shTexture1,splatUVint,0);
#endif
#if SH_DEGREE>2
splat.sh2=texelFetch(shTexture2,splatUVint,0);
#endif
return splat;}
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
vec3 computeColorFromSHDegree(vec3 dir,const vec3 sh[16])
{const float SH_C0=0.28209479;const float SH_C1=0.48860251;float SH_C2[5];SH_C2[0]=1.092548430;SH_C2[1]=-1.09254843;SH_C2[2]=0.315391565;SH_C2[3]=-1.09254843;SH_C2[4]=0.546274215;float SH_C3[7];SH_C3[0]=-0.59004358;SH_C3[1]=2.890611442;SH_C3[2]=-0.45704579;SH_C3[3]=0.373176332;SH_C3[4]=-0.45704579;SH_C3[5]=1.445305721;SH_C3[6]=-0.59004358;vec3 result=/*SH_C0**/sh[0];
#if SH_DEGREE>0
float x=dir.x;float y=dir.y;float z=dir.z;result+=- SH_C1*y*sh[1]+SH_C1*z*sh[2]-SH_C1*x*sh[3];
#if SH_DEGREE>1
float xx=x*x,yy=y*y,zz=z*z;float xy=x*y,yz=y*z,xz=x*z;result+=
SH_C2[0]*xy*sh[4] +
SH_C2[1]*yz*sh[5] +
SH_C2[2]*(2.0*zz-xx-yy)*sh[6] +
SH_C2[3]*xz*sh[7] +
SH_C2[4]*(xx-yy)*sh[8];
#if SH_DEGREE>2
result+=
SH_C3[0]*y*(3.0*xx-yy)*sh[9] +
SH_C3[1]*xy*z*sh[10] +
SH_C3[2]*y*(4.0*zz-xx-yy)*sh[11] +
SH_C3[3]*z*(2.0*zz-3.0*xx-3.0*yy)*sh[12] +
SH_C3[4]*x*(4.0*zz-xx-yy)*sh[13] +
SH_C3[5]*z*(xx-yy)*sh[14] +
SH_C3[6]*x*(xx-3.0*yy)*sh[15];
#endif
#endif
#endif
return result;}
vec4 decompose(uint value)
{vec4 components=vec4(
float((value ) & 255u),
float((value>>uint( 8)) & 255u),
float((value>>uint(16)) & 255u),
float((value>>uint(24)) & 255u));return components*vec4(2./255.)-vec4(1.);}
vec3 computeSH(Splat splat,vec3 dir)
{vec3 sh[16];sh[0]=vec3(0.,0.,0.);
#if SH_DEGREE>0
vec4 sh00=decompose(splat.sh0.x);vec4 sh01=decompose(splat.sh0.y);vec4 sh02=decompose(splat.sh0.z);sh[1]=vec3(sh00.x,sh00.y,sh00.z);sh[2]=vec3(sh00.w,sh01.x,sh01.y);sh[3]=vec3(sh01.z,sh01.w,sh02.x);
#endif
#if SH_DEGREE>1
vec4 sh03=decompose(splat.sh0.w);vec4 sh04=decompose(splat.sh1.x);vec4 sh05=decompose(splat.sh1.y);sh[4]=vec3(sh02.y,sh02.z,sh02.w);sh[5]=vec3(sh03.x,sh03.y,sh03.z);sh[6]=vec3(sh03.w,sh04.x,sh04.y);sh[7]=vec3(sh04.z,sh04.w,sh05.x);sh[8]=vec3(sh05.y,sh05.z,sh05.w);
#endif
#if SH_DEGREE>2
vec4 sh06=decompose(splat.sh1.z);vec4 sh07=decompose(splat.sh1.w);vec4 sh08=decompose(splat.sh2.x);vec4 sh09=decompose(splat.sh2.y);vec4 sh10=decompose(splat.sh2.z);vec4 sh11=decompose(splat.sh2.w);sh[9]=vec3(sh06.x,sh06.y,sh06.z);sh[10]=vec3(sh06.w,sh07.x,sh07.y);sh[11]=vec3(sh07.z,sh07.w,sh08.x);sh[12]=vec3(sh08.y,sh08.z,sh08.w);sh[13]=vec3(sh09.x,sh09.y,sh09.z);sh[14]=vec3(sh09.w,sh10.x,sh10.y);sh[15]=vec3(sh10.z,sh10.w,sh11.x); 
#endif
return computeColorFromSHDegree(dir,sh);}
#else
vec3 computeSH(Splat splat,vec3 dir)
{return vec3(0.,0.,0.);}
#endif
vec4 gaussianSplatting(vec2 meshPos,vec3 worldPos,vec2 scale,vec3 covA,vec3 covB,mat4 worldMatrix,mat4 viewMatrix,mat4 projectionMatrix)
{mat4 modelView=viewMatrix*worldMatrix;vec4 camspace=viewMatrix*vec4(worldPos,1.);vec4 pos2d=projectionMatrix*camspace;float bounds=1.2*pos2d.w;if (pos2d.z<-pos2d.w || pos2d.x<-bounds || pos2d.x>bounds
|| pos2d.y<-bounds || pos2d.y>bounds) {return vec4(0.0,0.0,2.0,1.0);}
mat3 Vrk=mat3(
covA.x,covA.y,covA.z,
covA.y,covB.x,covB.y,
covA.z,covB.y,covB.z
);bool isOrtho=abs(projectionMatrix[3][3]-1.0)<0.001;mat3 J;if (isOrtho) {J=mat3(
focal.x,0.,0.,
0.,focal.y,0.,
0.,0.,0.
);} else {J=mat3(
focal.x/camspace.z,0.,-(focal.x*camspace.x)/(camspace.z*camspace.z),
0.,focal.y/camspace.z,-(focal.y*camspace.y)/(camspace.z*camspace.z),
0.,0.,0.
);}
mat3 T=transpose(mat3(modelView))*J;mat3 cov2d=transpose(T)*Vrk*T;
#if COMPENSATION
float c00=cov2d[0][0];float c11=cov2d[1][1];float c01=cov2d[0][1];float detOrig=c00*c11-c01*c01;
#endif
cov2d[0][0]+=kernelSize;cov2d[1][1]+=kernelSize;
#if COMPENSATION
vec3 c2d=vec3(cov2d[0][0],c01,cov2d[1][1]);float detBlur=c2d.x*c2d.z-c2d.y*c2d.y;float compensation=sqrt(max(0.,detOrig/detBlur));vColor.w*=compensation;
#endif
float mid=(cov2d[0][0]+cov2d[1][1])/2.0;float radius=length(vec2((cov2d[0][0]-cov2d[1][1])/2.0,cov2d[0][1]));float epsilon=0.0001;float lambda1=mid+radius+epsilon,lambda2=mid-radius+epsilon;if (lambda2<0.0)
{return vec4(0.0,0.0,2.0,1.0);}
vec2 diagonalVector=normalize(vec2(cov2d[0][1],lambda1-cov2d[0][0]));vec2 majorAxis=min(sqrt(2.0*lambda1),1024.0)*diagonalVector;vec2 minorAxis=min(sqrt(2.0*lambda2),1024.0)*vec2(diagonalVector.y,-diagonalVector.x);vec2 vCenter=vec2(pos2d);float scaleFactor=isOrtho ? 1.0 : pos2d.w;return vec4(
vCenter 
+ ((meshPos.x*majorAxis
+ meshPos.y*minorAxis)*invViewport*scaleFactor)*scale,pos2d.zw);}`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},63278(e,t,i){var r=i(56863);i(26963),i(2438);let n="gaussianSplattingUboDeclaration",s=`#include<sceneUboDeclaration>
#include<meshUboDeclaration>
attribute vec3 position;attribute vec4 splatIndex0;attribute vec4 splatIndex1;attribute vec4 splatIndex2;attribute vec4 splatIndex3;
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},22738(e,t,i){i.d(t,{Q:()=>a});var r=i(56863);let n="gaussianSplattingVertexDeclaration",s="attribute vec3 position;attribute vec4 splatIndex0;attribute vec4 splatIndex1;attribute vec4 splatIndex2;attribute vec4 splatIndex3;uniform mat4 view;uniform mat4 projection;uniform mat4 world;uniform vec4 vEyePosition;";r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},56754(e,t,i){i.r(t),i.d(t,{helperFunctions:()=>a});var r=i(56863);let n="helperFunctions",s=`const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; 
const float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);return outMatrix;}
mat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}
#if USE_EXACT_SRGB_CONVERSIONS
vec3 toLinearSpaceExact(vec3 color)
{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));
#else
return
vec3(
color.r<=0.04045 ? nearZeroSection.r : remainingSection.r,
color.g<=0.04045 ? nearZeroSection.g : remainingSection.g,
color.b<=0.04045 ? nearZeroSection.b : remainingSection.b);
#endif
}
vec3 toGammaSpaceExact(vec3 color)
{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));
#else
return
vec3(
color.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,
color.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,
color.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);
#endif
}
#endif
float toLinearSpace(float color)
{
#if USE_EXACT_SRGB_CONVERSIONS
float nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;
#else
return pow(color,LinearEncodePowerApprox);
#endif
}
vec3 toLinearSpace(vec3 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return toLinearSpaceExact(color);
#else
return pow(color,vec3(LinearEncodePowerApprox));
#endif
}
vec4 toLinearSpace(vec4 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4(toLinearSpaceExact(color.rgb),color.a);
#else
return vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);
#endif
}
float toGammaSpace(float color)
{
#if USE_EXACT_SRGB_CONVERSIONS
float nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;
#else
return pow(color,GammaEncodePowerApprox);
#endif
}
vec3 toGammaSpace(vec3 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return toGammaSpaceExact(color);
#else
return pow(color,vec3(GammaEncodePowerApprox));
#endif
}
vec4 toGammaSpace(vec4 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4(toGammaSpaceExact(color.rgb),color.a);
#else
return vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);
#endif
}
float square(float value)
{return value*value;}
vec3 square(vec3 value)
{return value*value;}
float pow5(float value) {float sq=value*value;return sq*sq*value;}
vec3 double_refract(vec3 I,vec3 N,float eta) {vec3 Tfront=refract(I,N,1.0/eta);vec3 Nback=normalize(reflect(N,Tfront));return refract(Tfront,-Nback,eta);}
float getLuminance(vec3 color)
{return saturate(dot(color,LuminanceEncodeApprox));}
float getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}
float dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}
const float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}
vec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}
vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}
vec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}
float sqrtClamped(float value) {return sqrt(max(value,0.));}
float avg(vec3 value) {return dot(value,vec3(0.333333333));}
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE) 
uint extractBits(uint value,int offset,int width) {return (value>>offset) & ((1u<<width)-1u);}
int onlyBitPosition(uint value) {return (floatBitsToInt(float(value))>>23)-0x7f;}
vec3 singleScatterToMultiScatterAlbedo(vec3 rho_ss) {vec3 s=sqrt(max(vec3(1.0)-rho_ss,vec3(0.0)));return (vec3(1.0)-s)*(vec3(1.0)-vec3(0.139)*s)/(vec3(1.0)+vec3(1.17)*s);}
float min3(vec3 v) {return min(v.x,min(v.y,v.z));}
float max3(vec3 v) {return max(v.x,max(v.y,v.z));}
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},67195(e,t,i){var r=i(56863);let n="instancesDeclaration",s=`#ifdef INSTANCES
attribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;
#ifdef INSTANCESCOLOR
attribute vec4 instanceColor;
#endif
#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)
uniform mat4 world;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
attribute vec4 previousWorld0;attribute vec4 previousWorld1;attribute vec4 previousWorld2;attribute vec4 previousWorld3;
#ifdef THIN_INSTANCES
uniform mat4 previousWorld;
#endif
#endif
#else
#if !defined(WORLD_UBO)
uniform mat4 world;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
uniform mat4 previousWorld;
#endif
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},51409(e,t,i){var r=i(56863);let n="instancesVertex",s=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
mat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,
previousWorld2,previousWorld3);
#endif
#ifdef THIN_INSTANCES
finalWorld=world*finalWorld;
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
finalPreviousWorld=previousWorld*finalPreviousWorld;
#endif
#endif
#else
mat4 finalWorld=world;
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
mat4 finalPreviousWorld=previousWorld;
#endif
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},32654(e,t,i){var r=i(56863);let n="logDepthDeclaration",s=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;varying float vFragmentDepth;
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},29832(e,t,i){var r=i(56863);let n="logDepthFragment",s=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},90726(e,t,i){var r=i(56863);let n="logDepthVertex",s=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},2438(e,t,i){var r=i(56863);let n="meshUboDeclaration",s=`#ifdef WEBGL2
uniform mat4 world;uniform float visibility;
#else
layout(std140,column_major) uniform;uniform Mesh
{mat4 world;float visibility;};
#endif
#define WORLD_UBO
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},35397(e,t,i){i.r(t),i.d(t,{morphTargetsVertex:()=>a});var r=i(56863);let n="morphTargetsVertex",s=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
#if {X}==0
for (int i=0; i<NUM_MORPH_INFLUENCERS; i++) {if (float(i)>=morphTargetCount) break;vertexID=float(gl_VertexID)*morphTargetTextureInfo.x;
#ifdef MORPHTARGETS_POSITION
positionUpdated+=(readVector3FromRawSampler(i,vertexID)-position)*morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASPOSITIONS
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(readVector3FromRawSampler(i,vertexID) -normal)*morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASNORMALS
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(readVector3FromRawSampler(i,vertexID).xy-uv)*morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASUVS
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(readVector3FromRawSampler(i,vertexID) -tangent.xyz)*morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASTANGENTS
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_UV2
uv2Updated+=(readVector3FromRawSampler(i,vertexID).xy-uv2)*morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASUV2S
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_COLOR
colorUpdated+=(readVector4FromRawSampler(i,vertexID)-color)*morphTargetInfluences[i];
#endif
}
#endif
#else
#ifdef MORPHTARGETS_POSITION
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV2
uv2Updated+=(uv2_{X}-uv2)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_COLOR
colorUpdated+=(color{X}-color)*morphTargetInfluences[{X}];
#endif
#endif
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},8045(e,t,i){i.r(t),i.d(t,{morphTargetsVertexDeclaration:()=>a});var r=i(56863);let n="morphTargetsVertexDeclaration",s=`#ifdef MORPHTARGETS
#ifndef MORPHTARGETS_TEXTURE
#ifdef MORPHTARGETS_POSITION
attribute vec3 position{X};
#endif
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#ifdef MORPHTARGETS_UV
attribute vec2 uv_{X};
#endif
#ifdef MORPHTARGETS_UV2
attribute vec2 uv2_{X};
#endif
#ifdef MORPHTARGETS_COLOR
attribute vec4 color{X};
#endif
#elif {X}==0
uniform float morphTargetCount;
#endif
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},84542(e,t,i){i.r(t),i.d(t,{morphTargetsVertexGlobal:()=>a});var r=i(56863);let n="morphTargetsVertexGlobal",s=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
float vertexID;
#endif
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},54360(e,t,i){i.r(t),i.d(t,{morphTargetsVertexGlobalDeclaration:()=>a});var r=i(56863);let n="morphTargetsVertexGlobalDeclaration",s=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#ifdef MORPHTARGETS_TEXTURE 
uniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];uniform vec3 morphTargetTextureInfo;uniform highp sampler2DArray morphTargets;vec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)
{ 
float y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV).xyz;}
vec4 readVector4FromRawSampler(int targetIndex,float vertexIndex)
{ 
float y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV);}
#endif
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},82467(e,t,i){i.r(t),i.d(t,{packingFunctions:()=>a});var r=i(56863);let n="packingFunctions",s=`vec4 pack(float depth)
{const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
float unpack(vec4 color)
{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s);let a={name:n,shader:s}},33494(e,t,i){var r=i(56863);let n="pointCloudVertex",s=`#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},26963(e,t,i){var r=i(56863);let n="sceneUboDeclaration",s=`layout(std140,column_major) uniform;uniform Scene {mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif 
mat4 view;mat4 projection;vec4 vEyePosition;};
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},40120(e,t,i){var r=i(56863);let n="vertexColorMixing",s=`#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
vColor=vec4(1.0);
#ifdef VERTEXCOLOR
#ifdef VERTEXALPHA
vColor*=colorUpdated;
#else
vColor.rgb*=colorUpdated.rgb;
#endif
#endif
#ifdef INSTANCESCOLOR
vColor*=instanceColor;
#endif
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s)},71057(e,t,i){i.r(t),i.d(t,{colorPixelShader:()=>a});var r=i(56863);i(8779),i(47083),i(64023),i(98999);let n="colorPixelShader",s=`#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
#define VERTEXCOLOR
varying vec4 vColor;
#else
uniform vec4 color;
#endif
#include<clipPlaneFragmentDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
gl_FragColor=vColor;
#else
gl_FragColor=color;
#endif
#include<fogFragment>(color,gl_FragColor)
#define CUSTOM_FRAGMENT_MAIN_END
}`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s);let a={name:n,shader:s}},88667(e,t,i){i.r(t),i.d(t,{colorVertexShader:()=>a});var r=i(56863);i(53114),i(50480),i(48145),i(31377),i(67195),i(51409),i(54202),i(88806),i(75793),i(28049),i(40120);let n="colorVertexShader",s=`attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#ifdef FOG
uniform mat4 view;
#endif
#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef MULTIVIEW
uniform mat4 viewProjectionR;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#ifdef VERTEXCOLOR
vec4 colorUpdated=color;
#endif
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);
#ifdef MULTIVIEW
if (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}
#else
gl_Position=viewProjection*worldPos;
#endif
#include<clipPlaneVertex>
#include<fogVertex>
#include<vertexColorMixing>
#define CUSTOM_VERTEX_MAIN_END
}`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s);let a={name:n,shader:s}},24104(e,t,i){i.r(t),i.d(t,{depthVertexShader:()=>l});var r=i(56863);i(53114),i(50480),i(54360),i(8045),i(48145),i(67195);let n="pointCloudVertexDeclaration",s=`#ifdef POINTSIZE
uniform float pointSize;
#endif
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s),i(84542),i(35397),i(51409),i(54202),i(88806),i(75793),i(33494);let a="depthVertexShader",o=`attribute vec3 position;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#include<clipPlaneVertexDeclaration>
#include<instancesDeclaration>
uniform mat4 viewProjection;uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#ifdef STORE_CAMERASPACE_Z
uniform mat4 view;varying vec4 vViewPos;
#endif
#include<pointCloudVertexDeclaration>
varying float vDepthMetric;
#define CUSTOM_VERTEX_DEFINITIONS
void main(void)
{vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#ifdef UV2
vec2 uv2Updated=uv2;
#endif
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#include<clipPlaneVertex>
gl_Position=viewProjection*worldPos;
#ifdef STORE_CAMERASPACE_Z
vViewPos=view*worldPos;
#else
#ifdef USE_REVERSE_DEPTHBUFFER
vDepthMetric=((-gl_Position.z+depthValues.x)/(depthValues.y));
#else
vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));
#endif
#endif
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2Updated,1.0,0.0));
#endif
#endif
#include<pointCloudVertex>
}
`;r.l.ShadersStore[a]||(r.l.ShadersStore[a]=o);let l={name:a,shader:o}},95073(e,t,i){i.r(t),i.d(t,{gaussianSplattingPixelShader:()=>l});var r=i(56863);i(8779),i(32654),i(47083),i(29832),i(98999);let n="gaussianSplattingFragmentDeclaration",s=`vec4 gaussianColor(vec4 inColor)
{float A=-dot(vPosition,vPosition);if (A<-4.0) discard;float B=exp(A)*inColor.a;
#include<logDepthFragment>
vec3 color=inColor.rgb;
#ifdef FOG
#include<fogFragment>
#endif
return vec4(color,B);}
`;r.l.IncludesShadersStore[n]||(r.l.IncludesShadersStore[n]=s),i(64023);let a="gaussianSplattingPixelShader",o=`#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
varying vec4 vColor;varying vec2 vPosition;
#include<gaussianSplattingFragmentDeclaration>
void main () { 
#include<clipPlaneFragment>
gl_FragColor=gaussianColor(vColor);}
`;r.l.ShadersStore[a]||(r.l.ShadersStore[a]=o);let l={name:a,shader:o}},65625(e,t,i){i.r(t),i.d(t,{gaussianSplattingVertexShader:()=>a});var r=i(56863);i(22738),i(63278),i(48145),i(31377),i(32654),i(56754),i(38550),i(75793),i(28049),i(90726);let n="gaussianSplattingVertexShader",s=`#include<__decl__gaussianSplattingVertex>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<logDepthDeclaration>
#include<helperFunctions>
uniform vec2 invViewport;uniform vec2 dataTextureSize;uniform vec2 focal;uniform float kernelSize;uniform vec3 eyePosition;uniform float alpha;uniform sampler2D covariancesATexture;uniform sampler2D covariancesBTexture;uniform sampler2D centersTexture;uniform sampler2D colorsTexture;
#if SH_DEGREE>0
uniform highp usampler2D shTexture0;
#endif
#if SH_DEGREE>1
uniform highp usampler2D shTexture1;
#endif
#if SH_DEGREE>2
uniform highp usampler2D shTexture2;
#endif
varying vec4 vColor;varying vec2 vPosition;
#include<gaussianSplatting>
void main () {float splatIndex=getSplatIndex(int(position.z+0.5));Splat splat=readSplat(splatIndex);vec3 covA=splat.covA.xyz;vec3 covB=vec3(splat.covA.w,splat.covB.xy);vec4 worldPos=world*vec4(splat.center.xyz,1.0);vColor=splat.color;vPosition=position.xy;
#if SH_DEGREE>0
mat3 worldRot=mat3(world);mat3 normWorldRot=inverseMat3(worldRot);vec3 eyeToSplatLocalSpace=normalize(normWorldRot*(worldPos.xyz-eyePosition));vColor.xyz=splat.color.xyz+computeSH(splat,eyeToSplatLocalSpace);
#endif
vColor.w*=alpha;gl_Position=gaussianSplatting(position.xy,worldPos.xyz,vec2(1.,1.),covA,covB,world,view,projection);
#include<clipPlaneVertex>
#include<fogVertex>
#include<logDepthVertex>
}
`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s);let a={name:n,shader:s}},74112(e,t,i){var r=i(56863);let n="gaussianSplattingDepthPixelShader",s=`precision highp float;varying vec2 vPosition;varying vec4 vColor;
#ifdef DEPTH_RENDER
varying float vDepthMetric;
#endif
void main(void) {float A=-dot(vPosition,vPosition);
#if defined(SM_SOFTTRANSPARENTSHADOW) && SM_SOFTTRANSPARENTSHADOW==1
float alpha=exp(A)*vColor.a;if (A<-4.) discard;
#else
if (A<-vColor.a) discard;
#endif
#ifdef DEPTH_RENDER
gl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);
#endif
}`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s)},90126(e,t,i){var r=i(56863);i(22738),i(63278),i(38550);let n="gaussianSplattingDepthVertexShader",s=`#include<__decl__gaussianSplattingVertex>
uniform vec2 invViewport;uniform vec2 dataTextureSize;uniform vec2 focal;uniform float kernelSize;uniform float alpha;uniform sampler2D covariancesATexture;uniform sampler2D covariancesBTexture;uniform sampler2D centersTexture;uniform sampler2D colorsTexture;varying vec2 vPosition;varying vec4 vColor;
#include<gaussianSplatting>
#ifdef DEPTH_RENDER
uniform vec2 depthValues;varying float vDepthMetric;
#endif
void main(void) {float splatIndex=getSplatIndex(int(position.z+0.5));Splat splat=readSplat(splatIndex);vec3 covA=splat.covA.xyz;vec3 covB=vec3(splat.covA.w,splat.covB.xy);vec4 worldPosGS=world*vec4(splat.center.xyz,1.0);vPosition=position.xy;vColor=splat.color;vColor.w*=alpha;gl_Position=gaussianSplatting(position.xy,worldPosGS.xyz,vec2(1.,1.),covA,covB,world,view,projection);
#ifdef DEPTH_RENDER
#ifdef USE_REVERSE_DEPTHBUFFER
vDepthMetric=((-gl_Position.z+depthValues.x)/(depthValues.y));
#else
vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));
#endif
#endif
}`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s)},17119(e,t,i){i.r(t),i.d(t,{postprocessVertexShader:()=>a});var r=i(56863);let n="postprocessVertexShader",s=`attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);
#define CUSTOM_VERTEX_MAIN_END
}`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s);let a={name:n,shader:s}},86385(e,t,i){i.r(t),i.d(t,{sharpenPixelShader:()=>a});var r=i(56863);let n="sharpenPixelShader",s=`varying vec2 vUV;uniform sampler2D textureSampler;uniform vec2 screenSize;uniform vec2 sharpnessAmounts;
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{vec2 onePixel=vec2(1.0,1.0)/screenSize;vec4 color=texture2D(textureSampler,vUV);vec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(0,1)) -
color*4.0;gl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);}`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s);let a={name:n,shader:s}},6610(e,t,i){var r=i(56863);let n="volumetricLightScatteringPixelShader",s=`uniform sampler2D textureSampler;uniform sampler2D lightScatteringSampler;uniform float decay;uniform float exposure;uniform float weight;uniform float density;uniform vec2 meshPositionOnScreen;varying vec2 vUV;
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
vec2 tc=vUV;vec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);deltaTexCoord*=1.0/float(NUM_SAMPLES)*density;float illuminationDecay=1.0;vec4 color=texture2D(lightScatteringSampler,tc)*0.4;for(int i=0; i<NUM_SAMPLES; i++) {tc-=deltaTexCoord;vec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;dataSample*=illuminationDecay*weight;color+=dataSample;illuminationDecay*=decay;}
vec4 realColor=texture2D(textureSampler,vUV);gl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),realColor.a))+(realColor*(1.5-0.4)));
#define CUSTOM_FRAGMENT_MAIN_END
}
`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s)},91685(e,t,i){var r=i(56863);let n="volumetricLightScatteringPassPixelShader",s=`#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
#endif
#if defined(ALPHATEST)
uniform sampler2D diffuseSampler;
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{
#if defined(ALPHATEST)
vec4 diffuseColor=texture2D(diffuseSampler,vUV);if (diffuseColor.a<0.4)
discard;
#endif
gl_FragColor=vec4(0.0,0.0,0.0,1.0);}
`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s)},10479(e,t,i){var r=i(56863);i(53114),i(50480),i(54360),i(8045),i(67195),i(84542),i(35397),i(51409),i(54202),i(88806);let n="volumetricLightScatteringPassVertexShader",s=`attribute vec3 position;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#include<instancesDeclaration>
uniform mat4 viewProjection;uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#define CUSTOM_VERTEX_DEFINITIONS
void main(void)
{vec3 positionUpdated=position;
#if (defined(ALPHATEST) || defined(NEED_UV)) && defined(UV1)
vec2 uvUpdated=uv;
#endif
#if (defined(ALPHATEST) || defined(NEED_UV)) && defined(UV2)
vec2 uv2Updated=uv2;
#endif
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2Updated,1.0,0.0));
#endif
#endif
}
`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s)},69072(e,t,i){var r=i(56863);let n="vrMultiviewToSingleviewPixelShader",s=`precision mediump sampler2DArray;varying vec2 vUV;uniform sampler2DArray multiviewSampler;uniform int imageIndex;
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{gl_FragColor=texture2D(multiviewSampler,vec3(vUV,imageIndex));}`;r.l.ShadersStore[n]||(r.l.ShadersStore[n]=s)},70927(e,t,i){var r=i(56863);let n="bakedVertexAnimation",s=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
{
#ifdef INSTANCES
let VATStartFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.x;let VATEndFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.y;let VATOffsetFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.z;let VATSpeed: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.w;
#else
let VATStartFrame: f32=uniforms.bakedVertexAnimationSettings.x;let VATEndFrame: f32=uniforms.bakedVertexAnimationSettings.y;let VATOffsetFrame: f32=uniforms.bakedVertexAnimationSettings.z;let VATSpeed: f32=uniforms.bakedVertexAnimationSettings.w;
#endif
let totalFrames: f32=VATEndFrame-VATStartFrame+1.0;let time: f32=uniforms.bakedVertexAnimationTime*VATSpeed/totalFrames;let frameCorrection: f32=select(1.0,0.0,time<1.0);let numOfFrames: f32=totalFrames-frameCorrection;var VATFrameNum: f32=fract(time)*numOfFrames;VATFrameNum=(VATFrameNum+VATOffsetFrame) % numOfFrames;VATFrameNum=floor(VATFrameNum);VATFrameNum=VATFrameNum+VATStartFrame+frameCorrection;var VATInfluence : mat4x4<f32>;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[0],VATFrameNum)*vertexInputs.matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[1],VATFrameNum)*vertexInputs.matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[2],VATFrameNum)*vertexInputs.matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[3],VATFrameNum)*vertexInputs.matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[0],VATFrameNum)*vertexInputs.matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[1],VATFrameNum)*vertexInputs.matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[2],VATFrameNum)*vertexInputs.matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
VATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[3],VATFrameNum)*vertexInputs.matricesWeightsExtra[3];
#endif
finalWorld=finalWorld*VATInfluence;}
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},37811(e,t,i){var r=i(56863);let n="bakedVertexAnimationDeclaration",s=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
uniform bakedVertexAnimationTime: f32;uniform bakedVertexAnimationTextureSizeInverted: vec2<f32>;uniform bakedVertexAnimationSettings: vec4<f32>;var bakedVertexAnimationTexture : texture_2d<f32>;
#ifdef INSTANCES
attribute bakedVertexAnimationSettingsInstanced : vec4<f32>;
#endif
fn readMatrixFromRawSamplerVAT(smp : texture_2d<f32>,index : f32,frame : f32)->mat4x4<f32>
{let offset=i32(index)*4;let frameUV=i32(frame);let m0=textureLoad(smp,vec2<i32>(offset+0,frameUV),0);let m1=textureLoad(smp,vec2<i32>(offset+1,frameUV),0);let m2=textureLoad(smp,vec2<i32>(offset+2,frameUV),0);let m3=textureLoad(smp,vec2<i32>(offset+3,frameUV),0);return mat4x4<f32>(m0,m1,m2,m3);}
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},33879(e,t,i){i.r(t),i.d(t,{bonesDeclarationWGSL:()=>a});var r=i(56863);let n="bonesDeclaration",s=`#if NUM_BONE_INFLUENCERS>0
attribute matricesIndices : vec4f;attribute matricesWeights : vec4f;
#if NUM_BONE_INFLUENCERS>4
attribute matricesIndicesExtra : vec4f;attribute matricesWeightsExtra : vec4f;
#endif
#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#ifdef BONETEXTURE
var boneSampler : texture_2d<f32>;uniform boneTextureWidth : f32;
#else
uniform mBones : array<mat4x4f,BonesPerMesh>;
#endif
#ifdef BONES_VELOCITY_ENABLED
uniform mPreviousBones : array<mat4x4f,BonesPerMesh>;
#endif
#ifdef BONETEXTURE
fn readMatrixFromRawSampler(smp : texture_2d<f32>,index : f32)->mat4x4f
{let offset=i32(index) *4; 
let m0=textureLoad(smp,vec2<i32>(offset+0,0),0);let m1=textureLoad(smp,vec2<i32>(offset+1,0),0);let m2=textureLoad(smp,vec2<i32>(offset+2,0),0);let m3=textureLoad(smp,vec2<i32>(offset+3,0),0);return mat4x4f(m0,m1,m2,m3);}
#endif
#endif
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},51541(e,t,i){i.r(t),i.d(t,{bonesVertexWGSL:()=>a});var r=i(56863);let n="bonesVertex",s=`#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#if NUM_BONE_INFLUENCERS>0
var influence : mat4x4<f32>;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[0])*vertexInputs.matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[1])*vertexInputs.matricesWeights[1];
#endif 
#if NUM_BONE_INFLUENCERS>2
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[2])*vertexInputs.matricesWeights[2];
#endif 
#if NUM_BONE_INFLUENCERS>3
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[3])*vertexInputs.matricesWeights[3];
#endif 
#if NUM_BONE_INFLUENCERS>4
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[0])*vertexInputs.matricesWeightsExtra[0];
#endif 
#if NUM_BONE_INFLUENCERS>5
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[1])*vertexInputs.matricesWeightsExtra[1];
#endif 
#if NUM_BONE_INFLUENCERS>6
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[2])*vertexInputs.matricesWeightsExtra[2];
#endif 
#if NUM_BONE_INFLUENCERS>7
influence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[3])*vertexInputs.matricesWeightsExtra[3];
#endif 
#else 
influence=uniforms.mBones[i32(vertexInputs.matricesIndices[0])]*vertexInputs.matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndices[1])]*vertexInputs.matricesWeights[1];
#endif 
#if NUM_BONE_INFLUENCERS>2
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndices[2])]*vertexInputs.matricesWeights[2];
#endif 
#if NUM_BONE_INFLUENCERS>3
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndices[3])]*vertexInputs.matricesWeights[3];
#endif 
#if NUM_BONE_INFLUENCERS>4
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndicesExtra[0])]*vertexInputs.matricesWeightsExtra[0];
#endif 
#if NUM_BONE_INFLUENCERS>5
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndicesExtra[1])]*vertexInputs.matricesWeightsExtra[1];
#endif 
#if NUM_BONE_INFLUENCERS>6
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndicesExtra[2])]*vertexInputs.matricesWeightsExtra[2];
#endif 
#if NUM_BONE_INFLUENCERS>7
influence=influence+uniforms.mBones[i32(vertexInputs.matricesIndicesExtra[3])]*vertexInputs.matricesWeightsExtra[3];
#endif 
#endif
finalWorld=finalWorld*influence;
#endif
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},19456(e,t,i){i.r(t),i.d(t,{clipPlaneFragmentWGSL:()=>a});var r=i(56863);let n="clipPlaneFragment",s=`#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
if (false) {}
#endif
#ifdef CLIPPLANE
else if (fragmentInputs.fClipDistance>0.0)
{discard;}
#endif
#ifdef CLIPPLANE2
else if (fragmentInputs.fClipDistance2>0.0)
{discard;}
#endif
#ifdef CLIPPLANE3
else if (fragmentInputs.fClipDistance3>0.0)
{discard;}
#endif
#ifdef CLIPPLANE4
else if (fragmentInputs.fClipDistance4>0.0)
{discard;}
#endif
#ifdef CLIPPLANE5
else if (fragmentInputs.fClipDistance5>0.0)
{discard;}
#endif
#ifdef CLIPPLANE6
else if (fragmentInputs.fClipDistance6>0.0)
{discard;}
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},64470(e,t,i){i.r(t),i.d(t,{clipPlaneFragmentDeclarationWGSL:()=>a});var r=i(56863);let n="clipPlaneFragmentDeclaration",s=`#ifdef CLIPPLANE
varying fClipDistance: f32;
#endif
#ifdef CLIPPLANE2
varying fClipDistance2: f32;
#endif
#ifdef CLIPPLANE3
varying fClipDistance3: f32;
#endif
#ifdef CLIPPLANE4
varying fClipDistance4: f32;
#endif
#ifdef CLIPPLANE5
varying fClipDistance5: f32;
#endif
#ifdef CLIPPLANE6
varying fClipDistance6: f32;
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},96526(e,t,i){i.r(t),i.d(t,{clipPlaneVertexWGSL:()=>a});var r=i(56863);let n="clipPlaneVertex",s=`#ifdef CLIPPLANE
vertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);
#endif
#ifdef CLIPPLANE2
vertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);
#endif
#ifdef CLIPPLANE3
vertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);
#endif
#ifdef CLIPPLANE4
vertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);
#endif
#ifdef CLIPPLANE5
vertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);
#endif
#ifdef CLIPPLANE6
vertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},17800(e,t,i){i.r(t),i.d(t,{clipPlaneVertexDeclarationWGSL:()=>a});var r=i(56863);let n="clipPlaneVertexDeclaration",s=`#ifdef CLIPPLANE
uniform vClipPlane: vec4<f32>;varying fClipDistance: f32;
#endif
#ifdef CLIPPLANE2
uniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;
#endif
#ifdef CLIPPLANE3
uniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;
#endif
#ifdef CLIPPLANE4
uniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;
#endif
#ifdef CLIPPLANE5
uniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;
#endif
#ifdef CLIPPLANE6
uniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},92137(e,t,i){var r=i(56863);let n="decalFragment",s=`#ifdef DECAL
var decalTempColor=decalColor.rgb;var decalTempAlpha=decalColor.a;
#ifdef GAMMADECAL
decalTempColor=toLinearSpaceVec3(decalColor.rgb);
#endif
#ifdef DECAL_SMOOTHALPHA
decalTempAlpha=decalColor.a*decalColor.a;
#endif
surfaceAlbedo=mix(surfaceAlbedo.rgb,decalTempColor,decalTempAlpha);
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},56044(e,t,i){var r=i(56863);let n="fogFragment",s=`#ifdef FOG
var fog: f32=CalcFogFactor();
#ifdef PBR
fog=toLinearSpace(fog);
#endif
color= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},3162(e,t,i){i.r(t),i.d(t,{fogFragmentDeclarationWGSL:()=>a});var r=i(56863);let n="fogFragmentDeclaration",s=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
const E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32
{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)
{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}
else if (FOGMODE_EXP==uniforms.vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}
else if (FOGMODE_EXP2==uniforms.vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}
return clamp(fogCoeff,0.0,1.0);}
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},3706(e,t,i){var r=i(56863);let n="fogVertex",s=`#ifdef FOG
#ifdef SCENE_UBO
vertexOutputs.vFogDistance=(scene.view*worldPos).xyz;
#else
vertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;
#endif
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},93580(e,t,i){var r=i(56863);let n="fogVertexDeclaration",s=`#ifdef FOG
varying vFogDistance: vec3f;
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},57087(e,t,i){var r=i(56863);let n="fresnelFunction",s=`#ifdef FRESNEL
fn computeFresnelTerm(viewDirection: vec3f,worldNormal: vec3f,bias: f32,power: f32)->f32
{let fresnelTerm: f32=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},57829(e,t,i){var r=i(56863);let n="gaussianSplatting",s=`fn getDataUV(index: f32,dataTextureSize: vec2f)->vec2<f32> {let y: f32=floor(index/dataTextureSize.x);let x: f32=index-y*dataTextureSize.x;return vec2f((x+0.5),(y+0.5));}
struct Splat {center: vec4f,
color: vec4f,
covA: vec4f,
covB: vec4f,
#if SH_DEGREE>0
sh0: vec4<u32>,
#endif
#if SH_DEGREE>1
sh1: vec4<u32>,
#endif
#if SH_DEGREE>2
sh2: vec4<u32>,
#endif
};fn getSplatIndex(localIndex: i32,splatIndex0: vec4f,splatIndex1: vec4f,splatIndex2: vec4f,splatIndex3: vec4f)->f32 {var splatIndex: f32;switch (localIndex)
{case 0:
{splatIndex=splatIndex0.x;break;}
case 1:
{splatIndex=splatIndex0.y;break;}
case 2:
{splatIndex=splatIndex0.z;break;}
case 3:
{splatIndex=splatIndex0.w;break;}
case 4:
{splatIndex=splatIndex1.x;break;}
case 5:
{splatIndex=splatIndex1.y;break;}
case 6:
{splatIndex=splatIndex1.z;break;}
case 7:
{splatIndex=splatIndex1.w;break;}
case 8:
{splatIndex=splatIndex2.x;break;}
case 9:
{splatIndex=splatIndex2.y;break;}
case 10:
{splatIndex=splatIndex2.z;break;}
case 11:
{splatIndex=splatIndex2.w;break;}
case 12:
{splatIndex=splatIndex3.x;break;}
case 13:
{splatIndex=splatIndex3.y;break;}
case 14:
{splatIndex=splatIndex3.z;break;}
default:
{splatIndex=splatIndex3.w;break;}}
return splatIndex;}
fn readSplat(splatIndex: f32,dataTextureSize: vec2f)->Splat {var splat: Splat;let splatUV=getDataUV(splatIndex,dataTextureSize);let splatUVi32=vec2<i32>(i32(splatUV.x),i32(splatUV.y));splat.center=textureLoad(centersTexture,splatUVi32,0);splat.color=textureLoad(colorsTexture,splatUVi32,0);splat.covA=textureLoad(covariancesATexture,splatUVi32,0)*splat.center.w;splat.covB=textureLoad(covariancesBTexture,splatUVi32,0)*splat.center.w;
#if SH_DEGREE>0
splat.sh0=textureLoad(shTexture0,splatUVi32,0);
#endif
#if SH_DEGREE>1
splat.sh1=textureLoad(shTexture1,splatUVi32,0);
#endif
#if SH_DEGREE>2
splat.sh2=textureLoad(shTexture2,splatUVi32,0);
#endif
return splat;}
fn computeColorFromSHDegree(dir: vec3f,sh: array<vec3<f32>,16>)->vec3f
{let SH_C0: f32=0.28209479;let SH_C1: f32=0.48860251;var SH_C2: array<f32,5>=array<f32,5>(
1.092548430,
-1.09254843,
0.315391565,
-1.09254843,
0.546274215
);var SH_C3: array<f32,7>=array<f32,7>(
-0.59004358,
2.890611442,
-0.45704579,
0.373176332,
-0.45704579,
1.445305721,
-0.59004358
);var result: vec3f=/*SH_C0**/sh[0];
#if SH_DEGREE>0
let x: f32=dir.x;let y: f32=dir.y;let z: f32=dir.z;result+=-SH_C1*y*sh[1]+SH_C1*z*sh[2]-SH_C1*x*sh[3];
#if SH_DEGREE>1
let xx: f32=x*x;let yy: f32=y*y;let zz: f32=z*z;let xy: f32=x*y;let yz: f32=y*z;let xz: f32=x*z;result+=
SH_C2[0]*xy*sh[4] +
SH_C2[1]*yz*sh[5] +
SH_C2[2]*(2.0f*zz-xx-yy)*sh[6] +
SH_C2[3]*xz*sh[7] +
SH_C2[4]*(xx-yy)*sh[8];
#if SH_DEGREE>2
result+=
SH_C3[0]*y*(3.0f*xx-yy)*sh[9] +
SH_C3[1]*xy*z*sh[10] +
SH_C3[2]*y*(4.0f*zz-xx-yy)*sh[11] +
SH_C3[3]*z*(2.0f*zz-3.0f*xx-3.0f*yy)*sh[12] +
SH_C3[4]*x*(4.0f*zz-xx-yy)*sh[13] +
SH_C3[5]*z*(xx-yy)*sh[14] +
SH_C3[6]*x*(xx-3.0f*yy)*sh[15];
#endif
#endif
#endif
return result;}
fn decompose(value: u32)->vec4f
{let components : vec4f=vec4f(
f32((value ) & 255u),
f32((value>>u32( 8)) & 255u),
f32((value>>u32(16)) & 255u),
f32((value>>u32(24)) & 255u));return components*vec4f(2./255.)-vec4f(1.);}
fn computeSH(splat: Splat,dir: vec3f)->vec3f
{var sh: array<vec3<f32>,16>;sh[0]=vec3f(0.,0.,0.);
#if SH_DEGREE>0
let sh00: vec4f=decompose(splat.sh0.x);let sh01: vec4f=decompose(splat.sh0.y);let sh02: vec4f=decompose(splat.sh0.z);sh[1]=vec3f(sh00.x,sh00.y,sh00.z);sh[2]=vec3f(sh00.w,sh01.x,sh01.y);sh[3]=vec3f(sh01.z,sh01.w,sh02.x);
#endif
#if SH_DEGREE>1
let sh03: vec4f=decompose(splat.sh0.w);let sh04: vec4f=decompose(splat.sh1.x);let sh05: vec4f=decompose(splat.sh1.y);sh[4]=vec3f(sh02.y,sh02.z,sh02.w);sh[5]=vec3f(sh03.x,sh03.y,sh03.z);sh[6]=vec3f(sh03.w,sh04.x,sh04.y);sh[7]=vec3f(sh04.z,sh04.w,sh05.x);sh[8]=vec3f(sh05.y,sh05.z,sh05.w);
#endif
#if SH_DEGREE>2
let sh06: vec4f=decompose(splat.sh1.z);let sh07: vec4f=decompose(splat.sh1.w);let sh08: vec4f=decompose(splat.sh2.x);let sh09: vec4f=decompose(splat.sh2.y);let sh10: vec4f=decompose(splat.sh2.z);let sh11: vec4f=decompose(splat.sh2.w);sh[9]=vec3f(sh06.x,sh06.y,sh06.z);sh[10]=vec3f(sh06.w,sh07.x,sh07.y);sh[11]=vec3f(sh07.z,sh07.w,sh08.x);sh[12]=vec3f(sh08.y,sh08.z,sh08.w);sh[13]=vec3f(sh09.x,sh09.y,sh09.z);sh[14]=vec3f(sh09.w,sh10.x,sh10.y);sh[15]=vec3f(sh10.z,sh10.w,sh11.x); 
#endif
return computeColorFromSHDegree(dir,sh);}
fn gaussianSplatting(
meshPos: vec2<f32>,
worldPos: vec3<f32>,
scale: vec2<f32>,
covA: vec3<f32>,
covB: vec3<f32>,
worldMatrix: mat4x4<f32>,
viewMatrix: mat4x4<f32>,
projectionMatrix: mat4x4<f32>,
focal: vec2f,
invViewport: vec2f,
kernelSize: f32
)->vec4f {let modelView=viewMatrix*worldMatrix;let camspace=viewMatrix*vec4f(worldPos,1.0);let pos2d=projectionMatrix*camspace;let bounds=1.2*pos2d.w;if (pos2d.z<0. || pos2d.x<-bounds || pos2d.x>bounds || pos2d.y<-bounds || pos2d.y>bounds) {return vec4f(0.0,0.0,2.0,1.0);}
let Vrk=mat3x3<f32>(
covA.x,covA.y,covA.z,
covA.y,covB.x,covB.y,
covA.z,covB.y,covB.z
);let isOrtho=abs(projectionMatrix[3][3]-1.0)<0.001;var J: mat3x3<f32>;if (isOrtho) {J=mat3x3<f32>(
focal.x,0.0,0.0,
0.0,focal.y,0.0,
0.0,0.0,0.0
);} else {J=mat3x3<f32>(
focal.x/camspace.z,0.0,-(focal.x*camspace.x)/(camspace.z*camspace.z),
0.0,focal.y/camspace.z,-(focal.y*camspace.y)/(camspace.z*camspace.z),
0.0,0.0,0.0
);}
let T=transpose(mat3x3<f32>(
modelView[0].xyz,
modelView[1].xyz,
modelView[2].xyz))*J;var cov2d=transpose(T)*Vrk*T;
#if COMPENSATION
let c00: f32=cov2d[0][0];let c11: f32=cov2d[1][1];let c01: f32=cov2d[0][1];let detOrig: f32=c00*c11-c01*c01;
#endif
cov2d[0][0]+=kernelSize;cov2d[1][1]+=kernelSize;
#if COMPENSATION
let c2d: vec3f=vec3f(cov2d[0][0],c01,cov2d[1][1]);let detBlur: f32=c2d.x*c2d.z-c2d.y*c2d.y;let compensation: f32=sqrt(max(0.,detOrig/detBlur));vertexOutputs.vColor.w*=compensation;
#endif
let mid=(cov2d[0][0]+cov2d[1][1])/2.0;let radius=length(vec2<f32>((cov2d[0][0]-cov2d[1][1])/2.0,cov2d[0][1]));let lambda1=mid+radius;let lambda2=mid-radius;if (lambda2<0.0) {return vec4f(0.0,0.0,2.0,1.0);}
let diagonalVector=normalize(vec2<f32>(cov2d[0][1],lambda1-cov2d[0][0]));let majorAxis=min(sqrt(2.0*lambda1),1024.0)*diagonalVector;let minorAxis=min(sqrt(2.0*lambda2),1024.0)*vec2<f32>(diagonalVector.y,-diagonalVector.x);let vCenter=vec2<f32>(pos2d.x,pos2d.y);let scaleFactor=select(pos2d.w,1.0,isOrtho);return vec4f(
vCenter+((meshPos.x*majorAxis+meshPos.y*minorAxis)*invViewport*scaleFactor)*scale,
pos2d.z,
pos2d.w
);}`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},33469(e,t,i){var r=i(56863);i(44865),i(56044);let n="gaussianSplattingFragmentDeclaration",s=`fn gaussianColor(inColor: vec4f,inPosition: vec2f)->vec4f
{var A : f32=-dot(inPosition,inPosition);if (A>-4.0)
{var B: f32=exp(A)*inColor.a;
#include<logDepthFragment>
var color: vec3f=inColor.rgb;
#ifdef FOG
#include<fogFragment>
#endif
return vec4f(color,B);} else {return vec4f(0.0);}}
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},75185(e,t,i){i.r(t),i.d(t,{helperFunctionsWGSL:()=>a});var r=i(56863);let n="helperFunctions",s=`const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; 
const LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}
fn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}
fn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}
fn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}
fn maxEps(x: f32)->f32 {return max(x,Epsilon);}
fn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}
fn absEps(x: f32)->f32 {return abs(x)+Epsilon;}
fn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);return outMatrix;}
fn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,
b11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,
b21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}
#if USE_EXACT_SRGB_CONVERSIONS
fn toLinearSpaceExact(color: vec3f)->vec3f
{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}
fn toGammaSpaceExact(color: vec3f)->vec3f
{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}
#endif
fn toLinearSpace(color: f32)->f32
{
#if USE_EXACT_SRGB_CONVERSIONS
var nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);
#else
return pow(color,LinearEncodePowerApprox);
#endif
}
fn toLinearSpaceVec3(color: vec3f)->vec3f
{
#if USE_EXACT_SRGB_CONVERSIONS
return toLinearSpaceExact(color);
#else
return pow(color,vec3f(LinearEncodePowerApprox));
#endif
}
fn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4f(toLinearSpaceExact(color.rgb),color.a);
#else
return vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);
#endif
}
fn toGammaSpace(color: vec4<f32>)->vec4<f32>
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4<f32>(toGammaSpaceExact(color.rgb),color.a);
#else
return vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);
#endif
}
fn toGammaSpaceVec3(color: vec3f)->vec3f
{
#if USE_EXACT_SRGB_CONVERSIONS
return toGammaSpaceExact(color);
#else
return pow(color,vec3f(GammaEncodePowerApprox));
#endif
}
fn squareVec3(value: vec3f)->vec3f
{return value*value;}
fn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}
fn double_refract(I: vec3f,N: vec3f,eta: f32)->vec3f {let Tfront: vec3f=refract(I,N,1.0/eta);let Nback: vec3f=normalize(reflect(N,Tfront));return refract(Tfront,-Nback,eta);}
fn getLuminance(color: vec3f)->f32
{return saturate(dot(color,LuminanceEncodeApprox));}
fn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}
fn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}
const rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}
fn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}
fn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}
fn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}
fn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}
fn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}
fn singleScatterToMultiScatterAlbedo(rho_ss: vec3f)->vec3f {let s: vec3f=sqrt(max(vec3f(1.0)-rho_ss,vec3f(0.0)));return (vec3f(1.0)-s)*(vec3f(1.0)-vec3f(0.139)*s)/(vec3f(1.0)+vec3f(1.17)*s);}
fn min3(v: vec3f)->f32 {return min(v.x,min(v.y,v.z));}
fn max3(v: vec3f)->f32 {return max(v.x,max(v.y,v.z));}
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},78054(e,t,i){var r=i(56863);let n="instancesDeclaration",s=`#ifdef INSTANCES
attribute world0 : vec4<f32>;attribute world1 : vec4<f32>;attribute world2 : vec4<f32>;attribute world3 : vec4<f32>;
#ifdef INSTANCESCOLOR
attribute instanceColor : vec4<f32>;
#endif
#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)
uniform world : mat4x4<f32>;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
attribute previousWorld0 : vec4<f32>;attribute previousWorld1 : vec4<f32>;attribute previousWorld2 : vec4<f32>;attribute previousWorld3 : vec4<f32>;
#ifdef THIN_INSTANCES
uniform previousWorld : mat4x4<f32>;
#endif
#endif
#else
#if !defined(WORLD_UBO)
uniform world : mat4x4<f32>;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
uniform previousWorld : mat4x4<f32>;
#endif
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},46014(e,t,i){var r=i(56863);let n="instancesVertex",s=`#ifdef INSTANCES
var finalWorld=mat4x4<f32>(vertexInputs.world0,vertexInputs.world1,vertexInputs.world2,vertexInputs.world3);
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
var finalPreviousWorld=mat4x4<f32>(
vertexInputs.previousWorld0,vertexInputs.previousWorld1,
vertexInputs.previousWorld2,vertexInputs.previousWorld3);
#endif
#ifdef THIN_INSTANCES
#if !defined(WORLD_UBO)
finalWorld=uniforms.world*finalWorld;
#else
finalWorld=mesh.world*finalWorld;
#endif
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
finalPreviousWorld=uniforms.previousWorld*finalPreviousWorld;
#endif
#endif
#else
#if !defined(WORLD_UBO)
var finalWorld=uniforms.world;
#else
var finalWorld=mesh.world;
#endif
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR) || defined(VELOCITY_LINEAR)
var finalPreviousWorld=uniforms.previousWorld;
#endif
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},63745(e,t,i){var r=i(56863);let n="logDepthDeclaration",s=`#ifdef LOGARITHMICDEPTH
uniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},44865(e,t,i){var r=i(56863);let n="logDepthFragment",s=`#ifdef LOGARITHMICDEPTH
fragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},18315(e,t,i){var r=i(56863);let n="logDepthVertex",s=`#ifdef LOGARITHMICDEPTH
vertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},40151(e,t,i){var r=i(56863);let n="meshUboDeclaration",s=`struct Mesh {world : mat4x4<f32>,
visibility : f32,};var<uniform> mesh : Mesh;
#define WORLD_UBO
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},95352(e,t,i){i.r(t),i.d(t,{morphTargetsVertexWGSL:()=>a});var r=i(56863);let n="morphTargetsVertex",s=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
#if {X}==0
for (var i=0; i<NUM_MORPH_INFLUENCERS; i=i+1) {if (f32(i)>=uniforms.morphTargetCount) {break;}
vertexID=f32(vertexInputs.vertexIndex)*uniforms.morphTargetTextureInfo.x;
#ifdef MORPHTARGETS_POSITION
positionUpdated=positionUpdated+(readVector3FromRawSampler(i,vertexID)-vertexInputs.position)*uniforms.morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASPOSITIONS
vertexID=vertexID+1.0;
#endif
#ifdef MORPHTARGETS_NORMAL
normalUpdated=normalUpdated+(readVector3FromRawSampler(i,vertexID) -vertexInputs.normal)*uniforms.morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASNORMALS
vertexID=vertexID+1.0;
#endif
#ifdef MORPHTARGETS_UV
uvUpdated=uvUpdated+(readVector3FromRawSampler(i,vertexID).xy-vertexInputs.uv)*uniforms.morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETTEXTURE_HASUVS
vertexID=vertexID+1.0;
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated=vec4f(tangentUpdated.xyz+(readVector3FromRawSampler(i,vertexID) -vertexInputs.tangent.xyz)*uniforms.morphTargetInfluences[i],tangentUpdated.a);
#endif
#ifdef MORPHTARGETTEXTURE_HASTANGENTS
vertexID=vertexID+1.0;
#endif
#ifdef MORPHTARGETS_UV2
uv2Updated=uv2Updated+(readVector3FromRawSampler(i,vertexID).xy-vertexInputs.uv2)*uniforms.morphTargetInfluences[i];
#endif
#ifdef MORPHTARGETS_COLOR
colorUpdated=colorUpdated+(readVector4FromRawSampler(i,vertexID)-vertexInputs.color)*uniforms.morphTargetInfluences[i];
#endif
}
#endif
#else
#ifdef MORPHTARGETS_POSITION
positionUpdated=positionUpdated+(vertexInputs.position{X}-vertexInputs.position)*uniforms.morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_NORMAL
normalUpdated=normalUpdated+(vertexInputs.normal{X}-vertexInputs.normal)*uniforms.morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated=vec4f(tangentUpdated.xyz+(vertexInputs.tangent{X}-vertexInputs.tangent.xyz)*uniforms.morphTargetInfluences[{X}],tangentUpdated.a);
#endif
#ifdef MORPHTARGETS_UV
uvUpdated=uvUpdated+(vertexInputs.uv_{X}-vertexInputs.uv)*uniforms.morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV2
uv2Updated=uv2Updated+(vertexInputs.uv2_{X}-vertexInputs.uv2)*uniforms.morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_COLOR
colorUpdated=colorUpdated+(vertexInputs.color{X}-vertexInputs.color)*uniforms.morphTargetInfluences[{X}];
#endif
#endif
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},50910(e,t,i){i.r(t),i.d(t,{morphTargetsVertexDeclarationWGSL:()=>a});var r=i(56863);let n="morphTargetsVertexDeclaration",s=`#ifdef MORPHTARGETS
#ifndef MORPHTARGETS_TEXTURE
#ifdef MORPHTARGETS_POSITION
attribute position{X} : vec3<f32>;
#endif
#ifdef MORPHTARGETS_NORMAL
attribute normal{X} : vec3<f32>;
#endif
#ifdef MORPHTARGETS_TANGENT
attribute tangent{X} : vec3<f32>;
#endif
#ifdef MORPHTARGETS_UV
attribute uv_{X} : vec2<f32>;
#endif
#ifdef MORPHTARGETS_UV2
attribute uv2_{X} : vec2<f32>;
#endif
#ifdef MORPHTARGETS_COLOR
attribute color{X} : vec4<f32>;
#endif
#elif {X}==0
uniform morphTargetCount: f32;
#endif
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},11335(e,t,i){i.r(t),i.d(t,{morphTargetsVertexGlobalWGSL:()=>a});var r=i(56863);let n="morphTargetsVertexGlobal",s=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
var vertexID : f32;
#endif
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},74363(e,t,i){i.r(t),i.d(t,{morphTargetsVertexGlobalDeclarationWGSL:()=>a});var r=i(56863);let n="morphTargetsVertexGlobalDeclaration",s=`#ifdef MORPHTARGETS
uniform morphTargetInfluences : array<f32,NUM_MORPH_INFLUENCERS>;
#ifdef MORPHTARGETS_TEXTURE 
uniform morphTargetTextureIndices : array<f32,NUM_MORPH_INFLUENCERS>;uniform morphTargetTextureInfo : vec3<f32>;var morphTargets : texture_2d_array<f32>;var morphTargetsSampler : sampler;fn readVector3FromRawSampler(targetIndex : i32,vertexIndex : f32)->vec3<f32>
{ 
let y=floor(vertexIndex/uniforms.morphTargetTextureInfo.y);let x=vertexIndex-y*uniforms.morphTargetTextureInfo.y;let textureUV=vec2<f32>((x+0.5)/uniforms.morphTargetTextureInfo.y,(y+0.5)/uniforms.morphTargetTextureInfo.z);return textureSampleLevel(morphTargets,morphTargetsSampler,textureUV,i32(uniforms.morphTargetTextureIndices[targetIndex]),0.0).xyz;}
fn readVector4FromRawSampler(targetIndex : i32,vertexIndex : f32)->vec4<f32>
{ 
let y=floor(vertexIndex/uniforms.morphTargetTextureInfo.y);let x=vertexIndex-y*uniforms.morphTargetTextureInfo.y;let textureUV=vec2<f32>((x+0.5)/uniforms.morphTargetTextureInfo.y,(y+0.5)/uniforms.morphTargetTextureInfo.z);return textureSampleLevel(morphTargets,morphTargetsSampler,textureUV,i32(uniforms.morphTargetTextureIndices[targetIndex]),0.0);}
#endif
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s);let a={name:n,shader:s}},2384(e,t,i){var r=i(56863);let n="sceneUboDeclaration",s=`struct Scene {viewProjection : mat4x4<f32>,
#ifdef MULTIVIEW
viewProjectionR : mat4x4<f32>,
#endif 
view : mat4x4<f32>,
projection : mat4x4<f32>,
vEyePosition : vec4<f32>,};
#define SCENE_UBO
var<uniform> scene : Scene;
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},94191(e,t,i){var r=i(56863);let n="vertexColorMixing",s=`#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
vertexOutputs.vColor=vec4f(1.0);
#ifdef VERTEXCOLOR
#ifdef VERTEXALPHA
vertexOutputs.vColor*=vertexInputs.color;
#else
vertexOutputs.vColor=vec4f(vertexOutputs.vColor.rgb*vertexInputs.color.rgb,vertexOutputs.vColor.a);
#endif
#endif
#ifdef INSTANCESCOLOR
vertexOutputs.vColor*=vertexInputs.instanceColor;
#endif
#endif
`;r.l.IncludesShadersStoreWGSL[n]||(r.l.IncludesShadersStoreWGSL[n]=s)},26444(e,t,i){i.r(t),i.d(t,{gaussianSplattingPixelShaderWGSL:()=>a});var r=i(56863);i(64470),i(63745),i(3162),i(33469),i(19456);let n="gaussianSplattingPixelShader",s=`#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
varying vColor: vec4f;varying vPosition: vec2f;
#include<gaussianSplattingFragmentDeclaration>
@fragment
fn main(input: FragmentInputs)->FragmentOutputs {
#include<clipPlaneFragment>
fragmentOutputs.color=gaussianColor(input.vColor,input.vPosition);}
`;r.l.ShadersStoreWGSL[n]||(r.l.ShadersStoreWGSL[n]=s);let a={name:n,shader:s}},19706(e,t,i){i.r(t),i.d(t,{gaussianSplattingVertexShaderWGSL:()=>a});var r=i(56863);i(2384),i(40151),i(75185),i(17800),i(93580),i(63745),i(57829),i(96526),i(3706),i(18315);let n="gaussianSplattingVertexShader",s=`#include<sceneUboDeclaration>
#include<meshUboDeclaration>
#include<helperFunctions>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<logDepthDeclaration>
attribute splatIndex0: vec4f;attribute splatIndex1: vec4f;attribute splatIndex2: vec4f;attribute splatIndex3: vec4f;attribute position: vec3f;uniform invViewport: vec2f;uniform dataTextureSize: vec2f;uniform focal: vec2f;uniform kernelSize: f32;uniform eyePosition: vec3f;uniform alpha: f32;var covariancesATexture: texture_2d<f32>;var covariancesBTexture: texture_2d<f32>;var centersTexture: texture_2d<f32>;var colorsTexture: texture_2d<f32>;
#if SH_DEGREE>0
var shTexture0: texture_2d<u32>;
#endif
#if SH_DEGREE>1
var shTexture1: texture_2d<u32>;
#endif
#if SH_DEGREE>2
var shTexture2: texture_2d<u32>;
#endif
varying vColor: vec4f;varying vPosition: vec2f;
#include<gaussianSplatting>
@vertex
fn main(input : VertexInputs)->FragmentInputs {let splatIndex: f32=getSplatIndex(i32(input.position.z+0.5),input.splatIndex0,input.splatIndex1,input.splatIndex2,input.splatIndex3);var splat: Splat=readSplat(splatIndex,uniforms.dataTextureSize);var covA: vec3f=splat.covA.xyz;var covB: vec3f=vec3f(splat.covA.w,splat.covB.xy);let worldPos: vec4f=mesh.world*vec4f(splat.center.xyz,1.0);vertexOutputs.vPosition=input.position.xy;
#if SH_DEGREE>0
let worldRot: mat3x3f= mat3x3f(mesh.world[0].xyz,mesh.world[1].xyz,mesh.world[2].xyz);let normWorldRot: mat3x3f=inverseMat3(worldRot);var eyeToSplatLocalSpace: vec3f=normalize(normWorldRot*(worldPos.xyz-uniforms.eyePosition.xyz));vertexOutputs.vColor=vec4f(splat.color.xyz+computeSH(splat,eyeToSplatLocalSpace),splat.color.w*uniforms.alpha);
#else
vertexOutputs.vColor=vec4f(splat.color.xyz,splat.color.w*uniforms.alpha);
#endif
vertexOutputs.position=gaussianSplatting(input.position.xy,worldPos.xyz,vec2f(1.0,1.0),covA,covB,mesh.world,scene.view,scene.projection,uniforms.focal,uniforms.invViewport,uniforms.kernelSize);
#include<clipPlaneVertex>
#include<fogVertex>
#include<logDepthVertex>
}
`;r.l.ShadersStoreWGSL[n]||(r.l.ShadersStoreWGSL[n]=s);let a={name:n,shader:s}},74745(e,t,i){var r=i(56863);i(33469);let n="gaussianSplattingDepthPixelShader",s=`#include<gaussianSplattingFragmentDeclaration>
varying vPosition: vec2f;varying vColor: vec4f;
#ifdef DEPTH_RENDER
varying vDepthMetric: f32;
#endif
fn checkDiscard(inPosition: vec2f,inColor: vec4f)->vec4f {var A : f32=-dot(inPosition,inPosition);var alpha : f32=exp(A)*inColor.a;
#if defined(SM_SOFTTRANSPARENTSHADOW) && SM_SOFTTRANSPARENTSHADOW==1
if (A<-4.) {discard;}
#else
if (A<-inColor.a) {discard;}
#endif
#ifdef DEPTH_RENDER
return vec4f(fragmentInputs.vDepthMetric,0.0,0.0,1.0);
#else
return vec4f(inColor.rgb,alpha);
#endif
}
#define CUSTOM_FRAGMENT_DEFINITIONS
@fragment
fn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=checkDiscard(fragmentInputs.vPosition,fragmentInputs.vColor);
#if defined(SM_SOFTTRANSPARENTSHADOW) && SM_SOFTTRANSPARENTSHADOW==1
var alpha : f32=fragmentOutputs.color.a;
#endif
}
`;r.l.ShadersStoreWGSL[n]||(r.l.ShadersStoreWGSL[n]=s)},10963(e,t,i){var r=i(56863);i(2384),i(40151),i(57829);let n="gaussianSplattingDepthVertexShader",s=`#include<sceneUboDeclaration>
#include<meshUboDeclaration>
attribute splatIndex0: vec4f;attribute splatIndex1: vec4f;attribute splatIndex2: vec4f;attribute splatIndex3: vec4f;attribute position: vec3f;uniform invViewport: vec2f;uniform dataTextureSize: vec2f;uniform focal: vec2f;uniform kernelSize: f32;uniform alpha: f32;var covariancesATexture: texture_2d<f32>;var covariancesBTexture: texture_2d<f32>;var centersTexture: texture_2d<f32>;var colorsTexture: texture_2d<f32>;varying vPosition: vec2f;varying vColor: vec4f;
#ifdef DEPTH_RENDER
uniform depthValues: vec2f;varying vDepthMetric: f32;
#endif
#include<gaussianSplatting>
@vertex
fn main(input : VertexInputs)->FragmentInputs {let splatIndex: f32=getSplatIndex(i32(input.position.z+0.5),input.splatIndex0,input.splatIndex1,input.splatIndex2,input.splatIndex3);var splat: Splat=readSplat(splatIndex,uniforms.dataTextureSize);var covA: vec3f=splat.covA.xyz;var covB: vec3f=vec3f(splat.covA.w,splat.covB.xy);let worldPos: vec4f=mesh.world*vec4f(splat.center.xyz,1.0);vertexOutputs.vPosition=input.position.xy;vertexOutputs.vColor=splat.color;vertexOutputs.vColor.w*=uniforms.alpha;vertexOutputs.position=gaussianSplatting(input.position.xy,worldPos.xyz,vec2f(1.0,1.0),covA,covB,mesh.world,scene.view,scene.projection,uniforms.focal,uniforms.invViewport,uniforms.kernelSize);
#ifdef DEPTH_RENDER
#ifdef USE_REVERSE_DEPTHBUFFER
vertexOutputs.vDepthMetric=((-vertexOutputs.position.z+uniforms.depthValues.x)/(uniforms.depthValues.y));
#else
vertexOutputs.vDepthMetric=((vertexOutputs.position.z+uniforms.depthValues.x)/(uniforms.depthValues.y));
#endif
#endif
}`;r.l.ShadersStoreWGSL[n]||(r.l.ShadersStoreWGSL[n]=s)},70824(e,t,i){i.r(t),i.d(t,{postprocessVertexShaderWGSL:()=>a});var r=i(56863);let n="postprocessVertexShader",s=`attribute position: vec2<f32>;uniform scale: vec2<f32>;varying vUV: vec2<f32>;const madd=vec2(0.5,0.5);
#define CUSTOM_VERTEX_DEFINITIONS
@vertex
fn main(input : VertexInputs)->FragmentInputs {
#define CUSTOM_VERTEX_MAIN_BEGIN
vertexOutputs.vUV=(vertexInputs.position*madd+madd)*uniforms.scale;vertexOutputs.position=vec4(vertexInputs.position,0.0,1.0);
#define CUSTOM_VERTEX_MAIN_END
}
`;r.l.ShadersStoreWGSL[n]||(r.l.ShadersStoreWGSL[n]=s);let a={name:n,shader:s}},83860(e,t,i){i.d(t,{j:()=>l});var r=i(95435),n=i(99765),s=i(31656),a=i(44774),o=i(70134);class l{get fogEnabled(){return this._fogEnabled}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this._createEffects())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){let t=!!this._scene?.getEngine().getCaps().fragmentDepthSupported;e&&!t&&s.V.Warn("Logarithmic depth has been requested for a sprite renderer on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._createEffects()}get capacity(){return this._capacity}get pixelPerfect(){return this._pixelPerfect}set pixelPerfect(e){this._pixelPerfect!==e&&(this._pixelPerfect=e,this._createEffects())}get shaderLanguage(){return this._shaderLanguage}constructor(e,t,i=.01,n=null,s){let a;this.blendMode=2,this.autoResetAlpha=!0,this.disableDepthWrite=!1,this._fogEnabled=!0,this._pixelPerfect=!1,this._shaderLanguage=0,this._useVAO=!1,this._useInstancing=!1,this._vertexBuffers={},this._isDisposed=!1,this._shadersLoaded=!1,this._pixelPerfect=s?.pixelPerfect??!1,this._capacity=t,this._epsilon=i,this._engine=e,this._useInstancing=e.getCaps().instancedArrays&&e._features.supportSpriteInstancing,this._useVAO=e.getCaps().vertexArrayObject&&!e.disableVertexArrayObjects,this._scene=n,this._useInstancing||this._buildIndexBuffer(),this._vertexBufferSize=this._useInstancing?16:18,this._vertexData=new Float32Array(t*this._vertexBufferSize*(this._useInstancing?1:4)),this._buffer=new r.h(e,this._vertexData,!0,this._vertexBufferSize);const o=this._buffer.createVertexBuffer(r.R.PositionKind,0,4,this._vertexBufferSize,this._useInstancing),l=this._buffer.createVertexBuffer("options",4,2,this._vertexBufferSize,this._useInstancing);let u=6;if(this._useInstancing){const t=new Float32Array([this._epsilon,this._epsilon,1-this._epsilon,this._epsilon,this._epsilon,1-this._epsilon,1-this._epsilon,1-this._epsilon]);this._spriteBuffer=new r.h(e,t,!1,2),a=this._spriteBuffer.createVertexBuffer("offsets",0,2)}else a=this._buffer.createVertexBuffer("offsets",u,2,this._vertexBufferSize,this._useInstancing),u+=2;const h=this._buffer.createVertexBuffer("inverts",u,2,this._vertexBufferSize,this._useInstancing),c=this._buffer.createVertexBuffer("cellInfo",u+2,4,this._vertexBufferSize,this._useInstancing),d=this._buffer.createVertexBuffer(r.R.ColorKind,u+6,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[r.R.PositionKind]=o,this._vertexBuffers.options=l,this._vertexBuffers.offsets=a,this._vertexBuffers.inverts=h,this._vertexBuffers.cellInfo=c,this._vertexBuffers[r.R.ColorKind]=d,this._initShaderSourceAsync()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!l.ForceGLSL?(this._shaderLanguage=1,await Promise.all([i.e("360").then(i.bind(i,40203)),i.e("4013").then(i.bind(i,77340))])):await Promise.all([i.e("3181").then(i.bind(i,220)),i.e("8107").then(i.bind(i,27446))]),this._shadersLoaded=!0,this._createEffects()}_createEffects(){if(this._isDisposed||!this._shadersLoaded)return;this._drawWrapperBase?.dispose(),this._drawWrapperDepth?.dispose(),this._drawWrapperBase=new n.E(this._engine),this._drawWrapperDepth=new n.E(this._engine,!1),this._drawWrapperBase.drawContext&&(this._drawWrapperBase.drawContext.useInstancing=this._useInstancing),this._drawWrapperDepth.drawContext&&(this._drawWrapperDepth.drawContext.useInstancing=this._useInstancing);let e="";this._pixelPerfect&&(e+="#define PIXEL_PERFECT\n"),this._scene&&this._scene.fogEnabled&&0!==this._scene.fogMode&&this._fogEnabled&&(e+="#define FOG\n"),this._useLogarithmicDepth&&(e+="#define LOGARITHMICDEPTH\n"),this._drawWrapperBase.effect=this._engine.createEffect("sprites",[r.R.PositionKind,"options","offsets","inverts","cellInfo",r.R.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor","logarithmicDepthConstant"],["diffuseSampler"],e,void 0,void 0,void 0,void 0,this._shaderLanguage),this._drawWrapperDepth.effect=this._drawWrapperBase.effect,this._drawWrapperBase.effect._refCount++,this._drawWrapperDepth.materialContext=this._drawWrapperBase.materialContext}render(e,t,i,r,n=null){if(!this._shadersLoaded||!this.texture||!this.texture.isReady()||!e.length)return;let s=this._drawWrapperBase,l=this._drawWrapperDepth,u=this.fogEnabled&&this._scene&&this._scene.fogEnabled&&0!==this._scene.fogMode,h=s.effect;if(!h.isReady())return;let c=this._engine,d=!!(this._scene&&this._scene.useRightHandedSystem),p=Math.min(this._capacity,e.length),f=0,_=!0,m=this._scene?.floatingOriginOffset||o.Pq.ZeroReadOnly;for(let i=0;i<p;i++){let r=e[i];if(!r||!r.isVisible)continue;_=!1,r._animate(t);let s=this.texture.getBaseSize();this._appendSpriteVertex(f++,r,0,0,s,d,n,m),this._useInstancing||(this._appendSpriteVertex(f++,r,1,0,s,d,n,m),this._appendSpriteVertex(f++,r,1,1,s,d,n,m),this._appendSpriteVertex(f++,r,0,1,s,d,n,m))}if(_)return;this._buffer.update(this._vertexData);let g=!!c.depthCullingState.cull,b=c.depthCullingState.zOffset,y=c.depthCullingState.zOffsetUnits;if(c.setState(g,b,!1,!1,void 0,void 0,y),c.enableEffect(s),h.setTexture("diffuseSampler",this.texture),h.setMatrix("view",i),h.setMatrix("projection",r),u){let e=this._scene;h.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),h.setColor3("vFogColor",e.fogColor)}this.useLogarithmicDepth&&this._scene&&(0,a.D)(s.defines,h,this._scene),this._useVAO?(this._vertexArrayObject||(this._vertexArrayObject=c.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,h)),c.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):c.bindBuffers(this._vertexBuffers,this._indexBuffer,h),c.depthCullingState.depthFunc=c.useReverseDepthBuffer?518:515,this.disableDepthWrite||(h.setBool("alphaTest",!0),c.setColorWrite(!1),c.enableEffect(l),this._useInstancing?c.drawArraysType(7,0,4,f):c.drawElementsType(0,0,f/4*6),c.enableEffect(s),c.setColorWrite(!0),h.setBool("alphaTest",!1)),c.setAlphaMode(this.blendMode),this._useInstancing?c.drawArraysType(7,0,4,f):c.drawElementsType(0,0,f/4*6),this.autoResetAlpha&&c.setAlphaMode(0),d&&this._scene.getEngine().setState(g,b,!1,!0,void 0,void 0,y),c.unbindInstanceAttributes()}_appendSpriteVertex(e,t,i,r,n,s,a,o){let l=e*this._vertexBufferSize;if(0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===r?r=this._epsilon:1===r&&(r=1-this._epsilon),a)a(t,n);else{t.cellIndex||(t.cellIndex=0);let e=n.width/this.cellWidth,i=t.cellIndex/e|0;t._xOffset=(t.cellIndex-i*e)*this.cellWidth/n.width,t._yOffset=i*this.cellHeight/n.height,t._xSize=this.cellWidth,t._ySize=this.cellHeight}this._vertexData[l]=t.position.x-o.x,this._vertexData[l+1]=t.position.y-o.y,this._vertexData[l+2]=t.position.z-o.z,this._vertexData[l+3]=t.angle,this._vertexData[l+4]=t.width,this._vertexData[l+5]=t.height,this._useInstancing?l-=2:(this._vertexData[l+6]=i,this._vertexData[l+7]=r),s?this._vertexData[l+8]=+!t.invertU:this._vertexData[l+8]=+!!t.invertU,this._vertexData[l+9]=+!!t.invertV,this._vertexData[l+10]=t._xOffset,this._vertexData[l+11]=t._yOffset,this._vertexData[l+12]=t._xSize/n.width,this._vertexData[l+13]=t._ySize/n.height,this._vertexData[l+14]=t.color.r,this._vertexData[l+15]=t.color.g,this._vertexData[l+16]=t.color.b,this._vertexData[l+17]=t.color.a}_buildIndexBuffer(){let e=[],t=0;for(let i=0;i<this._capacity;i++)e.push(t),e.push(t+1),e.push(t+2),e.push(t),e.push(t+2),e.push(t+3),t+=4;this._indexBuffer=this._engine.createIndexBuffer(e)}rebuild(){for(let e in this._indexBuffer&&this._buildIndexBuffer(),this._useVAO&&(this._vertexArrayObject=void 0),this._buffer._rebuild(),this._vertexBuffers)this._vertexBuffers[e]._rebuild();this._spriteBuffer?._rebuild()}dispose(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this.texture&&(this.texture.dispose(),this.texture=null),this._drawWrapperBase?.dispose(),this._drawWrapperDepth?.dispose(),this._isDisposed=!0}}l.ForceGLSL=!1},38108(e,t,i){i.d(t,{X:()=>r});class r{get animationStarted(){return this._animationStarted}get fromIndex(){return this._fromIndex}get toIndex(){return this._toIndex}get loopAnimation(){return this._loopAnimation}get delay(){return Math.max(this._delay,1)}constructor(){this.width=1,this.height=1,this.angle=0,this.invertU=!1,this.invertV=!1,this.isVisible=!0,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this._onBaseAnimationEnd=null,this.position={x:1,y:1,z:1},this.color={r:1,g:1,b:1,a:1}}playAnimation(e,t,i,r,n){this._fromIndex=e,this._toIndex=t,this._loopAnimation=i,this._delay=r||1,this._animationStarted=!0,this._onBaseAnimationEnd=n,e<t?this._direction=1:(this._direction=-1,this._toIndex=e,this._fromIndex=t),this.cellIndex=e,this._time=0}stopAnimation(){this._animationStarted=!1}_animate(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onBaseAnimationEnd&&this._onBaseAnimationEnd()))))}}},5020(e,t,i){i.d(t,{B:()=>r});class r{get isFixedFoveationSupported(){return"XRWebGLLayer"==this.layerType&&"number"==typeof this.layer.fixedFoveation}get fixedFoveation(){return this.isFixedFoveationSupported?this.layer.fixedFoveation:null}set fixedFoveation(e){if(this.isFixedFoveationSupported){let t=Math.max(0,Math.min(1,e||0));this.layer.fixedFoveation=t}}createRenderTargetTextureProvider(e){return this._rttWrapper=this._createRenderTargetTextureProvider(e),this._rttWrapper}dispose(){this._rttWrapper&&(this._rttWrapper.dispose(),this._rttWrapper=null)}constructor(e,t,i,r,n){this.getWidth=e,this.getHeight=t,this.layer=i,this.layerType=r,this._createRenderTargetTextureProvider=n,this._rttWrapper=null}}},90368(e,t,i){i.d(t,{h:()=>r});class r{}r._IsPickingAvailable=!1},39545(e,t,i){i.d(t,{Cg:()=>r});function r(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a}},30246(e,t,i){i.r(t),i.d(t,{FlowGraphGLTFDataProvider:()=>s});var r=i(96193),n=i(94663);class s extends r.e{constructor(e){super();const t=e.glTF,i=t.animations?.map(e=>e._babylonAnimationGroup)||[];this.animationGroups=this.registerDataOutput("animationGroups",n.Vv,i);const r=t.nodes?.map(e=>e._babylonTransformNode)||[];this.nodes=this.registerDataOutput("nodes",n.Vv,r)}getClassName(){return"FlowGraphGLTFDataProvider"}}},67396(e,t,i){i.d(t,{tQ:()=>f,Wt:()=>p,ZU:()=>_,oR:()=>m});var r=i(70134),n=i(7836),s=i(19002),a=i(16671);let o=[{regex:RegExp("^/nodes/\\d+/extensions/")}];class l{constructor(e,t){this._gltf=e,this._infoTree=t}convert(e){let t,i=this._gltf,r=this._infoTree;if(!e.startsWith("/"))throw Error("Path must start with a /");let n=e.split("/");if(n.shift(),n[n.length-1].includes(".length")){let e=n[n.length-1].split(".");n.pop(),n.push(...e)}let s=!1;for(let a of n){let n="length"===a;if(n&&!r.__array__)throw Error(`Path ${e} is invalid`);if(r.__ignoreObjectTree__&&(s=!0),r.__array__&&!n)r=r.__array__;else if(!(r=r[a]))throw Error(`Path ${e} is invalid`);if(!s)if(void 0===i){if(!o.find(t=>t.regex.test(e)))throw Error(`Path ${e} is invalid`)}else n||(i=i?.[a]);(r.__target__||n)&&(t=i)}return{object:t,info:r}}}function u(e,t,i,r){let n=h(e,t);return r?n[i][r]:n[i]}function h(e,t,i){return e._data?.[i?.fillMode??n.Y.MATERIAL_TriangleFillMode]?.babylonMaterial}function c(e,t){return{offset:{componentsCount:2,type:"Vector2",get:(i,n,s)=>{let a=u(i,s,e,t);return new r.I9(a?.uOffset,a?.vOffset)},getTarget:h,set:(i,r,n,s)=>{let a=u(r,s,e,t);a.uOffset=i.x,a.vOffset=i.y},getPropertyName:[()=>`${e}${t?"."+t:""}.uOffset`,()=>`${e}${t?"."+t:""}.vOffset`]},rotation:{type:"number",get:(i,r,n)=>u(i,n,e,t)?.wAng,getTarget:h,set:(i,r,n,s)=>u(r,s,e,t).wAng=i,getPropertyName:[()=>`${e}${t?"."+t:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(i,n,s)=>{let a=u(i,s,e,t);return new r.I9(a?.uScale,a?.vScale)},getTarget:h,set:(i,r,n,s)=>{let a=u(r,s,e,t);a.uScale=i.x,a.vScale=i.y},getPropertyName:[()=>`${e}${t?"."+t:""}.uScale`,()=>`${e}${t?"."+t:""}.vScale`]}}}let d={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:e=>new r.I9(e._babylonCamera?.orthoLeft??0,e._babylonCamera?.orthoRight??0),set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.orthoLeft=e.x,t._babylonCamera.orthoRight=e.y)},getTarget:e=>e,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:e=>new r.I9(e._babylonCamera?.orthoBottom??0,e._babylonCamera?.orthoTop??0),set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.orthoBottom=e.x,t._babylonCamera.orthoTop=e.y)},getTarget:e=>e,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:e=>e._babylonCamera?.maxZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.maxZ=e)},getTarget:e=>e,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:e=>e._babylonCamera?.minZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.minZ=e)},getTarget:e=>e,getPropertyName:[()=>"minZ"]}},perspective:{aspectRatio:{type:"number",get:e=>e._babylonCamera?.getEngine().getAspectRatio(e._babylonCamera),getTarget:e=>e,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:e=>e._babylonCamera?.fov,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.fov=e)},getTarget:e=>e,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:e=>e._babylonCamera?.maxZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.maxZ=e)},getTarget:e=>e,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:e=>e._babylonCamera?.minZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.minZ=e)},getTarget:e=>e,getPropertyName:[()=>"minZ"]}}}},nodes:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonTransformNode),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Vector3",get:e=>e._babylonTransformNode?.position,set:(e,t)=>t._babylonTransformNode?.position.copyFrom(e),getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:e=>e._babylonTransformNode?.rotationQuaternion,set:(e,t)=>t._babylonTransformNode?.rotationQuaternion?.copyFrom(e),getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Vector3",get:e=>e._babylonTransformNode?.scaling,set:(e,t)=>t._babylonTransformNode?.scaling.copyFrom(e),getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"scaling"]},weights:{length:{type:"number",get:e=>e._numMorphTargets,getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(e,t)=>void 0!==t?e._primitiveBabylonMeshes?.[0].morphTargetManager?.getTarget(t).influence:void 0,getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(e,t)=>[0],getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:e=>r.uq.Compose(e._babylonTransformNode?.scaling,e._babylonTransformNode?.rotationQuaternion,e._babylonTransformNode?.position),getTarget:e=>e._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:e=>{let t=r.uq.Identity(),i=e.parent;for(;i&&i.parent;)i=i.parent;let n=e._babylonTransformNode?.position._isDirty||e._babylonTransformNode?.rotationQuaternion?._isDirty||e._babylonTransformNode?.scaling._isDirty;if(i){let r=i._babylonTransformNode?.computeWorldMatrix(!0).invert();r&&e._babylonTransformNode?.computeWorldMatrix(n)?.multiplyToRef(r,t)}else e._babylonTransformNode&&t.copyFrom(e._babylonTransformNode.computeWorldMatrix(n));return t},getTarget:e=>e._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:e=>e._babylonTransformNode?.getChildren(e=>e instanceof a.n,!0)[0]?.intensity,getTarget:e=>e._babylonTransformNode?.getChildren(e=>e instanceof a.n,!0)[0],set:(e,t)=>{if(t._babylonTransformNode){let i=t._babylonTransformNode.getChildren(e=>e instanceof a.n,!0)[0];i&&(i.intensity=e)}}},color:{type:"Color3",get:e=>e._babylonTransformNode?.getChildren(e=>e instanceof a.n,!0)[0]?.diffuse,getTarget:e=>e._babylonTransformNode?.getChildren(e=>e instanceof a.n,!0)[0],set:(e,t)=>{if(t._babylonTransformNode){let i=t._babylonTransformNode.getChildren(e=>e instanceof a.n,!0)[0];i&&(i.diffuse=e)}}}},KHR_node_visibility:{visible:{type:"boolean",get:e=>!!e._primitiveBabylonMeshes&&e._primitiveBabylonMeshes[0].isVisible,getTarget:()=>void 0,set:(e,t)=>{t._primitiveBabylonMeshes&&t._primitiveBabylonMeshes.forEach(t=>t.isVisible=e)}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Color3",get:(e,t,i)=>h(e,t,i).emissiveColor,set:(e,t,i,r)=>h(t,i,r).emissiveColor.copyFrom(e),getTarget:(e,t,i)=>h(e,t,i),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:c("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(e,t,i)=>u(e,i,"bumpTexture")?.level,set:(e,t,i,r)=>{let n=u(t,r,"bumpTexture");n&&(n.level=e)},getTarget:(e,t,i)=>h(e,t,i),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:c("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(e,t,i)=>h(e,t,i).ambientTextureStrength,set:(e,t,i,r)=>{let n=h(t,i,r);n&&(n.ambientTextureStrength=e)},getTarget:(e,t,i)=>h(e,t,i),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:c("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Color4",get:(e,t,i)=>{let r=h(e,t,i);return s.ov.FromColor3(r.albedoColor,r.alpha)},set:(e,t,i,r)=>{let n=h(t,i,r);n.albedoColor.set(e.r,e.g,e.b),n.alpha=e.a},getTarget:(e,t,i)=>h(e,t,i),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:c("albedoTexture")}},metallicFactor:{type:"number",get:(e,t,i)=>h(e,t,i).metallic,set:(e,t,i,r)=>{let n=h(t,i,r);n&&(n.metallic=e)},getTarget:(e,t,i)=>h(e,t,i),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(e,t,i)=>h(e,t,i).roughness,set:(e,t,i,r)=>{let n=h(t,i,r);n&&(n.roughness=e)},getTarget:(e,t,i)=>h(e,t,i),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:c("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(e,t,i)=>h(e,t,i).anisotropy.intensity,set:(e,t,i,r)=>{h(t,i,r).anisotropy.intensity=e},getTarget:(e,t,i)=>h(e,t,i),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(e,t,i)=>h(e,t,i).anisotropy.angle,set:(e,t,i,r)=>{h(t,i,r).anisotropy.angle=e},getTarget:(e,t,i)=>h(e,t,i),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:c("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(e,t,i)=>h(e,t,i).clearCoat.intensity,set:(e,t,i,r)=>{h(t,i,r).clearCoat.intensity=e},getTarget:(e,t,i)=>h(e,t,i),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(e,t,i)=>h(e,t,i).clearCoat.roughness,set:(e,t,i,r)=>{h(t,i,r).clearCoat.roughness=e},getTarget:(e,t,i)=>h(e,t,i),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:c("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(e,t,i)=>h(e,t,i).clearCoat.bumpTexture?.level,getTarget:h,set:(e,t,i,r)=>h(t,i,r).clearCoat.bumpTexture.level=e},extensions:{KHR_texture_transform:c("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:c("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(e,t,i)=>h(e,t,i).subSurface.dispersion,getTarget:h,set:(e,t,i,r)=>h(t,i,r).subSurface.dispersion=e}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(e,t,i)=>h(e,t,i).emissiveIntensity,getTarget:h,set:(e,t,i,r)=>h(t,i,r).emissiveIntensity=e}},KHR_materials_ior:{ior:{type:"number",get:(e,t,i)=>h(e,t,i).indexOfRefraction,getTarget:h,set:(e,t,i,r)=>h(t,i,r).indexOfRefraction=e}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(e,t,i)=>h(e,t,i).iridescence.intensity,getTarget:h,set:(e,t,i,r)=>h(t,i,r).iridescence.intensity=e},iridescenceIor:{type:"number",get:(e,t,i)=>h(e,t,i).iridescence.indexOfRefraction,getTarget:h,set:(e,t,i,r)=>h(t,i,r).iridescence.indexOfRefraction=e},iridescenceTexture:{extensions:{KHR_texture_transform:c("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(e,t,i)=>h(e,t,i).iridescence.maximumThickness,getTarget:h,set:(e,t,i,r)=>h(t,i,r).iridescence.maximumThickness=e},iridescenceThicknessMinimum:{type:"number",get:(e,t,i)=>h(e,t,i).iridescence.minimumThickness,getTarget:h,set:(e,t,i,r)=>h(t,i,r).iridescence.minimumThickness=e},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:c("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Color3",get:(e,t,i)=>h(e,t,i).sheen.color,getTarget:h,set:(e,t,i,r)=>h(t,i,r).sheen.color.copyFrom(e)},sheenColorTexture:{extensions:{KHR_texture_transform:c("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(e,t,i)=>h(e,t,i).sheen.intensity,getTarget:h,set:(e,t,i,r)=>h(t,i,r).sheen.intensity=e},sheenRoughnessTexture:{extensions:{KHR_texture_transform:c("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(e,t,i)=>h(e,t,i).metallicF0Factor,getTarget:h,set:(e,t,i,r)=>h(t,i,r).metallicF0Factor=e,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Color3",get:(e,t,i)=>h(e,t,i).metallicReflectanceColor,getTarget:h,set:(e,t,i,r)=>h(t,i,r).metallicReflectanceColor.copyFrom(e),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:c("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:c("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(e,t,i)=>h(e,t,i).subSurface.refractionIntensity,getTarget:h,set:(e,t,i,r)=>h(t,i,r).subSurface.refractionIntensity=e,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:c("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(e,t,i)=>h(e,t,i).subSurface.translucencyIntensity,getTarget:h,set:(e,t,i,r)=>h(t,i,r).subSurface.translucencyIntensity=e},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:c("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Color3",get:(e,t,i)=>h(e,t,i).subSurface.translucencyColor,getTarget:h,set:(e,t,i,r)=>e&&h(t,i,r).subSurface.translucencyColor?.copyFrom(e)},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:c("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Color3",get:(e,t,i)=>h(e,t,i).subSurface.tintColor,getTarget:h,set:(e,t,i,r)=>h(t,i,r).subSurface.tintColor.copyFrom(e)},attenuationDistance:{type:"number",get:(e,t,i)=>h(e,t,i).subSurface.tintColorAtDistance,getTarget:h,set:(e,t,i,r)=>h(t,i,r).subSurface.tintColorAtDistance=e},thicknessFactor:{type:"number",get:(e,t,i)=>h(e,t,i).subSurface.maximumThickness,getTarget:h,set:(e,t,i,r)=>h(t,i,r).subSurface.maximumThickness=e},thicknessTexture:{extensions:{KHR_texture_transform:c("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonLight),getPropertyName:[e=>"length"]},__array__:{__target__:!0,color:{type:"Color3",get:e=>e._babylonLight?.diffuse,set:(e,t)=>t._babylonLight?.diffuse.copyFrom(e),getTarget:e=>e._babylonLight,getPropertyName:[e=>"diffuse"]},intensity:{type:"number",get:e=>e._babylonLight?.intensity,set:(e,t)=>t._babylonLight?t._babylonLight.intensity=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"intensity"]},range:{type:"number",get:e=>e._babylonLight?.range,set:(e,t)=>t._babylonLight?t._babylonLight.range=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"range"]},spot:{innerConeAngle:{type:"number",get:e=>e._babylonLight?.innerAngle,set:(e,t)=>t._babylonLight?t._babylonLight.innerAngle=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"innerConeAngle"]},outerConeAngle:{type:"number",get:e=>e._babylonLight?.angle,set:(e,t)=>t._babylonLight?t._babylonLight.angle=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"outerConeAngle"]}}}}},EXT_lights_area:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonLight),getPropertyName:[e=>"length"]},__array__:{__target__:!0,color:{type:"Color3",get:e=>e._babylonLight?.diffuse,set:(e,t)=>t._babylonLight?.diffuse.copyFrom(e),getTarget:e=>e._babylonLight,getPropertyName:[e=>"diffuse"]},intensity:{type:"number",get:e=>e._babylonLight?.intensity,set:(e,t)=>t._babylonLight?t._babylonLight.intensity=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"intensity"]},size:{type:"number",get:e=>e._babylonLight?.height,set:(e,t)=>t._babylonLight?t._babylonLight.height=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"size"]},rect:{aspect:{type:"number",get:e=>e._babylonLight?.width/e._babylonLight?.height,set:(e,t)=>t._babylonLight?t._babylonLight.width=e*t._babylonLight.height:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"aspect"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonLight),getPropertyName:[e=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonTexture),getPropertyName:[e=>"length"]},__array__:{__target__:!0,intensity:{type:"number",get:e=>e._babylonTexture?.level,set:(e,t)=>{t._babylonTexture&&(t._babylonTexture.level=e)},getTarget:e=>e._babylonTexture},rotation:{type:"Quaternion",get:e=>e._babylonTexture&&r.PT.FromRotationMatrix(e._babylonTexture?.getReflectionTextureMatrix()),set:(e,t)=>{t._babylonTexture&&(t._babylonTexture.getScene()?.useRightHandedSystem||(e=r.PT.Inverse(e)),r.uq.FromQuaternionToRef(e,t._babylonTexture.getReflectionTextureMatrix()))},getTarget:e=>e._babylonTexture}}}}},animations:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e._babylonAnimationGroup),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map(e=>e.primitives[0]._instanceData?.babylonSourceMesh),getPropertyName:[()=>"length"]},__array__:{}}};function p(e){return new l(e,d)}function f(e){let t=e.split("/").map(e=>e.replace(/{}/g,"__array__")),i=d;for(let e of t)e&&(i=i[e]);if(i&&i.type&&i.get)return i}function _(e,t){let i=e.split("/").map(e=>e.replace(/{}/g,"__array__")),r=d;for(let e of i)e&&(r=r[e]);r&&r.type&&r.get&&(r.interpolation=t)}function m(e,t){let i=e.split("/").map(e=>e.replace(/{}/g,"__array__")),r=d;for(let e of i)if(e){if(!r[e]){if("?"===e){r.__ignoreObjectTree__=!0;continue}r[e]={},"__array__"===e&&(r[e].__target__=!0)}r=r[e]}Object.assign(r,t)}},4347(e,t,i){i.r(t),i.d(t,{AnimationPropertyInfo:()=>u,TransformNodeAnimationPropertyInfo:()=>h,WeightAnimationPropertyInfo:()=>c,getQuaternion:()=>o,getVector3:()=>a,getWeights:()=>l});var r=i(25835),n=i(70134),s=i(67396);function a(e,t,i,r){return n.Pq.FromArray(t,i).scaleInPlace(r)}function o(e,t,i,r){return n.PT.FromArray(t,i).scaleInPlace(r)}function l(e,t,i,r){let n=Array(e._numMorphTargets);for(let e=0;e<n.length;e++)n[e]=t[i++]*r;return n}class u{constructor(e,t,i,r){this.type=e,this.name=t,this.getValue=i,this.getStride=r}_buildAnimation(e,t,i){let n=new r.X5(e,this.name,t,this.type);return n.setKeys(i,!0),n}}class h extends u{buildAnimations(e,t,i,r){let n=[];return n.push({babylonAnimatable:e._babylonTransformNode,babylonAnimation:this._buildAnimation(t,i,r)}),n}}class c extends u{buildAnimations(e,t,i,n){let s=[];if(e._numMorphTargets)for(let a=0;a<e._numMorphTargets;a++){let o=new r.X5(`${t}_${a}`,this.name,i,this.type);if(o.setKeys(n.map(e=>({frame:e.frame,inTangent:e.inTangent?e.inTangent[a]:void 0,value:e.value[a],outTangent:e.outTangent?e.outTangent[a]:void 0,interpolation:e.interpolation})),!0),e._primitiveBabylonMeshes){for(let t of e._primitiveBabylonMeshes)if(t.morphTargetManager){let e=t.morphTargetManager.getTarget(a),i=o.clone();e.animations.push(i),s.push({babylonAnimatable:e,babylonAnimation:i})}}}return s}}(0,s.ZU)("/nodes/{}/translation",[new h(r.X5.ANIMATIONTYPE_VECTOR3,"position",a,()=>3)]),(0,s.ZU)("/nodes/{}/rotation",[new h(r.X5.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",o,()=>4)]),(0,s.ZU)("/nodes/{}/scale",[new h(r.X5.ANIMATIONTYPE_VECTOR3,"scaling",a,()=>3)]),(0,s.ZU)("/nodes/{}/weights",[new c(r.X5.ANIMATIONTYPE_FLOAT,"influence",l,e=>e._numMorphTargets)])},97241(e,t,i){i.r(t),i.d(t,{OpenPBRMaterialLoadingAdapter:()=>s});var r=i(19002),n=i(70134);class s{constructor(e){this._extinctionCoefficient=n.Pq.Zero(),this._material=e}get material(){return this._material}get isUnlit(){return this._material.unlit}set isUnlit(e){this._material.unlit=e}set backFaceCulling(e){this._material.backFaceCulling=e}get backFaceCulling(){return this._material.backFaceCulling}set twoSidedLighting(e){this._material.twoSidedLighting=e}get twoSidedLighting(){return this._material.twoSidedLighting}set alphaCutOff(e){}get alphaCutOff(){return .5}set useAlphaFromBaseColorTexture(e){this._material._useAlphaFromBaseColorTexture=e}get useAlphaFromBaseColorTexture(){return!1}get transparencyAsAlphaCoverage(){return!1}set transparencyAsAlphaCoverage(e){}set baseColor(e){this._material.baseColor=e}get baseColor(){return this._material.baseColor}set baseColorTexture(e){this._material.baseColorTexture=e}get baseColorTexture(){return this._material.baseColorTexture}set baseDiffuseRoughness(e){this._material.baseDiffuseRoughness=e}get baseDiffuseRoughness(){return this._material.baseDiffuseRoughness}set baseDiffuseRoughnessTexture(e){this._material.baseDiffuseRoughnessTexture=e}get baseDiffuseRoughnessTexture(){return this._material.baseDiffuseRoughnessTexture}set baseMetalness(e){this._material.baseMetalness=e}get baseMetalness(){return this._material.baseMetalness}set baseMetalnessTexture(e){this._material.baseMetalnessTexture=e}get baseMetalnessTexture(){return this._material.baseMetalnessTexture}set useRoughnessFromMetallicTextureGreen(e){this._material._useRoughnessFromMetallicTextureGreen=e}set useMetallicFromMetallicTextureBlue(e){this._material._useMetallicFromMetallicTextureBlue=e}enableSpecularEdgeColor(e=!1){}set specularWeight(e){this._material.specularWeight=e}get specularWeight(){return this._material.specularWeight}set specularWeightTexture(e){this._material.specularColorTexture===e?(this._material.specularWeightTexture=null,this._material._useSpecularWeightFromSpecularColorTexture=!0,this._material._useSpecularWeightFromAlpha=!0):this._material.specularWeightTexture=e}get specularWeightTexture(){return this._material.specularWeightTexture}set specularColor(e){this._material.specularColor=e}get specularColor(){return this._material.specularColor}set specularColorTexture(e){this._material.specularColorTexture=e,this._material.specularWeightTexture===this._material.specularColorTexture&&(this._material.specularWeightTexture=null,this._material._useSpecularWeightFromSpecularColorTexture=!0,this._material._useSpecularWeightFromAlpha=!0)}get specularColorTexture(){return this._material.specularColorTexture}set specularRoughness(e){this._material.specularRoughness=e}get specularRoughness(){return this._material.specularRoughness}set specularRoughnessTexture(e){this._material.specularRoughnessTexture=e}get specularRoughnessTexture(){return this._material.specularRoughnessTexture}set specularIor(e){this._material.specularIor=e}get specularIor(){return this._material.specularIor}set emissionColor(e){this._material.emissionColor=e}get emissionColor(){return this._material.emissionColor}set emissionLuminance(e){this._material.emissionLuminance=e}get emissionLuminance(){return this._material.emissionLuminance}set emissionColorTexture(e){this._material.emissionColorTexture=e}get emissionColorTexture(){return this._material.emissionColorTexture}set ambientOcclusionTexture(e){this._material.ambientOcclusionTexture=e}get ambientOcclusionTexture(){return this._material.ambientOcclusionTexture}set ambientOcclusionTextureStrength(e){let t=this._material.ambientOcclusionTexture;t&&(t.level=e)}get ambientOcclusionTextureStrength(){let e=this._material.ambientOcclusionTexture;return e?.level??1}configureCoat(){}set coatWeight(e){this._material.coatWeight=e}get coatWeight(){return this._material.coatWeight}set coatWeightTexture(e){this._material.coatWeightTexture=e}get coatWeightTexture(){return this._material.coatWeightTexture}set coatColor(e){this._material.coatColor=e}set coatColorTexture(e){this._material.coatColorTexture=e}set coatRoughness(e){this._material.coatRoughness=e}get coatRoughness(){return this._material.coatRoughness}set coatRoughnessTexture(e){this._material.coatRoughnessTexture=e,e&&(this._material._useCoatRoughnessFromGreenChannel=!0)}get coatRoughnessTexture(){return this._material.coatRoughnessTexture}set coatIor(e){this._material.coatIor=e}set coatDarkening(e){this._material.coatDarkening=e}set coatDarkeningTexture(e){this._material.coatDarkeningTexture=e}set coatRoughnessAnisotropy(e){this._material.coatRoughnessAnisotropy=e}get coatRoughnessAnisotropy(){return this._material.coatRoughnessAnisotropy}set geometryCoatTangentAngle(e){this._material.geometryCoatTangentAngle=e}set geometryCoatTangentTexture(e){this._material.geometryCoatTangentTexture=e,e&&(this._material._useCoatRoughnessAnisotropyFromTangentTexture=!0)}get geometryCoatTangentTexture(){return this._material.geometryCoatTangentTexture}configureTransmission(){}set transmissionWeight(e){this._material.transmissionWeight=e,this._material.transmissionColor=this._material.baseColor,this._material.transmissionColorTexture=this._material.baseColorTexture,this._material.transmissionDepth=0}set transmissionWeightTexture(e){this._material.transmissionWeightTexture=e}get transmissionWeight(){return this._material.transmissionWeight}set transmissionScatter(e){this._material.transmissionScatter=e}get transmissionScatter(){return this._material.transmissionScatter}set transmissionScatterTexture(e){this._material.transmissionScatterTexture=e}get transmissionScatterTexture(){return this._material.transmissionScatterTexture}set transmissionScatterAnisotropy(e){this._material.transmissionScatterAnisotropy=e}set transmissionDispersionAbbeNumber(e){this._material.transmissionDispersionAbbeNumber=e}set transmissionDispersionScale(e){this._material.transmissionDispersionScale=e}set transmissionDepth(e){e!==Number.MAX_VALUE||0!==this._material.transmissionDepth?this._material.transmissionDepth=e:this._material.transmissionDepth=0}get transmissionDepth(){return this._material.transmissionDepth}set transmissionColor(e){e.equals(r.v9.White())||(this._material.transmissionColor=e)}get transmissionColor(){return this._material.transmissionColor}get refractionBackgroundTexture(){return this._material.backgroundRefractionTexture}set refractionBackgroundTexture(e){this._material.backgroundRefractionTexture=e}set volumeThicknessTexture(e){this._material.geometryThicknessTexture=e,this._material._useGeometryThicknessFromGreenChannel=!0}set volumeThickness(e){this._material.geometryThickness=e}configureSubsurface(){}set extinctionCoefficient(e){this._extinctionCoefficient=e}get extinctionCoefficient(){return this._extinctionCoefficient}set subsurfaceWeight(e){}get subsurfaceWeight(){return 0}set subsurfaceWeightTexture(e){}set subsurfaceColor(e){}set subsurfaceColorTexture(e){}set subsurfaceConstantTint(e){}get subsurfaceConstantTint(){return r.v9.White()}set subsurfaceConstantTintTexture(e){}get subsurfaceRadius(){return 0}set subsurfaceRadius(e){}get subsurfaceRadiusScale(){return r.v9.White()}set subsurfaceRadiusScale(e){}set subsurfaceScatterAnisotropy(e){}configureFuzz(){}set fuzzWeight(e){this._material.fuzzWeight=e}set fuzzWeightTexture(e){this._material.fuzzWeightTexture=e}set fuzzColor(e){this._material.fuzzColor=e}set fuzzColorTexture(e){this._material.fuzzColorTexture=e}set fuzzRoughness(e){this._material.fuzzRoughness=e}set fuzzRoughnessTexture(e){this._material.fuzzRoughnessTexture=e,this._material._useFuzzRoughnessFromTextureAlpha=!0}set specularRoughnessAnisotropy(e){this._material.specularRoughnessAnisotropy=e}get specularRoughnessAnisotropy(){return this._material.specularRoughnessAnisotropy}set geometryTangentAngle(e){this._material.geometryTangentAngle=e}set geometryTangentTexture(e){this._material.geometryTangentTexture=e,this._material._useSpecularRoughnessAnisotropyFromTangentTexture=!0}get geometryTangentTexture(){return this._material.geometryTangentTexture}configureGltfStyleAnisotropy(e=!0){this._material._useGltfStyleAnisotropy=e}set thinFilmWeight(e){this._material.thinFilmWeight=e}set thinFilmIor(e){this._material.thinFilmIor=e}set thinFilmThicknessMinimum(e){this._material.thinFilmThicknessMin=e/1e3}set thinFilmThicknessMaximum(e){this._material.thinFilmThickness=e/1e3}set thinFilmWeightTexture(e){this._material.thinFilmWeightTexture=e}set thinFilmThicknessTexture(e){this._material.thinFilmThicknessTexture=e,this._material._useThinFilmThicknessFromTextureGreen=!0}set unlit(e){this._material.unlit=e}set geometryOpacity(e){this._material.geometryOpacity=e}get geometryOpacity(){return this._material.geometryOpacity}set geometryNormalTexture(e){this._material.geometryNormalTexture=e}get geometryNormalTexture(){return this._material.geometryNormalTexture}setNormalMapInversions(e,t){}set geometryCoatNormalTexture(e){this._material.geometryCoatNormalTexture=e}get geometryCoatNormalTexture(){return this._material.geometryCoatNormalTexture}set geometryCoatNormalTextureScale(e){this._material.geometryCoatNormalTexture&&(this._material.geometryCoatNormalTexture.level=e)}}},91737(e,t,i){i.r(t),i.d(t,{PBRMaterialLoadingAdapter:()=>a});var r=i(19002),n=i(70134),s=i(7836);class a{constructor(e){this._extinctionCoefficient=n.Pq.Zero(),this._material=e,this._material.enableSpecularAntiAliasing=!0}get material(){return this._material}get isUnlit(){return this._material.unlit}set isUnlit(e){this._material.unlit=e}set backFaceCulling(e){this._material.backFaceCulling=e}get backFaceCulling(){return this._material.backFaceCulling}set twoSidedLighting(e){this._material.twoSidedLighting=e}get twoSidedLighting(){return this._material.twoSidedLighting}set alphaCutOff(e){this._material.alphaCutOff=e}get alphaCutOff(){return this._material.alphaCutOff}set useAlphaFromBaseColorTexture(e){this._material.useAlphaFromAlbedoTexture=e}get useAlphaFromBaseColorTexture(){return this._material.useAlphaFromAlbedoTexture}get transparencyAsAlphaCoverage(){return this._material.useRadianceOverAlpha||this._material.useSpecularOverAlpha}set transparencyAsAlphaCoverage(e){this._material.useRadianceOverAlpha=!e,this._material.useSpecularOverAlpha=!e}set baseColor(e){this._material.albedoColor=e}get baseColor(){return this._material.albedoColor}set baseColorTexture(e){this._material.albedoTexture=e}get baseColorTexture(){return this._material.albedoTexture}set baseDiffuseRoughness(e){this._material.baseDiffuseRoughness=e,e>0&&(this._material.brdf.baseDiffuseModel=s.Y.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR)}get baseDiffuseRoughness(){return this._material.baseDiffuseRoughness??0}set baseDiffuseRoughnessTexture(e){this._material.baseDiffuseRoughnessTexture=e}get baseDiffuseRoughnessTexture(){return this._material.baseDiffuseRoughnessTexture}set baseMetalness(e){this._material.metallic=e}get baseMetalness(){return this._material.metallic??1}set baseMetalnessTexture(e){this._material.metallicTexture=e}get baseMetalnessTexture(){return this._material.metallicTexture}set useRoughnessFromMetallicTextureGreen(e){this._material.useRoughnessFromMetallicTextureGreen=e,this._material.useRoughnessFromMetallicTextureAlpha=!e}set useMetallicFromMetallicTextureBlue(e){this._material.useMetallnessFromMetallicTextureBlue=e}enableSpecularEdgeColor(e=!1){e&&(this._material.brdf.dielectricSpecularModel=s.Y.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,this._material.brdf.conductorSpecularModel=s.Y.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}set specularWeight(e){this._material.metallicF0Factor=e}get specularWeight(){return this._material.metallicF0Factor??1}set specularWeightTexture(e){e?(this._material.metallicReflectanceTexture=e,this._material.useOnlyMetallicFromMetallicReflectanceTexture=!0):(this._material.metallicReflectanceTexture=null,this._material.useOnlyMetallicFromMetallicReflectanceTexture=!1)}get specularWeightTexture(){return this._material.metallicReflectanceTexture}set specularColor(e){this._material.metallicReflectanceColor=e}get specularColor(){return this._material.metallicReflectanceColor}set specularColorTexture(e){this._material.reflectanceTexture=e}get specularColorTexture(){return this._material.reflectanceTexture}set specularRoughness(e){this._material.roughness=e}get specularRoughness(){return this._material.roughness??1}set specularRoughnessTexture(e){this.baseMetalnessTexture||(this._material.metallicTexture=e)}get specularRoughnessTexture(){return this._material.metallicTexture}set specularIor(e){this._material.indexOfRefraction=e}get specularIor(){return this._material.indexOfRefraction}set emissionColor(e){this._material.emissiveColor=e}get emissionColor(){return this._material.emissiveColor}set emissionLuminance(e){this._material.emissiveIntensity=e}get emissionLuminance(){return this._material.emissiveIntensity}set emissionColorTexture(e){this._material.emissiveTexture=e}get emissionColorTexture(){return this._material.emissiveTexture}set ambientOcclusionTexture(e){this._material.ambientTexture=e,e&&(this._material.useAmbientInGrayScale=!0)}get ambientOcclusionTexture(){return this._material.ambientTexture}set ambientOcclusionTextureStrength(e){this._material.ambientTextureStrength=e}get ambientOcclusionTextureStrength(){return this._material.ambientTextureStrength??1}configureCoat(){this._material.clearCoat.isEnabled=!0,this._material.clearCoat.useRoughnessFromMainTexture=!1,this._material.clearCoat.remapF0OnInterfaceChange=!1}set coatWeight(e){this._material.clearCoat.isEnabled=!0,this._material.clearCoat.intensity=e}get coatWeight(){return this._material.clearCoat.intensity}set coatWeightTexture(e){this._material.clearCoat.isEnabled=!0,this._material.clearCoat.texture=e}get coatWeightTexture(){return this._material.clearCoat.texture}set coatColor(e){this._material.clearCoat.isTintEnabled=e!=r.v9.White(),this._material.clearCoat.tintColor=e}set coatColorTexture(e){this._material.clearCoat.tintTexture=e}set coatRoughness(e){this._material.clearCoat.isEnabled=!0,this._material.clearCoat.roughness=e}get coatRoughness(){return this._material.clearCoat.roughness??0}set coatRoughnessTexture(e){this._material.clearCoat.isEnabled=!0,this._material.clearCoat.useRoughnessFromMainTexture=!1,this._material.clearCoat.textureRoughness=e}get coatRoughnessTexture(){return this._material.clearCoat.textureRoughness}set coatIor(e){this._material.clearCoat.indexOfRefraction=e}set coatDarkening(e){}set coatDarkeningTexture(e){}set coatRoughnessAnisotropy(e){}get coatRoughnessAnisotropy(){return 0}set geometryCoatTangentAngle(e){}set geometryCoatTangentTexture(e){}get geometryCoatTangentTexture(){return null}set transmissionWeight(e){this._material.subSurface.isRefractionEnabled=e>0,this._material.subSurface.refractionIntensity=e}get transmissionWeight(){return this._material.subSurface.isRefractionEnabled?this._material.subSurface.refractionIntensity:0}set transmissionWeightTexture(e){this._material.subSurface.isRefractionEnabled=!0,this._material.subSurface.refractionIntensityTexture=e,this._material.subSurface.useGltfStyleTextures=!0}set transmissionDepth(e){this.transmissionWeight>0?this._material.subSurface.tintColorAtDistance=e:this.subsurfaceWeight>0&&this._material.subSurface.diffusionDistance.multiplyInPlace(new r.v9(e,e,e))}get transmissionDepth(){return this.transmissionWeight>0?this._material.subSurface.tintColorAtDistance:0}set transmissionColor(e){this.transmissionWeight>0?this._material.subSurface.tintColor=e:this.subsurfaceWeight>0&&this._material.subSurface.diffusionDistance.multiplyInPlace(e)}get transmissionColor(){return this.transmissionWeight>0?this._material.subSurface.tintColor:this.subsurfaceWeight>0?this._material.subSurface.diffusionDistance:new r.v9(0,0,0)}set transmissionScatter(e){this._material.subSurface.diffusionDistance=e}get transmissionScatter(){return this._material.subSurface.diffusionDistance}set transmissionScatterAnisotropy(e){}set transmissionDispersionAbbeNumber(e){}set transmissionDispersionScale(e){e>0?(this._material.subSurface.isDispersionEnabled=!0,this._material.subSurface.dispersion=20/e):(this._material.subSurface.isDispersionEnabled=!1,this._material.subSurface.dispersion=0)}get refractionBackgroundTexture(){return this._material.subSurface.refractionTexture}set refractionBackgroundTexture(e){this._material.subSurface.refractionTexture=e}configureTransmission(){this._material.subSurface.volumeIndexOfRefraction=1,this._material.subSurface.useAlbedoToTintRefraction=!0,this._material.subSurface.minimumThickness=0,this._material.subSurface.maximumThickness=0}set volumeThicknessTexture(e){this._material.subSurface.thicknessTexture=e,this._material.subSurface.useGltfStyleTextures=!0}set volumeThickness(e){this._material.subSurface.minimumThickness=0,this._material.subSurface.maximumThickness=e,this._material.subSurface.useThicknessAsDepth=!0,e>0&&(this._material.subSurface.volumeIndexOfRefraction=this._material.indexOfRefraction)}configureSubsurface(){this._material.subSurface.useGltfStyleTextures=!0,this._material.subSurface.volumeIndexOfRefraction=1,this._material.subSurface.minimumThickness=0,this._material.subSurface.maximumThickness=0,this._material.subSurface.useAlbedoToTintTranslucency=!1}set extinctionCoefficient(e){this._extinctionCoefficient=e}get extinctionCoefficient(){return this._extinctionCoefficient}set subsurfaceWeight(e){this._material.subSurface.isTranslucencyEnabled=e>0,this._material.subSurface.translucencyIntensity=e}get subsurfaceWeight(){return this._material.subSurface.isTranslucencyEnabled?this._material.subSurface.translucencyIntensity:0}set subsurfaceWeightTexture(e){this._material.subSurface.translucencyIntensityTexture=e}set subsurfaceColor(e){let t=this.extinctionCoefficient,i=Math.max(t.x,Math.max(t.y,t.z)),n=i>0?1/i:1;this._material.subSurface.diffusionDistance=new r.v9(Math.exp(-t.x*n),Math.exp(-t.y*n),Math.exp(-t.z*n))}set subsurfaceColorTexture(e){}set subsurfaceConstantTint(e){this._material.subSurface.tintColor=e}get subsurfaceConstantTint(){return this._material.subSurface.tintColor}set subsurfaceConstantTintTexture(e){this._material.subSurface.translucencyColorTexture=e}get subsurfaceRadius(){return 1}set subsurfaceRadius(e){}get subsurfaceRadiusScale(){return this._material.subSurface.scatteringDiffusionProfile??r.v9.White()}set subsurfaceRadiusScale(e){this._material.subSurface.scatteringDiffusionProfile=e}set subsurfaceScatterAnisotropy(e){}configureFuzz(){this._material.sheen.isEnabled=!0,this._material.sheen.useRoughnessFromMainTexture=!1,this._material.sheen.albedoScaling=!0}set fuzzWeight(e){this._material.sheen.isEnabled=!0,this._material.sheen.intensity=e}set fuzzWeightTexture(e){this._material.sheen.texture||(this._material.sheen.texture=e)}set fuzzColor(e){this._material.sheen.isEnabled=!0,this._material.sheen.color=e}set fuzzColorTexture(e){this._material.sheen.texture=e}set fuzzRoughness(e){this._material.sheen.isEnabled=!0,this._material.sheen.roughness=e}set fuzzRoughnessTexture(e){this._material.sheen.isEnabled=!0,this._material.sheen.textureRoughness=e}set specularRoughnessAnisotropy(e){this._material.anisotropy.isEnabled=!0,this._material.anisotropy.intensity=e}get specularRoughnessAnisotropy(){return this._material.anisotropy.intensity}set geometryTangentAngle(e){this._material.anisotropy.isEnabled=!0,this._material.anisotropy.angle=e}set geometryTangentTexture(e){this._material.anisotropy.isEnabled=!0,this._material.anisotropy.texture=e}get geometryTangentTexture(){return this._material.anisotropy.texture}configureGltfStyleAnisotropy(e=!0){}set thinFilmWeight(e){this._material.iridescence.isEnabled=e>0,this._material.iridescence.intensity=e}set thinFilmIor(e){this._material.iridescence.indexOfRefraction=e}set thinFilmThicknessMinimum(e){this._material.iridescence.minimumThickness=e}set thinFilmThicknessMaximum(e){this._material.iridescence.maximumThickness=e}set thinFilmWeightTexture(e){this._material.iridescence.texture=e}set thinFilmThicknessTexture(e){this._material.iridescence.thicknessTexture=e}set unlit(e){this._material.unlit=e}set geometryOpacity(e){this._material.alpha=e}get geometryOpacity(){return this._material.alpha}set geometryNormalTexture(e){this._material.bumpTexture=e,this._material.forceIrradianceInFragment=!0}get geometryNormalTexture(){return this._material.bumpTexture}setNormalMapInversions(e,t){this._material.invertNormalMapX=e,this._material.invertNormalMapY=t}set geometryCoatNormalTexture(e){this._material.clearCoat.isEnabled=!0,this._material.clearCoat.bumpTexture=e}get geometryCoatNormalTexture(){return this._material.clearCoat.bumpTexture}set geometryCoatNormalTextureScale(e){this._material.clearCoat.bumpTexture&&(this._material.clearCoat.bumpTexture.level=e)}}},59110(e,t,i){i.r(t),i.d(t,{OBJFileLoader:()=>rM,GLTFLoaderDefaultOptions:()=>ea,GLTF2:()=>P,GLTFValidation:()=>Q,BVHFileLoader:()=>q,MTLFileLoader:()=>rR,SolidParser:()=>rP,GLTF1:()=>R,STLFileLoader:()=>rO,GLTFFileLoader:()=>el,GLTFLoaderState:()=>g,GLTFLoaderAnimationStartMode:()=>m,GLTFLoaderCoordinateSystemMode:()=>_,ReadBvh:()=>z,SPLATFileLoader:()=>rV});var r,n,s,a,o,l,u,h,c,d,p,f,_,m,g,b,y,x,T,v,A,S,E,I,R={};i.r(R),i.d(R,{EBlendingFunction:()=>E,EComponentType:()=>b,ECullingType:()=>S,EParameterType:()=>x,EShaderType:()=>y,ETextureFilterType:()=>v,ETextureFormat:()=>A,ETextureWrapMode:()=>T,GLTFBinaryExtension:()=>eQ,GLTFLoader:()=>eY,GLTFLoaderBase:()=>eZ,GLTFLoaderExtension:()=>eK,GLTFMaterialsCommonExtension:()=>eJ,GLTFUtils:()=>eP});var P={};i.r(P),i.d(P,{AddObjectAccessorToKey:()=>e7.oR,AnimationPropertyInfo:()=>tl.AnimationPropertyInfo,ArrayItem:()=>ts,EXT_lights_area:()=>tN,EXT_lights_ies:()=>tI,EXT_lights_image_based:()=>tf,EXT_mesh_gpu_instancing:()=>tm,EXT_meshopt_compression:()=>ty,EXT_texture_avif:()=>tA,EXT_texture_webp:()=>tT,ExtrasAsMetadata:()=>rE,FlowGraphGLTFDataProvider:()=>rI.FlowGraphGLTFDataProvider,GLTFFileLoader:()=>el,GLTFLoader:()=>to,GetMappingForKey:()=>e7.tQ,GetPathToObjectConverter:()=>e7.Wt,InteractivityGraphToFlowGraphParser:()=>rc,KHR_animation_pointer:()=>iY,KHR_draco_mesh_compression:()=>tM,KHR_interactivity:()=>rf,KHR_lights:()=>tO,KHR_materials_anisotropy:()=>tj,KHR_materials_clearcoat:()=>tG,KHR_materials_coat:()=>t$,KHR_materials_diffuse_roughness:()=>ih,KHR_materials_diffuse_transmission:()=>it,KHR_materials_dispersion:()=>il,KHR_materials_emissive_strength:()=>tZ,KHR_materials_fuzz:()=>tJ,KHR_materials_ior:()=>t3,KHR_materials_iridescence:()=>tW,KHR_materials_pbrSpecularGlossiness:()=>tB,KHR_materials_sheen:()=>tK,KHR_materials_specular:()=>t1,KHR_materials_transmission:()=>t7,KHR_materials_unlit:()=>tU,KHR_materials_variants:()=>t5,KHR_materials_volume:()=>ir,KHR_materials_volume_scatter:()=>ia,KHR_mesh_quantization:()=>id,KHR_node_hoverability:()=>rA,KHR_node_selectability:()=>ry,KHR_node_visibility:()=>rg,KHR_texture_basisu:()=>i_,KHR_texture_transform:()=>ig,KHR_xmp_json_ld:()=>iy,LoadBoundingInfoFromPositionAccessor:()=>ta,MSFT_audio_emitter:()=>i1,MSFT_lod:()=>i3,MSFT_minecraftMesh:()=>i5,MSFT_sRGBFactors:()=>i8,OpenPBRMaterialLoadingAdapter:()=>tu.OpenPBRMaterialLoadingAdapter,PBRMaterialLoadingAdapter:()=>th.PBRMaterialLoadingAdapter,SetInterpolationForKey:()=>e7.ZU,TransformNodeAnimationPropertyInfo:()=>tl.TransformNodeAnimationPropertyInfo,WeightAnimationPropertyInfo:()=>tl.WeightAnimationPropertyInfo,_AddInteractivityObjectModel:()=>r_,addNewInteractivityFlowGraphMapping:()=>rr,getAllSupportedNativeNodeTypes:()=>rl,getMappingForDeclaration:()=>ri,getMappingForFullOperationName:()=>rt,getQuaternion:()=>tl.getQuaternion,getVector3:()=>tl.getVector3,getWeights:()=>tl.getWeights,gltfTypeToBabylonType:()=>rh,registerGLTFExtension:()=>e8,registeredGLTFExtensions:()=>e6,unregisterGLTFExtension:()=>e9});var M=i(25835),C=i(60371),O=i(72218),w=i(70134),D=i(32997);let N="Xposition",L="Yposition",F="Zposition",B="Xrotation",k="Yrotation",U="Zrotation";class V{constructor(e){this.loopMode=M.X5.ANIMATIONLOOPMODE_CYCLE,this.list=[],this.root=G(),this.numFrames=0,this.frameRate=0,this.skeleton=e}}function G(){return{name:"",type:"",offset:new w.Pq,channels:[],children:[],frames:[],parent:null}}function z(e,t,i,r){let n=e.split("\n"),{loopMode:s}=r;t._blockEntityCollection=!!i;let a=new O.E("","",t);a._parentContainer=i,t._blockEntityCollection=!1;let o=new V(a);o.loopMode=s;let l=n.shift();if(!l||"HIERARCHY"!==l.trim().toUpperCase())throw Error("HIERARCHY expected");let u=n.shift();if(!u)throw Error("Unexpected end of file after HIERARCHY");let h=function e(t,i,r,n){let s=G();s.parent=r,n.list.push(s);let a=i.trim().split(/\s+/);if("END"===a[0].toUpperCase()&&"SITE"===a[1].toUpperCase()?(s.type="ENDSITE",s.name="ENDSITE"):(s.name=a[1],s.type=a[0].toUpperCase()),t.shift()?.trim()!="{")throw Error("Expected opening { after type & name");let o=t.shift()?.trim().split(/\s+/);if(!o)throw Error("Unexpected end of file: missing OFFSET");if("OFFSET"!=(a=o)[0].toUpperCase())throw Error("Expected OFFSET, but got: "+a[0]);if(4!=a.length)throw Error("OFFSET: Invalid number of values");let l=new w.Pq(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));if(isNaN(l.x)||isNaN(l.y)||isNaN(l.z))throw Error("OFFSET: Invalid values");if(s.offset=l,"ENDSITE"!=s.type){if(!(a=t.shift()?.trim().split(/\s+/)))throw Error("Unexpected end of file: missing CHANNELS");if("CHANNELS"!=a[0].toUpperCase())throw Error("Expected CHANNELS definition");let e=parseInt(a[1]);s.channels=a.splice(2,e),s.children=[]}for(;t.length>0;){let i=t.shift()?.trim();if("}"===i)return s;i&&s.children.push(e(t,i,s,n))}throw Error("Unexpected end of file: missing closing brace")}(n,u.trim(),null,o),c=n.shift();if(!c||"MOTION"!==c.trim().toUpperCase())throw Error("MOTION expected");let d=n.shift();if(!d)throw Error("Unexpected end of file before frame count");let p=d.trim().split(/[\s]+/);if(p.length<2)throw Error("Invalid frame count line");let f=parseInt(p[1]);if(isNaN(f))throw Error("Failed to read number of frames.");o.numFrames=f;let _=n.shift();if(!_)throw Error("Unexpected end of file before frame time");let m=_.trim().split(/[\s]+/);if(m.length<3)throw Error("Invalid frame time line");let g=parseFloat(m[2]);if(isNaN(g))throw Error("Failed to read frame time.");if(g<=0)throw Error("Failed to read frame time. Invalid value "+g);o.frameRate=1/g;for(let e=0;e<f;++e){let t=n.shift();t&&!function e(t,i,r,n){if("ENDSITE"===r.type)return;let s={frame:0,position:new w.Pq,rotation:new w.PT};s.frame=i,s.position=new w.Pq,s.rotation=new w.PT,r.frames.push(s);let a=w.uq.Identity();for(let e=0;e<r.channels.length;++e){let i=r.channels[e],o=t[n.i++];if(!o)continue;let l=parseFloat(o.trim());if(i.endsWith("position"))switch(i){case N:s.position.x=l;break;case L:s.position.y=l;break;case F:s.position.z=l}else if(i.endsWith("rotation")){let e,t=D.S0.ToRadians(l);switch(i){case B:e=w.uq.RotationX(t);break;case k:e=w.uq.RotationY(t);break;case U:e=w.uq.RotationZ(t)}a=e.multiply(a)}}for(let o of(w.PT.FromRotationMatrixToRef(a,s.rotation),r.children))e(t,i,o,n)}(t.trim().split(/[\s]+/)||[],e,h,{i:0})}return o.root=h,!function e(t,i,r){let n,s,a,o=(n=t.offset.x,s=t.offset.y,a=t.offset.z,w.uq.Translation(n,s,a)),l=new C.$(t.name,r.skeleton,i,o);for(let e of function(e,t){if(0===e.frames.length)return[];let i=[],r=e.channels.some(e=>e===N||e===L||e===F),n=e.channels.some(e=>e===B||e===k||e===U),s=new M.X5(`${e.name}_pos`,"position",t.frameRate,M.X5.ANIMATIONTYPE_VECTOR3,t.loopMode),a=new M.X5(`${e.name}_rot`,"rotationQuaternion",t.frameRate,M.X5.ANIMATIONTYPE_QUATERNION,t.loopMode),o=[],l=[];for(let t=0;t<e.frames.length;t++){let i=e.frames[t];r&&i.position&&o.push({frame:i.frame,value:i.position.clone()}),n&&l.push({frame:i.frame,value:i.rotation.clone()})}return o.length>0&&(s.setKeys(o),i.push(s)),l.length>0&&(a.setKeys(l),i.push(a)),i}(t,r))e.getKeys()&&e.getKeys().length>0&&l.animations.push(e);for(let i of t.children)e(i,l,r)}(o.root,null,o),o.skeleton.returnToRest(),o.skeleton}var $=i(89389),H=i(66578);let W={".bvh":{isBinary:!1}};class q{constructor(e){this.name="bvh",this.extensions=W,this._loadingOptions={...q._DefaultLoadingOptions,...e??{}}}static get _DefaultLoadingOptions(){return{loopMode:M.X5.ANIMATIONLOOPMODE_CYCLE}}createPlugin(e){return new q(e.bvh)}canDirectLoad(e){return this.isBvhHeader(e)}isBvhHeader(e){return"HIERARCHY"==e.split("\n")[0]}isNotBvhHeader(e){return!this.isBvhHeader(e)}importMeshAsync(e,t,i){if("string"!=typeof i)return Promise.reject("BVH loader expects string data.");if(this.isNotBvhHeader(i))return Promise.reject("BVH loader expects HIERARCHY header.");try{let e=z(i,t,null,this._loadingOptions);return Promise.resolve({meshes:[],particleSystems:[],skeletons:[e],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]})}catch(e){return Promise.reject(e)}}loadAsync(e,t){return"string"!=typeof t?Promise.reject("BVH loader expects string data."):this.isNotBvhHeader(t)?Promise.reject("BVH loader expects HIERARCHY header."):this.importMeshAsync(null,e,t).then(()=>{})}loadAssetContainerAsync(e,t){if("string"!=typeof t)return Promise.reject("BVH loader expects string data.");if(this.isNotBvhHeader(t))return Promise.reject("BVH loader expects HIERARCHY header.");let i=new H.WZ(e);try{let r=z(t,e,i,this._loadingOptions);return i.skeletons.push(r),Promise.resolve(i)}catch(e){return Promise.reject(e)}}}(0,$.qS)(new q);var j=i(52969),X=i(31656),Z=i(28147);function Y(e,t,i,r){let n={externalResourceFunction:r};return i&&(n.uri="file:"===t?i:t+i),ArrayBuffer.isView(e)?GLTFValidator.validateBytes(e,n):GLTFValidator.validateString(e,n)}function K(){let e=[];onmessage=t=>{let i=t.data;switch(i.id){case"init":importScripts(i.url);break;case"validate":Y(i.data,i.rootUrl,i.fileName,t=>new Promise((i,r)=>{let n=e.length;e.push({resolve:i,reject:r}),postMessage({id:"getExternalResource",index:n,uri:t})})).then(e=>{postMessage({id:"validate.resolve",value:e})},e=>{postMessage({id:"validate.reject",reason:e})});break;case"getExternalResource.resolve":e[i.index].resolve(i.value);break;case"getExternalResource.reject":e[i.index].reject(i.reason)}}}class Q{static ValidateAsync(e,t,i,r){return"function"==typeof Worker?new Promise((n,s)=>{let a=`${Y}(${K})()`,o=new Worker(URL.createObjectURL(new Blob([a],{type:"application/javascript"}))),l=e=>{o.removeEventListener("error",l),o.removeEventListener("message",u),s(e)},u=e=>{let t=e.data;switch(t.id){case"getExternalResource":r(t.uri).then(e=>{o.postMessage({id:"getExternalResource.resolve",index:t.index,value:e},[e.buffer])},e=>{o.postMessage({id:"getExternalResource.reject",index:t.index,reason:e})});break;case"validate.resolve":o.removeEventListener("error",l),o.removeEventListener("message",u),Q._LastResults=t.value,n(t.value),o.terminate();break;case"validate.reject":o.removeEventListener("error",l),o.removeEventListener("message",u),s(t.reason),o.terminate()}};if(o.addEventListener("error",l),o.addEventListener("message",u),o.postMessage({id:"init",url:D.S0.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(e)){let r=e.slice();o.postMessage({id:"validate",data:r,rootUrl:t,fileName:i},[r.buffer])}else o.postMessage({id:"validate",data:e,rootUrl:t,fileName:i})}):(this._LoadScriptPromise||(this._LoadScriptPromise=D.S0.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(()=>Y(e,t,i,r)))}}Q.Configuration={url:`${D.S0._DefaultCdnUrl}/gltf_validator.js`},Q._LastResults=null;let J="Z2xURg",ee="gltf",et={".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}};var ei=i(32715),er=i(4328);function en(e,t,i){try{return Promise.resolve(new Uint8Array(e,t,i))}catch(e){return Promise.reject(e)}}(r=_||(_={}))[r.AUTO=0]="AUTO",r[r.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED",(n=m||(m={}))[n.NONE=0]="NONE",n[n.FIRST=1]="FIRST",n[n.ALL=2]="ALL",(s=g||(g={}))[s.LOADING=0]="LOADING",s[s.READY=1]="READY",s[s.COMPLETE=2]="COMPLETE";class es{constructor(){this.alwaysComputeBoundingBox=!1,this.alwaysComputeSkeletonRootNode=!1,this.animationStartMode=m.FIRST,this.compileMaterials=!1,this.compileShadowGenerators=!1,this.coordinateSystemMode=_.AUTO,this.createInstances=!0,this.loadAllMaterials=!1,this.loadMorphTargets=!0,this.loadNodeAnimations=!0,this.loadOnlyMaterials=!1,this.loadSkins=!0,this.skipMaterials=!1,this.targetFps=60,this.transparencyAsCoverage=!1,this.useClipPlane=!1,this.useGltfTextureNames=!1,this.useRangeRequests=!1,this.useSRGBBuffers=!0,this.validate=!1,this.useOpenPBR=!1,this.dontUseTransmissionHelper=!1}}let ea=new es;class eo extends es{constructor(){super(...arguments),this.extensionOptions={},this.preprocessUrlAsync=e=>Promise.resolve(e)}copyFrom(e){e&&(this.alwaysComputeBoundingBox=e.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.alwaysComputeSkeletonRootNode=e.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.animationStartMode=e.animationStartMode??this.animationStartMode,this.capturePerformanceCounters=e.capturePerformanceCounters??this.capturePerformanceCounters,this.compileMaterials=e.compileMaterials??this.compileMaterials,this.compileShadowGenerators=e.compileShadowGenerators??this.compileShadowGenerators,this.coordinateSystemMode=e.coordinateSystemMode??this.coordinateSystemMode,this.createInstances=e.createInstances??this.createInstances,this.customRootNode=e.customRootNode,this.extensionOptions=e.extensionOptions??this.extensionOptions,this.loadAllMaterials=e.loadAllMaterials??this.loadAllMaterials,this.loadMorphTargets=e.loadMorphTargets??this.loadMorphTargets,this.loadNodeAnimations=e.loadNodeAnimations??this.loadNodeAnimations,this.loadOnlyMaterials=e.loadOnlyMaterials??this.loadOnlyMaterials,this.loadSkins=e.loadSkins??this.loadSkins,this.loggingEnabled=e.loggingEnabled??this.loggingEnabled,this.onCameraLoaded=e.onCameraLoaded,this.onMaterialLoaded=e.onMaterialLoaded,this.onMeshLoaded=e.onMeshLoaded,this.onParsed=e.onParsed,this.onSkinLoaded=e.onSkinLoaded,this.onTextureLoaded=e.onTextureLoaded,this.onValidated=e.onValidated,this.preprocessUrlAsync=e.preprocessUrlAsync??this.preprocessUrlAsync,this.skipMaterials=e.skipMaterials??this.skipMaterials,this.targetFps=e.targetFps??this.targetFps,this.transparencyAsCoverage=e.transparencyAsCoverage??this.transparencyAsCoverage,this.useClipPlane=e.useClipPlane??this.useClipPlane,this.useGltfTextureNames=e.useGltfTextureNames??this.useGltfTextureNames,this.useOpenPBR=e.useOpenPBR??this.useOpenPBR,this.useRangeRequests=e.useRangeRequests??this.useRangeRequests,this.useSRGBBuffers=e.useSRGBBuffers??this.useSRGBBuffers,this.validate=e.validate??this.validate,this.dontUseTransmissionHelper=e.dontUseTransmissionHelper??this.dontUseTransmissionHelper)}}class el extends eo{constructor(e){super(),this.onParsedObservable=new j.cP,this.onMeshLoadedObservable=new j.cP,this.onSkinLoadedObservable=new j.cP,this.onTextureLoadedObservable=new j.cP,this.onMaterialLoadedObservable=new j.cP,this.onCameraLoadedObservable=new j.cP,this.onCompleteObservable=new j.cP,this.onErrorObservable=new j.cP,this.onDisposeObservable=new j.cP,this.onExtensionLoadedObservable=new j.cP,this.onValidatedObservable=new j.cP,this._loader=null,this._state=null,this._requests=[],this.name=ee,this.extensions=et,this.onLoaderStateChangedObservable=new j.cP,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.copyFrom(Object.assign({...ea},e))}set onParsed(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),e&&(this._onParsedObserver=this.onParsedObservable.add(e))}set onMeshLoaded(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),e&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e))}set onSkinLoaded(e){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),e&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add(t=>e(t.node,t.skinnedNode)))}set onTextureLoaded(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),e&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e))}set onMaterialLoaded(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),e&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e))}set onCameraLoaded(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),e&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e))}set onComplete(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)}set onError(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set onExtensionLoaded(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)}dispose(){for(let e of(this._loader&&(this._loader.dispose(),this._loader=null),this._requests))e.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=e=>Promise.resolve(e),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()}loadFile(e,t,i,r,n,s,a,o){if(ArrayBuffer.isView(t))return this._loadBinary(e,t,i,r,a,o),null;this._progressCallback=n;let l=t.name||D.S0.GetFilename(t);if(!s)return this._loadFile(e,t,t=>{try{this._validate(e,t,i,l),r({json:this._parseJson(t)})}catch{a&&a()}},!1,a);if(this.useRangeRequests){this.validate&&X.V.Warn("glTF validation is not supported when range requests are enabled");let i={abort:()=>{},onCompleteObservable:new j.cP};return this._unpackBinaryAsync(new Z.s({readAsync:(i,r)=>new Promise((n,s)=>{this._loadFile(e,t,e=>{n(new Uint8Array(e))},!0,e=>{s(e)},e=>{e.setRequestHeader("Range",`bytes=${i}-${i+r-1}`)})}),byteLength:0})).then(e=>{i.onCompleteObservable.notifyObservers(i),r(e)},a?e=>a(void 0,e):void 0),i}return this._loadFile(e,t,t=>{this._validate(e,new Uint8Array(t,0,t.byteLength),i,l),this._unpackBinaryAsync(new Z.s({readAsync:(e,i)=>en(t,e,i),byteLength:t.byteLength})).then(e=>{r(e)},a?e=>a(void 0,e):void 0)},!0,a)}_loadBinary(e,t,i,r,n,s){this._validate(e,new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i,s),this._unpackBinaryAsync(new Z.s({readAsync:(e,i)=>(function(e,t,i){try{if(t<0||t>=e.byteLength)throw RangeError("Offset is out of range.");if(t+i>e.byteLength)throw RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(e.buffer,e.byteOffset+t,i))}catch(e){return Promise.reject(e)}})(t,e,i),byteLength:t.byteLength})).then(e=>{r(e)},n?e=>n(void 0,e):void 0)}importMeshAsync(e,t,i,r,n,s){return Promise.resolve().then(()=>(this.onParsedObservable.notifyObservers(i),this.onParsedObservable.clear(),this._log(`Loading ${s||""}`),this._loader=this._getLoader(i),this._loader.importMeshAsync(e,t,null,i,r,n,s)))}loadAsync(e,t,i,r,n){return Promise.resolve().then(()=>(this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${n||""}`),this._loader=this._getLoader(t),this._loader.loadAsync(e,t,i,r,n)))}loadAssetContainerAsync(e,t,i,r,n){return Promise.resolve().then(()=>{this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${n||""}`),this._loader=this._getLoader(t);let s=new H.WZ(e),a=[];this.onMaterialLoadedObservable.add(e=>{a.push(e)});let o=[];this.onTextureLoadedObservable.add(e=>{o.push(e)});let l=[];this.onCameraLoadedObservable.add(e=>{l.push(e)});let u=[];return this.onMeshLoadedObservable.add(e=>{e.morphTargetManager&&u.push(e.morphTargetManager)}),this._loader.importMeshAsync(null,e,s,t,i,r,n).then(e=>(Array.prototype.push.apply(s.geometries,e.geometries),Array.prototype.push.apply(s.meshes,e.meshes),Array.prototype.push.apply(s.particleSystems,e.particleSystems),Array.prototype.push.apply(s.skeletons,e.skeletons),Array.prototype.push.apply(s.animationGroups,e.animationGroups),Array.prototype.push.apply(s.materials,a),Array.prototype.push.apply(s.textures,o),Array.prototype.push.apply(s.lights,e.lights),Array.prototype.push.apply(s.transformNodes,e.transformNodes),Array.prototype.push.apply(s.cameras,l),Array.prototype.push.apply(s.morphTargetManagers,u),s))})}canDirectLoad(e){let t;return -1!==(t=e).indexOf("asset")&&-1!==t.indexOf("version")||t.startsWith("data:base64,"+J)||t.startsWith("data:;base64,"+J)||t.startsWith("data:application/octet-stream;base64,"+J)||t.startsWith("data:model/gltf-binary;base64,"+J)}directLoad(e,t){if(t.startsWith("base64,"+J)||t.startsWith(";base64,"+J)||t.startsWith("application/octet-stream;base64,"+J)||t.startsWith("model/gltf-binary;base64,"+J)){let i=(0,ei.rz)(t);return this._validate(e,new Uint8Array(i,0,i.byteLength)),this._unpackBinaryAsync(new Z.s({readAsync:(e,t)=>en(i,e,t),byteLength:i.byteLength}))}return this._validate(e,t),Promise.resolve({json:this._parseJson(t)})}createPlugin(e){return new el(e[ee])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise((e,t)=>{this.onCompleteObservable.addOnce(()=>{e()}),this.onErrorObservable.addOnce(e=>{t(e)})})}_setState(e){this._state!==e&&(this._state=e,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(g[this._state]))}_loadFile(e,t,i,r,n,s){let a=e._loadFile(t,i,e=>{this._onProgress(e,a)},!0,r,n,s);return a.onCompleteObservable.add(()=>{a._lengthComputable=!0,a._total=a._loaded}),this._requests.push(a),a}_onProgress(e,t){if(!this._progressCallback)return;t._lengthComputable=e.lengthComputable,t._loaded=e.loaded,t._total=e.total;let i=!0,r=0,n=0;for(let e of this._requests){if(void 0===e._lengthComputable||void 0===e._loaded||void 0===e._total)return;i=i&&e._lengthComputable,r+=e._loaded,n+=e._total}this._progressCallback({lengthComputable:i,loaded:r,total:i?n:0})}_validate(e,t,i="",r=""){this.validate&&(this._startPerformanceCounter("Validate JSON"),Q.ValidateAsync(t,i,r,t=>this.preprocessUrlAsync(i+t).then(t=>e._loadFileAsync(t,void 0,!0,!0).then(e=>new Uint8Array(e,0,e.byteLength)))).then(e=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(e),this.onValidatedObservable.clear()},e=>{this._endPerformanceCounter("Validate JSON"),D.S0.Warn(`Failed to validate: ${e.message}`),this.onValidatedObservable.clear()}))}_getLoader(e){let t=e.json.asset||{};this._log(`Asset version: ${t.version}`),t.minVersion&&this._log(`Asset minimum version: ${t.minVersion}`),t.generator&&this._log(`Asset generator: ${t.generator}`);let i=el._parseVersion(t.version);if(!i)throw Error("Invalid version: "+t.version);if(void 0!==t.minVersion){let e=el._parseVersion(t.minVersion);if(!e)throw Error("Invalid minimum version: "+t.minVersion);if(el._compareVersion(e,{major:2,minor:0})>0)throw Error("Incompatible minimum version: "+t.minVersion)}let r={1:el._CreateGLTF1Loader,2:el._CreateGLTF2Loader}[i.major];if(!r)throw Error("Unsupported version: "+t.version);return r(this)}_parseJson(e){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${e.length}`);let t=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),t}_unpackBinaryAsync(e){return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then(()=>{let t,i=e.readUint32();if(0x46546c67!==i)throw new er.bu("Unexpected magic: "+i,er.tG.GLTFLoaderUnexpectedMagicError);let r=e.readUint32();this.loggingEnabled&&this._log(`Binary version: ${r}`);let n=e.readUint32();switch(!this.useRangeRequests&&n!==e.buffer.byteLength&&X.V.Warn(`Length in header does not match actual data length: ${n} != ${e.buffer.byteLength}`),r){case 1:t=this._unpackBinaryV1Async(e,n);break;case 2:t=this._unpackBinaryV2Async(e,n);break;default:throw Error("Unsupported version: "+r)}return this._endPerformanceCounter("Unpack Binary"),t})}_unpackBinaryV1Async(e,t){let i=e.readUint32(),r=e.readUint32();if(0!==r)throw Error(`Unexpected content format: ${r}`);let n=t-e.byteOffset,s={json:this._parseJson(e.readString(i)),bin:null};if(0!==n){let t=e.byteOffset;s.bin={readAsync:(i,r)=>e.buffer.readAsync(t+i,r),byteLength:n}}return Promise.resolve(s)}_unpackBinaryV2Async(e,t){let i=e.readUint32();if(0x4e4f534a!==e.readUint32())throw Error("First chunk format is not JSON");return e.byteOffset+i===t?e.loadAsync(i).then(()=>({json:this._parseJson(e.readString(i)),bin:null})):e.loadAsync(i+8).then(()=>{let r={json:this._parseJson(e.readString(i)),bin:null},n=()=>{let i=e.readUint32();switch(e.readUint32()){case 0x4e4f534a:throw Error("Unexpected JSON chunk");case 5130562:{let t=e.byteOffset;r.bin={readAsync:(i,r)=>e.buffer.readAsync(t+i,r),byteLength:i},e.skipBytes(i);break}default:e.skipBytes(i)}return e.byteOffset!==t?e.loadAsync(8).then(n):Promise.resolve(r)};return n()})}static _parseVersion(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};let t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null}static _compareVersion(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0}_logOpen(e){this._log(e),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(e){let t=el._logSpaces.substring(0,2*this._logIndentLevel);X.V.Log(`${t}${e}`)}_logDisabled(e){}_startPerformanceCounterEnabled(e){D.S0.StartPerformanceCounter(e)}_startPerformanceCounterDisabled(e){}_endPerformanceCounterEnabled(e){D.S0.EndPerformanceCounter(e)}_endPerformanceCounterDisabled(e){}}el.IncrementalLoading=!0,el.HomogeneousCoordinates=!1,el._logSpaces="                                ",(0,$.qS)(new el),(a=b||(b={}))[a.BYTE=5120]="BYTE",a[a.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",a[a.SHORT=5122]="SHORT",a[a.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",a[a.FLOAT=5126]="FLOAT",(o=y||(y={}))[o.FRAGMENT=35632]="FRAGMENT",o[o.VERTEX=35633]="VERTEX",(l=x||(x={}))[l.BYTE=5120]="BYTE",l[l.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",l[l.SHORT=5122]="SHORT",l[l.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",l[l.INT=5124]="INT",l[l.UNSIGNED_INT=5125]="UNSIGNED_INT",l[l.FLOAT=5126]="FLOAT",l[l.FLOAT_VEC2=35664]="FLOAT_VEC2",l[l.FLOAT_VEC3=35665]="FLOAT_VEC3",l[l.FLOAT_VEC4=35666]="FLOAT_VEC4",l[l.INT_VEC2=35667]="INT_VEC2",l[l.INT_VEC3=35668]="INT_VEC3",l[l.INT_VEC4=35669]="INT_VEC4",l[l.BOOL=35670]="BOOL",l[l.BOOL_VEC2=35671]="BOOL_VEC2",l[l.BOOL_VEC3=35672]="BOOL_VEC3",l[l.BOOL_VEC4=35673]="BOOL_VEC4",l[l.FLOAT_MAT2=35674]="FLOAT_MAT2",l[l.FLOAT_MAT3=35675]="FLOAT_MAT3",l[l.FLOAT_MAT4=35676]="FLOAT_MAT4",l[l.SAMPLER_2D=35678]="SAMPLER_2D",(u=T||(T={}))[u.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",u[u.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",u[u.REPEAT=10497]="REPEAT",(h=v||(v={}))[h.NEAREST=9728]="NEAREST",h[h.LINEAR=9728]="LINEAR",h[h.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",h[h.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",h[h.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",h[h.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",(c=A||(A={}))[c.ALPHA=6406]="ALPHA",c[c.RGB=6407]="RGB",c[c.RGBA=6408]="RGBA",c[c.LUMINANCE=6409]="LUMINANCE",c[c.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",(d=S||(S={}))[d.FRONT=1028]="FRONT",d[d.BACK=1029]="BACK",d[d.FRONT_AND_BACK=1032]="FRONT_AND_BACK",(p=E||(E={}))[p.ZERO=0]="ZERO",p[p.ONE=1]="ONE",p[p.SRC_COLOR=768]="SRC_COLOR",p[p.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",p[p.DST_COLOR=774]="DST_COLOR",p[p.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",p[p.SRC_ALPHA=770]="SRC_ALPHA",p[p.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",p[p.DST_ALPHA=772]="DST_ALPHA",p[p.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",p[p.CONSTANT_COLOR=32769]="CONSTANT_COLOR",p[p.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",p[p.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",p[p.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",p[p.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";var eu=i(19002),eh=i(26623),ec=i(76921),ed=i(54859),ep=i(21383),ef=i(2340),e_=i(35666),em=i(13890),eg=i(49578),eb=i(48256),ey=i(95435),ex=i(23487),eT=i(5088),ev=i(31804),eA=i(66886),eS=i(51776),eE=i(96451),eI=i(43497),eR=i(16671);class eP{static SetMatrix(e,t,i,r,n){let s=null;if("MODEL"===i.semantic?s=t.getWorldMatrix():"PROJECTION"===i.semantic?s=e.getProjectionMatrix():"VIEW"===i.semantic?s=e.getViewMatrix():"MODELVIEWINVERSETRANSPOSE"===i.semantic?s=w.uq.Transpose(t.getWorldMatrix().multiply(e.getViewMatrix()).invert()):"MODELVIEW"===i.semantic?s=t.getWorldMatrix().multiply(e.getViewMatrix()):"MODELVIEWPROJECTION"===i.semantic?s=t.getWorldMatrix().multiply(e.getTransformMatrix()):"MODELINVERSE"===i.semantic?s=t.getWorldMatrix().invert():"VIEWINVERSE"===i.semantic?s=e.getViewMatrix().invert():"PROJECTIONINVERSE"===i.semantic?s=e.getProjectionMatrix().invert():"MODELVIEWINVERSE"===i.semantic?s=t.getWorldMatrix().multiply(e.getViewMatrix()).invert():"MODELVIEWPROJECTIONINVERSE"===i.semantic?s=t.getWorldMatrix().multiply(e.getTransformMatrix()).invert():"MODELINVERSETRANSPOSE"===i.semantic&&(s=w.uq.Transpose(t.getWorldMatrix().invert())),s)switch(i.type){case x.FLOAT_MAT2:n.setMatrix2x2(r,w.uq.GetAsMatrix2x2(s));break;case x.FLOAT_MAT3:n.setMatrix3x3(r,w.uq.GetAsMatrix3x3(s));break;case x.FLOAT_MAT4:n.setMatrix(r,s)}}static SetUniform(e,t,i,r){switch(r){case x.FLOAT:return e.setFloat(t,i),!0;case x.FLOAT_VEC2:return e.setVector2(t,w.I9.FromArray(i)),!0;case x.FLOAT_VEC3:return e.setVector3(t,w.Pq.FromArray(i)),!0;case x.FLOAT_VEC4:return e.setVector4(t,w.IU.FromArray(i)),!0;default:return!1}}static GetWrapMode(e){switch(e){case T.CLAMP_TO_EDGE:return eg.g.CLAMP_ADDRESSMODE;case T.MIRRORED_REPEAT:return eg.g.MIRROR_ADDRESSMODE;case T.REPEAT:default:return eg.g.WRAP_ADDRESSMODE}}static GetByteStrideFromType(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}}static GetTextureFilterMode(e){switch(e){case v.LINEAR:case v.LINEAR_MIPMAP_NEAREST:case v.LINEAR_MIPMAP_LINEAR:return eg.g.TRILINEAR_SAMPLINGMODE;case v.NEAREST:case v.NEAREST_MIPMAP_NEAREST:return eg.g.NEAREST_SAMPLINGMODE;default:return eg.g.BILINEAR_SAMPLINGMODE}}static GetBufferFromBufferView(e,t,i,r,n){i=t.byteOffset+i;let s=e.loadedBufferViews[t.buffer];if(i+r>s.byteLength)throw Error("Buffer access is out of range");let a=s.buffer;switch(i+=s.byteOffset,n){case b.BYTE:return new Int8Array(a,i,r);case b.UNSIGNED_BYTE:return new Uint8Array(a,i,r);case b.SHORT:return new Int16Array(a,i,r);case b.UNSIGNED_SHORT:return new Uint16Array(a,i,r);default:return new Float32Array(a,i,r)}}static GetBufferFromAccessor(e,t){let i=e.bufferViews[t.bufferView],r=t.count*eP.GetByteStrideFromType(t);return eP.GetBufferFromBufferView(e,i,t.byteOffset,r,t.componentType)}static DecodeBufferToText(e){let t="",i=e.byteLength;for(let r=0;r<i;++r)t+=String.fromCharCode(e[r]);return t}static GetDefaultMaterial(e){return eP._DefaultMaterial||(ed.M.ShadersStore.GLTFDefaultMaterialVertexShader="precision highp float;\n\nuniform mat4 worldView;\nuniform mat4 projection;\n\nattribute vec3 position;\n\nvoid main(void)\n{\n    gl_Position = projection * worldView * vec4(position, 1.0);\n}",ed.M.ShadersStore.GLTFDefaultMaterialPixelShader="precision highp float;\n\nuniform vec4 u_emission;\n\nvoid main(void)\n{\n    gl_FragColor = u_emission;\n}",eP._DefaultMaterial=new em.B("GLTFDefaultMaterial",e,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},{attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:[],needAlphaBlending:!1}),eP._DefaultMaterial.setColor4("u_emission",new eu.ov(.5,.5,.5,1))),eP._DefaultMaterial}}eP._DefaultMaterial=null;var eM=i(7836);(f=I||(I={}))[f.IDENTIFIER=1]="IDENTIFIER",f[f.UNKNOWN=2]="UNKNOWN",f[f.END_OF_INPUT=3]="END_OF_INPUT";class eC{constructor(e){this._pos=0,this.currentToken=I.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}getNextToken(){if(this.isEnd())return I.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=I.UNKNOWN,"_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=I.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken}peek(){return this._toParse[this._pos]}read(){return this._toParse[this._pos++]}forward(){this._pos++}isEnd(){return this._pos>=this._maxPos}}let eO=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],ew=["world","view","projection","worldView","worldViewProjection","mBones"],eD=["translation","rotation","scale"],eN=["position","rotationQuaternion","scaling"],eL=(e,t,i)=>{for(let r in e){let n=e[r];i[t][r]=n}},eF=e=>{if(e)for(let t=0;t<e.length/2;t++)e[2*t+1]=1-e[2*t+1]},eB=e=>{if("NORMAL"===e.semantic)return"normal";if("POSITION"===e.semantic)return"position";if("JOINT"===e.semantic)return"matricesIndices";if("WEIGHT"===e.semantic)return"matricesWeights";if("COLOR"===e.semantic)return"color";else if(e.semantic&&-1!==e.semantic.indexOf("TEXCOORD_")){let t=Number(e.semantic.split("_")[1]);return"uv"+(0===t?"":t+1)}return null},ek=e=>{let t=null;if(e.translation||e.rotation||e.scale){let i=w.Pq.FromArray(e.scale||[1,1,1]),r=w.PT.FromArray(e.rotation||[0,0,0,1]),n=w.Pq.FromArray(e.translation||[0,0,0]);t=w.uq.Compose(i,r,n)}else t=w.uq.FromArray(e.matrix);return t},eU=(e,t,i,r)=>{for(let e=0;e<r.bones.length;e++)if(r.bones[e].name===i)return r.bones[e];let n=e.nodes;for(let s in n){let a=n[s];if(!a.jointName)continue;let o=a.children;for(let n=0;n<o.length;n++){let l=e.nodes[o[n]];if(l.jointName&&l.jointName===i){let i=ek(a),n=new C.$(a.name||"",r,eU(e,t,a.jointName,r),i);return n.id=s,n}}}return null},eV=(e,t)=>{for(let i=0;i<e.length;i++){let r=e[i];for(let e=0;e<r.node.children.length;e++)if(r.node.children[e]===t)return r.bone}return null},eG=(e,t)=>{let i=e.nodes,r=i[t];if(r)return{node:r,id:t};for(let e in i)if((r=i[e]).jointName===t)return{node:r,id:e};return null},ez=(e,t)=>{for(let i=0;i<e.jointNames.length;i++)if(e.jointNames[i]===t)return!0;return!1},e$=(e,t,i,r,n)=>{let s;if(n||(e.scene._blockEntityCollection=!!e.assetContainer,(n=new eA.e(t.name||"",e.scene))._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,n.id=r),!t.babylonNode)return n;let a=[],o=null,l=[],u=[],h=[],c=[];for(let t=0;t<i.length;t++){let r=i[t],n=e.meshes[r];if(n)for(let t=0;t<n.primitives.length;t++){let i=new eb.P,r=n.primitives[t];r.mode;let s=r.attributes,d=null,p=null;for(let t in s)if(d=e.accessors[s[t]],p=eP.GetBufferFromAccessor(e,d),"NORMAL"===t)i.normals=new Float32Array(p.length),i.normals.set(p);else if("POSITION"===t){if(el.HomogeneousCoordinates){i.positions=new Float32Array(p.length-p.length/4);for(let e=0;e<p.length;e+=4)i.positions[e]=p[e],i.positions[e+1]=p[e+1],i.positions[e+2]=p[e+2]}else i.positions=new Float32Array(p.length),i.positions.set(p);u.push(i.positions.length)}else if(-1!==t.indexOf("TEXCOORD_")){let e=Number(t.split("_")[1]),r=ey.R.UVKind+(0===e?"":e+1),n=new Float32Array(p.length);n.set(p),eF(n),i.set(n,r)}else"JOINT"===t?(i.matricesIndices=new Float32Array(p.length),i.matricesIndices.set(p)):"WEIGHT"===t?(i.matricesWeights=new Float32Array(p.length),i.matricesWeights.set(p)):"COLOR"===t&&(i.colors=new Float32Array(p.length),i.colors.set(p));if(d=e.accessors[r.indices])i.indices=new Int32Array((p=eP.GetBufferFromAccessor(e,d)).length),i.indices.set(p),c.push(i.indices.length);else{let e=[];for(let t=0;t<i.positions.length/3;t++)e.push(t);i.indices=new Int32Array(e),c.push(i.indices.length)}o?o.merge(i):o=i;let f=e.scene.getMaterialById(r.material);a.push(null===f?eP.GetDefaultMaterial(e.scene):f),l.push(0===l.length?0:l[l.length-1]+u[u.length-2]),h.push(0===h.length?0:h[h.length-1]+c[c.length-2])}}e.scene._blockEntityCollection=!!e.assetContainer,a.length>1?(s=new ef.F("multimat"+r,e.scene)).subMaterials=a:s=new e_.F("multimat"+r,e.scene),1===a.length&&(s=a[0]),s._parentContainer=e.assetContainer,n.material||(n.material=s),new ex.V(r,e.scene,o,!1,n),n.computeWorldMatrix(!0),e.scene._blockEntityCollection=!1,n.subMeshes=[];let d=0;for(let t=0;t<i.length;t++){let r=i[t],s=e.meshes[r];if(s)for(let e=0;e<s.primitives.length;e++)s.primitives[e].mode,eT.K.AddToMesh(d,l[d],u[d],h[d],c[d],n,n,!0),d++}return n},eH=(e,t,i,r)=>{e.position&&(e.position=t),(e.rotationQuaternion||e.rotation)&&(e.rotationQuaternion=i),e.scaling&&(e.scaling=r)},eW=(e,t,i,r=!1)=>{let n=e.nodes[t],s=null;if(r=!e.importOnlyMeshes||!!r||!e.importMeshesNames||-1!==e.importMeshesNames.indexOf(n.name||"")||0===e.importMeshesNames.length,!n.jointName&&r&&null!==(s=((e,t,i)=>{let r=null;if(e.importOnlyMeshes&&(t.skin||t.meshes)&&e.importMeshesNames&&e.importMeshesNames.length>0&&-1===e.importMeshesNames.indexOf(t.name||""))return null;if(t.skin){if(t.meshes){let n=e.skins[t.skin],s=e$(e,t,t.meshes,i,t.babylonNode);s.skeleton=e.scene.getLastSkeletonById(t.skin),null===s.skeleton&&(s.skeleton=((e,t,i,r)=>{if(r||(r=new O.E(t.name||"","",e.scene)),!t.babylonSkeleton)return r;let n=[],s=[];((e,t,i,r)=>{for(let n in e.nodes){let s=e.nodes[n];if(!s.jointName||ez(i,s.jointName))continue;let a=ek(s),o=new C.$(s.name||"",t,null,a);o.id=n,r.push({bone:o,node:s,id:n})}for(let e=0;e<r.length;e++){let t=r[e],i=t.node.children;for(let e=0;e<i.length;e++){let n=null;for(let t=0;t<r.length;t++)if(r[t].id===i[e]){n=r[t];break}n&&(n.bone._parent=t.bone,t.bone.children.push(n.bone))}}})(e,r,t,n),r.bones=[];for(let i=0;i<t.jointNames.length;i++){let a=eG(e,t.jointNames[i]);if(!a)continue;let o=a.node;if(!o){D.S0.Warn("Joint named "+t.jointNames[i]+" does not exist");continue}let l=a.id,u=e.scene.getBoneById(l);if(u){r.bones.push(u);continue}let h=!1,c=null;for(let n=0;n<i;n++){let i=eG(e,t.jointNames[n]);if(!i)continue;let s=i.node;if(!s){D.S0.Warn("Joint named "+t.jointNames[n]+" does not exist when looking for parent");continue}let a=s.children;if(a){h=!1;for(let i=0;i<a.length;i++)if(a[i]===l){c=eU(e,t,t.jointNames[n],r),h=!0;break}if(h)break}}let d=ek(o);!c&&n.length>0&&(c=eV(n,l))&&-1===s.indexOf(c)&&s.push(c),new C.$(o.jointName||"",r,c,d).id=l}let a=r.bones;r.bones=[];for(let i=0;i<t.jointNames.length;i++){let n=eG(e,t.jointNames[i]);if(n){for(let e=0;e<a.length;e++)if(a[e].id===n.id){r.bones.push(a[e]);break}}}r.prepare();for(let e=0;e<s.length;e++)r.bones.push(s[e]);return r})(e,n,0,n.babylonSkeleton),n.babylonSkeleton||(n.babylonSkeleton=s.skeleton)),r=s}}else if(t.meshes)r=e$(e,t,t.mesh?[t.mesh]:t.meshes,i,t.babylonNode);else if(!t.light||t.babylonNode||e.importOnlyMeshes){if(t.camera&&!t.babylonNode&&!e.importOnlyMeshes){let i=e.cameras[t.camera];if(i){if(e.scene._blockEntityCollection=!!e.assetContainer,"orthographic"===i.type){let i=new ec.S(t.camera,w.Pq.Zero(),e.scene,!1);i.name=t.name||"",i.mode=eh.i.ORTHOGRAPHIC_CAMERA,i.attachControl(),r=i,i._parentContainer=e.assetContainer}else if("perspective"===i.type){let n=i[i.type],s=new ec.S(t.camera,w.Pq.Zero(),e.scene,!1);s.name=t.name||"",s.attachControl(),n.aspectRatio||(n.aspectRatio=e.scene.getEngine().getRenderWidth()/e.scene.getEngine().getRenderHeight()),n.znear&&n.zfar&&(s.maxZ=n.zfar,s.minZ=n.znear),r=s,s._parentContainer=e.assetContainer}e.scene._blockEntityCollection=!1}}}else{let i=e.lights[t.light];if(i){if("ambient"===i.type){let n=i[i.type],s=new eS.g(t.light,w.Pq.Zero(),e.scene);s.name=t.name||"",n.color&&(s.diffuse=eu.v9.FromArray(n.color)),r=s}else if("directional"===i.type){let n=i[i.type],s=new eE.Z(t.light,w.Pq.Zero(),e.scene);s.name=t.name||"",n.color&&(s.diffuse=eu.v9.FromArray(n.color)),r=s}else if("point"===i.type){let n=i[i.type],s=new eI.H(t.light,w.Pq.Zero(),e.scene);s.name=t.name||"",n.color&&(s.diffuse=eu.v9.FromArray(n.color)),r=s}else if("spot"===i.type){let n=i[i.type],s=new eR.n(t.light,w.Pq.Zero(),w.Pq.Zero(),0,0,e.scene);s.name=t.name||"",n.color&&(s.diffuse=eu.v9.FromArray(n.color)),n.fallOfAngle&&(s.angle=n.fallOfAngle),n.fallOffExponent&&(s.exponent=n.fallOffExponent),r=s}}}if(!t.jointName){if(t.babylonNode)return t.babylonNode;else if(null===r){e.scene._blockEntityCollection=!!e.assetContainer;let i=new eA.e(t.name||"",e.scene);i._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,t.babylonNode=i,r=i}}if(null!==r){if(t.matrix&&r instanceof eA.e){var n=r;if(t.matrix){let e=new w.Pq(0,0,0),i=new w.PT,r=new w.Pq(0,0,0);w.uq.FromArray(t.matrix).decompose(r,i,e),eH(n,e,i,r)}else t.translation&&t.rotation&&t.scale&&eH(n,w.Pq.FromArray(t.translation),w.PT.FromArray(t.rotation),w.Pq.FromArray(t.scale));n.computeWorldMatrix(!0)}else{let e=t.translation||[0,0,0],i=t.rotation||[0,0,0,1],n=t.scale||[1,1,1];eH(r,w.Pq.FromArray(e),w.PT.FromArray(i),w.Pq.FromArray(n))}r.updateCache(!0),t.babylonNode=r}return r})(e,n,t))&&(s.id=t,s.parent=i),n.children)for(let t=0;t<n.children.length;t++)eW(e,n.children[t],s,r)},eq=e=>{let t=e.currentScene;if(t)for(let i=0;i<t.nodes.length;i++)eW(e,t.nodes[i],null);else for(let i in e.scenes){t=e.scenes[i];for(let i=0;i<t.nodes.length;i++)eW(e,t.nodes[i],null)}(e=>{for(let t in e.animations){let i=e.animations[t];if(!i.channels||!i.samplers)continue;let r=null;for(let n=0;n<i.channels.length;n++){let s=i.channels[n],a=i.samplers[s.sampler];if(!a)continue;let o=null,l=null;i.parameters?(o=i.parameters[a.input],l=i.parameters[a.output]):(o=a.input,l=a.output);let u=eP.GetBufferFromAccessor(e,e.accessors[o]),h=eP.GetBufferFromAccessor(e,e.accessors[l]),c=s.target.id,d=e.scene.getNodeById(c);if(null===d&&(d=e.scene.getNodeByName(c)),null===d){D.S0.Warn("Creating animation named "+t+". But cannot find node named "+c+" to attach to");continue}let p=d instanceof C.$,f=s.target.path,_=eD.indexOf(f);-1!==_&&(f=eN[_]);let m=M.X5.ANIMATIONTYPE_MATRIX;p||("rotationQuaternion"===f?(m=M.X5.ANIMATIONTYPE_QUATERNION,d.rotationQuaternion=new w.PT):m=M.X5.ANIMATIONTYPE_VECTOR3);let g=null,b=[],y=0,x=!1;p&&r&&r.getKeys().length===u.length&&(g=r,x=!0),x||(e.scene._blockEntityCollection=!!e.assetContainer,g=new M.X5(t,p?"_matrix":f,1,m,M.X5.ANIMATIONLOOPMODE_CYCLE),e.scene._blockEntityCollection=!1);for(let e=0;e<u.length;e++){let t=null;if("rotationQuaternion"===f?(t=w.PT.FromArray([h[y],h[y+1],h[y+2],h[y+3]]),y+=4):(t=w.Pq.FromArray([h[y],h[y+1],h[y+2]]),y+=3),p){let i=d,n=w.Pq.Zero(),s=new w.PT,a=w.Pq.Zero(),o=i.getBaseMatrix();x&&r&&(o=r.getKeys()[e].value),o.decompose(a,s,n),"position"===f?n=t:"rotationQuaternion"===f?s=t:a=t,t=w.uq.Compose(a,s,n)}x?r&&(r.getKeys()[e].value=t):b.push({frame:u[e],value:t})}!x&&g&&(g.setKeys(b),d.animations.push(g)),r=g,e.scene.stopAnimation(d),e.scene.beginAnimation(d,0,u[u.length-1],!0,1)}}})(e);for(let t=0;t<e.scene.skeletons.length;t++){let i=e.scene.skeletons[t];e.scene.beginAnimation(i,0,Number.MAX_VALUE,!0,1)}},ej=(e,t,i)=>{for(let r in t.uniforms){let n=t.uniforms[r],s=t.parameters[n];if(e.currentIdentifier===r&&s.semantic&&!s.source&&!s.node){let e=eO.indexOf(s.semantic);if(-1!==e)return delete i[r],ew[e]}}return e.currentIdentifier},eX=e=>{for(let t in e.materials)eK.LoadMaterialAsync(e,t,()=>{},()=>{})};class eZ{static CreateRuntime(e,t,i){let r={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:i,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],assetContainer:null};return e.extensions&&eL(e.extensions,"extensions",r),e.extensionsUsed&&eL(e.extensionsUsed,"extensionsUsed",r),e.buffers&&((e,t)=>{for(let i in e){let r=e[i];t.buffers[i]=r,t.buffersCount++}})(e.buffers,r),e.bufferViews&&eL(e.bufferViews,"bufferViews",r),e.accessors&&eL(e.accessors,"accessors",r),e.meshes&&eL(e.meshes,"meshes",r),e.lights&&eL(e.lights,"lights",r),e.cameras&&eL(e.cameras,"cameras",r),e.nodes&&eL(e.nodes,"nodes",r),e.images&&eL(e.images,"images",r),e.textures&&eL(e.textures,"textures",r),e.shaders&&((e,t)=>{for(let i in e){let r=e[i];t.shaders[i]=r,t.shaderscount++}})(e.shaders,r),e.programs&&eL(e.programs,"programs",r),e.samplers&&eL(e.samplers,"samplers",r),e.techniques&&eL(e.techniques,"techniques",r),e.materials&&eL(e.materials,"materials",r),e.animations&&eL(e.animations,"animations",r),e.skins&&eL(e.skins,"skins",r),e.scenes&&(r.scenes=e.scenes),e.scene&&e.scenes&&(r.currentScene=e.scenes[e.scene]),r}static LoadBufferAsync(e,t,i,r,n){let s=e.buffers[t];D.S0.IsBase64(s.uri)?setTimeout(()=>i(new Uint8Array(D.S0.DecodeBase64(s.uri)))):D.S0.LoadFile(e.rootUrl+s.uri,e=>i(new Uint8Array(e)),n,void 0,!0,e=>{e&&r(e.status+" "+e.statusText)})}static LoadTextureBufferAsync(e,t,i,r){let n=e.textures[t];if(!n||!n.source)return void r("");if(n.babylonTexture)return void i(null);let s=e.images[n.source];D.S0.IsBase64(s.uri)?setTimeout(()=>i(new Uint8Array(D.S0.DecodeBase64(s.uri)))):D.S0.LoadFile(e.rootUrl+s.uri,e=>i(new Uint8Array(e)),void 0,void 0,!0,e=>{e&&r(e.status+" "+e.statusText)})}static CreateTextureAsync(e,t,i,r){let n=e.textures[t];if(n.babylonTexture)return void r(n.babylonTexture);let s=e.samplers[n.sampler],a=s.minFilter===v.NEAREST_MIPMAP_NEAREST||s.minFilter===v.NEAREST_MIPMAP_LINEAR||s.minFilter===v.LINEAR_MIPMAP_NEAREST||s.minFilter===v.LINEAR_MIPMAP_LINEAR,o=eg.g.BILINEAR_SAMPLINGMODE,l=null==i?new Blob:new Blob([i]),u=URL.createObjectURL(l),h=()=>URL.revokeObjectURL(u),c=new eg.g(u,e.scene,!a,!0,o,h,h);void 0!==s.wrapS&&(c.wrapU=eP.GetWrapMode(s.wrapS)),void 0!==s.wrapT&&(c.wrapV=eP.GetWrapMode(s.wrapT)),c.name=t,n.babylonTexture=c,r(c)}static LoadShaderStringAsync(e,t,i,r){let n=e.shaders[t];if(D.S0.IsBase64(n.uri)){let e=atob(n.uri.split(",")[1]);i&&i(e)}else D.S0.LoadFile(e.rootUrl+n.uri,i,void 0,void 0,!1,e=>{e&&r&&r(e.status+" "+e.statusText)})}static LoadMaterialAsync(e,t,i,r){let n=e.materials[t];if(!n.technique){r&&r("No technique found.");return}let s=e.techniques[n.technique];if(!s){e.scene._blockEntityCollection=!!e.assetContainer;let r=new e_.F(t,e.scene);r._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,r.diffuseColor=new eu.v9(.5,.5,.5),r.sideOrientation=ep.i.CounterClockWiseSideOrientation,i(r);return}let a=e.programs[s.program],o=s.states,l=ed.M.ShadersStore[a.vertexShader+"VertexShader"],u=ed.M.ShadersStore[a.fragmentShader+"PixelShader"],h="",c="",d=new eC(l),p=new eC(u),f={},_=[],m=[],g=[];for(let e in s.uniforms){let t=s.uniforms[e],i=s.parameters[t];if(f[e]=i,!i.semantic||i.node||i.source)i.type===x.SAMPLER_2D?g.push(e):_.push(e);else{let t=eO.indexOf(i.semantic);-1!==t?(_.push(ew[t]),delete f[e]):_.push(e)}}for(let e in s.attributes){let t=s.attributes[e],i=s.parameters[t];if(i.semantic){let e=eB(i);e&&m.push(e)}}for(;!d.isEnd()&&d.getNextToken();){if(d.currentToken!==I.IDENTIFIER){h+=d.currentString;continue}let e=!1;for(let t in s.attributes){let i=s.attributes[t],r=s.parameters[i];if(d.currentIdentifier===t&&r.semantic){h+=eB(r),e=!0;break}}e||(h+=ej(d,s,f))}for(;!p.isEnd()&&p.getNextToken();){if(p.currentToken!==I.IDENTIFIER){c+=p.currentString;continue}c+=ej(p,s,f)}let b={vertex:a.vertexShader+t,fragment:a.fragmentShader+t},y={attributes:m,uniforms:_,samplers:g,needAlphaBlending:o&&o.enable&&-1!==o.enable.indexOf(3042)};ed.M.ShadersStore[a.vertexShader+t+"VertexShader"]=h,ed.M.ShadersStore[a.fragmentShader+t+"PixelShader"]=c;let T=new em.B(t,e.scene,b,y);if(T.onError=(e,t)=>{T.dispose(!0),r("Cannot compile program named "+a.name+". Error: "+t+". Default material will be applied")},T.onCompiled=t=>{((e,t,i,r,n)=>{let s=r.values||i.parameters,a=i.uniforms;for(let i in n){let o=n[i],l=o.type,u=s[a[i]];if(void 0===u&&(u=o.value),!u)continue;let h=e=>i=>{o.value&&e&&(t.setTexture(e,i),delete n[e])};l===x.SAMPLER_2D?eK.LoadTextureAsync(e,r.values?u:o.value,h(i),()=>h(null)):o.value&&eP.SetUniform(t,i,r.values?u:o.value,l)&&delete n[i]}})(e,T,s,n,f),T.onBind=t=>{((e,t,i,r,n,s,a)=>{let o=s.values||n.parameters;for(let a in i){let l=i[a],u=l.type;if(u===x.FLOAT_MAT2||u===x.FLOAT_MAT3||u===x.FLOAT_MAT4)if(!l.semantic||l.source||l.node){if(l.semantic&&(l.source||l.node)){let e=t.scene.getNodeByName(l.source||l.node||"");if(null===e&&(e=t.scene.getNodeById(l.source||l.node||"")),null===e)continue;eP.SetMatrix(t.scene,e,l,a,r.getEffect())}}else eP.SetMatrix(t.scene,e,l,a,r.getEffect());else{let e=o[n.uniforms[a]];if(!e)continue;if(u===x.SAMPLER_2D){let i=t.textures[s.values?e:l.value].babylonTexture;if(null==i)continue;r.getEffect().setTexture(a,i)}else eP.SetUniform(r.getEffect(),a,e,u)}}a(r)})(t,e,f,T,s,n,i)}},T.sideOrientation=ep.i.CounterClockWiseSideOrientation,o&&o.functions){let e=o.functions;e.cullFace&&e.cullFace[0]!==S.BACK&&(T.backFaceCulling=!1);let t=e.blendFuncSeparate;t&&(t[0]===E.SRC_ALPHA&&t[1]===E.ONE_MINUS_SRC_ALPHA&&t[2]===E.ONE&&t[3]===E.ONE?T.alphaMode=eM.Y.ALPHA_COMBINE:t[0]===E.ONE&&t[1]===E.ONE&&t[2]===E.ZERO&&t[3]===E.ONE?T.alphaMode=eM.Y.ALPHA_ONEONE:t[0]===E.SRC_ALPHA&&t[1]===E.ONE&&t[2]===E.ZERO&&t[3]===E.ONE?T.alphaMode=eM.Y.ALPHA_ADD:t[0]===E.ZERO&&t[1]===E.ONE_MINUS_SRC_COLOR&&t[2]===E.ONE&&t[3]===E.ONE?T.alphaMode=eM.Y.ALPHA_SUBTRACT:t[0]===E.DST_COLOR&&t[1]===E.ZERO&&t[2]===E.ONE&&t[3]===E.ONE?T.alphaMode=eM.Y.ALPHA_MULTIPLY:t[0]===E.SRC_ALPHA&&t[1]===E.ONE_MINUS_SRC_COLOR&&t[2]===E.ONE&&t[3]===E.ONE&&(T.alphaMode=eM.Y.ALPHA_MAXIMIZED))}}}class eY{static RegisterExtension(e){eY.Extensions[e.name]?D.S0.Error('Tool with the same name "'+e.name+'" already exists'):eY.Extensions[e.name]=e}dispose(){}_importMeshAsync(e,t,i,r,n,s,a,o){return t.useRightHandedSystem=!0,eK.LoadRuntimeAsync(t,i,r,t=>{t.assetContainer=n,t.importOnlyMeshes=!0,""===e?t.importMeshesNames=[]:"string"==typeof e?t.importMeshesNames=[e]:!e||e instanceof Array?(t.importMeshesNames=[],D.S0.Warn("Argument meshesNames must be of type string or string[]")):t.importMeshesNames=[e],this._createNodes(t);let i=[],r=[];for(let e in t.nodes){let r=t.nodes[e];r.babylonNode instanceof ev.u&&i.push(r.babylonNode)}for(let e in t.skins){let i=t.skins[e];i.babylonSkeleton instanceof O.E&&r.push(i.babylonSkeleton)}this._loadBuffersAsync(t,()=>{this._loadShadersAsync(t,()=>{eX(t),eq(t),!el.IncrementalLoading&&s&&s(i,r)})}),el.IncrementalLoading&&s&&s(i,r)},o),!0}importMeshAsync(e,t,i,r,n,s){return new Promise((a,o)=>{this._importMeshAsync(e,t,r,n,i,(e,t)=>{a({meshes:e,particleSystems:[],skeletons:t,animationGroups:[],lights:[],transformNodes:[],geometries:[],spriteManagers:[]})},s,e=>{o(Error(e))})})}_loadAsync(e,t,i,r,n,s){e.useRightHandedSystem=!0,eK.LoadRuntimeAsync(e,t,i,e=>{eK.LoadRuntimeExtensionsAsync(e,()=>{this._createNodes(e),this._loadBuffersAsync(e,()=>{this._loadShadersAsync(e,()=>{eX(e),eq(e),el.IncrementalLoading||r()})}),el.IncrementalLoading&&r()},s)},s)}async loadAsync(e,t,i,r){return await new Promise((n,s)=>{this._loadAsync(e,t,i,()=>{n()},r,e=>{s(Error(e))})})}_loadShadersAsync(e,t){let i=!1,r=(i,r)=>{eK.LoadShaderStringAsync(e,i,n=>{n instanceof ArrayBuffer||(e.loadedShaderCount++,n&&(ed.M.ShadersStore[i+(r.type===y.VERTEX?"VertexShader":"PixelShader")]=n),e.loadedShaderCount===e.shaderscount&&t())},()=>{D.S0.Error("Error when loading shader program named "+i+" located at "+r.uri)})};for(let t in e.shaders){i=!0;let n=e.shaders[t];n?r.bind(this,t,n)():D.S0.Error("No shader named: "+t)}i||t()}_loadBuffersAsync(e,t){let i=!1,r=(i,r)=>{eK.LoadBufferAsync(e,i,n=>{e.loadedBufferCount++,n&&(n.byteLength!=e.buffers[i].byteLength&&D.S0.Error("Buffer named "+i+" is length "+n.byteLength+". Expected: "+r.byteLength),e.loadedBufferViews[i]=n),e.loadedBufferCount===e.buffersCount&&t()},()=>{D.S0.Error("Error when loading buffer named "+i+" located at "+r.uri)})};for(let t in e.buffers){i=!0;let n=e.buffers[t];n?r.bind(this,t,n)():D.S0.Error("No buffer named: "+t)}i||t()}_createNodes(e){let t=e.currentScene;if(t)for(let i=0;i<t.nodes.length;i++)eW(e,t.nodes[i],null);else for(let i in e.scenes){t=e.scenes[i];for(let i=0;i<t.nodes.length;i++)eW(e,t.nodes[i],null)}}}eY.Extensions={};class eK{constructor(e){this._name=e}get name(){return this._name}loadRuntimeAsync(e,t,i,r,n){return!1}loadRuntimeExtensionsAsync(e,t,i){return!1}loadBufferAsync(e,t,i,r,n){return!1}loadTextureBufferAsync(e,t,i,r){return!1}createTextureAsync(e,t,i,r,n){return!1}loadShaderStringAsync(e,t,i,r){return!1}loadMaterialAsync(e,t,i,r){return!1}static LoadRuntimeAsync(e,t,i,r,n){eK._ApplyExtensions(s=>s.loadRuntimeAsync(e,t,i,r,n),()=>{setTimeout(()=>{r&&r(eZ.CreateRuntime(t.json,e,i))})})}static LoadRuntimeExtensionsAsync(e,t,i){eK._ApplyExtensions(r=>r.loadRuntimeExtensionsAsync(e,t,i),()=>{setTimeout(()=>{t()})})}static LoadBufferAsync(e,t,i,r,n){eK._ApplyExtensions(s=>s.loadBufferAsync(e,t,i,r,n),()=>{eZ.LoadBufferAsync(e,t,i,r,n)})}static LoadTextureAsync(e,t,i,r){eK._LoadTextureBufferAsync(e,t,n=>{n&&eK._CreateTextureAsync(e,t,n,i,r)},r)}static LoadShaderStringAsync(e,t,i,r){eK._ApplyExtensions(n=>n.loadShaderStringAsync(e,t,i,r),()=>{eZ.LoadShaderStringAsync(e,t,i,r)})}static LoadMaterialAsync(e,t,i,r){eK._ApplyExtensions(n=>n.loadMaterialAsync(e,t,i,r),()=>{eZ.LoadMaterialAsync(e,t,i,r)})}static _LoadTextureBufferAsync(e,t,i,r){eK._ApplyExtensions(n=>n.loadTextureBufferAsync(e,t,i,r),()=>{eZ.LoadTextureBufferAsync(e,t,i,r)})}static _CreateTextureAsync(e,t,i,r,n){eK._ApplyExtensions(s=>s.createTextureAsync(e,t,i,r,n),()=>{eZ.CreateTextureAsync(e,t,i,r)})}static _ApplyExtensions(e,t){for(let t in eY.Extensions)if(e(eY.Extensions[t]))return;t()}}el._CreateGLTF1Loader=()=>new eY;class eQ extends eK{constructor(){super("KHR_binary_glTF")}loadRuntimeAsync(e,t,i,r){let n=t.json.extensionsUsed;return!!n&&-1!==n.indexOf(this.name)&&!!t.bin&&(this._bin=t.bin,r(eZ.CreateRuntime(t.json,e,i)),!0)}loadBufferAsync(e,t,i,r){return -1!==e.extensionsUsed.indexOf(this.name)&&"binary_glTF"===t&&(this._bin.readAsync(0,this._bin.byteLength).then(i,e=>r(e.message)),!0)}loadTextureBufferAsync(e,t,i){let r=e.textures[t],n=e.images[r.source];if(!n.extensions||!(this.name in n.extensions))return!1;let s=n.extensions[this.name],a=e.bufferViews[s.bufferView];return i(eP.GetBufferFromBufferView(e,a,0,a.byteLength,b.UNSIGNED_BYTE)),!0}loadShaderStringAsync(e,t,i){let r=e.shaders[t];if(!r.extensions||!(this.name in r.extensions))return!1;let n=r.extensions[this.name],s=e.bufferViews[n.bufferView],a=eP.GetBufferFromBufferView(e,s,0,s.byteLength,b.UNSIGNED_BYTE);return setTimeout(()=>{i(eP.DecodeBufferToText(a))}),!0}}eY.RegisterExtension(new eQ);class eJ extends eK{constructor(){super("KHR_materials_common")}loadRuntimeExtensionsAsync(e){if(!e.extensions)return!1;let t=e.extensions[this.name];if(!t)return!1;let i=t.lights;if(i)for(let t in i){let r=i[t];switch(r.type){case"ambient":{let t=new eS.g(r.name,new w.Pq(0,1,0),e.scene),i=r.ambient;i&&(t.diffuse=eu.v9.FromArray(i.color||[1,1,1]));break}case"point":{let t=new eI.H(r.name,new w.Pq(10,10,10),e.scene),i=r.point;i&&(t.diffuse=eu.v9.FromArray(i.color||[1,1,1]));break}case"directional":{let t=new eE.Z(r.name,new w.Pq(0,-1,0),e.scene),i=r.directional;i&&(t.diffuse=eu.v9.FromArray(i.color||[1,1,1]));break}case"spot":{let t=r.spot;t&&(new eR.n(r.name,new w.Pq(0,10,0),new w.Pq(0,-1,0),t.fallOffAngle||Math.PI,t.fallOffExponent||0,e.scene).diffuse=eu.v9.FromArray(t.color||[1,1,1]));break}default:D.S0.Warn('GLTF Material Common extension: light type "'+r.type+"” not supported")}}return!1}loadMaterialAsync(e,t,i,r){let n=e.materials[t];if(!n||!n.extensions)return!1;let s=n.extensions[this.name];if(!s)return!1;let a=new e_.F(t,e.scene);return a.sideOrientation=ep.i.CounterClockWiseSideOrientation,"CONSTANT"===s.technique&&(a.disableLighting=!0),a.backFaceCulling=void 0!==s.doubleSided&&!s.doubleSided,a.alpha=void 0===s.values.transparency?1:s.values.transparency,a.specularPower=void 0===s.values.shininess?0:s.values.shininess,"string"==typeof s.values.ambient?this._loadTexture(e,s.values.ambient,a,"ambientTexture",r):a.ambientColor=eu.v9.FromArray(s.values.ambient||[0,0,0]),"string"==typeof s.values.diffuse?this._loadTexture(e,s.values.diffuse,a,"diffuseTexture",r):a.diffuseColor=eu.v9.FromArray(s.values.diffuse||[0,0,0]),"string"==typeof s.values.emission?this._loadTexture(e,s.values.emission,a,"emissiveTexture",r):a.emissiveColor=eu.v9.FromArray(s.values.emission||[0,0,0]),"string"==typeof s.values.specular?this._loadTexture(e,s.values.specular,a,"specularTexture",r):a.specularColor=eu.v9.FromArray(s.values.specular||[0,0,0]),!0}_loadTexture(e,t,i,r,n){eZ.LoadTextureBufferAsync(e,t,n=>{eZ.CreateTextureAsync(e,t,n,e=>i[r]=e)},n)}}eY.RegisterExtension(new eJ);var e0=i(53027),e1=i(60871),e2=i(75103),e3=i(71572),e4=i(53956);let e5=new Map,e6=e5;function e8(e,t,i){e9(e)&&X.V.Warn(`Extension with the name '${e}' already exists`),e5.set(e,{isGLTFExtension:t,factory:i})}function e9(e){return e5.delete(e)}var e7=i(67396),te=i(18652),tt=i(33914),ti=i(43274);let tr=new ti.d(()=>Promise.resolve().then(i.bind(i,65748))),tn=new ti.d(()=>Promise.resolve().then(i.bind(i,4347)));class ts{static Get(e,t,i){if(!t||void 0==i||!t[i])throw Error(`${e}: Failed to find index (${i})`);return t[i]}static TryGet(e,t){return e&&void 0!=t&&e[t]?e[t]:null}static Assign(e){if(e)for(let t=0;t<e.length;t++)e[t].index=t}}function ta(e){if(e.min&&e.max){let t=e.min,i=e.max,r=w.AA.Vector3["0"].copyFromFloats(t[0],t[1],t[2]),n=w.AA.Vector3["1"].copyFromFloats(i[0],i[1],i[2]);if(e.normalized&&5126!==e.componentType){let t=1;switch(e.componentType){case 5120:t=127;break;case 5121:t=255;break;case 5122:t=32767;break;case 5123:t=65535}let i=1/t;r.scaleInPlace(i),n.scaleInPlace(i)}return new e4.j(r,n)}return null}class to{static RegisterExtension(e,t){e8(e,!1,t)}static UnregisterExtension(e){return e9(e)}get gltf(){if(!this._gltf)throw Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(e){this._completePromises=[],this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=[],this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=[],this._materialAdapterCache=new WeakMap,this._pbrMaterialImpl=null,this._parent=e}_getOrCreateMaterialAdapter(e){let t=this._materialAdapterCache.get(e);if(!t){if(this._pbrMaterialImpl)t=new this._pbrMaterialImpl.adapterClass(e);else throw Error("Appropriate material adapter class not found");this._materialAdapterCache.set(e,t)}return t}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach(e=>e.dispose&&e.dispose()),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(e,t,i,r,n,s,a=""){return await Promise.resolve().then(async()=>{this._babylonScene=t,this._assetContainer=i,this._loadData(r);let s=null;if(e){let t={};if(this._gltf.nodes)for(let e of this._gltf.nodes)e.name&&(t[e.name]=e.index);s=(e instanceof Array?e:[e]).map(e=>{let i=t[e];if(void 0===i)throw Error(`Failed to find node '${e}'`);return i})}return await this._loadAsync(n,a,s,()=>({meshes:this._getMeshes(),particleSystems:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]}))})}async loadAsync(e,t,i,r,n=""){return this._babylonScene=e,this._loadData(t),await this._loadAsync(i,n,null,()=>void 0)}async _loadAsync(e,t,r,n){return await Promise.resolve().then(async()=>{this._rootUrl=e,this._uniqueRootUrl=!e.startsWith("file:")&&t?e:`${e}${Date.now()}/`,this._fileName=t,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync(),this.parent.skipMaterials||null!=this._pbrMaterialImpl||(this.parent.useOpenPBR||this.isExtensionUsed("KHR_materials_openpbr")?this._pbrMaterialImpl={materialClass:(await i.e("5875").then(i.bind(i,69822))).OpenPBRMaterial,adapterClass:(await Promise.resolve().then(i.bind(i,97241))).OpenPBRMaterialLoadingAdapter}:this._pbrMaterialImpl={materialClass:(await Promise.resolve().then(i.bind(i,85822))).PBRMaterial,adapterClass:(await Promise.resolve().then(i.bind(i,91737))).PBRMaterialLoadingAdapter});let s=`${g[g.LOADING]} => ${g[g.READY]}`,a=`${g[g.LOADING]} => ${g[g.COMPLETE]}`;this._parent._startPerformanceCounter(s),this._parent._startPerformanceCounter(a),this._parent._setState(g.LOADING),this._extensionsOnLoading();let o=[],l=this._babylonScene.blockMaterialDirtyMechanism;if(this._babylonScene.blockMaterialDirtyMechanism=!0,!this.parent.loadOnlyMaterials){if(r)o.push(this.loadSceneAsync("/nodes",{nodes:r,index:-1}));else if(void 0!=this._gltf.scene||this._gltf.scenes&&this._gltf.scenes[0]){let e=ts.Get("/scene",this._gltf.scenes,this._gltf.scene||0);o.push(this.loadSceneAsync(`/scenes/${e.index}`,e))}}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let e=0;e<this._gltf.materials.length;++e){let t=this._gltf.materials[e],i="/materials/"+e,r=ep.i.TriangleFillMode;o.push(this._loadMaterialAsync(i,t,null,r,()=>{}))}this._allMaterialsDirtyRequired?this._babylonScene.blockMaterialDirtyMechanism=l:this._babylonScene._forceBlockMaterialDirtyMechanism(l),this._parent.compileMaterials&&o.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&o.push(this._compileShadowGeneratorsAsync());let u=Promise.all(o).then(()=>{for(let e of(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.setEnabled(!0),this._babylonScene.materials))void 0!==e.maxSimultaneousLights&&(e.maxSimultaneousLights=Math.max(e.maxSimultaneousLights,this._babylonScene.lights.length));return this._extensionsOnReady(),this._parent._setState(g.READY),this._skipStartAnimationStep||this._startAnimations(),n()});return await u.then(e=>(this._parent._endPerformanceCounter(s),D.S0.SetImmediate(()=>{this._disposed||Promise.all(this._completePromises).then(()=>{this._parent._endPerformanceCounter(a),this._parent._setState(g.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()},e=>{this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()})}),e))}).catch(e=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()),e})}_loadData(e){if(this._gltf=e.json,this._setupData(),e.bin){let t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){let i=t[0];(i.byteLength<e.bin.byteLength-3||i.byteLength>e.bin.byteLength)&&X.V.Warn(`Binary buffer length (${i.byteLength}) from JSON does not match chunk length (${e.bin.byteLength})`),this._bin=e.bin}else X.V.Warn("Unexpected BIN chunk")}}_setupData(){if(ts.Assign(this._gltf.accessors),ts.Assign(this._gltf.animations),ts.Assign(this._gltf.buffers),ts.Assign(this._gltf.bufferViews),ts.Assign(this._gltf.cameras),ts.Assign(this._gltf.images),ts.Assign(this._gltf.materials),ts.Assign(this._gltf.meshes),ts.Assign(this._gltf.nodes),ts.Assign(this._gltf.samplers),ts.Assign(this._gltf.scenes),ts.Assign(this._gltf.skins),ts.Assign(this._gltf.textures),this._gltf.nodes){let e={};for(let t of this._gltf.nodes)if(t.children)for(let i of t.children)e[i]=t.index;let t=this._createRootNode();for(let i of this._gltf.nodes){let r=e[i.index];i.parent=void 0===r?t:this._gltf.nodes[r]}}}async _loadExtensionsAsync(){let e=[];if(e6.forEach((t,i)=>{this.parent.extensionOptions[i]?.enabled===!1?t.isGLTFExtension&&this.isExtensionUsed(i)&&X.V.Warn(`Extension ${i} is used but has been explicitly disabled.`):(!t.isGLTFExtension||this.isExtensionUsed(i))&&e.push((async()=>{let e=await t.factory(this);return e.name!==i&&X.V.Warn(`The name of the glTF loader extension instance does not match the registered name: ${e.name} !== ${i}`),this._parent.onExtensionLoadedObservable.notifyObservers(e),e})())}),this._extensions.push(...await Promise.all(e)),this._extensions.sort((e,t)=>(e.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE)),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired){for(let e of this._gltf.extensionsRequired)if(!this._extensions.some(t=>t.name===e&&t.enabled)){if(this.parent.extensionOptions[e]?.enabled===!1)throw Error(`Required extension ${e} is disabled`);throw Error(`Required extension ${e} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;let e=new eA.e("__root__",this._babylonScene);this._rootBabylonMesh=e,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);let t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case _.AUTO:this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],to._LoadTransform(t,this._rootBabylonMesh));break;case _.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(e),t}loadSceneAsync(e,t){let i=this._extensionsLoadSceneAsync(e,t);if(i)return i;let r=[];if(this.logOpen(`${e} ${t.name||""}`),t.nodes)for(let i of t.nodes){let t=ts.Get(`${e}/nodes/${i}`,this._gltf.nodes,i);r.push(this.loadNodeAsync(`/nodes/${t.index}`,t,e=>{e.parent=this._rootBabylonMesh}))}for(let e of this._postSceneLoadActions)e();return r.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(r).then(()=>{})}_forEachPrimitive(e,t){if(e._primitiveBabylonMeshes)for(let i of e._primitiveBabylonMeshes)t(i)}_getGeometries(){let e=[],t=this._gltf.nodes;if(t)for(let i of t)this._forEachPrimitive(i,t=>{let i=t.geometry;i&&-1===e.indexOf(i)&&e.push(i)});return e}_getMeshes(){let e=[];this._rootBabylonMesh instanceof ev.u&&e.push(this._rootBabylonMesh);let t=this._gltf.nodes;if(t)for(let i of t)this._forEachPrimitive(i,t=>{e.push(t)});return e}_getTransformNodes(){let e=[],t=this._gltf.nodes;if(t)for(let i of t)i._babylonTransformNode&&"TransformNode"===i._babylonTransformNode.getClassName()&&e.push(i._babylonTransformNode),i._babylonTransformNodeForSkin&&e.push(i._babylonTransformNodeForSkin);return e}_getSkeletons(){let e=[],t=this._gltf.skins;if(t)for(let i of t)i._data&&e.push(i._data.babylonSkeleton);return e}_getAnimationGroups(){let e=[],t=this._gltf.animations;if(t)for(let i of t)i._babylonAnimationGroup&&e.push(i._babylonAnimationGroup);return e}_startAnimations(){switch(this._parent.animationStartMode){case m.NONE:break;case m.FIRST:{let e=this._getAnimationGroups();0!==e.length&&e[0].start(!0);break}case m.ALL:for(let e of this._getAnimationGroups())e.start(!0);break;default:return void X.V.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(e,t,i=()=>{}){let r=this._extensionsLoadNodeAsync(e,t,i);if(r)return r;if(t._babylonTransformNode)throw Error(`${e}: Invalid recursive node hierarchy`);let n=[];this.logOpen(`${e} ${t.name||""}`);let s=r=>{if(to.AddPointerMetadata(r,e),to._LoadTransform(t,r),void 0!=t.camera){let i=ts.Get(`${e}/camera`,this._gltf.cameras,t.camera);n.push(this.loadCameraAsync(`/cameras/${i.index}`,i,e=>{e.parent=r,this._babylonScene.useRightHandedSystem||(r.scaling.x=-1)}))}if(t.children)for(let i of t.children){let t=ts.Get(`${e}/children/${i}`,this._gltf.nodes,i);n.push(this.loadNodeAsync(`/nodes/${t.index}`,t,e=>{e.parent=r}))}i(r)},a=void 0!=t.mesh,o=this._parent.loadSkins&&void 0!=t.skin;if(!a||o){let e=t.name||`node${t.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;let i=new e1.V(e,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==t.mesh?t._babylonTransformNode=i:t._babylonTransformNodeForSkin=i,s(i)}if(a)if(o){let i=ts.Get(`${e}/mesh`,this._gltf.meshes,t.mesh);n.push(this._loadMeshAsync(`/meshes/${i.index}`,t,i,i=>{let r=t._babylonTransformNodeForSkin;i.metadata=(0,te.$)(r.metadata,i.metadata||{});let s=ts.Get(`${e}/skin`,this._gltf.skins,t.skin);n.push(this._loadSkinAsync(`/skins/${s.index}`,t,s,e=>{this._forEachPrimitive(t,t=>{t.skeleton=e}),this._postSceneLoadActions.push(()=>{if(void 0!=s.skeleton){let e=ts.Get(`/skins/${s.index}/skeleton`,this._gltf.nodes,s.skeleton).parent;t.index===e.index?i.parent=r.parent:i.parent=e._babylonTransformNode}else i.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:r,skinnedNode:i})})}))}))}else{let i=ts.Get(`${e}/mesh`,this._gltf.meshes,t.mesh);n.push(this._loadMeshAsync(`/meshes/${i.index}`,t,i,s))}return this.logClose(),Promise.all(n).then(()=>(this._forEachPrimitive(t,e=>{!e.isAnInstance&&e.geometry&&e.geometry.useBoundingInfoFromGeometry?e._updateBoundingInfo():e.refreshBoundingInfo(!0,!0)}),t._babylonTransformNode))}_loadMeshAsync(e,t,i,r){let n=i.primitives;if(!n||!n.length)throw Error(`${e}: Primitives are missing`);void 0==n[0].index&&ts.Assign(n);let s=[];this.logOpen(`${e} ${i.name||""}`);let a=t.name||`node${t.index}`;if(1===n.length){let r=i.primitives[0];s.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${r.index}`,a,t,i,r,e=>{t._babylonTransformNode=e,t._primitiveBabylonMeshes=[e]}))}else for(let r of(this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new e1.V(a,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[],n))s.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${r.index}`,`${a}_primitive${r.index}`,t,i,r,e=>{e.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(e)}));return r(t._babylonTransformNode),this.logClose(),Promise.all(s).then(()=>t._babylonTransformNode)}_loadMeshPrimitiveAsync(e,t,i,r,n,s){let a,o,l=this._extensionsLoadMeshPrimitiveAsync(e,t,i,r,n,s);if(l)return l;this.logOpen(`${e}`);let u=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==i.skin&&!r.primitives[0].targets;if(u&&n._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,(a=n._instanceData.babylonSourceMesh.createInstance(t))._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o=n._instanceData.promise;else{let s=[];this._babylonScene._blockEntityCollection=!!this._assetContainer;let l=new eA.e(t,this._babylonScene);if(l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.sideOrientation=this._babylonScene.useRightHandedSystem?ep.i.CounterClockWiseSideOrientation:ep.i.ClockWiseSideOrientation,this._createMorphTargets(e,i,r,n,l),s.push(this._loadVertexDataAsync(e,n,l).then(async t=>await this._loadMorphTargetsAsync(e,n,l,t).then(()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,t.applyToMesh(l),t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)}))),!this.parent.skipMaterials){let t=to._GetDrawMode(e,n.mode);if(void 0==n.material){let e=this._defaultBabylonMaterialData[t];e||(e=this._createDefaultMaterial("__GLTFLoader._default",t),this._parent.onMaterialLoadedObservable.notifyObservers(e),this._defaultBabylonMaterialData[t]=e),l.material=e}else{let i=ts.Get(`${e}/material`,this._gltf.materials,n.material);s.push(this._loadMaterialAsync(`/materials/${i.index}`,i,l,t,e=>{l.material=e}))}}o=Promise.all(s),u&&(n._instanceData={babylonSourceMesh:l,promise:o}),a=l}return to.AddPointerMetadata(a,e),this._parent.onMeshLoadedObservable.notifyObservers(a),s(a),this.logClose(),o.then(()=>a)}_loadVertexDataAsync(e,t,i){let r=this._extensionsLoadVertexDataAsync(e,t,i);if(r)return r;let n=t.attributes;if(!n)throw Error(`${e}: Attributes are missing`);let s=[],a=new ex.V(i.name,this._babylonScene);if(void 0==t.indices)i.isUnIndexed=!0;else{let i=ts.Get(`${e}/indices`,this._gltf.accessors,t.indices);s.push(this._loadIndicesAccessorAsync(`/accessors/${i.index}`,i).then(e=>{a.setIndices(e)}))}let o=(t,r,o)=>{if(void 0==n[t])return;i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(r)&&i._delayInfo.push(r);let l=ts.Get(`${e}/attributes/${t}`,this._gltf.accessors,n[t]);s.push(this._loadVertexAccessorAsync(`/accessors/${l.index}`,l,r).then(e=>{if(e.getKind()===ey.R.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!i.skeleton){let e=ta(l);e&&(a._boundingInfo=e,a.useBoundingInfoFromGeometry=!0)}a.setVerticesBuffer(e,l.count)})),r==ey.R.MatricesIndicesExtraKind&&(i.numBoneInfluencers=8),o&&o(l)};return o("POSITION",ey.R.PositionKind),o("NORMAL",ey.R.NormalKind),o("TANGENT",ey.R.TangentKind),o("TEXCOORD_0",ey.R.UVKind),o("TEXCOORD_1",ey.R.UV2Kind),o("TEXCOORD_2",ey.R.UV3Kind),o("TEXCOORD_3",ey.R.UV4Kind),o("TEXCOORD_4",ey.R.UV5Kind),o("TEXCOORD_5",ey.R.UV6Kind),o("JOINTS_0",ey.R.MatricesIndicesKind),o("WEIGHTS_0",ey.R.MatricesWeightsKind),o("JOINTS_1",ey.R.MatricesIndicesExtraKind),o("WEIGHTS_1",ey.R.MatricesWeightsExtraKind),o("COLOR_0",ey.R.ColorKind,e=>{"VEC4"===e.type&&(i.hasVertexAlpha=!0)}),Promise.all(s).then(()=>a)}_createMorphTargets(e,t,i,r,n){if(!r.targets||!this._parent.loadMorphTargets)return;if(void 0==t._numMorphTargets)t._numMorphTargets=r.targets.length;else if(r.targets.length!==t._numMorphTargets)throw Error(`${e}: Primitives do not have the same number of targets`);let s=i.extras?i.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,n.morphTargetManager=new e3.j(this._babylonScene),n.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.morphTargetManager.areUpdatesFrozen=!0;for(let e=0;e<r.targets.length;e++){let r=t.weights?t.weights[e]:i.weights?i.weights[e]:0,a=s?s[e]:`morphTarget${e}`;n.morphTargetManager.addTarget(new e2.M(a,r,n.getScene()))}}_loadMorphTargetsAsync(e,t,i,r){if(!t.targets||!this._parent.loadMorphTargets)return Promise.resolve();let n=[],s=i.morphTargetManager;for(let i=0;i<s.numTargets;i++){let a=s.getTarget(i);n.push(this._loadMorphTargetVertexDataAsync(`${e}/targets/${i}`,r,t.targets[i],a))}return Promise.all(n).then(()=>{s.areUpdatesFrozen=!1})}async _loadMorphTargetVertexDataAsync(e,t,i,r){let n=[],s=(r,s,a)=>{if(void 0==i[r])return;let o=t.getVertexBuffer(s);if(!o)return;let l=ts.Get(`${e}/${r}`,this._gltf.accessors,i[r]);n.push(this._loadFloatAccessorAsync(`/accessors/${l.index}`,l).then(e=>{a(o,e)}))};return s("POSITION",ey.R.PositionKind,(e,t)=>{let i=new Float32Array(t.length);e.forEach(t.length,(e,r)=>{i[r]=t[r]+e}),r.setPositions(i)}),s("NORMAL",ey.R.NormalKind,(e,t)=>{let i=new Float32Array(t.length);e.forEach(i.length,(e,r)=>{i[r]=t[r]+e}),r.setNormals(i)}),s("TANGENT",ey.R.TangentKind,(e,t)=>{let i=new Float32Array(t.length/3*4),n=0;e.forEach(t.length/3*4,(e,r)=>{(r+1)%4!=0&&(i[n]=t[n]+e,n++)}),r.setTangents(i)}),s("TEXCOORD_0",ey.R.UVKind,(e,t)=>{let i=new Float32Array(t.length);e.forEach(t.length,(e,r)=>{i[r]=t[r]+e}),r.setUVs(i)}),s("TEXCOORD_1",ey.R.UV2Kind,(e,t)=>{let i=new Float32Array(t.length);e.forEach(t.length,(e,r)=>{i[r]=t[r]+e}),r.setUV2s(i)}),s("COLOR_0",ey.R.ColorKind,(t,i)=>{let n=null,s=t.getSize();if(3===s){n=new Float32Array(i.length/3*4),t.forEach(i.length,(e,t)=>{let r=Math.floor(t/3),s=t%3;n[4*r+s]=i[3*r+s]+e});for(let e=0;e<i.length/3;++e)n[4*e+3]=1}else if(4===s)n=new Float32Array(i.length),t.forEach(i.length,(e,t)=>{n[t]=i[t]+e});else throw Error(`${e}: Invalid number of components (${s}) for COLOR_0 attribute`);r.setColors(n)}),await Promise.all(n).then(()=>{})}static _LoadTransform(e,t){if(void 0!=e.skin)return;let i=w.Pq.Zero(),r=w.PT.Identity(),n=w.Pq.One();e.matrix?w.uq.FromArray(e.matrix).decompose(n,r,i):(e.translation&&(i=w.Pq.FromArray(e.translation)),e.rotation&&(r=w.PT.FromArray(e.rotation)),e.scale&&(n=w.Pq.FromArray(e.scale))),t.position=i,t.rotationQuaternion=r,t.scaling=n}_loadSkinAsync(e,t,i,r){if(!this._parent.loadSkins)return Promise.resolve();let n=this._extensionsLoadSkinAsync(e,t,i);if(n)return n;if(i._data)return r(i._data.babylonSkeleton),i._data.promise;let s=`skeleton${i.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;let a=new O.E(i.name||s,s,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,i,a);let o=this._loadSkinInverseBindMatricesDataAsync(e,i).then(e=>{this._updateBoneMatrices(a,e)});return i._data={babylonSkeleton:a,promise:o},r(a),o}_loadBones(e,t,i){if(void 0==t.skeleton||this._parent.alwaysComputeSkeletonRootNode){let i=this._findSkeletonRootNode(`${e}/joints`,t.joints);if(i)if(void 0===t.skeleton)t.skeleton=i.index;else{let r=ts.Get(`${e}/skeleton`,this._gltf.nodes,t.skeleton);r===i||((e,t)=>{for(;t.parent;t=t.parent)if(t.parent===e)return!0;return!1})(r,i)||(X.V.Warn(`${e}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),t.skeleton=i.index)}else X.V.Warn(`${e}: Failed to find common root`)}let r={};for(let n of t.joints){let s=ts.Get(`${e}/joints/${n}`,this._gltf.nodes,n);this._loadBone(s,t,i,r)}}_findSkeletonRootNode(e,t){if(0===t.length)return null;let i={};for(let r of t){let t=[],n=ts.Get(`${e}/${r}`,this._gltf.nodes,r);for(;-1!==n.index;)t.unshift(n),n=n.parent;i[r]=t}let r=null;for(let e=0;;++e){let n=i[t[0]];if(e>=n.length)return r;let s=n[e];for(let a=1;a<t.length;++a)if(e>=(n=i[t[a]]).length||s!==n[e])return r;r=s}}_loadBone(e,t,i,r){e._isJoint=!0;let n=r[e.index];if(n)return n;let s=null;e.index!==t.skeleton&&(e.parent&&-1!==e.parent.index?s=this._loadBone(e.parent,t,i,r):void 0!==t.skeleton&&X.V.Warn(`/skins/${t.index}/skeleton: Skeleton node is not a common root`));let a=t.joints.indexOf(e.index);return n=new C.$(e.name||`joint${e.index}`,i,s,this._getNodeMatrix(e),null,null,a),r[e.index]=n,this._postSceneLoadActions.push(()=>{n.linkTransformNode(e._babylonTransformNode)}),n}_loadSkinInverseBindMatricesDataAsync(e,t){if(void 0==t.inverseBindMatrices)return Promise.resolve(null);let i=ts.Get(`${e}/inverseBindMatrices`,this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)}_updateBoneMatrices(e,t){for(let i of e.bones){let e=w.uq.Identity(),r=i._index;t&&-1!==r&&(w.uq.FromArrayToRef(t,16*r,e),e.invertToRef(e));let n=i.getParent();n&&e.multiplyToRef(n.getAbsoluteInverseBindMatrix(),e),i.updateMatrix(e,!1,!1),i._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(e){return e.matrix?w.uq.FromArray(e.matrix):w.uq.Compose(e.scale?w.Pq.FromArray(e.scale):w.Pq.One(),e.rotation?w.PT.FromArray(e.rotation):w.PT.Identity(),e.translation?w.Pq.FromArray(e.translation):w.Pq.Zero())}loadCameraAsync(e,t,i=()=>{}){let r=this._extensionsLoadCameraAsync(e,t,i);if(r)return r;this.logOpen(`${e} ${t.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;let n=new ec.S(t.name||`camera${t.index}`,w.Pq.Zero(),this._babylonScene,!1);switch(n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonCamera=n,n.setTarget(new w.Pq(0,0,-1)),t.type){case"perspective":{let i=t.perspective;if(!i)throw Error(`${e}: Camera perspective properties are missing`);n.fov=i.yfov,n.minZ=i.znear,n.maxZ=i.zfar||0;break}case"orthographic":if(!t.orthographic)throw Error(`${e}: Camera orthographic properties are missing`);n.mode=eh.i.ORTHOGRAPHIC_CAMERA,n.orthoLeft=-t.orthographic.xmag,n.orthoRight=t.orthographic.xmag,n.orthoBottom=-t.orthographic.ymag,n.orthoTop=t.orthographic.ymag,n.minZ=t.orthographic.znear,n.maxZ=t.orthographic.zfar;break;default:throw Error(`${e}: Invalid camera type (${t.type})`)}return to.AddPointerMetadata(n,e),this._parent.onCameraLoadedObservable.notifyObservers(n),i(n),this.logClose(),Promise.all([]).then(()=>n)}_loadAnimationsAsync(){this._parent._startPerformanceCounter("Load animations");let e=this._gltf.animations;if(!e)return Promise.resolve();let t=[];for(let i=0;i<e.length;i++){let r=e[i];t.push(this.loadAnimationAsync(`/animations/${r.index}`,r).then(e=>{0===e.targetedAnimations.length&&e.dispose()}))}return Promise.all(t).then(()=>{this._parent._endPerformanceCounter("Load animations")})}loadAnimationAsync(e,t){this._parent._startPerformanceCounter("Load animation");let i=this._extensionsLoadAnimationAsync(e,t);return i||tr.value.then(({AnimationGroup:i})=>{this._babylonScene._blockEntityCollection=!!this._assetContainer;let r=new i(t.name||`animation${t.index}`,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=r;let n=[];for(let i of(ts.Assign(t.channels),ts.Assign(t.samplers),t.channels))n.push(this._loadAnimationChannelAsync(`${e}/channels/${i.index}`,e,t,i,(e,t)=>{e.animations=e.animations||[],e.animations.push(t),r.addTargetedAnimation(t,e)}));return this._parent._endPerformanceCounter("Load animation"),Promise.all(n).then(()=>(r.normalize(0),r))})}_loadAnimationChannelAsync(e,t,i,r,n){let s=this._extensionsLoadAnimationChannelAsync(e,t,i,r,n);if(s)return s;if(void 0==r.target.node)return Promise.resolve();let a=ts.Get(`${e}/target/node`,this._gltf.nodes,r.target.node),o=r.target.path,l="weights"===o;return(!l||a._numMorphTargets)&&(l||a._babylonTransformNode)&&(this._parent.loadNodeAnimations||l||a._isJoint)?tn.value.then(()=>{let s;switch(o){case"translation":s=(0,e7.tQ)("/nodes/{}/translation")?.interpolation;break;case"rotation":s=(0,e7.tQ)("/nodes/{}/rotation")?.interpolation;break;case"scale":s=(0,e7.tQ)("/nodes/{}/scale")?.interpolation;break;case"weights":s=(0,e7.tQ)("/nodes/{}/weights")?.interpolation;break;default:throw Error(`${e}/target/path: Invalid value (${r.target.path})`)}if(!s)throw Error(`${e}/target/path: Could not find interpolation properties for target path (${r.target.path})`);let l={object:a,info:s};return this._loadAnimationChannelFromTargetInfoAsync(e,t,i,r,l,n)}):Promise.resolve()}_loadAnimationChannelFromTargetInfoAsync(e,t,i,r,n,s){let a=this.parent.targetFps,o=1/a,l=ts.Get(`${e}/sampler`,i.samplers,r.sampler);return this._loadAnimationSamplerAsync(`${t}/samplers/${r.sampler}`,l).then(e=>{let t=0,l=n.object;for(let u of n.info){let n=u.getStride(l),h=e.input,c=e.output,d=Array(h.length),p=0;switch(e.interpolation){case"STEP":for(let e=0;e<h.length;e++){let t=u.getValue(l,c,p,1);p+=n,d[e]={frame:h[e]*a,value:t,interpolation:1}}break;case"CUBICSPLINE":for(let e=0;e<h.length;e++){let t=u.getValue(l,c,p,o);p+=n;let i=u.getValue(l,c,p,1);p+=n;let r=u.getValue(l,c,p,o);p+=n,d[e]={frame:h[e]*a,inTangent:t,value:i,outTangent:r}}break;case"LINEAR":for(let e=0;e<h.length;e++){let t=u.getValue(l,c,p,1);p+=n,d[e]={frame:h[e]*a,value:t}}}if(p>0){let e=`${i.name||`animation${i.index}`}_channel${r.index}_${t}`;for(let i of u.buildAnimations(l,e,a,d))t++,s(i.babylonAnimatable,i.babylonAnimation)}}})}_loadAnimationSamplerAsync(e,t){if(t._data)return t._data;let i=t.interpolation||"LINEAR";switch(i){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw Error(`${e}/interpolation: Invalid value (${t.interpolation})`)}let r=ts.Get(`${e}/input`,this._gltf.accessors,t.input),n=ts.Get(`${e}/output`,this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${r.index}`,r),this._loadFloatAccessorAsync(`/accessors/${n.index}`,n)]).then(([e,t])=>({input:e,interpolation:i,output:t})),t._data}loadBufferAsync(e,t,i,r){let n=this._extensionsLoadBufferAsync(e,t,i,r);if(n)return n;if(!t._data)if(t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{if(!this._bin)throw Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then(t=>{try{return new Uint8Array(t.buffer,t.byteOffset+i,r)}catch(t){throw Error(`${e}: ${t.message}`)}})}loadBufferViewAsync(e,t){let i=this._extensionsLoadBufferViewAsync(e,t);if(i)return i;if(t._data)return t._data;let r=ts.Get(`${e}/buffer`,this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync(`/buffers/${r.index}`,r,t.byteOffset||0,t.byteLength),t._data}_loadAccessorAsync(e,t,i){if(t._data)return t._data;let r=to._GetNumComponents(e,t.type),n=r*ey.R.GetTypeByteLength(t.componentType),s=r*t.count;if(void 0==t.bufferView)t._data=Promise.resolve(new i(s));else{let a=ts.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then(o=>{if(5126===t.componentType&&!t.normalized&&(!a.byteStride||a.byteStride===n))return to._GetTypedArray(e,t.componentType,o,t.byteOffset,s);{let e=new i(s);return ey.R.ForEach(o,t.byteOffset||0,a.byteStride||n,r,t.componentType,e.length,t.normalized||!1,(t,i)=>{e[i]=t}),e}})}if(t.sparse){let s=t.sparse;t._data=t._data.then(a=>{let o=ts.Get(`${e}/sparse/indices/bufferView`,this._gltf.bufferViews,s.indices.bufferView),l=ts.Get(`${e}/sparse/values/bufferView`,this._gltf.bufferViews,s.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${o.index}`,o),this.loadBufferViewAsync(`/bufferViews/${l.index}`,l)]).then(([o,l])=>{let u,h=to._GetTypedArray(`${e}/sparse/indices`,s.indices.componentType,o,s.indices.byteOffset,s.count),c=r*s.count;if(5126!==t.componentType||t.normalized){let a=to._GetTypedArray(`${e}/sparse/values`,t.componentType,l,s.values.byteOffset,c);u=new i(c),ey.R.ForEach(a,0,n,r,t.componentType,u.length,t.normalized||!1,(e,t)=>{u[t]=e})}else u=to._GetTypedArray(`${e}/sparse/values`,t.componentType,l,s.values.byteOffset,c);let d=0;for(let e=0;e<h.length;e++){let t=h[e]*r;for(let e=0;e<r;e++)a[t++]=u[d++]}return a})})}return t._data}_loadFloatAccessorAsync(e,t){return this._loadAccessorAsync(e,t,Float32Array)}_loadIndicesAccessorAsync(e,t){if("SCALAR"!==t.type)throw Error(`${e}/type: Invalid value ${t.type}`);if(5121!==t.componentType&&5123!==t.componentType&&5125!==t.componentType)throw Error(`${e}/componentType: Invalid value ${t.componentType}`);if(t._data)return t._data;if(t.sparse){let i=to._GetTypedArrayConstructor(`${e}/componentType`,t.componentType);t._data=this._loadAccessorAsync(e,t,i)}else{let i=ts.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then(i=>to._GetTypedArray(e,t.componentType,i,t.byteOffset,t.count))}return t._data}_loadVertexBufferViewAsync(e){if(e._babylonBuffer)return e._babylonBuffer;let t=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then(e=>new ey.h(t,e,!1)),e._babylonBuffer}_loadVertexAccessorAsync(e,t,i){if(t._babylonVertexBuffer?.[i])return t._babylonVertexBuffer[i];t._babylonVertexBuffer||(t._babylonVertexBuffer={});let r=this._babylonScene.getEngine();if(t.sparse||void 0==t.bufferView)t._babylonVertexBuffer[i]=this._loadFloatAccessorAsync(e,t).then(e=>new ey.R(r,e,i,!1));else{let n=ts.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._babylonVertexBuffer[i]=this._loadVertexBufferViewAsync(n).then(s=>{let a=to._GetNumComponents(e,t.type);return new ey.R(r,s,i,!1,void 0,n.byteStride,void 0,t.byteOffset,a,t.componentType,t.normalized,!0,void 0,!0)})}return t._babylonVertexBuffer[i]}_loadMaterialMetallicRoughnessPropertiesAsync(e,t,i){let r=[],n=this._getOrCreateMaterialAdapter(i);return t&&(t.baseColorFactor?(n.baseColor=eu.v9.FromArray(t.baseColorFactor),n.geometryOpacity=t.baseColorFactor[3]):n.baseColor=eu.v9.White(),n.baseMetalness=void 0==t.metallicFactor?1:t.metallicFactor,n.specularRoughness=void 0==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&r.push(this.loadTextureInfoAsync(`${e}/baseColorTexture`,t.baseColorTexture,e=>{e.name=`${i.name} (Base Color)`,n.baseColorTexture=e})),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,r.push(this.loadTextureInfoAsync(`${e}/metallicRoughnessTexture`,t.metallicRoughnessTexture,e=>{e.name=`${i.name} (Metallic Roughness)`,n.baseMetalnessTexture=e,n.specularRoughnessTexture=e})),n.useRoughnessFromMetallicTextureGreen=!0,n.useMetallicFromMetallicTextureBlue=!0)),Promise.all(r).then(()=>{})}_loadMaterialAsync(e,t,i,r,n=()=>{}){let s=this._extensionsLoadMaterialAsync(e,t,i,r,n);if(s)return s;t._data=t._data||{};let a=t._data[r];if(!a){this.logOpen(`${e} ${t.name||""}`);let i=this.createMaterial(e,t,r);a={babylonMaterial:i,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(e,t,i)},t._data[r]=a,to.AddPointerMetadata(i,e),this._parent.onMaterialLoadedObservable.notifyObservers(i),this.logClose()}return i&&(a.babylonMeshes.push(i),i.onDisposeObservable.addOnce(()=>{let e=a.babylonMeshes.indexOf(i);-1!==e&&a.babylonMeshes.splice(e,1)})),n(a.babylonMaterial),a.promise.then(()=>a.babylonMaterial)}_createDefaultMaterial(e,t){if(!this._pbrMaterialImpl)throw Error("PBR Material class not loaded");this._babylonScene._blockEntityCollection=!!this._assetContainer;let i=new this._pbrMaterialImpl.materialClass(e,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.fillMode=t,i.transparencyMode=this._pbrMaterialImpl.materialClass.MATERIAL_OPAQUE;let r=this._getOrCreateMaterialAdapter(i);return r.transparencyAsAlphaCoverage=this._parent.transparencyAsCoverage,r.baseMetalness=1,r.specularRoughness=1,i}createMaterial(e,t,i){let r=this._extensionsCreateMaterial(e,t,i);if(r)return r;let n=t.name||`material${t.index}`;return this._createDefaultMaterial(n,i)}loadMaterialPropertiesAsync(e,t,i){let r=this._extensionsLoadMaterialPropertiesAsync(e,t,i);if(r)return r;let n=[];return n.push(this.loadMaterialBasePropertiesAsync(e,t,i)),t.pbrMetallicRoughness&&n.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${e}/pbrMetallicRoughness`,t.pbrMetallicRoughness,i)),this.loadMaterialAlphaProperties(e,t,i),Promise.all(n).then(()=>{})}loadMaterialBasePropertiesAsync(e,t,i){let r,n,s=[],a=this._getOrCreateMaterialAdapter(i);a.emissionColor=t.emissiveFactor?eu.v9.FromArray(t.emissiveFactor):new eu.v9(0,0,0),t.doubleSided&&(a.backFaceCulling=!1,a.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${e}/normalTexture`,t.normalTexture,e=>{e.name=`${i.name} (Normal)`,a.geometryNormalTexture=e,t.normalTexture?.scale!=void 0&&(e.level=t.normalTexture.scale)})),a.setNormalMapInversions(!this._babylonScene.useRightHandedSystem,this._babylonScene.useRightHandedSystem));let o=1;return t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${e}/occlusionTexture`,t.occlusionTexture,e=>{e.name=`${i.name} (Occlusion)`,r=e})),void 0!=t.occlusionTexture.strength&&(o=t.occlusionTexture.strength)),t.emissiveTexture&&s.push(this.loadTextureInfoAsync(`${e}/emissiveTexture`,t.emissiveTexture,e=>{e.name=`${i.name} (Emissive)`,n=e})),Promise.all(s).then(()=>{r&&(a.ambientOcclusionTexture=r,a.ambientOcclusionTextureStrength=o),n&&(a.emissionColorTexture=n)})}loadMaterialAlphaProperties(e,t,i){if(!this._pbrMaterialImpl)throw Error(`${e}: Material type not supported`);let r=this._getOrCreateMaterialAdapter(i),n=r.baseColorTexture;switch(t.alphaMode||"OPAQUE"){case"OPAQUE":i.transparencyMode=this._pbrMaterialImpl.materialClass.MATERIAL_OPAQUE,i.alpha=1;break;case"MASK":i.transparencyMode=this._pbrMaterialImpl.materialClass.MATERIAL_ALPHATEST,r.alphaCutOff=void 0==t.alphaCutoff?.5:t.alphaCutoff,n&&(n.hasAlpha=!0);break;case"BLEND":i.transparencyMode=this._pbrMaterialImpl.materialClass.MATERIAL_ALPHABLEND,n&&(n.hasAlpha=!0,r.useAlphaFromBaseColorTexture=!0);break;default:throw Error(`${e}/alphaMode: Invalid value (${t.alphaMode})`)}}loadTextureInfoAsync(e,t,i=()=>{}){let r=this._extensionsLoadTextureInfoAsync(e,t,i);if(r)return r;if(this.logOpen(`${e}`),t.texCoord>=6)throw Error(`${e}/texCoord: Invalid value (${t.texCoord})`);let n=ts.Get(`${e}/index`,this._gltf.textures,t.index);n._textureInfo=t;let s=this._loadTextureAsync(`/textures/${t.index}`,n,r=>{r.coordinatesIndex=t.texCoord||0,to.AddPointerMetadata(r,e),this._parent.onTextureLoadedObservable.notifyObservers(r),i(r)});return this.logClose(),s}_loadTextureAsync(e,t,i=()=>{}){let r=this._extensionsLoadTextureAsync(e,t,i);if(r)return r;this.logOpen(`${e} ${t.name||""}`);let n=void 0==t.sampler?to.DefaultSampler:ts.Get(`${e}/sampler`,this._gltf.samplers,t.sampler),s=ts.Get(`${e}/source`,this._gltf.images,t.source),a=this._createTextureAsync(e,n,s,i,void 0,!t._textureInfo.nonColorData);return this.logClose(),a}_createTextureAsync(e,t,i,r=()=>{},n,s){let a=this._loadSampler(`/samplers/${t.index}`,t),o=[],l=new e0.c;this._babylonScene._blockEntityCollection=!!this._assetContainer;let u={noMipmap:a.noMipMaps,invertY:!1,samplingMode:a.samplingMode,onLoad:()=>{this._disposed||l.resolve()},onError:(t,i)=>{this._disposed||l.reject(Error(`${e}: ${i&&i.message?i.message:t||"Failed to load texture"}`))},mimeType:i.mimeType??(0,ei.ny)(i.uri??""),loaderOptions:n,useSRGBBuffer:!!s&&this._parent.useSRGBBuffers},h=new eg.g(null,this._babylonScene,u);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.push(l.promise),o.push(this.loadImageAsync(`/images/${i.index}`,i).then(e=>{let t=i.uri||`${this._fileName}#image${i.index}`,r=`data:${this._uniqueRootUrl}${t}`;h.updateURL(r,e);let n=h.getInternalTexture();n&&(n.label=i.name)})),h.wrapU=a.wrapU,h.wrapV=a.wrapV,r(h),this._parent.useGltfTextureNames&&(h.name=i.name||i.uri||`image${i.index}`),Promise.all(o).then(()=>h)}_loadSampler(e,t){return t._data||(t._data={noMipMaps:9728===t.minFilter||9729===t.minFilter,samplingMode:to._GetTextureSamplingMode(e,t),wrapU:to._GetTextureWrapMode(`${e}/wrapS`,t.wrapS),wrapV:to._GetTextureWrapMode(`${e}/wrapT`,t.wrapT)}),t._data}loadImageAsync(e,t){if(!t._data){if(this.logOpen(`${e} ${t.name||""}`),t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{let i=ts.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i)}this.logClose()}return t._data}loadUriAsync(e,t,i){let r=this._extensionsLoadUriAsync(e,t,i);if(r)return r;if(!to._ValidateUri(i))throw Error(`${e}: '${i}' is invalid`);if((0,ei.f2)(i)){let t=new Uint8Array((0,ei.rz)(i));return this.log(`${e}: Decoded ${i.substring(0,64)}... (${t.length} bytes)`),Promise.resolve(t)}return this.log(`${e}: Loading ${i}`),this._parent.preprocessUrlAsync(this._rootUrl+i).then(t=>new Promise((r,n)=>{this._parent._loadFile(this._babylonScene,t,t=>{this._disposed||(this.log(`${e}: Loaded ${i} (${t.byteLength} bytes)`),r(new Uint8Array(t)))},!0,t=>{n(new ei.hX(`${e}: Failed to load '${i}'${t?": "+t.status+" "+t.statusText:""}`,t))})}))}static AddPointerMetadata(e,t){e.metadata=e.metadata||{};let i=e._internalMetadata=e._internalMetadata||{},r=i.gltf=i.gltf||{};(r.pointers=r.pointers||[]).push(t)}static _GetTextureWrapMode(e,t){switch(t=void 0==t?10497:t){case 33071:return eg.g.CLAMP_ADDRESSMODE;case 33648:return eg.g.MIRROR_ADDRESSMODE;case 10497:return eg.g.WRAP_ADDRESSMODE;default:return X.V.Warn(`${e}: Invalid value (${t})`),eg.g.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(e,t){let i=void 0==t.magFilter?9729:t.magFilter,r=void 0==t.minFilter?9987:t.minFilter;if(9729===i)switch(r){case 9728:return eg.g.LINEAR_NEAREST;case 9729:return eg.g.LINEAR_LINEAR;case 9984:return eg.g.LINEAR_NEAREST_MIPNEAREST;case 9985:return eg.g.LINEAR_LINEAR_MIPNEAREST;case 9986:return eg.g.LINEAR_NEAREST_MIPLINEAR;case 9987:return eg.g.LINEAR_LINEAR_MIPLINEAR;default:return X.V.Warn(`${e}/minFilter: Invalid value (${r})`),eg.g.LINEAR_LINEAR_MIPLINEAR}switch(9728!==i&&X.V.Warn(`${e}/magFilter: Invalid value (${i})`),r){case 9728:return eg.g.NEAREST_NEAREST;case 9729:return eg.g.NEAREST_LINEAR;case 9984:return eg.g.NEAREST_NEAREST_MIPNEAREST;case 9985:return eg.g.NEAREST_LINEAR_MIPNEAREST;case 9986:return eg.g.NEAREST_NEAREST_MIPLINEAR;case 9987:return eg.g.NEAREST_LINEAR_MIPLINEAR;default:return X.V.Warn(`${e}/minFilter: Invalid value (${r})`),eg.g.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(e,t){try{return(0,tt.w)(t)}catch(t){throw Error(`${e}: ${t.message}`)}}static _GetTypedArray(e,t,i,r,n){let s=i.buffer;r=i.byteOffset+(r||0);let a=to._GetTypedArrayConstructor(`${e}/componentType`,t),o=ey.R.GetTypeByteLength(t);return r%o!=0?(X.V.Warn(`${e}: Copying buffer as byte offset (${r}) is not a multiple of component type byte length (${o})`),new a(s.slice(r,r+n*o),0)):new a(s,r,n)}static _GetNumComponents(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw Error(`${e}: Invalid type (${t})`)}static _ValidateUri(e){return D.S0.IsBase64(e)||-1===e.indexOf("..")}static _GetDrawMode(e,t){switch(void 0==t&&(t=4),t){case 0:return ep.i.PointListDrawMode;case 1:return ep.i.LineListDrawMode;case 2:return ep.i.LineLoopDrawMode;case 3:return ep.i.LineStripDrawMode;case 4:return ep.i.TriangleFillMode;case 5:return ep.i.TriangleStripDrawMode;case 6:return ep.i.TriangleFanDrawMode}throw Error(`${e}: Invalid mesh primitive mode (${t})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");let e=[];if(this._gltf.materials){for(let t of this._gltf.materials)if(t._data)for(let i in t._data){let r=t._data[i];for(let t of r.babylonMeshes){t.computeWorldMatrix(!0);let i=r.babylonMaterial;e.push(i.forceCompilationAsync(t)),e.push(i.forceCompilationAsync(t,{useInstances:!0})),this._parent.useClipPlane&&(e.push(i.forceCompilationAsync(t,{clipPlane:!0})),e.push(i.forceCompilationAsync(t,{clipPlane:!0,useInstances:!0})))}}}return Promise.all(e).then(()=>{this._parent._endPerformanceCounter("Compile materials")})}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");let e=[];for(let t of this._babylonScene.lights){let i=t.getShadowGenerator();i&&e.push(i.forceCompilationAsync())}return Promise.all(e).then(()=>{this._parent._endPerformanceCounter("Compile shadow generators")})}_forEachExtensions(e){for(let t of this._extensions)t.enabled&&e(t)}_applyExtensions(e,t,i){for(let r of this._extensions)if(r.enabled){let n=`${r.name}.${t}`;e._activeLoaderExtensionFunctions=e._activeLoaderExtensionFunctions||{};let s=e._activeLoaderExtensionFunctions;if(!s[n]){s[n]=!0;try{let e=i(r);if(e)return e}finally{delete s[n]}}}return null}_extensionsOnLoading(){this._forEachExtensions(e=>e.onLoading&&e.onLoading())}_extensionsOnReady(){this._forEachExtensions(e=>e.onReady&&e.onReady())}_extensionsLoadSceneAsync(e,t){return this._applyExtensions(t,"loadScene",i=>i.loadSceneAsync&&i.loadSceneAsync(e,t))}_extensionsLoadNodeAsync(e,t,i){return this._applyExtensions(t,"loadNode",r=>r.loadNodeAsync&&r.loadNodeAsync(e,t,i))}_extensionsLoadCameraAsync(e,t,i){return this._applyExtensions(t,"loadCamera",r=>r.loadCameraAsync&&r.loadCameraAsync(e,t,i))}_extensionsLoadVertexDataAsync(e,t,i){return this._applyExtensions(t,"loadVertexData",r=>r._loadVertexDataAsync&&r._loadVertexDataAsync(e,t,i))}_extensionsLoadMeshPrimitiveAsync(e,t,i,r,n,s){return this._applyExtensions(n,"loadMeshPrimitive",a=>a._loadMeshPrimitiveAsync&&a._loadMeshPrimitiveAsync(e,t,i,r,n,s))}_extensionsLoadMaterialAsync(e,t,i,r,n){return this._applyExtensions(t,"loadMaterial",s=>s._loadMaterialAsync&&s._loadMaterialAsync(e,t,i,r,n))}_extensionsCreateMaterial(e,t,i){return this._applyExtensions(t,"createMaterial",r=>r.createMaterial&&r.createMaterial(e,t,i))}_extensionsLoadMaterialPropertiesAsync(e,t,i){return this._applyExtensions(t,"loadMaterialProperties",r=>r.loadMaterialPropertiesAsync&&r.loadMaterialPropertiesAsync(e,t,i))}_extensionsLoadTextureInfoAsync(e,t,i){return this._applyExtensions(t,"loadTextureInfo",r=>r.loadTextureInfoAsync&&r.loadTextureInfoAsync(e,t,i))}_extensionsLoadTextureAsync(e,t,i){return this._applyExtensions(t,"loadTexture",r=>r._loadTextureAsync&&r._loadTextureAsync(e,t,i))}_extensionsLoadAnimationAsync(e,t){return this._applyExtensions(t,"loadAnimation",i=>i.loadAnimationAsync&&i.loadAnimationAsync(e,t))}_extensionsLoadAnimationChannelAsync(e,t,i,r,n){return this._applyExtensions(i,"loadAnimationChannel",s=>s._loadAnimationChannelAsync&&s._loadAnimationChannelAsync(e,t,i,r,n))}_extensionsLoadSkinAsync(e,t,i){return this._applyExtensions(i,"loadSkin",r=>r._loadSkinAsync&&r._loadSkinAsync(e,t,i))}_extensionsLoadUriAsync(e,t,i){return this._applyExtensions(t,"loadUri",r=>r._loadUriAsync&&r._loadUriAsync(e,t,i))}_extensionsLoadBufferViewAsync(e,t){return this._applyExtensions(t,"loadBufferView",i=>i.loadBufferViewAsync&&i.loadBufferViewAsync(e,t))}_extensionsLoadBufferAsync(e,t,i,r){return this._applyExtensions(t,"loadBuffer",n=>n.loadBufferAsync&&n.loadBufferAsync(e,t,i,r))}static LoadExtensionAsync(e,t,i,r){if(!t.extensions)return null;let n=t.extensions[i];return n?r(`${e}/extensions/${i}`,n):null}static LoadExtraAsync(e,t,i,r){if(!t.extras)return null;let n=t.extras[i];return n?r(`${e}/extras/${i}`,n):null}isExtensionUsed(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)}logOpen(e){this._parent._logOpen(e)}logClose(){this._parent._logClose()}log(e){this._parent._log(e)}startPerformanceCounter(e){this._parent._startPerformanceCounter(e)}endPerformanceCounter(e){this._parent._endPerformanceCounter(e)}}to.DefaultSampler={index:-1},el._CreateGLTF2Loader=e=>new to(e);var tl=i(4347),tu=i(97241),th=i(91737),tc=i(13468),td=i(9955);let tp="EXT_lights_image_based";class tf{constructor(e){this.name=tp,this._loader=e,this.enabled=this._loader.isExtensionUsed(tp)}dispose(){this._loader=null,delete this._lights}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._lights=t.lights}}loadSceneAsync(e,t){return to.LoadExtensionAsync(e,t,this.name,async(i,r)=>{this._loader._allMaterialsDirtyRequired=!0;let n=[];n.push(this._loader.loadSceneAsync(e,t)),this._loader.logOpen(`${i}`);let s=ts.Get(`${i}/light`,this._lights,r.light);return n.push(this._loadLightAsync(`/extensions/${this.name}/lights/${r.light}`,s).then(e=>{this._loader.babylonScene.environmentTexture=e})),this._loader.logClose(),await Promise.all(n).then(()=>{})})}_loadLightAsync(e,t){if(!t._loaded){let i=[];this._loader.logOpen(`${e}`);let r=Array(t.specularImages.length);for(let n=0;n<t.specularImages.length;n++){let s=t.specularImages[n];r[n]=Array(s.length);for(let t=0;t<s.length;t++){let a=`${e}/specularImages/${n}/${t}`;this._loader.logOpen(`${a}`);let o=s[t],l=ts.Get(a,this._loader.gltf.images,o);i.push(this._loader.loadImageAsync(`/images/${o}`,l).then(e=>{r[n][t]=e})),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(i).then(async()=>{let i=new td.p(this._loader.babylonScene,null,t.specularImageSize);if(i.name=t.name||"environment",t._babylonTexture=i,void 0!=t.intensity&&(i.level=t.intensity),t.rotation){let e=w.PT.FromArray(t.rotation);this._loader.babylonScene.useRightHandedSystem||(e=w.PT.Inverse(e)),w.uq.FromQuaternionToRef(e,i.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw Error(`${e}: Irradiance coefficients are missing`);let n=tc.O.FromArray(t.irradianceCoefficients);n.scaleInPlace(t.intensity),n.convertIrradianceToLambertianRadiance();let s=tc.Q.FromHarmonics(n),a=(r.length-1)/Math.log2(t.specularImageSize);return await i.updateRGBDAsync(r,s,a)})}return t._loaded.then(()=>t._babylonTexture)}}e9(tp),e8(tp,!0,e=>new tf(e)),i(97878);let t_="EXT_mesh_gpu_instancing";class tm{constructor(e){this.name=t_,this._loader=e,this.enabled=this._loader.isExtensionUsed(t_)}dispose(){this._loader=null}loadNodeAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(e,r)=>{this._loader._disableInstancedMesh++;let n=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,i);if(this._loader._disableInstancedMesh--,!t._primitiveBabylonMeshes)return await n;let s=[],a=0,o=t=>{if(void 0==r.attributes[t])return void s.push(Promise.resolve(null));let i=ts.Get(`${e}/attributes/${t}`,this._loader.gltf.accessors,r.attributes[t]);if(s.push(this._loader._loadFloatAccessorAsync(`/accessors/${i.bufferView}`,i)),0===a)a=i.count;else if(a!==i.count)throw Error(`${e}/attributes: Instance buffer accessors do not have the same count.`)};return o("TRANSLATION"),o("ROTATION"),o("SCALE"),o("_COLOR_0"),await n.then(async e=>{let[i,r,n,o]=await Promise.all(s),l=new Float32Array(16*a);w.AA.Vector3["0"].copyFromFloats(0,0,0),w.AA.Quaternion["0"].copyFromFloats(0,0,0,1),w.AA.Vector3["1"].copyFromFloats(1,1,1);for(let e=0;e<a;++e)i&&w.Pq.FromArrayToRef(i,3*e,w.AA.Vector3["0"]),r&&w.PT.FromArrayToRef(r,4*e,w.AA.Quaternion["0"]),n&&w.Pq.FromArrayToRef(n,3*e,w.AA.Vector3["1"]),w.uq.ComposeToRef(w.AA.Vector3["1"],w.AA.Quaternion["0"],w.AA.Vector3["0"],w.AA.Matrix["0"]),w.AA.Matrix["0"].copyToArray(l,16*e);for(let e of t._primitiveBabylonMeshes)e.thinInstanceSetBuffer("matrix",l,16,!0),o&&(o.length===3*a?e.thinInstanceSetBuffer("color",o,3,!0):o.length===4*a?e.thinInstanceSetBuffer("color",o,4,!0):X.V.Warn("Unexpected size of _COLOR_0 attribute for mesh "+e.name));return e})})}}e9(t_),e8(t_,!0,e=>new tm(e));var tg=i(67200);let tb="EXT_meshopt_compression";class ty{constructor(e){this.name=tb,this.enabled=e.isExtensionUsed(tb),this._loader=e}dispose(){this._loader=null}loadBufferViewAsync(e,t){return to.LoadExtensionAsync(e,t,this.name,async(i,r)=>{if(t._meshOptData)return await t._meshOptData;let n=ts.Get(`${e}/buffer`,this._loader.gltf.buffers,r.buffer);return t._meshOptData=this._loader.loadBufferAsync(`/buffers/${n.index}`,n,r.byteOffset||0,r.byteLength).then(async e=>await tg.v.Default.decodeGltfBufferAsync(e,r.count,r.byteStride,r.mode,r.filter)),await t._meshOptData})}}e9(tb),e8(tb,!0,e=>new ty(e));let tx="EXT_texture_webp";class tT{constructor(e){this.name=tx,this._loader=e,this.enabled=e.isExtensionUsed(tx)}dispose(){this._loader=null}_loadTextureAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=void 0==t.sampler?to.DefaultSampler:ts.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),a=ts.Get(`${r}/source`,this._loader.gltf.images,n.source);return await this._loader._createTextureAsync(e,s,a,e=>{i(e)},void 0,!t._textureInfo.nonColorData)})}}e9(tx),e8(tx,!0,e=>new tT(e));let tv="EXT_texture_avif";class tA{constructor(e){this.name=tv,this._loader=e,this.enabled=e.isExtensionUsed(tv)}dispose(){this._loader=null}_loadTextureAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=void 0==t.sampler?to.DefaultSampler:ts.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),a=ts.Get(`${r}/source`,this._loader.gltf.images,n.source);return await this._loader._createTextureAsync(e,s,a,e=>{i(e)},void 0,!t._textureInfo.nonColorData)})}}e9(tv),e8(tv,!0,e=>new tA(e));var tS=i(51527);let tE="EXT_lights_ies";class tI{constructor(e){this.name=tE,this._loader=e,this.enabled=this._loader.isExtensionUsed(tE)}dispose(){this._loader=null,delete this._lights}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._lights=t.lights,ts.Assign(this._lights)}}loadNodeAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s,a,o;this._loader._allMaterialsDirtyRequired=!0;let l=await this._loader.loadNodeAsync(e,t,e=>{let t=(a=ts.Get(r,this._lights,n.light)).name||e.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,(s=new eR.n(t,w.Pq.Zero(),w.Pq.Backward(),0,1,this._loader.babylonScene)).angle=Math.PI/2,s.innerAngle=0,s._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,a._babylonLight=s,s.falloffType=tS.v.FALLOFF_GLTF,s.diffuse=n.color?eu.v9.FromArray(n.color):eu.v9.White(),s.intensity=n.multiplier||1,s.range=Number.MAX_VALUE,s.parent=e,this._loader._babylonLights.push(s),to.AddPointerMetadata(s,r),i(e)});if(a.uri)o=await this._loader.loadUriAsync(e,a,a.uri);else{let t=ts.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,a.bufferView);o=await this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t)}return s.iesProfileTexture=new eg.g(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,o,!0,void 0,void 0,void 0,void 0,".ies"),l})}}e9(tE),e8(tE,!0,e=>new tI(e));var tR=i(93941);let tP="KHR_draco_mesh_compression";class tM{constructor(e){this.name=tP,this.useNormalizedFlagFromAccessor=!0,this._loader=e,this.enabled=tR.Y.DefaultAvailable&&this._loader.isExtensionUsed(tP)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{if(void 0!=t.mode&&4!==t.mode&&5!==t.mode)throw Error(`${e}: Unsupported mode ${t.mode}`);let s={},a={},o=(e,r)=>{let o=n.attributes[e];if(void 0!=o&&(i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(r)&&i._delayInfo.push(r),s[r]=o,this.useNormalizedFlagFromAccessor)){let i=ts.TryGet(this._loader.gltf.accessors,t.attributes[e]);i&&(a[r]=i.normalized||!1)}};o("POSITION",ey.R.PositionKind),o("NORMAL",ey.R.NormalKind),o("TANGENT",ey.R.TangentKind),o("TEXCOORD_0",ey.R.UVKind),o("TEXCOORD_1",ey.R.UV2Kind),o("TEXCOORD_2",ey.R.UV3Kind),o("TEXCOORD_3",ey.R.UV4Kind),o("TEXCOORD_4",ey.R.UV5Kind),o("TEXCOORD_5",ey.R.UV6Kind),o("JOINTS_0",ey.R.MatricesIndicesKind),o("WEIGHTS_0",ey.R.MatricesWeightsKind),o("COLOR_0",ey.R.ColorKind);let l=ts.Get(r,this._loader.gltf.bufferViews,n.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then(async r=>{let n=this.dracoDecoder||tR.Y.Default,o=ts.TryGet(this._loader.gltf.accessors,t.attributes.POSITION),l=this._loader.parent.alwaysComputeBoundingBox||i.skeleton||!o?null:ta(o);return await n._decodeMeshToGeometryForGltfAsync(i.name,this._loader.babylonScene,r,s,a,l).catch(t=>{throw Error(`${e}: ${t.message}`)})})),await l._dracoBabylonGeometry})}}e9(tP),e8(tP,!0,e=>new tM(e));let tC="KHR_lights_punctual";class tO{constructor(e){this.name=tC,this._loader=e,this.enabled=this._loader.isExtensionUsed(tC)}dispose(){this._loader=null,delete this._lights}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._lights=t.lights,ts.Assign(this._lights)}}loadNodeAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(e,t,e=>{let t,s=ts.Get(r,this._lights,n.light),a=s.name||e.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,s.type){case"directional":{let e=new eE.Z(a,w.Pq.Backward(),this._loader.babylonScene);e.position.setAll(0),t=e;break}case"point":t=new eI.H(a,w.Pq.Zero(),this._loader.babylonScene);break;case"spot":{let e=new eR.n(a,w.Pq.Zero(),w.Pq.Backward(),0,1,this._loader.babylonScene);e.angle=2*(s.spot&&s.spot.outerConeAngle||Math.PI/4),e.innerAngle=2*(s.spot&&s.spot.innerConeAngle||0),t=e;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,Error(`${r}: Invalid light type (${s.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,s._babylonLight=t,t.falloffType=tS.v.FALLOFF_GLTF,t.diffuse=s.color?eu.v9.FromArray(s.color):eu.v9.White(),t.intensity=void 0==s.intensity?1:s.intensity,t.range=void 0==s.range?Number.MAX_VALUE:s.range,t.parent=e,this._loader._babylonLights.push(t),to.AddPointerMetadata(t,r),i(e)})))}}e9(tC),e8(tC,!0,e=>new tO(e));var tw=i(9362);let tD="EXT_lights_area";class tN{constructor(e){this.name=tD,this._loader=e,this.enabled=this._loader.isExtensionUsed(tD)}dispose(){this._loader=null,delete this._lights}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._lights=t.lights,ts.Assign(this._lights)}}loadNodeAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(e,t,e=>{let t,s=ts.Get(r,this._lights,n.light),a=s.name||e.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer;let o=void 0!==s.size?s.size:1;switch(s.type){case"rect":{let e=s.rect?.aspect!==void 0?s.rect.aspect*o:o;t=new tw.u(a,w.Pq.Zero(),e,o,this._loader.babylonScene);break}case"disk":{let e=Math.sqrt(o*o*.25*Math.PI);t=new tw.u(a,w.Pq.Zero(),e,e,this._loader.babylonScene);break}default:throw this._loader.babylonScene._blockEntityCollection=!1,Error(`${r}: Invalid area light type (${s.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,s._babylonLight=t,t.falloffType=tS.v.FALLOFF_GLTF,t.diffuse=s.color?eu.v9.FromArray(s.color):eu.v9.White(),t.intensity=void 0==s.intensity?1:s.intensity;let l=new e1.V(`${a}_orientation`,this._loader.babylonScene);l.rotationQuaternion=w.PT.RotationAxis(w.Pq.Up(),Math.PI),l.parent=e,t.parent=l,this._loader._babylonLights.push(t),to.AddPointerMetadata(t,r),i(e)})))}}e9(tD),e8(tD,!0,e=>new tN(e));var tL=i(85822);let tF="KHR_materials_pbrSpecularGlossiness";class tB{constructor(e){this.name=tF,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(tF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loadSpecularGlossinessPropertiesAsync(r,n,i)),this._loader.loadMaterialAlphaProperties(e,t,i),await Promise.all(s).then(()=>{})})}_loadSpecularGlossinessPropertiesAsync(e,t,i){if(!(i instanceof tL.PBRMaterial))throw Error(`${e}: Material type not supported`);let r=[];return i.metallic=null,i.roughness=null,t.diffuseFactor?(i.albedoColor=eu.v9.FromArray(t.diffuseFactor),i.alpha=t.diffuseFactor[3]):i.albedoColor=eu.v9.White(),i.reflectivityColor=t.specularFactor?eu.v9.FromArray(t.specularFactor):eu.v9.White(),i.microSurface=void 0==t.glossinessFactor?1:t.glossinessFactor,t.diffuseTexture&&r.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTexture`,t.diffuseTexture,e=>{e.name=`${i.name} (Diffuse)`,i.albedoTexture=e})),t.specularGlossinessTexture&&(r.push(this._loader.loadTextureInfoAsync(`${e}/specularGlossinessTexture`,t.specularGlossinessTexture,e=>{e.name=`${i.name} (Specular Glossiness)`,i.reflectivityTexture=e,i.reflectivityTexture.hasAlpha=!0})),i.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(r).then(()=>{})}}e9(tF),e8(tF,!0,e=>new tB(e));let tk="KHR_materials_unlit";class tU{constructor(e){this.name=tk,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(tk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async()=>await this._loadUnlitPropertiesAsync(e,t,i))}_loadUnlitPropertiesAsync(e,t,i){let r=this._loader._getOrCreateMaterialAdapter(i),n=[],s=t.pbrMetallicRoughness;return s&&(s.baseColorFactor&&(r.baseColor=eu.v9.FromArray(s.baseColorFactor),r.geometryOpacity=s.baseColorFactor[3]),s.baseColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/baseColorTexture`,s.baseColorTexture,e=>{e.name=`${i.name} (Base Color)`,r.baseColorTexture=e}))),r.isUnlit=!0,t.doubleSided&&(r.backFaceCulling=!1,r.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,i),Promise.all(n).then(()=>{})}}e9(tk),e8(tk,!0,e=>new tU(e));let tV="KHR_materials_clearcoat";class tG{constructor(e){this.name=tV,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(tV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadClearCoatPropertiesAsync(r,n,i)),await Promise.all(s)})}_loadClearCoatPropertiesAsync(e,t,i){let r=this._loader._getOrCreateMaterialAdapter(i),n=[];return r.configureCoat(),r.coatWeight=void 0!==t.clearcoatFactor?t.clearcoatFactor:0,r.coatRoughness=void 0!==t.clearcoatRoughnessFactor?t.clearcoatRoughnessFactor:0,t.clearcoatTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,t.clearcoatTexture,e=>{e.name=`${i.name} (ClearCoat)`,r.coatWeightTexture=e})),t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,t.clearcoatRoughnessTexture,e=>{e.name=`${i.name} (ClearCoat Roughness)`,r.coatRoughnessTexture=e}))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,t.clearcoatNormalTexture,e=>{e.name=`${i.name} (ClearCoat Normal)`,r.geometryCoatNormalTexture=e,t.clearcoatNormalTexture?.scale!=void 0&&(r.geometryCoatNormalTextureScale=t.clearcoatNormalTexture.scale)})),r.setNormalMapInversions(!i.getScene().useRightHandedSystem,i.getScene().useRightHandedSystem)),Promise.all(n).then(()=>{})}}e9(tV),e8(tV,!0,e=>new tG(e));let tz="KHR_materials_coat";class t${constructor(e){this.name=tz,this.order=191,this.useOpenPBR=!1,this._loader=e,this.enabled=this._loader.isExtensionUsed(tz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),t.extensions&&t.extensions.KHR_materials_openpbr&&(this.useOpenPBR=!0),s.push(this._loadCoatPropertiesAsync(r,n,i)),await Promise.all(s)})}_loadCoatPropertiesAsync(e,t,i){let r=this._loader._getOrCreateMaterialAdapter(i),n=[];r.configureCoat(),r.coatWeight=void 0!==t.coatFactor?t.coatFactor:0,r.coatRoughness=void 0!==t.coatRoughnessFactor?t.coatRoughnessFactor:0,t.coatTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/coatTexture`,t.coatTexture,e=>{e.name=`${i.name} (Coat)`,r.coatWeightTexture=e})),t.coatRoughnessTexture&&(t.coatRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/coatRoughnessTexture`,t.coatRoughnessTexture,e=>{e.name=`${i.name} (Coat Roughness)`,r.coatRoughnessTexture=e}))),t.coatNormalTexture&&(t.coatNormalTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/coatNormalTexture`,t.coatNormalTexture,e=>{e.name=`${i.name} (Coat Normal)`,r.geometryCoatNormalTexture=e,t.coatNormalTexture?.scale!=void 0&&(r.geometryCoatNormalTextureScale=t.coatNormalTexture.scale)})),r.setNormalMapInversions(!i.getScene().useRightHandedSystem,i.getScene().useRightHandedSystem)),r.coatDarkening=void 0!==t.coatDarkeningFactor?t.coatDarkeningFactor:1,r.coatIor=void 0!==t.coatIor?t.coatIor:1.5;let s=eu.v9.White();void 0!==t.coatColorFactor&&s.fromArray(t.coatColorFactor),r.coatColor=s,t.coatColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/coatColorTexture`,t.coatColorTexture,e=>{e.name=`${i.name} (Coat Color)`,r.coatColorTexture=e}));let a=t.coatAnisotropyStrength??0,o=t.coatAnisotropyRotation??0;return r.coatRoughnessAnisotropy=a,r.geometryCoatTangentAngle=o,this.useOpenPBR||r.configureGltfStyleAnisotropy(!0),t.coatAnisotropyTexture&&(t.coatAnisotropyTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/coatAnisotropyTexture`,t.coatAnisotropyTexture,e=>{e.name=`${i.name} (Coat Anisotropy)`,r.geometryCoatTangentTexture=e}))),Promise.all(n).then(()=>{})}}e9(tz),e8(tz,!0,e=>new t$(e));let tH="KHR_materials_iridescence";class tW{constructor(e){this.name=tH,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(tH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadIridescencePropertiesAsync(r,n,i)),await Promise.all(s).then(()=>{})})}_loadIridescencePropertiesAsync(e,t,i){let r=this._loader._getOrCreateMaterialAdapter(i),n=[];return r.thinFilmWeight=t.iridescenceFactor??0,r.thinFilmIor=t.iridescenceIor??t.iridescenceIOR??1.3,r.thinFilmThicknessMinimum=t.iridescenceThicknessMinimum??100,r.thinFilmThicknessMaximum=t.iridescenceThicknessMaximum??400,t.iridescenceTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceTexture`,t.iridescenceTexture,e=>{e.name=`${i.name} (Iridescence)`,r.thinFilmWeightTexture=e})),t.iridescenceThicknessTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceThicknessTexture`,t.iridescenceThicknessTexture,e=>{e.name=`${i.name} (Iridescence Thickness)`,r.thinFilmThicknessTexture=e})),Promise.all(n).then(()=>{})}}e9(tH),e8(tH,!0,e=>new tW(e));let tq="KHR_materials_anisotropy";class tj{constructor(e){this.name=tq,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(tq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadAnisotropyPropertiesAsync(r,n,i)),await Promise.all(s)})}async _loadAnisotropyPropertiesAsync(e,t,i){let r=this._loader._getOrCreateMaterialAdapter(i),n=[],s=t.anisotropyStrength??0,a=t.anisotropyRotation??0;r.specularRoughnessAnisotropy=s,r.geometryTangentAngle=a;let o=t.extensions??{};o.EXT_materials_anisotropy_openpbr&&o.EXT_materials_anisotropy_openpbr.openPbrAnisotropyEnabled||r.configureGltfStyleAnisotropy(!0),t.anisotropyTexture&&(t.anisotropyTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/anisotropyTexture`,t.anisotropyTexture,e=>{e.name=`${i.name} (Anisotropy Intensity)`,r.geometryTangentTexture=e}))),await Promise.all(n)}}e9(tq),e8(tq,!0,e=>new tj(e));let tX="KHR_materials_emissive_strength";class tZ{constructor(e){this.name=tX,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(tX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>(await this._loader.loadMaterialPropertiesAsync(e,t,i),this._loadEmissiveProperties(r,n,i),await Promise.resolve()))}_loadEmissiveProperties(e,t,i){void 0!==t.emissiveStrength&&(this._loader._getOrCreateMaterialAdapter(i).emissionLuminance=t.emissiveStrength)}}e9(tX),e8(tX,!0,e=>new tZ(e));let tY="KHR_materials_sheen";class tK{constructor(e){this.name=tY,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(tY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadSheenPropertiesAsync(r,n,i)),await Promise.all(s).then(()=>{})})}_loadSheenPropertiesAsync(e,t,i){let r=this._loader._getOrCreateMaterialAdapter(i),n=[];r.configureFuzz();let s=void 0!==t.sheenColorFactor?eu.v9.FromArray(t.sheenColorFactor):eu.v9.Black(),a=void 0!==t.sheenRoughnessFactor?t.sheenRoughnessFactor:0;return r.fuzzWeight=1,r.fuzzColor=s,r.fuzzRoughness=a,t.sheenColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/sheenColorTexture`,t.sheenColorTexture,e=>{e.name=`${i.name} (Sheen Color)`,r.fuzzColorTexture=e})),t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/sheenRoughnessTexture`,t.sheenRoughnessTexture,e=>{e.name=`${i.name} (Sheen Roughness)`,r.fuzzRoughnessTexture=e}))),Promise.all(n).then(()=>{})}}e9(tY),e8(tY,!0,e=>new tK(e));let tQ="KHR_materials_fuzz";class tJ{constructor(e){this.name=tQ,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(tQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadFuzzPropertiesAsync(r,n,i)),await Promise.all(s).then(()=>{})})}_loadFuzzPropertiesAsync(e,t,i){let r=this._loader._getOrCreateMaterialAdapter(i),n=[];return r.configureFuzz(),r.fuzzWeight=void 0!==t.fuzzFactor?t.fuzzFactor:0,r.fuzzColor=void 0!==t.fuzzColorFactor?eu.v9.FromArray(t.fuzzColorFactor):eu.v9.White(),r.fuzzRoughness=void 0!==t.fuzzRoughnessFactor?t.fuzzRoughnessFactor:.5,t.fuzzTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/fuzzTexture`,t.fuzzTexture,e=>{e.name=`${i.name} (Fuzz)`,r.fuzzWeightTexture=e})),t.fuzzColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/fuzzColorTexture`,t.fuzzColorTexture,e=>{e.name=`${i.name} (Fuzz Color)`,r.fuzzColorTexture=e})),t.fuzzRoughnessTexture&&(t.fuzzRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/fuzzRoughnessTexture`,t.fuzzRoughnessTexture,e=>{e.name=`${i.name} (Fuzz Roughness)`,r.fuzzRoughnessTexture=e}))),Promise.all(n).then(()=>{})}}e9(tQ),e8(tQ,!0,e=>new tJ(e));let t0="KHR_materials_specular";class t1{constructor(e){this.name=t0,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(t0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadSpecularPropertiesAsync(r,n,i));let a=this._loader._getOrCreateMaterialAdapter(i);return n.extensions&&n.extensions.EXT_materials_specular_edge_color&&n.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&a.enableSpecularEdgeColor(!0),await Promise.all(s).then(()=>{})})}_loadSpecularPropertiesAsync(e,t,i){let r=this._loader._getOrCreateMaterialAdapter(i),n=[];return r.specularWeight=t.specularFactor??1,r.specularColor=void 0!==t.specularColorFactor?eu.v9.FromArray(t.specularColorFactor):new eu.v9(1,1,1),t.specularTexture&&(t.specularTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/specularTexture`,t.specularTexture,e=>{e.name=`${i.name} (Specular)`,r.specularWeightTexture=e}))),t.specularColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/specularColorTexture`,t.specularColorTexture,e=>{e.name=`${i.name} (Specular Color)`,r.specularColorTexture=e})),Promise.all(n).then(()=>{})}}e9(t0),e8(t0,!0,e=>new t1(e));let t2="KHR_materials_ior";class t3{constructor(e){this.name=t2,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(t2)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadIorPropertiesAsync(r,n,i)),await Promise.all(s).then(()=>{})})}_loadIorPropertiesAsync(e,t,i){return this._loader._getOrCreateMaterialAdapter(i).specularIor=void 0!==t.ior?t.ior:t3._DEFAULT_IOR,Promise.resolve()}}t3._DEFAULT_IOR=1.5,e9(t2),e8(t2,!0,e=>new t3(e));let t4="KHR_materials_variants";class t5{constructor(e){this.name=t4,this._loader=e,this.enabled=this._loader.isExtensionUsed(t4)&&!this._loader.parent.skipMaterials}dispose(){this._loader=null}static GetAvailableVariants(e){let t=this._GetExtensionMetadata(e);return t?Object.keys(t.variants):[]}getAvailableVariants(e){return t5.GetAvailableVariants(e)}static SelectVariant(e,t){let i=this._GetExtensionMetadata(e);if(!i)throw Error(`Cannot select variant on a glTF mesh that does not have the ${t4} extension`);let r=e=>{let t=i.variants[e];if(t)for(let e of t)e.mesh.material=e.material};if(t instanceof Array)for(let e of t)r(e);else r(t);i.lastSelected=t}selectVariant(e,t){t5.SelectVariant(e,t)}static Reset(e){let t=this._GetExtensionMetadata(e);if(!t)throw Error(`Cannot reset on a glTF mesh that does not have the ${t4} extension`);for(let e of t.original)e.mesh.material=e.material;t.lastSelected=null}reset(e){t5.Reset(e)}static GetLastSelectedVariant(e){let t=this._GetExtensionMetadata(e);if(!t)throw Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${t4} extension`);return t.lastSelected}getLastSelectedVariant(e){return t5.GetLastSelectedVariant(e)}static _GetExtensionMetadata(e){return e?._internalMetadata?.gltf?.[t4]||null}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._variants=t.variants}}onReady(){let e=this._loader.rootBabylonMesh;if(e){let t=this._loader.parent.extensionOptions[t4];t?.defaultVariant&&t5.SelectVariant(e,t.defaultVariant),t?.onLoaded?.({get variants(){return t5.GetAvailableVariants(e)},get selectedVariant(){let t=t5.GetLastSelectedVariant(e);if(!t)return t5.GetAvailableVariants(e)[0];if(Array.isArray(t))return t[0];return t},set selectedVariant(variantName){t5.SelectVariant(e,variantName)}})}}_loadMeshPrimitiveAsync(e,t,i,r,n,s){return to.LoadExtensionAsync(e,n,this.name,async(a,o)=>{let l=[];return l.push(this._loader._loadMeshPrimitiveAsync(e,t,i,r,n,t=>{if(s(t),t instanceof eA.e){let i=to._GetDrawMode(e,n.mode),r=this._loader.rootBabylonMesh,s=r?r._internalMetadata=r._internalMetadata||{}:{},u=s.gltf=s.gltf||{},h=u[t4]=u[t4]||{lastSelected:null,original:[],variants:{}};h.original.push({mesh:t,material:t.material});for(let e=0;e<o.mappings.length;++e){let n=o.mappings[e],s=ts.Get(`${a}/mappings/${e}/material`,this._loader.gltf.materials,n.material);l.push(this._loader._loadMaterialAsync(`#/materials/${n.material}`,s,t,i,e=>{for(let i=0;i<n.variants.length;++i){let s=n.variants[i],a=ts.Get(`/extensions/${t4}/variants/${s}`,this._variants,s);h.variants[a.name]=h.variants[a.name]||[],h.variants[a.name].push({mesh:t,material:e}),t.onClonedObservable.add(e=>{let i=null,n=e;do{if(!(n=n.parent))return;i=t5._GetExtensionMetadata(n)}while(null===i);if(r&&i===t5._GetExtensionMetadata(r)){for(let e in n._internalMetadata={},r._internalMetadata)n._internalMetadata[e]=r._internalMetadata[e];for(let e in n._internalMetadata.gltf=[],r._internalMetadata.gltf)n._internalMetadata.gltf[e]=r._internalMetadata.gltf[e];for(let e of(n._internalMetadata.gltf[t4]={lastSelected:null,original:[],variants:{}},i.original))n._internalMetadata.gltf[t4].original.push({mesh:e.mesh,material:e.material});for(let e in i.variants)if(Object.prototype.hasOwnProperty.call(i.variants,e))for(let t of(n._internalMetadata.gltf[t4].variants[e]=[],i.variants[e]))n._internalMetadata.gltf[t4].variants[e].push({mesh:t.mesh,material:t.material});i=n._internalMetadata.gltf[t4]}for(let r of i.original)r.mesh===t&&(r.mesh=e);for(let r of i.variants[a.name])r.mesh===t&&(r.mesh=e)})}}))}}})),await Promise.all(l).then(([e])=>e)})}}e9(t4),e8(t4,!0,e=>new t5(e));var t6=i(78629);class t8{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:eM.Y.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(e,t,i){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...t8._GetDefaultOptions(),...e},this._scene=t,this._scene._transmissionHelper=this,this._loader=i,this.onErrorObservable=new j.cP,this._scene.onDisposeObservable.addOnce(()=>{this.dispose()}),this._parseScene(),this._setupRenderTargets()}updateOptions(e){if(!Object.keys(e).filter(t=>this._options[t]!==e[t]).length)return;let t={...this._options,...e},i=this._options;this._options=t,t.renderSize===i.renderSize&&t.renderTargetTextureType===i.renderTargetTextureType&&t.generateMipmaps===i.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=t.samples,this._opaqueRenderTarget.lodGenerationScale=t.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=t.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_addMesh(e){this._materialObservers[e.uniqueId]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),D.S0.SetImmediate(()=>{if(e.material){let t=this._loader._getOrCreateMaterialAdapter(e.material);t.transmissionWeight>0?(t.refractionBackgroundTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(e)&&this._transparentMeshesCache.push(e)):-1===this._opaqueMeshesCache.indexOf(e)&&this._opaqueMeshesCache.push(e)}})}_removeMesh(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.uniqueId]),delete this._materialObservers[e.uniqueId];let t=this._transparentMeshesCache.indexOf(e);-1!==t&&this._transparentMeshesCache.splice(t,1),-1!==(t=this._opaqueMeshesCache.indexOf(e))&&this._opaqueMeshesCache.splice(t,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(e){let t=this._transparentMeshesCache.indexOf(e),i=this._opaqueMeshesCache.indexOf(e),r=e.material?this._loader._getOrCreateMaterialAdapter(e.material):null;r&&r.transmissionWeight>0?(r&&(r.refractionBackgroundTexture=this._opaqueRenderTarget),-1!==i?(this._opaqueMeshesCache.splice(i,1),this._transparentMeshesCache.push(e)):-1===t&&this._transparentMeshesCache.push(e)):-1!==t?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(e)):-1===i&&this._opaqueMeshesCache.push(e)}_isRenderTargetValid(){return this._opaqueRenderTarget?.getInternalTexture()!==null}_setupRenderTargets(){let e;for(let t of(this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new t6.$("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=this._options.clearColor?.clone()??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add(t=>{e=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?t.clearColor.copyFrom(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(t.clearColor,this._scene.getEngine().useExactSrgbConversions)}),this._opaqueRenderTarget.onAfterUnbindObservable.add(()=>{this._scene.environmentIntensity=e}),this._transparentMeshesCache))if(t.material){let e=this._loader._getOrCreateMaterialAdapter(t.material);e.transmissionWeight>0&&(e.refractionBackgroundTexture=this._opaqueRenderTarget)}}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}let t9="KHR_materials_transmission";class t7{constructor(e){this.name=t9,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(t9),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadTransparentPropertiesAsync(r,t,i,n)),await Promise.all(s).then(()=>{})})}_loadTransparentPropertiesAsync(e,t,i,r){let n=this._loader._getOrCreateMaterialAdapter(i),s=void 0!==r.transmissionFactor?r.transmissionFactor:0;if(0===s||!n)return Promise.resolve();if(n.configureTransmission(),n.transmissionWeight=s,s>0&&!this._loader.parent.dontUseTransmissionHelper){let e=i.getScene();e._transmissionHelper?e._transmissionHelper?._isRenderTargetValid()||e._transmissionHelper?._setupRenderTargets():new t8({},i.getScene(),this._loader)}let a=Promise.resolve(null);return r.transmissionTexture&&(r.transmissionTexture.nonColorData=!0,a=this._loader.loadTextureInfoAsync(`${e}/transmissionTexture`,r.transmissionTexture,e=>{e.name=`${i.name} (Transmission)`,n.transmissionWeightTexture=e})),a.then(()=>{})}}e9(t9),e8(t9,!0,e=>new t7(e));let ie="KHR_materials_diffuse_transmission";class it{constructor(e){this.name=ie,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(ie),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadTranslucentPropertiesAsync(r,t,i,n)),await Promise.all(s).then(()=>{})})}_loadTranslucentPropertiesAsync(e,t,i,r){let n=this._loader._getOrCreateMaterialAdapter(i);n.configureSubsurface(),n.subsurfaceWeight=r.diffuseTransmissionFactor??0,n.subsurfaceConstantTint=void 0!==r.diffuseTransmissionColorFactor?eu.v9.FromArray(r.diffuseTransmissionColorFactor):eu.v9.White();let s=[];return r.diffuseTransmissionTexture&&(r.diffuseTransmissionTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionTexture`,r.diffuseTransmissionTexture).then(e=>{e.name=`${i.name} (Diffuse Transmission)`,n.subsurfaceWeightTexture=e}))),r.diffuseTransmissionColorTexture&&s.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionColorTexture`,r.diffuseTransmissionColorTexture).then(e=>{e.name=`${i.name} (Diffuse Transmission Color)`,n.subsurfaceConstantTintTexture=e})),Promise.all(s).then(()=>{})}}e9(ie),e8(ie,!0,e=>new it(e));let ii="KHR_materials_volume";class ir{constructor(e){this.name=ii,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(ii),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadVolumePropertiesAsync(r,t,i,n)),await Promise.all(s).then(()=>{})})}_loadVolumePropertiesAsync(e,t,i,r){let n=this._loader._getOrCreateMaterialAdapter(i);if(0===n.transmissionWeight&&0===n.subsurfaceWeight||!r.thicknessFactor)return Promise.resolve();let s=void 0!==r.attenuationDistance?r.attenuationDistance:Number.MAX_VALUE,a=void 0!==r.attenuationColor&&3==r.attenuationColor.length?eu.v9.FromArray(r.attenuationColor):eu.v9.White(),o=new w.Pq(-Math.log(a.r),-Math.log(a.g),-Math.log(a.b));o.scaleInPlace(1/Math.max(s,.001)),n.extinctionCoefficient=o,n.transmissionDepth=s,n.transmissionColor=a,n.volumeThickness=r.thicknessFactor??0;let l=[];return r.thicknessTexture&&(r.thicknessTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${e}/thicknessTexture`,r.thicknessTexture,e=>{e.name=`${i.name} (Thickness)`,n.volumeThicknessTexture=e}))),Promise.all(l).then(()=>{})}}e9(ii),e8(ii,!0,e=>new ir(e));let is="KHR_materials_volume_scatter";class ia{constructor(e){this.name=is,this.order=172,this._loader=e,this.enabled=this._loader.isExtensionUsed(is),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadVolumePropertiesAsync(r,t,i,n)),await Promise.all(s).then(()=>{})})}_loadVolumePropertiesAsync(e,t,i,r){let n=this._loader._getOrCreateMaterialAdapter(i);if(0===n.transmissionWeight&&0===n.subsurfaceWeight)return Promise.resolve();let s=void 0!==r.multiscatterColor&&3==r.multiscatterColor.length?eu.v9.FromArray(r.multiscatterColor):eu.v9.Black(),a=void 0!==r.scatterAnisotropy?r.scatterAnisotropy:0;if(n.transmissionWeight>0){let t,o,l,u=(t=new w.Pq(s.r,s.g,s.b),(o=new w.Pq(4.09712,4.09712,4.09712)).multiplyInPlace(t),o.addInPlace(new w.Pq(4.20863,4.20863,4.20863)),(l=new w.Pq(9.59217,9.59217,9.59217)).addInPlace(new w.Pq(41.6808,41.6808,41.6808).multiplyInPlace(t)),l.addInPlace(new w.Pq(17.7126,17.7126,17.7126).multiplyInPlace(t.multiply(t))),o.subtractInPlace(new w.Pq(Math.sqrt(l.x),Math.sqrt(l.y),Math.sqrt(l.z))),new w.Pq(1,1,1).subtract(o.multiply(o))),h=new w.Pq(-Math.log(n.transmissionColor.r),-Math.log(n.transmissionColor.g),-Math.log(n.transmissionColor.b));h.scaleInPlace(1/Math.max(n.transmissionDepth,.001));let c=h.multiply(u);c.scaleInPlace(n.transmissionDepth),n.transmissionScatter.set(c.x,c.y,c.z);let d=Promise.resolve(null);return r.multiscatterColorTexture&&(r.multiscatterColorTexture.nonColorData=!0,d=this._loader.loadTextureInfoAsync(`${e}/multiscatterColorTexture`,r.multiscatterColorTexture,e=>{e.name=`${i.name} (Transmission)`,n.transmissionWeightTexture=e})),n.transmissionScatterAnisotropy=a,d.then(()=>{})}if(n.subsurfaceWeight>0){n.subsurfaceScatterAnisotropy=a,n.subsurfaceColor=s;let e=new w.Pq(0!==n.extinctionCoefficient.x?1/n.extinctionCoefficient.x:1,0!==n.extinctionCoefficient.y?1/n.extinctionCoefficient.y:1,0!==n.extinctionCoefficient.z?1/n.extinctionCoefficient.z:1);n.subsurfaceRadius=Math.max(e.x,e.y,e.z),n.subsurfaceRadiusScale=new eu.v9(e.x/n.subsurfaceRadius,e.y/n.subsurfaceRadius,e.z/n.subsurfaceRadius)}return Promise.resolve()}}e9(is),e8(is,!0,e=>new ia(e));let io="KHR_materials_dispersion";class il{constructor(e){this.name=io,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(io)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadDispersionPropertiesAsync(r,t,i,n)),await Promise.all(s).then(()=>{})})}_loadDispersionPropertiesAsync(e,t,i,r){let n=this._loader._getOrCreateMaterialAdapter(i);return 0!=n.transmissionWeight&&r.dispersion&&(n.transmissionDispersionAbbeNumber=20,n.transmissionDispersionScale=r.dispersion),Promise.resolve()}}e9(io),e8(io,!0,e=>new il(e));let iu="KHR_materials_diffuse_roughness";class ih{constructor(e){this.name=iu,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(iu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=[];return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadDiffuseRoughnessPropertiesAsync(r,n,i)),await Promise.all(s).then(()=>{})})}_loadDiffuseRoughnessPropertiesAsync(e,t,i){let r=this._loader._getOrCreateMaterialAdapter(i),n=[];return r.baseDiffuseRoughness=t.diffuseRoughnessFactor??0,t.diffuseRoughnessTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/diffuseRoughnessTexture`,t.diffuseRoughnessTexture,e=>{e.name=`${i.name} (Diffuse Roughness)`,r.baseDiffuseRoughnessTexture=e})),Promise.all(n).then(()=>{})}}e9(iu),e8(iu,!0,e=>new ih(e));let ic="KHR_mesh_quantization";class id{constructor(e){this.name=ic,this.enabled=e.isExtensionUsed(ic)}dispose(){}}e9(ic),e8(ic,!0,e=>new id(e));let ip="KHR_texture_basisu";class i_{constructor(e){this.name=ip,this._loader=e,this.enabled=e.isExtensionUsed(ip)}dispose(){this._loader=null}_loadTextureAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>{let s=void 0==t.sampler?to.DefaultSampler:ts.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),a=ts.Get(`${r}/source`,this._loader.gltf.images,n.source);return await this._loader._createTextureAsync(e,s,a,e=>{i(e)},t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)})}}e9(ip),e8(ip,!0,e=>new i_(e));let im="KHR_texture_transform";class ig{constructor(e){this.name=im,this._loader=e,this.enabled=this._loader.isExtensionUsed(im)}dispose(){this._loader=null}loadTextureInfoAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(r,n)=>await this._loader.loadTextureInfoAsync(e,t,e=>{if(!(e instanceof eg.g))throw Error(`${r}: Texture type not supported`);n.offset&&(e.uOffset=n.offset[0],e.vOffset=n.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,n.rotation&&(e.wAng=-n.rotation),n.scale&&(e.uScale=n.scale[0],e.vScale=n.scale[1]),void 0!=n.texCoord&&(e.coordinatesIndex=n.texCoord),i(e)}))}}e9(im),e8(im,!0,e=>new ig(e));let ib="KHR_xmp_json_ld";class iy{constructor(e){this.name=ib,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(ib)}dispose(){this._loader=null}onLoading(){if(null===this._loader.rootBabylonMesh)return;let e=this._loader.gltf.extensions?.KHR_xmp_json_ld,t=this._loader.gltf.asset?.extensions?.KHR_xmp_json_ld;if(e&&t){let i=+t.packet;e.packets&&i<e.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=e.packets[i])}}}function ix(e,t,i,r){return eu.v9.FromArray(t,i).scale(r)}function iT(e,t,i,r){return t[i]*r}function iv(e,t,i,r){return-t[i]*r}function iA(e,t,i,r){return t[i+1]*r}function iS(e,t,i,r){return t[i]*r*2}function iE(e){return{scale:[new iR(M.X5.ANIMATIONTYPE_FLOAT,`${e}.uScale`,iT,()=>2),new iR(M.X5.ANIMATIONTYPE_FLOAT,`${e}.vScale`,iA,()=>2)],offset:[new iR(M.X5.ANIMATIONTYPE_FLOAT,`${e}.uOffset`,iT,()=>2),new iR(M.X5.ANIMATIONTYPE_FLOAT,`${e}.vOffset`,iA,()=>2)],rotation:[new iR(M.X5.ANIMATIONTYPE_FLOAT,`${e}.wAng`,iv,()=>1)]}}e9(ib),e8(ib,!0,e=>new iy(e));class iI extends tl.AnimationPropertyInfo{buildAnimations(e,t,i,r){return[{babylonAnimatable:e._babylonCamera,babylonAnimation:this._buildAnimation(t,i,r)}]}}class iR extends tl.AnimationPropertyInfo{buildAnimations(e,t,i,r){let n=[];for(let s in e._data)n.push({babylonAnimatable:e._data[s].babylonMaterial,babylonAnimation:this._buildAnimation(t,i,r)});return n}}class iP extends tl.AnimationPropertyInfo{buildAnimations(e,t,i,r){return[{babylonAnimatable:e._babylonLight,babylonAnimation:this._buildAnimation(t,i,r)}]}}class iM extends tl.AnimationPropertyInfo{buildAnimations(e,t,i,r){return e._primitiveBabylonMeshes?e._primitiveBabylonMeshes.map(e=>({babylonAnimatable:e,babylonAnimation:this._buildAnimation(t,i,r)})):[]}}(0,e7.ZU)("/cameras/{}/orthographic/xmag",[new iI(M.X5.ANIMATIONTYPE_FLOAT,"orthoLeft",iv,()=>1),new iI(M.X5.ANIMATIONTYPE_FLOAT,"orthoRight",iA,()=>1)]),(0,e7.ZU)("/cameras/{}/orthographic/ymag",[new iI(M.X5.ANIMATIONTYPE_FLOAT,"orthoBottom",iv,()=>1),new iI(M.X5.ANIMATIONTYPE_FLOAT,"orthoTop",iA,()=>1)]),(0,e7.ZU)("/cameras/{}/orthographic/zfar",[new iI(M.X5.ANIMATIONTYPE_FLOAT,"maxZ",iT,()=>1)]),(0,e7.ZU)("/cameras/{}/orthographic/znear",[new iI(M.X5.ANIMATIONTYPE_FLOAT,"minZ",iT,()=>1)]),(0,e7.ZU)("/cameras/{}/perspective/yfov",[new iI(M.X5.ANIMATIONTYPE_FLOAT,"fov",iT,()=>1)]),(0,e7.ZU)("/cameras/{}/perspective/zfar",[new iI(M.X5.ANIMATIONTYPE_FLOAT,"maxZ",iT,()=>1)]),(0,e7.ZU)("/cameras/{}/perspective/znear",[new iI(M.X5.ANIMATIONTYPE_FLOAT,"minZ",iT,()=>1)]),(0,e7.ZU)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new iR(M.X5.ANIMATIONTYPE_COLOR3,"albedoColor",ix,()=>4),new iR(M.X5.ANIMATIONTYPE_FLOAT,"alpha",function(e,t,i,r){return t[i+3]*r},()=>4)]),(0,e7.ZU)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"metallic",iT,()=>1)]),(0,e7.ZU)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"roughness",iT,()=>1)]);let iC=iE("albedoTexture");(0,e7.ZU)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",iC.scale),(0,e7.ZU)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",iC.offset),(0,e7.ZU)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",iC.rotation);let iO=iE("metallicTexture");(0,e7.ZU)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",iO.scale),(0,e7.ZU)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",iO.offset),(0,e7.ZU)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",iO.rotation),(0,e7.ZU)("/materials/{}/emissiveFactor",[new iR(M.X5.ANIMATIONTYPE_COLOR3,"emissiveColor",ix,()=>3)]);let iw=iE("bumpTexture");(0,e7.ZU)("/materials/{}/normalTexture/scale",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"bumpTexture.level",iT,()=>1)]),(0,e7.ZU)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",iw.scale),(0,e7.ZU)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",iw.offset),(0,e7.ZU)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",iw.rotation),(0,e7.ZU)("/materials/{}/occlusionTexture/strength",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",iT,()=>1)]);let iD=iE("ambientTexture");(0,e7.ZU)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",iD.scale),(0,e7.ZU)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",iD.offset),(0,e7.ZU)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",iD.rotation);let iN=iE("emissiveTexture");(0,e7.ZU)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",iN.scale),(0,e7.ZU)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",iN.offset),(0,e7.ZU)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",iN.rotation),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"anisotropy.angle",iT,()=>1)]);let iL=iE("anisotropy.texture");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",iL.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",iL.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",iL.rotation),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",iT,()=>1)]);let iF=iE("clearCoat.texture");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",iF.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",iF.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",iF.rotation);let iB=iE("clearCoat.bumpTexture");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",iB.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",iB.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",iB.rotation);let ik=iE("clearCoat.textureRoughness");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",ik.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",ik.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",ik.rotation),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"emissiveIntensity",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_ior/ior",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"indexOfRefraction",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"iridescence.intensity",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",iT,()=>1)]);let iU=iE("iridescence.texture");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",iU.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",iU.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",iU.rotation);let iV=iE("iridescence.thicknessTexture");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",iV.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",iV.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",iV.rotation),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new iR(M.X5.ANIMATIONTYPE_COLOR3,"sheen.color",ix,()=>3)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"sheen.roughness",iT,()=>1)]);let iG=iE("sheen.texture");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",iG.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",iG.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",iG.rotation);let iz=iE("sheen.textureRoughness");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",iz.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",iz.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",iz.rotation),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"metallicF0Factor",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new iR(M.X5.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",ix,()=>3)]);let i$=iE("metallicReflectanceTexture");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",i$.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",i$.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",i$.rotation);let iH=iE("reflectanceTexture");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",iH.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",iH.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",iH.rotation),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",iT,()=>1)]);let iW=iE("subSurface.refractionIntensityTexture");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",iW.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",iW.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",iW.rotation),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new iR(M.X5.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",ix,()=>3)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",iT,()=>1)]),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",iT,()=>1)]);let iq=iE("subSurface.thicknessTexture");(0,e7.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",iq.scale),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",iq.offset),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",iq.rotation),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new iR(M.X5.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",iT,()=>1)]);let ij=iE("subSurface.translucencyIntensityTexture");(0,e7.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",ij.scale),(0,e7.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",ij.offset),(0,e7.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",ij.rotation),(0,e7.ZU)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new iR(M.X5.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",ix,()=>3)]);let iX=iE("subSurface.translucencyColorTexture");(0,e7.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",iX.scale),(0,e7.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",iX.offset),(0,e7.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",iX.rotation),(0,e7.ZU)("/extensions/KHR_lights_punctual/lights/{}/color",[new iP(M.X5.ANIMATIONTYPE_COLOR3,"diffuse",ix,()=>3)]),(0,e7.ZU)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new iP(M.X5.ANIMATIONTYPE_FLOAT,"intensity",iT,()=>1)]),(0,e7.ZU)("/extensions/KHR_lights_punctual/lights/{}/range",[new iP(M.X5.ANIMATIONTYPE_FLOAT,"range",iT,()=>1)]),(0,e7.ZU)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new iP(M.X5.ANIMATIONTYPE_FLOAT,"innerAngle",iS,()=>1)]),(0,e7.ZU)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new iP(M.X5.ANIMATIONTYPE_FLOAT,"angle",iS,()=>1)]),(0,e7.ZU)("/extensions/EXT_lights_area/lights/{}/color",[new iP(M.X5.ANIMATIONTYPE_COLOR3,"diffuse",ix,()=>3)]),(0,e7.ZU)("/extensions/EXT_lights_area/lights/{}/intensity",[new iP(M.X5.ANIMATIONTYPE_FLOAT,"intensity",iT,()=>1)]),(0,e7.ZU)("/extensions/EXT_lights_area/lights/{}/size",[new iP(M.X5.ANIMATIONTYPE_FLOAT,"radius",iT,()=>1)]),(0,e7.ZU)("/extensions/EXT_lights_area/lights/{}/rect/aspect",[new iP(M.X5.ANIMATIONTYPE_FLOAT,"radius",iT,()=>1)]),(0,e7.ZU)("/nodes/{}/extensions/EXT_lights_ies/color",[new iP(M.X5.ANIMATIONTYPE_COLOR3,"diffuse",ix,()=>3)]),(0,e7.ZU)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new iP(M.X5.ANIMATIONTYPE_FLOAT,"intensity",iT,()=>1)]),(0,e7.ZU)("/nodes/{}/extensions/KHR_node_visibility/visible",[new iM(M.X5.ANIMATIONTYPE_FLOAT,"isVisible",iT,()=>1)]);let iZ="KHR_animation_pointer";class iY{constructor(e){this.name=iZ,this._loader=e,this._pathToObjectConverter=(0,e7.Wt)(this._loader.gltf)}get enabled(){return this._loader.isExtensionUsed(iZ)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(e,t,i,r,n){let s=r.target.extensions?.KHR_animation_pointer;if(!s||!this._pathToObjectConverter)return null;"pointer"!==r.target.path&&X.V.Warn(`${e}/target/path: Value (${r.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=r.target.node&&X.V.Warn(`${e}/target/node: Value (${r.target.node}) must not be present when using the ${this.name} extension`);let a=`${e}/extensions/${this.name}`,o=s.pointer;if(!o)throw Error(`${a}: Pointer is missing`);try{let s=this._pathToObjectConverter.convert(o);if(!s.info.interpolation)throw Error(`${a}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(e,t,i,r,{object:s.object,info:s.info.interpolation},n)}catch(e){return X.V.Warn(`${a}/pointer: Invalid pointer (${o}) skipped`),null}}}e9(iZ),e8(iZ,!0,e=>new iY(e));var iK=i(21331),iQ=i(68667),iJ=i(10124);i(62861);let i0="MSFT_audio_emitter";class i1{constructor(e){this.name=i0,this._loader=e,this.enabled=this._loader.isExtensionUsed(i0)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){let e=this._loader.gltf.extensions;if(e&&e[this.name]){let t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,ts.Assign(this._clips),ts.Assign(this._emitters)}}loadSceneAsync(e,t){return to.LoadExtensionAsync(e,t,this.name,async(i,r)=>{let n=[];for(let s of(n.push(this._loader.loadSceneAsync(e,t)),r.emitters)){let e=ts.Get(`${i}/emitters`,this._emitters,s);if(void 0!=e.refDistance||void 0!=e.maxDistance||void 0!=e.rolloffFactor||void 0!=e.distanceModel||void 0!=e.innerAngle||void 0!=e.outerAngle)throw Error(`${i}: Direction or Distance properties are not allowed on emitters attached to a scene`);n.push(this._loadEmitterAsync(`${i}/emitters/${e.index}`,e))}await Promise.all(n)})}loadNodeAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(e,r)=>{let n=[],s=await this._loader.loadNodeAsync(e,t,t=>{for(let i of r.emitters){let r=ts.Get(`${e}/emitters`,this._emitters,i);n.push(this._loadEmitterAsync(`${e}/emitters/${r.index}`,r).then(()=>{for(let e of r._babylonSounds)e.attachToMesh(t),(void 0!=r.innerAngle||void 0!=r.outerAngle)&&(e.setLocalDirectionToMesh(w.Pq.Forward()),e.setDirectionalCone(2*D.S0.ToDegrees(void 0==r.innerAngle?Math.PI:r.innerAngle),2*D.S0.ToDegrees(void 0==r.outerAngle?Math.PI:r.outerAngle),0))}))}i(t)});return await Promise.all(n),s})}loadAnimationAsync(e,t){return to.LoadExtensionAsync(e,t,this.name,async(i,r)=>{let n=await this._loader.loadAnimationAsync(e,t),s=[];for(let a of(ts.Assign(r.events),r.events))s.push(this._loadAnimationEventAsync(`${i}/events/${a.index}`,e,t,a,n));return await Promise.all(s),n})}_loadClipAsync(e,t){let i;if(t._objectURL)return t._objectURL;if(t.uri)i=this._loader.loadUriAsync(e,t,t.uri);else{let r=ts.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,t.bufferView);i=this._loader.loadBufferViewAsync(`/bufferViews/${r.index}`,r)}return t._objectURL=i.then(e=>URL.createObjectURL(new Blob([e],{type:t.mimeType}))),t._objectURL}_loadEmitterAsync(e,t){if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){let e=[],i=t.name||`emitter${t.index}`,r={loop:!1,autoplay:!1,volume:void 0==t.volume?1:t.volume};for(let n=0;n<t.clips.length;n++){let s=`/extensions/${this.name}/clips`,a=ts.Get(s,this._clips,t.clips[n].clip);e.push(this._loadClipAsync(`${s}/${t.clips[n].clip}`,a).then(e=>{let s=t._babylonSounds[n]=new iQ.A(i,e,this._loader.babylonScene,null,r);s.refDistance=t.refDistance||1,s.maxDistance=t.maxDistance||256,s.rolloffFactor=t.rolloffFactor||1,s.distanceModel=t.distanceModel||"exponential"}))}let n=Promise.all(e).then(()=>{let e=t.clips.map(e=>e.weight||1),i=new iJ.r(t.loop||!1,t._babylonSounds,e);t.innerAngle&&(i.directionalConeInnerAngle=2*D.S0.ToDegrees(t.innerAngle)),t.outerAngle&&(i.directionalConeOuterAngle=2*D.S0.ToDegrees(t.outerAngle)),t.volume&&(i.volume=t.volume),t._babylonData.sound=i});t._babylonData={loaded:n}}return t._babylonData.loaded}_getEventAction(e,t,i,r,n){switch(i){case"play":return e=>{t.play((n||0)+(e-r))};case"stop":return()=>{t.stop()};case"pause":return()=>{t.pause()};default:throw Error(`${e}: Unsupported action ${i}`)}}_loadAnimationEventAsync(e,t,i,r,n){if(0==n.targetedAnimations.length)return Promise.resolve();let s=n.targetedAnimations[0],a=r.emitter,o=ts.Get(`/extensions/${this.name}/emitters`,this._emitters,a);return this._loadEmitterAsync(e,o).then(()=>{let t=o._babylonData.sound;if(t){let i=new iK.p(r.time,this._getEventAction(e,t,r.action,r.time,r.startOffset));s.animation.addEvent(i),n.onAnimationGroupEndObservable.add(()=>{t.stop()}),n.onAnimationGroupPauseObservable.add(()=>{t.pause()})}})}}e9(i0),e8(i0,!0,e=>new i1(e));let i2="MSFT_lod";class i3{constructor(e){this.name=i2,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new j.cP,this.onMaterialLODsLoadedObservable=new j.cP,this._bufferLODs=[],this._nodeIndexLOD=null,this._nodeSignalLODs=[],this._nodePromiseLODs=[],this._nodeBufferLODs=[],this._materialIndexLOD=null,this._materialSignalLODs=[],this._materialPromiseLODs=[],this._materialBufferLODs=[],this._loader=e,this.maxLODsToLoad=this._loader.parent.extensionOptions[i2]?.maxLODsToLoad??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(i2)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let e=0;e<this._nodePromiseLODs.length;e++){let t=Promise.all(this._nodePromiseLODs[e]).then(()=>{0!==e&&(this._loader.endPerformanceCounter(`Node LOD ${e}`),this._loader.log(`Loaded node LOD ${e}`)),this.onNodeLODsLoadedObservable.notifyObservers(e),e!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${e+1}`),this._loadBufferLOD(this._nodeBufferLODs,e+1),this._nodeSignalLODs[e]&&this._nodeSignalLODs[e].resolve())});this._loader._completePromises.push(t)}for(let e=0;e<this._materialPromiseLODs.length;e++){let t=Promise.all(this._materialPromiseLODs[e]).then(()=>{0!==e&&(this._loader.endPerformanceCounter(`Material LOD ${e}`),this._loader.log(`Loaded material LOD ${e}`)),this.onMaterialLODsLoadedObservable.notifyObservers(e),e!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${e+1}`),this._loadBufferLOD(this._materialBufferLODs,e+1),this._materialSignalLODs[e]&&this._materialSignalLODs[e].resolve())});this._loader._completePromises.push(t)}}loadSceneAsync(e,t){let i=this._loader.loadSceneAsync(e,t);return this._loadBufferLOD(this._bufferLODs,0),i}loadNodeAsync(e,t,i){return to.LoadExtensionAsync(e,t,this.name,async(e,r)=>{let n,s=this._getLODs(e,t,this._loader.gltf.nodes,r.ids);this._loader.logOpen(`${e}`);for(let e=0;e<s.length;e++){let t=s[e];0!==e&&(this._nodeIndexLOD=e,this._nodeSignalLODs[e]=this._nodeSignalLODs[e]||new e0.c);let r=e=>{i(e),e.setEnabled(!1)},a=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,r).then(t=>{if(0!==e){let t=s[e-1];t._babylonTransformNode&&(this._disposeTransformNode(t._babylonTransformNode),delete t._babylonTransformNode)}return t.setEnabled(!0),t});this._nodePromiseLODs[e]=this._nodePromiseLODs[e]||[],0===e?n=a:(this._nodeIndexLOD=null,this._nodePromiseLODs[e].push(a))}return this._loader.logClose(),await n})}_loadMaterialAsync(e,t,i,r,n){return this._nodeIndexLOD?null:to.LoadExtensionAsync(e,t,this.name,async(e,s)=>{let a,o=this._getLODs(e,t,this._loader.gltf.materials,s.ids);this._loader.logOpen(`${e}`);for(let e=0;e<o.length;e++){let t=o[e];0!==e&&(this._materialIndexLOD=e);let s=this._loader._loadMaterialAsync(`/materials/${t.index}`,t,i,r,t=>{0===e&&n(t)}).then(t=>{if(0!==e){n(t);let i=o[e-1]._data;i[r]&&(this._disposeMaterials([i[r].babylonMaterial]),delete i[r])}return t});this._materialPromiseLODs[e]=this._materialPromiseLODs[e]||[],0===e?a=s:(this._materialIndexLOD=null,this._materialPromiseLODs[e].push(s))}return this._loader.logClose(),await a})}_loadUriAsync(e,t,i){if(null!==this._nodeIndexLOD){this._loader.log("deferred");let r=this._nodeIndexLOD-1;return this._nodeSignalLODs[r]=this._nodeSignalLODs[r]||new e0.c,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(async()=>await this._loader.loadUriAsync(e,t,i))}if(null!==this._materialIndexLOD){this._loader.log("deferred");let r=this._materialIndexLOD-1;return this._materialSignalLODs[r]=this._materialSignalLODs[r]||new e0.c,this._materialSignalLODs[r].promise.then(async()=>await this._loader.loadUriAsync(e,t,i))}return null}loadBufferAsync(e,t,i,r){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);let t=async(e,t)=>{let n=i+r-1,s=e[t];return s?(s.start=Math.min(s.start,i),s.end=Math.max(s.end,n)):(s={start:i,end:n,loaded:new e0.c},e[t]=s),await s.loaded.promise.then(e=>new Uint8Array(e.buffer,e.byteOffset+i-s.start,r))};return(this._loader.log("deferred"),null!==this._nodeIndexLOD)?t(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?t(this._materialBufferLODs,this._materialIndexLOD):t(this._bufferLODs,0)}return null}_loadBufferLOD(e,t){let i=e[t];i&&(this._loader.log(`Loading buffer range [${i.start}-${i.end}]`),this._loader.bin.readAsync(i.start,i.end-i.start+1).then(e=>{i.loaded.resolve(e)},e=>{i.loaded.reject(e)}))}_getLODs(e,t,i,r){if(this.maxLODsToLoad<=0)throw Error("maxLODsToLoad must be greater than zero");let n=[];for(let t=r.length-1;t>=0;t--)if(n.push(ts.Get(`${e}/ids/${r[t]}`,i,r[t])),n.length===this.maxLODsToLoad)return n;return n.push(t),n}_disposeTransformNode(e){let t=[],i=e.material;for(let r of(i&&t.push(i),e.getChildMeshes()))r.material&&t.push(r.material);e.dispose();let r=t.filter(e=>this._loader.babylonScene.meshes.every(t=>t.material!=e));this._disposeMaterials(r)}_disposeMaterials(e){let t={};for(let i of e){for(let e of i.getActiveTextures())t[e.uniqueId]=e;i.dispose()}for(let e in t)for(let i of this._loader.babylonScene.materials)i.hasTexture(t[e])&&delete t[e];for(let e in t)t[e].dispose()}}e9(i2),e8(i2,!0,e=>new i3(e));let i4="MSFT_minecraftMesh";class i5{constructor(e){this.name=i4,this._loader=e,this.enabled=this._loader.isExtensionUsed(i4)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtraAsync(e,t,this.name,async(r,n)=>{if(n){if(!this._loader._pbrMaterialImpl)throw Error(`${r}: Material type not supported`);let n=this._loader.loadMaterialPropertiesAsync(e,t,i);return i.needAlphaBlending()&&(i.forceDepthWrite=!0,i.separateCullingPass=!0),i.backFaceCulling=i.forceDepthWrite,i.twoSidedLighting=!0,await n}})}}e9(i4),e8(i4,!0,e=>new i5(e));let i6="MSFT_sRGBFactors";class i8{constructor(e){this.name=i6,this._loader=e,this.enabled=this._loader.isExtensionUsed(i6)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return to.LoadExtraAsync(e,t,this.name,async(r,n)=>{if(n){let r=this._loader._getOrCreateMaterialAdapter(i),n=this._loader.loadMaterialPropertiesAsync(e,t,i),s=i.getScene().getEngine().useExactSrgbConversions;return r.baseColorTexture||r.baseColor.toLinearSpaceToRef(r.baseColor,s),r.specularColorTexture||r.specularColor.toLinearSpaceToRef(r.specularColor,s),await n}})}}e9(i6),e8(i6,!0,e=>new i8(e));var i9=i(36262),i7=i(6457),re=i(94663);function rt(e){let[t,i]=e.split(":");return ri({op:t,extension:i})}function ri(e,t=!0){let i=e.extension?rn[e.extension]?.[e.op]:rs[e.op];if(!i&&(X.V.Warn(`No mapping found for operation ${e.op} and extension ${e.extension||"KHR_interactivity"}`),t)){let t={},i={flows:{}};if(e.inputValueSockets)for(let i in t.values={},e.inputValueSockets)t.values[i]={name:i};return e.outputValueSockets&&(i.values={},Object.keys(e.outputValueSockets).forEach(e=>{i.values[e]={name:e}})),{blocks:[],inputs:t,outputs:i}}return i}function rr(e,t,i){rn[t]||(rn[t]={}),rn[t][e]=i}let rn={BABYLON:{"flow/log":{blocks:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},rs={"event/onStart":{blocks:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{blocks:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{blocks:["FlowGraphSendCustomEventBlock"],extraProcessor(e,t,i,r,n){if("event/send"!==t.op||!e.configuration||1!==Object.keys(e.configuration).length)throw Error("Receive event should have a single configuration object, the event itself");let s=e.configuration.event,a=s.value?.[0];if("number"!=typeof a)throw Error("Event id should be a number");let o=r.arrays.events[a],l=n[0];return l.config||(l.config={}),l.config.eventId=o.eventId,l.config.eventData=o.eventData,n}},"event/receive":{blocks:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(e,t){if(!e.configuration)return X.V.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};let i=e.configuration.event;if(!i)return X.V.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};let r=i.value?.[0];return"number"!=typeof r?(X.V.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"}):t.events?.[r]?{valid:!0}:(X.V.Error(`Event with id ${r} not found`),{valid:!1,error:`Event with id ${r} not found`})},extraProcessor(e,t,i,r,n){if("event/receive"!==t.op||!e.configuration||1!==Object.keys(e.configuration).length)throw Error("Receive event should have a single configuration object, the event itself");let s=e.configuration.event,a=s.value?.[0];if("number"!=typeof a)throw Error("Event id should be a number");let o=r.arrays.events[a],l=n[0];return l.config||(l.config={}),l.config.eventId=o.eventId,l.config.eventData=o.eventData,n}},"math/E":ra("FlowGraphEBlock"),"math/Pi":ra("FlowGraphPIBlock"),"math/Inf":ra("FlowGraphInfBlock"),"math/NaN":ra("FlowGraphNaNBlock"),"math/abs":ra("FlowGraphAbsBlock"),"math/sign":ra("FlowGraphSignBlock"),"math/trunc":ra("FlowGraphTruncBlock"),"math/floor":ra("FlowGraphFloorBlock"),"math/ceil":ra("FlowGraphCeilBlock"),"math/round":{blocks:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,i,r,n){var s;return(s=n[0]).config||(s.config={}),n[0].config.roundHalfAwayFromZero=!0,n}},"math/fract":ra("FlowGraphFractBlock"),"math/neg":ra("FlowGraphNegationBlock"),"math/add":ra("FlowGraphAddBlock",["a","b"],!0),"math/sub":ra("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{blocks:["FlowGraphMultiplyBlock"],extraProcessor(e,t,i,r,n){var s;(s=n[0]).config||(s.config={}),n[0].config.useMatrixPerComponent=!0,n[0].config.preventIntegerFloatArithmetic=!0;let a=-1;return Object.keys(e.values||{}).find(t=>e.values?.[t].type!==void 0&&(a=e.values[t].type,!0)),-1!==a&&(n[0].config.type=r.arrays.types[a].flowGraphType),n},validation:e=>e.values?ro(e):{valid:!0}},"math/div":ra("FlowGraphDivideBlock",["a","b"],!0),"math/rem":ra("FlowGraphModuloBlock",["a","b"]),"math/min":ra("FlowGraphMinBlock",["a","b"]),"math/max":ra("FlowGraphMaxBlock",["a","b"]),"math/clamp":ra("FlowGraphClampBlock",["a","b","c"]),"math/saturate":ra("FlowGraphSaturateBlock"),"math/mix":ra("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":ra("FlowGraphEqualityBlock",["a","b"]),"math/lt":ra("FlowGraphLessThanBlock",["a","b"]),"math/le":ra("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":ra("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":ra("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isNaN":ra("FlowGraphIsNaNBlock"),"math/isInf":ra("FlowGraphIsInfBlock"),"math/select":{blocks:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{blocks:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":ra("FlowGraphSinBlock"),"math/cos":ra("FlowGraphCosBlock"),"math/tan":ra("FlowGraphTanBlock"),"math/asin":ra("FlowGraphASinBlock"),"math/acos":ra("FlowGraphACosBlock"),"math/atan":ra("FlowGraphATanBlock"),"math/atan2":ra("FlowGraphATan2Block",["a","b"]),"math/sinh":ra("FlowGraphSinhBlock"),"math/cosh":ra("FlowGraphCoshBlock"),"math/tanh":ra("FlowGraphTanhBlock"),"math/asinh":ra("FlowGraphASinhBlock"),"math/acosh":ra("FlowGraphACoshBlock"),"math/atanh":ra("FlowGraphATanhBlock"),"math/exp":ra("FlowGraphExponentialBlock"),"math/log":ra("FlowGraphLogBlock"),"math/log2":ra("FlowGraphLog2Block"),"math/log10":ra("FlowGraphLog10Block"),"math/sqrt":ra("FlowGraphSquareRootBlock"),"math/cbrt":ra("FlowGraphCubeRootBlock"),"math/pow":ra("FlowGraphPowerBlock",["a","b"]),"math/length":ra("FlowGraphLengthBlock"),"math/normalize":ra("FlowGraphNormalizeBlock"),"math/dot":ra("FlowGraphDotBlock",["a","b"]),"math/cross":ra("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":{blocks:["FlowGraphRotate2DBlock"],inputs:{values:{a:{name:"a"},angle:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/rotate3D":{blocks:["FlowGraphRotate3DBlock"],inputs:{values:{a:{name:"a"},rotation:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/transform":{blocks:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{blocks:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{blocks:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{blocks:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{blocks:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{blocks:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{blocks:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":ra("FlowGraphTransposeBlock"),"math/determinant":ra("FlowGraphDeterminantBlock"),"math/inverse":ra("FlowGraphInvertMatrixBlock"),"math/matMul":ra("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{blocks:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"scaling",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,i,r,n,s){let a=n[0].dataInputs.find(e=>"rotationQuaternion"===e.name);if(!a)throw Error("Rotation quaternion input not found");return s._connectionValues[a.uniqueId]&&(s._connectionValues[a.uniqueId].type="Quaternion"),n}},"math/matDecompose":{blocks:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"scaling"}}}},"math/quatConjugate":ra("FlowGraphConjugateBlock",["a"]),"math/quatMul":{blocks:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,i,r,n){var s;return(s=n[0]).config||(s.config={}),n[0].config.type="Quaternion",n}},"math/quatAngleBetween":ra("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{blocks:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":ra("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":ra("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{blocks:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,i,r,n){var s;return(s=n[0]).config||(s.config={}),n[0].config.inputIsColumnMajor=!0,n}},"math/extract2x2":{blocks:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{blocks:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,i,r,n){var s;return(s=n[0]).config||(s.config={}),n[0].config.inputIsColumnMajor=!0,n}},"math/extract3x3":{blocks:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{blocks:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,i,r,n){var s;return(s=n[0]).config||(s.config={}),n[0].config.inputIsColumnMajor=!0,n}},"math/extract4x4":{blocks:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{blocks:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,i,r,n,s){var a;(a=n[0]).config||(a.config={});let o=n[0].dataInputs[0];return n[0].config.valueType=s._connectionValues[o.uniqueId]?.type??"FlowGraphInteger",n}},"math/and":{blocks:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,i,r,n,s){var a;(a=n[0]).config||(a.config={});let o=n[0].dataInputs[0],l=n[0].dataInputs[1];return n[0].config.valueType=s._connectionValues[o.uniqueId]?.type??s._connectionValues[l.uniqueId]?.type??"FlowGraphInteger",n}},"math/or":{blocks:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,i,r,n,s){var a;(a=n[0]).config||(a.config={});let o=n[0].dataInputs[0],l=n[0].dataInputs[1];return n[0].config.valueType=s._connectionValues[o.uniqueId]?.type??s._connectionValues[l.uniqueId]?.type??"FlowGraphInteger",n}},"math/xor":{blocks:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,i,r,n,s){var a;(a=n[0]).config||(a.config={});let o=n[0].dataInputs[0],l=n[0].dataInputs[1];return n[0].config.valueType=s._connectionValues[o.uniqueId]?.type??s._connectionValues[l.uniqueId]?.type??"FlowGraphInteger",n}},"math/asr":ra("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":ra("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":ra("FlowGraphLeadingZerosBlock"),"math/ctz":ra("FlowGraphTrailingZerosBlock"),"math/popcnt":ra("FlowGraphOneBitsCounterBlock"),"math/rad":ra("FlowGraphDegToRadBlock"),"math/deg":ra("FlowGraphRadToDegBlock"),"type/boolToInt":ra("FlowGraphBooleanToInt"),"type/boolToFloat":ra("FlowGraphBooleanToFloat"),"type/intToBool":ra("FlowGraphIntToBoolean"),"type/intToFloat":ra("FlowGraphIntToFloat"),"type/floatToInt":ra("FlowGraphFloatToInt"),"type/floatToBool":ra("FlowGraphFloatToBoolean"),"flow/sequence":{blocks:["FlowGraphSequenceBlock"],extraProcessor(e,t,i,r,n){let s=n[0];return s.config||(s.config={}),s.config.outputSignalCount=Object.keys(e.flows||[]).length,s.signalOutputs.forEach((e,t)=>{e.name="out_"+t}),n}},"flow/branch":{blocks:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{blocks:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",isArray:!0,inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(e){let t=e.configuration?.cases;if(t&&t.value){if(!t.value.every(e=>"number"==typeof e&&/^-?\d+$/.test(e.toString())))return X.V.Warn("Switch cases should be integers. Using empty array instead."),t.value=[],{valid:!0};let e=new Set(t.value);t.value=Array.from(e)}return{valid:!0}},extraProcessor(e,t,i,r,n){if("flow/switch"!==t.op||!e.flows||0===Object.keys(e.flows).length)throw Error("Switch should have a single configuration object, the cases array");return n[0].signalOutputs.forEach(e=>{"default"!==e.name&&(e.name="out_"+e.name)}),n}},"flow/while":{blocks:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{blocks:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(e,t,i,r,n){let s=n[0];return s.config||(s.config={}),s.config.incrementIndexWhenLoopDone=!0,n}},"flow/doN":{blocks:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{blocks:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(e,t,i,r,n){if("flow/multiGate"!==t.op||!e.flows||0===Object.keys(e.flows).length)throw Error("MultiGate should have a single configuration object, the number of output flows");let s=n[0];return s.config||(s.config={}),s.config.outputSignalCount=Object.keys(e.flows).length,s.signalOutputs.forEach((e,t)=>{e.name="out_"+t}),n}},"flow/waitAll":{blocks:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation:e=>("number"!=typeof e.configuration?.inputFlows?.value?.[0]&&(e.configuration=e.configuration||{inputFlows:{value:[0]}},e.configuration.inputFlows.value=[0]),{valid:!0})},"flow/throttle":{blocks:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{blocks:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{blocks:["FlowGraphCancelDelayBlock"]},"variable/get":{blocks:["FlowGraphGetVariableBlock"],validation:e=>e.configuration?.variable?.value?{valid:!0}:(X.V.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"}),configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(e,t)=>t.getVariableName(e)}}},"variable/set":{blocks:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,isArray:!0,dataTransformer:(e,t)=>e.map(e=>t.getVariableName(e))}},extraProcessor:(e,t,i,r,n)=>(n[0].dataInputs.forEach(e=>{e.name=r.getVariableName(+e.name)}),n)},"variable/interpolate":{blocks:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(e,t)=>t.getVariableName(e)},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:e=>!0===e?"Quaternion":void 0}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(e,t,i,r,n){var s,a;let o=n[0],l=e.configuration?.variable.value?.[0];if("number"!=typeof l)throw X.V.Error("Variable index is not defined for variable interpolation block"),Error("Variable index is not defined for variable interpolation block");let u=r.arrays.staticVariables[l];void 0===o.config?.animationType?.value&&(o.config||(o.config={}),(s=o.config).animationType||(s.animationType={}),o.config.animationType.value=(0,re.U_)(u.type));let h=n[4];return h.config||(h.config={}),(a=h.config).variable||(a.variable={}),h.config.variable.value=r.getVariableName(l),n}},"pointer/get":{blocks:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,t,i,r,n)=>(n.forEach(e=>{"FlowGraphJsonPointerParserBlock"===e.className&&(e.config||(e.config={}),e.config.outputValue=!0)}),n)},"pointer/set":{blocks:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,t,i,r,n)=>(n.forEach(e=>{"FlowGraphJsonPointerParserBlock"===e.className&&(e.config||(e.config={}),e.config.outputValue=!0)}),n)},"pointer/interpolate":{blocks:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,t,i,r,n)=>(n.forEach(t=>{"FlowGraphJsonPointerParserBlock"===t.className?(t.config||(t.config={}),t.config.outputValue=!0):"FlowGraphInterpolationBlock"===t.className&&(t.config||(t.config={}),Object.keys(e.values||[]).forEach(i=>{let n=e.values?.[i];if("value"===i&&n){let e=n.type;void 0!==e&&(t.config.animationType=r.arrays.types[e].flowGraphType)}}))}),n)},"animation/start":{blocks:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(e,t)=>[e[0]*t._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(e,t)=>[e[0]*t._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,t,i,r,n,s,a){let o=n[n.length-1];return o.config||(o.config={}),o.config.glTF=a,n}},"animation/stop":{blocks:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,t,i,r,n,s,a){let o=n[n.length-1];return o.config||(o.config={}),o.config.glTF=a,n}},"animation/stopAt":{blocks:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(e,t)=>[e[0]*t._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,t,i,r,n,s,a){let o=n[n.length-1];return o.config||(o.config={}),o.config.glTF=a,n}},"math/switch":{blocks:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",isArray:!0,inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(e){let t=e.configuration?.cases;if(t&&t.value){if(!t.value.every(e=>"number"==typeof e&&/^-?\d+$/.test(e.toString())))return X.V.Warn("Switch cases should be integers. Using empty array instead."),t.value=[],{valid:!0};let e=new Set(t.value);t.value=Array.from(e)}return{valid:!0}},extraProcessor(e,t,i,r,n){let s=n[0];return s.dataInputs.forEach(e=>{"default"!==e.name&&"case"!==e.name&&(e.name="in_"+e.name)}),s.config||(s.config={}),s.config.treatCasesAsIntegers=!0,n}},"debug/log":{blocks:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function ra(e,t=["a"],i){return{blocks:[e],inputs:{values:t.reduce((e,t)=>(e[t]={name:t},e),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,r,n,s){var a;if(i){(a=s[0]).config||(a.config={}),s[0].config.preventIntegerFloatArithmetic=!0;let t=-1;Object.keys(e.values||{}).find(i=>e.values?.[i].type!==void 0&&(t=e.values[i].type,!0)),-1!==t&&(s[0].config.type=n.arrays.types[t].flowGraphType)}return s},validation:e=>i?ro(e):{valid:!0}}}function ro(e){if(e.values){let t=Object.keys(e.values).map(t=>e.values[t].type).filter(e=>void 0!==e);if(!t.every(e=>e===t[0]))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}function rl(){return Object.keys(rs)}var ru=i(74761);let rh={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Vector3",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class rc{constructor(e,t,i=60){this._interactivityGraph=e,this._gltf=t,this._animationTargetFps=i,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(let e of this._interactivityGraph.types)this._types.push(rh[e.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(let e of this._interactivityGraph.declarations){let t=ri(e);if(!t)throw X.V.Error(["No mapping found for declaration",e]),Error("Error parsing declarations");this._mappings.push({flowGraphMapping:t,fullOperationName:e.extension?e.op+":"+e.extension:e.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(let e of this._interactivityGraph.variables){let t=this._parseVariable(e);this._staticVariables.push(t)}}_parseVariable(e,t){let i=this._types[e.type];if(!i)throw X.V.Error(["No type found for variable",e]),Error("Error parsing variables");if(e.value&&e.value.length!==i.length)throw X.V.Error(["Invalid value length for variable",e,i]),Error("Error parsing variables");let r=e.value||[];if(!r.length)switch(i.flowGraphType){case"boolean":r.push(!1);break;case"FlowGraphInteger":r.push(0);break;case"number":r.push(NaN);break;case"Vector2":r.push(NaN,NaN);break;case"Vector3":r.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":r.fill(NaN,0,4);break;case"Matrix":r.fill(NaN,0,16);break;case"Matrix3D":r.fill(NaN,0,9)}return"number"===i.elementType&&"string"==typeof r[0]&&(r[0]=parseFloat(r[0])),{type:i.flowGraphType,value:t?t(r,this):r}}_parseEvents(){if(this._interactivityGraph.events)for(let e of this._interactivityGraph.events){let t={eventId:e.id||"internalEvent_"+this._internalEventsCounter++};e.values&&(t.eventData=Object.keys(e.values).map(t=>{let i=e.values?.[t];if(!i)throw X.V.Error(["No value found for event key",t]),Error("Error parsing events");let r=this._types[i.type];if(!r)throw X.V.Error(["No type found for event value",i]),Error("Error parsing events");let n=void 0!==i.value?this._parseVariable(i):void 0;return{id:t,type:r.flowGraphType,eventData:!0,value:n}})),this._events.push(t)}}_parseNodes(){if(this._interactivityGraph.nodes)for(let e of this._interactivityGraph.nodes){if("number"!=typeof e.declaration)throw X.V.Error(["No declaration found for node",e]),Error("Error parsing nodes");let t=this._mappings[e.declaration];if(!t)throw X.V.Error(["No mapping found for node",e]),Error("Error parsing nodes");if(t.flowGraphMapping.validation){let i=t.flowGraphMapping.validation(e,this._interactivityGraph,this._gltf);if(!i.valid)throw Error(`Error validating interactivity node ${this._interactivityGraph.declarations?.[e.declaration].op} - ${i.error}`)}let i=[];for(let r of t.flowGraphMapping.blocks){let n=this._getEmptyBlock(r,t.fullOperationName);this._parseNodeConfiguration(e,n,t.flowGraphMapping,r),i.push(n)}this._nodes.push({blocks:i,fullOperationName:t.fullOperationName})}}_getEmptyBlock(e,t){return{uniqueId:(0,ru.z)(),className:e,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:t,metadata:{}}}_parseNodeConfiguration(e,t,i,r){let n=e.configuration;if(n)for(let e in n){let s=n[e];if(!s)throw Error("Error parsing node configuration");let a=i.configuration?.[e];if(a&&a.toBlock?a.toBlock===r:0===i.blocks.indexOf(r)){let i=a?.defaultValue;s?.value&&(i=s.value),a?.isArray||(1!==i.length&&X.V.Warn(`Invalid non-array value length: ${i.length}`),i=i[0]),a?.dataTransformer&&(i=a.dataTransformer(i,this)),void 0!==i&&(t.config[a?.name||e]={value:i})}}}_parseNodeConnections(e){for(let t=0;t<this._nodes.length;t++){let i=this._interactivityGraph.nodes?.[t];if(!i)throw X.V.Error(["No node found for interactivity node",this._nodes[t]]),Error("Error parsing node connections");let r=this._nodes[t],n=this._mappings[i.declaration];if(!n)throw X.V.Error(["No mapping found for node",i]),Error("Error parsing node connections");let s=i.flows||{};for(let e of Object.keys(s).sort()){let t=s[e],i=n.flowGraphMapping.outputs?.flows?.[e],a=i?.name||e,o=this._createNewSocketConnection(a,!0);(i&&i.toBlock&&r.blocks.find(e=>e.className===i.toBlock)||r.blocks[0]).signalOutputs.push(o);let l=t.node,u=this._nodes[l];if(!u)throw X.V.Error(["No node found for input node id",l]),Error("Error parsing node connections");let h=rt(u.fullOperationName);if(!h)throw X.V.Error(["No mapping found for input node",u]),Error("Error parsing node connections");let c=h.inputs?.flows?.[t.socket||"in"],d=!1;if(!c)for(let e in h.inputs?.flows)e.startsWith("[")&&e.endsWith("]")&&(d=!0,c=h.inputs?.flows?.[e]);let p=c?d?c.name.replace("$1",t.socket||""):c.name:t.socket||"in",f=c&&c.toBlock&&u.blocks.find(e=>e.className===c.toBlock)||u.blocks[0],_=f.signalInputs.find(e=>e.name===p);_||(_=this._createNewSocketConnection(p),f.signalInputs.push(_)),_.connectedPointIds.push(o.uniqueId),o.connectedPointIds.push(_.uniqueId)}let a=i.values||{};for(let t of Object.keys(a)){let i=a[t],s=n.flowGraphMapping.inputs?.values?.[t],o=!1;if(!s)for(let e in n.flowGraphMapping.inputs?.values)e.startsWith("[")&&e.endsWith("]")&&(o=!0,s=n.flowGraphMapping.inputs?.values?.[e]);let l=s?o?s.name.replace("$1",t):s.name:t,u=this._createNewSocketConnection(l);if((s&&s.toBlock&&r.blocks.find(e=>e.className===s.toBlock)||r.blocks[0]).dataInputs.push(u),void 0!==i.value){let t=this._parseVariable(i,s&&s.dataTransformer);e._connectionValues[u.uniqueId]=t}else if(void 0!==i.node){let e=i.node,t=i.socket||"value",r=this._nodes[e];if(!r)throw X.V.Error(["No node found for output socket reference",i]),Error("Error parsing node connections");let n=rt(r.fullOperationName);if(!n)throw X.V.Error(["No mapping found for output socket reference",i]),Error("Error parsing node connections");let s=n.outputs?.values?.[t],a=!1;if(!s)for(let e in n.outputs?.values)e.startsWith("[")&&e.endsWith("]")&&(a=!0,s=n.outputs?.values?.[e]);let o=s?a?s.name.replace("$1",t):s?.name:t,l=s&&s.toBlock&&r.blocks.find(e=>e.className===s.toBlock)||r.blocks[0],h=l.dataOutputs.find(e=>e.name===o);h||(h=this._createNewSocketConnection(o,!0),l.dataOutputs.push(h)),u.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(u.uniqueId)}else throw X.V.Error(["Invalid value for value connection",i]),Error("Error parsing node connections")}if(n.flowGraphMapping.interBlockConnectors)for(let e of n.flowGraphMapping.interBlockConnectors){let t=e.input,i=e.output,n=e.isVariable;this._connectFlowGraphNodes(t,i,r.blocks[e.inputBlockIndex],r.blocks[e.outputBlockIndex],n)}if(n.flowGraphMapping.extraProcessor){let t=this._interactivityGraph.declarations?.[i.declaration];if(!t)throw X.V.Error(["No declaration found for extra processor",i]),Error("Error parsing node connections");r.blocks=n.flowGraphMapping.extraProcessor(i,t,n.flowGraphMapping,this,r.blocks,e,this._gltf)}}}_createNewSocketConnection(e,t){return{uniqueId:(0,ru.z)(),name:e,_connectionType:+!!t,connectedPointIds:[]}}_connectFlowGraphNodes(e,t,i,r,n){let s=n?i.dataInputs:i.signalInputs,a=n?r.dataOutputs:r.signalOutputs,o=s.find(t=>t.name===e)||this._createNewSocketConnection(e),l=a.find(e=>e.name===t)||this._createNewSocketConnection(t,!0);s.find(t=>t.name===e)||s.push(o),a.find(e=>e.name===t)||a.push(l),o.connectedPointIds.push(l.uniqueId),l.connectedPointIds.push(o.uniqueId)}getVariableName(e){return"staticVariable_"+e}serializeToFlowGraph(){let e={uniqueId:(0,ru.z)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(e);for(let t=0;t<this._staticVariables.length;t++){let i=this._staticVariables[t];e._userVariables[this.getVariableName(t)]=i}return{rightHanded:!0,allBlocks:this._nodes.reduce((e,t)=>e.concat(t.blocks),[]),executionContexts:[e]}}}var rd=i(93236);let rp="KHR_interactivity";class rf{constructor(e){this._loader=e,this.name=rp,this.enabled=this._loader.isExtensionUsed(rp),this._pathConverter=(0,e7.Wt)(this._loader.gltf),e._skipStartAnimationStep=!0;const t=e.babylonScene;t&&r_(t)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){if(!this._loader.babylonScene||!this._pathConverter)return;let e=this._loader.babylonScene,t=this._loader.gltf.extensions?.KHR_interactivity;if(!t)return;let i=new i9.x({scene:e});i.dispatchEventsSynchronously=!1;let r=t.graphs.map(e=>new rc(e,this._loader.gltf,this._loader.parent.targetFps).serializeToFlowGraph());await Promise.all(r.map(async e=>await (0,i7.cB)(e,{coordinator:i,pathConverter:this._pathConverter}))),i.start()}}function r_(e){(0,e7.oR)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!e.activeCamera)return new w.PT(NaN,NaN,NaN,NaN);let t=w.PT.FromRotationMatrix(e.activeCamera.getWorldMatrix()).normalize();return e.useRightHandedSystem||(t.w*=-1,t.x*=-1),t},type:"Quaternion",getTarget:()=>e.activeCamera}),(0,e7.oR)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!e.activeCamera)return new w.Pq(NaN,NaN,NaN);let t=e.activeCamera.getWorldMatrix().getTranslation();return e.useRightHandedSystem||(t.x*=-1),t},type:"Vector3",getTarget:()=>e.activeCamera}),(0,e7.oR)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:e=>e._babylonAnimationGroup?.isPlaying??!1,type:"boolean",getTarget:e=>e._babylonAnimationGroup}),(0,e7.oR)("/animations/{}/extensions/KHR_interactivity/minTime",{get:e=>(e._babylonAnimationGroup?.from??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,e7.oR)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:e=>(e._babylonAnimationGroup?.to??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,e7.oR)("/animations/{}/extensions/KHR_interactivity/playhead",{get:e=>(e._babylonAnimationGroup?.getCurrentFrame()??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,e7.oR)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:e=>(e._babylonAnimationGroup?.getCurrentFrame()??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup})}(0,rd.Q)(rp,"FlowGraphGLTFDataProvider",async()=>(await Promise.resolve().then(i.bind(i,30246))).FlowGraphGLTFDataProvider),e9(rp),e8(rp,!0,e=>new rf(e));let rm="KHR_node_visibility";(0,e7.oR)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:e=>{let t=e._babylonTransformNode;return!t||void 0===t.isVisible||t.isVisible},set:(e,t)=>{t._primitiveBabylonMeshes?.forEach(e=>{e.inheritVisibility=!0}),t._babylonTransformNode&&(t._babylonTransformNode.isVisible=e),t._primitiveBabylonMeshes?.forEach(t=>{t.isVisible=e})},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class rg{constructor(e){this.name=rm,this._loader=e,this.enabled=e.isExtensionUsed(rm)}onReady(){if(!this._loader)return;let e=this._loader.gltf.nodes;if(e)for(let t of e){let e=t._babylonTransformNode;e&&(e.inheritVisibility=!0,t.extensions&&t.extensions.KHR_node_visibility&&!1===t.extensions.KHR_node_visibility.visible&&(e.isVisible=!1))}}dispose(){delete this._loader}}e9(rm),e8(rm,!0,e=>new rg(e));let rb="KHR_node_selectability";rr("event/onSelect",rb,{blocks:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:e=>"pickedMesh_"+e}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,t,i,r,n,s,a){let o=n[n.length-1];o.config=o.config||{},o.config.glTF=a;let l=e.configuration?.nodeIndex?.value?.[0];if(void 0===l||"number"!=typeof l)throw Error("nodeIndex not found in configuration");let u="pickedMesh_"+l;return n[1].config.variable=u,s._userVariables[u]={className:"Mesh",id:a?.nodes?.[l]._babylonTransformNode?.id,uniqueId:a?.nodes?.[l]._babylonTransformNode?.uniqueId},n}}),(0,e7.oR)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:e=>{let t=e._babylonTransformNode;return!t||void 0===t.isPickable||t.isPickable},set:(e,t)=>{t._primitiveBabylonMeshes?.forEach(t=>{t.isPickable=e})},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"isPickable"],type:"boolean"});class ry{constructor(e){this.name=rb,this._loader=e,this.enabled=e.isExtensionUsed(rb)}async onReady(){this._loader.gltf.nodes?.forEach(e=>{e.extensions?.KHR_node_selectability&&e.extensions?.KHR_node_selectability.selectable===!1&&e._babylonTransformNode?.getChildMeshes().forEach(e=>{e.isPickable=!1})})}dispose(){this._loader=null}}e9(rb),e8(rb,!0,e=>new ry(e));let rx="KHR_node_hoverability",rT="targetMeshPointerOver_";rr("event/onHoverIn",rx,{blocks:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:e=>rT+e}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,t,i,r,n,s,a){let o=n[n.length-1];o.config=o.config||{},o.config.glTF=a;let l=e.configuration?.nodeIndex?.value?.[0];if(void 0===l||"number"!=typeof l)throw Error("nodeIndex not found in configuration");let u=rT+l;return n[1].config.variable=u,s._userVariables[u]={className:"Mesh",id:a?.nodes?.[l]._babylonTransformNode?.id,uniqueId:a?.nodes?.[l]._babylonTransformNode?.uniqueId},n}});let rv="targetMeshPointerOut_";rr("event/onHoverOut",rx,{blocks:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:e=>rv+e}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,t,i,r,n,s,a){let o=n[n.length-1];o.config=o.config||{},o.config.glTF=a;let l=e.configuration?.nodeIndex?.value?.[0];if(void 0===l||"number"!=typeof l)throw Error("nodeIndex not found in configuration");let u=rv+l;return n[1].config.variable=u,s._userVariables[u]={className:"Mesh",id:a?.nodes?.[l]._babylonTransformNode?.id,uniqueId:a?.nodes?.[l]._babylonTransformNode?.uniqueId},n}}),(0,e7.oR)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:e=>{let t=e._babylonTransformNode;return!t||void 0===t.pointerOverDisableMeshTesting||t.pointerOverDisableMeshTesting},set:(e,t)=>{t._primitiveBabylonMeshes?.forEach(t=>{t.pointerOverDisableMeshTesting=!e})},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class rA{constructor(e){this.name=rx,this._loader=e,this.enabled=e.isExtensionUsed(rx)}async onReady(){this._loader.gltf.nodes?.forEach(e=>{e.extensions?.KHR_node_hoverability&&e.extensions?.KHR_node_hoverability.hoverable===!1&&e._babylonTransformNode?.getChildMeshes().forEach(e=>{e.pointerOverDisableMeshTesting=!0})})}dispose(){this._loader=null}}e9(rx),e8(rx,!0,e=>new rA(e));let rS="ExtrasAsMetadata";class rE{_assignExtras(e,t){if(t.extras&&Object.keys(t.extras).length>0){let i=e.metadata=e.metadata||{};(i.gltf=i.gltf||{}).extras=t.extras}}constructor(e){this.name=rS,this.enabled=!0,this._loader=e}dispose(){this._loader=null}loadNodeAsync(e,t,i){return this._loader.loadNodeAsync(e,t,e=>{this._assignExtras(e,t),i(e)})}loadCameraAsync(e,t,i){return this._loader.loadCameraAsync(e,t,e=>{this._assignExtras(e,t),i(e)})}createMaterial(e,t,i){let r=this._loader.createMaterial(e,t,i);return this._assignExtras(r,t),r}loadAnimationAsync(e,t){return this._loader.loadAnimationAsync(e,t).then(e=>(this._assignExtras(e,t),e))}}e9(rS),e8(rS,!1,e=>new rE(e));var rI=i(30246);class rR{constructor(){this.materials=[]}parseMTL(e,t,i,r){let n;if(t instanceof ArrayBuffer)return;let s=t.split("\n"),a=/\s+/,o=null;for(let t=0;t<s.length;t++){let l=s[t].trim();if(0===l.length||"#"===l.charAt(0))continue;let u=l.indexOf(" "),h=u>=0?l.substring(0,u):l;h=h.toLowerCase();let c=u>=0?l.substring(u+1).trim():"";if("newmtl"===h)o&&this.materials.push(o),e._blockEntityCollection=!!r,(o=new e_.F(c,e))._parentContainer=r,e._blockEntityCollection=!1;else if("kd"===h&&o)n=c.split(a,3).map(parseFloat),o.diffuseColor=eu.v9.FromArray(n);else if("ka"===h&&o)n=c.split(a,3).map(parseFloat),o.ambientColor=eu.v9.FromArray(n);else if("ks"===h&&o)n=c.split(a,3).map(parseFloat),o.specularColor=eu.v9.FromArray(n);else if("ke"===h&&o)n=c.split(a,3).map(parseFloat),o.emissiveColor=eu.v9.FromArray(n);else if("ns"===h&&o)o.specularPower=parseFloat(c);else if("d"===h&&o)o.alpha=parseFloat(c);else if("map_ka"===h&&o)o.ambientTexture=rR._GetTexture(i,c,e);else if("map_kd"===h&&o)o.diffuseTexture=rR._GetTexture(i,c,e);else if("map_ks"===h&&o)o.specularTexture=rR._GetTexture(i,c,e);else if("map_ns"===h);else if("map_bump"===h&&o){let t=c.split(a),r=t.indexOf("-bm"),n=null;r>=0&&(n=t[r+1],t.splice(r,2)),o.bumpTexture=rR._GetTexture(i,t.join(" "),e),o.bumpTexture&&null!==n&&(o.bumpTexture.level=parseFloat(n))}else"map_d"===h&&o&&(o.opacityTexture=rR._GetTexture(i,c,e))}o&&this.materials.push(o)}static _GetTexture(e,t,i){if(!t)return null;let r=e;if("file:"===e){let e=t.lastIndexOf("\\");-1===e&&(e=t.lastIndexOf("/")),e>-1?r+=t.substring(e+1):r+=t}else r+=t;return new eg.g(r,i,!1,rR.INVERT_TEXTURE_Y)}}rR.INVERT_TEXTURE_Y=!0;class rP{constructor(e,t,i){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._extColors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new eu.ov(.5,.5,.5,1),this._hasLineData=!1,this._materialToUse=e,this._babylonMeshesArray=t,this._loadingOptions=i}_isInArray(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});let i=e[t[0]].normals.indexOf(t[1]);return -1===i?-1:e[t[0]].idx[i]}_isInArrayUV(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});let i=e[t[0]].normals.indexOf(t[1]);return 1!=i&&t[2]===e[t[0]].uv[i]?e[t[0]].idx[i]:-1}_setData(e){let t;e.indiceUvsFromObj??(e.indiceUvsFromObj=-1),e.indiceNormalFromObj??(e.indiceNormalFromObj=-1),-1===(t=this._loadingOptions.optimizeWithUV?this._isInArrayUV(this._tuplePosNorm,[e.indicePositionFromObj,e.indiceNormalFromObj,e.indiceUvsFromObj]):this._isInArray(this._tuplePosNorm,[e.indicePositionFromObj,e.indiceNormalFromObj]))?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(e.positionVectorFromOBJ),void 0!==e.textureVectorFromOBJ&&this._wrappedUvsForBabylon.push(e.textureVectorFromOBJ),void 0!==e.normalsVectorFromOBJ&&this._wrappedNormalsForBabylon.push(e.normalsVectorFromOBJ),void 0!==e.positionColorsFromOBJ&&this._wrappedColorsForBabylon.push(e.positionColorsFromOBJ),this._tuplePosNorm[e.indicePositionFromObj].normals.push(e.indiceNormalFromObj),this._tuplePosNorm[e.indicePositionFromObj].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[e.indicePositionFromObj].uv.push(e.indiceUvsFromObj)):this._indicesForBabylon.push(t)}_unwrapData(){try{for(let e=0;e<this._wrappedPositionForBabylon.length;e++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[e].x*this._handednessSign,this._wrappedPositionForBabylon[e].y,this._wrappedPositionForBabylon[e].z),this._wrappedNormalsForBabylon.length&&this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[e].x*this._handednessSign,this._wrappedNormalsForBabylon[e].y,this._wrappedNormalsForBabylon[e].z),this._wrappedUvsForBabylon.length&&this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[e].x,this._wrappedUvsForBabylon[e].y),this._unwrappedColorsForBabylon.length&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[e].r,this._wrappedColorsForBabylon[e].g,this._wrappedColorsForBabylon[e].b,this._wrappedColorsForBabylon[e].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}catch(e){throw Error("Unable to unwrap data while parsing OBJ data.")}}_getTriangles(e,t){for(let i=t;i<e.length-1;i++)this._pushTriangle(e,i)}_getColor(e){return this._loadingOptions.importVertexColors?this._extColors[e]??this._colors[e]:void 0}_setDataForCurrentFaceWithPattern1(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=parseInt(this._triangles[e])-1;this._setData({indicePositionFromObj:t,positionVectorFromOBJ:this._positions[t],positionColorsFromOBJ:this._getColor(t)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern2(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("/"),i=parseInt(t[0])-1,r=parseInt(t[1])-1;this._setData({indicePositionFromObj:i,indiceUvsFromObj:r,positionVectorFromOBJ:this._positions[i],textureVectorFromOBJ:this._uvs[r],positionColorsFromOBJ:this._getColor(i)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern3(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("/"),i=parseInt(t[0])-1,r=parseInt(t[1])-1,n=parseInt(t[2])-1;this._setData({indicePositionFromObj:i,indiceUvsFromObj:r,indiceNormalFromObj:n,positionVectorFromOBJ:this._positions[i],textureVectorFromOBJ:this._uvs[r],normalsVectorFromOBJ:this._normals[n]})}this._triangles.length=0}_setDataForCurrentFaceWithPattern4(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("//"),i=parseInt(t[0])-1,r=parseInt(t[1])-1;this._setData({indicePositionFromObj:i,indiceNormalFromObj:r,positionVectorFromOBJ:this._positions[i],normalsVectorFromOBJ:this._normals[r],positionColorsFromOBJ:this._getColor(i)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern5(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){let t=this._triangles[e].split("/"),i=this._positions.length+parseInt(t[0]),r=this._uvs.length+parseInt(t[1]),n=this._normals.length+parseInt(t[2]);this._setData({indicePositionFromObj:i,indiceUvsFromObj:r,indiceNormalFromObj:n,positionVectorFromOBJ:this._positions[i],textureVectorFromOBJ:this._uvs[r],normalsVectorFromOBJ:this._normals[n],positionColorsFromOBJ:this._getColor(i)})}this._triangles.length=0}_addPreviousObjMesh(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._unwrappedNormalsForBabylon.length&&(this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice()),this._unwrappedUVForBabylon.length&&(this._handledMesh.uvs=this._unwrappedUVForBabylon.slice()),this._unwrappedColorsForBabylon.length&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._handledMesh.hasLines=this._hasLineData,this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0,this._hasLineData=!1)}_optimizeNormals(e){let t=e.getVerticesData(ey.R.PositionKind),i=e.getVerticesData(ey.R.NormalKind),r={};if(!t||!i)return;for(let e=0;e<t.length/3;e++){let i=t[3*e+0]+"_"+t[3*e+1]+"_"+t[3*e+2],n=r[i];n||(n=[],r[i]=n),n.push(e)}let n=new w.Pq;for(let e in r){let t=r[e];if(t.length<2)continue;let s=t[0];for(let e=1;e<t.length;++e){let r=t[e];i[3*s+0]+=i[3*r+0],i[3*s+1]+=i[3*r+1],i[3*s+2]+=i[3*r+2]}n.copyFromFloats(i[3*s+0],i[3*s+1],i[3*s+2]),n.normalize();for(let e=0;e<t.length;++e){let r=t[e];i[3*r+0]=n.x,i[3*r+1]=n.y,i[3*r+2]=n.z}}e.setVerticesData(ey.R.NormalKind,i)}static _IsLineElement(e){return e.startsWith("l")}static _IsObjectElement(e){return e.startsWith("o")}static _IsGroupElement(e){return e.startsWith("g")}static _GetZbrushMRGB(e,t){if(!e.startsWith("mrgb"))return null;if(e=e.replace("mrgb","").trim(),t)return[];let i=e.match(/[a-z0-9]/g);if(!i||i.length%8!=0)return[];let r=[];for(let e=0;e<i.length/8;e++){let t=i[8*e+2]+i[8*e+3],n=i[8*e+4]+i[8*e+5],s=i[8*e+6]+i[8*e+7];r.push(new eu.ov(parseInt(t,16)/255,parseInt(n,16)/255,parseInt(s,16)/255,1))}return r}parse(e,t,i,r,n){t=(t=t.replace(/#MRGB/g,"mrgb")).replace(/#.*$/gm,"").trim(),this._loadingOptions.useLegacyBehavior?(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t],e[t+1]),this._handednessSign=1):i.useRightHandedSystem?(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t+1],e[t]),this._handednessSign=1):(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t],e[t+1]),this._handednessSign=-1);let s=t.split("\n"),a=[],o=[];a.push(o);for(let e=0;e<s.length;e++){let t=s[e].trim().replace(/\s\s/g," ");if(0!==t.length&&"#"!==t.charAt(0))if((rP._IsGroupElement(t)||rP._IsObjectElement(t))&&(o=[],a.push(o)),rP._IsLineElement(t)){let e=t.split(" ");for(let t=1;t<e.length-1;t++)o.push(`l ${e[t]} ${e[t+1]}`)}else o.push(t)}let l=a.flat();for(let e=0;e<l.length;e++){let t,i=l[e].trim().replace(/\s\s/g," ");if(0!==i.length&&"#"!==i.charAt(0))if(rP.VertexPattern.test(i)){if(t=i.match(/[^ ]+/g),this._positions.push(new w.Pq(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]))),this._loadingOptions.importVertexColors)if(t.length>=7){let e=parseFloat(t[4]),i=parseFloat(t[5]),r=parseFloat(t[6]);this._colors.push(new eu.ov(e>1?e/255:e,i>1?i/255:i,r>1?r/255:r,7===t.length||void 0===t[7]?1:parseFloat(t[7])))}else this._colors.push(this._grayColor)}else if(null!==(t=rP.NormalPattern.exec(i)))this._normals.push(new w.Pq(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])));else if(null!==(t=rP.UVPattern.exec(i)))this._uvs.push(new w.I9(parseFloat(t[1])*this._loadingOptions.UVScaling.x,parseFloat(t[2])*this._loadingOptions.UVScaling.y));else if(null!==(t=rP.FacePattern3.exec(i)))this._setDataForCurrentFaceWithPattern3(t[1].trim().split(" "),1);else if(null!==(t=rP.FacePattern4.exec(i)))this._setDataForCurrentFaceWithPattern4(t[1].trim().split(" "),1);else if(null!==(t=rP.FacePattern5.exec(i)))this._setDataForCurrentFaceWithPattern5(t[1].trim().split(" "),1);else if(null!==(t=rP.FacePattern2.exec(i)))this._setDataForCurrentFaceWithPattern2(t[1].trim().split(" "),1);else if(null!==(t=rP.FacePattern1.exec(i)))this._setDataForCurrentFaceWithPattern1(t[1].trim().split(" "),1);else if(null!==(t=rP.LinePattern1.exec(i)))this._setDataForCurrentFaceWithPattern1(t[1].trim().split(" "),0),this._hasLineData=!0;else if(null!==(t=rP.LinePattern2.exec(i)))this._setDataForCurrentFaceWithPattern2(t[1].trim().split(" "),0),this._hasLineData=!0;else if(t=rP._GetZbrushMRGB(i,!this._loadingOptions.importVertexColors))for(let e of t)this._extColors.push(e);else if(null!==(t=rP.LinePattern3.exec(i)))this._setDataForCurrentFaceWithPattern3(t[1].trim().split(" "),0),this._hasLineData=!0;else if(rP.GroupDescriptor.test(i)||rP.ObjectDescriptor.test(i)){let e={name:i.substring(2).trim(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:rP.ObjectDescriptor.test(i)};this._addPreviousObjMesh(),this._meshesFromObj.push(e),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(rP.UseMtlDescriptor.test(i)){if(this._materialNameFromObj=i.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();let e={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:!1};this._increment++,this._meshesFromObj.push(e),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else rP.MtlLibGroupDescriptor.test(i)?n(i.substring(7).trim()):rP.SmoothDescriptor.test(i)||X.V.Log("Unhandled expression at line : "+i)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._unwrappedNormalsForBabylon.length&&(this._handledMesh.normals=this._unwrappedNormalsForBabylon),this._unwrappedUVForBabylon.length&&(this._handledMesh.uvs=this._unwrappedUVForBabylon),this._unwrappedColorsForBabylon.length&&(this._handledMesh.colors=this._unwrappedColorsForBabylon),this._handledMesh.hasLines=this._hasLineData),!this._hasMeshes){let e=null;if(this._indicesForBabylon.length)this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData();else{for(let e of this._positions)this._unwrappedPositionsForBabylon.push(e.x,e.y,e.z);if(this._normals.length)for(let e of this._normals)this._unwrappedNormalsForBabylon.push(e.x,e.y,e.z);if(this._uvs.length)for(let e of this._uvs)this._unwrappedUVForBabylon.push(e.x,e.y);if(this._extColors.length)for(let e of this._extColors)this._unwrappedColorsForBabylon.push(e.r,e.g,e.b,e.a);else if(this._colors.length)for(let e of this._colors)this._unwrappedColorsForBabylon.push(e.r,e.g,e.b,e.a);!this._materialNameFromObj&&((e=new e_.F(ex.V.RandomId(),i)).pointsCloud=!0,this._materialNameFromObj=e.name,this._normals.length||(e.disableLighting=!0,e.emissiveColor=eu.v9.White()))}this._meshesFromObj.push({name:ex.V.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:e,isObject:!0,hasLines:this._hasLineData})}for(let t=0;t<this._meshesFromObj.length;t++){if(e&&this._meshesFromObj[t].name){if(e instanceof Array){if(-1===e.indexOf(this._meshesFromObj[t].name))continue}else if(this._meshesFromObj[t].name!==e)continue}this._handledMesh=this._meshesFromObj[t],i._blockEntityCollection=!!r;let n=new eA.e(this._meshesFromObj[t].name,i);if(n._parentContainer=r,i._blockEntityCollection=!1,this._handledMesh._babylonMesh=n,!this._handledMesh.isObject){for(let e=t-1;e>=0;--e)if(this._meshesFromObj[e].isObject&&this._meshesFromObj[e]._babylonMesh){n.parent=this._meshesFromObj[e]._babylonMesh;break}}if(this._materialToUse.push(this._meshesFromObj[t].materialName),this._handledMesh.hasLines&&(n._internalMetadata??(n._internalMetadata={}),n._internalMetadata._isLine=!0),this._handledMesh.positions?.length===0){this._babylonMeshesArray.push(n);continue}let s=new eb.P;if(s.indices=this._handledMesh.indices,s.positions=this._handledMesh.positions,this._loadingOptions.computeNormals||!this._handledMesh.normals){let e=[];eb.P.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,e),s.normals=e}else s.normals=this._handledMesh.normals;this._handledMesh.uvs&&(s.uvs=this._handledMesh.uvs),this._handledMesh.colors&&(s.colors=this._handledMesh.colors),s.applyToMesh(n),this._loadingOptions.invertY&&(n.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(n),this._babylonMeshesArray.push(n),this._handledMesh.directMaterial&&(n.material=this._handledMesh.directMaterial)}}}rP.ObjectDescriptor=/^o/,rP.GroupDescriptor=/^g/,rP.MtlLibGroupDescriptor=/^mtllib /,rP.UseMtlDescriptor=/^usemtl /,rP.SmoothDescriptor=/^s /,rP.VertexPattern=/^v(\s+[\d|.|+|\-|e|E]+){3,7}/,rP.NormalPattern=/^vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,rP.UVPattern=/^vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,rP.FacePattern1=/^f\s+(([\d]{1,}[\s]?){3,})+/,rP.FacePattern2=/^f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,rP.FacePattern3=/^f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,rP.FacePattern4=/^f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,rP.FacePattern5=/^f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,rP.LinePattern1=/^l\s+(([\d]{1,}[\s]?){2,})+/,rP.LinePattern2=/^l\s+((([\d]{1,}\/[\d]{1,}[\s]?){2,})+)/,rP.LinePattern3=/^l\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;class rM{static get INVERT_TEXTURE_Y(){return rR.INVERT_TEXTURE_Y}static set INVERT_TEXTURE_Y(e){rR.INVERT_TEXTURE_Y=e}constructor(e){this.name="obj",this.extensions=".obj",this._assetContainer=null,this._loadingOptions={...rM._DefaultLoadingOptions,...e??{}}}static get _DefaultLoadingOptions(){return{computeNormals:rM.COMPUTE_NORMALS,optimizeNormals:rM.OPTIMIZE_NORMALS,importVertexColors:rM.IMPORT_VERTEX_COLORS,invertY:rM.INVERT_Y,invertTextureY:rM.INVERT_TEXTURE_Y,UVScaling:rM.UV_SCALING,materialLoadingFailsSilently:rM.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:rM.OPTIMIZE_WITH_UV,skipMaterials:rM.SKIP_MATERIALS,useLegacyBehavior:rM.USE_LEGACY_BEHAVIOR}}_loadMTL(e,t,i,r){let n=t+e;D.S0.LoadFile(n,i,void 0,void 0,!1,(e,t)=>{r(n,t)})}createPlugin(e){return new rM(e.obj)}canDirectLoad(){return!1}importMeshAsync(e,t,i,r){return this._parseSolidAsync(e,t,i,r).then(e=>({meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}))}loadAsync(e,t,i){return this.importMeshAsync(null,e,t,i).then(()=>{})}loadAssetContainerAsync(e,t,i){let r=new H.WZ(e);return this._assetContainer=r,this.importMeshAsync(null,e,t,i).then(e=>(e.meshes.forEach(e=>r.meshes.push(e)),e.meshes.forEach(e=>{let t=e.material;t&&-1==r.materials.indexOf(t)&&(r.materials.push(t),t.getActiveTextures().forEach(e=>{-1==r.textures.indexOf(e)&&r.textures.push(e)}))}),this._assetContainer=null,r)).catch(e=>{throw this._assetContainer=null,e})}_parseSolidAsync(e,t,i,r){let n="",s=new rR,a=[],o=[];i=i.replace(/#.*$/gm,"").trim(),new rP(a,o,this._loadingOptions).parse(e,i,t,this._assetContainer,e=>{n=e});let l=[];return""===n||this._loadingOptions.skipMaterials||l.push(new Promise((e,i)=>{this._loadMTL(n,r,l=>{try{s.parseMTL(t,l,r,this._assetContainer);for(let e=0;e<s.materials.length;e++){let t,i=0,r=[];for(;(t=a.indexOf(s.materials[e].name,i))>-1;)r.push(t),i=t+1;if(-1===t&&0===r.length)s.materials[e].dispose();else for(let t=0;t<r.length;t++){let i=o[r[t]],n=s.materials[e];i.material=n,i.getTotalIndices()||(n.pointsCloud=!0)}}e()}catch(t){D.S0.Warn(`Error processing MTL file: '${n}'`),this._loadingOptions.materialLoadingFailsSilently?e():i(t)}},(t,r)=>{D.S0.Warn(`Error downloading MTL file: '${n}'`),this._loadingOptions.materialLoadingFailsSilently?e():i(r)})})),Promise.all(l).then(()=>{let e=e=>!!e._internalMetadata?._isLine;return o.forEach(i=>{if(e(i)){let r=i.material??new e_.F(i.name+"_line",t);r.getBindedMeshes().filter(t=>!e(t)).length>0&&(r=r.clone(r.name+"_line")??r),r.wireframe=!0,i.material=r,i._internalMetadata&&(i._internalMetadata._isLine=void 0)}}),o})}}rM.OPTIMIZE_WITH_UV=!0,rM.INVERT_Y=!1,rM.IMPORT_VERTEX_COLORS=!1,rM.COMPUTE_NORMALS=!1,rM.OPTIMIZE_NORMALS=!1,rM.UV_SCALING=new w.I9(1,1),rM.SKIP_MATERIALS=!1,rM.MATERIAL_LOADING_FAILS_SILENTLY=!0,rM.USE_LEGACY_BEHAVIOR=!1,(0,$.qS)(new rM);let rC={".stl":{isBinary:!0}};class rO{constructor(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.name="stl",this.extensions=rC}importMesh(e,t,i,r,n){let s;if("string"!=typeof i){if(this._isBinary(i)){let e=new eA.e("stlmesh",t);return this._parseBinary(e,i),n&&n.push(e),!0}i=new TextDecoder().decode(new Uint8Array(i))}for(;s=this.solidPattern.exec(i);){let i=s[1],r=s[3];if(r&&i!=r)return D.S0.Error("Error in STL, solid name != endsolid name"),!1;if(e&&i){if(e instanceof Array){if(!e.indexOf(i))continue}else if(i!==e)continue}i=i||"stlmesh";let a=new eA.e(i,t);this._parseASCII(a,s[2]),n&&n.push(a)}return!0}load(e,t,i){return this.importMesh(null,e,t,i,null)}loadAssetContainer(e,t,i){let r=new H.WZ(e);return e._blockEntityCollection=!0,this.importMesh(null,e,t,i,r.meshes),e._blockEntityCollection=!1,r}_isBinary(e){let t=new DataView(e);if(t.byteLength<=80)return!1;if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;let i=[115,111,108,105,100];for(let e=0;e<5;e++)if(t.getUint8(e)!==i[e])return!0;return!1}_parseBinary(e,t){let i=new DataView(t),r=i.getUint32(80,!0),n=0,s=new Float32Array(3*r*3),a=new Float32Array(3*r*3),o=new Uint32Array(3*r),l=0;for(let e=0;e<r;e++){let t=84+50*e,r=i.getFloat32(t,!0),u=i.getFloat32(t+4,!0),h=i.getFloat32(t+8,!0);for(let e=1;e<=3;e++){let o=t+12*e;s[n]=i.getFloat32(o,!0),a[n]=r,rO.DO_NOT_ALTER_FILE_COORDINATES?(s[n+1]=i.getFloat32(o+4,!0),s[n+2]=i.getFloat32(o+8,!0),a[n+1]=u,a[n+2]=h):(s[n+2]=i.getFloat32(o+4,!0),s[n+1]=i.getFloat32(o+8,!0),a[n+2]=u,a[n+1]=h),n+=3}rO.DO_NOT_ALTER_FILE_COORDINATES?(o[l]=l,o[l+1]=l+2,o[l+2]=l+1,l+=3):(o[l]=l++,o[l]=l++,o[l]=l++)}e.setVerticesData(ey.R.PositionKind,s),e.setVerticesData(ey.R.NormalKind,a),e.setIndices(o),e.computeWorldMatrix(!0)}_parseASCII(e,t){let i,r=[],n=[],s=[],a=0;for(;i=this.facetsPattern.exec(t);){let e,t=i[1],o=this.normalPattern.exec(t);if(this.normalPattern.lastIndex=0,!o)continue;let l=[Number(o[1]),Number(o[5]),Number(o[3])];for(;e=this.vertexPattern.exec(t);)rO.DO_NOT_ALTER_FILE_COORDINATES?(r.push(Number(e[1]),Number(e[3]),Number(e[5])),n.push(l[0],l[2],l[1])):(r.push(Number(e[1]),Number(e[5]),Number(e[3])),n.push(l[0],l[1],l[2]));rO.DO_NOT_ALTER_FILE_COORDINATES?(s.push(a,a+2,a+1),a+=3):s.push(a++,a++,a++),this.vertexPattern.lastIndex=0}this.facetsPattern.lastIndex=0,e.setVerticesData(ey.R.PositionKind,r),e.setVerticesData(ey.R.NormalKind,n),e.setIndices(s),e.computeWorldMatrix(!0)}}rO.DO_NOT_ALTER_FILE_COORDINATES=!1,(0,$.qS)(new rO);let rw="splat",rD={".splat":{isBinary:!0},".ply":{isBinary:!0},".spz":{isBinary:!0},".json":{isBinary:!1},".sog":{isBinary:!0}};var rN=i(35329),rL=i(87708),rF=i(37849);async function rB(e,t,i){let r=new Promise((r,n)=>{let s=i.createCanvasImage();if(!s)throw Error("Failed to create ImageBitmap");if(s.onload=()=>{try{let e=i.createCanvas(s.width,s.height);if(!e)throw Error("Failed to create canvas");let t=e.getContext("2d");if(!t)throw Error("Failed to get 2D context");t.drawImage(s,0,0);let n=t.getImageData(0,0,e.width,e.height);r({bits:new Uint8Array(n.data.buffer),width:n.width})}catch(e){n(`Error loading image ${s.src} with exception: ${e}`)}},s.onerror=e=>{n(`Error loading image ${s.src} with exception: ${e}`)},s.crossOrigin="anonymous","string"==typeof e){if(!t)throw Error("filename is required when using a URL");s.src=e+t}else{let t=new Blob([e],{type:"image/webp"});s.src=URL.createObjectURL(t)}});return await r}async function rk(e,t,i){let r=e.count?e.count:e.means.shape[0],n=new ArrayBuffer(32*r),s=new Float32Array(n),a=new Float32Array(n),o=new Uint8ClampedArray(n),l=new Uint8ClampedArray(n),u=e=>Math.sign(e)*(Math.exp(Math.abs(e))-1),h=t[0].bits,c=t[1].bits;if(!Array.isArray(e.means.mins)||!Array.isArray(e.means.maxs))throw Error("Missing arrays in SOG data.");for(let t=0;t<r;t++){let i=4*t;for(let r=0;r<3;r++){let n=e.means.mins[r],a=e.means.maxs[r],o=c[i+r]<<8|h[i+r],l=rF.X.Lerp(n,a,o/65535);s[8*t+r]=u(l)}}let d=t[2].bits;if(2===e.version){if(!e.scales.codebook)throw Error("Missing codebook in SOG version 2 scales data.");for(let t=0;t<r;t++){let i=4*t;for(let r=0;r<3;r++){let n=Math.exp(e.scales.codebook[d[i+r]]);a[8*t+3+r]=n}}}else{if(!Array.isArray(e.scales.mins)||!Array.isArray(e.scales.maxs))throw Error("Missing arrays in SOG scales data.");for(let t=0;t<r;t++){let i=4*t;for(let r=0;r<3;r++){let n=d[i+r],s=Math.exp(rF.X.Lerp(e.scales.mins[r],e.scales.maxs[r],n/255));a[8*t+3+r]=s}}}let p=t[4].bits;if(2===e.version){if(!e.sh0.codebook)throw Error("Missing codebook in SOG version 2 sh0 data.");for(let t=0;t<r;t++){let i=4*t;for(let r=0;r<3;r++){let n=.5+.28209479177387814*e.sh0.codebook[p[i+r]];o[32*t+24+r]=Math.max(0,Math.min(255,Math.round(255*n)))}o[32*t+24+3]=p[i+3]}}else{if(!Array.isArray(e.sh0.mins)||!Array.isArray(e.sh0.maxs))throw Error("Missing arrays in SOG sh0 data.");for(let t=0;t<r;t++){let i=4*t;for(let r=0;r<4;r++){let n,s=e.sh0.mins[r],a=e.sh0.maxs[r],l=p[i+r],u=rF.X.Lerp(s,a,l/255);n=r<3?.5+.28209479177387814*u:1/(1+Math.exp(-u)),o[32*t+24+r]=Math.max(0,Math.min(255,Math.round(255*n)))}}}let f=e=>(e/255-.5)*2/Math.SQRT2,_=t[3].bits;for(let e=0;e<r;e++){let t,i=_[4*e+0],r=_[4*e+1],n=_[4*e+2],s=_[4*e+3],a=f(i),o=f(r),u=f(n),h=Math.sqrt(Math.max(0,1-(a*a+o*o+u*u)));switch(s-252){case 0:t=[h,a,o,u];break;case 1:t=[a,h,o,u];break;case 2:t=[a,o,h,u];break;case 3:t=[a,o,u,h];break;default:throw Error("Invalid quaternion mode")}l[32*e+28+0]=127.5*t[0]+127.5,l[32*e+28+1]=127.5*t[1]+127.5,l[32*e+28+2]=127.5*t[2]+127.5,l[32*e+28+3]=127.5*t[3]+127.5}if(e.shN){let s=e.shN.bands?[0,3,8,15][e.shN.bands]:e.shN.shape[1]/3,a=t[5].bits,o=t[6].bits,l=t[5].width,u=Math.ceil(3*s/16),h=[],c=i.getEngine().getCaps().maxTextureSize,d=Math.ceil(r/c);for(let e=0;e<u;e++){let e=new Uint8Array(d*c*16);h.push(e)}if(2===e.version){if(!e.shN.codebook)throw Error("Missing codebook in SOG version 2 shN data.");for(let t=0;t<r;t++){let i=o[4*t+0]+(o[4*t+1]<<8),r=i%64*s,n=Math.floor(i/64);for(let i=0;i<s;i++)for(let s=0;s<3;s++){let o=3*i+s,u=h[Math.floor(o/16)],c=o%16,d=16*t,p=127.5*e.shN.codebook[a[(r+i)*4+s+n*l*4]]+127.5;u[c+d]=Math.max(0,Math.min(255,p))}}}else for(let t=0;t<r;t++){let i=o[4*t+0]+(o[4*t+1]<<8),r=i%64*s,n=Math.floor(i/64),u=e.shN.mins,c=e.shN.maxs;for(let e=0;e<3;e++)for(let i=0;i<s/3;i++){let s=3*i+e,o=h[Math.floor(s/16)],d=s%16,p=16*t,f=127.5*rF.X.Lerp(u,c,a[(r+i)*4+e+n*l*4]/255)+127.5;o[d+p]=Math.max(0,Math.min(255,f))}}return await new Promise(e=>{e({mode:0,data:n,hasVertexColors:!1,sh:h})})}return await new Promise(e=>{e({mode:0,data:n,hasVertexColors:!1})})}async function rU(e,t,i){let r,n;if(e instanceof Map){let t=(n=e).get("meta.json");if(!t)throw Error("meta.json not found in files Map");r=JSON.parse(new TextDecoder().decode(t))}else r=e;let s=[...r.means.files,...r.scales.files,...r.quats.files,...r.sh0.files];r.shN&&s.push(...r.shN.files);let a=await Promise.all(s.map(async e=>{if(!(n&&n.has(e)))return await rB(t,e,i.getEngine());{let t=n.get(e);return await rB(t,e,i.getEngine())}}));return await rk(r,a,i)}class rV{constructor(e=rV._DefaultLoadingOptions){this.name=rw,this._assetContainer=null,this.extensions=rD,this._loadingOptions=e}createPlugin(e){return new rV(e[rw])}async importMeshAsync(e,t,i,r,n,s){return await this._parseAsync(e,t,i,r).then(e=>({meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}))}static _BuildPointCloud(e,t){if(!t.byteLength)return!1;let i=new Uint8Array(t),r=new Float32Array(t),n=i.length/32;return e.addPoints(n,function(e,t){let n=r[8*t+0],s=r[8*t+1],a=r[8*t+2];e.position=new w.Pq(n,s,a);let o=i[32*t+24+0]/255,l=i[32*t+24+1]/255,u=i[32*t+24+2]/255;e.color=new eu.ov(o,l,u,1)}),!0}static _BuildMesh(e,t){let i=new eA.e("PLYMesh",e),r=new Uint8Array(t.data),n=new Float32Array(t.data),s=r.length/32,a=[],o=new eb.P;for(let e=0;e<s;e++){let t=n[8*e+0],i=n[8*e+1],r=n[8*e+2];a.push(t,i,r)}if(t.hasVertexColors){let e=new Float32Array(4*s);for(let t=0;t<s;t++){let i=r[32*t+24+0]/255,n=r[32*t+24+1]/255,s=r[32*t+24+2]/255;e[4*t+0]=i,e[4*t+1]=n,e[4*t+2]=s,e[4*t+3]=1}o.colors=e}return o.positions=a,o.indices=t.faces,o.applyToMesh(i),i}async _unzipWithFFlateAsync(e){let t=this._loadingOptions.fflate;t||(void 0===window.fflate&&await D.S0.LoadScriptAsync(this._loadingOptions.deflateURL??"https://unpkg.com/fflate/umd/index.js"),t=window.fflate);let{unzipSync:i}=t,r=i(e),n=new Map;for(let[e,t]of Object.entries(r))n.set(e,t);return n}_parseAsync(e,t,i,r){let n=[],s=e=>{t._blockEntityCollection=!!this._assetContainer;let i=this._loadingOptions.gaussianSplattingMesh??new rN.t("GaussianSplatting",null,t,this._loadingOptions.keepInRam);i._parentContainer=this._assetContainer,n.push(i),i.updateData(e.data,e.sh,{flipY:!1}),i.scaling.y*=-1,i.computeWorldMatrix(!0),t._blockEntityCollection=!1};if("string"==typeof i){let e=JSON.parse(i);if(e&&e.means&&e.scales&&e.quats&&e.sh0)return new Promise(i=>{rU(e,r,t).then(e=>{s(e),i(n)}).catch(()=>{throw Error("Failed to parse SOG data.")})})}let a=i instanceof ArrayBuffer?new Uint8Array(i):i;if(80===a[0]&&75===a[1])return new Promise(e=>{this._unzipWithFFlateAsync(a).then(i=>{rU(i,r,t).then(t=>{s(t),e(n)}).catch(()=>{throw Error("Failed to parse SOG zip data.")})})});let o=new ReadableStream({start(e){e.enqueue(new Uint8Array(i)),e.close()}}),l=new DecompressionStream("gzip"),u=o.pipeThrough(l);return new Promise(e=>{new Response(u).arrayBuffer().then(i=>{(function(e,t,i){let r=new Uint8Array(e),n=new Uint32Array(e.slice(0,12)),s=n[2],a=r[12],o=r[13],l=r[14],u=r[15],h=n[1];if(u||0x5053474e!=n[0]||2!=h&&3!=h)return new Promise(e=>{e({mode:3,data:c,hasVertexColors:!1})});let c=new ArrayBuffer(32*s),d=1/(1<<o),p=new Int32Array(1),f=new Uint8Array(p.buffer),_=function(e,t){return f[0]=e[t+0],f[1]=e[t+1],f[2]=e[t+2],f[3]=128&e[t+2]?255:0,p[0]*d},m=16,g=new Float32Array(c),b=new Float32Array(c),y=new Uint8ClampedArray(c),x=new Uint8ClampedArray(c);for(let e=0;e<s;e++)g[8*e+0]=_(r,m+0),g[8*e+1]=_(r,m+3),g[8*e+2]=_(r,m+6),m+=9;for(let e=0;e<s;e++){for(let t=0;t<3;t++){let i=(r[m+s+3*e+t]-127.5)/38.25;y[32*e+24+t]=rF.X.Clamp((.5+.282*i)*255,0,255)}y[32*e+24+3]=r[m+e]}m+=4*s;for(let e=0;e<s;e++)b[8*e+3+0]=Math.exp(r[m+0]/16-10),b[8*e+3+1]=Math.exp(r[m+1]/16-10),b[8*e+3+2]=Math.exp(r[m+2]/16-10),m+=3;if(h>=3){let e=Math.SQRT1_2;for(let t=0;t<s;t++){let i=[r[m+0],r[m+1],r[m+2],r[m+3]],n=i[0]+(i[1]<<8)+(i[2]<<16)+(i[3]<<24),s=[],a=n>>>30,o=n,l=0;for(let t=3;t>=0;--t)if(t!==a){let i=511&o,r=o>>>9&1;o>>>=10,s[t]=i/511*e,1===r&&(s[t]=-s[t]),l+=s[t]*s[t]}let u=1-l;s[a]=Math.sqrt(Math.max(u,0));let h=[3,0,1,2];for(let e=0;e<4;e++)x[32*t+28+e]=Math.round(127.5+127.5*s[h[e]]);m+=4}}else for(let e=0;e<s;e++){let t=r[m+0],i=r[m+1],n=r[m+2],s=t/127.5-1,a=i/127.5-1,o=n/127.5-1;x[32*e+28+1]=t,x[32*e+28+2]=i,x[32*e+28+3]=n;let l=1-(s*s+a*a+o*o);x[32*e+28+0]=127.5+127.5*Math.sqrt(l<0?0:l),m+=3}if(a){let e=3*((a+1)*(a+1)-1),i=Math.ceil(e/16),n=m,o=[],u=t.getEngine().getCaps().maxTextureSize,h=Math.ceil(s/u);for(let e=0;e<i;e++){let e=new Uint8Array(h*u*16);o.push(e)}for(let t=0;t<s;t++)for(let i=0;i<e;i++){let e=r[n++];o[Math.floor(i/16)][i%16+16*t]=e}return new Promise(e=>{e({mode:0,data:c,hasVertexColors:!1,sh:o,trainedWithAntialiasing:!!l})})}return new Promise(e=>{e({mode:0,data:c,hasVertexColors:!1,trainedWithAntialiasing:!!l})})})(i,t,this._loadingOptions).then(i=>{t._blockEntityCollection=!!this._assetContainer;let r=this._loadingOptions.gaussianSplattingMesh??new rN.t("GaussianSplatting",null,t,this._loadingOptions.keepInRam);if(i.trainedWithAntialiasing){let e=r.material;e.kernelSize=.1,e.compensation=!0}r._parentContainer=this._assetContainer,n.push(r),r.updateData(i.data,i.sh,{flipY:!1}),this._loadingOptions.flipY||(r.scaling.y*=-1,r.computeWorldMatrix(!0)),t._blockEntityCollection=!1,this.applyAutoCameraLimits(i,t),e(n)})}).catch(()=>{rV._ConvertPLYToSplat(i).then(async i=>{switch(t._blockEntityCollection=!!this._assetContainer,i.mode){case 0:{let e=this._loadingOptions.gaussianSplattingMesh??new rN.t("GaussianSplatting",null,t,this._loadingOptions.keepInRam);switch(e._parentContainer=this._assetContainer,n.push(e),e.updateData(i.data,i.sh,{flipY:!1}),e.scaling.y*=-1,"RightHanded"===i.chirality&&(e.scaling.y*=-1),i.upAxis){case"X":e.rotation=new w.Pq(0,0,Math.PI/2);break;case"Y":e.rotation=new w.Pq(0,0,Math.PI);break;case"Z":e.rotation=new w.Pq(-Math.PI/2,Math.PI,0)}e.computeWorldMatrix(!0)}break;case 1:{let e=new rL.y("PointCloud",1,t);rV._BuildPointCloud(e,i.data)?await e.buildMeshAsync().then(e=>{n.push(e)}):e.dispose()}break;case 2:if(i.faces)n.push(rV._BuildMesh(t,i));else throw Error("PLY mesh doesn't contain face informations.");break;default:throw Error("Unsupported Splat mode")}t._blockEntityCollection=!1,this.applyAutoCameraLimits(i,t),e(n)})})})}applyAutoCameraLimits(e,t){if(!this._loadingOptions.disableAutoCameraLimits&&(void 0!==e.safeOrbitCameraRadiusMin||void 0!==e.safeOrbitCameraElevationMinMax)&&t.activeCamera?.getClassName()==="ArcRotateCamera"){let i=t.activeCamera;e.safeOrbitCameraElevationMinMax&&(i.lowerBetaLimit=.5*Math.PI-e.safeOrbitCameraElevationMinMax[1],i.upperBetaLimit=.5*Math.PI-e.safeOrbitCameraElevationMinMax[0]),e.safeOrbitCameraRadiusMin&&(i.lowerRadiusLimit=e.safeOrbitCameraRadiusMin)}}loadAssetContainerAsync(e,t,i){let r=new H.WZ(e);return this._assetContainer=r,this.importMeshAsync(null,e,t,i).then(e=>{for(let t of e.meshes)r.meshes.push(t);return this._assetContainer=null,r}).catch(e=>{throw this._assetContainer=null,e})}loadAsync(e,t,i){return this.importMeshAsync(null,e,t,i).then(()=>{})}static _ConvertPLYToSplat(e){let t=new Uint8Array(e),i=new TextDecoder().decode(t.slice(0,10240)),r="end_header\n",n=i.indexOf(r);if(n<0||!i)return new Promise(t=>{t({mode:0,data:e,rawSplat:!0})});let s=parseInt(/element vertex (\d+)\n/.exec(i)[1]),a=/element face (\d+)\n/.exec(i),o=0;a&&(o=parseInt(a[1]));let l=/element chunk (\d+)\n/.exec(i),u=0;l&&(u=parseInt(l[1]));let h=0,c=0,d={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,list:0},p=1,f=[],_=[],m=i.slice(0,n).split("\n"),g={};for(let t of m)if(t.startsWith("property ")){let[,i,r]=t.split(" ");if(1==p)_.push({name:r,type:i,offset:c}),c+=d[i];else if(0==p)f.push({name:r,type:i,offset:h}),h+=d[i];else if(2==p)f.push({name:r,type:i,offset:h});else if(3==p){let t=new DataView(e,c,2*d.float);g.safeOrbitCameraElevationMinMax=[t.getFloat32(0,!0),t.getFloat32(4,!0)]}else if(4==p)g.safeOrbitCameraRadiusMin=new DataView(e,c,d.float).getFloat32(0,!0);else if(5==p){let t=new DataView(e,c,d.uchar);"up_axis"==r?g.upAxis=0==t.getUint8(0)?"X":1==t.getUint8(0)?"Y":"Z":"chirality"==r&&(g.chirality=0==t.getUint8(0)?"LeftHanded":"RightHanded")}d[i]||X.V.Warn(`Unsupported property type: ${i}.`)}else if(t.startsWith("element ")){let[,e]=t.split(" ");"chunk"==e?p=1:"vertex"==e?p=0:"sh"==e?p=2:"safe_orbit_camera_elevation_min_max_radians"==e?p=3:"safe_orbit_camera_radius_min"==e?p=4:("up_axis"==e||"chirality"==e)&&(p=5)}let b=h,y=c;return rN.t.ConvertPLYWithSHToSplatAsync(e).then(async t=>{let i=new DataView(e,n+r.length),a=y*u+b*s,l=[];if(o)for(let e=0;e<o;e++){let e=i.getUint8(a);if(3==e){a+=1;for(let t=0;t<e;t++){let e=i.getUint32(a+(2-t)*4,!0);l.push(e)}a+=12}}if(u)return await new Promise(e=>{e({mode:0,data:t.buffer,sh:t.sh,faces:l,hasVertexColors:!1,compressed:!0,rawSplat:!1})});let h=0,c=0,d=["x","y","z","scale_0","scale_1","scale_2","opacity","rot_0","rot_1","rot_2","rot_3"],p=["red","green","blue","f_dc_0","f_dc_1","f_dc_2"];for(let e=0;e<f.length;e++){let t=f[e];d.includes(t.name)&&h++,p.includes(t.name)&&c++}let _=h==d.length&&3==c,m=o?2:+!_;return await new Promise(e=>{e({...g,mode:m,data:t.buffer,sh:t.sh,faces:l,hasVertexColors:!!c,compressed:!1,rawSplat:!1})})})}}rV._DefaultLoadingOptions={keepInRam:!1,flipY:!1},(0,$.qS)(new rV)},19379(e,t,i){function r(){}function n(e){return null==e?r:function(){return this.querySelector(e)}}function s(){return[]}function a(e){return null==e?s:function(){return this.querySelectorAll(e)}}function o(e){return function(){return this.matches(e)}}function l(e){return function(t){return t.matches(e)}}i.d(t,{rLf:()=>it,JLW:()=>t9,exT:()=>function e(){var t,i,r=(i=(t=(function(){var e,t,i,r,n,s=0,a=1,o=ty,l=!1;function u(t){return null==t||isNaN(t*=1)?n:o(0===i?.5:(t=(r(t)-e)*i,l?Math.max(0,Math.min(1,t)):t))}function h(e){return function(t){var i,r;return arguments.length?([i,r]=t,o=e(i,r),u):[o(0),o(1)]}}return u.domain=function(n){return arguments.length?([s,a]=n,e=r(s*=1),t=r(a*=1),i=e===t?0:1/(t-e),u):[s,a]},u.clamp=function(e){return arguments.length?(l=!!e,u):l},u.interpolator=function(e){return arguments.length?(o=e,u):o},u.range=h(function e(t,i){var r,n,s=typeof i;return null==i||"boolean"===s?te(i):("number"===s?eA:"string"===s?(n=ej(i))?(i=n,ti):ta:i instanceof ej?ti:i instanceof Date?function(e,t){var i=new Date;return e*=1,t*=1,function(r){return i.setTime(e*(1-r)+t*r),i}}:!ArrayBuffer.isView(r=i)||r instanceof DataView?Array.isArray(i)?function(t,i){var r,n=i?i.length:0,s=t?Math.min(n,t.length):0,a=Array(s),o=Array(n);for(r=0;r<s;++r)a[r]=e(t[r],i[r]);for(;r<n;++r)o[r]=i[r];return function(e){for(r=0;r<s;++r)o[r]=a[r](e);return o}}:"function"!=typeof i.valueOf&&"function"!=typeof i.toString||isNaN(i)?function(t,i){var r,n={},s={};for(r in(null===t||"object"!=typeof t)&&(t={}),(null===i||"object"!=typeof i)&&(i={}),i)r in t?n[r]=e(t[r],i[r]):s[r]=i[r];return function(e){for(r in n)s[r]=n[r](e);return s}}:eA:function(e,t){t||(t=[]);var i,r=e?Math.min(t.length,e.length):0,n=t.slice();return function(s){for(i=0;i<r;++i)n[i]=e[i]*(1-s)+t[i]*s;return n}})(t,i)}),u.rangeRound=h(tb),u.unknown=function(e){return arguments.length?(n=e,u):n},function(n){return r=n,e=n(s),t=n(a),i=e===t?0:1/(t-e),u}})()(ty)).domain,t.ticks=function(e){var t=i();return function(e,t,i){if(t*=1,e*=1,!((i*=1)>0))return[];if(e===t)return[e];let r=t<e,[n,s,a]=r?tS(t,e,i):tS(e,t,i);if(!(s>=n))return[];let o=s-n+1,l=Array(o);if(r)if(a<0)for(let e=0;e<o;++e)l[e]=-((s-e)/a);else for(let e=0;e<o;++e)l[e]=(s-e)*a;else if(a<0)for(let e=0;e<o;++e)l[e]=-((n+e)/a);else for(let e=0;e<o;++e)l[e]=(n+e)*a;return l}(t[0],t[t.length-1],null==e?10:e)},t.tickFormat=function(e,t){var r=i();return function(e,t,i,r){let n,s;var a,o,l,u,h,c=(o=e,l=+t,o*=1,u=+i,s=(n=l<o)?tE(l,o,u):tE(o,l,u),(n?-1:1)*(s<0?-(1/s):s));switch((r=tR(null==r?",f":r)).type){case"s":var f=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(h=Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(tC(f)/3)))-tC(Math.abs(c))))||(r.precision=h),p(r,f);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(h=Math.max(0,tC(Math.abs(Math.max(Math.abs(e),Math.abs(t)))-(a=Math.abs(a=c)))-tC(a))+1)||(r.precision=h-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(h=Math.max(0,-tC(Math.abs(c))))||(r.precision=h-("%"===r.type)*2)}return d(r)}(r[0],r[r.length-1],null==e?10:e,t)},t.nice=function(e){null==e&&(e=10);var r,n,s=i(),a=0,o=s.length-1,l=s[a],u=s[o],h=10;for(u<l&&(n=l,l=u,u=n,n=a,a=o,o=n);h-- >0;){if((n=tE(l,u,e))===r)return s[a]=l,s[o]=u,i(s);if(n>0)l=Math.floor(l/n)*n,u=Math.ceil(u/n)*n;else if(n<0)l=Math.ceil(l*n)/n,u=Math.floor(u*n)/n;else break;r=n}return t},t);return r.copy=function(){return e().domain(r.domain()).interpolator(r.interpolator()).clamp(r.clamp()).unknown(r.unknown())},tx.apply(r,arguments)},GAA:()=>tk});var u,h,c,d,p,f=Array.prototype.find;function _(){return this.firstElementChild}var m=Array.prototype.filter;function g(){return Array.from(this.children)}function b(e){return Array(e.length)}function y(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function x(e,t,i,r,n,s){for(var a,o=0,l=t.length,u=s.length;o<u;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):i[o]=new y(e,s[o]);for(;o<l;++o)(a=t[o])&&(n[o]=a)}function T(e,t,i,r,n,s,a){var o,l,u,h=new Map,c=t.length,d=s.length,p=Array(c);for(o=0;o<c;++o)(l=t[o])&&(p[o]=u=a.call(l,l.__data__,o,t)+"",h.has(u)?n[o]=l:h.set(u,l));for(o=0;o<d;++o)u=a.call(e,s[o],o,s)+"",(l=h.get(u))?(r[o]=l,l.__data__=s[o],h.delete(u)):i[o]=new y(e,s[o]);for(o=0;o<c;++o)(l=t[o])&&h.get(p[o])===l&&(n[o]=l)}function v(e){return e.__data__}function A(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}y.prototype={constructor:y,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var S="http://www.w3.org/1999/xhtml";let E={svg:"http://www.w3.org/2000/svg",xhtml:S,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function I(e){var t=e+="",i=t.indexOf(":");return i>=0&&"xmlns"!==(t=e.slice(0,i))&&(e=e.slice(i+1)),E.hasOwnProperty(t)?{space:E[t],local:e}:e}function R(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function P(e,t){return e.style.getPropertyValue(t)||R(e).getComputedStyle(e,null).getPropertyValue(t)}function M(e){return e.trim().split(/^|\s+/)}function C(e){return e.classList||new O(e)}function O(e){this._node=e,this._names=M(e.getAttribute("class")||"")}function w(e,t){for(var i=C(e),r=-1,n=t.length;++r<n;)i.add(t[r])}function D(e,t){for(var i=C(e),r=-1,n=t.length;++r<n;)i.remove(t[r])}function N(){this.textContent=""}function L(){this.innerHTML=""}function F(){this.nextSibling&&this.parentNode.appendChild(this)}function B(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function k(e){var t=I(e);return(t.local?function(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}:function(e){return function(){var t=this.ownerDocument,i=this.namespaceURI;return i===S&&t.documentElement.namespaceURI===S?t.createElement(e):t.createElementNS(i,e)}})(t)}function U(){return null}function V(){var e=this.parentNode;e&&e.removeChild(this)}function G(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function z(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function $(e){return function(){var t=this.__on;if(t){for(var i,r=0,n=-1,s=t.length;r<s;++r)(i=t[r],e.type&&i.type!==e.type||i.name!==e.name)?t[++n]=i:this.removeEventListener(i.type,i.listener,i.options);++n?t.length=n:delete this.__on}}}function H(e,t,i){return function(){var r,n=this.__on,s=function(e){t.call(this,e,this.__data__)};if(n){for(var a=0,o=n.length;a<o;++a)if((r=n[a]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=i),r.value=t;return}}this.addEventListener(e.type,s,i),r={type:e.type,name:e.name,value:t,listener:s,options:i},n?n.push(r):this.__on=[r]}}function W(e,t,i){var r=R(e),n=r.CustomEvent;"function"==typeof n?n=new n(t,i):(n=r.document.createEvent("Event"),i?(n.initEvent(t,i.bubbles,i.cancelable),n.detail=i.detail):n.initEvent(t,!1,!1)),e.dispatchEvent(n)}O.prototype={add:function(e){0>this._names.indexOf(e)&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var q=[null];function j(e,t){this._groups=e,this._parents=t}function X(){return new j([[document.documentElement]],q)}j.prototype=X.prototype={constructor:j,select:function(e){"function"!=typeof e&&(e=n(e));for(var t=this._groups,i=t.length,r=Array(i),s=0;s<i;++s)for(var a,o,l=t[s],u=l.length,h=r[s]=Array(u),c=0;c<u;++c)(a=l[c])&&(o=e.call(a,a.__data__,c,l))&&("__data__"in a&&(o.__data__=a.__data__),h[c]=o);return new j(r,this._parents)},selectAll:function(e){if("function"==typeof e){var t;t=e,e=function(){var e;return e=t.apply(this,arguments),null==e?[]:Array.isArray(e)?e:Array.from(e)}}else e=a(e);for(var i=this._groups,r=i.length,n=[],s=[],o=0;o<r;++o)for(var l,u=i[o],h=u.length,c=0;c<h;++c)(l=u[c])&&(n.push(e.call(l,l.__data__,c,u)),s.push(l));return new j(n,s)},selectChild:function(e){var t;return this.select(null==e?_:(t="function"==typeof e?e:l(e),function(){return f.call(this.children,t)}))},selectChildren:function(e){var t;return this.selectAll(null==e?g:(t="function"==typeof e?e:l(e),function(){return m.call(this.children,t)}))},filter:function(e){"function"!=typeof e&&(e=o(e));for(var t=this._groups,i=t.length,r=Array(i),n=0;n<i;++n)for(var s,a=t[n],l=a.length,u=r[n]=[],h=0;h<l;++h)(s=a[h])&&e.call(s,s.__data__,h,a)&&u.push(s);return new j(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,v);var i=t?T:x,r=this._parents,n=this._groups;"function"!=typeof e&&(b=e,e=function(){return b});for(var s=n.length,a=Array(s),o=Array(s),l=Array(s),u=0;u<s;++u){var h=r[u],c=n[u],d=c.length,p="object"==typeof(g=e.call(h,h&&h.__data__,u,r))&&"length"in g?g:Array.from(g),f=p.length,_=o[u]=Array(f),m=a[u]=Array(f);i(h,c,_,m,l[u]=Array(d),p,t);for(var g,b,y,A,S=0,E=0;S<f;++S)if(y=_[S]){for(S>=E&&(E=S+1);!(A=m[E])&&++E<f;);y._next=A||null}}return(a=new j(a,r))._enter=o,a._exit=l,a},enter:function(){return new j(this._enter||this._groups.map(b),this._parents)},exit:function(){return new j(this._exit||this._groups.map(b),this._parents)},join:function(e,t,i){var r=this.enter(),n=this,s=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(n=t(n))&&(n=n.selection()),null==i?s.remove():i(s),r&&n?r.merge(n).order():n},merge:function(e){for(var t=e.selection?e.selection():e,i=this._groups,r=t._groups,n=i.length,s=r.length,a=Math.min(n,s),o=Array(n),l=0;l<a;++l)for(var u,h=i[l],c=r[l],d=h.length,p=o[l]=Array(d),f=0;f<d;++f)(u=h[f]||c[f])&&(p[f]=u);for(;l<n;++l)o[l]=i[l];return new j(o,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,i=e.length;++t<i;)for(var r,n=e[t],s=n.length-1,a=n[s];--s>=0;)(r=n[s])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(e){function t(t,i){return t&&i?e(t.__data__,i.__data__):!t-!i}e||(e=A);for(var i=this._groups,r=i.length,n=Array(r),s=0;s<r;++s){for(var a,o=i[s],l=o.length,u=n[s]=Array(l),h=0;h<l;++h)(a=o[h])&&(u[h]=a);u.sort(t)}return new j(n,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var r=e[t],n=0,s=r.length;n<s;++n){var a=r[n];if(a)return a}return null},size:function(){let e=0;for(let t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,i=0,r=t.length;i<r;++i)for(var n,s=t[i],a=0,o=s.length;a<o;++a)(n=s[a])&&e.call(n,n.__data__,a,s);return this},attr:function(e,t){var i=I(e);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((null==t?i.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}}:"function"==typeof t?i.local?function(e,t){return function(){var i=t.apply(this,arguments);null==i?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,i)}}:function(e,t){return function(){var i=t.apply(this,arguments);null==i?this.removeAttribute(e):this.setAttribute(e,i)}}:i.local?function(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}:function(e,t){return function(){this.setAttribute(e,t)}})(i,t))},style:function(e,t,i){return arguments.length>1?this.each((null==t?function(e){return function(){this.style.removeProperty(e)}}:"function"==typeof t?function(e,t,i){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,i)}}:function(e,t,i){return function(){this.style.setProperty(e,t,i)}})(e,t,null==i?"":i)):P(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?function(e){return function(){delete this[e]}}:"function"==typeof t?function(e,t){return function(){var i=t.apply(this,arguments);null==i?delete this[e]:this[e]=i}}:function(e,t){return function(){this[e]=t}})(e,t)):this.node()[e]},classed:function(e,t){var i=M(e+"");if(arguments.length<2){for(var r=C(this.node()),n=-1,s=i.length;++n<s;)if(!r.contains(i[n]))return!1;return!0}return this.each(("function"==typeof t?function(e,t){return function(){(t.apply(this,arguments)?w:D)(this,e)}}:t?function(e){return function(){w(this,e)}}:function(e){return function(){D(this,e)}})(i,t))},text:function(e){return arguments.length?this.each(null==e?N:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}:function(e){return function(){this.textContent=e}})(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?L:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}:function(e){return function(){this.innerHTML=e}})(e)):this.node().innerHTML},raise:function(){return this.each(F)},lower:function(){return this.each(B)},append:function(e){var t="function"==typeof e?e:k(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var i="function"==typeof e?e:k(e),r=null==t?U:"function"==typeof t?t:n(t);return this.select(function(){return this.insertBefore(i.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(V)},clone:function(e){return this.select(e?z:G)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,i){var r,n,s=(e+"").trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}}),a=s.length;if(arguments.length<2){var o=this.node().__on;if(o){for(var l,u=0,h=o.length;u<h;++u)for(r=0,l=o[u];r<a;++r)if((n=s[r]).type===l.type&&n.name===l.name)return l.value}return}for(r=0,o=t?H:$;r<a;++r)this.each(o(s[r],t,i));return this},dispatch:function(e,t){return this.each(("function"==typeof t?function(e,t){return function(){return W(this,e,t.apply(this,arguments))}}:function(e,t){return function(){return W(this,e,t)}})(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var r,n=e[t],s=0,a=n.length;s<a;++s)(r=n[s])&&(yield r)}};var Z={value:()=>{}};function Y(){for(var e,t=0,i=arguments.length,r={};t<i;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw Error("illegal type: "+e);r[e]=[]}return new K(r)}function K(e){this._=e}function Q(e,t,i){for(var r=0,n=e.length;r<n;++r)if(e[r].name===t){e[r]=Z,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=i&&e.push({name:t,value:i}),e}K.prototype=Y.prototype={constructor:K,on:function(e,t){var i,r=this._,n=(e+"").trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");if(i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),e&&!r.hasOwnProperty(e))throw Error("unknown type: "+e);return{type:e,name:t}}),s=-1,a=n.length;if(arguments.length<2){for(;++s<a;)if((i=(e=n[s]).type)&&(i=function(e,t){for(var i,r=0,n=e.length;r<n;++r)if((i=e[r]).name===t)return i.value}(r[i],e.name)))return i;return}if(null!=t&&"function"!=typeof t)throw Error("invalid callback: "+t);for(;++s<a;)if(i=(e=n[s]).type)r[i]=Q(r[i],e.name,t);else if(null==t)for(i in r)r[i]=Q(r[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var i in t)e[i]=t[i].slice();return new K(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var i,r,n=Array(i),s=0;s<i;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw Error("unknown type: "+e);for(r=this._[e],s=0,i=r.length;s<i;++s)r[s].value.apply(t,n)},apply:function(e,t,i){if(!this._.hasOwnProperty(e))throw Error("unknown type: "+e);for(var r=this._[e],n=0,s=r.length;n<s;++n)r[n].value.apply(t,i)}};var J,ee,et=0,ei=0,er=0,en=0,es=0,ea=0,eo="object"==typeof performance&&performance.now?performance:Date,el="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function eu(){return es||(el(eh),es=eo.now()+ea)}function eh(){es=0}function ec(){this._call=this._time=this._next=null}function ed(e,t,i){var r=new ec;return r.restart(e,t,i),r}function ep(){es=(en=eo.now())+ea,et=ei=0;try{eu(),++et;for(var e,t=J;t;)(e=es-t._time)>=0&&t._call.call(void 0,e),t=t._next;--et}finally{et=0,function(){for(var e,t,i=J,r=1/0;i;)i._call?(r>i._time&&(r=i._time),e=i,i=i._next):(t=i._next,i._next=null,i=e?e._next=t:J=t);ee=e,e_(r)}(),es=0}}function ef(){var e=eo.now(),t=e-en;t>1e3&&(ea-=t,en=e)}function e_(e){!et&&(ei&&(ei=clearTimeout(ei)),e-es>24?(e<1/0&&(ei=setTimeout(ep,e-eo.now()-ea)),er&&(er=clearInterval(er))):(er||(en=eo.now(),er=setInterval(ef,1e3)),et=1,el(ep)))}function em(e,t,i){var r=new ec;return t=null==t?0:+t,r.restart(i=>{r.stop(),e(i+t)},t,i),r}ec.prototype=ed.prototype={constructor:ec,restart:function(e,t,i){if("function"!=typeof e)throw TypeError("callback is not a function");i=(null==i?eu():+i)+(null==t?0:+t),this._next||ee===this||(ee?ee._next=this:J=this,ee=this),this._call=e,this._time=i,e_()},stop:function(){this._call&&(this._call=null,this._time=1/0,e_())}};var eg=Y("start","end","cancel","interrupt"),eb=[];function ey(e,t,i,r,n,s){var a=e.__transition;if(a){if(i in a)return}else e.__transition={};!function(e,t,i){var r,n=e.__transition;function s(l){var u,h,c,d;if(1!==i.state)return o();for(u in n)if((d=n[u]).name===i.name){if(3===d.state)return em(s);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete n[u]):+u<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete n[u])}if(em(function(){3===i.state&&(i.state=4,i.timer.restart(a,i.delay,i.time),a(l))}),i.state=2,i.on.call("start",e,e.__data__,i.index,i.group),2===i.state){for(u=0,i.state=3,r=Array(c=i.tween.length),h=-1;u<c;++u)(d=i.tween[u].value.call(e,e.__data__,i.index,i.group))&&(r[++h]=d);r.length=h+1}}function a(t){for(var n=t<i.duration?i.ease.call(null,t/i.duration):(i.timer.restart(o),i.state=5,1),s=-1,a=r.length;++s<a;)r[s].call(e,n);5===i.state&&(i.on.call("end",e,e.__data__,i.index,i.group),o())}function o(){for(var r in i.state=6,i.timer.stop(),delete n[t],n)return;delete e.__transition}n[t]=i,i.timer=ed(function(e){i.state=1,i.timer.restart(s,i.delay,i.time),i.delay<=e&&s(e-i.delay)},0,i.time)}(e,i,{name:t,index:r,group:n,on:eg,tween:eb,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function ex(e,t){var i=ev(e,t);if(i.state>0)throw Error("too late; already scheduled");return i}function eT(e,t){var i=ev(e,t);if(i.state>3)throw Error("too late; already running");return i}function ev(e,t){var i=e.__transition;if(!i||!(i=i[t]))throw Error("transition not found");return i}function eA(e,t){return e*=1,t*=1,function(i){return e*(1-i)+t*i}}var eS=180/Math.PI,eE={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function eI(e,t,i,r,n,s){var a,o,l;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(l=e*i+t*r)&&(i-=e*l,r-=t*l),(o=Math.sqrt(i*i+r*r))&&(i/=o,r/=o,l/=o),e*r<t*i&&(e=-e,t=-t,l=-l,a=-a),{translateX:n,translateY:s,rotate:Math.atan2(t,e)*eS,skewX:Math.atan(l)*eS,scaleX:a,scaleY:o}}function eR(e,t,i,r){function n(e){return e.length?e.pop()+" ":""}return function(s,a){var o,l,u,h,c=[],d=[];return s=e(s),a=e(a),!function(e,r,n,s,a,o){if(e!==n||r!==s){var l=a.push("translate(",null,t,null,i);o.push({i:l-4,x:eA(e,n)},{i:l-2,x:eA(r,s)})}else(n||s)&&a.push("translate("+n+t+s+i)}(s.translateX,s.translateY,a.translateX,a.translateY,c,d),o=s.rotate,l=a.rotate,o!==l?(o-l>180?l+=360:l-o>180&&(o+=360),d.push({i:c.push(n(c)+"rotate(",null,r)-2,x:eA(o,l)})):l&&c.push(n(c)+"rotate("+l+r),u=s.skewX,h=a.skewX,u!==h?d.push({i:c.push(n(c)+"skewX(",null,r)-2,x:eA(u,h)}):h&&c.push(n(c)+"skewX("+h+r),!function(e,t,i,r,s,a){if(e!==i||t!==r){var o=s.push(n(s)+"scale(",null,",",null,")");a.push({i:o-4,x:eA(e,i)},{i:o-2,x:eA(t,r)})}else(1!==i||1!==r)&&s.push(n(s)+"scale("+i+","+r+")")}(s.scaleX,s.scaleY,a.scaleX,a.scaleY,c,d),s=a=null,function(e){for(var t,i=-1,r=d.length;++i<r;)c[(t=d[i]).i]=t.x(e);return c.join("")}}}var eP=eR(function(e){let t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?eE:eI(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),eM=eR(function(e){return null==e?eE:(u||(u=document.createElementNS("http://www.w3.org/2000/svg","g")),u.setAttribute("transform",e),e=u.transform.baseVal.consolidate())?eI((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):eE},", ",")",")");function eC(e,t,i){var r=e._id;return e.each(function(){var e=eT(this,r);(e.value||(e.value={}))[t]=i.apply(this,arguments)}),function(e){return ev(e,r).value[t]}}function eO(e,t,i){e.prototype=t.prototype=i,i.constructor=e}function ew(e,t){var i=Object.create(e.prototype);for(var r in t)i[r]=t[r];return i}function eD(){}var eN="\\s*([+-]?\\d+)\\s*",eL="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",eF="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",eB=/^#([0-9a-f]{3,8})$/,ek=RegExp(`^rgb\\(${eN},${eN},${eN}\\)$`),eU=RegExp(`^rgb\\(${eF},${eF},${eF}\\)$`),eV=RegExp(`^rgba\\(${eN},${eN},${eN},${eL}\\)$`),eG=RegExp(`^rgba\\(${eF},${eF},${eF},${eL}\\)$`),ez=RegExp(`^hsl\\(${eL},${eF},${eF}\\)$`),e$=RegExp(`^hsla\\(${eL},${eF},${eF},${eL}\\)$`),eH={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32};function eW(){return this.rgb().formatHex()}function eq(){return this.rgb().formatRgb()}function ej(e){var t,i;return e=(e+"").trim().toLowerCase(),(t=eB.exec(e))?(i=t[1].length,t=parseInt(t[1],16),6===i?eX(t):3===i?new eK(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===i?eZ(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===i?eZ(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ek.exec(e))?new eK(t[1],t[2],t[3],1):(t=eU.exec(e))?new eK(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=eV.exec(e))?eZ(t[1],t[2],t[3],t[4]):(t=eG.exec(e))?eZ(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=ez.exec(e))?e3(t[1],t[2]/100,t[3]/100,1):(t=e$.exec(e))?e3(t[1],t[2]/100,t[3]/100,t[4]):eH.hasOwnProperty(e)?eX(eH[e]):"transparent"===e?new eK(NaN,NaN,NaN,0):null}function eX(e){return new eK(e>>16&255,e>>8&255,255&e,1)}function eZ(e,t,i,r){return r<=0&&(e=t=i=NaN),new eK(e,t,i,r)}function eY(e,t,i,r){var n;return 1==arguments.length?((n=e)instanceof eD||(n=ej(n)),n)?new eK((n=n.rgb()).r,n.g,n.b,n.opacity):new eK:new eK(e,t,i,null==r?1:r)}function eK(e,t,i,r){this.r=+e,this.g=+t,this.b=+i,this.opacity=+r}function eQ(){return`#${e2(this.r)}${e2(this.g)}${e2(this.b)}`}function eJ(){let e=e0(this.opacity);return`${1===e?"rgb(":"rgba("}${e1(this.r)}, ${e1(this.g)}, ${e1(this.b)}${1===e?")":`, ${e})`}`}function e0(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function e1(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function e2(e){return((e=e1(e))<16?"0":"")+e.toString(16)}function e3(e,t,i,r){return r<=0?e=t=i=NaN:i<=0||i>=1?e=t=NaN:t<=0&&(e=NaN),new e5(e,t,i,r)}function e4(e){if(e instanceof e5)return new e5(e.h,e.s,e.l,e.opacity);if(e instanceof eD||(e=ej(e)),!e)return new e5;if(e instanceof e5)return e;var t=(e=e.rgb()).r/255,i=e.g/255,r=e.b/255,n=Math.min(t,i,r),s=Math.max(t,i,r),a=NaN,o=s-n,l=(s+n)/2;return o?(a=t===s?(i-r)/o+(i<r)*6:i===s?(r-t)/o+2:(t-i)/o+4,o/=l<.5?s+n:2-s-n,a*=60):o=l>0&&l<1?0:a,new e5(a,o,l,e.opacity)}function e5(e,t,i,r){this.h=+e,this.s=+t,this.l=+i,this.opacity=+r}function e6(e){return(e=(e||0)%360)<0?e+360:e}function e8(e){return Math.max(0,Math.min(1,e||0))}function e9(e,t,i){return(e<60?t+(i-t)*e/60:e<180?i:e<240?t+(i-t)*(240-e)/60:t)*255}function e7(e,t,i,r,n){var s=e*e,a=s*e;return((1-3*e+3*s-a)*t+(4-6*s+3*a)*i+(1+3*e+3*s-3*a)*r+a*n)/6}eO(eD,ej,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:eW,formatHex:eW,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return e4(this).formatHsl()},formatRgb:eq,toString:eq}),eO(eK,eY,ew(eD,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new eK(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new eK(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new eK(e1(this.r),e1(this.g),e1(this.b),e0(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:eQ,formatHex:eQ,formatHex8:function(){return`#${e2(this.r)}${e2(this.g)}${e2(this.b)}${e2((isNaN(this.opacity)?1:this.opacity)*255)}`},formatRgb:eJ,toString:eJ})),eO(e5,function(e,t,i,r){return 1==arguments.length?e4(e):new e5(e,t,i,null==r?1:r)},ew(eD,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new e5(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new e5(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,i=this.l,r=i+(i<.5?i:1-i)*t,n=2*i-r;return new eK(e9(e>=240?e-240:e+120,n,r),e9(e,n,r),e9(e<120?e+240:e-120,n,r),this.opacity)},clamp(){return new e5(e6(this.h),e8(this.s),e8(this.l),e0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=e0(this.opacity);return`${1===e?"hsl(":"hsla("}${e6(this.h)}, ${100*e8(this.s)}%, ${100*e8(this.l)}%${1===e?")":`, ${e})`}`}}));let te=e=>()=>e;function tt(e,t){var i=t-e;return i?function(t){return e+t*i}:te(isNaN(e)?t:e)}let ti=function e(t){var i,r=1==(i=+t)?tt:function(e,t){var r,n,s;return t-e?(r=e,n=t,r=Math.pow(r,s=i),n=Math.pow(n,s)-r,s=1/s,function(e){return Math.pow(r+e*n,s)}):te(isNaN(e)?t:e)};function n(e,t){var i=r((e=eY(e)).r,(t=eY(t)).r),n=r(e.g,t.g),s=r(e.b,t.b),a=tt(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=n(t),e.b=s(t),e.opacity=a(t),e+""}}return n.gamma=e,n}(1);function tr(e){return function(t){var i,r,n=t.length,s=Array(n),a=Array(n),o=Array(n);for(i=0;i<n;++i)r=eY(t[i]),s[i]=r.r||0,a[i]=r.g||0,o[i]=r.b||0;return s=e(s),a=e(a),o=e(o),r.opacity=1,function(e){return r.r=s(e),r.g=a(e),r.b=o(e),r+""}}}tr(function(e){var t=e.length-1;return function(i){var r=i<=0?i=0:i>=1?(i=1,t-1):Math.floor(i*t),n=e[r],s=e[r+1],a=r>0?e[r-1]:2*n-s,o=r<t-1?e[r+2]:2*s-n;return e7((i-r/t)*t,a,n,s,o)}}),tr(function(e){var t=e.length;return function(i){var r=Math.floor(((i%=1)<0?++i:i)*t),n=e[(r+t-1)%t],s=e[r%t],a=e[(r+1)%t],o=e[(r+2)%t];return e7((i-r/t)*t,n,s,a,o)}});var tn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ts=RegExp(tn.source,"g");function ta(e,t){var i,r,n,s,a,o=tn.lastIndex=ts.lastIndex=0,l=-1,u=[],h=[];for(e+="",t+="";(n=tn.exec(e))&&(s=ts.exec(t));)(a=s.index)>o&&(a=t.slice(o,a),u[l]?u[l]+=a:u[++l]=a),(n=n[0])===(s=s[0])?u[l]?u[l]+=s:u[++l]=s:(u[++l]=null,h.push({i:l,x:eA(n,s)})),o=ts.lastIndex;return o<t.length&&(a=t.slice(o),u[l]?u[l]+=a:u[++l]=a),u.length<2?h[0]?(i=h[0].x,function(e){return i(e)+""}):(r=t,function(){return r}):(t=h.length,function(e){for(var i,r=0;r<t;++r)u[(i=h[r]).i]=i.x(e);return u.join("")})}function to(e,t){var i;return("number"==typeof t?eA:t instanceof ej?ti:(i=ej(t))?(t=i,ti):ta)(e,t)}var tl=X.prototype.constructor;function tu(e){return function(){this.style.removeProperty(e)}}var th=0;function tc(e,t,i,r){this._groups=e,this._parents=t,this._name=i,this._id=r}var td=X.prototype;tc.prototype=(function(e){return X().transition(e)}).prototype={constructor:tc,select:function(e){var t=this._name,i=this._id;"function"!=typeof e&&(e=n(e));for(var r=this._groups,s=r.length,a=Array(s),o=0;o<s;++o)for(var l,u,h=r[o],c=h.length,d=a[o]=Array(c),p=0;p<c;++p)(l=h[p])&&(u=e.call(l,l.__data__,p,h))&&("__data__"in l&&(u.__data__=l.__data__),d[p]=u,ey(d[p],t,i,p,d,ev(l,i)));return new tc(a,this._parents,t,i)},selectAll:function(e){var t=this._name,i=this._id;"function"!=typeof e&&(e=a(e));for(var r=this._groups,n=r.length,s=[],o=[],l=0;l<n;++l)for(var u,h=r[l],c=h.length,d=0;d<c;++d)if(u=h[d]){for(var p,f=e.call(u,u.__data__,d,h),_=ev(u,i),m=0,g=f.length;m<g;++m)(p=f[m])&&ey(p,t,i,m,f,_);s.push(f),o.push(u)}return new tc(s,o,t,i)},selectChild:td.selectChild,selectChildren:td.selectChildren,filter:function(e){"function"!=typeof e&&(e=o(e));for(var t=this._groups,i=t.length,r=Array(i),n=0;n<i;++n)for(var s,a=t[n],l=a.length,u=r[n]=[],h=0;h<l;++h)(s=a[h])&&e.call(s,s.__data__,h,a)&&u.push(s);return new tc(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw Error();for(var t=this._groups,i=e._groups,r=t.length,n=i.length,s=Math.min(r,n),a=Array(r),o=0;o<s;++o)for(var l,u=t[o],h=i[o],c=u.length,d=a[o]=Array(c),p=0;p<c;++p)(l=u[p]||h[p])&&(d[p]=l);for(;o<r;++o)a[o]=t[o];return new tc(a,this._parents,this._name,this._id)},selection:function(){return new tl(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,i=++th,r=this._groups,n=r.length,s=0;s<n;++s)for(var a,o=r[s],l=o.length,u=0;u<l;++u)if(a=o[u]){var h=ev(a,t);ey(a,e,i,u,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new tc(r,this._parents,e,i)},call:td.call,nodes:td.nodes,node:td.node,size:td.size,empty:td.empty,each:td.each,on:function(e,t){var i,r,n,s,a,o,l=this._id;return arguments.length<2?ev(this.node(),l).on.on(e):this.each((i=l,r=e,n=t,o=(r+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})?ex:eT,function(){var e=o(this,i),t=e.on;t!==s&&(a=(s=t).copy()).on(r,n),e.on=a}))},attr:function(e,t){var i=I(e),r="transform"===i?eM:to;return this.attrTween(e,"function"==typeof t?(i.local?function(e,t,i){var r,n,s;return function(){var a,o,l=i(this);return null==l?void this.removeAttributeNS(e.space,e.local):(a=this.getAttributeNS(e.space,e.local))===(o=l+"")?null:a===r&&o===n?s:(n=o,s=t(r=a,l))}}:function(e,t,i){var r,n,s;return function(){var a,o,l=i(this);return null==l?void this.removeAttribute(e):(a=this.getAttribute(e))===(o=l+"")?null:a===r&&o===n?s:(n=o,s=t(r=a,l))}})(i,r,eC(this,"attr."+e,t)):null==t?(i.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}})(i):(i.local?function(e,t,i){var r,n,s=i+"";return function(){var a=this.getAttributeNS(e.space,e.local);return a===s?null:a===r?n:n=t(r=a,i)}}:function(e,t,i){var r,n,s=i+"";return function(){var a=this.getAttribute(e);return a===s?null:a===r?n:n=t(r=a,i)}})(i,r,t))},attrTween:function(e,t){var i="attr."+e;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw Error();var r=I(e);return this.tween(i,(r.local?function(e,t){var i,r;function n(){var n=t.apply(this,arguments);return n!==r&&(i=(r=n)&&function(t){this.setAttributeNS(e.space,e.local,n.call(this,t))}),i}return n._value=t,n}:function(e,t){var i,r;function n(){var n=t.apply(this,arguments);return n!==r&&(i=(r=n)&&function(t){this.setAttribute(e,n.call(this,t))}),i}return n._value=t,n})(r,t))},style:function(e,t,i){var r,n,s,a,o,l,u,h,c,d,p,f,_,m,g,b,y,x,T,v,A,S="transform"==(e+="")?eP:to;return null==t?this.styleTween(e,(r=e,function(){var e=P(this,r),t=(this.style.removeProperty(r),P(this,r));return e===t?null:e===n&&t===s?a:a=S(n=e,s=t)})).on("end.style."+e,tu(e)):"function"==typeof t?this.styleTween(e,(o=e,l=eC(this,"style."+e,t),function(){var e=P(this,o),t=l(this),i=t+"";return null==t&&(this.style.removeProperty(o),i=t=P(this,o)),e===i?null:e===u&&i===h?c:(h=i,c=S(u=e,t))})).each((d=this._id,y="end."+(b="style."+(p=e)),function(){var e=eT(this,d),t=e.on,i=null==e.value[b]?g||(g=tu(p)):void 0;(t!==f||m!==i)&&(_=(f=t).copy()).on(y,m=i),e.on=_})):this.styleTween(e,(x=e,A=t+"",function(){var e=P(this,x);return e===A?null:e===T?v:v=S(T=e,t)}),i).on("end.style."+e,null)},styleTween:function(e,t,i){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw Error();return this.tween(r,function(e,t,i){var r,n;function s(){var s=t.apply(this,arguments);return s!==n&&(r=(n=s)&&function(t){this.style.setProperty(e,s.call(this,t),i)}),r}return s._value=t,s}(e,t,null==i?"":i))},text:function(e){var t,i;return this.tween("text","function"==typeof e?(t=eC(this,"text",e),function(){var e=t(this);this.textContent=null==e?"":e}):(i=null==e?"":e+"",function(){this.textContent=i}))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw Error();return this.tween(t,function(e){var t,i;function r(){var r=e.apply(this,arguments);return r!==i&&(t=(i=r)&&function(e){this.textContent=r.call(this,e)}),t}return r._value=e,r}(e))},remove:function(){var e;return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var i in this.__transition)if(+i!==e)return;t&&t.removeChild(this)}))},tween:function(e,t){var i=this._id;if(e+="",arguments.length<2){for(var r,n=ev(this.node(),i).tween,s=0,a=n.length;s<a;++s)if((r=n[s]).name===e)return r.value;return null}return this.each((null==t?function(e,t){var i,r;return function(){var n=eT(this,e),s=n.tween;if(s!==i){r=i=s;for(var a=0,o=r.length;a<o;++a)if(r[a].name===t){(r=r.slice()).splice(a,1);break}}n.tween=r}}:function(e,t,i){var r,n;if("function"!=typeof i)throw Error();return function(){var s=eT(this,e),a=s.tween;if(a!==r){n=(r=a).slice();for(var o={name:t,value:i},l=0,u=n.length;l<u;++l)if(n[l].name===t){n[l]=o;break}l===u&&n.push(o)}s.tween=n}})(i,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){ex(this,e).delay=+t.apply(this,arguments)}}:function(e,t){return t*=1,function(){ex(this,e).delay=t}})(t,e)):ev(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){eT(this,e).duration=+t.apply(this,arguments)}}:function(e,t){return t*=1,function(){eT(this,e).duration=t}})(t,e)):ev(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw Error();return function(){eT(this,e).ease=t}}(t,e)):ev(this.node(),t).ease},easeVarying:function(e){var t;if("function"!=typeof e)throw Error();return this.each((t=this._id,function(){var i=e.apply(this,arguments);if("function"!=typeof i)throw Error();eT(this,t).ease=i}))},end:function(){var e,t,i=this,r=i._id,n=i.size();return new Promise(function(s,a){var o={value:a},l={value:function(){0==--n&&s()}};i.each(function(){var i=eT(this,r),n=i.on;n!==e&&((t=(e=n).copy())._.cancel.push(o),t._.interrupt.push(o),t._.end.push(l)),i.on=t}),0===n&&s()})},[Symbol.iterator]:td[Symbol.iterator]};var tp={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};X.prototype.interrupt=function(e){return this.each(function(){!function(e,t){var i,r,n,s=e.__transition,a=!0;if(s){for(n in t=null==t?null:t+"",s){if((i=s[n]).name!==t){a=!1;continue}r=i.state>2&&i.state<5,i.state=6,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete s[n]}a&&delete e.__transition}}(this,e)})},X.prototype.transition=function(e){var t,i;e instanceof tc?(t=e._id,e=e._name):(t=++th,(i=tp).time=eu(),e=null==e?null:e+"");for(var r=this._groups,n=r.length,s=0;s<n;++s)for(var a,o=r[s],l=o.length,u=0;u<l;++u)(a=o[u])&&ey(a,e,t,u,o,i||function(e,t){for(var i;!(i=e.__transition)||!(i=i[t]);)if(!(e=e.parentNode))throw Error(`transition ${t} not found`);return i}(a,t));return new tc(r,this._parents,e,t)};let{abs:tf,max:t_,min:tm}=Math;function tg(e){return{type:e}}["w","e"].map(tg),["n","s"].map(tg),["n","w","e","s","nw","ne","sw","se"].map(tg);function tb(e,t){return e*=1,t*=1,function(i){return Math.round(e*(1-i)+t*i)}}function ty(e){return e}function tx(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}let tT=Math.sqrt(50),tv=Math.sqrt(10),tA=Math.sqrt(2);function tS(e,t,i){let r,n,s,a=(t-e)/Math.max(0,i),o=Math.floor(Math.log10(a)),l=a/Math.pow(10,o),u=l>=tT?10:l>=tv?5:l>=tA?2:1;return(o<0?(r=Math.round(e*(s=Math.pow(10,-o)/u)),n=Math.round(t*s),r/s<e&&++r,n/s>t&&--n,s=-s):(r=Math.round(e/(s=Math.pow(10,o)*u)),n=Math.round(t/s),r*s<e&&++r,n*s>t&&--n),n<r&&.5<=i&&i<2)?tS(e,t,2*i):[r,n,s]}function tE(e,t,i){return tS(e*=1,t*=1,i*=1)[2]}var tI=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function tR(e){var t;if(!(t=tI.exec(e)))throw Error("invalid format: "+e);return new tP({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function tP(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function tM(e,t){if(!isFinite(e)||0===e)return null;var i=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"),r=e.slice(0,i);return[r.length>1?r[0]+r.slice(2):r,+e.slice(i+1)]}function tC(e){return(e=tM(Math.abs(e)))?e[1]:NaN}function tO(e,t){var i=tM(e,t);if(!i)return e+"";var r=i[0],n=i[1];return n<0?"0."+Array(-n).join("0")+r:r.length>n+1?r.slice(0,n+1)+"."+r.slice(n+1):r+Array(n-r.length+2).join("0")}tR.prototype=tP.prototype,tP.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};let tw={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>tO(100*e,t),r:tO,s:function(e,t){var i=tM(e,t);if(!i)return h=void 0,e.toPrecision(t);var r=i[0],n=i[1],s=n-(h=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,a=r.length;return s===a?r:s>a?r+Array(s-a+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+Array(1-s).join("0")+tM(e,Math.max(0,t+s-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function tD(e){return e}var tN=Array.prototype.map,tL=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function tF(e){for(var t=e.length/6|0,i=Array(t),r=0;r<t;)i[r]="#"+e.slice(6*r,6*++r);return i}function tB(e){var t=e.length;return function(i){return e[Math.max(0,Math.min(t-1,Math.floor(i*t)))]}}d=(c=function(e){var t,i,r,n=void 0===e.grouping||void 0===e.thousands?tD:(t=tN.call(e.grouping,Number),i=e.thousands+"",function(e,r){for(var n=e.length,s=[],a=0,o=t[0],l=0;n>0&&o>0&&(l+o+1>r&&(o=Math.max(1,r-l)),s.push(e.substring(n-=o,n+o)),!((l+=o+1)>r));)o=t[a=(a+1)%t.length];return s.reverse().join(i)}),s=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",l=void 0===e.numerals?tD:(r=tN.call(e.numerals,String),function(e){return e.replace(/[0-9]/g,function(e){return r[+e]})}),u=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",d=void 0===e.nan?"NaN":e.nan+"";function p(e,t){var i=(e=tR(e)).fill,r=e.align,p=e.sign,f=e.symbol,_=e.zero,m=e.width,g=e.comma,b=e.precision,y=e.trim,x=e.type;"n"===x?(g=!0,x="g"):tw[x]||(void 0===b&&(b=12),y=!0,x="g"),(_||"0"===i&&"="===r)&&(_=!0,i="0",r="=");var T=(t&&void 0!==t.prefix?t.prefix:"")+("$"===f?s:"#"===f&&/[boxX]/.test(x)?"0"+x.toLowerCase():""),v=("$"===f?a:/[%p]/.test(x)?u:"")+(t&&void 0!==t.suffix?t.suffix:""),A=tw[x],S=/[defgprs%]/.test(x);function E(e){var t,s,a,u=T,f=v;if("c"===x)f=A(e)+f,e="";else{var E=(e*=1)<0||1/e<0;if(e=isNaN(e)?d:A(Math.abs(e),b),y&&(e=function(e){e:for(var t,i=e.length,r=1,n=-1;r<i;++r)switch(e[r]){case".":n=t=r;break;case"0":0===n&&(n=r),t=r;break;default:if(!+e[r])break e;n>0&&(n=0)}return n>0?e.slice(0,n)+e.slice(t+1):e}(e)),E&&0==+e&&"+"!==p&&(E=!1),u=(E?"("===p?p:c:"-"===p||"("===p?"":p)+u,f=("s"!==x||isNaN(e)||void 0===h?"":tL[8+h/3])+f+(E&&"("===p?")":""),S){for(t=-1,s=e.length;++t<s;)if(48>(a=e.charCodeAt(t))||a>57){f=(46===a?o+e.slice(t+1):e.slice(t))+f,e=e.slice(0,t);break}}}g&&!_&&(e=n(e,1/0));var I=u.length+e.length+f.length,R=I<m?Array(m-I+1).join(i):"";switch(g&&_&&(e=n(R+e,R.length?m-f.length:1/0),R=""),r){case"<":e=u+e+f+R;break;case"=":e=u+R+e+f;break;case"^":e=R.slice(0,I=R.length>>1)+u+e+f+R.slice(I);break;default:e=R+u+e+f}return l(e)}return b=void 0===b?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b)),E.toString=function(){return e+""},E}return{format:p,formatPrefix:function(e,t){var i=3*Math.max(-8,Math.min(8,Math.floor(tC(t)/3))),r=Math.pow(10,-i),n=p(((e=tR(e)).type="f",e),{suffix:tL[8+i/3]});return function(e){return n(r*e)}}}}({thousands:",",grouping:[3],currency:["$",""]})).format,p=c.formatPrefix;let tk=tB(tF("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));function tU(e){return function(){return e}}tB(tF("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),tB(tF("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),tB(tF("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));let tV=Math.abs,tG=Math.atan2,tz=Math.cos,t$=Math.max,tH=Math.min,tW=Math.sin,tq=Math.sqrt,tj=Math.PI,tX=tj/2,tZ=2*tj;function tY(e){return e>=1?tX:e<=-1?-tX:Math.asin(e)}let tK=Math.PI,tQ=2*tK,tJ=tQ-1e-6;function t0(e){this._+=e[0];for(let t=1,i=e.length;t<i;++t)this._+=arguments[t]+e[t]}class t1{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?t0:function(e){let t=Math.floor(e);if(!(t>=0))throw Error(`invalid digits: ${e}`);if(t>15)return t0;let i=10**t;return function(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=Math.round(arguments[t]*i)/i+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,i,r){this._append`Q${+e},${+t},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(e,t,i,r,n,s){this._append`C${+e},${+t},${+i},${+r},${this._x1=+n},${this._y1=+s}`}arcTo(e,t,i,r,n){if(e*=1,t*=1,i*=1,r*=1,(n*=1)<0)throw Error(`negative radius: ${n}`);let s=this._x1,a=this._y1,o=i-e,l=r-t,u=s-e,h=a-t,c=u*u+h*h;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(c>1e-6)if(Math.abs(h*o-l*u)>1e-6&&n){let d=i-s,p=r-a,f=o*o+l*l,_=Math.sqrt(f),m=Math.sqrt(c),g=n*Math.tan((tK-Math.acos((f+c-(d*d+p*p))/(2*_*m)))/2),b=g/m,y=g/_;Math.abs(b-1)>1e-6&&this._append`L${e+b*u},${t+b*h}`,this._append`A${n},${n},0,0,${+(h*d>u*p)},${this._x1=e+y*o},${this._y1=t+y*l}`}else this._append`L${this._x1=e},${this._y1=t}`}arc(e,t,i,r,n,s){if(e*=1,t*=1,i*=1,s=!!s,i<0)throw Error(`negative radius: ${i}`);let a=i*Math.cos(r),o=i*Math.sin(r),l=e+a,u=t+o,h=1^s,c=s?r-n:n-r;null===this._x1?this._append`M${l},${u}`:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-u)>1e-6)&&this._append`L${l},${u}`,i&&(c<0&&(c=c%tQ+tQ),c>tJ?this._append`A${i},${i},0,1,${h},${e-a},${t-o}A${i},${i},0,1,${h},${this._x1=l},${this._y1=u}`:c>1e-6&&this._append`A${i},${i},0,${+(c>=tK)},${h},${this._x1=e+i*Math.cos(n)},${this._y1=t+i*Math.sin(n)}`)}rect(e,t,i,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${i*=1}v${+r}h${-i}Z`}toString(){return this._}}function t2(e){return e.innerRadius}function t3(e){return e.outerRadius}function t4(e){return e.startAngle}function t5(e){return e.endAngle}function t6(e){return e&&e.padAngle}function t8(e,t,i,r,n,s,a){var o=e-i,l=t-r,u=(a?s:-s)/tq(o*o+l*l),h=u*l,c=-u*o,d=e+h,p=t+c,f=i+h,_=r+c,m=(d+f)/2,g=(p+_)/2,b=f-d,y=_-p,x=b*b+y*y,T=n-s,v=d*_-f*p,A=(y<0?-1:1)*tq(t$(0,T*T*x-v*v)),S=(v*y-b*A)/x,E=(-v*b-y*A)/x,I=(v*y+b*A)/x,R=(-v*b+y*A)/x,P=S-m,M=E-g,C=I-m,O=R-g;return P*P+M*M>C*C+O*O&&(S=I,E=R),{cx:S,cy:E,x01:-h,y01:-c,x11:S*(n/T-1),y11:E*(n/T-1)}}function t9(){let e;var t=t2,i=t3,r=tU(0),n=null,s=t4,a=t5,o=t6,l=null,u=(e=3,h.digits=function(t){if(!arguments.length)return e;if(null==t)e=null;else{let i=Math.floor(t);if(!(i>=0))throw RangeError(`invalid digits: ${t}`);e=i}return h},()=>new t1(e));function h(){var e,h,c=+t.apply(this,arguments),d=+i.apply(this,arguments),p=s.apply(this,arguments)-tX,f=a.apply(this,arguments)-tX,_=tV(f-p),m=f>p;if(l||(l=e=u()),d<c&&(h=d,d=c,c=h),d>1e-12)if(_>tZ-1e-12)l.moveTo(d*tz(p),d*tW(p)),l.arc(0,0,d,p,f,!m),c>1e-12&&(l.moveTo(c*tz(f),c*tW(f)),l.arc(0,0,c,f,p,m));else{var g,b,y=p,x=f,T=p,v=f,A=_,S=_,E=o.apply(this,arguments)/2,I=E>1e-12&&(n?+n.apply(this,arguments):tq(c*c+d*d)),R=tH(tV(d-c)/2,+r.apply(this,arguments)),P=R,M=R;if(I>1e-12){var C=tY(I/c*tW(E)),O=tY(I/d*tW(E));(A-=2*C)>1e-12?(C*=m?1:-1,T+=C,v-=C):(A=0,T=v=(p+f)/2),(S-=2*O)>1e-12?(O*=m?1:-1,y+=O,x-=O):(S=0,y=x=(p+f)/2)}var w=d*tz(y),D=d*tW(y),N=c*tz(v),L=c*tW(v);if(R>1e-12){var F,B=d*tz(x),k=d*tW(x),U=c*tz(T),V=c*tW(T);if(_<tj)if(F=function(e,t,i,r,n,s,a,o){var l=i-e,u=r-t,h=a-n,c=o-s,d=c*l-h*u;if(!(d*d<1e-12))return d=(h*(t-s)-c*(e-n))/d,[e+d*l,t+d*u]}(w,D,U,V,B,k,N,L)){var G,z=w-F[0],$=D-F[1],H=B-F[0],W=k-F[1],q=1/tW(((G=(z*H+$*W)/(tq(z*z+$*$)*tq(H*H+W*W)))>1?0:G<-1?tj:Math.acos(G))/2),j=tq(F[0]*F[0]+F[1]*F[1]);P=tH(R,(c-j)/(q-1)),M=tH(R,(d-j)/(q+1))}else P=M=0}S>1e-12?M>1e-12?(g=t8(U,V,w,D,d,M,m),b=t8(B,k,N,L,d,M,m),l.moveTo(g.cx+g.x01,g.cy+g.y01),M<R?l.arc(g.cx,g.cy,M,tG(g.y01,g.x01),tG(b.y01,b.x01),!m):(l.arc(g.cx,g.cy,M,tG(g.y01,g.x01),tG(g.y11,g.x11),!m),l.arc(0,0,d,tG(g.cy+g.y11,g.cx+g.x11),tG(b.cy+b.y11,b.cx+b.x11),!m),l.arc(b.cx,b.cy,M,tG(b.y11,b.x11),tG(b.y01,b.x01),!m))):(l.moveTo(w,D),l.arc(0,0,d,y,x,!m)):l.moveTo(w,D),c>1e-12&&A>1e-12?P>1e-12?(g=t8(N,L,B,k,c,-P,m),b=t8(w,D,U,V,c,-P,m),l.lineTo(g.cx+g.x01,g.cy+g.y01),P<R?l.arc(g.cx,g.cy,P,tG(g.y01,g.x01),tG(b.y01,b.x01),!m):(l.arc(g.cx,g.cy,P,tG(g.y01,g.x01),tG(g.y11,g.x11),!m),l.arc(0,0,c,tG(g.cy+g.y11,g.cx+g.x11),tG(b.cy+b.y11,b.cx+b.x11),m),l.arc(b.cx,b.cy,P,tG(b.y11,b.x11),tG(b.y01,b.x01),!m))):l.arc(0,0,c,v,T,m):l.lineTo(N,L)}else l.moveTo(0,0);if(l.closePath(),e)return l=null,e+""||null}return h.centroid=function(){var e=(+t.apply(this,arguments)+ +i.apply(this,arguments))/2,r=(+s.apply(this,arguments)+ +a.apply(this,arguments))/2-tj/2;return[tz(r)*e,tW(r)*e]},h.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:tU(+e),h):t},h.outerRadius=function(e){return arguments.length?(i="function"==typeof e?e:tU(+e),h):i},h.cornerRadius=function(e){return arguments.length?(r="function"==typeof e?e:tU(+e),h):r},h.padRadius=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:tU(+e),h):n},h.startAngle=function(e){return arguments.length?(s="function"==typeof e?e:tU(+e),h):s},h.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:tU(+e),h):a},h.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:tU(+e),h):o},h.context=function(e){return arguments.length?(l=null==e?null:e,h):l},h}function t7(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function ie(e){return e}function it(){var e=ie,t=t7,i=null,r=tU(0),n=tU(tZ),s=tU(0);function a(a){var o,l,u,h,c,d,p=(a="object"==typeof(o=a)&&"length"in o?o:Array.from(o)).length,f=0,_=Array(p),m=Array(p),g=+r.apply(this,arguments),b=Math.min(tZ,Math.max(-tZ,n.apply(this,arguments)-g)),y=Math.min(Math.abs(b)/p,s.apply(this,arguments)),x=y*(b<0?-1:1);for(l=0;l<p;++l)(d=m[_[l]=l]=+e(a[l],l,a))>0&&(f+=d);for(null!=t?_.sort(function(e,i){return t(m[e],m[i])}):null!=i&&_.sort(function(e,t){return i(a[e],a[t])}),l=0,h=f?(b-p*x)/f:0;l<p;++l,g=c)c=g+((d=m[u=_[l]])>0?d*h:0)+x,m[u]={data:a[u],index:l,value:d,startAngle:g,endAngle:c,padAngle:y};return m}return a.value=function(t){return arguments.length?(e="function"==typeof t?t:tU(+t),a):e},a.sortValues=function(e){return arguments.length?(t=e,i=null,a):t},a.sort=function(e){return arguments.length?(i=e,t=null,a):i},a.startAngle=function(e){return arguments.length?(r="function"==typeof e?e:tU(+e),a):r},a.endAngle=function(e){return arguments.length?(n="function"==typeof e?e:tU(+e),a):n},a.padAngle=function(e){return arguments.length?(s="function"==typeof e?e:tU(+e),a):s},a}function ii(e,t,i){this.k=e,this.x=t,this.y=i}t1.prototype,Array.prototype.slice,ii.prototype={constructor:ii,scale:function(e){return 1===e?this:new ii(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new ii(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};new ii(1,0,0);ii.prototype},17233(e,t,i){i.d(t,{Ay:()=>H,Ts:()=>W,t:()=>q});let r=e=>"string"==typeof e,n=()=>{let e,t,i=new Promise((i,r)=>{e=i,t=r});return i.resolve=e,i.reject=t,i},s=e=>null==e?"":""+e,a=/###/g,o=e=>e&&e.indexOf("###")>-1?e.replace(a,"."):e,l=e=>!e||r(e),u=(e,t,i)=>{let n=r(t)?t.split("."):t,s=0;for(;s<n.length-1;){if(l(e))return{};let t=o(n[s]);!e[t]&&i&&(e[t]=new i),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++s}return l(e)?{}:{obj:e,k:o(n[s])}},h=(e,t,i)=>{let{obj:r,k:n}=u(e,t,Object);if(void 0!==r||1===t.length){r[n]=i;return}let s=t[t.length-1],a=t.slice(0,t.length-1),o=u(e,a,Object);for(;void 0===o.obj&&a.length;)s=`${a[a.length-1]}.${s}`,o=u(e,a=a.slice(0,a.length-1),Object),o?.obj&&void 0!==o.obj[`${o.k}.${s}`]&&(o.obj=void 0);o.obj[`${o.k}.${s}`]=i},c=(e,t)=>{let{obj:i,k:r}=u(e,t);if(i&&Object.prototype.hasOwnProperty.call(i,r))return i[r]},d=(e,t,i)=>{for(let n in t)"__proto__"!==n&&"constructor"!==n&&(n in e?r(e[n])||e[n]instanceof String||r(t[n])||t[n]instanceof String?i&&(e[n]=t[n]):d(e[n],t[n],i):e[n]=t[n]);return e};var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};let f=e=>r(e)?e.replace(/[&<>"'\/]/g,e=>p[e]):e,_=[" ",",","?","!",";"],m=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){let t=this.regExpMap.get(e);if(void 0!==t)return t;let i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}(20),g=(e,t,i=".")=>{if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}let r=t.split(i),n=e;for(let e=0;e<r.length;){let t;if(!n||"object"!=typeof n)return;let s="";for(let a=e;a<r.length;++a)if(a!==e&&(s+=i),s+=r[a],void 0!==(t=n[s])){if(["string","number","boolean"].indexOf(typeof t)>-1&&a<r.length-1)continue;e+=a-e+1;break}n=t}return n},b=e=>e?.replace("_","-"),y={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console?.[e]?.apply?.(console,t)}};class x{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||y,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,n){return n&&!this.debug?null:(r(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new x(this.logger,{...{prefix:`${this.prefix}:${e}:`},...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new x(this.logger,e)}}var T=new x;class v{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);let i=this.observers[e].get(t)||0;this.observers[e].set(t,i+1)}),this}off(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e].delete(t)}}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([e,i])=>{for(let r=0;r<i;r++)e(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([i,r])=>{for(let n=0;n<r;n++)i.apply(i,[e,...t])})}}class A extends v{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){0>this.options.ns.indexOf(e)&&this.options.ns.push(e)}removeNamespaces(e){let t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i,n={}){let s,a=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,o=void 0!==n.ignoreJSONStructure?n.ignoreJSONStructure:this.options.ignoreJSONStructure;e.indexOf(".")>-1?s=e.split("."):(s=[e,t],i&&(Array.isArray(i)?s.push(...i):r(i)&&a?s.push(...i.split(a)):s.push(i)));let l=c(this.data,s);return(!l&&!t&&!i&&e.indexOf(".")>-1&&(e=s[0],t=s[1],i=s.slice(2).join(".")),!l&&o&&r(i))?g(this.data?.[e]?.[t],i,a):l}addResource(e,t,i,r,n={silent:!1}){let s=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,a=[e,t];i&&(a=a.concat(s?i.split(s):i)),e.indexOf(".")>-1&&(a=e.split("."),r=t,t=a[1]),this.addNamespaces(t),h(this.data,a,r),n.silent||this.emit("added",e,t,i,r)}addResources(e,t,i,n={silent:!1}){for(let n in i)(r(i[n])||Array.isArray(i[n]))&&this.addResource(e,t,n,i[n],{silent:!0});n.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,r,n,s={silent:!1,skipCopy:!1}){let a=[e,t];e.indexOf(".")>-1&&(a=e.split("."),r=i,i=t,t=a[1]),this.addNamespaces(t);let o=c(this.data,a)||{};s.skipCopy||(i=JSON.parse(JSON.stringify(i))),r?d(o,i,n):o={...o,...i},h(this.data,a,o),s.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){let t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var S={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,i,r,n){return e.forEach(e=>{t=this.processors[e]?.process(t,i,r,n)??t}),t}};let E=Symbol("i18next/PATH_KEY");function I(e,t){let i,r,n,{[E]:s}=e((r=[],(n=Object.create(null)).get=(e,t)=>(i?.revoke?.(),t===E)?r:(r.push(t),(i=Proxy.revocable(e,n)).proxy),Proxy.revocable(Object.create(null),n).proxy));return s.join(t?.keySeparator??".")}let R={},P=e=>!r(e)&&"boolean"!=typeof e&&"number"!=typeof e;class M extends v{constructor(e,t={}){super(),((e,t,i)=>{e.forEach(e=>{t[e]&&(i[e]=t[e])})})(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=T.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){let i={...t};if(null==e)return!1;let r=this.resolve(e,i);if(r?.res===void 0)return!1;let n=P(r.res);return!1!==i.returnObjects||!n}extractFromKey(e,t){let i=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===i&&(i=":");let n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,s=t.ns||this.options.defaultNS||[],a=i&&e.indexOf(i)>-1,o=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!((e,t,i)=>{t=t||"",i=i||"";let r=_.filter(e=>0>t.indexOf(e)&&0>i.indexOf(e));if(0===r.length)return!0;let n=m.getRegExp(`(${r.map(e=>"?"===e?"\\?":e).join("|")})`),s=!n.test(e);if(!s){let t=e.indexOf(i);t>0&&!n.test(e.substring(0,t))&&(s=!0)}return s})(e,i,n);if(a&&!o){let t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:r(s)?[s]:s};let a=e.split(i);(i!==n||i===n&&this.options.ns.indexOf(a[0])>-1)&&(s=a.shift()),e=a.join(n)}return{key:e,namespaces:r(s)?[s]:s}}translate(e,t,i){let n="object"==typeof t?{...t}:t;if("object"!=typeof n&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof n&&(n={...n}),n||(n={}),null==e)return"";"function"==typeof e&&(e=I(e,{...this.options,...n})),Array.isArray(e)||(e=[String(e)]);let s=void 0!==n.returnDetails?n.returnDetails:this.options.returnDetails,a=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,{key:o,namespaces:l}=this.extractFromKey(e[e.length-1],n),u=l[l.length-1],h=void 0!==n.nsSeparator?n.nsSeparator:this.options.nsSeparator;void 0===h&&(h=":");let c=n.lng||this.language,d=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c?.toLowerCase()==="cimode")return d?s?{res:`${u}${h}${o}`,usedKey:o,exactUsedKey:o,usedLng:c,usedNS:u,usedParams:this.getUsedParamsDetails(n)}:`${u}${h}${o}`:s?{res:o,usedKey:o,exactUsedKey:o,usedLng:c,usedNS:u,usedParams:this.getUsedParamsDetails(n)}:o;let p=this.resolve(e,n),f=p?.res,_=p?.usedKey||o,m=p?.exactUsedKey||o,g=void 0!==n.joinArrays?n.joinArrays:this.options.joinArrays,b=!this.i18nFormat||this.i18nFormat.handleAsObject,y=void 0!==n.count&&!r(n.count),x=M.hasDefaultValue(n),T=y?this.pluralResolver.getSuffix(c,n.count,n):"",v=n.ordinal&&y?this.pluralResolver.getSuffix(c,n.count,{ordinal:!1}):"",A=y&&!n.ordinal&&0===n.count,S=A&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${T}`]||n[`defaultValue${v}`]||n.defaultValue,E=f;b&&!f&&x&&(E=S);let R=P(E),C=Object.prototype.toString.apply(E);if(b&&E&&R&&0>["[object Number]","[object Function]","[object RegExp]"].indexOf(C)&&!(r(g)&&Array.isArray(E))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");let e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(_,E,{...n,ns:l}):`key '${o} (${this.language})' returned an object instead of string.`;return s?(p.res=e,p.usedParams=this.getUsedParamsDetails(n),p):e}if(a){let e=Array.isArray(E),t=e?[]:{},i=e?m:_;for(let e in E)if(Object.prototype.hasOwnProperty.call(E,e)){let r=`${i}${a}${e}`;x&&!f?t[e]=this.translate(r,{...n,defaultValue:P(S)?S[e]:void 0,...{joinArrays:!1,ns:l}}):t[e]=this.translate(r,{...n,joinArrays:!1,ns:l}),t[e]===r&&(t[e]=E[e])}f=t}}else if(b&&r(g)&&Array.isArray(f))(f=f.join(g))&&(f=this.extendTranslation(f,e,n,i));else{let t=!1,r=!1;!this.isValidLookup(f)&&x&&(t=!0,f=S),this.isValidLookup(f)||(r=!0,f=o);let s=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&r?void 0:f,l=x&&S!==f&&this.options.updateMissing;if(r||t||l){if(this.logger.log(l?"updateKey":"missingKey",c,u,o,l?S:f),a){let e=this.resolve(o,{...n,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[],t=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if("fallback"===this.options.saveMissingTo&&t&&t[0])for(let i=0;i<t.length;i++)e.push(t[i]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(n.lng||this.language):e.push(n.lng||this.language);let i=(e,t,i)=>{let r=x&&i!==f?i:s;this.options.missingKeyHandler?this.options.missingKeyHandler(e,u,t,r,l,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(e,u,t,r,l,n),this.emit("missingKey",e,u,t,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&y?e.forEach(e=>{let t=this.pluralResolver.getSuffixes(e,n);A&&n[`defaultValue${this.options.pluralSeparator}zero`]&&0>t.indexOf(`${this.options.pluralSeparator}zero`)&&t.push(`${this.options.pluralSeparator}zero`),t.forEach(t=>{i([e],o+t,n[`defaultValue${t}`]||S)})}):i(e,o,S))}f=this.extendTranslation(f,e,n,p,i),r&&f===o&&this.options.appendNamespaceToMissingKey&&(f=`${u}${h}${o}`),(r||t)&&this.options.parseMissingKeyHandler&&(f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}${h}${o}`:o,t?f:void 0,n))}return s?(p.res=f,p.usedParams=this.getUsedParamsDetails(n),p):f}extendTranslation(e,t,i,n,s){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!i.skipInterpolation){let a;i.interpolation&&this.interpolator.init({...i,...{interpolation:{...this.options.interpolation,...i.interpolation}}});let o=r(e)&&(i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(o){let t=e.match(this.interpolator.nestingRegexp);a=t&&t.length}let l=i.replace&&!r(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(l={...this.options.interpolation.defaultVariables,...l}),e=this.interpolator.interpolate(e,l,i.lng||this.language||n.usedLng,i),o){let t=e.match(this.interpolator.nestingRegexp);a<(t&&t.length)&&(i.nest=!1)}!i.lng&&n&&n.res&&(i.lng=this.language||n.usedLng),!1!==i.nest&&(e=this.interpolator.nest(e,(...e)=>s?.[0]!==e[0]||i.context?this.translate(...e,t):(this.logger.warn(`It seems you are nesting recursively key: ${e[0]} in key: ${t[0]}`),null),i)),i.interpolation&&this.interpolator.reset()}let a=i.postProcess||this.options.postProcess,o=r(a)?[a]:a;return null!=e&&o?.length&&!1!==i.applyPostProcessor&&(e=S.handle(o,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e,t={}){let i,n,s,a,o;return r(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(i))return;let l=this.extractFromKey(e,t),u=l.key;n=u;let h=l.namespaces;this.options.fallbackNS&&(h=h.concat(this.options.fallbackNS));let c=void 0!==t.count&&!r(t.count),d=c&&!t.ordinal&&0===t.count,p=void 0!==t.context&&(r(t.context)||"number"==typeof t.context)&&""!==t.context,f=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);h.forEach(e=>{this.isValidLookup(i)||(o=e,!R[`${f[0]}-${e}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(R[`${f[0]}-${e}`]=!0,this.logger.warn(`key "${n}" for languages "${f.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach(r=>{let n;if(this.isValidLookup(i))return;a=r;let o=[u];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(o,u,r,e,t);else{let e;c&&(e=this.pluralResolver.getSuffix(r,t.count,t));let i=`${this.options.pluralSeparator}zero`,n=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(c&&(t.ordinal&&0===e.indexOf(n)&&o.push(u+e.replace(n,this.options.pluralSeparator)),o.push(u+e),d&&o.push(u+i)),p){let r=`${u}${this.options.contextSeparator||"_"}${t.context}`;o.push(r),c&&(t.ordinal&&0===e.indexOf(n)&&o.push(r+e.replace(n,this.options.pluralSeparator)),o.push(r+e),d&&o.push(r+i))}}for(;n=o.pop();)this.isValidLookup(i)||(s=n,i=this.getResource(r,e,n,t))}))})}),{res:i,usedKey:n,exactUsedKey:s,usedLng:a,usedNS:o}}isValidLookup(e){return void 0!==e&&!(!this.options.returnNull&&null===e)&&!(!this.options.returnEmptyString&&""===e)}getResource(e,t,i,r={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,i,r):this.resourceStore.getResource(e,t,i,r)}getUsedParamsDetails(e={}){let t=e.replace&&!r(e.replace),i=t?e.replace:e;if(t&&void 0!==e.count&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!t)for(let e of(i={...i},["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"]))delete i[e];return i}static hasDefaultValue(e){let t="defaultValue";for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,t.length)&&void 0!==e[i])return!0;return!1}}class C{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=T.create("languageUtils")}getScriptPartFromCode(e){if(!(e=b(e))||0>e.indexOf("-"))return null;let t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(!(e=b(e))||0>e.indexOf("-"))return e;let t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(r(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch(e){}return(t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t)?t:this.options.lowerCaseLng?e.toLowerCase():e}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){let t;return e?(e.forEach(e=>{if(t)return;let i=this.formatLanguageCode(e);(!this.options.supportedLngs||this.isSupportedCode(i))&&(t=i)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;let i=this.getScriptPartFromCode(e);if(this.isSupportedCode(i))return t=i;let r=this.getLanguagePartFromCode(e);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(e=>{if(e===r||!(0>e.indexOf("-")&&0>r.indexOf("-"))&&(e.indexOf("-")>0&&0>r.indexOf("-")&&e.substring(0,e.indexOf("-"))===r||0===e.indexOf(r)&&r.length>1))return e})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),r(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){let i=this.getFallbackCodes((!1===t?[]:t)||this.options.fallbackLng||[],e),n=[],s=e=>{e&&(this.isSupportedCode(e)?n.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return r(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(e))):r(e)&&s(this.formatLanguageCode(e)),i.forEach(e=>{0>n.indexOf(e)&&s(this.formatLanguageCode(e))}),n}}let O={zero:0,one:1,two:2,few:3,many:4,other:5},w={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class D{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=T.create("pluralResolver"),this.pluralRulesCache={}}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){let i,r=b("dev"===e?"en":e),n=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:n});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];try{i=new Intl.PluralRules(r,{type:n})}catch(n){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),w;if(!e.match(/-|_/))return w;let r=this.languageUtils.getLanguagePartFromCode(e);i=this.getRule(r,t)}return this.pluralRulesCache[s]=i,i}needsPlural(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,i={}){return this.getSuffixes(e,i).map(e=>`${t}${e}`)}getSuffixes(e,t={}){let i=this.getRule(e,t);return(i||(i=this.getRule("dev",t)),i)?i.resolvedOptions().pluralCategories.sort((e,t)=>O[e]-O[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t,i={}){let r=this.getRule(e,i);return r?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,i))}}let N=(e,t,i,n=".",s=!0)=>{let a,o=void 0!==(a=c(e,i))?a:c(t,i);return!o&&s&&r(i)&&void 0===(o=g(e,i,n))&&(o=g(t,i,n)),o};class L{constructor(e={}){this.logger=T.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(e=>e),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});let{escape:t,escapeValue:i,useRawValueToEscape:r,prefix:n,prefixEscaped:s,suffix:a,suffixEscaped:o,formatSeparator:l,unescapeSuffix:u,unescapePrefix:h,nestingPrefix:c,nestingPrefixEscaped:d,nestingSuffix:p,nestingSuffixEscaped:_,nestingOptionsSeparator:m,maxReplaces:g,alwaysFormat:b}=e.interpolation;this.escape=void 0!==t?t:f,this.escapeValue=void 0===i||i,this.useRawValueToEscape=void 0!==r&&r,this.prefix=n?n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"):s||"{{",this.suffix=a?a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"):o||"}}",this.formatSeparator=l||",",this.unescapePrefix=u?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=c?c.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"):d||"$t(".replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),this.nestingSuffix=p?p.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"):_||")".replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),this.nestingOptionsSeparator=m||",",this.maxReplaces=g||1e3,this.alwaysFormat=void 0!==b&&b,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){let e=(e,t)=>e?.source===t?(e.lastIndex=0,e):RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,t,i,n){let a,o,l,u=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},h=e=>{if(0>e.indexOf(this.formatSeparator)){let r=N(t,u,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(r,void 0,i,{...n,...t,interpolationkey:e}):r}let r=e.split(this.formatSeparator),s=r.shift().trim(),a=r.join(this.formatSeparator).trim();return this.format(N(t,u,s,this.options.keySeparator,this.options.ignoreJSONStructure),a,i,{...n,...t,interpolationkey:s})};this.resetRegExp();let c=n?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>e.replace(/\$/g,"$$$$")},{regex:this.regexp,safeValue:e=>this.escapeValue?this.escape(e).replace(/\$/g,"$$$$"):e.replace(/\$/g,"$$$$")}].forEach(t=>{for(l=0;a=t.regex.exec(e);){let i=a[1].trim();if(void 0===(o=h(i)))if("function"==typeof c){let t=c(e,a,n);o=r(t)?t:""}else if(n&&Object.prototype.hasOwnProperty.call(n,i))o="";else if(d){o=a[0];continue}else this.logger.warn(`missed to pass in variable ${i} for interpolating ${e}`),o="";else r(o)||this.useRawValueToEscape||(o=s(o));let u=t.safeValue(o);if(e=e.replace(a[0],u),d?(t.regex.lastIndex+=o.length,t.regex.lastIndex-=a[0].length):t.regex.lastIndex=0,++l>=this.maxReplaces)break}}),e}nest(e,t,i={}){let n,a,o,l=(e,t)=>{let i=this.nestingOptionsSeparator;if(0>e.indexOf(i))return e;let r=e.split(RegExp(`${i}[ ]*{`)),n=`{${r[1]}`;e=r[0];let s=(n=this.interpolate(n,o)).match(/'/g),a=n.match(/"/g);((s?.length??0)%2!=0||a)&&a.length%2==0||(n=n.replace(/'/g,'"'));try{o=JSON.parse(n),t&&(o={...t,...o})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${i}${n}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,e};for(;n=this.nestingRegexp.exec(e);){let u=[];(o=(o={...i}).replace&&!r(o.replace)?o.replace:o).applyPostProcessor=!1,delete o.defaultValue;let h=/{.*}/.test(n[1])?n[1].lastIndexOf("}")+1:n[1].indexOf(this.formatSeparator);if(-1!==h&&(u=n[1].slice(h).split(this.formatSeparator).map(e=>e.trim()).filter(Boolean),n[1]=n[1].slice(0,h)),(a=t(l.call(this,n[1].trim(),o),o))&&n[0]===e&&!r(a))return a;r(a)||(a=s(a)),a||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),a=""),u.length&&(a=u.reduce((e,t)=>this.format(e,t,i.lng,{...i,interpolationkey:n[1].trim()}),a.trim())),e=e.replace(n[0],a),this.regexp.lastIndex=0}return e}}let F=e=>{let t={};return(i,r,n)=>{let s=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(s={...s,[n.interpolationkey]:void 0});let a=r+JSON.stringify(s),o=t[a];return o||(o=e(b(r),n),t[a]=o),o(i)}},B=e=>(t,i,r)=>e(b(i),r)(t);class k{constructor(e={}){this.logger=T.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";let i=t.cacheInBuiltFormats?F:B;this.formats={number:i((e,t)=>{let i=new Intl.NumberFormat(e,{...t});return e=>i.format(e)}),currency:i((e,t)=>{let i=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>i.format(e)}),datetime:i((e,t)=>{let i=new Intl.DateTimeFormat(e,{...t});return e=>i.format(e)}),relativetime:i((e,t)=>{let i=new Intl.RelativeTimeFormat(e,{...t});return e=>i.format(e,t.range||"day")}),list:i((e,t)=>{let i=new Intl.ListFormat(e,{...t});return e=>i.format(e)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=F(t)}format(e,t,i,r={}){let n=t.split(this.formatSeparator);if(n.length>1&&n[0].indexOf("(")>1&&0>n[0].indexOf(")")&&n.find(e=>e.indexOf(")")>-1)){let e=n.findIndex(e=>e.indexOf(")")>-1);n[0]=[n[0],...n.splice(1,e)].join(this.formatSeparator)}return n.reduce((e,t)=>{let{formatName:n,formatOptions:s}=(e=>{let t=e.toLowerCase().trim(),i={};if(e.indexOf("(")>-1){let r=e.split("(");t=r[0].toLowerCase().trim();let n=r[1].substring(0,r[1].length-1);"currency"===t&&0>n.indexOf(":")?i.currency||(i.currency=n.trim()):"relativetime"===t&&0>n.indexOf(":")?i.range||(i.range=n.trim()):n.split(";").forEach(e=>{if(e){let[t,...r]=e.split(":"),n=r.join(":").trim().replace(/^'+|'+$/g,""),s=t.trim();i[s]||(i[s]=n),"false"===n&&(i[s]=!1),"true"===n&&(i[s]=!0),isNaN(n)||(i[s]=parseInt(n,10))}})}return{formatName:t,formatOptions:i}})(t);if(this.formats[n]){let t=e;try{let a=r?.formatParams?.[r.interpolationkey]||{},o=a.locale||a.lng||r.locale||r.lng||i;t=this.formats[n](e,o,{...s,...r,...a})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${n}`),e},e)}}class U extends v{constructor(e,t,i,r={}){super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=r,this.logger=T.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,r.backend,r)}queueLoad(e,t,i,r){let n={},s={},a={},o={};return e.forEach(e=>{let r=!0;t.forEach(t=>{let a=`${e}|${t}`;!i.reload&&this.store.hasResourceBundle(e,t)?this.state[a]=2:this.state[a]<0||(1===this.state[a]?void 0===s[a]&&(s[a]=!0):(this.state[a]=1,r=!1,void 0===s[a]&&(s[a]=!0),void 0===n[a]&&(n[a]=!0),void 0===o[t]&&(o[t]=!0)))}),r||(a[e]=!0)}),(Object.keys(n).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(n),pending:Object.keys(s),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(o)}}loaded(e,t,i){let r=e.split("|"),n=r[0],s=r[1];t&&this.emit("failedLoading",n,s,t),!t&&i&&this.store.addResourceBundle(n,s,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);let a={};this.queue.forEach(i=>{((e,t,i,r)=>{let{obj:n,k:s}=u(e,t,Object);n[s]=n[s]||[],n[s].push(i)})(i.loaded,[n],s),void 0!==i.pending[e]&&(delete i.pending[e],i.pendingCount--),t&&i.errors.push(t),0!==i.pendingCount||i.done||(Object.keys(i.loaded).forEach(e=>{a[e]||(a[e]={});let t=i.loaded[e];t.length&&t.forEach(t=>{void 0===a[e][t]&&(a[e][t]=!0)})}),i.done=!0,i.errors.length?i.callback(i.errors):i.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(e=>!e.done)}read(e,t,i,r=0,n=this.retryTimeout,s){if(!e.length)return s(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:i,tried:r,wait:n,callback:s});this.readingCalls++;let a=(a,o)=>{if(this.readingCalls--,this.waitingReads.length>0){let e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}a&&o&&r<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,i,r+1,2*n,s)},n):s(a,o)},o=this.backend[i].bind(this.backend);if(2===o.length){try{let i=o(e,t);i&&"function"==typeof i.then?i.then(e=>a(null,e)).catch(a):a(null,i)}catch(e){a(e)}return}return o(e,t,a)}prepareLoading(e,t,i={},n){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();r(e)&&(e=this.languageUtils.toResolveHierarchy(e)),r(t)&&(t=[t]);let s=this.queueLoad(e,t,i,n);if(!s.toLoad.length)return s.pending.length||n(),null;s.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e,t=""){let i=e.split("|"),r=i[0],n=i[1];this.read(r,n,"read",void 0,void 0,(i,s)=>{i&&this.logger.warn(`${t}loading namespace ${n} for language ${r} failed`,i),!i&&s&&this.logger.log(`${t}loaded namespace ${n} for language ${r}`,s),this.loaded(e,i,s)})}saveMissing(e,t,i,r,n,s={},a=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t))return void this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");if(null!=i&&""!==i){if(this.backend?.create){let o={...s,isUpdate:n},l=this.backend.create.bind(this.backend);if(l.length<6)try{let n;(n=5===l.length?l(e,t,i,r,o):l(e,t,i,r))&&"function"==typeof n.then?n.then(e=>a(null,e)).catch(a):a(null,n)}catch(e){a(e)}else l(e,t,i,r,a,o)}e&&e[0]&&this.store.addResource(e[0],t,i,r)}}}let V=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),r(e[1])&&(t.defaultValue=e[1]),r(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){let i=e[3]||e[2];Object.keys(i).forEach(e=>{t[e]=i[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),G=e=>(r(e.ns)&&(e.ns=[e.ns]),r(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),r(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e),z=()=>{};class $ extends v{constructor(e={},t){if(super(),this.options=G(e),this.services={},this.logger=T,this.modules={external:[]},(e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(t=>{"function"==typeof e[t]&&(e[t]=e[t].bind(e))})})(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,"function"==typeof e&&(t=e,e={}),null==e.defaultNS&&e.ns&&(r(e.ns)?e.defaultNS=e.ns:0>e.ns.indexOf("translation")&&(e.defaultNS=e.ns[0]));let i=V();this.options={...i,...this.options,...G(e)},this.options.interpolation={...i.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator),"function"!=typeof this.options.overloadTranslationOptionHandler&&(this.options.overloadTranslationOptionHandler=i.overloadTranslationOptionHandler),!0===this.options.debug&&"undefined"!=typeof console&&console.warn("i18next is maintained with support from locize.com — consider powering your project with managed localization (AI, CDN, integrations): https://locize.com");let s=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let e;this.modules.logger?T.init(s(this.modules.logger),this.options):T.init(null,this.options),e=this.modules.formatter?this.modules.formatter:k;let t=new C(this.options);this.store=new A(this.options.resources,this.options);let r=this.services;r.logger=T,r.resourceStore=this.store,r.languageUtils=t,r.pluralResolver=new D(t,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),e&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(r.formatter=s(e),r.formatter.init&&r.formatter.init(r,this.options),this.options.interpolation.format=r.formatter.format.bind(r.formatter)),r.interpolator=new L(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new U(s(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.languageDetector&&(r.languageDetector=s(this.modules.languageDetector),r.languageDetector.init&&r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=s(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new M(this.services,this.options),this.translator.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,t||(t=z),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){let e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=(...t)=>this.store[e](...t)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=(...t)=>(this.store[e](...t),this)});let a=n(),o=()=>{let e=(e,i)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),a.resolve(i),t(e,i)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?o():setTimeout(o,0),a}loadResources(e,t=z){let i=t,n=r(e)?e:this.language;if("function"==typeof e&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(n?.toLowerCase()==="cimode"&&(!this.options.preload||0===this.options.preload.length))return i();let e=[],t=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&0>e.indexOf(t)&&e.push(t)})};n?t(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e)),this.options.preload?.forEach?.(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),i(e)})}else i(null)}reloadResources(e,t,i){let r=n();return"function"==typeof e&&(i=e,e=void 0),"function"==typeof t&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=z),this.services.backendConnector.reload(e,t,e=>{r.resolve(),i(e)}),r}use(e){if(!e)throw Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&S.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1)){for(let e=0;e<this.languages.length;e++){let t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}!this.resolvedLanguage&&0>this.languages.indexOf(e)&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;let i=n();this.emit("languageChanging",e);let s=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},a=(r,n)=>{n?this.isLanguageChangingTo===e&&(s(n),this.translator.changeLanguage(n),this.isLanguageChangingTo=void 0,this.emit("languageChanged",n),this.logger.log("languageChanged",n)):this.isLanguageChangingTo=void 0,i.resolve((...e)=>this.t(...e)),t&&t(r,(...e)=>this.t(...e))},o=t=>{e||t||!this.services.languageDetector||(t=[]);let i=r(t)?t:t&&t[0],n=this.store.hasLanguageSomeTranslations(i)?i:this.services.languageUtils.getBestMatchFromCodes(r(t)?[t]:t);n&&(this.language||s(n),this.translator.language||this.translator.changeLanguage(n),this.services.languageDetector?.cacheUserLanguage?.(n)),this.loadResources(n,e=>{a(e,n)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e):o(this.services.languageDetector.detect()),i}getFixedT(e,t,i){let n=(e,t,...r)=>{let s,a;(s="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(r)):{...t}).lng=s.lng||n.lng,s.lngs=s.lngs||n.lngs,s.ns=s.ns||n.ns,""!==s.keyPrefix&&(s.keyPrefix=s.keyPrefix||i||n.keyPrefix);let o=this.options.keySeparator||".";return s.keyPrefix&&Array.isArray(e)?a=e.map(e=>("function"==typeof e&&(e=I(e,{...this.options,...t})),`${s.keyPrefix}${o}${e}`)):("function"==typeof e&&(e=I(e,{...this.options,...t})),a=s.keyPrefix?`${s.keyPrefix}${o}${e}`:e),this.t(a,s)};return r(e)?n.lng=e:n.lngs=e,n.ns=t,n.keyPrefix=i,n}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;let i=t.lng||this.resolvedLanguage||this.languages[0],r=!!this.options&&this.options.fallbackLng,n=this.languages[this.languages.length-1];if("cimode"===i.toLowerCase())return!0;let s=(e,t)=>{let i=this.services.backendConnector.state[`${e}|${t}`];return -1===i||0===i||2===i};if(t.precheck){let e=t.precheck(this,s);if(void 0!==e)return e}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||s(i,e)&&(!r||s(n,e)))}loadNamespaces(e,t){let i=n();return this.options.ns?(r(e)&&(e=[e]),e.forEach(e=>{0>this.options.ns.indexOf(e)&&this.options.ns.push(e)}),this.loadResources(e=>{i.resolve(),t&&t(e)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){let i=n();r(e)&&(e=[e]);let s=this.options.preload||[],a=e.filter(e=>0>s.indexOf(e)&&this.services.languageUtils.isSupportedCode(e));return a.length?(this.options.preload=s.concat(a),this.loadResources(e=>{i.resolve(),t&&t(e)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{let t=new Intl.Locale(e);if(t&&t.getTextInfo){let e=t.getTextInfo();if(e&&e.direction)return e.direction}}catch(e){}let t=this.services?.languageUtils||new C(V());return e.toLowerCase().indexOf("-latn")>1?"ltr":["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){let i=new $(e,t);return i.createInstance=$.createInstance,i}cloneInstance(e={},t=z){let i=e.forkResourceStore;i&&delete e.forkResourceStore;let r={...this.options,...e,isClone:!0},n=new $(r);if((void 0!==e.debug||void 0!==e.prefix)&&(n.logger=n.logger.clone(e)),["store","services","language"].forEach(e=>{n[e]=this[e]}),n.services={...this.services},n.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},i&&(n.store=new A(Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},e[t]=Object.keys(e[t]).reduce((i,r)=>(i[r]={...e[t][r]},i),e[t]),e),{}),r),n.services.resourceStore=n.store),e.interpolation){let t={...V().interpolation,...this.options.interpolation,...e.interpolation},i={...r,interpolation:t};n.services.interpolator=new L(i)}return n.translator=new M(n.services,r),n.translator.on("*",(e,...t)=>{n.emit(e,...t)}),n.init(r,t),n.translator.options=r,n.translator.backendConnector.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}let H=$.createInstance();H.createInstance,H.dir;let W=H.init;H.loadResources,H.reloadResources,H.use,H.changeLanguage,H.getFixedT;let q=H.t;H.exists,H.setDefaultNamespace,H.hasLoadedNamespace,H.loadNamespaces,H.loadLanguages},65959(e,t,i){i.d(t,{Tt:()=>r});function r(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)0>t.indexOf(r[n])&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i}},76075(e,t,i){let r,n,s;i.d(t,{gMt:()=>sj,vkY:()=>aX,Ikc:()=>sU,zMY:()=>sp,PVZ:()=>sK,YjP:()=>ng,euz:()=>ae,aig:()=>ss,YOg:()=>sF,L5J:()=>sP,Nlp:()=>aW,RZV:()=>aD,g1P:()=>sJ,mee:()=>ah,uRe:()=>nS,k5n:()=>s8});var a,o,l={};i.r(l),i.d(l,{base64:()=>eC,base64url:()=>eO,bigint:()=>eG,boolean:()=>eH,browserEmail:()=>eA,cidrv4:()=>eP,cidrv6:()=>eM,cuid:()=>es,cuid2:()=>ea,date:()=>eF,datetime:()=>eU,domain:()=>eD,duration:()=>ec,e164:()=>eN,email:()=>eb,emoji:()=>eS,extendedDuration:()=>ed,guid:()=>ep,hex:()=>eZ,hostname:()=>ew,html5Email:()=>ey,idnEmail:()=>ev,integer:()=>ez,ipv4:()=>eE,ipv6:()=>eI,ksuid:()=>eu,lowercase:()=>ej,mac:()=>eR,md5_base64:()=>eJ,md5_base64url:()=>e0,md5_hex:()=>eQ,nanoid:()=>eh,null:()=>eW,number:()=>e$,rfc5322Email:()=>ex,sha1_base64:()=>e2,sha1_base64url:()=>e3,sha1_hex:()=>e1,sha256_base64:()=>e5,sha256_base64url:()=>e6,sha256_hex:()=>e4,sha384_base64:()=>e9,sha384_base64url:()=>e7,sha384_hex:()=>e8,sha512_base64:()=>tt,sha512_base64url:()=>ti,sha512_hex:()=>te,string:()=>eV,time:()=>ek,ulid:()=>eo,undefined:()=>eq,unicodeEmail:()=>eT,uppercase:()=>eX,uuid:()=>ef,uuid4:()=>e_,uuid6:()=>em,uuid7:()=>eg,xid:()=>el});var u={};i.r(u),i.d(u,{endsWith:()=>rk,gt:()=>rx,gte:()=>rT,includes:()=>rF,length:()=>rw,lowercase:()=>rN,lt:()=>rb,lte:()=>ry,maxLength:()=>rC,maxSize:()=>rR,mime:()=>rV,minLength:()=>rO,minSize:()=>rP,multipleOf:()=>rI,negative:()=>rA,nonnegative:()=>rE,nonpositive:()=>rS,normalize:()=>rz,overwrite:()=>rG,positive:()=>rv,property:()=>rU,regex:()=>rD,size:()=>rM,slugify:()=>rq,startsWith:()=>rB,toLowerCase:()=>rH,toUpperCase:()=>rW,trim:()=>r$,uppercase:()=>rL});var h={};i.r(h),i.d(h,{ZodISODate:()=>r4,ZodISODateTime:()=>r2,ZodISODuration:()=>r9,ZodISOTime:()=>r6,date:()=>r5,datetime:()=>r3,duration:()=>r7,time:()=>r8});var c={};function d(e,t,i){function r(i,r){if(i._zod||Object.defineProperty(i,"_zod",{value:{def:r,constr:a,traits:new Set},enumerable:!1}),i._zod.traits.has(e))return;i._zod.traits.add(e),t(i,r);let n=a.prototype,s=Object.keys(n);for(let e=0;e<s.length;e++){let t=s[e];t in i||(i[t]=n[t].bind(i))}}let n=i?.Parent??Object;class s extends n{}function a(e){var t;let n=i?.Parent?new s:this;for(let i of(r(n,e),(t=n._zod).deferred??(t.deferred=[]),n._zod.deferred))i();return n}return Object.defineProperty(s,"name",{value:e}),Object.defineProperty(a,"init",{value:r}),Object.defineProperty(a,Symbol.hasInstance,{value:t=>!!i?.Parent&&t instanceof i.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(a,"name",{value:e}),a}i.r(c),i.d(c,{ZodAny:()=>sE,ZodArray:()=>sL,ZodBase64:()=>n1,ZodBase64URL:()=>n3,ZodBigInt:()=>sf,ZodBigIntFormat:()=>sm,ZodBoolean:()=>sd,ZodCIDRv4:()=>nK,ZodCIDRv6:()=>nJ,ZodCUID:()=>nL,ZodCUID2:()=>nB,ZodCatch:()=>ax,ZodCodec:()=>aI,ZodCustom:()=>ak,ZodCustomStringFormat:()=>n7,ZodDate:()=>sD,ZodDefault:()=>ad,ZodDiscriminatedUnion:()=>sq,ZodE164:()=>n5,ZodEmail:()=>ny,ZodEmoji:()=>nO,ZodEnum:()=>s6,ZodExactOptional:()=>ao,ZodFile:()=>at,ZodFunction:()=>aF,ZodGUID:()=>nT,ZodIPv4:()=>nW,ZodIPv6:()=>nZ,ZodIntersection:()=>sX,ZodJWT:()=>n8,ZodKSUID:()=>n$,ZodLazy:()=>aw,ZodLiteral:()=>s7,ZodMAC:()=>nj,ZodMap:()=>s2,ZodNaN:()=>av,ZodNanoID:()=>nD,ZodNever:()=>sM,ZodNonOptional:()=>am,ZodNull:()=>sA,ZodNullable:()=>au,ZodNumber:()=>sn,ZodNumberFormat:()=>sa,ZodObject:()=>sk,ZodOptional:()=>as,ZodPipe:()=>aS,ZodPrefault:()=>af,ZodPromise:()=>aN,ZodReadonly:()=>aP,ZodRecord:()=>sQ,ZodSet:()=>s4,ZodString:()=>nm,ZodStringFormat:()=>nb,ZodSuccess:()=>ab,ZodSymbol:()=>sy,ZodTemplateLiteral:()=>aC,ZodTransform:()=>ar,ZodTuple:()=>sY,ZodType:()=>nf,ZodULID:()=>nU,ZodURL:()=>nP,ZodUUID:()=>nA,ZodUndefined:()=>sT,ZodUnion:()=>sz,ZodUnknown:()=>sR,ZodVoid:()=>sO,ZodXID:()=>nG,ZodXor:()=>sH,_ZodString:()=>n_,_default:()=>ap,_function:()=>aB,any:()=>sI,array:()=>sF,base64:()=>n2,base64url:()=>n4,bigint:()=>s_,boolean:()=>sp,catch:()=>aT,check:()=>aU,cidrv4:()=>nQ,cidrv6:()=>n0,codec:()=>aR,cuid:()=>nF,cuid2:()=>nk,custom:()=>aV,date:()=>sN,describe:()=>a$,discriminatedUnion:()=>sj,e164:()=>n6,email:()=>nx,emoji:()=>nw,enum:()=>s8,exactOptional:()=>al,file:()=>ai,float32:()=>sl,float64:()=>su,function:()=>aB,guid:()=>nv,hash:()=>sr,hex:()=>si,hostname:()=>st,httpUrl:()=>nC,instanceof:()=>aW,int:()=>so,int32:()=>sh,int64:()=>sg,intersection:()=>sZ,ipv4:()=>nq,ipv6:()=>nY,json:()=>aj,jwt:()=>n9,keyof:()=>sB,ksuid:()=>nH,lazy:()=>aD,literal:()=>ae,looseObject:()=>sG,looseRecord:()=>s1,mac:()=>nX,map:()=>s3,meta:()=>aH,nan:()=>aA,nanoid:()=>nN,nativeEnum:()=>s9,never:()=>sC,nonoptional:()=>ag,null:()=>sS,nullable:()=>ah,nullish:()=>ac,number:()=>ss,object:()=>sU,optional:()=>aa,partialRecord:()=>s0,pipe:()=>aE,prefault:()=>a_,preprocess:()=>aX,promise:()=>aL,readonly:()=>aM,record:()=>sJ,refine:()=>aG,set:()=>s5,strictObject:()=>sV,string:()=>ng,stringFormat:()=>se,stringbool:()=>aq,success:()=>ay,superRefine:()=>az,symbol:()=>sx,templateLiteral:()=>aO,transform:()=>an,tuple:()=>sK,uint32:()=>sc,uint64:()=>sb,ulid:()=>nV,undefined:()=>sv,union:()=>s$,unknown:()=>sP,url:()=>nM,uuid:()=>nS,uuidv4:()=>nE,uuidv6:()=>nI,uuidv7:()=>nR,void:()=>sw,xid:()=>nz,xor:()=>sW}),Object.freeze({status:"aborted"}),Symbol("zod_brand");class p extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class f extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}let _={};function m(e){return e&&Object.assign(_,e),_}function g(e){let t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,i])=>-1===t.indexOf(+e)).map(([e,t])=>t)}function b(e,t="|"){return e.map(e=>k(e)).join(t)}function y(e,t){return"bigint"==typeof t?t.toString():t}function x(e){return{get value(){{let t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function T(e){return null==e}function v(e){let t=+!!e.startsWith("^"),i=e.endsWith("$")?e.length-1:e.length;return e.slice(t,i)}let A=Symbol("evaluating");function S(e,t,i){let r;Object.defineProperty(e,t,{get(){if(r!==A)return void 0===r&&(r=A,r=i()),r},set(i){Object.defineProperty(e,t,{value:i})},configurable:!0})}function E(e,t,i){Object.defineProperty(e,t,{value:i,writable:!0,enumerable:!0,configurable:!0})}function I(...e){let t={};for(let i of e)Object.assign(t,Object.getOwnPropertyDescriptors(i));return Object.defineProperties({},t)}function R(e){return JSON.stringify(e)}let P="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function M(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}let C=x(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(e){return!1}});function O(e){if(!1===M(e))return!1;let t=e.constructor;if(void 0===t||"function"!=typeof t)return!0;let i=t.prototype;return!1!==M(i)&&!1!==Object.prototype.hasOwnProperty.call(i,"isPrototypeOf")}function w(e){return O(e)?{...e}:Array.isArray(e)?[...e]:e}let D=new Set(["string","number","symbol"]),N=new Set(["string","number","bigint","boolean","symbol","undefined"]);function L(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function F(e,t,i){let r=new e._zod.constr(t??e._zod.def);return(!t||i?.parent)&&(r._zod.parent=e),r}function B(e){if(!e)return{};if("string"==typeof e)return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return(delete e.message,"string"==typeof e.error)?{...e,error:()=>e.error}:e}function k(e){return"bigint"==typeof e?e.toString()+"n":"string"==typeof e?`"${e}"`:`${e}`}let U={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},V={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function G(e,t=0){if(!0===e.aborted)return!0;for(let i=t;i<e.issues.length;i++)if(e.issues[i]?.continue!==!0)return!0;return!1}function z(e,t){return t.map(t=>(t.path??(t.path=[]),t.path.unshift(e),t))}function $(e){return"string"==typeof e?e:e?.message}function H(e,t,i){let r={...e,path:e.path??[]};return e.message||(r.message=$(e.inst?._zod.def?.error?.(e))??$(t?.error?.(e))??$(i.customError?.(e))??$(i.localeError?.(e))??"Invalid input"),delete r.inst,delete r.continue,t?.reportInput||delete r.input,r}function W(e){return e instanceof Set?"set":e instanceof Map?"map":e instanceof File?"file":"unknown"}function q(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function j(...e){let[t,i,r]=e;return"string"==typeof t?{message:t,code:"custom",input:i,inst:r}:{...t}}let X=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,y,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Z=d("$ZodError",X),Y=d("$ZodError",X,{Parent:Error}),K=e=>(t,i,r,n)=>{let s=r?Object.assign(r,{async:!1}):{async:!1},a=t._zod.run({value:i,issues:[]},s);if(a instanceof Promise)throw new p;if(a.issues.length){let t=new(n?.Err??e)(a.issues.map(e=>H(e,s,m())));throw P(t,n?.callee),t}return a.value},Q=K(Y),J=e=>async(t,i,r,n)=>{let s=r?Object.assign(r,{async:!0}):{async:!0},a=t._zod.run({value:i,issues:[]},s);if(a instanceof Promise&&(a=await a),a.issues.length){let t=new(n?.Err??e)(a.issues.map(e=>H(e,s,m())));throw P(t,n?.callee),t}return a.value},ee=J(Y),et=e=>(t,i,r)=>{let n=r?{...r,async:!1}:{async:!1},s=t._zod.run({value:i,issues:[]},n);if(s instanceof Promise)throw new p;return s.issues.length?{success:!1,error:new(e??Z)(s.issues.map(e=>H(e,n,m())))}:{success:!0,data:s.value}},ei=et(Y),er=e=>async(t,i,r)=>{let n=r?Object.assign(r,{async:!0}):{async:!0},s=t._zod.run({value:i,issues:[]},n);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(e=>H(e,n,m())))}:{success:!0,data:s.value}},en=er(Y),es=/^[cC][^\s-]{8,}$/,ea=/^[0-9a-z]+$/,eo=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,el=/^[0-9a-vA-V]{20}$/,eu=/^[A-Za-z0-9]{27}$/,eh=/^[a-zA-Z0-9_-]{21}$/,ec=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,ed=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ep=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ef=e=>e?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,e_=ef(4),em=ef(6),eg=ef(7),eb=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,ey=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,ex=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,eT=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,ev=eT,eA=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function eS(){return RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")}let eE=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,eI=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,eR=e=>{let t=L(e??":");return RegExp(`^(?:[0-9A-F]{2}${t}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${t}){5}[0-9a-f]{2}$`)},eP=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,eM=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,eC=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,eO=/^[A-Za-z0-9_-]*$/,ew=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,eD=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,eN=/^\+[1-9]\d{6,14}$/,eL="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",eF=RegExp(`^${eL}$`);function eB(e){let t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function ek(e){return RegExp(`^${eB(e)}$`)}function eU(e){let t=eB({precision:e.precision}),i=["Z"];e.local&&i.push(""),e.offset&&i.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let r=`${t}(?:${i.join("|")})`;return RegExp(`^${eL}T(?:${r})$`)}let eV=e=>{let t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${t}$`)},eG=/^-?\d+n?$/,ez=/^-?\d+$/,e$=/^-?\d+(?:\.\d+)?$/,eH=/^(?:true|false)$/i,eW=/^null$/i,eq=/^undefined$/i,ej=/^[^A-Z]*$/,eX=/^[^a-z]*$/,eZ=/^[0-9a-fA-F]*$/;function eY(e,t){return RegExp(`^[A-Za-z0-9+/]{${e}}${t}$`)}function eK(e){return RegExp(`^[A-Za-z0-9_-]{${e}}$`)}let eQ=/^[0-9a-fA-F]{32}$/,eJ=eY(22,"=="),e0=eK(22),e1=/^[0-9a-fA-F]{40}$/,e2=eY(27,"="),e3=eK(27),e4=/^[0-9a-fA-F]{64}$/,e5=eY(43,"="),e6=eK(43),e8=/^[0-9a-fA-F]{96}$/,e9=eY(64,""),e7=eK(64),te=/^[0-9a-fA-F]{128}$/,tt=eY(86,"=="),ti=eK(86),tr=d("$ZodCheck",(e,t)=>{var i;e._zod??(e._zod={}),e._zod.def=t,(i=e._zod).onattach??(i.onattach=[])}),tn={number:"number",bigint:"bigint",object:"date"},ts=d("$ZodCheckLessThan",(e,t)=>{tr.init(e,t);let i=tn[typeof t.value];e._zod.onattach.push(e=>{let i=e._zod.bag,r=(t.inclusive?i.maximum:i.exclusiveMaximum)??1/0;t.value<r&&(t.inclusive?i.maximum=t.value:i.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:i,code:"too_big",maximum:"object"==typeof t.value?t.value.getTime():t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),ta=d("$ZodCheckGreaterThan",(e,t)=>{tr.init(e,t);let i=tn[typeof t.value];e._zod.onattach.push(e=>{let i=e._zod.bag,r=(t.inclusive?i.minimum:i.exclusiveMinimum)??-1/0;t.value>r&&(t.inclusive?i.minimum=t.value:i.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:i,code:"too_small",minimum:"object"==typeof t.value?t.value.getTime():t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),to=d("$ZodCheckMultipleOf",(e,t)=>{tr.init(e,t),e._zod.onattach.push(e=>{var i;(i=e._zod.bag).multipleOf??(i.multipleOf=t.value)}),e._zod.check=i=>{if(typeof i.value!=typeof t.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof i.value?i.value%t.value===BigInt(0):0===function(e,t){let i=(e.toString().split(".")[1]||"").length,r=t.toString(),n=(r.split(".")[1]||"").length;if(0===n&&/\d?e-\d?/.test(r)){let e=r.match(/\d?e-(\d?)/);e?.[1]&&(n=Number.parseInt(e[1]))}let s=i>n?i:n;return Number.parseInt(e.toFixed(s).replace(".",""))%Number.parseInt(t.toFixed(s).replace(".",""))/10**s}(i.value,t.value))||i.issues.push({origin:typeof i.value,code:"not_multiple_of",divisor:t.value,input:i.value,inst:e,continue:!t.abort})}}),tl=d("$ZodCheckNumberFormat",(e,t)=>{tr.init(e,t),t.format=t.format||"float64";let i=t.format?.includes("int"),r=i?"int":"number",[n,s]=U[t.format];e._zod.onattach.push(e=>{let r=e._zod.bag;r.format=t.format,r.minimum=n,r.maximum=s,i&&(r.pattern=ez)}),e._zod.check=a=>{let o=a.value;if(i){if(!Number.isInteger(o))return void a.issues.push({expected:r,format:t.format,code:"invalid_type",continue:!1,input:o,inst:e});if(!Number.isSafeInteger(o))return void(o>0?a.issues.push({input:o,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,inclusive:!0,continue:!t.abort}):a.issues.push({input:o,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,inclusive:!0,continue:!t.abort}))}o<n&&a.issues.push({origin:"number",input:o,code:"too_small",minimum:n,inclusive:!0,inst:e,continue:!t.abort}),o>s&&a.issues.push({origin:"number",input:o,code:"too_big",maximum:s,inclusive:!0,inst:e,continue:!t.abort})}}),tu=d("$ZodCheckBigIntFormat",(e,t)=>{tr.init(e,t);let[i,r]=V[t.format];e._zod.onattach.push(e=>{let n=e._zod.bag;n.format=t.format,n.minimum=i,n.maximum=r}),e._zod.check=n=>{let s=n.value;s<i&&n.issues.push({origin:"bigint",input:s,code:"too_small",minimum:i,inclusive:!0,inst:e,continue:!t.abort}),s>r&&n.issues.push({origin:"bigint",input:s,code:"too_big",maximum:r,inclusive:!0,inst:e,continue:!t.abort})}}),th=d("$ZodCheckMaxSize",(e,t)=>{var i;tr.init(e,t),(i=e._zod.def).when??(i.when=e=>{let t=e.value;return!T(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{let i=e._zod.bag.maximum??1/0;t.maximum<i&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=i=>{let r=i.value;r.size<=t.maximum||i.issues.push({origin:W(r),code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),tc=d("$ZodCheckMinSize",(e,t)=>{var i;tr.init(e,t),(i=e._zod.def).when??(i.when=e=>{let t=e.value;return!T(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{let i=e._zod.bag.minimum??-1/0;t.minimum>i&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=i=>{let r=i.value;r.size>=t.minimum||i.issues.push({origin:W(r),code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),td=d("$ZodCheckSizeEquals",(e,t)=>{var i;tr.init(e,t),(i=e._zod.def).when??(i.when=e=>{let t=e.value;return!T(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{let i=e._zod.bag;i.minimum=t.size,i.maximum=t.size,i.size=t.size}),e._zod.check=i=>{let r=i.value,n=r.size;if(n===t.size)return;let s=n>t.size;i.issues.push({origin:W(r),...s?{code:"too_big",maximum:t.size}:{code:"too_small",minimum:t.size},inclusive:!0,exact:!0,input:i.value,inst:e,continue:!t.abort})}}),tp=d("$ZodCheckMaxLength",(e,t)=>{var i;tr.init(e,t),(i=e._zod.def).when??(i.when=e=>{let t=e.value;return!T(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let i=e._zod.bag.maximum??1/0;t.maximum<i&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=i=>{let r=i.value;if(r.length<=t.maximum)return;let n=q(r);i.issues.push({origin:n,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),tf=d("$ZodCheckMinLength",(e,t)=>{var i;tr.init(e,t),(i=e._zod.def).when??(i.when=e=>{let t=e.value;return!T(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let i=e._zod.bag.minimum??-1/0;t.minimum>i&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=i=>{let r=i.value;if(r.length>=t.minimum)return;let n=q(r);i.issues.push({origin:n,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),t_=d("$ZodCheckLengthEquals",(e,t)=>{var i;tr.init(e,t),(i=e._zod.def).when??(i.when=e=>{let t=e.value;return!T(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let i=e._zod.bag;i.minimum=t.length,i.maximum=t.length,i.length=t.length}),e._zod.check=i=>{let r=i.value,n=r.length;if(n===t.length)return;let s=q(r),a=n>t.length;i.issues.push({origin:s,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:i.value,inst:e,continue:!t.abort})}}),tm=d("$ZodCheckStringFormat",(e,t)=>{var i,r;tr.init(e,t),e._zod.onattach.push(e=>{let i=e._zod.bag;i.format=t.format,t.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(t.pattern))}),t.pattern?(i=e._zod).check??(i.check=i=>{t.pattern.lastIndex=0,t.pattern.test(i.value)||i.issues.push({origin:"string",code:"invalid_format",format:t.format,input:i.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),tg=d("$ZodCheckRegex",(e,t)=>{tm.init(e,t),e._zod.check=i=>{t.pattern.lastIndex=0,t.pattern.test(i.value)||i.issues.push({origin:"string",code:"invalid_format",format:"regex",input:i.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),tb=d("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=ej),tm.init(e,t)}),ty=d("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=eX),tm.init(e,t)}),tx=d("$ZodCheckIncludes",(e,t)=>{tr.init(e,t);let i=L(t.includes),r=new RegExp("number"==typeof t.position?`^.{${t.position}}${i}`:i);t.pattern=r,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=i=>{i.value.includes(t.includes,t.position)||i.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:i.value,inst:e,continue:!t.abort})}}),tT=d("$ZodCheckStartsWith",(e,t)=>{tr.init(e,t);let i=RegExp(`^${L(t.prefix)}.*`);t.pattern??(t.pattern=i),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(i)}),e._zod.check=i=>{i.value.startsWith(t.prefix)||i.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:i.value,inst:e,continue:!t.abort})}}),tv=d("$ZodCheckEndsWith",(e,t)=>{tr.init(e,t);let i=RegExp(`.*${L(t.suffix)}$`);t.pattern??(t.pattern=i),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(i)}),e._zod.check=i=>{i.value.endsWith(t.suffix)||i.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:i.value,inst:e,continue:!t.abort})}});function tA(e,t,i){e.issues.length&&t.issues.push(...z(i,e.issues))}let tS=d("$ZodCheckProperty",(e,t)=>{tr.init(e,t),e._zod.check=e=>{let i=t.schema._zod.run({value:e.value[t.property],issues:[]},{});if(i instanceof Promise)return i.then(i=>tA(i,e,t.property));tA(i,e,t.property)}}),tE=d("$ZodCheckMimeType",(e,t)=>{tr.init(e,t);let i=new Set(t.mime);e._zod.onattach.push(e=>{e._zod.bag.mime=t.mime}),e._zod.check=r=>{i.has(r.value.type)||r.issues.push({code:"invalid_value",values:t.mime,input:r.value.type,inst:e,continue:!t.abort})}}),tI=d("$ZodCheckOverwrite",(e,t)=>{tr.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});class tR{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let t=e.split("\n").filter(e=>e),i=Math.min(...t.map(e=>e.length-e.trimStart().length));for(let e of t.map(e=>e.slice(i)).map(e=>" ".repeat(2*this.indent)+e))this.content.push(e)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(e=>`  ${e}`)].join("\n"))}}let tP={major:4,minor:3,patch:5},tM=d("$ZodType",(e,t)=>{var i;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=tP;let r=[...e._zod.def.checks??[]];for(let t of(e._zod.traits.has("$ZodCheck")&&r.unshift(e),r))for(let i of t._zod.onattach)i(e);if(0===r.length)(i=e._zod).deferred??(i.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,i)=>{let r,n=G(e);for(let s of t){if(s._zod.def.when){if(!s._zod.def.when(e))continue}else if(n)continue;let t=e.issues.length,a=s._zod.check(e);if(a instanceof Promise&&i?.async===!1)throw new p;if(r||a instanceof Promise)r=(r??Promise.resolve()).then(async()=>{await a,e.issues.length!==t&&(n||(n=G(e,t)))});else{if(e.issues.length===t)continue;n||(n=G(e,t))}}return r?r.then(()=>e):e},i=(i,n,s)=>{if(G(i))return i.aborted=!0,i;let a=t(n,r,s);if(a instanceof Promise){if(!1===s.async)throw new p;return a.then(t=>e._zod.parse(t,s))}return e._zod.parse(a,s)};e._zod.run=(n,s)=>{if(s.skipChecks)return e._zod.parse(n,s);if("backward"===s.direction){let t=e._zod.parse({value:n.value,issues:[]},{...s,skipChecks:!0});return t instanceof Promise?t.then(e=>i(e,n,s)):i(t,n,s)}let a=e._zod.parse(n,s);if(a instanceof Promise){if(!1===s.async)throw new p;return a.then(e=>t(e,r,s))}return t(a,r,s)}}S(e,"~standard",()=>({validate:t=>{try{let i=ei(e,t);return i.success?{value:i.data}:{issues:i.error?.issues}}catch(i){return en(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}))}),tC=d("$ZodString",(e,t)=>{tM.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??eV(e._zod.bag),e._zod.parse=(i,r)=>{if(t.coerce)try{i.value=String(i.value)}catch(e){}return"string"==typeof i.value||i.issues.push({expected:"string",code:"invalid_type",input:i.value,inst:e}),i}}),tO=d("$ZodStringFormat",(e,t)=>{tm.init(e,t),tC.init(e,t)}),tw=d("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=ep),tO.init(e,t)}),tD=d("$ZodUUID",(e,t)=>{if(t.version){let e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=ef(e))}else t.pattern??(t.pattern=ef());tO.init(e,t)}),tN=d("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=eb),tO.init(e,t)}),tL=d("$ZodURL",(e,t)=>{tO.init(e,t),e._zod.check=i=>{try{let r=i.value.trim(),n=new URL(r);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(n.hostname)||i.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:i.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(n.protocol.endsWith(":")?n.protocol.slice(0,-1):n.protocol)||i.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:i.value,inst:e,continue:!t.abort})),t.normalize?i.value=n.href:i.value=r;return}catch(r){i.issues.push({code:"invalid_format",format:"url",input:i.value,inst:e,continue:!t.abort})}}}),tF=d("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=eS()),tO.init(e,t)}),tB=d("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=eh),tO.init(e,t)}),tk=d("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=es),tO.init(e,t)}),tU=d("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=ea),tO.init(e,t)}),tV=d("$ZodULID",(e,t)=>{t.pattern??(t.pattern=eo),tO.init(e,t)}),tG=d("$ZodXID",(e,t)=>{t.pattern??(t.pattern=el),tO.init(e,t)}),tz=d("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=eu),tO.init(e,t)}),t$=d("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=eU(t)),tO.init(e,t)}),tH=d("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=eF),tO.init(e,t)}),tW=d("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=ek(t)),tO.init(e,t)}),tq=d("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=ec),tO.init(e,t)}),tj=d("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=eE),tO.init(e,t),e._zod.bag.format="ipv4"}),tX=d("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=eI),tO.init(e,t),e._zod.bag.format="ipv6",e._zod.check=i=>{try{new URL(`http://[${i.value}]`)}catch{i.issues.push({code:"invalid_format",format:"ipv6",input:i.value,inst:e,continue:!t.abort})}}}),tZ=d("$ZodMAC",(e,t)=>{t.pattern??(t.pattern=eR(t.delimiter)),tO.init(e,t),e._zod.bag.format="mac"}),tY=d("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=eP),tO.init(e,t)}),tK=d("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=eM),tO.init(e,t),e._zod.check=i=>{let r=i.value.split("/");try{if(2!==r.length)throw Error();let[e,t]=r;if(!t)throw Error();let i=Number(t);if(`${i}`!==t||i<0||i>128)throw Error();new URL(`http://[${e}]`)}catch{i.issues.push({code:"invalid_format",format:"cidrv6",input:i.value,inst:e,continue:!t.abort})}}});function tQ(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}let tJ=d("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=eC),tO.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=i=>{tQ(i.value)||i.issues.push({code:"invalid_format",format:"base64",input:i.value,inst:e,continue:!t.abort})}}),t0=d("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=eO),tO.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=i=>{!function(e){if(!eO.test(e))return!1;let t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return tQ(t.padEnd(4*Math.ceil(t.length/4),"="))}(i.value)&&i.issues.push({code:"invalid_format",format:"base64url",input:i.value,inst:e,continue:!t.abort})}}),t1=d("$ZodE164",(e,t)=>{t.pattern??(t.pattern=eN),tO.init(e,t)}),t2=d("$ZodJWT",(e,t)=>{tO.init(e,t),e._zod.check=i=>{!function(e,t=null){try{let i=e.split(".");if(3!==i.length)return!1;let[r]=i;if(!r)return!1;let n=JSON.parse(atob(r));if("typ"in n&&n?.typ!=="JWT"||!n.alg||t&&(!("alg"in n)||n.alg!==t))return!1;return!0}catch{return!1}}(i.value,t.alg)&&i.issues.push({code:"invalid_format",format:"jwt",input:i.value,inst:e,continue:!t.abort})}}),t3=d("$ZodCustomStringFormat",(e,t)=>{tO.init(e,t),e._zod.check=i=>{t.fn(i.value)||i.issues.push({code:"invalid_format",format:t.format,input:i.value,inst:e,continue:!t.abort})}}),t4=d("$ZodNumber",(e,t)=>{tM.init(e,t),e._zod.pattern=e._zod.bag.pattern??e$,e._zod.parse=(i,r)=>{if(t.coerce)try{i.value=Number(i.value)}catch(e){}let n=i.value;if("number"==typeof n&&!Number.isNaN(n)&&Number.isFinite(n))return i;let s="number"==typeof n?Number.isNaN(n)?"NaN":Number.isFinite(n)?void 0:"Infinity":void 0;return i.issues.push({expected:"number",code:"invalid_type",input:n,inst:e,...s?{received:s}:{}}),i}}),t5=d("$ZodNumberFormat",(e,t)=>{tl.init(e,t),t4.init(e,t)}),t6=d("$ZodBoolean",(e,t)=>{tM.init(e,t),e._zod.pattern=eH,e._zod.parse=(i,r)=>{if(t.coerce)try{i.value=!!i.value}catch(e){}let n=i.value;return"boolean"==typeof n||i.issues.push({expected:"boolean",code:"invalid_type",input:n,inst:e}),i}}),t8=d("$ZodBigInt",(e,t)=>{tM.init(e,t),e._zod.pattern=eG,e._zod.parse=(i,r)=>{if(t.coerce)try{i.value=BigInt(i.value)}catch(e){}return"bigint"==typeof i.value||i.issues.push({expected:"bigint",code:"invalid_type",input:i.value,inst:e}),i}}),t9=d("$ZodBigIntFormat",(e,t)=>{tu.init(e,t),t8.init(e,t)}),t7=d("$ZodSymbol",(e,t)=>{tM.init(e,t),e._zod.parse=(t,i)=>{let r=t.value;return"symbol"==typeof r||t.issues.push({expected:"symbol",code:"invalid_type",input:r,inst:e}),t}}),ie=d("$ZodUndefined",(e,t)=>{tM.init(e,t),e._zod.pattern=eq,e._zod.values=new Set([void 0]),e._zod.optin="optional",e._zod.optout="optional",e._zod.parse=(t,i)=>{let r=t.value;return void 0===r||t.issues.push({expected:"undefined",code:"invalid_type",input:r,inst:e}),t}}),it=d("$ZodNull",(e,t)=>{tM.init(e,t),e._zod.pattern=eW,e._zod.values=new Set([null]),e._zod.parse=(t,i)=>{let r=t.value;return null===r||t.issues.push({expected:"null",code:"invalid_type",input:r,inst:e}),t}}),ii=d("$ZodAny",(e,t)=>{tM.init(e,t),e._zod.parse=e=>e}),ir=d("$ZodUnknown",(e,t)=>{tM.init(e,t),e._zod.parse=e=>e}),is=d("$ZodNever",(e,t)=>{tM.init(e,t),e._zod.parse=(t,i)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)}),ia=d("$ZodVoid",(e,t)=>{tM.init(e,t),e._zod.parse=(t,i)=>{let r=t.value;return void 0===r||t.issues.push({expected:"void",code:"invalid_type",input:r,inst:e}),t}}),io=d("$ZodDate",(e,t)=>{tM.init(e,t),e._zod.parse=(i,r)=>{if(t.coerce)try{i.value=new Date(i.value)}catch(e){}let n=i.value,s=n instanceof Date;return s&&!Number.isNaN(n.getTime())||i.issues.push({expected:"date",code:"invalid_type",input:n,...s?{received:"Invalid Date"}:{},inst:e}),i}});function il(e,t,i){e.issues.length&&t.issues.push(...z(i,e.issues)),t.value[i]=e.value}let iu=d("$ZodArray",(e,t)=>{tM.init(e,t),e._zod.parse=(i,r)=>{let n=i.value;if(!Array.isArray(n))return i.issues.push({expected:"array",code:"invalid_type",input:n,inst:e}),i;i.value=Array(n.length);let s=[];for(let e=0;e<n.length;e++){let a=n[e],o=t.element._zod.run({value:a,issues:[]},r);o instanceof Promise?s.push(o.then(t=>il(t,i,e))):il(o,i,e)}return s.length?Promise.all(s).then(()=>i):i}});function ih(e,t,i,r,n){if(e.issues.length){if(n&&!(i in r))return;t.issues.push(...z(i,e.issues))}void 0===e.value?i in r&&(t.value[i]=void 0):t.value[i]=e.value}function ic(e){var t;let i=Object.keys(e.shape);for(let t of i)if(!e.shape?.[t]?._zod?.traits?.has("$ZodType"))throw Error(`Invalid element at key "${t}": expected a Zod schema`);let r=Object.keys(t=e.shape).filter(e=>"optional"===t[e]._zod.optin&&"optional"===t[e]._zod.optout);return{...e,keys:i,keySet:new Set(i),numKeys:i.length,optionalKeys:new Set(r)}}function id(e,t,i,r,n,s){let a=[],o=n.keySet,l=n.catchall._zod,u=l.def.type,h="optional"===l.optout;for(let n in t){if(o.has(n))continue;if("never"===u){a.push(n);continue}let s=l.run({value:t[n],issues:[]},r);s instanceof Promise?e.push(s.then(e=>ih(e,i,n,t,h))):ih(s,i,n,t,h)}return(a.length&&i.issues.push({code:"unrecognized_keys",keys:a,input:t,inst:s}),e.length)?Promise.all(e).then(()=>i):i}let ip=d("$ZodObject",(e,t)=>{let i;tM.init(e,t);let r=Object.getOwnPropertyDescriptor(t,"shape");if(!r?.get){let e=t.shape;Object.defineProperty(t,"shape",{get:()=>{let i={...e};return Object.defineProperty(t,"shape",{value:i}),i}})}let n=x(()=>ic(t));S(e._zod,"propValues",()=>{let e=t.shape,i={};for(let t in e){let r=e[t]._zod;if(r.values)for(let e of(i[t]??(i[t]=new Set),r.values))i[t].add(e)}return i});let s=t.catchall;e._zod.parse=(t,r)=>{i??(i=n.value);let a=t.value;if(!M(a))return t.issues.push({expected:"object",code:"invalid_type",input:a,inst:e}),t;t.value={};let o=[],l=i.shape;for(let e of i.keys){let i=l[e],n="optional"===i._zod.optout,s=i._zod.run({value:a[e],issues:[]},r);s instanceof Promise?o.push(s.then(i=>ih(i,t,e,a,n))):ih(s,t,e,a,n)}return s?id(o,a,t,r,n.value,e):o.length?Promise.all(o).then(()=>t):t}}),i_=d("$ZodObjectJIT",(e,t)=>{let i,r;ip.init(e,t);let n=e._zod.parse,s=x(()=>ic(t)),a=!_.jitless,o=a&&C.value,l=t.catchall;e._zod.parse=(u,h)=>{r??(r=s.value);let c=u.value;return M(c)?a&&o&&h?.async===!1&&!0!==h.jitless?(i||(i=(e=>{let t=new tR(["shape","payload","ctx"]),i=s.value,r=e=>{let t=R(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");let n=Object.create(null),a=0;for(let e of i.keys)n[e]=`key_${a++}`;for(let s of(t.write("const newResult = {};"),i.keys)){let i=n[s],a=R(s),o=e[s],l=o?._zod?.optout==="optional";t.write(`const ${i} = ${r(s)};`),l?t.write(`
        if (${i}.issues.length) {
          if (${a} in input) {
            payload.issues = payload.issues.concat(${i}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${a}, ...iss.path] : [${a}]
            })));
          }
        }
        
        if (${i}.value === undefined) {
          if (${a} in input) {
            newResult[${a}] = undefined;
          }
        } else {
          newResult[${a}] = ${i}.value;
        }
        
      `):t.write(`
        if (${i}.issues.length) {
          payload.issues = payload.issues.concat(${i}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${a}, ...iss.path] : [${a}]
          })));
        }
        
        if (${i}.value === undefined) {
          if (${a} in input) {
            newResult[${a}] = undefined;
          }
        } else {
          newResult[${a}] = ${i}.value;
        }
        
      `)}t.write("payload.value = newResult;"),t.write("return payload;");let o=t.compile();return(t,i)=>o(e,t,i)})(t.shape)),u=i(u,h),l)?id([],c,u,h,r,e):u:n(u,h):(u.issues.push({expected:"object",code:"invalid_type",input:c,inst:e}),u)}});function im(e,t,i,r){for(let i of e)if(0===i.issues.length)return t.value=i.value,t;let n=e.filter(e=>!G(e));return 1===n.length?(t.value=n[0].value,n[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:i,errors:e.map(e=>e.issues.map(e=>H(e,r,m())))}),t)}let ig=d("$ZodUnion",(e,t)=>{tM.init(e,t),S(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),S(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),S(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),S(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>v(e.source)).join("|")})$`)}});let i=1===t.options.length,r=t.options[0]._zod.run;e._zod.parse=(n,s)=>{if(i)return r(n,s);let a=!1,o=[];for(let e of t.options){let t=e._zod.run({value:n.value,issues:[]},s);if(t instanceof Promise)o.push(t),a=!0;else{if(0===t.issues.length)return t;o.push(t)}}return a?Promise.all(o).then(t=>im(t,n,e,s)):im(o,n,e,s)}});function ib(e,t,i,r){let n=e.filter(e=>0===e.issues.length);return 1===n.length?t.value=n[0].value:0===n.length?t.issues.push({code:"invalid_union",input:t.value,inst:i,errors:e.map(e=>e.issues.map(e=>H(e,r,m())))}):t.issues.push({code:"invalid_union",input:t.value,inst:i,errors:[],inclusive:!1}),t}let iy=d("$ZodXor",(e,t)=>{ig.init(e,t),t.inclusive=!1;let i=1===t.options.length,r=t.options[0]._zod.run;e._zod.parse=(n,s)=>{if(i)return r(n,s);let a=!1,o=[];for(let e of t.options){let t=e._zod.run({value:n.value,issues:[]},s);t instanceof Promise?(o.push(t),a=!0):o.push(t)}return a?Promise.all(o).then(t=>ib(t,n,e,s)):ib(o,n,e,s)}}),ix=d("$ZodDiscriminatedUnion",(e,t)=>{t.inclusive=!1,ig.init(e,t);let i=e._zod.parse;S(e._zod,"propValues",()=>{let e={};for(let i of t.options){let r=i._zod.propValues;if(!r||0===Object.keys(r).length)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(i)}"`);for(let[t,i]of Object.entries(r))for(let r of(e[t]||(e[t]=new Set),i))e[t].add(r)}return e});let r=x(()=>{let e=t.options,i=new Map;for(let r of e){let e=r._zod.propValues?.[t.discriminator];if(!e||0===e.size)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(r)}"`);for(let t of e){if(i.has(t))throw Error(`Duplicate discriminator value "${String(t)}"`);i.set(t,r)}}return i});e._zod.parse=(n,s)=>{let a=n.value;if(!M(a))return n.issues.push({code:"invalid_type",expected:"object",input:a,inst:e}),n;let o=r.value.get(a?.[t.discriminator]);return o?o._zod.run(n,s):t.unionFallback?i(n,s):(n.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:t.discriminator,input:a,path:[t.discriminator],inst:e}),n)}}),iT=d("$ZodIntersection",(e,t)=>{tM.init(e,t),e._zod.parse=(e,i)=>{let r=e.value,n=t.left._zod.run({value:r,issues:[]},i),s=t.right._zod.run({value:r,issues:[]},i);return n instanceof Promise||s instanceof Promise?Promise.all([n,s]).then(([t,i])=>iv(e,t,i)):iv(e,n,s)}});function iv(e,t,i){let r,n=new Map;for(let i of t.issues)if("unrecognized_keys"===i.code)for(let e of(r??(r=i),i.keys))n.has(e)||n.set(e,{}),n.get(e).l=!0;else e.issues.push(i);for(let t of i.issues)if("unrecognized_keys"===t.code)for(let e of t.keys)n.has(e)||n.set(e,{}),n.get(e).r=!0;else e.issues.push(t);let s=[...n].filter(([,e])=>e.l&&e.r).map(([e])=>e);if(s.length&&r&&e.issues.push({...r,keys:s}),G(e))return e;let a=function e(t,i){if(t===i||t instanceof Date&&i instanceof Date&&+t==+i)return{valid:!0,data:t};if(O(t)&&O(i)){let r=Object.keys(i),n=Object.keys(t).filter(e=>-1!==r.indexOf(e)),s={...t,...i};for(let r of n){let n=e(t[r],i[r]);if(!n.valid)return{valid:!1,mergeErrorPath:[r,...n.mergeErrorPath]};s[r]=n.data}return{valid:!0,data:s}}if(Array.isArray(t)&&Array.isArray(i)){if(t.length!==i.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let s=e(t[n],i[n]);if(!s.valid)return{valid:!1,mergeErrorPath:[n,...s.mergeErrorPath]};r.push(s.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}(t.value,i.value);if(!a.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(a.mergeErrorPath)}`);return e.value=a.data,e}let iA=d("$ZodTuple",(e,t)=>{tM.init(e,t);let i=t.items;e._zod.parse=(r,n)=>{let s=r.value;if(!Array.isArray(s))return r.issues.push({input:s,inst:e,expected:"tuple",code:"invalid_type"}),r;r.value=[];let a=[],o=[...i].reverse().findIndex(e=>"optional"!==e._zod.optin),l=-1===o?0:i.length-o;if(!t.rest){let t=s.length>i.length,n=s.length<l-1;if(t||n)return r.issues.push({...t?{code:"too_big",maximum:i.length,inclusive:!0}:{code:"too_small",minimum:i.length},input:s,inst:e,origin:"array"}),r}let u=-1;for(let e of i){if(++u>=s.length&&u>=l)continue;let t=e._zod.run({value:s[u],issues:[]},n);t instanceof Promise?a.push(t.then(e=>iS(e,r,u))):iS(t,r,u)}if(t.rest)for(let e of s.slice(i.length)){u++;let i=t.rest._zod.run({value:e,issues:[]},n);i instanceof Promise?a.push(i.then(e=>iS(e,r,u))):iS(i,r,u)}return a.length?Promise.all(a).then(()=>r):r}});function iS(e,t,i){e.issues.length&&t.issues.push(...z(i,e.issues)),t.value[i]=e.value}let iE=d("$ZodRecord",(e,t)=>{tM.init(e,t),e._zod.parse=(i,r)=>{let n=i.value;if(!O(n))return i.issues.push({expected:"record",code:"invalid_type",input:n,inst:e}),i;let s=[],a=t.keyType._zod.values;if(a){let o;i.value={};let l=new Set;for(let e of a)if("string"==typeof e||"number"==typeof e||"symbol"==typeof e){l.add("number"==typeof e?e.toString():e);let a=t.valueType._zod.run({value:n[e],issues:[]},r);a instanceof Promise?s.push(a.then(t=>{t.issues.length&&i.issues.push(...z(e,t.issues)),i.value[e]=t.value})):(a.issues.length&&i.issues.push(...z(e,a.issues)),i.value[e]=a.value)}for(let e in n)l.has(e)||(o=o??[]).push(e);o&&o.length>0&&i.issues.push({code:"unrecognized_keys",input:n,inst:e,keys:o})}else for(let a of(i.value={},Reflect.ownKeys(n))){if("__proto__"===a)continue;let o=t.keyType._zod.run({value:a,issues:[]},r);if(o instanceof Promise)throw Error("Async schemas not supported in object keys currently");if("string"==typeof a&&e$.test(a)&&o.issues.length&&o.issues.some(e=>"invalid_type"===e.code&&"number"===e.expected)){let e=t.keyType._zod.run({value:Number(a),issues:[]},r);if(e instanceof Promise)throw Error("Async schemas not supported in object keys currently");0===e.issues.length&&(o=e)}if(o.issues.length){"loose"===t.mode?i.value[a]=n[a]:i.issues.push({code:"invalid_key",origin:"record",issues:o.issues.map(e=>H(e,r,m())),input:a,path:[a],inst:e});continue}let l=t.valueType._zod.run({value:n[a],issues:[]},r);l instanceof Promise?s.push(l.then(e=>{e.issues.length&&i.issues.push(...z(a,e.issues)),i.value[o.value]=e.value})):(l.issues.length&&i.issues.push(...z(a,l.issues)),i.value[o.value]=l.value)}return s.length?Promise.all(s).then(()=>i):i}}),iI=d("$ZodMap",(e,t)=>{tM.init(e,t),e._zod.parse=(i,r)=>{let n=i.value;if(!(n instanceof Map))return i.issues.push({expected:"map",code:"invalid_type",input:n,inst:e}),i;let s=[];for(let[a,o]of(i.value=new Map,n)){let l=t.keyType._zod.run({value:a,issues:[]},r),u=t.valueType._zod.run({value:o,issues:[]},r);l instanceof Promise||u instanceof Promise?s.push(Promise.all([l,u]).then(([t,s])=>{iR(t,s,i,a,n,e,r)})):iR(l,u,i,a,n,e,r)}return s.length?Promise.all(s).then(()=>i):i}});function iR(e,t,i,r,n,s,a){e.issues.length&&(D.has(typeof r)?i.issues.push(...z(r,e.issues)):i.issues.push({code:"invalid_key",origin:"map",input:n,inst:s,issues:e.issues.map(e=>H(e,a,m()))})),t.issues.length&&(D.has(typeof r)?i.issues.push(...z(r,t.issues)):i.issues.push({origin:"map",code:"invalid_element",input:n,inst:s,key:r,issues:t.issues.map(e=>H(e,a,m()))})),i.value.set(e.value,t.value)}let iP=d("$ZodSet",(e,t)=>{tM.init(e,t),e._zod.parse=(i,r)=>{let n=i.value;if(!(n instanceof Set))return i.issues.push({input:n,inst:e,expected:"set",code:"invalid_type"}),i;let s=[];for(let e of(i.value=new Set,n)){let n=t.valueType._zod.run({value:e,issues:[]},r);n instanceof Promise?s.push(n.then(e=>iM(e,i))):iM(n,i)}return s.length?Promise.all(s).then(()=>i):i}});function iM(e,t){e.issues.length&&t.issues.push(...e.issues),t.value.add(e.value)}let iC=d("$ZodEnum",(e,t)=>{tM.init(e,t);let i=g(t.entries),r=new Set(i);e._zod.values=r,e._zod.pattern=RegExp(`^(${i.filter(e=>D.has(typeof e)).map(e=>"string"==typeof e?L(e):e.toString()).join("|")})$`),e._zod.parse=(t,n)=>{let s=t.value;return r.has(s)||t.issues.push({code:"invalid_value",values:i,input:s,inst:e}),t}}),iO=d("$ZodLiteral",(e,t)=>{if(tM.init(e,t),0===t.values.length)throw Error("Cannot create literal schema with no valid values");let i=new Set(t.values);e._zod.values=i,e._zod.pattern=RegExp(`^(${t.values.map(e=>"string"==typeof e?L(e):e?L(e.toString()):String(e)).join("|")})$`),e._zod.parse=(r,n)=>{let s=r.value;return i.has(s)||r.issues.push({code:"invalid_value",values:t.values,input:s,inst:e}),r}}),iw=d("$ZodFile",(e,t)=>{tM.init(e,t),e._zod.parse=(t,i)=>{let r=t.value;return r instanceof File||t.issues.push({expected:"file",code:"invalid_type",input:r,inst:e}),t}}),iD=d("$ZodTransform",(e,t)=>{tM.init(e,t),e._zod.parse=(i,r)=>{if("backward"===r.direction)throw new f(e.constructor.name);let n=t.transform(i.value,i);if(r.async)return(n instanceof Promise?n:Promise.resolve(n)).then(e=>(i.value=e,i));if(n instanceof Promise)throw new p;return i.value=n,i}});function iN(e,t){return e.issues.length&&void 0===t?{issues:[],value:void 0}:e}let iL=d("$ZodOptional",(e,t)=>{tM.init(e,t),e._zod.optin="optional",e._zod.optout="optional",S(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),S(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${v(e.source)})?$`):void 0}),e._zod.parse=(e,i)=>{if("optional"===t.innerType._zod.optin){let r=t.innerType._zod.run(e,i);return r instanceof Promise?r.then(t=>iN(t,e.value)):iN(r,e.value)}return void 0===e.value?e:t.innerType._zod.run(e,i)}}),iF=d("$ZodExactOptional",(e,t)=>{iL.init(e,t),S(e._zod,"values",()=>t.innerType._zod.values),S(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(e,i)=>t.innerType._zod.run(e,i)}),iB=d("$ZodNullable",(e,t)=>{tM.init(e,t),S(e._zod,"optin",()=>t.innerType._zod.optin),S(e._zod,"optout",()=>t.innerType._zod.optout),S(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${v(e.source)}|null)$`):void 0}),S(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,i)=>null===e.value?e:t.innerType._zod.run(e,i)}),ik=d("$ZodDefault",(e,t)=>{tM.init(e,t),e._zod.optin="optional",S(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,i)=>{if("backward"===i.direction)return t.innerType._zod.run(e,i);if(void 0===e.value)return e.value=t.defaultValue,e;let r=t.innerType._zod.run(e,i);return r instanceof Promise?r.then(e=>iU(e,t)):iU(r,t)}});function iU(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}let iV=d("$ZodPrefault",(e,t)=>{tM.init(e,t),e._zod.optin="optional",S(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,i)=>("backward"===i.direction||void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,i))}),iG=d("$ZodNonOptional",(e,t)=>{tM.init(e,t),S(e._zod,"values",()=>{let e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(i,r)=>{let n=t.innerType._zod.run(i,r);return n instanceof Promise?n.then(t=>iz(t,e)):iz(n,e)}});function iz(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}let i$=d("$ZodSuccess",(e,t)=>{tM.init(e,t),e._zod.parse=(e,i)=>{if("backward"===i.direction)throw new f("ZodSuccess");let r=t.innerType._zod.run(e,i);return r instanceof Promise?r.then(t=>(e.value=0===t.issues.length,e)):(e.value=0===r.issues.length,e)}}),iH=d("$ZodCatch",(e,t)=>{tM.init(e,t),S(e._zod,"optin",()=>t.innerType._zod.optin),S(e._zod,"optout",()=>t.innerType._zod.optout),S(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,i)=>{if("backward"===i.direction)return t.innerType._zod.run(e,i);let r=t.innerType._zod.run(e,i);return r instanceof Promise?r.then(r=>(e.value=r.value,r.issues.length&&(e.value=t.catchValue({...e,error:{issues:r.issues.map(e=>H(e,i,m()))},input:e.value}),e.issues=[]),e)):(e.value=r.value,r.issues.length&&(e.value=t.catchValue({...e,error:{issues:r.issues.map(e=>H(e,i,m()))},input:e.value}),e.issues=[]),e)}}),iW=d("$ZodNaN",(e,t)=>{tM.init(e,t),e._zod.parse=(t,i)=>("number"==typeof t.value&&Number.isNaN(t.value)||t.issues.push({input:t.value,inst:e,expected:"nan",code:"invalid_type"}),t)}),iq=d("$ZodPipe",(e,t)=>{tM.init(e,t),S(e._zod,"values",()=>t.in._zod.values),S(e._zod,"optin",()=>t.in._zod.optin),S(e._zod,"optout",()=>t.out._zod.optout),S(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,i)=>{if("backward"===i.direction){let r=t.out._zod.run(e,i);return r instanceof Promise?r.then(e=>ij(e,t.in,i)):ij(r,t.in,i)}let r=t.in._zod.run(e,i);return r instanceof Promise?r.then(e=>ij(e,t.out,i)):ij(r,t.out,i)}});function ij(e,t,i){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},i)}let iX=d("$ZodCodec",(e,t)=>{tM.init(e,t),S(e._zod,"values",()=>t.in._zod.values),S(e._zod,"optin",()=>t.in._zod.optin),S(e._zod,"optout",()=>t.out._zod.optout),S(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,i)=>{if("forward"===(i.direction||"forward")){let r=t.in._zod.run(e,i);return r instanceof Promise?r.then(e=>iZ(e,t,i)):iZ(r,t,i)}{let r=t.out._zod.run(e,i);return r instanceof Promise?r.then(e=>iZ(e,t,i)):iZ(r,t,i)}}});function iZ(e,t,i){if(e.issues.length)return e.aborted=!0,e;if("forward"===(i.direction||"forward")){let r=t.transform(e.value,e);return r instanceof Promise?r.then(r=>iY(e,r,t.out,i)):iY(e,r,t.out,i)}{let r=t.reverseTransform(e.value,e);return r instanceof Promise?r.then(r=>iY(e,r,t.in,i)):iY(e,r,t.in,i)}}function iY(e,t,i,r){return e.issues.length?(e.aborted=!0,e):i._zod.run({value:t,issues:e.issues},r)}let iK=d("$ZodReadonly",(e,t)=>{tM.init(e,t),S(e._zod,"propValues",()=>t.innerType._zod.propValues),S(e._zod,"values",()=>t.innerType._zod.values),S(e._zod,"optin",()=>t.innerType?._zod?.optin),S(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(e,i)=>{if("backward"===i.direction)return t.innerType._zod.run(e,i);let r=t.innerType._zod.run(e,i);return r instanceof Promise?r.then(iQ):iQ(r)}});function iQ(e){return e.value=Object.freeze(e.value),e}let iJ=d("$ZodTemplateLiteral",(e,t)=>{tM.init(e,t);let i=[];for(let e of t.parts)if("object"==typeof e&&null!==e){if(!e._zod.pattern)throw Error(`Invalid template literal part, no pattern found: ${[...e._zod.traits].shift()}`);let t=e._zod.pattern instanceof RegExp?e._zod.pattern.source:e._zod.pattern;if(!t)throw Error(`Invalid template literal part: ${e._zod.traits}`);let r=+!!t.startsWith("^"),n=t.endsWith("$")?t.length-1:t.length;i.push(t.slice(r,n))}else if(null===e||N.has(typeof e))i.push(L(`${e}`));else throw Error(`Invalid template literal part: ${e}`);e._zod.pattern=RegExp(`^${i.join("")}$`),e._zod.parse=(i,r)=>("string"!=typeof i.value?i.issues.push({input:i.value,inst:e,expected:"string",code:"invalid_type"}):(e._zod.pattern.lastIndex=0,e._zod.pattern.test(i.value)||i.issues.push({input:i.value,inst:e,code:"invalid_format",format:t.format??"template_literal",pattern:e._zod.pattern.source})),i)}),i0=d("$ZodFunction",(e,t)=>(tM.init(e,t),e._def=t,e._zod.def=t,e.implement=t=>{if("function"!=typeof t)throw Error("implement() must be called with a function");return function(...i){let r=Reflect.apply(t,this,e._def.input?Q(e._def.input,i):i);return e._def.output?Q(e._def.output,r):r}},e.implementAsync=t=>{if("function"!=typeof t)throw Error("implementAsync() must be called with a function");return async function(...i){let r=e._def.input?await ee(e._def.input,i):i,n=await Reflect.apply(t,this,r);return e._def.output?await ee(e._def.output,n):n}},e._zod.parse=(t,i)=>("function"!=typeof t.value?t.issues.push({code:"invalid_type",expected:"function",input:t.value,inst:e}):e._def.output&&"promise"===e._def.output._zod.def.type?t.value=e.implementAsync(t.value):t.value=e.implement(t.value),t),e.input=(...t)=>{let i=e.constructor;return new i(Array.isArray(t[0])?{type:"function",input:new iA({type:"tuple",items:t[0],rest:t[1]}),output:e._def.output}:{type:"function",input:t[0],output:e._def.output})},e.output=t=>new e.constructor({type:"function",input:e._def.input,output:t}),e)),i1=d("$ZodPromise",(e,t)=>{tM.init(e,t),e._zod.parse=(e,i)=>Promise.resolve(e.value).then(e=>t.innerType._zod.run({value:e,issues:[]},i))}),i2=d("$ZodLazy",(e,t)=>{tM.init(e,t),S(e._zod,"innerType",()=>t.getter()),S(e._zod,"pattern",()=>e._zod.innerType?._zod?.pattern),S(e._zod,"propValues",()=>e._zod.innerType?._zod?.propValues),S(e._zod,"optin",()=>e._zod.innerType?._zod?.optin??void 0),S(e._zod,"optout",()=>e._zod.innerType?._zod?.optout??void 0),e._zod.parse=(t,i)=>e._zod.innerType._zod.run(t,i)}),i3=d("$ZodCustom",(e,t)=>{tr.init(e,t),tM.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=i=>{let r=i.value,n=t.fn(r);if(n instanceof Promise)return n.then(t=>i4(t,i,r,e));i4(n,i,r,e)}});function i4(e,t,i,r){if(!e){let e={code:"custom",input:i,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(e.params=r._zod.def.params),t.issues.push(j(e))}}Symbol("ZodOutput"),Symbol("ZodInput");(a=globalThis).__zod_globalRegistry??(a.__zod_globalRegistry=new class e{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){let i=t[0];return this._map.set(e,i),i&&"object"==typeof i&&"id"in i&&this._idmap.set(i.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let i={...this.get(t)??{}};delete i.id;let r={...i,...this._map.get(e)};return Object.keys(r).length?r:void 0}return this._map.get(e)}has(e){return this._map.has(e)}});let i5=globalThis.__zod_globalRegistry;function i6(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...B(t)})}function i8(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...B(t)})}function i9(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...B(t)})}function i7(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...B(t)})}function re(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...B(t)})}function rt(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...B(t)})}function ri(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...B(t)})}function rr(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...B(t)})}function rn(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...B(t)})}function rs(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...B(t)})}function ra(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...B(t)})}function ro(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...B(t)})}function rl(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...B(t)})}function ru(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...B(t)})}function rh(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...B(t)})}function rc(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...B(t)})}function rd(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...B(t)})}function rp(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...B(t)})}function rf(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...B(t)})}function r_(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...B(t)})}function rm(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...B(t)})}function rg(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...B(t)})}function rb(e,t){return new ts({check:"less_than",...B(t),value:e,inclusive:!1})}function ry(e,t){return new ts({check:"less_than",...B(t),value:e,inclusive:!0})}function rx(e,t){return new ta({check:"greater_than",...B(t),value:e,inclusive:!1})}function rT(e,t){return new ta({check:"greater_than",...B(t),value:e,inclusive:!0})}function rv(e){return rx(0,e)}function rA(e){return rb(0,e)}function rS(e){return ry(0,e)}function rE(e){return rT(0,e)}function rI(e,t){return new to({check:"multiple_of",...B(t),value:e})}function rR(e,t){return new th({check:"max_size",...B(t),maximum:e})}function rP(e,t){return new tc({check:"min_size",...B(t),minimum:e})}function rM(e,t){return new td({check:"size_equals",...B(t),size:e})}function rC(e,t){return new tp({check:"max_length",...B(t),maximum:e})}function rO(e,t){return new tf({check:"min_length",...B(t),minimum:e})}function rw(e,t){return new t_({check:"length_equals",...B(t),length:e})}function rD(e,t){return new tg({check:"string_format",format:"regex",...B(t),pattern:e})}function rN(e){return new tb({check:"string_format",format:"lowercase",...B(e)})}function rL(e){return new ty({check:"string_format",format:"uppercase",...B(e)})}function rF(e,t){return new tx({check:"string_format",format:"includes",...B(t),includes:e})}function rB(e,t){return new tT({check:"string_format",format:"starts_with",...B(t),prefix:e})}function rk(e,t){return new tv({check:"string_format",format:"ends_with",...B(t),suffix:e})}function rU(e,t,i){return new tS({check:"property",property:e,schema:t,...B(i)})}function rV(e,t){return new tE({check:"mime_type",mime:e,...B(t)})}function rG(e){return new tI({check:"overwrite",tx:e})}function rz(e){return rG(t=>t.normalize(e))}function r$(){return rG(e=>e.trim())}function rH(){return rG(e=>e.toLowerCase())}function rW(){return rG(e=>e.toUpperCase())}function rq(){return rG(e=>e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""))}function rj(e,t,i,r={}){let n=B(r),s={...B(r),check:"string_format",type:"string",format:t,fn:"function"==typeof i?i:e=>i.test(e),...n};return i instanceof RegExp&&(s.pattern=i),new e(s)}function rX(e){let t=e?.target??"draft-2020-12";return"draft-4"===t&&(t="draft-04"),"draft-7"===t&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:e?.metadata??i5,target:t,unrepresentable:e?.unrepresentable??"throw",override:e?.override??(()=>{}),io:e?.io??"output",counter:0,seen:new Map,cycles:e?.cycles??"ref",reused:e?.reused??"inline",external:e?.external??void 0}}function rZ(e,t,i={path:[],schemaPath:[]}){var r;let n=e._zod.def,s=t.seen.get(e);if(s)return s.count++,i.schemaPath.includes(e)&&(s.cycle=i.path),s.schema;let a={schema:{},count:1,cycle:void 0,path:i.path};t.seen.set(e,a);let o=e._zod.toJSONSchema?.();if(o)a.schema=o;else{let r={...i,schemaPath:[...i.schemaPath,e],path:i.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,a.schema,r);else{let i=a.schema,s=t.processors[n.type];if(!s)throw Error(`[toJSONSchema]: Non-representable type encountered: ${n.type}`);s(e,t,i,r)}let s=e._zod.parent;s&&(a.ref||(a.ref=s),rZ(s,t,r),t.seen.get(s).isParent=!0)}let l=t.metadataRegistry.get(e);return l&&Object.assign(a.schema,l),"input"===t.io&&function e(t,i){let r=i??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let n=t._zod.def;if("transform"===n.type)return!0;if("array"===n.type)return e(n.element,r);if("set"===n.type)return e(n.valueType,r);if("lazy"===n.type)return e(n.getter(),r);if("promise"===n.type||"optional"===n.type||"nonoptional"===n.type||"nullable"===n.type||"readonly"===n.type||"default"===n.type||"prefault"===n.type)return e(n.innerType,r);if("intersection"===n.type)return e(n.left,r)||e(n.right,r);if("record"===n.type||"map"===n.type)return e(n.keyType,r)||e(n.valueType,r);if("pipe"===n.type)return e(n.in,r)||e(n.out,r);if("object"===n.type){for(let t in n.shape)if(e(n.shape[t],r))return!0;return!1}if("union"===n.type){for(let t of n.options)if(e(t,r))return!0;return!1}if("tuple"===n.type){for(let t of n.items)if(e(t,r))return!0;if(n.rest&&e(n.rest,r))return!0}return!1}(e)&&(delete a.schema.examples,delete a.schema.default),"input"===t.io&&a.schema._prefault&&((r=a.schema).default??(r.default=a.schema._prefault)),delete a.schema._prefault,t.seen.get(e).schema}function rY(e,t){let i=e.seen.get(t);if(!i)throw Error("Unprocessed schema. This is a bug in Zod.");let r=new Map;for(let t of e.seen.entries()){let i=e.metadataRegistry.get(t[0])?.id;if(i){let e=r.get(i);if(e&&e!==t[0])throw Error(`Duplicate schema id "${i}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);r.set(i,t[0])}}let n=t=>{if(t[1].schema.$ref)return;let r=t[1],{ref:n,defId:s}=(t=>{let r="draft-2020-12"===e.target?"$defs":"definitions";if(e.external){let i=e.external.registry.get(t[0])?.id,n=e.external.uri??(e=>e);if(i)return{ref:n(i)};let s=t[1].defId??t[1].schema.id??`schema${e.counter++}`;return t[1].defId=s,{defId:s,ref:`${n("__shared")}#/${r}/${s}`}}if(t[1]===i)return{ref:"#"};let n=`#/${r}/`,s=t[1].schema.id??`__schema${e.counter++}`;return{defId:s,ref:n+s}})(t);r.def={...r.schema},s&&(r.defId=s);let a=r.schema;for(let e in a)delete a[e];a.$ref=n};if("throw"===e.cycles)for(let t of e.seen.entries()){let e=t[1];if(e.cycle)throw Error(`Cycle detected: #/${e.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let i of e.seen.entries()){let r=i[1];if(t===i[0]){n(i);continue}if(e.external){let r=e.external.registry.get(i[0])?.id;if(t!==i[0]&&r){n(i);continue}}if(e.metadataRegistry.get(i[0])?.id||r.cycle||r.count>1&&"ref"===e.reused){n(i);continue}}}function rK(e,t){let i=e.seen.get(t);if(!i)throw Error("Unprocessed schema. This is a bug in Zod.");let r=t=>{let i=e.seen.get(t);if(null===i.ref)return;let n=i.def??i.schema,s={...n},a=i.ref;if(i.ref=null,a){r(a);let i=e.seen.get(a),o=i.schema;if(o.$ref&&("draft-07"===e.target||"draft-04"===e.target||"openapi-3.0"===e.target)?(n.allOf=n.allOf??[],n.allOf.push(o)):Object.assign(n,o),Object.assign(n,s),t._zod.parent===a)for(let e in n)"$ref"!==e&&"allOf"!==e&&(e in s||delete n[e]);if(o.$ref)for(let e in n)"$ref"!==e&&"allOf"!==e&&e in i.def&&JSON.stringify(n[e])===JSON.stringify(i.def[e])&&delete n[e]}let o=t._zod.parent;if(o&&o!==a){r(o);let t=e.seen.get(o);if(t?.schema.$ref&&(n.$ref=t.schema.$ref,t.def))for(let e in n)"$ref"!==e&&"allOf"!==e&&e in t.def&&JSON.stringify(n[e])===JSON.stringify(t.def[e])&&delete n[e]}e.override({zodSchema:t,jsonSchema:n,path:i.path??[]})};for(let t of[...e.seen.entries()].reverse())r(t[0]);let n={};if("draft-2020-12"===e.target?n.$schema="https://json-schema.org/draft/2020-12/schema":"draft-07"===e.target?n.$schema="http://json-schema.org/draft-07/schema#":"draft-04"===e.target?n.$schema="http://json-schema.org/draft-04/schema#":e.target,e.external?.uri){let i=e.external.registry.get(t)?.id;if(!i)throw Error("Schema is missing an `id` property");n.$id=e.external.uri(i)}Object.assign(n,i.def??i.schema);let s=e.external?.defs??{};for(let t of e.seen.entries()){let e=t[1];e.def&&e.defId&&(s[e.defId]=e.def)}e.external||Object.keys(s).length>0&&("draft-2020-12"===e.target?n.$defs=s:n.definitions=s);try{let i=JSON.parse(JSON.stringify(n));return Object.defineProperty(i,"~standard",{value:{...t["~standard"],jsonSchema:{input:rQ(t,"input",e.processors),output:rQ(t,"output",e.processors)}},enumerable:!1,writable:!1}),i}catch(e){throw Error("Error converting schema to JSON.")}}let rQ=(e,t,i={})=>r=>{let{libraryOptions:n,target:s}=r??{},a=rX({...n??{},target:s,io:t,processors:i});return rZ(e,a),rY(a,e),rK(a,e)},rJ={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},r0=(e,t,i,r)=>{let n=e._zod.def,s=!1===n.inclusive,a=n.options.map((e,i)=>rZ(e,t,{...r,path:[...r.path,s?"oneOf":"anyOf",i]}));s?i.oneOf=a:i.anyOf=a},r1=(e,t,i,r)=>{let n=e._zod.def;rZ(n.innerType,t,r),t.seen.get(e).ref=n.innerType},r2=d("ZodISODateTime",(e,t)=>{t$.init(e,t),nb.init(e,t)});function r3(e){return new r2({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...B(e)})}let r4=d("ZodISODate",(e,t)=>{tH.init(e,t),nb.init(e,t)});function r5(e){return new r4({type:"string",format:"date",check:"string_format",...B(e)})}let r6=d("ZodISOTime",(e,t)=>{tW.init(e,t),nb.init(e,t)});function r8(e){return new r6({type:"string",format:"time",check:"string_format",precision:null,...B(e)})}let r9=d("ZodISODuration",(e,t)=>{tq.init(e,t),nb.init(e,t)});function r7(e){return new r9({type:"string",format:"duration",check:"string_format",...B(e)})}let ne=(e,t)=>{Z.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>(function(e,t=e=>e.message){let i={_errors:[]},r=e=>{for(let n of e.issues)if("invalid_union"===n.code&&n.errors.length)n.errors.map(e=>r({issues:e}));else if("invalid_key"===n.code)r({issues:n.issues});else if("invalid_element"===n.code)r({issues:n.issues});else if(0===n.path.length)i._errors.push(t(n));else{let e=i,r=0;for(;r<n.path.length;){let i=n.path[r];r===n.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(t(n))):e[i]=e[i]||{_errors:[]},e=e[i],r++}}};return r(e),i})(e,t)},flatten:{value:t=>(function(e,t=e=>e.message){let i={},r=[];for(let n of e.issues)n.path.length>0?(i[n.path[0]]=i[n.path[0]]||[],i[n.path[0]].push(t(n))):r.push(t(n));return{formErrors:r,fieldErrors:i}})(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,y,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,y,2)}},isEmpty:{get:()=>0===e.issues.length}})};d("ZodError",ne);let nt=d("ZodError",ne,{Parent:Error}),ni=K(nt),nr=J(nt),nn=et(nt),ns=er(nt),na=(e,t,i)=>{let r=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return K(nt)(e,t,r)},no=(e,t,i)=>K(nt)(e,t,i),nl=async(e,t,i)=>{let r=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return J(nt)(e,t,r)},nu=async(e,t,i)=>J(nt)(e,t,i),nh=(e,t,i)=>{let r=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return et(nt)(e,t,r)},nc=(e,t,i)=>et(nt)(e,t,i),nd=async(e,t,i)=>{let r=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return er(nt)(e,t,r)},np=async(e,t,i)=>er(nt)(e,t,i),nf=d("ZodType",(e,t)=>(tM.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:rQ(e,"input"),output:rQ(e,"output")}}),e.toJSONSchema=((e,t={})=>i=>{let r=rX({...i,processors:t});return rZ(e,r),rY(r,e),rK(r,e)})(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...i)=>e.clone(I(t,{checks:[...t.checks??[],...i.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),{parent:!0}),e.with=e.check,e.clone=(t,i)=>F(e,t,i),e.brand=()=>e,e.register=(t,i)=>(t.add(e,i),e),e.parse=(t,i)=>ni(e,t,i,{callee:e.parse}),e.safeParse=(t,i)=>nn(e,t,i),e.parseAsync=async(t,i)=>nr(e,t,i,{callee:e.parseAsync}),e.safeParseAsync=async(t,i)=>ns(e,t,i),e.spa=e.safeParseAsync,e.encode=(t,i)=>na(e,t,i),e.decode=(t,i)=>no(e,t,i),e.encodeAsync=async(t,i)=>nl(e,t,i),e.decodeAsync=async(t,i)=>nu(e,t,i),e.safeEncode=(t,i)=>nh(e,t,i),e.safeDecode=(t,i)=>nc(e,t,i),e.safeEncodeAsync=async(t,i)=>nd(e,t,i),e.safeDecodeAsync=async(t,i)=>np(e,t,i),e.refine=(t,i)=>e.check(aG(t,i)),e.superRefine=t=>e.check(az(t)),e.overwrite=t=>e.check(rG(t)),e.optional=()=>aa(e),e.exactOptional=()=>al(e),e.nullable=()=>ah(e),e.nullish=()=>aa(ah(e)),e.nonoptional=t=>ag(e,t),e.array=()=>sF(e),e.or=t=>s$([e,t]),e.and=t=>sZ(e,t),e.transform=t=>aE(e,an(t)),e.default=t=>ap(e,t),e.prefault=t=>a_(e,t),e.catch=t=>aT(e,t),e.pipe=t=>aE(e,t),e.readonly=()=>aM(e),e.describe=t=>{let i=e.clone();return i5.add(i,{description:t}),i},Object.defineProperty(e,"description",{get:()=>i5.get(e)?.description,configurable:!0}),e.meta=(...t)=>{if(0===t.length)return i5.get(e);let i=e.clone();return i5.add(i,t[0]),i},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=t=>t(e),e)),n_=d("_ZodString",(e,t)=>{tC.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>((e,t,i,r)=>{i.type="string";let{minimum:n,maximum:s,format:a,patterns:o,contentEncoding:l}=e._zod.bag;if("number"==typeof n&&(i.minLength=n),"number"==typeof s&&(i.maxLength=s),a&&(i.format=rJ[a]??a,""===i.format&&delete i.format,"time"===a&&delete i.format),l&&(i.contentEncoding=l),o&&o.size>0){let e=[...o];1===e.length?i.pattern=e[0].source:e.length>1&&(i.allOf=[...e.map(e=>({..."draft-07"===t.target||"draft-04"===t.target||"openapi-3.0"===t.target?{type:"string"}:{},pattern:e.source}))])}})(e,t,i,0);let i=e._zod.bag;e.format=i.format??null,e.minLength=i.minimum??null,e.maxLength=i.maximum??null,e.regex=(...t)=>e.check(rD(...t)),e.includes=(...t)=>e.check(rF(...t)),e.startsWith=(...t)=>e.check(rB(...t)),e.endsWith=(...t)=>e.check(rk(...t)),e.min=(...t)=>e.check(rO(...t)),e.max=(...t)=>e.check(rC(...t)),e.length=(...t)=>e.check(rw(...t)),e.nonempty=(...t)=>e.check(rO(1,...t)),e.lowercase=t=>e.check(rN(t)),e.uppercase=t=>e.check(rL(t)),e.trim=()=>e.check(r$()),e.normalize=(...t)=>e.check(rz(...t)),e.toLowerCase=()=>e.check(rH()),e.toUpperCase=()=>e.check(rW()),e.slugify=()=>e.check(rq())}),nm=d("ZodString",(e,t)=>{tC.init(e,t),n_.init(e,t),e.email=t=>e.check(i6(ny,t)),e.url=t=>e.check(ri(nP,t)),e.jwt=t=>e.check(rg(n8,t)),e.emoji=t=>e.check(rr(nO,t)),e.guid=t=>e.check(i8(nT,t)),e.uuid=t=>e.check(i9(nA,t)),e.uuidv4=t=>e.check(i7(nA,t)),e.uuidv6=t=>e.check(re(nA,t)),e.uuidv7=t=>e.check(rt(nA,t)),e.nanoid=t=>e.check(rn(nD,t)),e.guid=t=>e.check(i8(nT,t)),e.cuid=t=>e.check(rs(nL,t)),e.cuid2=t=>e.check(ra(nB,t)),e.ulid=t=>e.check(ro(nU,t)),e.base64=t=>e.check(rf(n1,t)),e.base64url=t=>e.check(r_(n3,t)),e.xid=t=>e.check(rl(nG,t)),e.ksuid=t=>e.check(ru(n$,t)),e.ipv4=t=>e.check(rh(nW,t)),e.ipv6=t=>e.check(rc(nZ,t)),e.cidrv4=t=>e.check(rd(nK,t)),e.cidrv6=t=>e.check(rp(nJ,t)),e.e164=t=>e.check(rm(n5,t)),e.datetime=t=>e.check(r3(t)),e.date=t=>e.check(r5(t)),e.time=t=>e.check(r8(t)),e.duration=t=>e.check(r7(t))});function ng(e){return new nm({type:"string",...B(e)})}let nb=d("ZodStringFormat",(e,t)=>{tO.init(e,t),n_.init(e,t)}),ny=d("ZodEmail",(e,t)=>{tN.init(e,t),nb.init(e,t)});function nx(e){return i6(ny,e)}let nT=d("ZodGUID",(e,t)=>{tw.init(e,t),nb.init(e,t)});function nv(e){return i8(nT,e)}let nA=d("ZodUUID",(e,t)=>{tD.init(e,t),nb.init(e,t)});function nS(e){return i9(nA,e)}function nE(e){return i7(nA,e)}function nI(e){return re(nA,e)}function nR(e){return rt(nA,e)}let nP=d("ZodURL",(e,t)=>{tL.init(e,t),nb.init(e,t)});function nM(e){return ri(nP,e)}function nC(e){return ri(nP,{protocol:/^https?$/,hostname:eD,...B(e)})}let nO=d("ZodEmoji",(e,t)=>{tF.init(e,t),nb.init(e,t)});function nw(e){return rr(nO,e)}let nD=d("ZodNanoID",(e,t)=>{tB.init(e,t),nb.init(e,t)});function nN(e){return rn(nD,e)}let nL=d("ZodCUID",(e,t)=>{tk.init(e,t),nb.init(e,t)});function nF(e){return rs(nL,e)}let nB=d("ZodCUID2",(e,t)=>{tU.init(e,t),nb.init(e,t)});function nk(e){return ra(nB,e)}let nU=d("ZodULID",(e,t)=>{tV.init(e,t),nb.init(e,t)});function nV(e){return ro(nU,e)}let nG=d("ZodXID",(e,t)=>{tG.init(e,t),nb.init(e,t)});function nz(e){return rl(nG,e)}let n$=d("ZodKSUID",(e,t)=>{tz.init(e,t),nb.init(e,t)});function nH(e){return ru(n$,e)}let nW=d("ZodIPv4",(e,t)=>{tj.init(e,t),nb.init(e,t)});function nq(e){return rh(nW,e)}let nj=d("ZodMAC",(e,t)=>{tZ.init(e,t),nb.init(e,t)});function nX(e){return new nj({type:"string",format:"mac",check:"string_format",abort:!1,...B(e)})}let nZ=d("ZodIPv6",(e,t)=>{tX.init(e,t),nb.init(e,t)});function nY(e){return rc(nZ,e)}let nK=d("ZodCIDRv4",(e,t)=>{tY.init(e,t),nb.init(e,t)});function nQ(e){return rd(nK,e)}let nJ=d("ZodCIDRv6",(e,t)=>{tK.init(e,t),nb.init(e,t)});function n0(e){return rp(nJ,e)}let n1=d("ZodBase64",(e,t)=>{tJ.init(e,t),nb.init(e,t)});function n2(e){return rf(n1,e)}let n3=d("ZodBase64URL",(e,t)=>{t0.init(e,t),nb.init(e,t)});function n4(e){return r_(n3,e)}let n5=d("ZodE164",(e,t)=>{t1.init(e,t),nb.init(e,t)});function n6(e){return rm(n5,e)}let n8=d("ZodJWT",(e,t)=>{t2.init(e,t),nb.init(e,t)});function n9(e){return rg(n8,e)}let n7=d("ZodCustomStringFormat",(e,t)=>{t3.init(e,t),nb.init(e,t)});function se(e,t,i={}){return rj(n7,e,t,i)}function st(e){return rj(n7,"hostname",ew,e)}function si(e){return rj(n7,"hex",eZ,e)}function sr(e,t){let i=t?.enc??"hex",r=`${e}_${i}`,n=l[r];if(!n)throw Error(`Unrecognized hash format: ${r}`);return rj(n7,r,n,t)}let sn=d("ZodNumber",(e,t)=>{t4.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>((e,t,i,r)=>{let{minimum:n,maximum:s,format:a,multipleOf:o,exclusiveMaximum:l,exclusiveMinimum:u}=e._zod.bag;"string"==typeof a&&a.includes("int")?i.type="integer":i.type="number","number"==typeof u&&("draft-04"===t.target||"openapi-3.0"===t.target?(i.minimum=u,i.exclusiveMinimum=!0):i.exclusiveMinimum=u),"number"==typeof n&&(i.minimum=n,"number"==typeof u&&"draft-04"!==t.target&&(u>=n?delete i.minimum:delete i.exclusiveMinimum)),"number"==typeof l&&("draft-04"===t.target||"openapi-3.0"===t.target?(i.maximum=l,i.exclusiveMaximum=!0):i.exclusiveMaximum=l),"number"==typeof s&&(i.maximum=s,"number"==typeof l&&"draft-04"!==t.target&&(l<=s?delete i.maximum:delete i.exclusiveMaximum)),"number"==typeof o&&(i.multipleOf=o)})(e,t,i,0),e.gt=(t,i)=>e.check(rx(t,i)),e.gte=(t,i)=>e.check(rT(t,i)),e.min=(t,i)=>e.check(rT(t,i)),e.lt=(t,i)=>e.check(rb(t,i)),e.lte=(t,i)=>e.check(ry(t,i)),e.max=(t,i)=>e.check(ry(t,i)),e.int=t=>e.check(so(t)),e.safe=t=>e.check(so(t)),e.positive=t=>e.check(rx(0,t)),e.nonnegative=t=>e.check(rT(0,t)),e.negative=t=>e.check(rb(0,t)),e.nonpositive=t=>e.check(ry(0,t)),e.multipleOf=(t,i)=>e.check(rI(t,i)),e.step=(t,i)=>e.check(rI(t,i)),e.finite=()=>e;let i=e._zod.bag;e.minValue=Math.max(i.minimum??-1/0,i.exclusiveMinimum??-1/0)??null,e.maxValue=Math.min(i.maximum??1/0,i.exclusiveMaximum??1/0)??null,e.isInt=(i.format??"").includes("int")||Number.isSafeInteger(i.multipleOf??.5),e.isFinite=!0,e.format=i.format??null});function ss(e){return new sn({type:"number",checks:[],...B(e)})}let sa=d("ZodNumberFormat",(e,t)=>{t5.init(e,t),sn.init(e,t)});function so(e){return new sa({type:"number",check:"number_format",abort:!1,format:"safeint",...B(e)})}function sl(e){return new sa({type:"number",check:"number_format",abort:!1,format:"float32",...B(e)})}function su(e){return new sa({type:"number",check:"number_format",abort:!1,format:"float64",...B(e)})}function sh(e){return new sa({type:"number",check:"number_format",abort:!1,format:"int32",...B(e)})}function sc(e){return new sa({type:"number",check:"number_format",abort:!1,format:"uint32",...B(e)})}let sd=d("ZodBoolean",(e,t)=>{t6.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>{t.type="boolean"}});function sp(e){return new sd({type:"boolean",...B(e)})}let sf=d("ZodBigInt",(e,t)=>{t8.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("BigInt cannot be represented in JSON Schema")})(0,e,0,0),e.gte=(t,i)=>e.check(rT(t,i)),e.min=(t,i)=>e.check(rT(t,i)),e.gt=(t,i)=>e.check(rx(t,i)),e.gte=(t,i)=>e.check(rT(t,i)),e.min=(t,i)=>e.check(rT(t,i)),e.lt=(t,i)=>e.check(rb(t,i)),e.lte=(t,i)=>e.check(ry(t,i)),e.max=(t,i)=>e.check(ry(t,i)),e.positive=t=>e.check(rx(BigInt(0),t)),e.negative=t=>e.check(rb(BigInt(0),t)),e.nonpositive=t=>e.check(ry(BigInt(0),t)),e.nonnegative=t=>e.check(rT(BigInt(0),t)),e.multipleOf=(t,i)=>e.check(rI(t,i));let i=e._zod.bag;e.minValue=i.minimum??null,e.maxValue=i.maximum??null,e.format=i.format??null});function s_(e){return new sf({type:"bigint",...B(e)})}let sm=d("ZodBigIntFormat",(e,t)=>{t9.init(e,t),sf.init(e,t)});function sg(e){return new sm({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...B(e)})}function sb(e){return new sm({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...B(e)})}let sy=d("ZodSymbol",(e,t)=>{t7.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("Symbols cannot be represented in JSON Schema")})(0,e,0,0)});function sx(e){return new sy({type:"symbol",...B(e)})}let sT=d("ZodUndefined",(e,t)=>{ie.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("Undefined cannot be represented in JSON Schema")})(0,e,0,0)});function sv(e){return new sT({type:"undefined",...B(e)})}let sA=d("ZodNull",(e,t)=>{it.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>{"openapi-3.0"===e.target?(t.type="string",t.nullable=!0,t.enum=[null]):t.type="null"}});function sS(e){return new sA({type:"null",...B(e)})}let sE=d("ZodAny",(e,t)=>{ii.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>{}});function sI(){return new sE({type:"any"})}let sR=d("ZodUnknown",(e,t)=>{ir.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>{}});function sP(){return new sR({type:"unknown"})}let sM=d("ZodNever",(e,t)=>{is.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>{t.not={}}});function sC(e){return new sM({type:"never",...B(e)})}let sO=d("ZodVoid",(e,t)=>{ia.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("Void cannot be represented in JSON Schema")})(0,e,0,0)});function sw(e){return new sO({type:"void",...B(e)})}let sD=d("ZodDate",(e,t)=>{io.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("Date cannot be represented in JSON Schema")})(0,e,0,0),e.min=(t,i)=>e.check(rT(t,i)),e.max=(t,i)=>e.check(ry(t,i));let i=e._zod.bag;e.minDate=i.minimum?new Date(i.minimum):null,e.maxDate=i.maximum?new Date(i.maximum):null});function sN(e){return new sD({type:"date",...B(e)})}let sL=d("ZodArray",(e,t)=>{iu.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>((e,t,i,r)=>{let n=e._zod.def,{minimum:s,maximum:a}=e._zod.bag;"number"==typeof s&&(i.minItems=s),"number"==typeof a&&(i.maxItems=a),i.type="array",i.items=rZ(n.element,t,{...r,path:[...r.path,"items"]})})(e,t,i,r),e.element=t.element,e.min=(t,i)=>e.check(rO(t,i)),e.nonempty=t=>e.check(rO(1,t)),e.max=(t,i)=>e.check(rC(t,i)),e.length=(t,i)=>e.check(rw(t,i)),e.unwrap=()=>e.element});function sF(e,t){return new sL({type:"array",element:e,...B(t)})}function sB(e){return s8(Object.keys(e._zod.def.shape))}let sk=d("ZodObject",(e,t)=>{i_.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>((e,t,i,r)=>{let n=e._zod.def;i.type="object",i.properties={};let s=n.shape;for(let e in s)i.properties[e]=rZ(s[e],t,{...r,path:[...r.path,"properties",e]});let a=new Set([...new Set(Object.keys(s))].filter(e=>{let i=n.shape[e]._zod;return"input"===t.io?void 0===i.optin:void 0===i.optout}));a.size>0&&(i.required=Array.from(a)),n.catchall?._zod.def.type==="never"?i.additionalProperties=!1:n.catchall?n.catchall&&(i.additionalProperties=rZ(n.catchall,t,{...r,path:[...r.path,"additionalProperties"]})):"output"===t.io&&(i.additionalProperties=!1)})(e,t,i,r),S(e,"shape",()=>t.shape),e.keyof=()=>s8(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:sP()}),e.loose=()=>e.clone({...e._zod.def,catchall:sP()}),e.strict=()=>e.clone({...e._zod.def,catchall:sC()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>(function(e,t){if(!O(t))throw Error("Invalid input to extend: expected a plain object");let i=e._zod.def.checks;if(i&&i.length>0){let i=e._zod.def.shape;for(let e in t)if(void 0!==Object.getOwnPropertyDescriptor(i,e))throw Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}let r=I(e._zod.def,{get shape(){let i={...e._zod.def.shape,...t};return E(this,"shape",i),i}});return F(e,r)})(e,t),e.safeExtend=t=>(function(e,t){if(!O(t))throw Error("Invalid input to safeExtend: expected a plain object");let i=I(e._zod.def,{get shape(){let i={...e._zod.def.shape,...t};return E(this,"shape",i),i}});return F(e,i)})(e,t),e.merge=t=>{let i;return i=I(e._zod.def,{get shape(){let i={...e._zod.def.shape,...t._zod.def.shape};return E(this,"shape",i),i},get catchall(){return t._zod.def.catchall},checks:[]}),F(e,i)},e.pick=t=>(function(e,t){let i=e._zod.def,r=i.checks;if(r&&r.length>0)throw Error(".pick() cannot be used on object schemas containing refinements");let n=I(e._zod.def,{get shape(){let e={};for(let r in t){if(!(r in i.shape))throw Error(`Unrecognized key: "${r}"`);t[r]&&(e[r]=i.shape[r])}return E(this,"shape",e),e},checks:[]});return F(e,n)})(e,t),e.omit=t=>(function(e,t){let i=e._zod.def,r=i.checks;if(r&&r.length>0)throw Error(".omit() cannot be used on object schemas containing refinements");let n=I(e._zod.def,{get shape(){let r={...e._zod.def.shape};for(let e in t){if(!(e in i.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&delete r[e]}return E(this,"shape",r),r},checks:[]});return F(e,n)})(e,t),e.partial=(...t)=>(function(e,t,i){let r=t._zod.def.checks;if(r&&r.length>0)throw Error(".partial() cannot be used on object schemas containing refinements");let n=I(t._zod.def,{get shape(){let r=t._zod.def.shape,n={...r};if(i)for(let t in i){if(!(t in r))throw Error(`Unrecognized key: "${t}"`);i[t]&&(n[t]=e?new e({type:"optional",innerType:r[t]}):r[t])}else for(let t in r)n[t]=e?new e({type:"optional",innerType:r[t]}):r[t];return E(this,"shape",n),n},checks:[]});return F(t,n)})(as,e,t[0]),e.required=(...t)=>{var i;let r;return i=t[0],r=I(e._zod.def,{get shape(){let t=e._zod.def.shape,r={...t};if(i)for(let e in i){if(!(e in r))throw Error(`Unrecognized key: "${e}"`);i[e]&&(r[e]=new am({type:"nonoptional",innerType:t[e]}))}else for(let e in t)r[e]=new am({type:"nonoptional",innerType:t[e]});return E(this,"shape",r),r}}),F(e,r)}});function sU(e,t){return new sk({type:"object",shape:e??{},...B(t)})}function sV(e,t){return new sk({type:"object",shape:e,catchall:sC(),...B(t)})}function sG(e,t){return new sk({type:"object",shape:e,catchall:sP(),...B(t)})}let sz=d("ZodUnion",(e,t)=>{ig.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>r0(e,t,i,r),e.options=t.options});function s$(e,t){return new sz({type:"union",options:e,...B(t)})}let sH=d("ZodXor",(e,t)=>{sz.init(e,t),iy.init(e,t),e._zod.processJSONSchema=(t,i,r)=>r0(e,t,i,r),e.options=t.options});function sW(e,t){return new sH({type:"union",options:e,inclusive:!1,...B(t)})}let sq=d("ZodDiscriminatedUnion",(e,t)=>{sz.init(e,t),ix.init(e,t)});function sj(e,t,i){return new sq({type:"union",options:t,discriminator:e,...B(i)})}let sX=d("ZodIntersection",(e,t)=>{iT.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>{let n,s,a,o;return s=rZ((n=e._zod.def).left,t,{...r,path:[...r.path,"allOf",0]}),a=rZ(n.right,t,{...r,path:[...r.path,"allOf",1]}),void(i.allOf=[...(o=e=>"allOf"in e&&1===Object.keys(e).length)(s)?s.allOf:[s],...o(a)?a.allOf:[a]])}});function sZ(e,t){return new sX({type:"intersection",left:e,right:t})}let sY=d("ZodTuple",(e,t)=>{iA.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>((e,t,i,r)=>{let n=e._zod.def;i.type="array";let s="draft-2020-12"===t.target?"prefixItems":"items",a="draft-2020-12"===t.target||"openapi-3.0"===t.target?"items":"additionalItems",o=n.items.map((e,i)=>rZ(e,t,{...r,path:[...r.path,s,i]})),l=n.rest?rZ(n.rest,t,{...r,path:[...r.path,a,..."openapi-3.0"===t.target?[n.items.length]:[]]}):null;"draft-2020-12"===t.target?(i.prefixItems=o,l&&(i.items=l)):"openapi-3.0"===t.target?(i.items={anyOf:o},l&&i.items.anyOf.push(l),i.minItems=o.length,l||(i.maxItems=o.length)):(i.items=o,l&&(i.additionalItems=l));let{minimum:u,maximum:h}=e._zod.bag;"number"==typeof u&&(i.minItems=u),"number"==typeof h&&(i.maxItems=h)})(e,t,i,r),e.rest=t=>e.clone({...e._zod.def,rest:t})});function sK(e,t,i){let r=t instanceof tM,n=r?i:t;return new sY({type:"tuple",items:e,rest:r?t:null,...B(n)})}let sQ=d("ZodRecord",(e,t)=>{iE.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>((e,t,i,r)=>{let n=e._zod.def;i.type="object";let s=n.keyType,a=s._zod.bag,o=a?.patterns;if("loose"===n.mode&&o&&o.size>0){let e=rZ(n.valueType,t,{...r,path:[...r.path,"patternProperties","*"]});for(let t of(i.patternProperties={},o))i.patternProperties[t.source]=e}else("draft-07"===t.target||"draft-2020-12"===t.target)&&(i.propertyNames=rZ(n.keyType,t,{...r,path:[...r.path,"propertyNames"]})),i.additionalProperties=rZ(n.valueType,t,{...r,path:[...r.path,"additionalProperties"]});let l=s._zod.values;if(l){let e=[...l].filter(e=>"string"==typeof e||"number"==typeof e);e.length>0&&(i.required=e)}})(e,t,i,r),e.keyType=t.keyType,e.valueType=t.valueType});function sJ(e,t,i){return new sQ({type:"record",keyType:e,valueType:t,...B(i)})}function s0(e,t,i){let r=F(e);return r._zod.values=void 0,new sQ({type:"record",keyType:r,valueType:t,...B(i)})}function s1(e,t,i){return new sQ({type:"record",keyType:e,valueType:t,mode:"loose",...B(i)})}let s2=d("ZodMap",(e,t)=>{iI.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("Map cannot be represented in JSON Schema")})(0,e,0,0),e.keyType=t.keyType,e.valueType=t.valueType,e.min=(...t)=>e.check(rP(...t)),e.nonempty=t=>e.check(rP(1,t)),e.max=(...t)=>e.check(rR(...t)),e.size=(...t)=>e.check(rM(...t))});function s3(e,t,i){return new s2({type:"map",keyType:e,valueType:t,...B(i)})}let s4=d("ZodSet",(e,t)=>{iP.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("Set cannot be represented in JSON Schema")})(0,e,0,0),e.min=(...t)=>e.check(rP(...t)),e.nonempty=t=>e.check(rP(1,t)),e.max=(...t)=>e.check(rR(...t)),e.size=(...t)=>e.check(rM(...t))});function s5(e,t){return new s4({type:"set",valueType:e,...B(t)})}let s6=d("ZodEnum",(e,t)=>{iC.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>{let n;(n=g(e._zod.def.entries)).every(e=>"number"==typeof e)&&(i.type="number"),n.every(e=>"string"==typeof e)&&(i.type="string"),i.enum=n},e.enum=t.entries,e.options=Object.values(t.entries);let i=new Set(Object.keys(t.entries));e.extract=(e,r)=>{let n={};for(let r of e)if(i.has(r))n[r]=t.entries[r];else throw Error(`Key ${r} not found in enum`);return new s6({...t,checks:[],...B(r),entries:n})},e.exclude=(e,r)=>{let n={...t.entries};for(let t of e)if(i.has(t))delete n[t];else throw Error(`Key ${t} not found in enum`);return new s6({...t,checks:[],...B(r),entries:n})}});function s8(e,t){return new s6({type:"enum",entries:Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e,...B(t)})}function s9(e,t){return new s6({type:"enum",entries:e,...B(t)})}let s7=d("ZodLiteral",(e,t)=>{iO.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>((e,t,i,r)=>{let n=e._zod.def,s=[];for(let e of n.values)if(void 0===e){if("throw"===t.unrepresentable)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof e)if("throw"===t.unrepresentable)throw Error("BigInt literals cannot be represented in JSON Schema");else s.push(Number(e));else s.push(e);if(0===s.length);else if(1===s.length){let e=s[0];i.type=null===e?"null":typeof e,"draft-04"===t.target||"openapi-3.0"===t.target?i.enum=[e]:i.const=e}else s.every(e=>"number"==typeof e)&&(i.type="number"),s.every(e=>"string"==typeof e)&&(i.type="string"),s.every(e=>"boolean"==typeof e)&&(i.type="boolean"),s.every(e=>null===e)&&(i.type="null"),i.enum=s})(e,t,i,0),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function ae(e,t){return new s7({type:"literal",values:Array.isArray(e)?e:[e],...B(t)})}let at=d("ZodFile",(e,t)=>{iw.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>((e,t,i,r)=>{let n={type:"string",format:"binary",contentEncoding:"binary"},{minimum:s,maximum:a,mime:o}=e._zod.bag;void 0!==s&&(n.minLength=s),void 0!==a&&(n.maxLength=a),o?1===o.length?(n.contentMediaType=o[0],Object.assign(i,n)):(Object.assign(i,n),i.anyOf=o.map(e=>({contentMediaType:e}))):Object.assign(i,n)})(e,0,i,0),e.min=(t,i)=>e.check(rP(t,i)),e.max=(t,i)=>e.check(rR(t,i)),e.mime=(t,i)=>e.check(rV(Array.isArray(t)?t:[t],i))});function ai(e){return new at({type:"file",...B(e)})}let ar=d("ZodTransform",(e,t)=>{iD.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema")})(0,e,0,0),e._zod.parse=(i,r)=>{if("backward"===r.direction)throw new f(e.constructor.name);i.addIssue=r=>{"string"==typeof r?i.issues.push(j(r,i.value,t)):(r.fatal&&(r.continue=!1),r.code??(r.code="custom"),r.input??(r.input=i.value),r.inst??(r.inst=e),i.issues.push(j(r)))};let n=t.transform(i.value,i);return n instanceof Promise?n.then(e=>(i.value=e,i)):(i.value=n,i)}});function an(e){return new ar({type:"transform",transform:e})}let as=d("ZodOptional",(e,t)=>{iL.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>r1(e,t,i,r),e.unwrap=()=>e._zod.def.innerType});function aa(e){return new as({type:"optional",innerType:e})}let ao=d("ZodExactOptional",(e,t)=>{iF.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>r1(e,t,i,r),e.unwrap=()=>e._zod.def.innerType});function al(e){return new ao({type:"optional",innerType:e})}let au=d("ZodNullable",(e,t)=>{iB.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>{let n,s,a;return s=rZ((n=e._zod.def).innerType,t,r),a=t.seen.get(e),void("openapi-3.0"===t.target?(a.ref=n.innerType,i.nullable=!0):i.anyOf=[s,{type:"null"}])},e.unwrap=()=>e._zod.def.innerType});function ah(e){return new au({type:"nullable",innerType:e})}function ac(e){return aa(ah(e))}let ad=d("ZodDefault",(e,t)=>{ik.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>{let n;rZ((n=e._zod.def).innerType,t,r),t.seen.get(e).ref=n.innerType,i.default=JSON.parse(JSON.stringify(n.defaultValue))},e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function ap(e,t){return new ad({type:"default",innerType:e,get defaultValue(){return"function"==typeof t?t():w(t)}})}let af=d("ZodPrefault",(e,t)=>{iV.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>{let n;rZ((n=e._zod.def).innerType,t,r),t.seen.get(e).ref=n.innerType,"input"===t.io&&(i._prefault=JSON.parse(JSON.stringify(n.defaultValue)))},e.unwrap=()=>e._zod.def.innerType});function a_(e,t){return new af({type:"prefault",innerType:e,get defaultValue(){return"function"==typeof t?t():w(t)}})}let am=d("ZodNonOptional",(e,t)=>{iG.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>{let n;rZ((n=e._zod.def).innerType,t,r),t.seen.get(e).ref=n.innerType},e.unwrap=()=>e._zod.def.innerType});function ag(e,t){return new am({type:"nonoptional",innerType:e,...B(t)})}let ab=d("ZodSuccess",(e,t)=>{i$.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>{t.type="boolean"},e.unwrap=()=>e._zod.def.innerType});function ay(e){return new ab({type:"success",innerType:e})}let ax=d("ZodCatch",(e,t)=>{iH.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>((e,t,i,r)=>{let n,s=e._zod.def;rZ(s.innerType,t,r),t.seen.get(e).ref=s.innerType;try{n=s.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}i.default=n})(e,t,i,r),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function aT(e,t){return new ax({type:"catch",innerType:e,catchValue:"function"==typeof t?t:()=>t})}let av=d("ZodNaN",(e,t)=>{iW.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("NaN cannot be represented in JSON Schema")})(0,e,0,0)});function aA(e){return new av({type:"nan",...B(e)})}let aS=d("ZodPipe",(e,t)=>{iq.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>{let n,s;return n=e._zod.def,void(rZ(s="input"===t.io?"transform"===n.in._zod.def.type?n.out:n.in:n.out,t,r),t.seen.get(e).ref=s)},e.in=t.in,e.out=t.out});function aE(e,t){return new aS({type:"pipe",in:e,out:t})}let aI=d("ZodCodec",(e,t)=>{aS.init(e,t),iX.init(e,t)});function aR(e,t,i){return new aI({type:"pipe",in:e,out:t,transform:i.decode,reverseTransform:i.encode})}let aP=d("ZodReadonly",(e,t)=>{iK.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>{let n;rZ((n=e._zod.def).innerType,t,r),t.seen.get(e).ref=n.innerType,i.readOnly=!0},e.unwrap=()=>e._zod.def.innerType});function aM(e){return new aP({type:"readonly",innerType:e})}let aC=d("ZodTemplateLiteral",(e,t)=>{iJ.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>((e,t,i,r)=>{let n=e._zod.pattern;if(!n)throw Error("Pattern not found in template literal");i.type="string",i.pattern=n.source})(e,0,i,0)});function aO(e,t){return new aC({type:"template_literal",parts:e,...B(t)})}let aw=d("ZodLazy",(e,t)=>{i2.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>{let n;rZ(n=e._zod.innerType,t,r),t.seen.get(e).ref=n},e.unwrap=()=>e._zod.def.getter()});function aD(e){return new aw({type:"lazy",getter:e})}let aN=d("ZodPromise",(e,t)=>{i1.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(t,i,r)=>{let n;rZ((n=e._zod.def).innerType,t,r),t.seen.get(e).ref=n.innerType},e.unwrap=()=>e._zod.def.innerType});function aL(e){return new aN({type:"promise",innerType:e})}let aF=d("ZodFunction",(e,t)=>{i0.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("Function types cannot be represented in JSON Schema")})(0,e,0,0)});function aB(e){return new aF({type:"function",input:Array.isArray(e?.input)?sK(e?.input):e?.input??sF(sP()),output:e?.output??sP()})}let ak=d("ZodCustom",(e,t)=>{i3.init(e,t),nf.init(e,t),e._zod.processJSONSchema=(e,t,i)=>((e,t,i,r)=>{if("throw"===t.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema")})(0,e,0,0)});function aU(e){let t=new tr({check:"custom"});return t._zod.check=e,t}function aV(e,t){var i;let r;return i=e??(()=>!0),(r=B(t)).abort??(r.abort=!0),new ak({type:"custom",check:"custom",fn:i,...r})}function aG(e,t={}){return new ak({type:"custom",check:"custom",fn:e,...B(t)})}function az(e){var t;let i,r;return t=t=>(t.addIssue=e=>{"string"==typeof e?t.issues.push(j(e,t.value,i._zod.def)):(e.fatal&&(e.continue=!1),e.code??(e.code="custom"),e.input??(e.input=t.value),e.inst??(e.inst=i),e.continue??(e.continue=!i._zod.def.abort),t.issues.push(j(e)))},e(t.value,t)),(r=new tr({check:"custom",...B(void 0)}))._zod.check=t,i=r}let a$=function(e){let t=new tr({check:"describe"});return t._zod.onattach=[t=>{let i=i5.get(t)??{};i5.add(t,{...i,description:e})}],t._zod.check=()=>{},t},aH=function(e){let t=new tr({check:"meta"});return t._zod.onattach=[t=>{let i=i5.get(t)??{};i5.add(t,{...i,...e})}],t._zod.check=()=>{},t};function aW(e,t={}){let i=new ak({type:"custom",check:"custom",fn:t=>t instanceof e,abort:!0,...B(t)});return i._zod.bag.Class=e,i._zod.check=t=>{t.value instanceof e||t.issues.push({code:"invalid_type",expected:e.name,input:t.value,inst:i,path:[...i._zod.def.path??[]]})},i}let aq=(...e)=>(function(e,t){let i=B(t),r=i.truthy??["true","1","yes","on","y","enabled"],n=i.falsy??["false","0","no","off","n","disabled"];"sensitive"!==i.case&&(r=r.map(e=>"string"==typeof e?e.toLowerCase():e),n=n.map(e=>"string"==typeof e?e.toLowerCase():e));let s=new Set(r),a=new Set(n),o=e.Codec??iX,l=e.Boolean??t6,u=new o({type:"pipe",in:new(e.String??tC)({type:"string",error:i.error}),out:new l({type:"boolean",error:i.error}),transform:(e,t)=>{let r=e;return"sensitive"!==i.case&&(r=r.toLowerCase()),!!s.has(r)||!a.has(r)&&(t.issues.push({code:"invalid_value",expected:"stringbool",values:[...s,...a],input:t.value,inst:u,continue:!1}),{})},reverseTransform:(e,t)=>!0===e?r[0]||"true":n[0]||"false",error:i.error});return u})({Codec:aI,Boolean:sd,String:nm},...e);function aj(e){let t=aD(()=>s$([ng(e),ss(),sp(),sS(),sF(t),sJ(ng(),t)]));return t}function aX(e,t){return aE(an(e),t)}o||(o={}),m({localeError:(r={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"},map:{unit:"entries",verb:"to have"}},n={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},s={nan:"NaN"},e=>{switch(e.code){case"invalid_type":{let t=s[e.expected]??e.expected,i=function(e){let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"nan":"number";case"object":if(null===e)return"null";if(Array.isArray(e))return"array";if(e&&Object.getPrototypeOf(e)!==Object.prototype&&"constructor"in e&&e.constructor)return e.constructor.name}return t}(e.input),r=s[i]??i;return`Invalid input: expected ${t}, received ${r}`}case"invalid_value":if(1===e.values.length)return`Invalid input: expected ${k(e.values[0])}`;return`Invalid option: expected one of ${b(e.values,"|")}`;case"too_big":{let t=e.inclusive?"<=":"<",i=r[e.origin]??null;if(i)return`Too big: expected ${e.origin??"value"} to have ${t}${e.maximum.toString()} ${i.unit??"elements"}`;return`Too big: expected ${e.origin??"value"} to be ${t}${e.maximum.toString()}`}case"too_small":{let t=e.inclusive?">=":">",i=r[e.origin]??null;if(i)return`Too small: expected ${e.origin} to have ${t}${e.minimum.toString()} ${i.unit}`;return`Too small: expected ${e.origin} to be ${t}${e.minimum.toString()}`}case"invalid_format":if("starts_with"===e.format)return`Invalid string: must start with "${e.prefix}"`;if("ends_with"===e.format)return`Invalid string: must end with "${e.suffix}"`;if("includes"===e.format)return`Invalid string: must include "${e.includes}"`;if("regex"===e.format)return`Invalid string: must match pattern ${e.pattern}`;return`Invalid ${n[e.format]??e.format}`;case"not_multiple_of":return`Invalid number: must be a multiple of ${e.divisor}`;case"unrecognized_keys":return`Unrecognized key${e.keys.length>1?"s":""}: ${b(e.keys,", ")}`;case"invalid_key":return`Invalid key in ${e.origin}`;case"invalid_union":default:return"Invalid input";case"invalid_element":return`Invalid value in ${e.origin}`}})})}}]);