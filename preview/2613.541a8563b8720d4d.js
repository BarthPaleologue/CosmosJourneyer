/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["2613"],{14620:function(e,t,n){e.exports=n.p+"e11ee3cdd6bf505e.webp"},74452:function(e,t,n){e.exports=n.p+"ceb0939a515e507b.webp"},41077:function(e,t,n){e.exports=n.p+"a818b763cab42c30.webp"},23684:function(e,t,n){e.exports=n.p+"2470ffe0b50b2171.webp"},14597:function(e,t,n){e.exports=n.p+"fd7997898bbeb1f1.wasm"},9098:function(e,t,n){e.exports=n.p+"869739fc3ede15e2.js"},95901:function(e,t,n){n.d(t,{QU:()=>f});var r=n(50513),i=n(32220),a=n(13679),s=(0,i.p)(a.w.POWER_PLAY_SEED),o=0,u=(0,r.makeNoise3D)(function(){return s(o++)}),l=(0,i.p)(a.w.POWER_PLAY_SEED+598),c=0,h=(0,r.makeNoise3D)(function(){return l(c++)});function f(e){var t,n;return{materialistSpiritualist:(t=e.x,.5*u(.2*t,.2*e.y,.2*e.z)+.5),capitalistCommunist:(n=e.x,.5*h(.2*n,.2*e.y,.2*e.z)+.5)}}},76448:function(e,t,n){function r(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{bk:()=>y,Wo:()=>v,Lr:()=>p});var o,u=function(){function e(t,n,i,a){r(this,e),s(this,"sound",void 0),s(this,"targetVolume",void 0),s(this,"volumeMultiplier",void 0),s(this,"playbackSpeedMultiplier",void 0),s(this,"maskFactor",1),s(this,"mask",void 0);var o=t.clone();if(null===o)throw Error("Cloned sound was null!");this.sound=o,this.mask=n,this.targetVolume=i,this.volumeMultiplier=t.getVolume(),this.playbackSpeedMultiplier=t.getPlaybackRate(),this.sound.updateOptions({playbackRate:this.playbackSpeedMultiplier,volume:this.targetVolume*this.volumeMultiplier*this.maskFactor,loop:!a})}return a(e,[{key:"play",value:function(){this.sound.play()}},{key:"setVolume",value:function(e){this.targetVolume=e,this.sound.setVolume(this.targetVolume*this.volumeMultiplier*this.maskFactor,.5)}},{key:"setMaskFactor",value:function(e){this.maskFactor=e,this.sound.setVolume(this.targetVolume*this.volumeMultiplier*this.maskFactor,.5)}},{key:"getMask",value:function(){return this.mask}},{key:"dispose",value:function(){this.sound.dispose()}}]),e}(),l=function(){function e(){r(this,e)}return a(e,[{key:"play",value:function(){}},{key:"setVolume",value:function(){}},{key:"setMaskFactor",value:function(){}},{key:"getMask",value:function(){return 0}},{key:"dispose",value:function(){}}]),e}();function c(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=((o={})[o.CLICK=0]="CLICK",o[o.HOVER=1]="HOVER",o[o.SUCCESS=2]="SUCCESS",o[o.ERROR=3]="ERROR",o[o.WARNING=4]="WARNING",o[o.INFO=5]="INFO",o[o.ENABLE_ORBIT_DISPLAY=6]="ENABLE_ORBIT_DISPLAY",o[o.DISABLE_ORBIT_DISPLAY=7]="DISABLE_ORBIT_DISPLAY",o[o.TARGET_LOCK=8]="TARGET_LOCK",o[o.TARGET_UNLOCK=9]="TARGET_UNLOCK",o[o.ITINERARY_COMPUTED=10]="ITINERARY_COMPUTED",o[o.OPEN_PAUSE_MENU=11]="OPEN_PAUSE_MENU",o[o.ENABLE_WARP_DRIVE=12]="ENABLE_WARP_DRIVE",o[o.DISABLE_WARP_DRIVE=13]="DISABLE_WARP_DRIVE",o[o.ACCELERATING_WARP_DRIVE=14]="ACCELERATING_WARP_DRIVE",o[o.DECELERATING_WARP_DRIVE=15]="DECELERATING_WARP_DRIVE",o[o.HYPER_SPACE=16]="HYPER_SPACE",o[o.THRUSTER=17]="THRUSTER",o),p=function(){function e(t){c(this,e),d(this,"sounds",void 0),d(this,"isPlaying",!1),d(this,"soundQueue",[]),d(this,"soundInstances",new Set),d(this,"soundInstanceMask",15),this.sounds=t}return f(e,[{key:"getSoundFromType",value:function(e){switch(e){case 0:case 4:case 5:return this.sounds.menuSelect;case 2:return this.sounds.success;case 3:return this.sounds.error;case 1:case 6:case 7:return this.sounds.menuHover;case 8:return this.sounds.targetLock;case 9:case 10:return this.sounds.targetUnlock;case 11:return this.sounds.openPauseMenu;case 12:return this.sounds.enableWarpDrive;case 13:return this.sounds.disableWarpDrive;case 14:return this.sounds.acceleratingWarpDrive;case 15:return this.sounds.deceleratingWarpDrive;case 16:return this.sounds.hyperSpace;case 17:return this.sounds.thruster}}},{key:"playNow",value:function(e){this.getSoundFromType(e).play()}},{key:"enqueuePlay",value:function(e){this.soundQueue.push(this.getSoundFromType(e))}},{key:"createInstance",value:function(e,t,n,r){var i=new u(this.getSoundFromType(e),t,n,r);return this.soundInstances.add(i),i.setMaskFactor(+((t&this.soundInstanceMask)!=0)),i}},{key:"freeInstance",value:function(e){this.soundInstances.delete(e),e.dispose()}},{key:"setInstanceMask",value:function(e){this.soundInstanceMask=e}},{key:"update",value:function(){var e=this,t=!0,n=!1,r=void 0;try{for(var i,a=this.soundInstances[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value,o=(s.getMask()&this.soundInstanceMask)!=0;s.setMaskFactor(+!!o)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}if(!this.isPlaying){var u=this.soundQueue.shift();void 0!==u&&(this.isPlaying=!0,u.play(),u.onEndedObservable.addOnce(function(){e.isPlaying=!1}))}}}]),e}(),y=function(){function e(){c(this,e)}return f(e,[{key:"playNow",value:function(){}},{key:"enqueuePlay",value:function(){}},{key:"createInstance",value:function(){return new l}},{key:"freeInstance",value:function(){}},{key:"setInstanceMask",value:function(){}},{key:"update",value:function(){}}]),e}()},13997:function(e,t,n){n.d(t,{_l:()=>u,bm:()=>o,yT:()=>s});function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i,a,s=((i={})[i.CHARLOTTE=0]="CHARLOTTE",i),o=((a={})[a.INITIATING_PLANETARY_LANDING=0]="INITIATING_PLANETARY_LANDING",a[a.LANDING_REQUEST_GRANTED=1]="LANDING_REQUEST_GRANTED",a[a.LANDING_COMPLETE=2]="LANDING_COMPLETE",a[a.MISSION_COMPLETE=3]="MISSION_COMPLETE",a[a.NEW_DISCOVERY=4]="NEW_DISCOVERY",a[a.CANNOT_ENGAGE_WARP_DRIVE=5]="CANNOT_ENGAGE_WARP_DRIVE",a[a.WARP_DRIVE_EMERGENCY_SHUT_DOWN=6]="WARP_DRIVE_EMERGENCY_SHUT_DOWN",a[a.WARP_DRIVE_DISENGAGED=7]="WARP_DRIVE_DISENGAGED",a[a.ENGAGING_WARP_DRIVE=8]="ENGAGING_WARP_DRIVE",a[a.FUEL_SCOOPING=9]="FUEL_SCOOPING",a[a.FUEL_SCOOPING_COMPLETE=10]="FUEL_SCOOPING_COMPLETE",a),u=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");r(this,"voiceLines",void 0),r(this,"isPlaying",!1),r(this,"soundQueue",new Set),this.voiceLines=e}return e=[{key:"getLineFromVoiceLines",value:function(e,t){switch(t){case 0:return e.initiatingPlanetaryLanding;case 1:return e.landingRequestGranted;case 2:return e.landingComplete;case 3:return e.missionComplete;case 4:return e.newDiscovery;case 5:return e.cannotEngageWarpDrive;case 6:return e.warpDriveEmergencyShutDown;case 7:return e.warpDriveDisengaged;case 8:return e.engagingWarpDrive;case 9:return e.fuelScooping;case 10:return e.fuelScoopingComplete}}},{key:"getVoiceLinesFromSpeaker",value:function(e){if(0===e)return this.voiceLines.charlotte}},{key:"sayNow",value:function(e,t){this.getLineFromVoiceLines(this.getVoiceLinesFromSpeaker(e),t).play()}},{key:"enqueueSay",value:function(e,t){this.soundQueue.add(this.getLineFromVoiceLines(this.getVoiceLinesFromSpeaker(e),t))}},{key:"update",value:function(){var e=this;if(!this.isPlaying){var t=this.soundQueue.values().next().value;void 0!==t&&(this.soundQueue.delete(t),this.isPlaying=!0,t.play(),t.onEndedObservable.addOnce(function(){e.isPlaying=!1}))}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},39536:function(e,t,n){n.d(t,{K:()=>tx}),n(68184),n(22470),n(60472);var r,i=n(56182),a=n(78574),s=n(87614),o=n(36801),u=n(28468),l=n(36378),c=n(99060),h=n(4924),f=n(70612),d=n(85303),v=n(89286),p=n(4885);function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function m(e){function t(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(m=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new m(e)}function b(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function g(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){b(a,r,i,s,o,"next",e)}function o(e){b(a,r,i,s,o,"throw",e)}s(void 0)})}}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function E(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var P=function(){var e,t;function n(e){var t,r;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");r=void 0,(t="rootHandle")in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[t]=r,this.rootHandle=e}return e=[{key:"getDirectoryHandle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return g(function(){var n,r,i,a,s,o,u,l,c,h;return E(this,function(f){switch(f.label){case 0:f.trys.push([0,9,,10]),n=e.split("/").filter(Boolean),r=this.rootHandle,i=!0,a=!1,s=void 0,f.label=1;case 1:f.trys.push([1,6,7,8]),o=n[Symbol.iterator](),f.label=2;case 2:if(i=(u=o.next()).done)return[3,5];return l=u.value,[4,r.getDirectoryHandle(l,{create:t})];case 3:r=f.sent(),f.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return c=f.sent(),a=!0,s=c,[3,8];case 7:try{i||null==o.return||o.return()}finally{if(a)throw s}return[7];case 8:return[2,r];case 9:if(w(h=f.sent(),DOMException)&&"NotFoundError"===h.name)return[2,null];throw h;case 10:return[2]}})}).call(this)}},{key:"getFileHandle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return g(function(){var n,r,i,a;return E(this,function(s){switch(s.label){case 0:if(s.trys.push([0,3,,4]),void 0===(r=(n=e.split("/").filter(Boolean)).pop()))throw Error("Invalid file path");return[4,this.getDirectoryHandle("/"+n.join("/"),t)];case 1:if(!(i=s.sent()))return[2,null];return[4,i.getFileHandle(r,{create:t})];case 2:return[2,s.sent()];case 3:if(w(a=s.sent(),DOMException)&&"NotFoundError"===a.name)return[2,null];throw a;case 4:return[2]}})}).call(this)}},{key:"createDirectory",value:function(e){return g(function(){var t;return E(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.getDirectoryHandle(e,!0)];case 1:return n.sent(),[2,!0];case 2:return t=n.sent(),console.error("Failed to create directory: ".concat(e),t),[2,!1];case 3:return[2]}})}).call(this)}},{key:"deleteDirectory",value:function(e){return g(function(){var t,n,r,i;return E(this,function(a){switch(a.label){case 0:if(a.trys.push([0,3,,4]),void 0===(n=(t=e.split("/").filter(Boolean)).pop()))return[2,!1];return[4,this.getDirectoryHandle("/"+t.join("/"))];case 1:if(!(r=a.sent()))return[2,!1];return[4,r.removeEntry(n,{recursive:!0})];case 2:return a.sent(),[2,!0];case 3:return i=a.sent(),console.error("Failed to delete directory: ".concat(e),i),[2,!1];case 4:return[2]}})}).call(this)}},{key:"listDirectory",value:function(e){return g(function(){var t,n,r,i,a,s,o,u,l,c;return E(this,function(h){switch(h.label){case 0:return h.trys.push([0,14,,15]),[4,this.getDirectoryHandle(e)];case 1:if(!(t=h.sent()))return[2,null];n=[],r=!1,i=!1,h.label=2;case 2:h.trys.push([2,7,8,13]),s=function(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new m(t.call(e));n="@@asyncIterator",r="@@iterator"}throw TypeError("Object is not async iterable")}(t.entries()),h.label=3;case 3:return[4,s.next()];case 4:var f;if(!(r=!(o=h.sent()).done))return[3,6];u=(function(e){if(Array.isArray(e))return e}(f=o.value)||function(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a=[],s=!0,o=!1;try{for(i=i.call(e);!(s=(n=i.next()).done)&&(a.push(n.value),a.length!==t);s=!0);}catch(e){o=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(o)throw r}}return a}}(f,1)||function(e,t){if(e){if("string"==typeof e)return y(e,1);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}}(f,1)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],n.push(u),h.label=5;case 5:return r=!1,[3,3];case 6:return[3,13];case 7:return l=h.sent(),i=!0,a=l,[3,13];case 8:if(h.trys.push([8,,11,12]),!(r&&null!=s.return))return[3,10];return[4,s.return()];case 9:h.sent(),h.label=10;case 10:return[3,12];case 11:if(i)throw a;return[7];case 12:return[7];case 13:return[2,n.sort()];case 14:return c=h.sent(),console.error("Failed to list directory: ".concat(e),c),[2,null];case 15:return[2]}})}).call(this)}},{key:"directoryExists",value:function(e){return g(function(){return E(this,function(t){switch(t.label){case 0:return[4,this.getDirectoryHandle(e)];case 1:return[2,null!==t.sent()]}})}).call(this)}},{key:"writeFile",value:function(e,t){return g(function(){var n,r,i;return E(this,function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),[4,this.getFileHandle(e,!0)];case 1:if(!(n=a.sent()))return[2,!1];return[4,n.createWritable()];case 2:return[4,(r=a.sent()).write(t)];case 3:return a.sent(),[4,r.close()];case 4:return a.sent(),[2,!0];case 5:return i=a.sent(),console.error("Failed to write file: ".concat(e),i),[2,!1];case 6:return[2]}})}).call(this)}},{key:"readFile",value:function(e){return g(function(){var t,n;return E(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,this.getFileHandle(e)];case 1:if(!(t=r.sent()))return[2,null];return[4,t.getFile()];case 2:return[4,r.sent().text()];case 3:return[2,r.sent()];case 4:return n=r.sent(),console.error("Failed to read file: ".concat(e),n),[2,null];case 5:return[2]}})}).call(this)}},{key:"deleteFile",value:function(e){return g(function(){var t,n,r,i;return E(this,function(a){switch(a.label){case 0:if(a.trys.push([0,3,,4]),void 0===(n=(t=e.split("/").filter(Boolean)).pop()))return[2,!1];return[4,this.getDirectoryHandle("/"+t.join("/"))];case 1:if(!(r=a.sent()))return[2,!1];return[4,r.removeEntry(n)];case 2:return a.sent(),[2,!0];case 3:return i=a.sent(),console.error("Failed to delete file: ".concat(e),i),[2,!1];case 4:return[2]}})}).call(this)}},{key:"fileExists",value:function(e){return g(function(){return E(this,function(t){switch(t.label){case 0:return[4,this.getFileHandle(e)];case 1:return[2,null!==t.sent()]}})}).call(this)}}],t=[{key:"CreateAsync",value:function(){return g(function(){var e,t;return E(this,function(r){switch(r.label){case 0:if(!n.IsSupported())return[2,(0,d._q)(Error("OPFS is not supported in this browser"))];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,navigator.storage.getDirectory()];case 2:return e=r.sent(),[2,(0,d.ok)(new n(e))];case 3:return console.error("Failed to create OPFSFileSystem:",t=r.sent()),[2,(0,d._q)(t)];case 4:return[2]}})})()}},{key:"IsSupported",value:function(){return"storage"in navigator&&"getDirectory"in navigator.storage}}],e&&S(n.prototype,e),t&&S(n,t),n}(),A=n(44710),T=n(13679),k=n(26620),C=n(26070);function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function O(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function M(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){O(a,r,i,s,o,"next",e)}function o(e){O(a,r,i,s,o,"throw",e)}s(void 0)})}}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}}function D(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var x=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");L(this,"fileSystem",void 0),L(this,"starSystemDatabase",void 0),L(this,"corruptedSaves",[]),this.fileSystem=e,this.starSystemDatabase=t}return e=[{key:"getCorruptedSaves",value:function(){var e;return function(e){if(Array.isArray(e))return I(e)}(e=this.corruptedSaves)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||V(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},{key:"loadSaveFile",value:function(e){return M(function(){var t,n,r,i,a;return D(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,5]),[4,this.fileSystem.readFile(e)];case 1:if(null===(t=s.sent()))return[2,null];if(!(n=(0,A.z)(t)))throw Error("Invalid JSON");if(!(r=(0,k.c_)(n,this.starSystemDatabase)).success)throw Error("Save validation failed: ".concat((0,C.k)(r.error)));return[2,r.value];case 2:return i=s.sent(),[4,this.fileSystem.readFile(e)];case 3:return a=s.sent(),this.corruptedSaves.push({filePath:e,error:i,rawContent:null!=a?a:""}),console.error("Corrupted save file: ".concat(e),i),[4,this.quarantineCorruptedSave(e)];case 4:return s.sent(),[2,null];case 5:return[2]}})}).call(this)}},{key:"quarantineCorruptedSave",value:function(e){return M(function(){var t,n,r,i;return D(this,function(a){switch(a.label){case 0:return a.trys.push([0,6,,7]),[4,this.fileSystem.readFile(e)];case 1:if(null===(t=a.sent()))return[3,4];return r=(n=e.replace("/saves/","/corrupted/")).substring(0,n.lastIndexOf("/")),[4,this.fileSystem.createDirectory(r)];case 2:return a.sent(),[4,this.fileSystem.writeFile(n,t)];case 3:a.sent(),a.label=4;case 4:return[4,this.fileSystem.deleteFile(e)];case 5:return a.sent(),[3,7];case 6:return i=a.sent(),console.error("Failed to quarantine corrupted save: ".concat(e),i),[3,7];case 7:return[2]}})}).call(this)}},{key:"getSavesForCmdr",value:function(e){return M(function(){var t,r,i,a,s,o,u,l,c,h,f,d,v,p,y,m,b,g,S,w,E,P;return D(this,function(A){switch(A.label){case 0:return t="".concat(n.SAVES_DIR,"/").concat(e),[4,this.fileSystem.directoryExists(t)];case 1:if(!A.sent())return[2,void 0];return r=[],i=[],a="".concat(t,"/manual"),[4,this.fileSystem.listDirectory(a)];case 2:if(null===(s=A.sent()))return[3,10];o=!0,u=!1,l=void 0,A.label=3;case 3:A.trys.push([3,8,9,10]),c=s[Symbol.iterator](),A.label=4;case 4:if(o=(h=c.next()).done)return[3,7];return f=h.value,[4,this.loadSaveFile("".concat(a,"/").concat(f))];case 5:if(null===(d=A.sent()))return[3,6];r.push(d),A.label=6;case 6:return o=!0,[3,4];case 7:return[3,10];case 8:return v=A.sent(),u=!0,l=v,[3,10];case 9:try{o||null==c.return||c.return()}finally{if(u)throw l}return[7];case 10:return p="".concat(t,"/auto"),[4,this.fileSystem.listDirectory(p)];case 11:if(null===(y=A.sent()))return[3,19];m=!0,b=!1,g=void 0,A.label=12;case 12:A.trys.push([12,17,18,19]),S=y[Symbol.iterator](),A.label=13;case 13:if(m=(w=S.next()).done)return[3,16];return E=w.value,[4,this.loadSaveFile("".concat(p,"/").concat(E))];case 14:if(null===(P=A.sent()))return[3,15];i.push(P),A.label=15;case 15:return m=!0,[3,13];case 16:return[3,19];case 17:return v=A.sent(),b=!0,g=v,[3,19];case 18:try{m||null==S.return||S.return()}finally{if(b)throw g}return[7];case 19:return r.sort(function(e,t){return t.timestamp-e.timestamp}),i.sort(function(e,t){return t.timestamp-e.timestamp}),[2,{manual:r,auto:i}]}})}).call(this)}},{key:"deleteSaveForCmdr",value:function(e,t){return M(function(){var r,i,a;return D(this,function(s){switch(s.label){case 0:return r="".concat(n.SAVES_DIR,"/").concat(e),i="".concat(r,"/manual/").concat(t,".json"),[4,this.fileSystem.fileExists(i)];case 1:if(!s.sent())return[3,3];return[4,this.fileSystem.deleteFile(i)];case 2:case 5:return[2,s.sent()];case 3:return a="".concat(r,"/auto/").concat(t,".json"),[4,this.fileSystem.fileExists(a)];case 4:if(!s.sent())return[3,6];return[4,this.fileSystem.deleteFile(a)];case 6:return[2,!1]}})}).call(this)}},{key:"deleteCmdr",value:function(e){return M(function(){var t;return D(this,function(r){switch(r.label){case 0:return t="".concat(n.SAVES_DIR,"/").concat(e),[4,this.fileSystem.deleteDirectory(t)];case 1:return[2,r.sent()]}})}).call(this)}},{key:"getCmdrUuids",value:function(){return M(function(){var e,t;return D(this,function(r){switch(r.label){case 0:return e=n.SAVES_DIR,[4,this.fileSystem.directoryExists(e)];case 1:if(!r.sent())return[2,[]];return[4,this.fileSystem.listDirectory(e)];case 2:return[2,null!=(t=r.sent())?t:[]]}})}).call(this)}},{key:"addManualSave",value:function(e,t){return M(function(){var r,i,a;return D(this,function(s){switch(s.label){case 0:return r="".concat(n.SAVES_DIR,"/").concat(e),i="".concat(r,"/manual"),[4,this.fileSystem.createDirectory(r)];case 1:return s.sent(),[4,this.fileSystem.createDirectory(i)];case 2:return s.sent(),a="".concat(i,"/").concat(t.uuid,".json"),[4,this.fileSystem.fileExists(a)];case 3:if(s.sent())return[2,!1];return[4,this.fileSystem.writeFile(a,JSON.stringify(t))];case 4:return[2,s.sent()]}})}).call(this)}},{key:"addAutoSave",value:function(e,t){return M(function(){var r,i,a;return D(this,function(s){switch(s.label){case 0:return r="".concat(n.SAVES_DIR,"/").concat(e),i="".concat(r,"/auto"),[4,this.fileSystem.createDirectory(r)];case 1:return s.sent(),[4,this.fileSystem.createDirectory(i)];case 2:return s.sent(),a="".concat(i,"/").concat(t.uuid,".json"),[4,this.fileSystem.fileExists(a)];case 3:if(s.sent())return[2,!1];return[4,this.fileSystem.writeFile(a,JSON.stringify(t))];case 4:if(!s.sent())return[2,!1];return[4,this.cleanupAutoSaves(e)];case 5:return s.sent(),[2,!0]}})}).call(this)}},{key:"cleanupAutoSaves",value:function(e){return M(function(){var t,r,i,a,s,o,u,l,c,h,f,d;return D(this,function(v){switch(v.label){case 0:return t="".concat(n.SAVES_DIR,"/").concat(e,"/auto"),[4,this.fileSystem.listDirectory(t)];case 1:if(!(r=v.sent()))return[2];i=[],a=!0,s=!1,o=void 0,v.label=2;case 2:v.trys.push([2,7,8,9]),u=r[Symbol.iterator](),v.label=3;case 3:if(a=(l=u.next()).done)return[3,6];return c=l.value,[4,this.loadSaveFile("".concat(t,"/").concat(c))];case 4:null!==(h=v.sent())&&i.push({uuid:h.uuid,timestamp:h.timestamp}),v.label=5;case 5:return a=!0,[3,3];case 6:return[3,9];case 7:return f=v.sent(),s=!0,o=f,[3,9];case 8:try{a||null==u.return||u.return()}finally{if(s)throw o}return[7];case 9:i.sort(function(e,t){return t.timestamp-e.timestamp}),v.label=10;case 10:if(!(i.length>T.w.MAX_AUTO_SAVES))return[3,13];if(void 0===(d=i.pop()))return[3,12];return[4,this.fileSystem.deleteFile("".concat(t,"/").concat(d.uuid,".json"))];case 11:v.sent(),v.label=12;case 12:return[3,10];case 13:return[2]}})}).call(this)}},{key:"importSaves",value:function(e){return M(function(){var t,n,r,i,a,s,o,u,l,c,h,f,d,v,p,y,m,b,g,S,w;return D(this,function(E){switch(E.label){case 0:t=[],n=!0,r=!1,i=void 0;try{for(a=Object.entries(e)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var P;P=s.value,u=(o=function(e){if(Array.isArray(e))return e}(P)||function(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a=[],s=!0,o=!1;try{for(i=i.call(e);!(s=(n=i.next()).done)&&(a.push(n.value),a.length!==t);s=!0);}catch(e){o=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(o)throw r}}return a}}(P,2)||V(P,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],l=o[1],c=!0,h=!1,f=void 0;try{for(d=l.manual[Symbol.iterator]();!(c=(v=d.next()).done);c=!0)p=v.value,t.push(this.addManualSave(u,p))}catch(e){h=!0,f=e}finally{try{c||null==d.return||d.return()}finally{if(h)throw f}}y=!0,m=!1,b=void 0;try{for(g=l.auto[Symbol.iterator]();!(y=(S=g.next()).done);y=!0)w=S.value,t.push(this.addAutoSave(u,w))}catch(e){m=!0,b=e}finally{try{y||null==g.return||g.return()}finally{if(m)throw b}}}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return[4,Promise.all(t)];case 1:return[2,E.sent().every(function(e){return e})]}})}).call(this)}},{key:"exportSaves",value:function(){return M(function(){var e,t,n,r,i,a,s,o,u,l;return D(this,function(c){switch(c.label){case 0:return e={},[4,this.getCmdrUuids()];case 1:t=c.sent(),n=!0,r=!1,i=void 0,c.label=2;case 2:c.trys.push([2,7,8,9]),a=t[Symbol.iterator](),c.label=3;case 3:if(n=(s=a.next()).done)return[3,6];return o=s.value,[4,this.getSavesForCmdr(o)];case 4:void 0!==(u=c.sent())&&(e[o]=u),c.label=5;case 5:return n=!0,[3,3];case 6:return[3,9];case 7:return l=c.sent(),r=!0,i=l,[3,9];case 8:try{n||null==a.return||a.return()}finally{if(r)throw i}return[7];case 9:return[2,e]}})}).call(this)}}],t=[{key:"CreateAsync",value:function(e,t){return M(function(){return D(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.createDirectory(n.SAVES_DIR)];case 1:return r.sent(),[2,(0,d.ok)(new n(e,t))];case 2:return console.error("Failed to create SaveBackendMultiFile:",r.sent()),[2,(0,d._q)({type:C.G.INVALID_JSON})];case 3:return[2]}})})()}}],e&&R(n.prototype,e),t&&R(n,t),n}();L(x,"SAVES_DIR","/saves");var N=n(31704),_=n(80456),B=n(49007),F=n(6408),j=n(65646);function U(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var G=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");W(this,"save",void 0),W(this,"encyclopaedia",void 0),W(this,"universe",void 0),this.save=e,this.encyclopaedia=n,this.universe=r}return e=[{key:"New",value:function(){var e;return(e=function(){var e,n,r,i,a,s,o;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(u){switch(u.label){case 0:return e=new j.h((0,B.u)()),e.registerGeneralPlugin(function(e){return(0,f.g)([e.coordinates.starSectorX,e.coordinates.starSectorY,e.coordinates.starSectorZ,e.coordinates.localX,e.coordinates.localY,e.coordinates.localZ])>.5},function(e){var t=e.stellarObjects.map(function(e){return e.id});return e.anomalies.push((0,F.S)(t)),e}),(n=new p.k).backends.push(new v.A(e)),[4,N.E.CreateAsync(new _.m(_.m.SAVES_KEY),new _.m(_.m.BACKUP_SAVE_KEY),e)];case 1:return r=u.sent(),i=void 0,[4,P.CreateAsync()];case 2:if(!(a=u.sent()).success)return[3,8];return[4,x.CreateAsync(a.value,e)];case 3:if(!(s=u.sent()).success)return[3,7];if(!r.success)return[3,6];return[4,r.value.exportSaves()];case 4:return o=u.sent(),[4,s.value.importSaves(o)];case 5:u.sent(),u.label=6;case 6:return i=s.value,[3,8];case 7:r.success&&(i=r.value),u.label=8;case 8:if(void 0===i)return[2,(0,d._q)(Error("Failed to initialize save backend: OPFS not supported and legacy save backend failed"))];return[2,(0,d.ok)(new t(i,n,e))]}})},function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){U(a,r,i,s,o,"next",e)}function o(e){U(a,r,i,s,o,"throw",e)}s(void 0)})})()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t,e),t}(),q=n(61741),H=n(26274);n(96395),n(26654);var Q=n(14280);let z=n.p+"17af999e7b7ad57f.mp3",Y=n.p+"041ff9a253ed825d.mp3",K=n.p+"1549759e283bd206.ogg",J=n.p+"31e17b20ef567c2c.ogg",Z=n.p+"39989db1f505d453.ogg",$=n.p+"d0fafb23c7d554d6.mp3",X=n.p+"e681fd4fea79fa37.ogg",ee=n.p+"2a8bc67628c05fba.ogg",et=n.p+"1814b3aace9cf589.ogg",en=n.p+"bf4b326c5ffca2bb.mp3",er=n.p+"368a319571c58001.ogg",ei=n.p+"c1c5397b26a6c809.ogg",ea=n.p+"920dd9f7b92185e2.ogg";function es(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}let eo=n.p+"a77f60b1dade8fb8.mp3",eu=n.p+"2344fdde5c5a6410.mp3",el=n.p+"a5a4982c205e1a77.mp3",ec=n.p+"452710f264d2ba19.mp3",eh=n.p+"305475735c5d3c0e.mp3",ef=n.p+"65ceacf6bbb524ce.mp3",ed=n.p+"5f6f5bf7bfca113e.mp3",ev=n.p+"4884a61f606c46b6.mp3",ep=n.p+"414af932bdf1a85c.mp3",ey=n.p+"9bbc526876e8d7f3.mp3",em=n.p+"4c543ebfed7579a0.mp3",eb=n.p+"dea0682c68132870.mp3";function eg(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}let eS=n.p+"d03a87f2075d6f53.mp3",ew=n.p+"02b9b418f00b21c6.mp3",eE=n.p+"cd82c2ed886f9749.mp3",eP=n.p+"5d862e8381583459.mp3",eA=n.p+"c83251e2246e7d88.mp3",eT=n.p+"64c7906a8f900679.mp3",ek=n.p+"2da6813008740281.mp3",eC=n.p+"b3ce59bafdbe5a25.mp3",eI=n.p+"cb1faa14ee3af51b.mp3",eO=n.p+"398d2c8156e90ba6.mp3",eM=n.p+"03f6eca0cfdf0539.mp3";function eR(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function eL(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}var eV=n(62978);function eD(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}var ex=n(7661),eN=n(55548);function e_(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var eB=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");e_(this,"currentMusic",null),e_(this,"silenceSeconds",0),e_(this,"volume",1),e_(this,"fadeSeconds",3),e_(this,"pauseMusicWhenPaused",!1),e_(this,"starSystemView",void 0),e_(this,"musics",void 0),this.musics=e,this.starSystemView=n;var i=eN.$.audioEngine;if(null===i)throw Error("Audio context is null");i.onAudioUnlockedObservable.addOnce(function(){if(null!==r.currentMusic){var e=r.currentMusic;r.currentMusic=null,r.setMusic(e)}})}return e=[{key:"setMusicFromSelection",value:function(e){if(!(null!==this.currentMusic&&e.includes(this.currentMusic))){var t=e[Math.floor(Math.random()*e.length)];void 0!==t&&this.setMusic(t)}}},{key:"setMusic",value:function(e){if(this.currentMusic!==e){if(null!==this.currentMusic){this.currentMusic.setVolume(0,this.fadeSeconds),this.currentMusic=null,this.silenceSeconds=this.fadeSeconds;return}null!==e&&(this.currentMusic=e,this.currentMusic.stop(),this.currentMusic.setVolume(0),this.currentMusic.play(),this.currentMusic.setVolume(this.volume,this.fadeSeconds),console.log("currently playing",this.currentMusic.name))}}},{key:"setSoundtrackVolume",value:function(e){this.volume=e,null!==this.currentMusic&&this.currentMusic.setVolume(e)}},{key:"getVolume",value:function(){return this.volume}},{key:"update",value:function(e,t,n,r){if(null!==this.currentMusic){if(e&&this.pauseMusicWhenPaused&&this.currentMusic.isPlaying)return void this.currentMusic.pause();if(!e&&this.currentMusic.isPaused)return void this.currentMusic.play();e||this.currentMusic.isPlaying||(this.currentMusic=null,this.silenceSeconds=30+(Math.random()-.5)*20)}if(this.silenceSeconds>0){this.silenceSeconds-=r;return}if(!this.starSystemView.isLoadingSystem()){var i=this.starSystemView.getSpaceshipControls().getSpaceship(),a=this.starSystemView.scene.getActiveControls()===this.starSystemView.getCharacterControls(),s=this.starSystemView.scene.getActiveControls().getTransform().getAbsolutePosition(),u=this.starSystemView.getStarSystem().getNearestOrbitalObject(s),l=o.Pq.Distance(s,u.getTransform().getAbsolutePosition());if(!t||n)return void this.setMusic(this.musics.wandering);if(!i.isLanded()&&null!==i.getTargetLandingPad())return void this.setMusic(this.musics.straussBlueDanube);var c=i.getInternals().getWarpDrive();switch(u.model.type){case q.T.BLACK_HOLE:this.setMusicFromSelection([this.musics.soaring]);return;case q.T.MANDELBULB:case q.T.JULIA_SET:case q.T.MANDELBOX:case q.T.SIERPINSKI_PYRAMID:case q.T.MENGER_SPONGE:case q.T.DARK_KNIGHT:if(l<100*u.getBoundingRadius())return void this.setMusicFromSelection([this.musics.spacialWinds,this.musics.echoesOfTime]);break;case q.T.STAR:case q.T.NEUTRON_STAR:case q.T.TELLURIC_PLANET:case q.T.TELLURIC_SATELLITE:case q.T.GAS_PLANET:case q.T.CUSTOM:break;case q.T.SPACE_STATION:case q.T.SPACE_ELEVATOR:if((null===c||c.isDisabled())&&l<10*u.getBoundingRadius())return void this.setMusic(this.musics.equatorialComplex)}if(null!==c&&c.isEnabled()){var h=[this.musics.atlanteanTwilight,this.musics.infinitePerspective,this.musics.mesmerize];this.setMusicFromSelection(h);return}if(!i.isLanded()&&(null===c||c.isDisabled())){var f=[this.musics.thatZenMoment,this.musics.deepRelaxation,this.musics.peaceOfMind];this.setMusicFromSelection(f);return}if(a||i.isLanded()){var d=[this.musics.thatZenMoment,this.musics.deepRelaxation,this.musics.peaceOfMind,this.musics.mesmerize,this.musics.reawakening];this.setMusicFromSelection(d);return}this.setMusic(null)}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),eF=n(76448),ej=n(13997),eU=n(3818),eW=n(61094),eG=n(38483),eq=n(25187),eH=n(22149),eQ=n(55017),ez=n(81629),eY=n(48462),eK=n(8561),eJ=n(92500),eZ=n(97966),e$=n(78706),eX=n(88996),e0=n(74459),e1=n(54060),e2=n(15524),e4=n(92487),e3=n(82886),e5=n(17966),e6=n(84369),e8=n(34547),e7=n(35789),e9=n(3211),te=[eU.i,e9.n,e8.S,e6._,e3.b,e5.Z,e7.I],tt=n(95369),tn=n(8908);function tr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ti(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function ta(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a=[],s=!0,o=!1;try{for(i=i.call(e);!(s=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);s=!0);}catch(e){o=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(o)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return tr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tr(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ts=n(69121),to=n(55721),tu=n(44124),tl=n(80617);function tc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var th=function e(){var t=this;if(!(this instanceof e))throw TypeError("Cannot call a class as a function");tc(this,"htmlRoot",void 0),tc(this,"onTutorialSelected",new eY.cP),tc(this,"availableTutorials",void 0),this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("tutorialsMenuContainer"),this.availableTutorials=[new ts.$,new tl.M,new tu.r,new to.F],this.availableTutorials.forEach(function(e){var n=document.createElement("div");n.classList.add("tutorial");var r=document.createElement("h2");r.textContent=e.getTitle(),n.appendChild(r);var i=document.createElement("img");i.src=e.coverImageSrc,i.alt=e.getTitle(),n.appendChild(i);var a=document.createElement("p");a.textContent=e.getDescription(),n.appendChild(a),t.htmlRoot.appendChild(n),n.addEventListener("click",function(){t.onTutorialSelected.notifyObservers(e)})});var n=document.createElement("p");n.classList.add("moreWillCome"),n.textContent=e$.A.t("tutorials:common:moreWillComeSoon"),this.htmlRoot.appendChild(n)};function tf(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function td(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tv=((r={})[r.LOAD_SAVE=0]="LOAD_SAVE",r[r.SETTINGS=1]="SETTINGS",r[r.TUTORIALS=2]="TUTORIALS",r[r.CONTRIBUTE=3]="CONTRIBUTE",r[r.CREDITS=4]="CREDITS",r[r.ABOUT=5]="ABOUT",r),tp=function(){var e;function t(e,n,r,i){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");td(this,"activeRightPanel",null),td(this,"loadSavePanel",void 0),td(this,"loadSavePanelContent",void 0),td(this,"settingsPanel",void 0),td(this,"tutorialsPanel",void 0),td(this,"tutorialsPanelContent",void 0),td(this,"contributePanel",void 0),td(this,"creditsPanel",void 0),td(this,"aboutPanel",void 0),td(this,"starSystemDatabase",void 0),td(this,"saveBackend",void 0),this.starSystemDatabase=e,this.saveBackend=n;var a=document.getElementById("loadSavePanel");if(null===a)throw Error("#loadSavePanel does not exist!");this.loadSavePanel=a,this.attachCloseButton(this.loadSavePanel),this.loadSavePanelContent=new e0.X(e,r),this.loadSavePanel.appendChild(this.loadSavePanelContent.htmlRoot),this.settingsPanel=function(e){var t=document.getElementById("settingsPanel");if(null===t)throw Error("#settings does not exist!");var n=document.createElement("div");n.classList.add("settings-section");var r=document.createElement("h3");r.textContent=e$.A.t("sidePanel:audioSettings"),r.style.fontFamily="Nasalization, sans-serif",n.appendChild(r);var i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.gap="10px",i.style.fontFamily="Nasalization, sans-serif";var a=document.createElement("label");a.textContent=e$.A.t("sidePanel:musicVolume"),a.style.fontFamily="Nasalization, sans-serif",a.style.minWidth="80px",a.style.flexGrow="1",a.style.color="#fff",a.style.fontWeight="bold",a.style.letterSpacing="1px",a.style.fontSize="1.1em",i.appendChild(a);var s=document.createElement("input");s.type="range",s.min="0",s.max="1",s.step="0.05",s.value=e.getVolume().toString(),s.style.margin="0 10px",s.style.accentColor="#ffffff";var o=document.createElement("span");return o.textContent=(100*parseFloat(s.value)).toFixed(0)+"%",o.style.fontFamily="Nasalization, sans-serif",o.style.color="#fff",o.style.backgroundColor="#1a1a1a",o.style.padding="2px 8px",o.style.borderRadius="4px",o.style.fontWeight="bold",o.style.fontSize="1em",o.style.marginLeft="4px",o.style.minWidth="50px",o.style.textAlign="center",s.addEventListener("input",function(){var t=parseFloat(s.value);o.textContent=(100*t).toFixed(0)+"%",e.setSoundtrackVolume(t)}),i.appendChild(s),i.appendChild(o),n.appendChild(i),t.appendChild(n),(0,tt.t)().then(function(e){te.forEach(function(n){var r=document.createElement("div");r.classList.add("map");var i=document.createElement("h3");i.textContent=n.name.replace(/([A-Z])/g," $1").trim(),r.appendChild(i);var a=!0,s=!1,o=void 0;try{for(var u,l=Object.entries(n.map)[Symbol.iterator]();!(a=(u=l.next()).done);a=!0)!function(){var t=ta(u.value,2),n=t[0],i=t[1],a=new Map;(ti(i,e1.A)?i.bindings:i.action.bindings).forEach(function(t){if(ti(t.control,e4.A))(0,tn.Fd)(t.control,e).forEach(function(e){var t,n=ta(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else if(ti(t.control,e2.OG)){var n,r=(0,tn.Xi)(t.control,e);a.has("BUTTON")||a.set("BUTTON",[]),null==(n=a.get("BUTTON"))||n.push(r)}else if(ti(t.control,e2.hn))(0,tn.Lc)(t.control,e).forEach(function(e){var t,n=ta(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else if(ti(t.control,e2.mD))(0,tn.Jc)(t.control).forEach(function(e){var t,n=ta(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else if(ti(t.control,e2.fX))(0,tn.qA)().forEach(function(e){var t,n=ta(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else throw Error("Unknown control type")});var s=document.createElement("div"),o=document.createElement("p");if(o.textContent=n.replace(/([A-Z])/g," $1").trim(),s.appendChild(o),1===a.size){s.classList.add("actionSingle");var l=document.createElement("div");l.classList.add("valuesContainer");var c=!0,h=!1,f=void 0;try{for(var d,v=a.values()[Symbol.iterator]();!(c=(d=v.next()).done);c=!0)d.value.forEach(function(e){var t=document.createElement("p");t.innerText=e,l.appendChild(t)})}catch(e){h=!0,f=e}finally{try{c||null==v.return||v.return()}finally{if(h)throw f}}s.appendChild(l)}else s.classList.add("actionMultiple"),a.forEach(function(e,t){var n=document.createElement("div");n.classList.add("subAction");var r=document.createElement("p");r.textContent=t;var i=document.createElement("div");i.classList.add("valuesContainer"),e.forEach(function(e){var t=document.createElement("p");t.innerText=e,i.appendChild(t)}),n.appendChild(r),n.appendChild(i),s.appendChild(n)});r.appendChild(s)}()}catch(e){s=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw o}}t.appendChild(r)})}),t}(i),this.attachCloseButton(this.settingsPanel);var s=document.getElementById("tutorials");if(null===s)throw Error("#tutorials does not exist!");this.tutorialsPanel=s,this.attachCloseButton(this.tutorialsPanel),this.tutorialsPanelContent=new th,this.tutorialsPanel.appendChild(this.tutorialsPanelContent.htmlRoot);var o=document.getElementById("contribute");if(null===o)throw Error("#contribute does not exist!");this.contributePanel=o,this.attachCloseButton(this.contributePanel);var u=document.getElementById("credits");if(null===u)throw Error("#credits does not exist!");this.creditsPanel=u,this.attachCloseButton(this.creditsPanel);var l=document.getElementById("about");if(null===l)throw Error("#about does not exist!");this.aboutPanel=l,this.attachCloseButton(this.aboutPanel)}return e=[{key:"panelFromType",value:function(e){var t=null;switch(e){case 0:t=this.loadSavePanel;break;case 1:t=this.settingsPanel;break;case 2:t=this.tutorialsPanel;break;case 3:t=this.contributePanel;break;case 4:t=this.creditsPanel;break;case 5:t=this.aboutPanel}return t}},{key:"attachCloseButton",value:function(e){var t=this;if(!e.querySelector(".close-button")){var n=document.createElement("button");n.innerText="X",n.className="close-button",n.addEventListener("click",function(){t.hideActivePanel()}),e.appendChild(n)}}},{key:"toggleActivePanel",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(n){switch(n.label){case 0:if(t=this.panelFromType(e),this.activeRightPanel===t)return[2];if(0!==e)return[3,2];return[4,this.loadSavePanelContent.populateCmdrList(this.starSystemDatabase,this.saveBackend)];case 1:n.sent(),n.label=2;case 2:return null!==this.activeRightPanel&&this.hideActivePanel(),this.activeRightPanel=t,t.classList.add("visible"),[2]}})},function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function s(e){tf(a,r,i,s,o,"next",e)}function o(e){tf(a,r,i,s,o,"throw",e)}s(void 0)})}).call(this)}},{key:"hideActivePanel",value:function(){null!==this.activeRightPanel&&(this.activeRightPanel.classList.remove("visible"),this.activeRightPanel=null)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function ty(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function tm(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){ty(a,r,i,s,o,"next",e)}function o(e){ty(a,r,i,s,o,"throw",e)}s(void 0)})}}function tb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tg(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var tS=function(){var e;function t(e,n,r,i){var a=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");tb(this,"scene",void 0),tb(this,"controls",void 0),tb(this,"starSystemView",void 0),tb(this,"starSystemModel",void 0),tb(this,"onStartObservable",new eY.cP),tb(this,"onContributeObservable",new eY.cP),tb(this,"onCreditsObservable",new eY.cP),tb(this,"onAboutObservable",new eY.cP),tb(this,"htmlRoot",void 0),tb(this,"title",void 0),tb(this,"version",void 0),tb(this,"sidePanels",void 0),tb(this,"universeObjectId",void 0),tb(this,"startAnimationDurationSeconds",5),this.sidePanels=e,this.starSystemView=n,this.scene=this.starSystemView.scene,this.controls=this.starSystemView.getDefaultControls(),this.starSystemView.setUIEnabled(!1);var s=r.getSystemModelFromCoordinates({localX:.49137314641446483,localY:.48043087077347135,localZ:.38353311777279386,starSectorX:0,starSectorY:0,starSectorZ:0});if(null===s)throw Error("Cannot find system");var o=s.planets.at(1);if(void 0===o)throw Error("Cannot find planet with index 2");this.universeObjectId=(0,H.Ei)(o,s),this.starSystemModel=s;var u=document.getElementById("mainMenu");if(null===u)throw Error("#mainMenu does not exist!");this.htmlRoot=u,this.htmlRoot.style.display="none";var l=document.querySelector("#mainMenu h1");if(null===l)throw Error("#mainMenu h1 does not exist!");this.title=l;var c=document.getElementById("version");if(null===c)throw Error("#version does not exist!");var h=c.querySelector("a");if(null===h)throw Error("version link does not exist!");h.textContent="Alpha ".concat(eX.rE),this.version=c,document.querySelectorAll("#menuItems li").forEach(function(e){e.addEventListener("mouseenter",function(){i.playNow(eF.Wo.HOVER)}),e.addEventListener("click",function(){i.playNow(eF.Wo.CLICK)})}),document.querySelectorAll("#mainMenu *[data-i18n]").forEach(function(e){var t=e.getAttribute("data-i18n");if(null===t)throw Error("data-i18n attribute is null");e.textContent=e$.A.t(t)});var f=document.getElementById("startButton");if(null===f)throw Error("#startButton does not exist!");f.addEventListener("click",function(){a.startAnimation(function(){return a.onStartObservable.notifyObservers()})});var d=document.getElementById("loadSaveButton");if(null===d)throw Error("#loadSaveButton does not exist!");d.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.LOAD_SAVE)];case 1:return e.sent(),[2]}})}).call(a)}),this.sidePanels.loadSavePanelContent.onLoadSaveObservable.add(function(){a.hide()});var v=document.getElementById("settingsButton");if(null===v)throw Error("#settingsButton does not exist!");v.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.SETTINGS)];case 1:return e.sent(),[2]}})}).call(a)});var p=document.getElementById("tutorialsButton");if(null===p)throw Error("#tutorialsButton does not exist!");p.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.TUTORIALS)];case 1:return e.sent(),[2]}})}).call(a)});var y=document.getElementById("contributeButton");if(null===y)throw Error("#contributeButton does not exist!");y.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.CONTRIBUTE)];case 1:return e.sent(),this.onContributeObservable.notifyObservers(),[2]}})}).call(a)});var m=document.getElementById("creditsButton");if(null===m)throw Error("#creditsButton does not exist!");m.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.CREDITS)];case 1:return e.sent(),this.onCreditsObservable.notifyObservers(),[2]}})}).call(a)});var b=document.getElementById("aboutButton");if(null===b)throw Error("#aboutButton does not exist!");b.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.ABOUT)];case 1:return e.sent(),this.onAboutObservable.notifyObservers(),[2]}})}).call(a)})}return e=[{key:"init",value:function(){return tm(function(){var e;return tg(this,function(t){switch(t.label){case 0:return e=this,[4,this.starSystemView.loadStarSystem(this.starSystemModel)];case 1:return t.sent(),this.starSystemView.onInitStarSystem.addOnce(function(){return tm(function(){var e,t;return tg(this,function(n){switch(n.label){case 0:return[4,this.starSystemView.switchToDefaultControls(!1)];case 1:if(n.sent(),e=this.starSystemModel.stellarObjects[0].type===q.T.BLACK_HOLE?8:2,void 0===(t=this.starSystemView.getStarSystem().getOrbitalObjectById(this.universeObjectId.idInSystem)))throw Error("Could not find object with ID ".concat(JSON.stringify(this.universeObjectId)));return(0,eZ.$Q)(this.controls,t,this.starSystemView.getStarSystem(),e),[2]}})}).call(e)}),this.starSystemView.targetCursorLayer.setEnabled(!1),this.htmlRoot.style.display="block",[2]}})}).call(this)}},{key:"startAnimation",value:function(e){var t=this;this.sidePanels.hideActivePanel();var n=this.starSystemView.getStarSystem(),r=this.controls.getTransform().forward,i=n.getOrbitalObjectById(this.universeObjectId.idInSystem),a=n.getCelestialBodies().find(function(e){return e===i});if(void 0===a)throw Error("No corresponding celestial body found");var s=a.getTransform().getAbsolutePosition().subtract(this.controls.getTransform().getAbsolutePosition()).normalize(),u=o.Pq.Cross(r,s),l=o.Pq.GetAngleBetweenVectors(r,s,u),c=(0,eZ.og)(a,n,.9),h=new eK.J(this.controls.getTransform(),u,l,this.startAnimationDurationSeconds),f=new eJ.k(this.controls.getTransform(),c,this.startAnimationDurationSeconds);this.title.animate([{marginTop:this.title.style.marginTop,opacity:1},{marginTop:"30vh",opacity:0}],{duration:1e3*this.startAnimationDurationSeconds,easing:"ease-in-out",fill:"forwards"});var d=function(){var r=t.scene.getEngine().getDeltaTime()/1e3;if(f.isFinished()||f.update(r),h.isFinished()){t.scene.onBeforePhysicsObservable.removeCallback(d),t.htmlRoot.style.display="none",t.starSystemView.setUIEnabled(!0),e();return}h.update(r),t.controls.getActiveCamera().getViewMatrix(),n.applyFloatingOrigin(),t.starSystemView.postProcessManager.update(0),n.updateShaders(0)};this.scene.onBeforePhysicsObservable.add(d),this.hideMenu(),this.hideVersion()}},{key:"hideVersion",value:function(){this.version.style.transform="translateY(100%)"}},{key:"hideMenu",value:function(){var e=document.getElementById("menuItems");if(null===e)throw Error("#menuItems does not exist!");e.style.left="-20%"}},{key:"hide",value:function(){this.hideVersion(),this.hideMenu(),this.sidePanels.hideActivePanel(),this.htmlRoot.style.display="none"}},{key:"isVisible",value:function(){return"none"!==this.htmlRoot.style.display}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),tw=n(12577);function tE(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function tP(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){tE(a,r,i,s,o,"next",e)}function o(e){tE(a,r,i,s,o,"throw",e)}s(void 0)})}}function tA(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tT(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var tk=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");tA(this,"rootNode",void 0),tA(this,"mask",void 0),tA(this,"screenshotButton",void 0),tA(this,"shareButton",void 0),tA(this,"contributeButton",void 0),tA(this,"tutorialsButton",void 0),tA(this,"settingsButton",void 0),tA(this,"loadButton",void 0),tA(this,"saveButton",void 0),tA(this,"resumeButton",void 0),tA(this,"sidePanels",void 0),tA(this,"onScreenshot",new eY.cP),tA(this,"onShare",new eY.cP),tA(this,"onSave",new eY.cP),tA(this,"onResume",new eY.cP),this.sidePanels=e,this.mask=document.createElement("div"),this.mask.id="pauseMask",this.rootNode=document.createElement("ul"),this.rootNode.id="pauseMenu",this.rootNode.classList.add("leftSideMenu");var i=function(e,t){var n=document.createElement("li");return n.id=e,n.classList.add("button"),n.innerText=e$.A.t(t),r.rootNode.appendChild(n),n};this.resumeButton=i("resumeButton","pauseMenu:resume"),this.saveButton=i("saveButton","pauseMenu:save"),this.loadButton=i("loadButton","pauseMenu:load"),this.tutorialsButton=i("pauseTutorialsButton","pauseMenu:tutorials"),this.settingsButton=i("pauseSettingsButton","pauseMenu:settings"),this.contributeButton=i("pauseContributeButton","pauseMenu:contribute"),this.screenshotButton=i("screenshotButton","pauseMenu:screenshot"),this.shareButton=i("shareButton","pauseMenu:share"),this.mask.appendChild(this.rootNode),document.body.appendChild(this.mask),this.screenshotButton.addEventListener("click",function(){return r.onScreenshot.notifyObservers()}),this.shareButton.addEventListener("click",function(){return r.onShare.notifyObservers()}),this.contributeButton.addEventListener("click",function(){return tP(function(){return tT(this,function(e){switch(e.label){case 0:return n.playNow(eF.Wo.CLICK),[4,this.sidePanels.toggleActivePanel(tv.CONTRIBUTE)];case 1:return e.sent(),[2]}})}).call(r)}),this.tutorialsButton.addEventListener("click",function(){return tP(function(){return tT(this,function(e){switch(e.label){case 0:return n.playNow(eF.Wo.CLICK),[4,this.sidePanels.toggleActivePanel(tv.TUTORIALS)];case 1:return e.sent(),[2]}})}).call(r)}),this.settingsButton.addEventListener("click",function(){return tP(function(){return tT(this,function(e){switch(e.label){case 0:return n.playNow(eF.Wo.CLICK),[4,this.sidePanels.toggleActivePanel(tv.SETTINGS)];case 1:return e.sent(),[2]}})}).call(r)}),this.loadButton.addEventListener("click",function(){return tP(function(){return tT(this,function(e){switch(e.label){case 0:return n.playNow(eF.Wo.CLICK),[4,this.sidePanels.toggleActivePanel(tv.LOAD_SAVE)];case 1:return e.sent(),[2]}})}).call(r)}),this.saveButton.addEventListener("click",function(){return r.onSave.notifyObservers()}),this.resumeButton.addEventListener("click",function(){return r.onResume.notifyObservers()}),this.rootNode.querySelectorAll("li").forEach(function(e){e.addEventListener("mouseenter",function(){n.playNow(eF.Wo.HOVER)}),e.addEventListener("click",function(){n.playNow(eF.Wo.CLICK)})}),this.setVisibility(!1)}return e=[{key:"setVisibility",value:function(e){this.rootNode.style.display=e?"grid":"none",this.mask.style.display=e?"block":"none",e||this.sidePanels.hideActivePanel()}},{key:"isVisible",value:function(){return"none"!==this.rootNode.style.display}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),tC=n(58168),tI=n(18076),tO=n(72581);function tM(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function tR(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){tM(a,r,i,s,o,"next",e)}function o(e){tM(a,r,i,s,o,"throw",e)}s(void 0)})}}function tL(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tV(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tD(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var tx=function(){var e,t;function r(e,t,n,i,a,s,u){var l=this;if(!(this instanceof r))throw TypeError("Cannot call a class as a function");tV(this,"engine",void 0),tV(this,"assets",void 0),tV(this,"starSystemView",void 0),tV(this,"starMap",void 0),tV(this,"musicConductor",void 0),tV(this,"soundPlayer",void 0),tV(this,"tts",void 0),tV(this,"mainMenu",void 0),tV(this,"pauseMenu",void 0),tV(this,"sidePanels",void 0),tV(this,"tutorialLayer",void 0),tV(this,"activeView",void 0),tV(this,"state",0),tV(this,"videoRecorder",null),tV(this,"player",void 0),tV(this,"backend",void 0),tV(this,"elapsedSeconds",0),tV(this,"autoSavePeriodSeconds",300),tV(this,"autoSaveTimerSeconds",0),tV(this,"isAutoSaveEnabled",!0),this.engine=t,this.assets=n,this.player=e,this.player.onNameChangedObservable.add(function(){return tR(function(){return tD(this,function(e){switch(e.label){case 0:return[4,this.createManualSave()];case 1:return e.sent(),[2]}})}).call(l)}),this.backend=a,this.player.discoveries.uploaded.forEach(function(e){return tR(function(){return tD(this,function(t){switch(t.label){case 0:return[4,this.backend.encyclopaedia.contributeDiscoveryIfNew(e)];case 1:return t.sent(),[2]}})}).call(l)}),this.starSystemView=i,this.starSystemView.onBeforeJump.add(function(){return tR(function(){return tD(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(l)}),this.starSystemView.onAfterJump.add(function(){return tR(function(){var e;return tD(this,function(t){switch(t.label){case 0:return e=this,[4,this.createAutoSave()];case 1:if(t.sent(),this.player.tutorials.fuelScoopingCompleted)return[3,3];return[4,this.tutorialLayer.setTutorial(new to.F)];case 2:t.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.fuelScoopingCompleted=!0}),t.label=3;case 3:return[2]}})}).call(l)}),this.starSystemView.onNewDiscovery.add(function(){return tR(function(){return tD(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(l)}),this.musicConductor=new eB(this.assets.audio.musics,this.starSystemView),this.soundPlayer=s,this.tts=u,this.starMap=new eG.b(this.player,this.engine,this.backend.encyclopaedia,this.backend.universe,this.soundPlayer),this.starMap.onTargetSetObservable.add(function(e){l.starSystemView.setSystemAsTarget(e)}),this.starMap.detachControl(),this.starSystemView.attachControl(),this.activeView=this.starSystemView,s.setInstanceMask(ex.U.STAR_SYSTEM_VIEW),this.tutorialLayer=new tC.O(this.soundPlayer),document.body.appendChild(this.tutorialLayer.root),this.sidePanels=new tp(this.backend.universe,this.backend.save,this.soundPlayer,this.musicConductor),this.sidePanels.loadSavePanelContent.onLoadSaveObservable.add(function(e){t.onEndFrameObservable.addOnce(function(){return tR(function(){return tD(this,function(t){switch(t.label){case 0:if(!this.isPaused())return[3,2];return[4,this.createAutoSave()];case 1:t.sent(),t.label=2;case 2:return[4,this.resume()];case 3:return t.sent(),this.starSystemView.setUIEnabled(!0),[4,this.loadSave(e)];case 4:return t.sent(),[2]}})}).call(l)})}),this.mainMenu=new tS(this.sidePanels,this.starSystemView,this.backend.universe,this.soundPlayer),this.mainMenu.onStartObservable.add(function(){return tR(function(){var e,t,n;return tD(this,function(r){switch(r.label){case 0:return e=this,[4,this.tutorialLayer.setTutorial(new ts.$)];case 1:return r.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.flightCompleted=!0}),[4,this.starSystemView.switchToSpaceshipControls()];case 2:return r.sent(),t=this.starSystemView.getSpaceshipControls().getTransform().getAbsolutePosition(),n=this.starSystemView.getStarSystem().getOrbitalFacilities().reduce(function(e,n){return o.Pq.DistanceSquared(t,n.getTransform().getAbsolutePosition())<o.Pq.DistanceSquared(t,e.getTransform().getAbsolutePosition())?n:e}),this.starSystemView.setTarget(n),[4,this.createAutoSave()];case 3:return r.sent(),[2]}})}).call(l)}),this.sidePanels.tutorialsPanelContent.onTutorialSelected.add(function(e){return tR(function(){return tD(this,function(t){switch(t.label){case 0:if(this.mainMenu.isVisible())return[3,3];return[4,this.createAutoSave()];case 1:return t.sent(),[4,(0,ez.QD)(e$.A.t("tutorials:common:loadTutorialWillLeaveGame"),this.soundPlayer)];case 2:if(!t.sent())return[2];t.label=3;case 3:return this.sidePanels.hideActivePanel(),this.loadTutorial(e),[2]}})}).call(l)}),this.starSystemView.getSpaceshipControls().onToggleWarpDrive.add(function(e){return tR(function(){var t,n,r,i,a,s;return tD(this,function(u){switch(u.label){case 0:if(t=this,e||this.player.tutorials.stationLandingCompleted||null===(r=(n=this.starSystemView.getSpaceshipControls()).getClosestLandableFacility())||(i=n.getTransform().getAbsolutePosition(),a=r.getTransform().position,s=10*r.getBoundingRadius(),o.Pq.DistanceSquared(i,a)>Math.pow(s,2)))return[2];return[4,this.tutorialLayer.setTutorial(new tl.M)];case 1:return u.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){t.player.tutorials.stationLandingCompleted=!0}),[2]}})}).call(l)}),this.starSystemView.getSpaceshipControls().onCompleteLanding.add(function(){return tR(function(){return tD(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(l)}),this.starSystemView.onInitStarSystem.add(function(){var e=l.starSystemView.getStarSystem().model;l.starMap.setCurrentStarSystem(e.coordinates)}),this.starSystemView.spaceStationLayer.onTakeOffObservable.add(function(){return tR(function(){var e;return tD(this,function(t){switch(t.label){case 0:if(e=this,this.player.tutorials.starMapCompleted)return[2];return[4,this.tutorialLayer.setTutorial(new tu.r)];case 1:return t.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.starMapCompleted=!0}),[2]}})}).call(l)}),this.pauseMenu=new tk(this.sidePanels,this.soundPlayer),this.pauseMenu.onResume.add(function(){return l.resume()}),this.pauseMenu.onScreenshot.add(function(){return l.takeScreenshot()}),this.pauseMenu.onShare.add(function(){l.engine.onEndFrameObservable.addOnce(function(){return tR(function(){var e,t,n;return tD(this,function(r){switch(r.label){case 0:return e=this,[4,this.generateSaveData()];case 1:if((t=r.sent()).player.uuid=T.w.SHARED_POSITION_SAVE_UUID,null!==(n=(0,k.fe)(t)))return[3,3];return[4,(0,ez.sQ)("Could not create a shareable link.",this.soundPlayer)];case 2:case 4:return r.sent(),[2];case 3:return[4,navigator.clipboard.writeText(n.toString()).then(function(){(0,tw.UI)(tw.I9.GENERAL,tw.yg.INFO,e$.A.t("notifications:copiedToClipboard"),2e3,e.soundPlayer)})]}})}).call(l)})}),this.pauseMenu.onSave.add(function(){return tR(function(){return tD(this,function(e){switch(e.label){case 0:return[4,this.createManualSave()];case 1:return e.sent()?(0,tw.UI)(tw.I9.GENERAL,tw.yg.SUCCESS,e$.A.t("notifications:saveOk"),2e3,this.soundPlayer):(0,tw.UI)(tw.I9.GENERAL,tw.yg.ERROR,e$.A.t("notifications:cantSaveTutorial"),2e3,this.soundPlayer),[2]}})}).call(l)}),window.addEventListener("blur",function(){l.mainMenu.isVisible()||l.starSystemView.isLoadingSystem()||l.pause()}),window.addEventListener("mouseleave",function(){l.mainMenu.isVisible()||l.starSystemView.isLoadingSystem()||l.pause()}),window.addEventListener("resize",function(){l.engine.resize(!0)}),window.addEventListener("beforeunload",function(){return tR(function(){return tD(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(l)}),eU.i.map.toggleStarMap.on("complete",function(){return tR(function(){return tD(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.toggleStarMap()];case 1:return e.sent(),[2]}})}).call(l)}),eU.i.map.screenshot.on("complete",function(){return tR(function(){return tD(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.takeScreenshot()];case 1:return e.sent(),[2]}})}).call(l)}),eU.i.map.videoCapture.on("complete",function(){return tR(function(){return tD(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.takeVideoCapture()];case 1:return e.sent(),[2]}})}).call(l)}),eU.i.map.togglePause.on("complete",function(){!l.mainMenu.isVisible()&&(l.isPaused()||l.pause())}),window.CosmosJourneyer=this}return e=[{key:"pause",value:function(){this.isPaused()||this.mainMenu.isVisible()||(this.state=2,document.exitPointerLock(),this.activeView===this.starSystemView&&this.starSystemView.stopBackgroundSounds(),this.soundPlayer.playNow(eF.Wo.OPEN_PAUSE_MENU),this.pauseMenu.setVisibility(!0))}},{key:"resume",value:function(){return tR(function(){var e;return tD(this,function(t){switch(t.label){case 0:if(!this.isPaused())return[2];if(this.state=1,this.soundPlayer.playNow(eF.Wo.CLICK),this.pauseMenu.setVisibility(!1),!(this.activeView===this.starSystemView&&this.starSystemView.scene.getActiveControls().shouldLockPointer()))return[3,2];return[4,null==(e=this.engine.getRenderingCanvas())?void 0:e.requestPointerLock()];case 1:t.sent(),t.label=2;case 2:return[2]}})}).call(this)}},{key:"isPaused",value:function(){return 2===this.state}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return tR(function(){var t;return tD(this,function(n){switch(n.label){case 0:if(t=this,e)return[3,2];return[4,this.mainMenu.init()];case 1:n.sent(),n.label=2;case 2:return this.starSystemView.initStarSystem(),this.engine.runRenderLoop(function(){var e=t.engine.getDeltaTime()/1e3;t.elapsedSeconds+=e,t.player.timePlayedSeconds+=e,t.autoSaveTimerSeconds+=e,t.autoSaveTimerSeconds>=t.autoSavePeriodSeconds&&(t.autoSaveTimerSeconds%=t.autoSavePeriodSeconds,t.mainMenu.isVisible()||t.starSystemView.isJumpingBetweenSystems()||t.createAutoSave()),(0,tw.E$)(e),t.musicConductor.update(t.isPaused(),t.activeView===t.starSystemView,t.mainMenu.isVisible(),e),t.soundPlayer.update(),t.tts.update(),t.isPaused()||t.activeView.render()}),this.state=1,[2]}})}).call(this)}},{key:"toggleStarMap",value:function(){return tR(function(){var e,t;return tD(this,function(n){switch(n.label){case 0:if(this.activeView!==this.starSystemView)return[3,1];return this.soundPlayer.setInstanceMask(ex.U.STAR_MAP_VIEW),this.starSystemView.targetCursorLayer.setEnabled(!1),document.exitPointerLock(),this.starSystemView.detachControl(),this.starMap.attachControl(),e=this.starMap,this.activeView=e,e.focusOnCurrentSystem(),[3,3];case 1:if(this.starMap.detachControl(),this.starSystemView.attachControl(),this.soundPlayer.setInstanceMask(ex.U.STAR_SYSTEM_VIEW),this.activeView=this.starSystemView,!this.starSystemView.scene.getActiveControls().shouldLockPointer())return[3,3];return[4,null==(t=this.engine.getRenderingCanvas())?void 0:t.requestPointerLock()];case 2:n.sent(),n.label=3;case 3:return[2]}})}).call(this)}},{key:"takeScreenshot",value:function(){return tR(function(){var e;return tD(this,function(t){switch(t.label){case 0:if(null!==(e=this.activeView.getMainScene().activeCamera))return[3,2];return[4,(0,ez.sQ)("Cannot take screenshot: camera is null",this.soundPlayer)];case 1:return t.sent(),[2,!1];case 2:return u.S0.CreateScreenshot(this.engine,e,{precision:1}),[2,!0]}})}).call(this)}},{key:"takeVideoCapture",value:function(){return tR(function(){return tD(this,function(e){switch(e.label){case 0:if(!l.g.IsSupported(this.engine))return console.warn("Your browser does not support video recording!"),[2];if(null===this.videoRecorder&&(this.videoRecorder=new l.g(this.engine,{fps:60,recordChunckSize:3e6,mimeType:"video/webm;codecs=h264"})),!this.videoRecorder.isRecording)return[3,1];return this.videoRecorder.stopRecording(),[3,3];case 1:return[4,this.videoRecorder.startRecording("planetEngine.webm",Number(prompt("Enter video duration in seconds","10"))).then()];case 2:e.sent(),e.label=3;case 3:return[2]}})}).call(this)}},{key:"getCurrentUniverseCoordinates",value:function(e){var t=this.starSystemView.getStarSystem(),n=e.getAbsolutePosition(),r=t.getNearestOrbitalObject(n),i=(0,H.Ei)(r.model,t.model),a=r.getTransform().computeWorldMatrix(!0).clone().invert(),s=o.Pq.TransformCoordinates(n,a);s.length()<1.1*r.getBoundingRadius()&&s.copyFromFloats(0,0,5*r.getBoundingRadius());var u=e.absoluteRotationQuaternion,l=r.getTransform().absoluteRotationQuaternion.clone().invert(),c=u.multiply(l);return{type:"relative",universeObjectId:i,position:{x:s.x,y:s.y,z:s.z},rotation:{x:c.x,y:c.y,z:c.z,w:c.w}}}},{key:"generateSaveData",value:function(){return tR(function(){var e,t,n,r,i,a;return tD(this,function(s){switch(s.label){case 0:if(t=(e=this.starSystemView.getSpaceshipControls()).getSpaceship(),n=this.getCurrentUniverseCoordinates(e.getTransform()),r=t.isLandedAtFacility()?{type:"atStation",universeObjectId:n.universeObjectId}:n,i=this.activeView.getMainScene().activeCamera,a="",!i)return[3,2];return[4,u.S0.CreateScreenshotAsync(this.engine,i,{width:320,height:180,precision:.8})];case 1:a=s.sent(),s.label=2;case 2:return[2,{uuid:crypto.randomUUID(),timestamp:Date.now(),player:eW.a.Serialize(this.player),playerLocation:{type:"inSpaceship",shipId:t.id},shipLocations:tV({},t.id,r),thumbnail:a}]}})}).call(this)}},{key:"createManualSave",value:function(){return tR(function(){var e,t,n,r,i;return tD(this,function(a){switch(a.label){case 0:if(this.player.uuid===T.w.TUTORIAL_SAVE_UUID)return[2,!1];if(this.player.uuid!==T.w.SHARED_POSITION_SAVE_UUID)return[3,2];return this.player.uuid=crypto.randomUUID(),n=(t=this.player).setName,[4,(0,ez.TF)(e$.A.t("spaceStation:cmdrNameChangePrompt"),this.player.getName(),this.soundPlayer)];case 1:n.apply(t,[null!=(e=a.sent())?e:"Python"]),a.label=2;case 2:return[4,this.generateSaveData()];case 3:return i=(r=a.sent()).player.uuid,[2,this.backend.save.addManualSave(i,r)]}})}).call(this)}},{key:"setAutoSaveEnabled",value:function(e){this.isAutoSaveEnabled=e}},{key:"createAutoSave",value:function(){return tR(function(){var e,t;return tD(this,function(n){switch(n.label){case 0:if(!this.isAutoSaveEnabled)return[2];return[4,this.generateSaveData()];case 1:if((t=(e=n.sent()).player.uuid)===T.w.SHARED_POSITION_SAVE_UUID||t===T.w.TUTORIAL_SAVE_UUID)return[2];return[4,this.backend.save.addAutoSave(t,e)];case 2:return n.sent(),this.autoSaveTimerSeconds=0,[2]}})}).call(this)}},{key:"downloadSaveFile",value:function(){var e=this;this.engine.onEndFrameObservable.addOnce(function(){return tR(function(){var e,t,n,r;return tD(this,function(i){switch(i.label){case 0:return[4,this.generateSaveData()];case 1:return e=new Blob([JSON.stringify(i.sent())],{type:"application/json"}),t=URL.createObjectURL(e),(n=document.createElement("a")).href=t,r=new Date().toLocaleString().replace(/[^0-9a-zA-Z]/g,"_"),n.download="CMDR_".concat(this.player.getName(),"_").concat(r,".json"),n.click(),[2]}})}).call(e)})}},{key:"loadTutorial",value:function(e){var t=this;this.engine.onEndFrameObservable.addOnce(function(){return tR(function(){var t,n;return tD(this,function(r){switch(r.label){case 0:if(this.mainMenu.hide(),this.mainMenu.isVisible())return[3,2];return[4,this.createAutoSave()];case 1:r.sent(),r.label=2;case 2:if((t=e.getSaveData(this.backend.universe)).success)return[3,4];return console.error(t.error),[4,(0,ez.sQ)(e$.A.t("The tutorial save has errors and could not be loaded! Check the console for more information."),this.soundPlayer)];case 3:return r.sent(),[2];case 4:return[4,this.loadSave(t.value)];case 5:return r.sent(),this.player.uuid=T.w.TUTORIAL_SAVE_UUID,[4,this.resume()];case 6:return r.sent(),[4,this.tutorialLayer.setTutorial(e)];case 7:return r.sent(),this.starSystemView.setUIEnabled(!0),n=this.starSystemView.getStarSystem().getNearestOrbitalObject(this.starSystemView.scene.getActiveControls().getTransform().getAbsolutePosition()),(0,tO.t5)(this.starSystemView.getSpaceshipControls().getTransform(),n.getTransform().getAbsolutePosition(),this.starSystemView.scene.useRightHandedSystem),[2]}})}).call(t)})}},{key:"loadSave",value:function(e){return tR(function(){var t,n,r,i,a,s;return tD(this,function(o){switch(o.label){case 0:if(t=this,"inSpaceship"===(n=e.playerLocation).type)return[3,1];return r=n,[3,6];case 1:if(void 0!==(i=e.shipLocations[n.shipId]))return[3,3];return[4,(0,ez.sQ)("Player is in spaceship, but said spaceship does not exist. The loading procedure has been aborted.",this.soundPlayer)];case 2:case 4:return o.sent(),[2];case 3:if("inSpaceship"!==i.type)return[3,5];return[4,(0,ez.sQ)("Spaceship inside spaceships is not yet supported. The loading procedure has been aborted.",this.soundPlayer)];case 5:r=i,o.label=6;case 6:if(null!==(a=this.backend.universe.getSystemModelFromCoordinates(r.universeObjectId.systemCoordinates)))return[3,8];return[4,(0,ez.sQ)("Cannot load universe coordinates: system model not found. The loading procedure has been aborted.",this.soundPlayer)];case 7:return o.sent(),[2];case 8:return s=eW.a.Deserialize(e.player,this.backend.universe),this.player.copyFrom(s,this.backend.universe),this.player.discoveries.uploaded.forEach(function(e){return tR(function(){return tD(this,function(t){switch(t.label){case 0:return[4,this.backend.encyclopaedia.contributeDiscoveryIfNew(e)];case 1:return t.sent(),[2]}})}).call(t)}),[4,this.starSystemView.resetPlayer()];case 9:return o.sent(),this.engine.loadingScreen.displayLoadingUI(),[4,this.starSystemView.loadStarSystem(a)];case 10:if(o.sent(),0!==this.state)return[3,12];return[4,this.init(!0)];case 11:return o.sent(),[3,13];case 12:this.starSystemView.initStarSystem(),o.label=13;case 13:if("inSpaceship"!==n.type)return[3,15];return[4,this.starSystemView.switchToSpaceshipControls()];case 14:return o.sent(),[3,17];case 15:return[4,this.starSystemView.switchToCharacterControls()];case 16:o.sent(),o.label=17;case 17:return[4,this.loadLocation(r)];case 18:return o.sent(),this.starSystemView.getSpaceshipControls().getActiveCamera().getViewMatrix(!0),this.starSystemView.getStarSystem().applyFloatingOrigin(),this.engine.loadingScreen.hideLoadingUI(),null!==this.player.currentItinerary&&this.starSystemView.setSystemAsTarget(this.player.currentItinerary[1]),[2]}})}).call(this)}},{key:"loadLocation",value:function(e){return tR(function(){return tD(this,function(t){switch(t.label){case 0:if("relative"!==e.type)return[3,2];return[4,this.loadRelativeLocation(e)];case 1:return t.sent(),[3,4];case 2:if("atStation"!==e.type)return[3,4];return[4,this.loadAtStationLocation(e)];case 3:t.sent(),t.label=4;case 4:return[2]}})}).call(this)}},{key:"loadRelativeLocation",value:function(e){return tR(function(){var t,n,r,i,a,u;return tD(this,function(l){switch(l.label){case 0:if(t=this.starSystemView.scene.getActiveControls().getTransform(),void 0!==(r=(n=this.starSystemView.getStarSystem()).getOrbitalObjectById(e.universeObjectId.idInSystem)))return[3,2];return i=n.getStellarObjects()[0],(0,eZ.fE)(i,new o.Pq(0,0,4*i.getBoundingRadius()),new s.PT(0,0,0,1),t),[4,(0,ez.sQ)("The object you are trying to spawn near to could not be found. You will spawn around the first stellar object of the system instead.",this.soundPlayer)];case 1:return l.sent(),[2];case 2:return(0,eZ.fE)(r,new o.Pq(e.position.x,e.position.y,e.position.z),new s.PT(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),t),(a=o.Pq.Distance(t.getAbsolutePosition(),r.getTransform().getAbsolutePosition()))<1.1*(u=r.getBoundingRadius())&&(a<.1?t.position.addInPlace(new o.Pq(0,0,5*u)):t.position.scaleInPlace(1.1*u/a)),this.starSystemView.targetCursorLayer.setTarget(r),this.starSystemView.spaceShipLayer.setTarget(r.getTransform()),[2]}})}).call(this)}},{key:"loadAtStationLocation",value:function(e){return tR(function(){var t,n,r,i,a,u;return tD(this,function(l){switch(l.label){case 0:if(t=this.starSystemView.scene.getActiveControls().getTransform(),void 0!==(r=(n=this.starSystemView.getStarSystem()).getOrbitalObjectById(e.universeObjectId.idInSystem))&&(r.type===q.T.SPACE_STATION||r.type===q.T.SPACE_ELEVATOR))return[3,2];return i=n.getStellarObjects()[0],(0,eZ.fE)(i,new o.Pq(0,0,4*i.getBoundingRadius()),new s.PT(0,0,0,1),t),[4,(0,ez.sQ)("The space station you are trying to spawn at could not be found. You will spawn around the first stellar object of the system instead.",this.soundPlayer)];case 1:case 3:return l.sent(),[2];case 2:if(void 0!==(a=r.getLandingPadManager().getAvailableLandingPads().at(0)))return[3,4];return u=r,(0,eZ.fE)(u,new o.Pq(0,0,4*u.getBoundingRadius()),new s.PT(0,0,0,1),t),[4,(0,ez.sQ)("There are no available pads at the space station you are trying to spawn at. You have been moved outside of the station instead.",this.soundPlayer)];case 4:return this.starSystemView.getSpaceshipControls().getSpaceship().spawnOnPad(a),[2]}})}).call(this)}}],t=[{key:"CreateAsync",value:function(){return tR(function(){var e,t,s,u,l,f,d,v,p,y,m,b,g,S,w;return tD(this,function(E){switch(E.label){case 0:return(e=document.getElementById("renderer")).width=window.innerWidth,e.height=window.innerHeight,t=new eH.x(e),[4,G.New()];case 1:if((s=E.sent()).success)return[3,3];return[4,(0,ez.sQ)(s.error.message,new eF.bk)];case 2:throw E.sent(),s.error;case 3:if(u=s.value,!window.location.search.includes("webgpu"))return[3,5];return[4,a.J.CreateAsync(e,{twgslOptions:{wasmPath:new URL(n(14597),n.b).href,jsPath:new URL(n(9098),n.b).href},audioEngine:!0})];case 4:return f=E.sent(),[3,6];case 5:f=new i.N(e,!0,{preserveDrawingBuffer:!0,useHighPrecisionMatrix:!0,doNotHandleContextLost:!0,audioEngine:!0}),E.label=6;case 6:return(l=f).useReverseDepthBuffer=!0,l.loadingScreen=t,l.loadingScreen.displayLoadingUI(),window.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight,l.resize(!0)}),[4,(0,e$.L)()];case 7:return E.sent(),console.log("API: ".concat(l.isWebGPU?"WebGPU":"WebGL")),console.log("GPU detected: ".concat(l.extractDriverInfo())),[4,(0,h.A)()];case 8:var P,A;return d=E.sent(),console.log("Havok initialized"),v=eW.a.Default(u.universe),(p=new eQ.B(l)).useRightHandedSystem=!0,(y=new c.P(!0,d)).setVelocityLimits(1e4,1e4),p.enablePhysics(o.Pq.Zero(),y),(m=new tI.C).addProgressCallback(function(e,n){t.setProgress(e,n)}),[4,(P=p,(A=function(){var e,t,n;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:var i;return e=(i=function(){var e,t,n,r;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(i){switch(i.label){case 0:var a,s,o;return e=(a=function(){var e,t,n,r,i,a,s,o,u,l,c,h,f,d,v,p,y;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(b){switch(b.label){case 0:return t=(e=function(e,t,n){return null==m||m.startTask(),new Promise(function(r){var i=new Q.A(e,t,null,function(){r(i)},n)}).then(function(e){return null==m||m.completeTask(),e})})("OuchSound",eb),n=e("EngineRunningSound",em,{loop:!0}),r=e("MenuHoverSound",eo,{playbackRate:.5}),i=e("MenuSelectSound",eo),a=e("OpenPauseMenuSound",eo,{playbackRate:.75}),s=e("TargetLockSound",ey),o=e("TargetUnlockSound",ey,{playbackRate:.5}),u=e("EnableWarpDriveSound",eh,{playbackRate:2}),l=e("DisableWarpDriveSound",eu),c=e("AcceleratingWarpDriveSound",ef,{playbackRate:1,volume:.3,loop:!0}),h=e("DeceleratingWarpDriveSound",ev,{playbackRate:1,volume:.3,loop:!0}),f=e("HyperSpaceSound",ed,{playbackRate:1.5,volume:.25,loop:!0}),d=e("ThrusterSound",el,{playbackRate:1,volume:.5,loop:!0}),v=e("Success",ep),p=e("Error",ec),y={},[4,t];case 1:return y.ouch=b.sent(),[4,n];case 2:return y.engineRunning=b.sent(),[4,r];case 3:return y.menuHover=b.sent(),[4,i];case 4:return y.menuSelect=b.sent(),[4,a];case 5:return y.openPauseMenu=b.sent(),[4,s];case 6:return y.targetLock=b.sent(),[4,o];case 7:return y.targetUnlock=b.sent(),[4,u];case 8:return y.enableWarpDrive=b.sent(),[4,l];case 9:return y.disableWarpDrive=b.sent(),[4,c];case 10:return y.acceleratingWarpDrive=b.sent(),[4,h];case 11:return y.deceleratingWarpDrive=b.sent(),[4,f];case 12:return y.hyperSpace=b.sent(),[4,d];case 13:return y.thruster=b.sent(),[4,v];case 14:return y.success=b.sent(),[4,p];case 15:return[2,(y.error=b.sent(),y)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=a.apply(e,t);function s(e){eg(i,n,r,s,o,"next",e)}function o(e){eg(i,n,r,s,o,"throw",e)}s(void 0)})})(),t=(s=function(){var e,t,n,r,i,a,s,o,u,l,c,h,f,d,v;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(p){switch(p.label){case 0:return t=(e=function(e,t,n){return null==m||m.startTask(),new Promise(function(r){var i=new Q.A(e,t,null,function(){r(i)},n)}).then(function(e){return null==m||m.completeTask(),e})})("Wandering",z,{loop:!0,streaming:!0}),n=e("StraussBlueDanube",ei,{streaming:!0}),r=e("DeepRelaxation",K,{streaming:!0}),i=e("AtlanteanTwilight",Y,{streaming:!0}),a=e("InfinitePerspective",X,{streaming:!0}),s=e("ThatZenMoment",ea,{streaming:!0}),o=e("EchoesOfTime",J,{streaming:!0}),u=e("PeaceOfMind",et,{streaming:!0}),l=e("SpacialWinds",$,{streaming:!0}),c=e("Mesmerize",ee,{streaming:!0}),h=e("Reawakening",en,{streaming:!0}),f=e("EquatorialComplex",Z,{streaming:!0}),d=e("Soaring",er,{streaming:!0}),v={},[4,t];case 1:return v.wandering=p.sent(),[4,n];case 2:return v.straussBlueDanube=p.sent(),[4,r];case 3:return v.deepRelaxation=p.sent(),[4,i];case 4:return v.atlanteanTwilight=p.sent(),[4,a];case 5:return v.infinitePerspective=p.sent(),[4,s];case 6:return v.thatZenMoment=p.sent(),[4,o];case 7:return v.echoesOfTime=p.sent(),[4,u];case 8:return v.peaceOfMind=p.sent(),[4,l];case 9:return v.spacialWinds=p.sent(),[4,c];case 10:return v.mesmerize=p.sent(),[4,h];case 11:return v.reawakening=p.sent(),[4,f];case 12:return v.equatorialComplex=p.sent(),[4,d];case 13:return[2,(v.soaring=p.sent(),v)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=s.apply(e,t);function a(e){es(i,n,r,a,o,"next",e)}function o(e){es(i,n,r,a,o,"throw",e)}a(void 0)})})(),n=(o=function(){var e,t,n,r,i,a,s,o,u,l,c,h,f,d;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(v){switch(v.label){case 0:return t=(e=function(e,t,n){return null==m||m.startTask(),new Promise(function(r){var i=new Q.A(e,t,null,function(){r(i)},n)}).then(function(e){return null==m||m.completeTask(),e})})("InitiatingPlanetaryLanding",eA),n=e("LandingRequestGranted",ek),r=e("LandingComplete",eT),i=e("MissionComplete",eC),a=e("NewDiscovery",eI),s=e("CannotEngageWarpDrive",eS),o=e("WarpDriveEmergencyShutDown",eM),u=e("WarpDriveDisengaged",eO),l=e("EngagingWarpDrive",ew),c=e("FuelScoopingVoice",eE),h=e("FuelScoopingCompleteVoice",eP),f={},d={},[4,t];case 1:return d.initiatingPlanetaryLanding=v.sent(),[4,n];case 2:return d.landingRequestGranted=v.sent(),[4,r];case 3:return d.landingComplete=v.sent(),[4,i];case 4:return d.missionComplete=v.sent(),[4,a];case 5:return d.newDiscovery=v.sent(),[4,s];case 6:return d.cannotEngageWarpDrive=v.sent(),[4,o];case 7:return d.warpDriveEmergencyShutDown=v.sent(),[4,u];case 8:return d.warpDriveDisengaged=v.sent(),[4,l];case 9:return d.engagingWarpDrive=v.sent(),[4,c];case 10:return d.fuelScooping=v.sent(),[4,h];case 11:return[2,(f.charlotte=(d.fuelScoopingComplete=v.sent(),d),f)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=o.apply(e,t);function a(e){eR(i,n,r,a,s,"next",e)}function s(e){eR(i,n,r,a,s,"throw",e)}a(void 0)})})(),r={},[4,e];case 1:return r.sounds=i.sent(),[4,t];case 2:return r.musics=i.sent(),[4,n];case 3:return[2,(r.speakerVoiceLines=i.sent(),r)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=i.apply(e,t);function s(e){eL(a,n,r,s,o,"next",e)}function o(e){eL(a,n,r,s,o,"throw",e)}s(void 0)})})(),t=(0,eV.Q)(P,m),n={},[4,e];case 1:return n.audio=r.sent(),[4,t];case 2:return[2,(n.rendering=r.sent(),n)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=A.apply(e,t);function a(e){eD(i,n,r,a,s,"next",e)}function s(e){eD(i,n,r,a,s,"throw",e)}a(void 0)})})())];case 9:return b=E.sent(),g=new eF.Lr(b.audio.sounds),S=new ej._l(b.audio.speakerVoiceLines),[4,(w=new eq.l(p,v,l,y,u.encyclopaedia,u.universe,g,S,b.rendering)).resetPlayer()];case 10:return E.sent(),[4,(0,tt.t)()];case 11:if(null!==E.sent())return[3,13];return[4,(0,ez.sQ)(e$.A.t("notifications:unknownKeyboardLayout"),g)];case 12:E.sent(),E.label=13;case 13:return[2,new r(v,l,b,w,u,g,S)]}})})()}}],e&&tL(r.prototype,e),t&&tL(r,t),r}()},72581:function(e,t,n){n.d(t,{CL:()=>f,H7:()=>d,Pf:()=>h,Tl:()=>s,e$:()=>u,hQ:()=>l,lB:()=>o,oh:()=>v,rD:()=>c,t5:()=>a});var r=n(35543),i=n(36801);function a(e,t,n){e.lookAt(t),n&&e.rotate(r._0.Y,Math.PI)}function s(e,t){e.setAbsolutePosition(e.getAbsolutePosition().add(t)),e.computeWorldMatrix(!0)}function o(e,t,n,r){e.rotateAround(t,n,r),e.computeWorldMatrix(!0)}function u(e,t,n){e.rotate(t,n,r.$x.WORLD)}function l(e){if(null===e.rotationQuaternion)throw Error("Null quaternion for ".concat(e.name));return e.rotationQuaternion}function c(e,t){e.rotationQuaternion=t,e.computeWorldMatrix(!0)}function h(e,t){if(!t.equalsWithEpsilon(e.up,1e-7)){var n=e.up;u(e,i.Pq.Cross(t,n),-Math.acos(i.Pq.Dot(t,n)))}}function f(e,t){u(e,e.forward,t)}function d(e,t){u(e,e.right,t)}function v(e,t){u(e,e.up,t)}},50551:function(e,t,n){n.d(t,{h:()=>s}),n(2525);var r=n(28995);n(14381);var i=n(5933);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var s=function(e,t,n,s){var o=new r.ov(n.r,n.g,n.b,1),u=t.map(function(){return o});return(0,i.sh)(e,{points:function(e){if(Array.isArray(e))return a(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return a(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),colors:u,updatable:!1},s)}},35743:function(e,t,n){n.d(t,{_I:()=>i,ck:()=>a});var r=n(36801);function i(e,t){for(var n=Math.floor(e.length/16),r=Math.floor(n/t),i=new Float32Array(16*r),a=0;a<r;a++){var s=16*Math.floor(Math.random()*n);i.set(e.subarray(s,s+16),16*a)}return i}function a(e,t,n,i){if(void 0===e[0]||void 0===e[1]||void 0===e[2]||void 0===e[3]||void 0===e[4]||void 0===e[5]||void 0===e[6]||void 0===e[7]||void 0===e[8]||void 0===e[9]||void 0===e[10]||void 0===e[11]||void 0===e[12]||void 0===e[13]||void 0===e[14]||void 0===e[15])throw Error("Matrix is not defined");t.set(e[12],e[13],e[14]);var a=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);i.set(a,a,a);var s=r.uq.Identity();s.setRowFromFloats(0,e[0]/a,e[1]/a,e[2]/a,0),s.setRowFromFloats(1,e[4]/a,e[5]/a,e[6]/a,0),s.setRowFromFloats(2,e[8]/a,e[9]/a,e[10]/a,0),s.setRowFromFloats(3,0,0,0,1),n.copyFrom(r.PT.FromRotationMatrix(s))}},70612:function(e,t,n){function r(e,t,n){return(0x466f45d*e^0x127409f*t^0x4f9ffb7*n)%1e9}function i(e){var t=0x811c9dc5,n=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;t^=o,t=Math.imul(t,0x1000193)}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return(t>>>=0)/0xffffffff}n.d(t,{E:()=>r,g:()=>i})},13298:function(e,t,n){n.d(t,{E1:()=>o,Ew:()=>u,TF:()=>s,YX:()=>h,aJ:()=>l,cP:()=>a,f5:()=>c,p_:()=>function e(t,n){return 0===n?t:e(n,t%n)},qE:()=>i});var r=n(36801);function i(e,t,n){return Math.min(Math.max(e,t),n)}function a(e,t,n){return e>t?Math.max(t,e-n):Math.min(t,e+n)}function s(e,t,n){var r=Math.min(1,Math.max(0,(n-e)/(t-e)));return r*r*(3-2*r)}function o(e){return 2*Math.abs(e-Math.floor(e+.5))}function u(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)}function l(e,t,n,r){return t+(e-t)*Math.pow(2,-r/n)}function c(e,t,n,i,a){return r.PT.SlerpToRef(e,t,Math.pow(2,-i/n),a)}function h(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=t,i=0;i<n;i++){var a=e(r);if(1e-8>Math.abs(a))break;var s=(e(r+1e-4)-a)/1e-4;r-=a/s}return r}},56367:function(e,t,n){n.d(t,{E1:()=>a,F1:()=>o,GI:()=>i,N9:()=>s,kK:()=>u,tR:()=>l});var r=n(19461);function i(e){return e/r.fM}function a(e){return e*r.fM}function s(e){return e/r.C}function o(e){return e+273.15}function u(e){return e*r.AU}function l(e){return Math.PI/180*e}},97966:function(e,t,n){n.d(t,{$Q:()=>l,Ez:()=>u,fE:()=>o,og:()=>c});var r=n(14265),i=n(36801),a=n(72581);function s(e,t){var n=-1,r=t[0];if(void 0===r)throw Error("no bodieees !");var i=!0,a=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var l=o.value,c=e.subtract(l.getTransform().getAbsolutePosition()).length();(-1===n||c<n)&&(r=l,n=c)}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}return r}function o(e,t,n,r){var s=e.getBoundingRadius(),o=t.length(),u=Math.max(2*s,o),l=e.getTransform().getWorldMatrix(),c=i.Pq.TransformCoordinates(t.scale(u/(o+1e-4)),l);r.setAbsolutePosition(c);var h=e.getTransform().absoluteRotationQuaternion,f=n.multiply(h);(0,a.rD)(r,f)}function u(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,o=s(t.getTransform().getAbsolutePosition(),n.getStellarObjects());if(o===t)e.getTransform().setAbsolutePosition(t.getTransform().getAbsolutePosition().add(new i.Pq(0,.2,1).scaleInPlace(t.getBoundingRadius()*r)));else{var u=t.getTransform().getAbsolutePosition().subtract(o.getTransform().getAbsolutePosition()),l=u.length();u.scaleInPlace(1/l);var c=o.getTransform().getAbsolutePosition().add(u.scale(l-r*t.getBoundingRadius()));e.getTransform().setAbsolutePosition(c)}n.translateEverythingNow(e.getTransform().getAbsolutePosition().negate()),e.getTransform().setAbsolutePosition(i.Pq.Zero()),(0,a.t5)(e.getTransform(),t.getTransform().getAbsolutePosition(),e.getTransform().getScene().useRightHandedSystem)}function l(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,o=s(t.getTransform().getAbsolutePosition(),n.getStellarObjects());if(o===t)e.getTransform().setAbsolutePosition(t.getTransform().getAbsolutePosition().add(new i.Pq(0,.2,1).scaleInPlace(t.getBoundingRadius()*r)));else{var u=t.getTransform().getAbsolutePosition().subtract(o.getTransform().getAbsolutePosition()),l=u.length();u.scaleInPlace(1/l);var c=t.getTransform().up,h=i.Pq.Cross(u,c),f=o.getTransform().getAbsolutePosition().add(u.scale(l+1.5*t.getBoundingRadius())).add(h.scale(4*t.getBoundingRadius()));e.getTransform().setAbsolutePosition(f),(0,a.lB)(e.getTransform(),t.getTransform().getAbsolutePosition(),u,-Math.PI/16)}n.translateEverythingNow(e.getTransform().getAbsolutePosition().negate()),e.getTransform().setAbsolutePosition(i.Pq.Zero());var d=o.getTransform().getAbsolutePosition().subtract(t.getTransform().getAbsolutePosition()).normalize(),v=t.getTransform().getAbsolutePosition().add(d.scale(4*t.getBoundingRadius()));(0,a.t5)(e.getTransform(),v,e.getTransform().getScene().useRightHandedSystem),e.getTransform().computeWorldMatrix(!0),(0,a.CL)(e.getTransform(),-Math.PI/8),e.getActiveCamera().getViewMatrix(!0),e.getActiveCamera().getProjectionMatrix(!0)}function c(e,t,n){var a=e.asteroidField;if(null===a)throw Error("The body does not have an asteroid field");var o=e.getTransform().getAbsolutePosition(),u=(0,r.Lerp)(a.innerRadius,a.outerRadius,n),l=s(o,t.getStellarObjects()),c=o.subtract(l.getTransform().getAbsolutePosition()).normalize(),h=e.getTransform().up,f=i.Pq.Cross(c,h).normalize();return o.add(f.scale(u)).add(h.scale(a.patchThickness))}},8908:function(e,t,n){function r(e){var t=[];return e.children.forEach(function(n,r){"x"===r||"y"===r||t.push([r,e.name])}),t}function i(e,t){var n=[];if(e.children.forEach(function(e,r){if("x"!==r&&"y"!==r){var i,a,s=e.name;s=s.replace("key:",""),s=null!=(a=null==t||null==(i=t.get(s))?void 0:i.toUpperCase())?a:s,n.push([r,s])}}),void 0===n[0]||void 0===n[1]||void 0===n[2]||void 0===n[3])throw Error("DPadComposite keys are undefined");return[n[2],n[0],n[3],n[1]]}function a(){return[["x","pointerX"],["y","pointerY"]]}function s(e,t){var n,r,i=e.name;return i=i.replace("key:",""),i=null!=(r=null==t||null==(n=t.get(i))?void 0:n.toUpperCase())?r:i}function o(e,t){var n=[];return e.children.forEach(function(e,r){var i,a,s=e.name;s=s.replace("key:",""),s=null!=(a=null==t||null==(i=t.get(s))?void 0:i.toUpperCase())?a:s,n.push([r,s])}),n}function u(e,t){return e.action.bindings.map(function(e){return s(e.control,t)})}n.d(t,{Fd:()=>i,Jc:()=>r,Lc:()=>o,Xi:()=>s,hg:()=>u,qA:()=>a})}}]);