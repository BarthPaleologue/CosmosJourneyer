"use strict";(globalThis.webpackChunk_cosmos_journeyer_game=globalThis.webpackChunk_cosmos_journeyer_game||[]).push([["9039"],{43410(e,a,n){n.r(a),n.d(a,{Dispose:()=>v,DumpData:()=>y,DumpDataAsync:()=>h,DumpFramebuffer:()=>w,DumpTools:()=>D,EncodeImageAsync:()=>g});var r=n(45014),t=n(50209),s=n(85928),i=n(61973),o=n(23733),p=n(77507),l=n(66615),u=n(70813);let c=null;async function d(){let e=o.q.LastCreatedEngine?.createCanvas(100,100)??new OffscreenCanvas(100,100);e instanceof OffscreenCanvas&&p.V.Warn("DumpData: OffscreenCanvas will be used for dumping data. This may result in lossy alpha values.");let{ThinEngine:a}=await Promise.resolve().then(n.bind(n,83973));if(!a.IsSupported)throw Error("DumpData: No WebGL context available. Cannot dump data.");let r=new a(e,!1,{preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1});o.q.Instances.pop(),o.q.OnEnginesDisposedObservable.add(e=>{r&&e!==r&&!r.isDisposed&&0===o.q.Instances.length&&v()}),r.getCaps().parallelShaderCompile=void 0;let s=new t.J(r),{passPixelShader:i}=await n.e("6467").then(n.bind(n,83982)),l=new t.$({engine:r,name:i.name,fragmentShader:i.shader,samplerNames:["textureSampler"]});return{canvas:e,dumpEngine:{engine:r,renderer:s,wrapper:l}}}async function m(){return c||(c=d()),await c}class f{static async EncodeImageAsync(e,a,n,r,t,i){let o=await m(),p=o.dumpEngine;p.engine.setSize(a,n,!0);let l=p.engine.createRawTexture(e,a,n,5,!1,!t,1);return p.renderer.setViewport(),p.renderer.applyEffectWrapper(p.wrapper),p.wrapper.effect._bindTexture("textureSampler",l),p.renderer.draw(),l.dispose(),await new Promise((e,a)=>{s.S0.ToBlob(o.canvas,n=>{n?e(n):a(Error("EncodeImageAsync: Failed to convert canvas to blob."))},r,i)})}}(0,r.Cg)([u.Cx],f,"EncodeImageAsync",null);let g=f.EncodeImageAsync;async function w(e,a,n,r,t="image/png",s,i){let o=new Uint8Array((await n.readPixels(0,0,e,a)).buffer);y(e,a,o,r,t,s,!0,void 0,i)}async function h(e,a,n,r="image/png",t,o=!1,u=!1,c){if(n instanceof Float32Array){let e=new Uint8Array(n.length),a=n.length;for(;a--;){let r=n[a];e[a]=Math.round(255*(0,i.Clamp)(r))}n=e}let d=await f.EncodeImageAsync(n,e,a,r,o,c);void 0!==t&&s.S0.DownloadBlob(d,t),d.type!==r&&p.V.Warn(`DumpData: The requested mimeType '${r}' is not supported. The result has mimeType '${d.type}' instead.`);let m=await d.arrayBuffer();return u?m:`data:${r};base64,${(0,l.EL)(m)}`}function y(e,a,n,r,t="image/png",s,i=!1,o=!1,p){void 0!==s||r||(s=""),h(e,a,n,t,s,i,o,p).then(e=>{r&&r(e)})}function v(){c&&(c?.then(e=>{e.canvas instanceof HTMLCanvasElement&&e.canvas.remove(),e.dumpEngine&&(e.dumpEngine.engine.dispose(),e.dumpEngine.renderer.dispose(),e.dumpEngine.wrapper.dispose())}),c=null)}let D={DumpData:y,DumpDataAsync:h,DumpFramebuffer:w,Dispose:v};s.S0.DumpData=y,s.S0.DumpDataAsync=h,s.S0.DumpFramebuffer=w}}]);