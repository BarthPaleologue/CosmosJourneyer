/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["3036"],{67459:function(e,t,n){var r={"./en-US/common.json":"77025","./en-US/components.json":"27904","./en-US/explorationCenter.json":"33064","./en-US/mainMenu.json":"87226","./en-US/missions/asteroidField.json":"39351","./en-US/missions/common.json":"25977","./en-US/missions/flyBy.json":"48564","./en-US/missions/sightseeing.json":"81872","./en-US/missions/terminatorLanding.json":"77032","./en-US/notifications.json":"8256","./en-US/objectTypes.json":"3888","./en-US/orbit.json":"8316","./en-US/orbitalObject.json":"93794","./en-US/pauseMenu.json":"78245","./en-US/sidePanel.json":"73255","./en-US/spaceStation.json":"96690","./en-US/starMap.json":"61830","./en-US/tutorials/common.json":"95509","./en-US/tutorials/flightTutorial.json":"51752","./en-US/tutorials/fuelScooping.json":"25904","./en-US/tutorials/starMap.json":"27722","./en-US/tutorials/stationLanding.json":"87255","./en-US/units.json":"76355","./fr-FR/common.json":"39094","./fr-FR/components.json":"57103","./fr-FR/explorationCenter.json":"31385","./fr-FR/mainMenu.json":"84473","./fr-FR/missions/asteroidField.json":"50292","./fr-FR/missions/common.json":"29180","./fr-FR/missions/flyBy.json":"41083","./fr-FR/missions/sightseeing.json":"75503","./fr-FR/missions/terminatorLanding.json":"76083","./fr-FR/notifications.json":"5713","./fr-FR/objectTypes.json":"40597","./fr-FR/orbit.json":"40009","./fr-FR/orbitalObject.json":"40023","./fr-FR/pauseMenu.json":"81876","./fr-FR/sidePanel.json":"90506","./fr-FR/spaceStation.json":"47897","./fr-FR/starMap.json":"39","./fr-FR/tutorials/common.json":"87946","./fr-FR/tutorials/flightTutorial.json":"62687","./fr-FR/tutorials/fuelScooping.json":"9371","./fr-FR/tutorials/starMap.json":"58491","./fr-FR/tutorials/stationLanding.json":"8308","./fr-FR/units.json":"16402"};function o(e){return n(i(e))}function i(e){if(!n.o(r,e)){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=67459},89286:function(e,t,n){"use strict";n.d(t,{A:()=>s});var r=n(61741),o=n(85303);function i(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");a(this,"spaceExplorationData",new Map),a(this,"redundantDataPrice",100),a(this,"starSystemDatabase",void 0),this.starSystemDatabase=e}return e=[{key:"contributeDiscoveryIfNew",value:function(e){var t=JSON.stringify(e.objectId),n=this.spaceExplorationData.get(t);return void 0!==n&&n.discoveryTimestamp>=e.discoveryTimestamp?Promise.resolve(!1):(this.spaceExplorationData.set(t,e),Promise.resolve(!0))}},{key:"hasObjectBeenDiscovered",value:function(e){return Promise.resolve(this.spaceExplorationData.has(JSON.stringify(e)))}},{key:"evaluateTelluricPlanetMultiplier",value:function(e){var t=1;return null!==e.clouds&&(t+=1),null!==e.rings&&(t+=1),t}},{key:"evaluateTelluricSatelliteMultiplier",value:function(e){var t=.5;return null!==e.clouds&&(t+=1),t}},{key:"evaluateGasPlanetMultiplier",value:function(e){var t=1;return null!==e.rings&&(t+=1),t}},{key:"estimateDiscovery",value:function(e){var t;return(t=function(){var t,n,i,a;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(s){switch(s.label){case 0:return[4,this.hasObjectBeenDiscovered(e)];case 1:if(s.sent())return[2,(0,o.ok)(this.redundantDataPrice)];if(null===(t=this.starSystemDatabase.getObjectModelByUniverseId(e)))return[2,(0,o._q)("Object model not found for object ID")];switch(i=100*Math.hypot((n=this.starSystemDatabase.getSystemGalacticPosition(e.systemCoordinates)).x,n.y,n.z),t.type){case r.T.STAR:a=1;break;case r.T.NEUTRON_STAR:a=8;break;case r.T.BLACK_HOLE:a=10;break;case r.T.TELLURIC_PLANET:a=this.evaluateTelluricPlanetMultiplier(t);break;case r.T.TELLURIC_SATELLITE:a=this.evaluateTelluricSatelliteMultiplier(t);break;case r.T.GAS_PLANET:a=this.evaluateGasPlanetMultiplier(t);break;case r.T.MANDELBULB:case r.T.JULIA_SET:case r.T.MANDELBOX:case r.T.SIERPINSKI_PYRAMID:case r.T.MENGER_SPONGE:a=2;break;case r.T.SPACE_STATION:case r.T.SPACE_ELEVATOR:case r.T.DARK_KNIGHT:case r.T.CUSTOM:a=0}return[2,(0,o.ok)(Math.ceil(i*a))]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function s(e){i(a,r,o,s,l,"next",e)}function l(e){i(a,r,o,s,l,"throw",e)}s(void 0)})}).call(this)}},{key:"reset",value:function(){this.spaceExplorationData.clear()}},{key:"getBackendString",value:function(){return"Local"}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},4885:function(e,t,n){"use strict";n.d(t,{k:()=>s});var r=n(85303);function o(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){o(a,r,i,s,l,"next",e)}function l(e){o(a,r,i,s,l,"throw",e)}s(void 0)})}}function a(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var s=function(){var e;function t(){var e,n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");n=[],(e="backends")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n}return e=[{key:"contributeDiscoveryIfNew",value:function(e){return i(function(){var t,n,r,o,i,s,l,c,u;return a(this,function(a){switch(a.label){case 0:t=!1,n=!0,r=!1,o=void 0,a.label=1;case 1:a.trys.push([1,7,8,9]),i=this.backends[Symbol.iterator](),a.label=2;case 2:if(n=(s=i.next()).done)return[3,6];if(l=s.value,c=t)return[3,4];return[4,l.contributeDiscoveryIfNew(e)];case 3:c=a.sent(),a.label=4;case 4:t=c,a.label=5;case 5:return n=!0,[3,2];case 6:return[3,9];case 7:return u=a.sent(),r=!0,o=u,[3,9];case 8:try{n||null==i.return||i.return()}finally{if(r)throw o}return[7];case 9:return[2,t]}})}).call(this)}},{key:"hasObjectBeenDiscovered",value:function(e){return i(function(){var t,n,r,o,i,s;return a(this,function(a){switch(a.label){case 0:t=!0,n=!1,r=void 0,a.label=1;case 1:a.trys.push([1,6,7,8]),o=this.backends[Symbol.iterator](),a.label=2;case 2:if(t=(i=o.next()).done)return[3,5];return[4,i.value.hasObjectBeenDiscovered(e)];case 3:if(a.sent())return[2,!0];a.label=4;case 4:return t=!0,[3,2];case 5:return[3,8];case 6:return s=a.sent(),n=!0,r=s,[3,8];case 7:try{t||null==o.return||o.return()}finally{if(n)throw r}return[7];case 8:return[2,!1]}})}).call(this)}},{key:"estimateDiscovery",value:function(e){return i(function(){var t,n,o,i,s,l,c,u;return a(this,function(a){switch(a.label){case 0:t=0,n=!0,o=!1,i=void 0,a.label=1;case 1:a.trys.push([1,6,7,8]),s=this.backends[Symbol.iterator](),a.label=2;case 2:if(n=(l=s.next()).done)return[3,5];return[4,l.value.estimateDiscovery(e)];case 3:if(!(c=a.sent()).success)return[2,c];t+=c.value,a.label=4;case 4:return n=!0,[3,2];case 5:return[3,8];case 6:return u=a.sent(),o=!0,i=u,[3,8];case 7:try{n||null==s.return||s.return()}finally{if(o)throw i}return[7];case 8:return[2,(0,r.ok)(t)]}})}).call(this)}},{key:"getBackendString",value:function(){return this.backends.map(function(e){return e.getBackendString()}).join(", ")}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},74816:function(e,t,n){"use strict";n.d(t,{B:()=>s,x:()=>l});var r,o=n(87829),i=n(26274),a=n(7941),s=((r={})[r.NOT_IN_SYSTEM=0]="NOT_IN_SYSTEM",r[r.TOO_FAR_IN_SYSTEM=1]="TOO_FAR_IN_SYSTEM",r[r.CLOSE_ENOUGH=2]="CLOSE_ENOUGH",r),l=o.Ik({type:o.eu(a.H.ASTEROID_FIELD),objectId:i.RX,state:o.fc(s)})},70675:function(e,t,n){"use strict";n.d(t,{Q:()=>s,u:()=>l});var r,o=n(87829),i=n(26274),a=n(7941),s=((r={})[r.NOT_IN_SYSTEM=0]="NOT_IN_SYSTEM",r[r.TOO_FAR_IN_SYSTEM=1]="TOO_FAR_IN_SYSTEM",r[r.CLOSE_ENOUGH=2]="CLOSE_ENOUGH",r),l=o.Ik({type:o.eu(a.H.FLY_BY),objectId:i.RX,state:o.fc(s)})},7941:function(e,t,n){"use strict";n.d(t,{H:()=>o});var r,o=((r={})[r.FLY_BY=0]="FLY_BY",r[r.TERMINATOR_LANDING=1]="TERMINATOR_LANDING",r[r.ASTEROID_FIELD=2]="ASTEROID_FIELD",r[r.AND=1e3]="AND",r[r.OR=1001]="OR",r[r.XOR=1002]="XOR",r[r.SEQUENCE=1003]="SEQUENCE",r)},98510:function(e,t,n){"use strict";n.d(t,{E:()=>v,P:()=>m});var r,o=n(87829),i=n(26274),a=n(74816),s=n(70675),l=n(7941),c=n(44607),u=o.Ik({type:o.eu(l.H.OR),children:o.RZ(function(){return o.YO(p)})}),h=o.Ik({type:o.eu(l.H.AND),children:o.RZ(function(){return o.YO(p)})}),d=o.Ik({type:o.eu(l.H.XOR),children:o.RZ(function(){return o.YO(p)})}),f=o.Ik({type:o.eu(l.H.SEQUENCE),activeChildIndex:o.ai(),children:o.RZ(function(){return o.YO(p)})}),p=o.gM("type",[s.u,c.U,a.x,h,u,d,f]),m=((r={})[r.SIGHT_SEEING_FLY_BY=0]="SIGHT_SEEING_FLY_BY",r[r.SIGHT_SEEING_TERMINATOR_LANDING=1]="SIGHT_SEEING_TERMINATOR_LANDING",r[r.SIGHT_SEEING_ASTEROID_FIELD=2]="SIGHT_SEEING_ASTEROID_FIELD",r),v=o.Ik({missionGiver:i.RX,tree:p,reward:o.ai().default(0),type:o.fc(m).default(0)})},44607:function(e,t,n){"use strict";n.d(t,{U:()=>l,f:()=>s});var r,o=n(87829),i=n(26274),a=n(7941),s=((r={})[r.NOT_IN_SYSTEM=0]="NOT_IN_SYSTEM",r[r.TOO_FAR_IN_SYSTEM=1]="TOO_FAR_IN_SYSTEM",r[r.LANDED=2]="LANDED",r),l=o.Ik({type:o.eu(a.H.TERMINATOR_LANDING),objectId:i.RX,state:o.fc(s)})},97348:function(e,t,n){"use strict";n.d(t,{he:()=>h,Fs:()=>d,wk:()=>u});var r=n(87829),o=n(26274),i=r.Ik({objectId:o.RX,discoveryTimestamp:r.ai().default(0),explorerName:r.Yj().default("Unknown")}),a=n(98510),s=n(30020),l=n(59450),c=n(42503),u=r.Ik({flightCompleted:r.zM().default(!1),stationLandingCompleted:r.zM().default(!1),starMapCompleted:r.zM().default(!1),fuelScoopingCompleted:r.zM().default(!1)}),h=r.PV([c.Y,c.Y]).rest(c.Y),d=r.Ik({uuid:r.Yj().uuid().default(function(){return crypto.randomUUID()}),name:r.Yj().default("Python"),balance:r.ai().default(1e4),creationDate:r.Yj().default(function(){return new Date().toISOString()}),timePlayedSeconds:r.ai().default(0),visitedSystemHistory:r.YO(c.Y).default(function(){return[]}),discoveries:r.Ik({local:r.YO(i).default(function(){return[]}),uploaded:r.YO(i).default(function(){return[]})}).default(function(){return{local:[],uploaded:[]}}),currentItinerary:h.nullable().catch(null),systemBookmarks:r.YO(c.Y).default(function(){return[]}),currentMissions:r.YO(a.E).default(function(){return[]}),completedMissions:r.YO(a.E).default(function(){return[]}),spaceShips:r.YO(l.oC).default(function(){return[(0,l.Eq)()]}),spareSpaceshipComponents:r.YO(s.b).default(function(){return[]}),tutorials:u.default(function(){return{flightCompleted:!1,stationLandingCompleted:!1,starMapCompleted:!1,fuelScoopingCompleted:!1}})})},31704:function(e,t,n){"use strict";n.d(t,{E:()=>v});var r=n(44710),o=n(85303),i=n(13679),a=n(65617),s=n(26070);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){c(i,r,o,a,s,"next",e)}function s(e){c(i,r,o,a,s,"throw",e)}a(void 0)})}}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,t)||p(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}function m(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var v=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");d(this,"backend",void 0),d(this,"saves",void 0),this.backend=e,this.saves=t}return e=[{key:"getSavesForCmdr",value:function(e){return Promise.resolve(this.saves.get(e))}},{key:"save",value:function(){var e=Object.fromEntries(this.saves);return this.backend.write(JSON.stringify(e))}},{key:"deleteSaveForCmdr",value:function(e,t){var n=this.saves.get(e);if(void 0===n)return Promise.resolve(!1);var r=n.manual.findIndex(function(e){return e.uuid===t});-1!==r&&n.manual.splice(r,1);var o=n.auto.findIndex(function(e){return e.uuid===t});return -1!==o&&n.auto.splice(o,1),this.save()}},{key:"deleteCmdr",value:function(e){return this.saves.delete(e),this.save()}},{key:"getCmdrUuids",value:function(){var e;return Promise.resolve(function(e){if(Array.isArray(e))return l(e)}(e=this.saves.keys())||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}},{key:"addManualSave",value:function(e,t){return u(function(){var n,r;return m(this,function(o){switch(o.label){case 0:return[4,this.getSavesForCmdr(e)];case 1:if(void 0!==(r=null!=(n=o.sent())?n:{manual:[],auto:[]}).manual.find(function(e){return e.uuid===t.uuid}))return[2,Promise.resolve(!1)];return r.manual.unshift(t),this.saves.set(e,r),[2,this.save()]}})}).call(this)}},{key:"addAutoSave",value:function(e,t){return u(function(){var n,r;return m(this,function(o){switch(o.label){case 0:return[4,this.getSavesForCmdr(e)];case 1:if(void 0!==(r=null!=(n=o.sent())?n:{manual:[],auto:[]}).auto.find(function(e){return e.uuid===t.uuid}))return[2,Promise.resolve(!1)];for(r.auto.unshift(t);r.auto.length>i.w.MAX_AUTO_SAVES;)r.auto.pop();return this.saves.set(e,r),[2,this.save()]}})}).call(this)}},{key:"importSaves",value:function(e){return u(function(){var t,n,r,o,i,a,s,l,c,u,h,d,p,v,y,g,b,S,w,T,A;return m(this,function(m){switch(m.label){case 0:t=[],n=!0,r=!1,o=void 0;try{for(i=Object.entries(e)[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){l=(s=f(a.value,2))[0],c=s[1],u=!0,h=!1,d=void 0;try{for(p=c.manual[Symbol.iterator]();!(u=(v=p.next()).done);u=!0)y=v.value,t.push(this.addManualSave(l,y))}catch(e){h=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(h)throw d}}g=!0,b=!1,S=void 0;try{for(w=c.auto[Symbol.iterator]();!(g=(T=w.next()).done);g=!0)A=T.value,t.push(this.addAutoSave(l,A))}catch(e){b=!0,S=e}finally{try{g||null==w.return||w.return()}finally{if(b)throw S}}}}catch(e){r=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return[4,Promise.all(t)];case 1:return[2,m.sent().every(function(e){return e})]}})}).call(this)}},{key:"exportSaves",value:function(){return Promise.resolve(structuredClone(Object.fromEntries(this.saves)))}}],t=[{key:"CreateAsync",value:function(e,t,i){return u(function(){var l,c,u,h,p,v,y,g,b,S,w,T,A,P,C,I,E,R,N,O,L,x,M,_,k,D,j,F;return m(this,function(m){switch(m.label){case 0:return[4,e.read()];case 1:return l=m.sent(),[4,t.read()];case 2:if(c=m.sent(),null===(u=(0,r.z)(null!=l?l:"{}"))||null===(h=(0,r.z)(null!=c?c:"{}")))return[2,(0,o._q)({type:s.G.INVALID_JSON})];if(!(p=a.CN.safeParse(u)).success)return console.error(p.error),[2,(0,o._q)({type:s.G.INVALID_STORAGE_FORMAT,content:p.error})];if(!(v=a.CN.safeParse(h)).success)return console.error(v.error),[2,(0,o._q)({type:s.G.INVALID_STORAGE_FORMAT,content:v.error})];y=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){d(e,t,n[t])})}return e}({},p.data,v.data),g={},b={},S=!0,w=!1,T=void 0;try{for(A=Object.entries(y)[Symbol.iterator]();!(S=(P=A.next()).done);S=!0)I=(C=f(P.value,2))[0],E=C[1],R=(0,a.i9)(E.manual,i),N=(0,a.i9)(E.auto,i),g[I]={manual:R.validSaves,auto:N.validSaves},(R.invalidSaves.length>0||N.invalidSaves.length>0)&&(b[I]={manual:R.invalidSaves.map(function(e){return console.error("Corrupted manual save:",e.save,e.error),e.save}),auto:N.invalidSaves.map(function(e){return console.error("Corrupted auto save:",e.save,e.error),e.save})})}catch(e){w=!0,T=e}finally{try{S||null==A.return||A.return()}finally{if(w)throw T}}return[4,t.write(JSON.stringify(b))];case 3:m.sent(),Object.keys(b).length>0&&console.warn("Some save files could not be validated! Check the console for more information."),O=new Map,L=!0,x=!1,M=void 0;try{for(_=Object.entries(g)[Symbol.iterator]();!(L=(k=_.next()).done);L=!0)j=(D=f(k.value,2))[0],F=D[1],(0!==F.manual.length||0!==F.auto.length)&&O.set(j,F)}catch(e){x=!0,M=e}finally{try{L||null==_.return||_.return()}finally{if(x)throw M}}return[2,(0,o.ok)(new n(e,O))]}})})()}}],e&&h(n.prototype,e),t&&h(n,t),n}()},65617:function(e,t,n){"use strict";n.d(t,{CN:()=>S,c_:()=>v,i9:()=>g,fe:()=>y});var r=n(87829),o=n(87447),i=n(97348),a=n(59450),s=n(85303),l=n(26274),c=r.Ik({type:r.eu("relative"),universeObjectId:l.RX,position:r.Ik({x:r.ai().default(0),y:r.ai().default(0),z:r.ai().default(0)}),rotation:r.Ik({x:r.ai().default(0),y:r.ai().default(0),z:r.ai().default(0),w:r.ai().default(1)})}),u=r.Ik({type:r.eu("atStation"),universeObjectId:l.RX}),h=r.Ik({type:r.eu("onSurface"),universeObjectId:l.RX,latitude:r.ai().default(0),longitude:r.ai().default(0)}),d=r.Ik({type:r.eu("inSpaceship"),shipId:r.Yj().uuid()}),f=r.gM("type",[c,u,h,d]),p=n(96887),m=r.Ik({uuid:r.Yj().default(function(){return crypto.randomUUID()}),timestamp:r.ai().default(Date.now()),player:i.Fs,playerLocation:f,shipLocations:r.g1(r.Yj().uuid(),f),thumbnail:r.Yj().optional()});function v(e,t){var n=m.safeParse(e);if(n.success)return(0,s.ok)(n.data);var r=(0,p.pX)(e);return r.success?(0,s.ok)(function(e,t){var n,r,o,s,l,c,u,h=null!=(o=t.getSystemModelFromCoordinates(e.universeCoordinates.universeObjectId.starSystemCoordinates))?o:t.fallbackSystem;switch(e.universeCoordinates.universeObjectId.objectType){case p.nc.STELLAR_OBJECT:l=null==(s=h.stellarObjects.at(e.universeCoordinates.universeObjectId.objectIndex))?void 0:s.radius;break;case p.nc.PLANETARY_MASS_OBJECT:l=null==(s=h.planets.at(0))?void 0:s.radius;break;case p.nc.ANOMALY:l=null==(s=h.anomalies.at(e.universeCoordinates.universeObjectId.objectIndex))?void 0:s.radius;break;case p.nc.ORBITAL_FACILITY:s=h.orbitalFacilities.at(e.universeCoordinates.universeObjectId.objectIndex),l=4e4}null!=s||(s=h.stellarObjects[0]),null!=l||(l=h.stellarObjects[0].radius);var d=null!=(c=e.player.spaceShips[0])?c:(0,a.Eq)();u=void 0!==e.padNumber?{type:"atStation",universeObjectId:{systemCoordinates:h.coordinates,idInSystem:s.id}}:{type:"relative",universeObjectId:{systemCoordinates:h.coordinates,idInSystem:s.id},position:{x:0,y:0,z:-(3*l)},rotation:{x:0,y:0,z:0,w:1}};var f=i.he.safeParse(e.player.currentItinerary),m=null;return f.success&&(m=f.data),{uuid:crypto.randomUUID(),timestamp:e.timestamp,player:{uuid:e.player.uuid,name:e.player.name,balance:e.player.balance,creationDate:e.player.creationDate,timePlayedSeconds:e.player.timePlayedSeconds,visitedSystemHistory:e.player.visitedSystemHistory,discoveries:{local:[],uploaded:[]},currentItinerary:m,systemBookmarks:e.player.systemBookmarks,currentMissions:[],completedMissions:[],spaceShips:[(0,a.Eq)()],spareSpaceshipComponents:[],tutorials:e.player.tutorials},playerLocation:{type:"inSpaceship",shipId:d.id},shipLocations:(n={},r=d.id,r in n?Object.defineProperty(n,r,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[r]=u,n)}}(r.value,t)):r}function y(e){var t=window.location.href.split("?")[0];e.thumbnail;var n=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,["thumbnail"]),r=(0,o.W)(JSON.stringify(n));return null===r?null:new URL("".concat(t,"?save=").concat(r))}function g(e,t){var n=[],r=[],o=!0,i=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value,u=v(c,t);u.success?n.push(u.value):r.push({save:c,error:u.error})}}catch(e){i=!0,a=e}finally{try{o||null==l.return||l.return()}finally{if(i)throw a}}return{validSaves:n,invalidSaves:r}}var b=r.Ik({manual:r.YO(r.g1(r.Yj(),r.L5())),auto:r.YO(r.g1(r.Yj(),r.L5()))});b.extend({manual:r.YO(m),auto:r.YO(m)});var S=r.g1(r.Yj().uuid(),b)},80456:function(e,t,n){"use strict";n.d(t,{m:()=>o});function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");r(this,"key",void 0),this.key=e}return e=[{key:"write",value:function(e){return localStorage.setItem(this.key,e),Promise.resolve(!0)}},{key:"read",value:function(){return Promise.resolve(localStorage.getItem(this.key))}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();r(o,"SAVES_KEY","saves"),r(o,"BACKUP_SAVE_KEY","backupSaves")},96069:function(e,t,n){"use strict";n.d(t,{fy:()=>s,ml:()=>l,pt:()=>a});var r,o=n(81098),i=n(95901),a=((r={})[r.FEYNMAN_INTERSTELLAR=0]="FEYNMAN_INTERSTELLAR",r[r.CHURCH_OF_AWAKENING=1]="CHURCH_OF_AWAKENING",r[r.HUMAN_COMMONWEALTH=2]="HUMAN_COMMONWEALTH",r[r.SATORI_CONCORD=3]="SATORI_CONCORD",r);function s(e){switch(e){case 0:return"Feynman Interstellar";case 1:return"Church of Awakening";case 2:return"Human Commonwealth";case 3:return"Satori Concord"}}function l(e,t){var n=(0,i.QU)(e),r=(0,o.uniformRandBool)(n.materialistSpiritualist,t,249),a=(0,o.uniformRandBool)(n.capitalistCommunist,t,498);return r&&a?0:r&&!a?2:!r&&a?1:3}},30020:function(e,t,n){"use strict";n.d(t,{b:()=>u,q:()=>h});var r=n(87829),o=n(78706),i=n(45063),a=n(18511),s=n(28831),l=n(95293),c=n(54741),u=r.gM("type",[c.i,a.I,s.a,i.u,l.Y]);function h(e){switch(e){case"warpDrive":return o.A.t("components:warpDrive");case"fuelScoop":return o.A.t("components:fuelScoop");case"fuelTank":return o.A.t("components:fuelTank");case"discoveryScanner":return o.A.t("components:discoveryScanner");case"thrusters":return o.A.t("components:thrusters")}}},45063:function(e,t,n){"use strict";n.d(t,{q:()=>i,u:()=>o});var r=n(87829),o=r.Ik({type:r.eu("discoveryScanner"),size:r.ai(),quality:r.ai()});function i(e){return{relativeRange:e.size+e.quality/10}}},18511:function(e,t,n){"use strict";n.d(t,{I:()=>o,k:()=>i});var r=n(87829),o=r.Ik({type:r.eu("fuelScoop"),size:r.ai(),quality:r.ai()});function i(e){return{fuelPerSecond:e.size+e.quality/10}}},28831:function(e,t,n){"use strict";n.d(t,{a:()=>o,x:()=>i});var r=n(87829),o=r.Ik({type:r.eu("fuelTank"),size:r.ai(),quality:r.ai(),currentFuel01:r.ai().min(0).max(1)});function i(e){return{maxFuel:50*(e.size+e.quality/10)}}},74499:function(e,t,n){"use strict";n.d(t,{B:()=>s});var r=n(87829),o=n(45063),i=n(18511),a=n(28831),s=r.gM("type",[i.I,a.a,o.u])},95293:function(e,t,n){"use strict";n.d(t,{M:()=>i,Y:()=>o});var r=n(87829),o=r.Ik({type:r.eu("thrusters"),size:r.ai(),quality:r.ai()});function i(e){return{maxSpeed:1e3*(1+e.size/7+e.quality/20)}}},54741:function(e,t,n){"use strict";n.d(t,{Y:()=>a,i:()=>i});var r=n(87829),o=n(19461),i=r.Ik({type:r.eu("warpDrive"),size:r.ai(),quality:r.ai()});function a(e){return{maxSpeed:5*o.C*(e.size+e.quality/10),rangeLy:6*(e.size+e.quality/2)}}},49007:function(e,t,n){"use strict";n.d(t,{u:()=>u});var r=n(96069),o=n(87829),i=n(82480),a=o.Ik({parentIds:o.YO(i.PY),semiMajorAxis:o.ai(),eccentricity:o.ai().default(0),inclination:o.ai().default(0),longitudeOfAscendingNode:o.ai().default(0),argumentOfPeriapsis:o.ai().default(0),initialMeanAnomaly:o.ai().default(0),p:o.ai().default(2)}),s=n(61741),l=n(47759),c=n(19461);function u(){return{name:"Lone Star",coordinates:{starSectorX:5,starSectorY:-10,starSectorZ:8,localX:.5,localY:.2,localZ:.8},stellarObjects:[{id:"loneStar",name:"Lone Star",type:s.T.STAR,mass:c.G3,radius:c.Ow,blackBodyTemperature:5778,axialTilt:0,orbit:{parentIds:[],semiMajorAxis:0,eccentricity:0,inclination:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0,p:2},rings:null,siderealDaySeconds:0,seed:0}],planets:[],satellites:[],anomalies:[],orbitalFacilities:[{id:"loneStarStation",name:"Lone Star Station",type:s.T.SPACE_STATION,mass:1,agricultureMix:[[1,l.fC.LENTIL]],population:1e6,axialTilt:0,orbit:a.parse({parentIds:["loneStar"],semiMajorAxis:10*c.Ow}),seed:0,faction:r.pt.SATORI_CONCORD,energyConsumptionPerCapitaKWh:1e3,solarPanelEfficiency:.4,siderealDaySeconds:0,starSystemCoordinates:{starSectorX:5,starSectorY:-10,starSectorZ:8,localX:.5,localY:.2,localZ:.8},populationDensity:1e3,nbHydroponicLayers:10}]}}},75312:function(e,t,n){"use strict";n.d(t,{o:()=>o});var r=n(19461);function o(e,t,n,o){return{layerRadius:e+t,smoothness:.7,specularPower:2,frequency:4,detailFrequency:12,coverage:.75*Math.exp(-n*o/r.th),sharpness:2.5,color:{r:.8,g:.8,b:.8},worleySpeed:5e-4,detailSpeed:.003}}},82480:function(e,t,n){"use strict";n.d(t,{KC:()=>a,PY:()=>i,V4:()=>s});var r=n(87829),o=n(61741),i=r.Yj();function a(e,t,n){var r=(0,o.J)(t);return"[".concat(e.join("|"),"]->").concat(r).concat(n)}function s(e,t){return e===t}},61741:function(e,t,n){"use strict";n.d(t,{J:()=>i,T:()=>o});var r,o=((r={})[r.STAR=0]="STAR",r[r.NEUTRON_STAR=1]="NEUTRON_STAR",r[r.BLACK_HOLE=2]="BLACK_HOLE",r[r.TELLURIC_PLANET=1e3]="TELLURIC_PLANET",r[r.TELLURIC_SATELLITE=1001]="TELLURIC_SATELLITE",r[r.GAS_PLANET=1002]="GAS_PLANET",r[r.MANDELBULB=2e3]="MANDELBULB",r[r.JULIA_SET=2001]="JULIA_SET",r[r.MANDELBOX=2002]="MANDELBOX",r[r.SIERPINSKI_PYRAMID=2003]="SIERPINSKI_PYRAMID",r[r.MENGER_SPONGE=2004]="MENGER_SPONGE",r[r.DARK_KNIGHT=2005]="DARK_KNIGHT",r[r.SPACE_STATION=3e3]="SPACE_STATION",r[r.SPACE_ELEVATOR=3001]="SPACE_ELEVATOR",r[r.CUSTOM=4242]="CUSTOM",r);function i(e){switch(e){case 0:return"star";case 1:return"neutronStar";case 2:return"blackHole";case 1e3:return"telluricPlanet";case 1001:return"telluricSatellite";case 1002:return"gasPlanet";case 2e3:return"mandelbulb";case 2001:return"juliaSet";case 2002:return"mandelbox";case 2003:return"sierpinskiPyramid";case 2004:return"mengerSponge";case 2005:return"darkKnight";case 3e3:return"spaceStation";case 3001:return"spaceElevator";case 4242:return"custom"}}},47263:function(e,t,n){"use strict";n.d(t,{P:()=>o});var r=n(81098);function o(e,t){var n=e*(0,r.randRange)(1.8,2.2,t,1400),o=e*Math.max(.2,(0,r.normalRandom)(1,.5,t,1405)),i=(0,r.randRange)(.7,1.2,t,1430)/255;return{innerRadius:n,outerRadius:n+o,type:"procedural",seed:(0,r.randRange)(-1,1,t,1440),frequency:10,albedo:{r:120*i,g:112*i,b:104*i}}}},6408:function(e,t,n){"use strict";n.d(t,{S:()=>s});var r=n(61741),o=n(19461),i=n(56367);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e){return{type:r.T.DARK_KNIGHT,id:"darkKnight",name:"Dark Knight",axialTilt:0,siderealDaySeconds:0,radius:1e5,mass:o.jm,orbit:{parentIds:function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return a(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),argumentOfPeriapsis:0,eccentricity:0,p:1,inclination:0,longitudeOfAscendingNode:0,semiMajorAxis:(0,i.kK)(100),initialMeanAnomaly:0}}}},27746:function(e,t,n){"use strict";n.d(t,{h:()=>u});var r=n(81098),o=n(61741),i=n(71980),a=n(19223),s=n(32220),l=n(13298),c=n(56367);function u(e,t,n,u){var h=(0,s.p)(t),d=(0,i.M)({h:360*h(a.G.ACCENT_COLOR),s:.5*h(a.G.ACCENT_COLOR+123),v:.8}),f=15e9*h(a.G.ORBIT),p=(0,l.qE)(.5,3,(0,r.normalRandom)(1,.3,h,a.G.ORBIT+80)),m={parentIds:u.map(function(e){return e.id}),semiMajorAxis:f,p:p,inclination:(0,c.tR)((0,r.normalRandom)(90,20,h,a.G.ORBIT+160)),eccentricity:(0,r.randRange)(.1,.9,h,a.G.ORBIT+240),longitudeOfAscendingNode:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+320),argumentOfPeriapsis:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+400),initialMeanAnomaly:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+480)},v=(0,r.normalRandom)(0,.4,h,a.G.AXIAL_TILT);return{type:o.T.JULIA_SET,id:e,name:n,radius:1e6,orbit:m,mass:10,siderealDaySeconds:0,axialTilt:v,accentColor:d}}},23523:function(e,t,n){"use strict";n.d(t,{c:()=>u});var r=n(81098),o=n(61741),i=n(71980),a=n(19223),s=n(32220),l=n(13298),c=n(56367);function u(e,t,n,u){var h=(0,s.p)(t),d=(0,r.randRange)(0,1,h,a.G.POWER),f=(0,r.randRange)(1,1.5,h,a.G.POWER+1),p=(0,i.M)({h:360*h(a.G.ACCENT_COLOR),s:.5*h(a.G.ACCENT_COLOR+123),v:.8}),m=15e9*h(a.G.ORBIT),v=(0,l.qE)(.5,3,(0,r.normalRandom)(1,.3,h,a.G.ORBIT+80)),y={parentIds:u.map(function(e){return e.id}),semiMajorAxis:m,p:v,inclination:(0,c.tR)((0,r.normalRandom)(90,20,h,a.G.ORBIT+160)),eccentricity:(0,r.randRange)(.1,.9,h,a.G.ORBIT+240),longitudeOfAscendingNode:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+320),argumentOfPeriapsis:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+400),initialMeanAnomaly:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+480)},g=(0,r.normalRandom)(0,.4,h,a.G.AXIAL_TILT);return{type:o.T.MANDELBOX,id:e,name:n,radius:2e5,mass:10,siderealDaySeconds:0,axialTilt:g,mr2:d,spread:f,color:p,orbit:y}}},36495:function(e,t,n){"use strict";n.d(t,{G:()=>u});var r=n(81098),o=n(61741),i=n(71980),a=n(19223),s=n(32220),l=n(13298),c=n(56367);function u(e,t,n,u){var h=(0,s.p)(t),d=(0,r.randRange)(7,10,h,a.G.POWER),f=(0,i.M)({h:360*h(a.G.ACCENT_COLOR),s:.5*h(a.G.ACCENT_COLOR+123),v:.8}),p=15e9*h(a.G.ORBIT),m=(0,l.qE)(.5,3,(0,r.normalRandom)(1,.3,h,a.G.ORBIT+80)),v={parentIds:u.map(function(e){return e.id}),semiMajorAxis:p,p:m,inclination:(0,c.tR)((0,r.normalRandom)(90,20,h,a.G.ORBIT+160)),eccentricity:(0,r.randRange)(.1,.9,h,a.G.ORBIT+240),longitudeOfAscendingNode:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+320),argumentOfPeriapsis:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+400),initialMeanAnomaly:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+480)},y=(0,r.normalRandom)(0,.4,h,a.G.AXIAL_TILT);return{type:o.T.MANDELBULB,id:e,name:n,radius:1e6,mass:10,siderealDaySeconds:0,axialTilt:y,accentColor:f,power:d,orbit:v}}},6961:function(e,t,n){"use strict";n.d(t,{w:()=>u});var r=n(81098),o=n(61741),i=n(71980),a=n(19223),s=n(32220),l=n(13298),c=n(56367);function u(e,t,n,u){var h=(0,s.p)(t),d=(0,i.M)({h:360*h(a.G.ACCENT_COLOR),s:.5*h(a.G.ACCENT_COLOR+123),v:.8}),f=15e9*h(a.G.ORBIT),p=(0,l.qE)(.5,3,(0,r.normalRandom)(1,.3,h,a.G.ORBIT+80)),m={parentIds:u.map(function(e){return e.id}),semiMajorAxis:f,p:p,inclination:(0,c.tR)((0,r.normalRandom)(90,20,h,a.G.ORBIT+160)),eccentricity:(0,r.randRange)(.1,.9,h,a.G.ORBIT+240),longitudeOfAscendingNode:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+320),argumentOfPeriapsis:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+400),initialMeanAnomaly:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+480)},v=(0,r.normalRandom)(0,.4,h,a.G.AXIAL_TILT);return{type:o.T.MENGER_SPONGE,id:e,name:n,radius:2e5,mass:10,siderealDaySeconds:0,axialTilt:v,color:d,orbit:m}}},2888:function(e,t,n){"use strict";n.d(t,{p:()=>u});var r=n(81098),o=n(61741),i=n(71980),a=n(19223),s=n(32220),l=n(13298),c=n(56367);function u(e,t,n,u){var h=(0,s.p)(t),d=(0,i.M)({h:360*h(a.G.ACCENT_COLOR),s:.5*h(a.G.ACCENT_COLOR+123),v:.8}),f=15e9*h(a.G.ORBIT),p=(0,l.qE)(.5,3,(0,r.normalRandom)(1,.3,h,a.G.ORBIT+80)),m={parentIds:u.map(function(e){return e.id}),semiMajorAxis:f,p:p,inclination:(0,c.tR)((0,r.normalRandom)(90,20,h,a.G.ORBIT+160)),eccentricity:(0,r.randRange)(.1,.9,h,a.G.ORBIT+240),longitudeOfAscendingNode:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+320),argumentOfPeriapsis:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+400),initialMeanAnomaly:(0,r.randRange)(0,2*Math.PI,h,a.G.ORBIT+480)},v=(0,r.normalRandom)(0,.4,h,a.G.AXIAL_TILT);return{type:o.T.SIERPINSKI_PYRAMID,id:e,name:n,radius:2e5,accentColor:d,orbit:m,mass:10,siderealDaySeconds:0,axialTilt:v}}},63880:function(e,t,n){"use strict";n.d(t,{p:()=>d});var r=n(81098),o=n(71980),i=n(19223),a=n(32220),s=n(19461),l=n(56367),c=n(13679),u=n(61741),h=n(47263);function d(e,t,n,d){var f=(0,a.p)(t),p=(0,r.randRangeInt)(4*c.w.EARTH_RADIUS,20*c.w.EARTH_RADIUS,f,i.G.RADIUS),m=15e9*f(i.G.ORBIT),v=0,y=0;if(d.length>0){m+=1.5*d.reduce(function(e,t){return Math.max(e,t.radius)},0);var g=!0,b=!1,S=void 0;try{for(var w,T=d[Symbol.iterator]();!(g=(w=T.next()).done);g=!0){var A=w.value;v+=A.orbit.inclination,y+=A.axialTilt}}catch(e){b=!0,S=e}finally{try{g||null==T.return||T.return()}finally{if(b)throw S}}v/=d.length,y/=d.length}var P={parentIds:d.map(function(e){return e.id}),semiMajorAxis:m,p:2,inclination:v+y+(0,l.tR)((0,r.normalRandom)(0,5,f,i.G.ORBIT+10)),eccentricity:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0},C=s.kG*Math.pow(p/69911e3,3),I=(0,r.normalRandom)(0,.4,f,i.G.AXIAL_TILT),E=(0,r.uniformRandBool)(.8,f,i.G.RINGS)?(0,h.P)(p,f):null,R=(0,r.normalRandom)(240,30,f,70),N=(0,r.normalRandom)(0,180,f,72),O=(0,o.M)({h:R%360,s:(0,r.randRange)(.4,.9,f,72),v:(0,r.randRange)(.7,.9,f,73)}),L=(0,o.M)({h:N%360,s:(0,r.randRange)(.6,.9,f,74),v:(0,r.randRange)(0,.3,f,75)}),x=(0,o.M)({h:(R+-180)%360,s:(0,r.randRange)(.4,.9,f,76),v:(0,r.randRange)(.7,.9,f,77)}),M=(0,r.randRangeInt)(40,80,f,80)/10;return{type:u.T.GAS_PLANET,id:e,name:n,seed:t,radius:p,orbit:P,siderealDaySeconds:8640,axialTilt:I,mass:C,atmosphere:{pressure:s.th,greenHouseEffectFactor:.5},rings:E,colorPalette:{type:"procedural",color1:O,color2:L,color3:x,colorSharpness:M}}}},12940:function(e,t,n){"use strict";n.d(t,{S:()=>f});var r=n(81098),o=n(96069),i=n(61741),a=n(47759),s=n(19223),l=n(32220),c=n(13298),u=n(56367),h=n(96839),d=n(19413);function f(e,t,n,f,p){var m=(0,l.p)(t),v=(0,d.pN)(m,2756),y=p.reduce(function(e,t){var n,r,o=t.radius;return t.type===i.T.BLACK_HOLE&&(o+=t.accretionDiskRadius),(t.type===i.T.GAS_PLANET||t.type===i.T.TELLURIC_PLANET||t.type===i.T.STAR||t.type===i.T.NEUTRON_STAR)&&(o=null!=(r=null==(n=t.rings)?void 0:n.outerRadius)?r:o),o},0),g=(2+(0,c.qE)((0,r.normalRandom)(2,1,m,s.G.ORBIT),0,10))*y,b={parentIds:p.map(function(e){return e.id}),semiMajorAxis:g,p:2,inclination:(0,u.tR)((0,r.normalRandom)(0,10,m,s.G.ORBIT+10)),eccentricity:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0},S=2*m(s.G.AXIAL_TILT)*Math.PI,w=(0,o.ml)(f,m),T=(0,h.s1)(a.U9.length,m,498).map(function(e,t){var n=a.U9[t];if(void 0===n)throw Error("CropTypes out of bound!");return[e,n]});return{type:i.T.SPACE_STATION,seed:t,starSystemCoordinates:n,id:e,name:v,orbit:b,mass:1,siderealDaySeconds:0,axialTilt:S,population:2e6,energyConsumptionPerCapitaKWh:4e4,populationDensity:4e3,agricultureMix:T,nbHydroponicLayers:10,faction:w,solarPanelEfficiency:.4}}},13542:function(e,t,n){"use strict";n.d(t,{p:()=>l});var r=n(81098),o=n(61741),i=n(19223),a=n(32220),s=n(81401);function l(e,t,n,l){var c=(0,a.p)(t),u=l.reduce(function(e,t){return Math.max(e,t.radius)},0),h=0===l.length?0:2*(u+1e6),d={parentIds:l.map(function(e){return e.id}),semiMajorAxis:l.length>0?h:0,eccentricity:0,p:2,inclination:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0},f=(0,s.kt)(1e6),p=(0,r.normalRandom)(0,.4,c,i.G.AXIAL_TILT),m=1e6*(0,r.normalRandom)(12,3,c,7777);return{type:o.T.BLACK_HOLE,id:e,name:n,radius:1e6,mass:f,blackBodyTemperature:7e3,siderealDaySeconds:15e-20,axialTilt:p,accretionDiskRadius:m,orbit:d}}},44904:function(e,t,n){"use strict";n.d(t,{z:()=>c});var r=n(81098),o=n(61741),i=n(47263),a=n(19223),s=n(32220),l=n(13298);function c(e,t,n,c){var u=(0,s.p)(t),h=(0,l.qE)(.0014,30,(0,r.normalRandom)(.005,.005,u,a.G.SIDEREAL_DAY_SECONDS)),d=(0,r.randRangeInt)(2e5,5e9,u,a.G.TEMPERATURE),f=(0,l.qE)((0,r.normalRandom)(1e4,1e3,u,a.G.RADIUS),2e3,5e4),p=(0,r.randRange)(-Math.PI/6,Math.PI/6,u,a.G.DIPOLE_TILT),m=5e9*u(a.G.ORBIT),v={parentIds:c.map(function(e){return e.id}),semiMajorAxis:c.length>0?m:0,eccentricity:0,p:2,inclination:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0},y=(0,r.uniformRandBool)(.02,u,a.G.RINGS)?(0,i.P)(f,u):null;return{type:o.T.NEUTRON_STAR,id:e,name:n,seed:t,blackBodyTemperature:d,dipoleTilt:p,mass:19885e26,siderealDaySeconds:h,axialTilt:0,radius:f,orbit:v,rings:y}}},45643:function(e,t,n){"use strict";n.d(t,{aX:()=>h,uF:()=>u});var r=n(81098),o=n(61741),i=n(47263),a=n(19223),s=n(32220),l=n(96839),c=n(13679);function u(e,t,n,u){var h,d=(0,s.p)(t),f=(h=d(a.G.STELLAR_TYPE),(0,l.MA)([["M",.765],["K",.121],["G",.076],["F",.03],["A",.006],["B",.0013],["O",3e-7]],h)),p=function(e,t){switch(e){case"M":return(0,r.randRangeInt)(2100,3400,t,a.G.TEMPERATURE);case"K":return(0,r.randRangeInt)(3400,4900,t,a.G.TEMPERATURE);case"G":return(0,r.randRangeInt)(4900,5700,t,a.G.TEMPERATURE);case"F":return(0,r.randRangeInt)(5700,7200,t,a.G.TEMPERATURE);case"A":return(0,r.randRangeInt)(7200,9700,t,a.G.TEMPERATURE);case"B":return(0,r.randRangeInt)(9700,3e4,t,a.G.TEMPERATURE);case"O":return(0,r.randRangeInt)(3e4,52e3,t,a.G.TEMPERATURE)}}(f,d),m=function(e,t){var n=109*c.w.EARTH_RADIUS;switch(e){case"M":return(0,r.randRange)(.5,.7,t,a.G.RADIUS)*n;case"K":return(0,r.randRange)(.7,.9,t,a.G.RADIUS)*n;case"G":return(0,r.randRange)(.9,1.1,t,a.G.RADIUS)*n;case"F":return(0,r.randRange)(1.1,1.4,t,a.G.RADIUS)*n;case"A":return(0,r.randRange)(1.4,1.8,t,a.G.RADIUS)*n;case"B":return(0,r.randRange)(1.8,6.6,t,a.G.RADIUS)*n;case"O":return(0,r.randRange)(6.6,15,t,a.G.RADIUS)*n}}(f,d),v=5e9*d(a.G.ORBIT),y={parentIds:u.map(function(e){return e.id}),semiMajorAxis:u.length>0?v:0,eccentricity:0,p:2,inclination:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0},g=(0,r.uniformRandBool)(.2,d,a.G.RINGS)?(0,i.P)(m,d):null;return{type:o.T.STAR,id:e,name:n,seed:t,radius:m,orbit:y,blackBodyTemperature:p,mass:19885e26,siderealDaySeconds:86400,axialTilt:0,rings:g}}function h(e){if(e<3500)return"M";if(e<5e3)return"K";if(e<6e3)return"G";if(e<7500)return"F";if(e<1e4)return"A";else if(e<3e4)return"B";else return"O"}},91681:function(e,t,n){"use strict";n.d(t,{k:()=>p});var r=n(81098),o=n(75312),i=n(61741),a=n(47263),s=n(19223),l=n(32220),c=n(13298),u=n(19461),h=n(56545),d=n(56367),f=n(13679);function p(e,t,n,p){var m,v=(0,l.p)(t),y=Math.max(.3,(0,r.normalRandom)(1,.1,v,s.G.RADIUS))*f.w.EARTH_RADIUS,g=u.jm*Math.pow(y/6371e3,3),b=Math.max((0,r.normalRandom)(u.th,.2*u.th,v,s.G.PRESSURE),0);y<=.3*f.w.EARTH_RADIUS&&(b=0);var S=b>0?{pressure:b,greenHouseEffectFactor:.5}:null,w=Math.max(0,(0,r.normalRandom)((0,d.F1)(-20),30,v,80)),T=w+Math.exp(-b/u.th)*(0,r.randRangeInt)(30,200,v,81),A=(0,r.normalRandom)(0,.2,v,s.G.AXIAL_TILT),P=Math.max((0,r.normalRandom)(1,.3,v,s.G.WATER_AMOUNT),0),C=(0,h.ep)(b,w,T)?{depth:f.w.OCEAN_DEPTH*P*b/u.th}:null,I=null!==C?(0,o.o)(y+C.depth,f.w.CLOUD_LAYER_HEIGHT,P,b):null,E=p.reduce(function(e,t){return Math.max(e,t.radius)},0),R=2e9+15e9*v(s.G.ORBIT)+1.5*E,N=0,O=0,L=!0,x=!1,M=void 0;try{for(var _,k=p[Symbol.iterator]();!(L=(_=k.next()).done);L=!0){var D=_.value;N+=D.orbit.inclination,O+=D.axialTilt}}catch(e){x=!0,M=e}finally{try{L||null==k.return||k.return()}finally{if(x)throw M}}N/=p.length,O/=p.length;var j={parentIds:p.map(function(e){return e.id}),semiMajorAxis:R,p:2,inclination:N+O+(0,d.tR)((0,r.normalRandom)(0,5,v,s.G.ORBIT+10)),eccentricity:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0},F={continents_frequency:y/f.w.EARTH_RADIUS,continents_fragmentation:(0,c.qE)((0,r.normalRandom)(.65,.03,v,s.G.TERRAIN),0,.95),bumps_frequency:30*y/f.w.EARTH_RADIUS,max_bump_height:1500,max_mountain_height:1e4,continent_base_height:(null!=(m=null==C?void 0:C.depth)?m:0)*1.9,mountains_frequency:60*y/1e6},U=(0,r.uniformRandBool)(.6,v,s.G.RINGS)?(0,a.P)(y,v):null;return{type:i.T.TELLURIC_PLANET,id:e,seed:t,name:n,mass:g,axialTilt:A,siderealDaySeconds:8640,waterAmount:P,radius:y,temperature:{min:w,max:T},orbit:j,terrainSettings:F,rings:U,clouds:I,ocean:C,atmosphere:S}}},9694:function(e,t,n){"use strict";n.d(t,{l:()=>p});var r=n(81098),o=n(75312),i=n(61741),a=n(19223),s=n(32220),l=n(13298),c=n(19461),u=n(57404),h=n(56545),d=n(56367),f=n(13679);function p(e,t,n,p){var m,v=(0,s.p)(t),y=p.some(function(e){return e.type===i.T.TELLURIC_PLANET}),g=p.some(function(e){return e.type===i.T.GAS_PLANET});if(y)_=Math.max(.03,(0,r.normalRandom)(.06,.03,v,a.G.RADIUS))*f.w.EARTH_RADIUS;else if(g)_=Math.max(.03,(0,r.normalRandom)(.25,.15,v,a.G.RADIUS))*f.w.EARTH_RADIUS;else throw Error("Satellite is not around telluric or gas planet. Something is missing!");k=y?c.W4*Math.pow(_/1735e3,3):c.jm*Math.pow(_/6371e3,3);var b=Math.max((0,r.normalRandom)(c.th,.2*c.th,v,a.G.PRESSURE),0);(y||_<=.3*f.w.EARTH_RADIUS)&&(b=0);var S=Math.max(0,(0,r.normalRandom)((0,d.F1)(-20),30,v,80)),w=S+Math.exp(-b/c.th)*(0,r.randRangeInt)(30,200,v,81),T=8640,A=Math.max((0,r.normalRandom)(1,.3,v,a.G.WATER_AMOUNT),0),P=b>0?{pressure:b,greenHouseEffectFactor:.5}:null,C=(0,h.ep)(b,S,w)?{depth:f.w.OCEAN_DEPTH*A*b/c.th}:null,I=p.reduce(function(e,t){return Math.max(e,t.radius)},0),E=I*(0,l.qE)((0,r.normalRandom)(2,.3,v,a.G.ORBIT),1.2,3);E+=I*(0,l.qE)((0,r.normalRandom)(10,4,v,a.G.ORBIT),1,50)+2*I;var R=p.reduce(function(e,t){return e+t.mass},0),N=0,O=0,L=!0,x=!1,M=void 0;try{for(var _,k,D,j=p[Symbol.iterator]();!(L=(D=j.next()).done);L=!0){var F=D.value;N+=F.orbit.inclination,O+=F.axialTilt}}catch(e){x=!0,M=e}finally{try{L||null==j.return||j.return()}finally{if(x)throw M}}N/=p.length,O/=p.length;var U={parentIds:p.map(function(e){return e.id}),semiMajorAxis:E,p:2,inclination:N+O+(0,d.tR)((0,r.normalRandom)(0,5,v,a.G.ORBIT+10)),eccentricity:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0};T=(0,u.tQ)(U.semiMajorAxis,R);var G=null!==C?(0,o.o)(_+C.depth,f.w.CLOUD_LAYER_HEIGHT,A,b):null,B={continents_frequency:_/f.w.EARTH_RADIUS,continents_fragmentation:b>0?(0,l.qE)((0,r.normalRandom)(.65,.03,v,a.G.TERRAIN),0,.95):0,bumps_frequency:30*_/f.w.EARTH_RADIUS,max_bump_height:1500,max_mountain_height:1e4,continent_base_height:5e3+1.9*(null!=(m=null==C?void 0:C.depth)?m:0),mountains_frequency:60*_/1e6};return{type:i.T.TELLURIC_SATELLITE,id:e,seed:t,name:n,mass:k,radius:_,axialTilt:0,siderealDaySeconds:T,waterAmount:A,orbit:U,terrainSettings:B,temperature:{min:S,max:w},atmosphere:P,ocean:C,clouds:G}}},42503:function(e,t,n){"use strict";n.d(t,{F:()=>i,Y:()=>o});var r=n(87829),o=r.Ik({starSectorX:r.ai(),starSectorY:r.ai(),starSectorZ:r.ai(),localX:r.ai(),localY:r.ai(),localZ:r.ai()});function i(e,t){return e.starSectorX===t.starSectorX&&e.starSectorY===t.starSectorY&&e.starSectorZ===t.starSectorZ&&e.localX===t.localX&&e.localY===t.localY&&e.localZ===t.localZ}},65646:function(e,t,n){"use strict";n.d(t,{h:()=>j});var r=n(81098),o=n(23022),i=n(42503),a=n(32220),s=n(70612),l=n(13679),c=n(96839),u=n(63215);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var d=["Andromedae","Antliae","Apodis","Aquarii","Aquilae","Arae","Archimediae","Arietis","Arii","Aurigae","Azophi","Barnard","Berenices","Bo\xf6tis","Botes","Caeli","Cameliae","Camelopardalis","Cancri","Canesis","Cannonis","Canis","Carteri","Capricorni","Carinae","Cassini","Cassiopeiae","Centauri","Cephei","Ceti","Chamaeleontis","Circini","Columbae","Comae","Conway","Copernici","Coronae","Corvi","Crateris","Crucis","Curi","Cygni","Darwini","Delphini","Da Vinci","Delphini","Descartes","Dijkstrae","Doradus","Draconis","Drakes","Eich","Einsteini","Equulei","Eratosthenis","Eridani","Euclidae","Euleris","Europae","Fornacis","Gaussi","Galilei","Geminorum","Gruis","Hamiltoni","Hawking","Herculis","Herschel","Hopperae","Horologii","Hubblis","Huygentis","Hyades","Hydrae","Hydri","Hypatiae","Indi","Kapteyni","Kepleris","Lacertae","Leavitis","Leonis","Leporis","Librae","Lovelace","Lupi","Lyncis","Lyrae","Mensae","Messier","Microscopii","Mobii","Monocerotis","Muscae","Neumanni","Newtonis","Normae","Octantis","Ophiuchi","Orionis","Pavonis","Pegasi","Persei","Phoenicis","Pictoris","Piscium","Piscis","Ptolem\xe6i","Puppis","Pythagorae","Pyxidis","Reticuli","Saganis","Sagittae","Sagittarii","Scorpii","Sculptoris","Scuti","Serpentis","Sextantis","Tauri","Telescopii","Torvaldi","Trianguli","Tucanae","Turingi","Ursae","Velorum","Virginis","Volantis","Vulpeculae","Weierstrass","Zeno","Zimmerman"],f=["Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"],p=n(85303),m=n(82480),v=n(61741),y=n(27746),g=n(23523),b=n(36495),S=n(6961),w=n(2888),T=n(63880),A=n(96069),P=n(47759),C=n(57404),I=n(19413),E=n(12940),R=n(13542),N=n(44904),O=n(45643),L=n(91681),x=n(9694),M=n(78629);function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return _(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var j=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");k(this,"starSectorToCustomSystems",new Map),k(this,"coordinatesToCustomSystems",new Map),k(this,"coordinatesToSinglePlugins",new Map),k(this,"generalPlugins",[]),k(this,"universeDensity",void 0),k(this,"fallbackSystem",void 0);var n=(0,a.p)(l.w.UNIVERSE_SEED),r=0,i=(0,o.makeNoise3D)(function(){return n(r++)});this.universeDensity=function(e,t,n){return Math.pow(1-Math.abs(i(.2*e,.2*t,.2*n)),8)},this.fallbackSystem=e}return e=[{key:"starSectorToString",value:function(e,t,n){return"".concat(e,"|").concat(t,"|").concat(n)}},{key:"registerCustomSystem",value:function(e){var t=this.starSectorToString(e.coordinates.starSectorX,e.coordinates.starSectorY,e.coordinates.starSectorZ),n=this.starSectorToCustomSystems.get(t);void 0===n?this.starSectorToCustomSystems.set(t,[e]):n.push(e),this.coordinatesToCustomSystems.set(JSON.stringify(e.coordinates),e)}},{key:"getCustomSystemsFromSector",value:function(e,t,n){var r=this.starSectorToString(e,t,n),o=this.starSectorToCustomSystems.get(r);return void 0===o?[]:o}},{key:"getCustomSystemFromCoordinates",value:function(e){return this.coordinatesToCustomSystems.get(JSON.stringify(e))}},{key:"registerSinglePlugin",value:function(e,t){this.coordinatesToSinglePlugins.set(JSON.stringify(e),t)}},{key:"registerGeneralPlugin",value:function(e,t){this.generalPlugins.push({predicate:e,plugin:t})}},{key:"isSystemInHumanBubble",value:function(e){var t=this.getSystemGalacticPosition(e);return Math.hypot(t.x,t.y,t.z)<l.w.HUMAN_BUBBLE_RADIUS_LY}},{key:"getSystemModelFromCoordinates",value:function(e){if((0,i.F)(e,this.fallbackSystem.coordinates))return this.fallbackSystem;var t=this.getCustomSystemFromCoordinates(e);if(void 0!==t)return this.applyPlugins(t);var n=this.getGeneratedSystemCoordinatesInStarSector(e.starSectorX,e.starSectorY,e.starSectorZ).findIndex(function(t){return(0,i.F)(e,t)});if(-1===n)return null;var o=(0,a.p)((0,s.E)(e.starSectorX,e.starSectorY,e.starSectorZ)),M=(0,r.centeredRand)(o,1+n)*l.w.SEED_HALF_RANGE,_=(0,a.p)(M);return this.applyPlugins(function(e,t,n,o){var i,s,M,_,k=(M=d[Math.floor(e(0)*d.length)],_=f[Math.floor(e(1)*f.length)],"".concat(_," ").concat(M)),D=[],j=(i=e,s=0,(0,r.uniformRandBool)(6e-4,i,21)?v.T.BLACK_HOLE:(0,r.uniformRandBool)(.0026,i,21+s)?v.T.NEUTRON_STAR:v.T.STAR),F=(0,r.centeredRand)(e,21)*l.w.SEED_HALF_RANGE,U="".concat(k," ").concat(u.Sl.charAt(0).toUpperCase());switch(j){case v.T.STAR:D.push((0,O.uF)((0,m.KC)([],v.T.STAR,0),F,U,[]));break;case v.T.BLACK_HOLE:D.push((0,R.p)((0,m.KC)([],v.T.NEUTRON_STAR,0),F,U,[]));break;case v.T.NEUTRON_STAR:D.push((0,N.z)((0,m.KC)([],v.T.BLACK_HOLE,0),F,U,[]))}var G=[],B=[],H=D[0];if(void 0===H)throw Error("No stellar objects were generated for the star system");for(var Y=H.type===v.T.BLACK_HOLE?0:(0,r.randRangeInt)(0,7,e,30),W=0;W<Y;W++){var z=(0,r.uniformRandBool)(.5,e,400+W)?v.T.TELLURIC_PLANET:v.T.GAS_PLANET,q="".concat(k," ").concat(function(e){var t="",n=!0,r=!1,o=void 0;try{for(var i,a=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]][Symbol.iterator]();!(n=(i=a.next()).done);n=!0)for(var s,l=(s=i.value,function(e){if(Array.isArray(e))return e}(s)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(s,2)||function(e,t){if(e){if("string"==typeof e)return h(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}}(s,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=l[0],u=l[1];e>=c;)t+=u,e-=c}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return t}(W+1)),V=D.map(function(e){return e.id}),J=(0,r.centeredRand)(e,200+W)*l.w.SEED_HALF_RANGE;switch(z){case v.T.TELLURIC_PLANET:G.push((0,L.k)((0,m.KC)(V,v.T.TELLURIC_PLANET,W),J,q,D));break;case v.T.GAS_PLANET:G.push((0,T.p)((0,m.KC)(V,v.T.GAS_PLANET,W),J,q,D))}}G.forEach(function(e){for(var t=(0,a.p)(e.seed),n=e.type===v.T.GAS_PLANET?(0,r.randRangeInt)(0,3,t,10):(0,r.randRangeInt)(0,2,t,10),o=0;o<n;o++){var i="".concat(e.name).concat(u.Sl[o]),s=(0,r.centeredRand)(t,11+o)*l.w.SEED_HALF_RANGE,c=(0,m.KC)([e.id],v.T.TELLURIC_SATELLITE,o),h=(0,x.l)(c,s,i,[e]);B.push(h)}});for(var X=[],Z=(0,c.MA)([[0,.96],[1,.04]],e(666)),K=0;K<Z;K++){var Q=(0,r.centeredRand)(e,666+100*K)*l.w.SEED_HALF_RANGE,$=(0,c.MA)([[v.T.MANDELBULB,1],[v.T.MANDELBOX,1],[v.T.JULIA_SET,1],[v.T.SIERPINSKI_PYRAMID,1],[v.T.MENGER_SPONGE,1]],e(666+300*K)),ee="".concat(k," ").concat(u.i3.charAt(K).toUpperCase()),et=D.map(function(e){return e.id});switch($){case v.T.MANDELBULB:X.push((0,b.G)((0,m.KC)(et,v.T.MANDELBULB,K),Q,ee,[H]));break;case v.T.JULIA_SET:X.push((0,y.h)((0,m.KC)(et,v.T.JULIA_SET,K),Q,ee,[H]));break;case v.T.MANDELBOX:X.push((0,g.c)((0,m.KC)(et,v.T.MANDELBOX,K),Q,ee,[H]));break;case v.T.SIERPINSKI_PYRAMID:X.push((0,w.p)((0,m.KC)(et,v.T.SIERPINSKI_PYRAMID,K),Q,ee,[H]));break;case v.T.MENGER_SPONGE:X.push((0,S.w)((0,m.KC)(et,v.T.MENGER_SPONGE,K),Q,ee,[H]))}}var en=[];if(o){var er=new Map;G.forEach(function(e){var t;t=0+B.filter(function(t){return t.orbit.parentIds.includes(e.id)}).length+2*(null!==e.rings),er.set(e,t)});var eo=G.toSorted(function(e,t){var n,r,o=null!=(n=er.get(e))?n:0;return(null!=(r=er.get(t))?r:0)-o}),ei=Math.min(G.length,Math.max(1,e(77)*Math.floor(G.length/2)));eo.slice(0,ei).forEach(function(o){var i=(0,r.centeredRand)(e,2e3+en.length)*l.w.SEED_HALF_RANGE;if((0,r.uniformRandBool)(.5,e,657)&&o.type===v.T.TELLURIC_PLANET&&null===o.rings){var s,u,h,d,f,p,y,g,b,S,w=(s=(0,m.KC)([o.id],v.T.SPACE_ELEVATOR,0),u=(0,a.p)(i),h=(0,I.HX)(u,2756),d=o.siderealDaySeconds,f=(0,C.oe)(d,o.mass),p={parentIds:[o.id],semiMajorAxis:f,p:2,inclination:o.orbit.inclination+o.axialTilt,eccentricity:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0},y=f-o.radius,g=Math.PI/2,b=(0,A.ml)(n,u),S=(0,c.s1)(P.U9.length,u,498).map(function(e,t){var n=P.U9[t];if(void 0===n)throw Error("CropTypes out of bound!");return[e,n]}),{type:v.T.SPACE_ELEVATOR,seed:i,starSystemCoordinates:t,id:s,name:h,orbit:p,mass:1,siderealDaySeconds:d,axialTilt:g,tetherLength:y,population:2e6,energyConsumptionPerCapitaKWh:4e4,populationDensity:4e3,agricultureMix:S,nbHydroponicLayers:10,faction:b,solarPanelEfficiency:.4});en.push(w)}else{var T=(0,E.S)((0,m.KC)([o.id],v.T.SPACE_STATION,0),i,t,n,[o]);en.push(T)}})}if(!(0,p.EI)(D))throw Error("No stellar objects were generated for the star system");return{name:k,coordinates:t,stellarObjects:D,planets:G,satellites:B,anomalies:X,orbitalFacilities:en}}(_,e,this.getSystemGalacticPosition(e),this.isSystemInHumanBubble(e)))}},{key:"getGeneratedSystemCoordinatesInStarSector",value:function(e,t,n){return this.getGeneratedLocalPositionsInStarSector(e,t,n).map(function(r){return{starSectorX:e,starSectorY:t,starSectorZ:n,localX:r.x,localY:r.y,localZ:r.z}})}},{key:"getSystemCoordinatesInStarSector",value:function(e,t,n){var r=[],o=this.getGeneratedSystemCoordinatesInStarSector(e,t,n);r.push.apply(r,D(o));var i=this.getCustomSystemsFromSector(e,t,n).map(function(e){return e.coordinates});return r.push.apply(r,D(i)),this.fallbackSystem.coordinates.starSectorX===e&&this.fallbackSystem.coordinates.starSectorY===t&&this.fallbackSystem.coordinates.starSectorZ===n&&r.push(this.fallbackSystem.coordinates),r}},{key:"getSystemModelsInStarSector",value:function(e,t,n){var r=this,o=[],i=this.getGeneratedSystemCoordinatesInStarSector(e,t,n),a=!0,s=!1,l=void 0;try{for(var c,u=i[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var h=c.value,d=this.getSystemModelFromCoordinates(h);if(null===d)throw Error("Generated system not found in the database!");o.push(d)}}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}var f=this.getCustomSystemsFromSector(e,t,n).map(function(e){return r.applyPlugins(e)});return this.fallbackSystem.coordinates.starSectorX===e&&this.fallbackSystem.coordinates.starSectorY===t&&this.fallbackSystem.coordinates.starSectorZ===n&&f.push(this.fallbackSystem),o.concat(f)}},{key:"getSystemCoordinatesFromSeed",value:function(e,t,n,r){var o=this.getGeneratedLocalPositionsInStarSector(e,t,n).at(r);if(void 0===o)throw Error("Local position not found for seed ".concat(r," in star sector ").concat(e,", ").concat(t,", ").concat(n));return{starSectorX:e,starSectorY:t,starSectorZ:n,localX:o.x,localY:o.y,localZ:o.z}}},{key:"getSystemModelFromSeed",value:function(e,t,n,r){var o=this.getSystemCoordinatesFromSeed(e,t,n,r);return this.getSystemModelFromCoordinates(o)}},{key:"getSystemGalacticPosition",value:function(e){return{x:(e.starSectorX+e.localX)*l.w.STAR_SECTOR_SIZE,y:(e.starSectorY+e.localY)*l.w.STAR_SECTOR_SIZE,z:(e.starSectorZ+e.localZ)*l.w.STAR_SECTOR_SIZE}}},{key:"getGeneratedLocalPositionsInStarSector",value:function(e,t,n){for(var o=(0,a.p)((0,s.E)(e,t,n)),i=40*this.universeDensity(e,t,n)*o(0),l=[],c=0;c<i;c++){var u={x:(0,r.centeredRand)(o,10*c+1)/2,y:(0,r.centeredRand)(o,10*c+2)/2,z:(0,r.centeredRand)(o,10*c+3)/2};l.push(u)}return l}},{key:"getSystemLocalPositionsInStarSector",value:function(e,t,n){var r=[];r.push.apply(r,D(this.getGeneratedLocalPositionsInStarSector(e,t,n))),this.fallbackSystem.coordinates.starSectorX===e&&this.fallbackSystem.coordinates.starSectorY===t&&this.fallbackSystem.coordinates.starSectorZ===n&&r.push({x:this.fallbackSystem.coordinates.localX,y:this.fallbackSystem.coordinates.localY,z:this.fallbackSystem.coordinates.localZ});var o=this.getCustomSystemsFromSector(e,t,n),i=!0,a=!1,s=void 0;try{for(var l,c=o[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value;r.push({x:u.coordinates.localX,y:u.coordinates.localY,z:u.coordinates.localZ})}}catch(e){a=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}return r}},{key:"getSystemPositionsInStarSector",value:function(e,t,n){return this.getSystemLocalPositionsInStarSector(e,t,n).map(function(r){return{x:(r.x+e)*l.w.STAR_SECTOR_SIZE,y:(r.y+t)*l.w.STAR_SECTOR_SIZE,z:(r.z+n)*l.w.STAR_SECTOR_SIZE}})}},{key:"getObjectModelByUniverseId",value:function(e){var t=e.systemCoordinates,n=this.getSystemModelFromCoordinates(t);return null===n?null:(0,M.B)(e.idInSystem,n)}},{key:"applyPlugins",value:function(e){var t=e,n=this.coordinatesToSinglePlugins.get(JSON.stringify(e.coordinates));void 0!==n&&(t=n(e));var r=!0,o=!1,i=void 0;try{for(var a,s=this.generalPlugins[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;l.predicate(t)&&(t=l.plugin(t))}}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return t}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},78629:function(e,t,n){"use strict";function r(e,t){var n=t.stellarObjects.find(function(t){return t.id===e});if(void 0!==n)return n;var r=t.planets.find(function(t){return t.id===e});if(void 0!==r)return r;var o=t.satellites.find(function(t){return t.id===e});if(void 0!==o)return o;var i=t.anomalies.find(function(t){return t.id===e});if(void 0!==i)return i;var a=t.orbitalFacilities.find(function(t){return t.id===e});return void 0!==a?a:null}n.d(t,{B:()=>r})},26274:function(e,t,n){"use strict";n.d(t,{Ei:()=>l,RX:()=>a,bJ:()=>s});var r=n(87829),o=n(82480),i=n(42503),a=r.Ik({idInSystem:o.PY,systemCoordinates:i.Y});function s(e,t){return(0,o.V4)(e.idInSystem,t.idInSystem)&&(0,i.F)(e.systemCoordinates,t.systemCoordinates)}function l(e,t){return{systemCoordinates:t.coordinates,idInSystem:e.id}}},18076:function(e,t,n){"use strict";n.d(t,{C:()=>o});function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");r(this,"startedTaskCount",0),r(this,"completedTaskCount",0),r(this,"progressCallbacks",[])}return e=[{key:"addProgressCallback",value:function(e){this.progressCallbacks.push(e)}},{key:"startTask",value:function(){this.startedTaskCount++,this.notifyProgress()}},{key:"completeTask",value:function(){this.completedTaskCount++,this.notifyProgress()}},{key:"notifyProgress",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.progressCallbacks[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)(0,r.value)(this.startedTaskCount,this.completedTaskCount)}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},68730:function(e,t,n){"use strict";n.d(t,{jP:()=>f});var r=n(60333),o=n(92327),i=n(13679),a=n(80805);let s=n.p+"f2fdb10c3b9218e4.glb",l=n.p+"141b83eb4a6569d4.glb";function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,s,"next",e)}function s(e){u(i,r,o,a,s,"throw",e)}a(void 0)})}}function d(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function f(e,t){return h(function(){var n,u;return d(this,function(f){switch(f.label){case 0:var p,m;return[4,(p=e,m=t,h(function(){return d(this,function(e){return[2,Promise.all([(0,a.x)("Asteroid1",s,p,m),(0,a.x)("Asteroid2",l,p,m)])]})})())];case 1:return n=f.sent(),u=[.5,.7,.9,1.1,1.3,1.5,1.7,1.9,2.1],[2,n.flatMap(function(e){return function(e,t){var n=[],o=e.meshes[1];if(null!=(l=r.e)&&"undefined"!=typeof Symbol&&l[Symbol.hasInstance]?!l[Symbol.hasInstance](o):!(o instanceof l))throw Error("Asteroid root node is not a Mesh");o.setParent(null),o.scaling.scaleInPlace(100),o.bakeCurrentTransformIntoVertices(),n.push(o),n.push.apply(n,function(e){if(Array.isArray(e))return c(e)}(u=function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value,c=e.clone("asteroidClone".concat(n.length));c.makeGeometryUnique(),c.setParent(null),c.scaling.scaleInPlace(l),c.bakeCurrentTransformIntoVertices(),n.push(c)}}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(o,t))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(u)||function(e,t){if(e){if("string"==typeof e)return c(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}}(u)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var i=!0,a=!1,s=void 0;try{for(var l,u,h,d=n[Symbol.iterator]();!(i=(h=d.next()).done);i=!0)h.value.setEnabled(!1)}catch(e){a=!0,s=e}finally{try{i||null==d.return||d.return()}finally{if(a)throw s}}return e.addAllToScene(),n}(e,u)}).map(function(t){var n,r,a;return{mesh:t,physicsShape:(n=t,r=e,(a=new o.WH(n,r)).filterMembershipMask=i.H.ENVIRONMENT,a.filterCollideMask=i.H.DYNAMIC_OBJECTS,a)}})]}})})()}},72856:function(e,t,n){"use strict";n.d(t,{f:()=>s});var r=n(60333),o=n(80805);let i=n.p+"f87988fe634cbcad.glb";function a(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function s(e,t){var n;return(n=function(){var n,a,s,l,c,u,h;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(d){switch(d.label){case 0:return[4,(0,o.x)("Character",i,e,t)];case 1:var f,p;if(f=a=(n=d.sent()).rootNodes[0],null!=(p=r.e)&&"undefined"!=typeof Symbol&&p[Symbol.hasInstance]?!p[Symbol.hasInstance](f):!(f instanceof p))throw Error("Character root node is not a Mesh");a.isVisible=!1,s=!0,l=!1,c=void 0;try{for(u=a.getChildMeshes()[Symbol.iterator]();!(s=(h=u.next()).done);s=!0)h.value.isVisible=!1}catch(e){l=!0,c=e}finally{try{s||null==u.return||u.return()}finally{if(l)throw c}}return n.addAllToScene(),[2,{default:a}]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var i=n.apply(e,t);function s(e){a(i,r,o,s,l,"next",e)}function l(e){a(i,r,o,s,l,"throw",e)}s(void 0)})})()}},80805:function(e,t,n){"use strict";n.d(t,{x:()=>i});var r=n(41980);function o(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function i(e,t,n,i){var a;return(a=function(){var e;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(o){switch(o.label){case 0:return null==i||i.startTask(),[4,(0,r.uD)(t,n)];case 1:return e=o.sent(),null==i||i.completeTask(),[2,e]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=a.apply(e,t);function s(e){o(i,n,r,s,l,"next",e)}function l(e){o(i,n,r,s,l,"throw",e)}s(void 0)})})()}},26016:function(e,t,n){"use strict";n.d(t,{R:()=>s});var r=n(36801),o=n(60333),i=n(49917);function a(e,t,n){return e.scale(Math.cos(n)).addInPlace(r.Pq.Cross(t,e).scaleInPlace(Math.sin(n))).addInPlace(t.scale(r.Pq.Dot(t,e)*(1-Math.cos(n))))}function s(e,t){for(var n=2*t+1,s=new Float32Array(3*n),l=new Float32Array(3*n),c=new Uint32Array(3*(2*(t-1)+1)),u=new r.Pq(0,0,1),h=a(u,new r.Pq(0,1,0),.3*Math.PI),d=a(u,new r.Pq(0,1,0),-(.3*Math.PI)),f=0,p=0,m=0,v=1/t,y=0;y<t;y++){var g=.05*Math.sqrt((t-y)*v);s[f++]=-g,s[f++]=y*v,s[f++]=0,s[f++]=g,s[f++]=y*v,s[f++]=0,l[p++]=h.x,l[p++]=h.y,l[p++]=h.z,l[p++]=d.x,l[p++]=d.y,l[p++]=d.z,0!==y&&(c[m++]=2*(y-1),c[m++]=2*(y-1)+1,c[m++]=2*y,c[m++]=2*y,c[m++]=2*(y-1)+1,c[m++]=2*y+1)}s[f++]=0,s[f++]=t*v,s[f++]=0,l[p++]=0,l[p++]=0,l[p++]=1,c[m++]=2*(t-1),c[m++]=2*(t-1)+1,c[m++]=2*t;var b=new i.P;b.positions=s,b.normals=l,b.indices=c;var S=new o.e("grassBlade",e);return b.applyToMesh(S),S}},75540:function(e,t,n){"use strict";n.d(t,{y:()=>m});var r=n(78930),o=n(16739),i=n(36801),a=n(56072);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return s(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(d=function(){return!!e})()}var f={WORLD:"world",WORLD_VIEW:"worldView",WORLD_VIEW_PROJECTION:"worldViewProjection",VIEW:"view",PROJECTION:"projection",VIEW_PROJECTION:"viewProjection",TIME:"time",CAMERA_POSITION:"cameraPosition",PLAYER_POSITION:"playerPosition",PLANET_POSITION:"planetPosition",PLANET_WORLD:"planetWorld"},p={PERLIN_NOISE:"perlinNoise"},m=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,o){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var s,u,m,v="grassMaterial";r.M.ShadersStore["".concat(v,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\nprecision lowp int;\n\nuniform float time;\n\nuniform vec3 cameraPosition;\n\nvarying vec3 vPosition;\nvarying vec3 vPositionW;\n\nvarying vec3 vNormalW;\n\nvarying float vPlanetNdl;\n\n// This is used to render the grass blade to the depth buffer properly\n// (see https://forum.babylonjs.com/t/how-to-write-shadermaterial-to-depthrenderer/47227/3 and https://playground.babylonjs.com/#6GFJNR#161)\n#ifdef FORDEPTH\nvarying float vDepthMetric;\n#endif\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// taken from https://github.com/BarthPaleologue/feather/blob/main/assets/shaders/pbr/fragment.glsl\n// based on https://learnopengl.com/PBR/Lighting\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness) {\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness) {\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return num / denom;\n}\n\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n}\n\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\n}\n\nvec3 calculateLight(vec3 albedo, vec3 normal, float roughness, float metallic, vec3 lightDir, vec3 viewDir, vec3 lightColor) {\n    vec3 H = normalize(viewDir + lightDir);\n\n    vec3 F0 = vec3(0.04);\n    F0 = mix(F0, albedo, metallic);\n\n    vec3 F  = fresnelSchlick(max(dot(H, viewDir), 0.0), F0);\n    float NDF = DistributionGGX(normal, H, roughness);\n    float G   = GeometrySmith(normal, viewDir, lightDir, roughness);\n\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(normal, viewDir), 0.0) * max(dot(normal, lightDir), 0.0)  + 1.0; // + 1.0 to prevent division by zero at glancing angles\n    vec3 specular     = numerator / denominator;\n\n    vec3 kS = F;\n    vec3 kD = 1.0 - kS;\n\n    kD *= 1.0 - metallic;\n\n    vec3 radiance = lightColor;\n\n    float NdotL = max(dot(normal, lightDir), 0.0);\n\n    vec3 diffuse = kD * (albedo)/ PI;\n    return (diffuse + specular) * radiance * NdotL;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\nvoid main() {\n    #ifdef FORDEPTH\n    gl_FragColor = vec4(vDepthMetric, 0.0, 0.0, 1.0);\n    #else\n    vec3 baseColor = vec3(0.4, 0.8, 0.08);\n    vec3 tipColor = vec3(0.5, 0.5, 0.1);\n\n    vec3 albedo = 2.0 * mix(baseColor, tipColor, pow(vPosition.y, 4.0));\n\n    vec3 normalW = vNormalW;\n\n    float ao = 0.7 + 0.3 * (vPosition.y * vPosition.y);\n\n    vec3 Lo = vec3(0.0);\n\n    vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n    for(int i = 0; i < nbStars; i++) {\n        vec3 starPosition = star_positions[i];\n        vec3 lightDirectionW = normalize(starPosition - vPositionW);\n        float ndl = dot(normalW, lightDirectionW);\n        if (ndl < 0.0) {\n            normalW = -normalW;\n        }\n        Lo += calculateLight(albedo, normalW, 0.4, 0.0, lightDirectionW, viewDirectionW, star_colors[i]);\n    }\n\n    gl_FragColor = vec4(Lo * ao, 1.0);// apply color and lighting\n    #endif\n} ",r.M.ShadersStore["".concat(v,"VertexShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\nprecision lowp int;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 view;\nuniform mat4 projection;\n\nuniform vec3 cameraPosition;\nuniform vec3 playerPosition;\n\nuniform mat4 planetWorld;\nuniform vec3 planetPosition;\n\nuniform float time;\n\nuniform sampler2D perlinNoise;\n\nvarying vec3 vPosition;\nvarying vec3 vPositionW;\n\nvarying mat4 normalMatrix;\nvarying vec3 vNormalW;\n\nvarying float vPlanetNdl;\n\n// This is used to render the grass blade to the depth buffer properly\n// (see https://forum.babylonjs.com/t/how-to-write-shadermaterial-to-depthrenderer/47227/3 and https://playground.babylonjs.com/#6GFJNR#161)\n#ifdef FORDEPTH\nuniform vec2 depthValues;\nvarying float vDepthMetric;\n#endif\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// rotation using https://www.wikiwand.com/en/Rodrigues%27_rotation_formula\nvec3 rotateAround(vec3 vector, vec3 axis, float theta) {\n    // Please note that unit vector are required, i did not divided by the norms\n    return cos(theta) * vector + cross(axis, vector) * sin(theta) + axis * dot(axis, vector) * (1.0 - cos(theta));\n}\n\nfloat easeOut(float t, float a) {\n    return 1.0 - pow(1.0 - t, a);\n}\n\nfloat easeIn(float t, float alpha) {\n    return pow(t, alpha);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n#include<instancesDeclaration>\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\nvoid main() {\n    #include<instancesVertex>\n\n    mat4 worldMatrix = planetWorld * finalWorld;\n\n    // wind\n    vec3 objectWorld = worldMatrix[3].xyz;\n    float windStrength = texture2D(perlinNoise, objectWorld.xz * 0.007 + 0.1 * time).r;\n    float windDir = texture2D(perlinNoise, objectWorld.xz * 0.005 + 0.05 * time).r * 2.0 * 3.14;\n\n    float windLeanAngle = remap(windStrength, 0.0, 1.0, 0.25, 1.0);\n    windLeanAngle = easeIn(windLeanAngle, 2.0) * 0.75;\n\n    // curved grass blade\n    float leanAmount = 0.3;\n    float curveAmount = leanAmount * position.y;\n    float objectDistance = length(objectWorld - playerPosition);\n    float objectCameraDistance = length(objectWorld - cameraPosition);\n\n    // account for player presence\n    vec3 playerDirection = (objectWorld - playerPosition) / objectDistance;\n    float maxDistance = 3.0;\n    float distance01 = objectDistance / maxDistance;\n    float influence = 1.0 - smoothstep(0.0, 1.0, distance01);\n    curveAmount += influence;\n    curveAmount += windLeanAngle * smoothstep(0.2, 1.0, distance01);\n\n    vec3 leanAxis = rotateAround(vec3(1.0, 0.0, 0.0), vec3(0.0, 1.0, 0.0), windDir * smoothstep(0.2, 1.0, distance01));\n    leanAxis = normalize(mix(cross(vec3(0.0, 1.0, 0.0), playerDirection), leanAxis, smoothstep(0.0, 1.0, 1.0 - distance01)));\n\n    float scaling = 1.0 + 0.3 * (texture2D(perlinNoise, objectWorld.xz * 0.1).r * 2.0 - 1.0);\n    scaling *= 1.0 - smoothstep(70.0, 90.0, objectCameraDistance); // fade grass in the distance using scaling\n\n    //vec3 terrainNormal = normalize(vec3(worldMatrix * vec4(0.0, 1.0, 0.0, 0.0)));\n    vec3 sphereNormal = length(objectWorld - planetPosition) < 0.01 ? normalize(objectWorld - planetPosition) : vec3(0.0, 1.0, 0.0);\n    \n    // calculate the flatness of the terrain\n    //float flatness = max(dot(terrainNormal, sphereNormal), 0.0);\n\n    //scaling *= smoothstep(0.78, 0.8, flatness);\n\n    // taller grass bends more than short grass\n    curveAmount *= max(scaling, 0.3);\n\n    vec3 leaningPosition = scaling * rotateAround(position, leanAxis, curveAmount);\n\n    vec3 leaningNormal = rotateAround(normal, leanAxis, curveAmount);\n\n    vec4 worldPosition = worldMatrix * vec4(leaningPosition, 1.0);\n\n    //vec3 viewDir = normalize(cameraPosition - worldPosition);\n    //float viewDotNormal = abs(dot(viewDir, leaningNormal));\n    //float viewSpaceThickenFactor = easeOut(1.0 - viewDotNormal, 4.0);\n\n    //viewSpaceThickenFactor *= smoothstep(0.0, 0.2, viewDotNormal);\n\n    vec4 viewPosition = view * worldPosition;\n    //viewPosition.x += viewSpaceThickenFactor * leaningNormal.y;\n\n    vec4 outPosition = projection * viewPosition;\n    gl_Position = outPosition;\n\n    vPosition = position;\n    vPositionW = worldPosition.xyz;\n\n    vNormalW = vec3(worldMatrix * vec4(leaningNormal, 0.0));\n\n    vPlanetNdl = 0.0;\n    for(int i = 0; i < nbStars; i++) {\n        vec3 starPosition = star_positions[i];\n        vec3 lightDirectionW = normalize(starPosition - vPositionW);\n        float ndl = dot(sphereNormal, lightDirectionW);\n\n        vPlanetNdl = max(vPlanetNdl, ndl);\n    }\n\n    #ifdef FORDEPTH\n    vDepthMetric = (-gl_Position.z + depthValues.x) / (depthValues.y);\n    #endif\n}";var y=["#define INSTANCES"];o&&y.push("#define FORDEPTH");var g=h(Object.values(f)).concat(h(Object.values(a.T)));return o&&g.push("depthValues"),s=n,u=[v,e,v,{attributes:["position","normal"],uniforms:g,defines:y,samplers:h(Object.values(p))}],s=c(s),l(m=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,d()?Reflect.construct(s,u||[],c(this).constructor):s.apply(this,u)),"elapsedSeconds",0),l(m,"stars",[]),l(m,"playerPosition",i.Pq.Zero()),l(m,"scene",void 0),l(m,"planet",null),m.backFaceCulling=!1,m.setTexture("perlinNoise",t.seamlessPerlin),m.onBindObservable.add(function(){(0,a.G)(m.getEffect(),m.stars),m.getEffect().setVector3(f.PLAYER_POSITION,m.playerPosition),m.getEffect().setFloat(f.TIME,m.elapsedSeconds);var e=m.scene.activeCamera;if(null===e)throw Error("No active camera in the scene");m.getEffect().setVector3(f.CAMERA_POSITION,e.globalPosition),null!==m.planet&&(m.getEffect().setVector3(f.PLANET_POSITION,m.planet.getAbsolutePosition()),m.getEffect().setMatrix(f.PLANET_WORLD,m.planet.getWorldMatrix()))}),m.scene=e,m}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&u(n,e),t=[{key:"setPlanet",value:function(e){this.planet=e}},{key:"update",value:function(e,t,n){this.elapsedSeconds+=n,this.stars=e,this.playerPosition=t}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(o.B)},78100:function(e,t,n){"use strict";n.d(t,{t:()=>a});var r=n(36801),o=n(36044),i=n(49917);function a(e,t,n,a,s){var l=function(e,t,n,o){for(var a=[],s=[],l=[],c=[],u=e-t/2,h=e+t/2,d=0;d<=o;d++){var f=d*Math.PI*2/o,p=Math.cos(f),m=Math.sin(f),v=new r.Pq(u*p,-n/2,u*m);s.push(v.x,v.y,v.z),l.push(0,-1,0);var y=new r.Pq(h*p,-n/2,h*m);s.push(y.x,y.y,y.z),l.push(0,-1,0),c.push(d/o,0),c.push(d/o,1);var g=new r.Pq(u*p,n/2,u*m);s.push(g.x,g.y,g.z),l.push(0,1,0);var b=new r.Pq(h*p,n/2,h*m);if(s.push(b.x,b.y,b.z),l.push(0,1,0),c.push(d/o,1),c.push(d/o,0),s.push(y.x,y.y,y.z),l.push(p,0,m),s.push(b.x,b.y,b.z),l.push(p,0,m),c.push(d/o,0),c.push(d/o,1),s.push(v.x,v.y,v.z),l.push(-p,0,-m),s.push(g.x,g.y,g.z),l.push(-p,0,-m),c.push(d/o,1),c.push(d/o,0),0!==d){var S=8*(d-1)+0,w=8*d+0;a.push(w+1,S+1,S),a.push(w,w+1,S);var T=8*(d-1)+2,A=8*d+2;a.push(T,T+1,A+1),a.push(T,A+1,A);var P=8*(d-1)+4,C=8*d+4;a.push(C+1,P+1,P),a.push(C,C+1,P);var I=8*(d-1)+6,E=8*d+6;a.push(I,I+1,E+1),a.push(I,E+1,E)}}var R=new i.P;return R.indices=a,R.positions=s,R.normals=l,R.uvs=c,R}(e,t,n,a),c=new o.eaF("ring",s);return l.applyToMesh(c),c.convertToFlatShadedMesh(),c}},85630:function(e,t,n){"use strict";n.d(t,{R:()=>d});var r=n(78930),o=n(16739),i=n(35543),a=n(36801),s=n(60333),l=n(90718),c=n(9323),u=n(13298);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){var e;function t(e,n,i){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");h(this,"parent",null),h(this,"direction",void 0),h(this,"v1",void 0),h(this,"v2",void 0),h(this,"hyperTunnel",void 0),h(this,"warpConeMaterial",void 0),h(this,"tunnelDiameter",160),h(this,"elapsedSeconds",0),this.direction=e;var c=new a.Pq(Math.random(),Math.random(),Math.random()).normalize();c.subtractInPlace(this.direction.scale(this.direction.dot(c))).normalize();var u=a.Pq.Cross(this.direction,c).normalize();this.v1=c,this.v2=u;var d=[];d.push(new a.Pq(0,0,200));for(var f=0;f<100;f++)d.push(new a.Pq(0,500*Math.pow(f/100,4),-(800*f)/100));this.hyperTunnel=l.P.CreateTube("hyperTunnel",{radius:this.tunnelDiameter/2,path:d,sideOrientation:s.e.BACKSIDE,tessellation:128},n),r.M.ShadersStore.warpConeMaterialFragmentShader="precision lowp float;\n\nvarying vec3 vPosition;\nvarying vec2 vUV;\n\nuniform float time;\n\nuniform sampler2D warpNoise;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat smoothSharpener(float x, float s) {\n    float offset = 0.5 - (1.0 / s);\n    return smoothstep(offset, 1.0 - offset, x);\n}\n\nfloat perlin(vec2 uv, int nbOctaves) {\n    float value = 0.0;\n    float frequency = 1.0;\n    float decay = 1.0;\n    float totalAmplitude = 0.0;\n\n    for (int i = 0; i < nbOctaves; i++) {\n        totalAmplitude += decay;\n        value += texture2D(warpNoise, uv * frequency).r * decay;\n        frequency *= 2.0;\n        decay *= 0.5;\n    }\n\n    return value / totalAmplitude;\n}\n\nvoid main() {\n    vec2 samplePoint = 3.0 * vUV + vec2(0.0, time * 1.2);\n    vec2 densitySamplePoint = samplePoint / 3.0;\n    densitySamplePoint.y /= 2.0;\n\n    vec2 samplePoint2 = 4.0 * vUV.yx + vec2(time * 1.5, 0.0);\n    vec2 densitySamplePoint2 = samplePoint2 / 4.0;\n    densitySamplePoint2.x /= 2.0;\n\n    float noise = perlin(samplePoint, 4);\n    noise = pow(noise, 4.0);\n\n    float density1 = perlin(densitySamplePoint, 1);\n    density1 = smoothSharpener(density1, 8.0);\n\n    noise *= density1;\n\n    float noise2 = perlin(samplePoint2, 4);\n    noise2 = pow(noise2, 6.0);\n    noise2 = smoothstep(0.1, 1.0, noise2);\n\n    float density2 = perlin(densitySamplePoint2, 1);\n    density2 = smoothSharpener(density2, 8.0);\n\n    noise2 *= density2;\n\n    float brightEnd = 0.6 * smoothstep(0.2, 1.0, vUV.y);\n\n    float rays = pow(sin(vUV.x * 3.1415 * 4.0 + time), 4.0);\n    rays *= 0.2 + sin(time * 2.0) * 0.1;\n\n    vec3 finalColor = noise * vec3(1.2, 1.2, 2.0) * 3.0;\n\n    finalColor += noise2 * vec3(0.9, 1.0, 0.9);\n\n    finalColor = mix(finalColor, vec3(1.0, 1.0, 1.0), brightEnd);\n\n    finalColor += 0.5 * vec3(1.0, 0.9, 0.9) * rays;\n\n    gl_FragColor = vec4(finalColor, 1.0); // apply color and lighting\n} ",r.M.ShadersStore.warpConeMaterialVertexShader="precision lowp float;\n\nattribute vec3 position;\nattribute vec2 uv;\n\nuniform mat4 worldViewProjection;\n\nuniform float time;\n\nuniform sampler2D warpNoise;\n\nvarying vec3 vPosition;\nvarying vec2 vUV;\n\nfloat perlin(vec2 uv, int nbOctaves) {\n    float value = 0.0;\n    float frequency = 1.0;\n    float decay = 1.0;\n    float totalAmplitude = 0.0;\n\n    for (int i = 0; i < nbOctaves; i++) {\n        totalAmplitude += decay;\n        value += texture2D(warpNoise, uv * frequency).r * decay;\n        frequency *= 2.0;\n        decay *= 0.5;\n    }\n\n    return value / totalAmplitude;\n}\n\nvoid main() {\n\n    float noise = perlin(uv + vec2(0.0, 0.1 * time), 4);\n\n    vec3 shiftedPosition = position + vec3(noise * 30.0, 0.0, 0.0);\n\n    vec4 outPosition = worldViewProjection * vec4(shiftedPosition, 1.0);\n    gl_Position = outPosition;\n    vPosition = position;\n    vUV = uv;\n}",this.warpConeMaterial=new o.B("warpConeMaterial",n,"warpConeMaterial",{attributes:["position","uv"],uniforms:["worldViewProjection","time"],samplers:["warpNoise"]}),this.warpConeMaterial.setTexture("warpNoise",i.seamlessPerlin),this.hyperTunnel.material=this.warpConeMaterial}return e=[{key:"setParent",value:function(e){this.parent=e}},{key:"setEnabled",value:function(e){this.hyperTunnel.setEnabled(e)}},{key:"getTransform",value:function(){return this.hyperTunnel}},{key:"update",value:function(e){if(this.elapsedSeconds+=e,this.warpConeMaterial.setFloat("time",this.elapsedSeconds),null!==this.parent){this.hyperTunnel.position=this.parent.getAbsolutePosition(),this.hyperTunnel.rotate(i._0.Z,.005*Math.sin(2*Math.PI*.05*this.elapsedSeconds),i.$x.LOCAL);var t=this.parent.forward,n=this.getTransform().forward;if(!t.equalsWithEpsilon(n,.001)){var r=a.Pq.Cross(n,t),o=Math.acos((0,u.qE)(a.Pq.Dot(n,t),-1,1));(0,c.e$)(this.hyperTunnel,r,o)}}}},{key:"dispose",value:function(){this.hyperTunnel.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},70673:function(e,t,n){"use strict";n.d(t,{T:()=>a});var r=n(56182),o=n(32199),i=n(92771);function a(e){var t=new Uint8Array([0,0,0,0]);return new o.I(t,1,1,r.N.TEXTUREFORMAT_RGBA,e,!1,!1,i.g.NEAREST_SAMPLINGMODE)}},41397:function(e,t,n){"use strict";n.d(t,{U:()=>S});var r=n(35543),o=n(36801),i=n(90718),a=n(67450),s=n(52632),l=n(83266),c=n(32220),u=n(19461),h=n(56545),d=n(40634),f=n(30723),p=n(1134);function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}var g=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,r,o,i){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");a=t,s=["CylinderHabitatMaterial",i],a=m(a),(l=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,y()?Reflect.construct(a,s||[],m(this).constructor):a.apply(this,s))).mode=d.A.Material;var a,s,l,c=2*Math.PI*e/r,u=(0,p.$Z)("position"),h=(0,p.$Z)("normal"),f=(0,p.$Z)("uv"),v=(0,p.xz)(u),g=(0,p.lD)(v),b=(0,p.Lz)(),S=(0,p.yG)(b,u),w=(0,p.wr)(b,h),T=(0,p.jb)((0,p.f)(1),(0,p.PM)((0,p.f)(.02),(0,p.tn)((0,p.lD)(h).y))),A=(0,p.lK)((0,p.lD)(f).y,(0,p.jh)((0,p.f)(1),(0,p.f)(n/c),T)),P=(0,p.PW)(),C=(0,p.yG)(P,S),I=(0,p.b5)(C);l.addOutputNode(I);var E=(0,p.FP)(g.y,g.x,{target:p.We.FRAG}),R=(0,p.lK)((0,p.Bw)(v,{target:p.We.FRAG}),(0,p.f)(1/c)),N=(0,p.Ew)(E,(0,p.f)(0),(0,p.f)(2*Math.PI),(0,p.f)(0),(0,p.f)(r)),O=(0,p.jh)(R,A,T),L=(0,p.Zc)(N,O),x=(0,p.se)(o.albedo,L,{convertToLinearSpace:!0}),M=(0,p.se)(o.normal,L),_=(0,p.se)(o.metallicRoughness,L),k=(0,p.se)(o.ambientOcclusion,L),D=(0,p.u2)(L,S,w,M.rgb,(0,p.f)(1)),j=(0,p.gs)(),F=(0,p.N1)(),U=(0,p.hG)(x.rgb,_.r,_.g,k.r,D,w,j,F,S),G=(0,p.lK)(T,(0,p.lK)((0,p.lK)((0,p.TF)((0,p.f)(.48),(0,p.f)(.5),(0,p.jc)(N)),(0,p.jb)((0,p.f)(1),(0,p.TF)((0,p.f)(.5),(0,p.f)(.52),(0,p.jc)(N)))),(0,p.lK)((0,p.TF)((0,p.f)(.4),(0,p.f)(.45),(0,p.jc)(O)),(0,p.jb)((0,p.f)(1),(0,p.TF)((0,p.f)(.55),(0,p.f)(.6),(0,p.jc)(O)))))),B=(0,p.eR)((0,p.f)(1),(0,p.f)(1),(0,p.f)(.7)),H=(0,p.WQ)(U,(0,p.lK)(G,B)),Y=(0,p.rU)(H);return l.addOutputNode(Y),l.build(),l}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e),t}(f.M);function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(){var e;function t(e,n,r,o){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");b(this,"root",void 0),b(this,"rng",void 0),b(this,"radius",void 0),b(this,"cylinderMaterial",void 0),b(this,"cylinder",void 0),b(this,"cylinderAggregate",null),b(this,"habitableSurface",void 0),this.root=new a.V("CylinderHabitatRoot",o),this.rng=(0,c.p)(n),this.radius=2e3+2e3*this.rng(0);var s=e/(2*Math.PI*(this.radius/2));this.habitableSurface=2*s*Math.PI*(this.radius/2),this.cylinder=i.P.CreateCylinder("CylinderHabitat",{diameter:2*this.radius,height:s,tessellation:32},o),this.cylinder.convertToFlatShadedMesh(),this.cylinderMaterial=new g(this.radius,s,32,r.materials.spaceStation,o),this.cylinder.material=this.cylinderMaterial,this.cylinder.parent=this.getTransform()}return e=[{key:"update",value:function(e,t){this.getTransform().rotate(r._0.Y,t/(0,h.hz)(this.radius,u.SU));var n=o.Pq.Distance(e,this.getTransform().getAbsolutePosition());n<35e4&&null===this.cylinderAggregate?this.cylinderAggregate=(0,l.t)(this.cylinder,s.DK.MESH,this.getTransform().getScene()):n>36e4&&null!==this.cylinderAggregate&&(this.cylinderAggregate.dispose(),this.cylinderAggregate=null)}},{key:"getTransform",value:function(){return this.root}},{key:"dispose",value:function(){var e;this.root.dispose(),this.cylinder.dispose(),null==(e=this.cylinderAggregate)||e.dispose(),this.cylinderAggregate=null,this.cylinderMaterial.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},25760:function(e,t,n){"use strict";n.d(t,{i:()=>A});var r=n(35543),o=n(36801),i=n(90718),a=n(67450),s=n(52632),l=n(36044),c=n(49917),u=n(83266),h=n(32220),d=n(19461),f=n(56545),p=n(93035),m=n(40634),v=n(30723),y=n(1134);function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(S=function(){return!!e})()}var w=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,r,o,i){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");a=t,s=["HelixHabitatMaterial",i],a=g(a),(l=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,S()?Reflect.construct(a,s||[],g(this).constructor):a.apply(this,s))).mode=m.A.Material;var a,s,l,c=(0,y.$Z)("position"),u=(0,y.$Z)("normal"),h=(0,y.$Z)("uv"),d=(0,y.Lz)(),f=(0,y.yG)(d,c),p=(0,y.wr)(d,u),v=(0,y.lD)(h),b=(0,y.lK)(v.x,(0,y.f)(2*Math.PI*e/n)),w=(0,y.jb)((0,y.f)(1),(0,y.PM)((0,y.f)(.02),(0,y.tn)((0,y.lD)(u).y))),T=(0,y.lK)(v.y,(0,y.jh)((0,y.f)(1),(0,y.f)(r),w)),A=(0,y.Zc)(b,T),P=(0,y.PW)(),C=(0,y.yG)(P,f),I=(0,y.b5)(C);l.addOutputNode(I);var E=(0,y.se)(o.albedo,A,{convertToLinearSpace:!0}),R=(0,y.se)(o.normal,A),N=(0,y.se)(o.metallicRoughness,A),O=(0,y.se)(o.ambientOcclusion,A),L=(0,y.u2)(A,f,p,R.rgb,(0,y.f)(1)),x=(0,y.gs)(),M=(0,y.N1)(),_=(0,y.hG)(E.rgb,N.r,N.g,O.r,L,p,x,M,f),k=(0,y.lK)((0,y.lK)((0,y.TF)((0,y.f)(.48),(0,y.f)(.5),(0,y.jc)(b)),(0,y.jb)((0,y.f)(1),(0,y.TF)((0,y.f)(.5),(0,y.f)(.52),(0,y.jc)(b)))),(0,y.lK)((0,y.TF)((0,y.f)(.4),(0,y.f)(.45),(0,y.jc)(T)),(0,y.jb)((0,y.f)(1),(0,y.TF)((0,y.f)(.55),(0,y.f)(.6),(0,y.jc)(T))))),D=(0,y.eR)((0,y.f)(1),(0,y.f)(1),(0,y.f)(.7)),j=(0,y.WQ)(_,(0,y.lK)(k,D)),F=(0,y.rU)(j);return l.addOutputNode(F),l.build(),l}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e),t}(v.M);function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(){var e;function t(e,n,s,u){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");T(this,"root",void 0),T(this,"rng",void 0),T(this,"radius",void 0),T(this,"attachment",void 0),T(this,"attachmentAggregate",null),T(this,"helix1",void 0),T(this,"helix2",void 0),T(this,"helix1Aggregate",null),T(this,"helix2Aggregate",null),T(this,"helixMaterial",void 0),T(this,"metalSectionMaterial",void 0),T(this,"arms",[]),T(this,"armAggregates",[]),this.root=new a.V("HelixHabitatRoot",u),this.rng=(0,h.p)(n),this.radius=5e3+1e4*this.rng(0);var d,f,m,v,y=400+100*this.rng(1),g=1+Math.floor(2*this.rng(3)),b=e/2,S=Math.ceil(b/(2*Math.PI*this.radius*y*g));this.radius=b/(2*Math.PI*S*y*g);var A=2*this.radius*(1+.3*(2*this.rng(2)-1)),P=A*S,C=6+2*Math.floor(2*this.rng(4));this.metalSectionMaterial=new p.u("HelixHabitatMetalSectionMaterial",s.materials.metalPanels,u),this.attachment=i.P.CreateCylinder("HelixHabitatAttachment",{diameterTop:100,diameterBottom:100,height:P+4*y,tessellation:C},u),this.attachment.convertToFlatShadedMesh(),this.attachment.material=this.metalSectionMaterial,this.attachment.rotate(r._0.Y,Math.PI/C,r.$x.WORLD),this.attachment.parent=this.getTransform(),this.helix1=(d=this.radius,f=y*g,m=function(e,t,n,r,i,a){for(var s=[],l=[],u=[],h=[],d=e-t/2,f=e+t/2,p=0;p<r;p++)for(var m=0;m<=360;m++){var v=m*Math.PI*2/a,y=Math.cos(v),g=Math.sin(v),b=(p+m/a)*i-r*i/2,S=b-n/2,w=b+n/2,T=new o.Pq(d*y,S,d*g);l.push(T.x,T.y,T.z),u.push(0,-1,0);var A=new o.Pq(f*y,S,f*g);l.push(A.x,A.y,A.z),u.push(0,-1,0),h.push(m/a,0),h.push(m/a,1);var P=new o.Pq(d*y,w,d*g);l.push(P.x,P.y,P.z),u.push(0,1,0);var C=new o.Pq(f*y,w,f*g);if(l.push(C.x,C.y,C.z),u.push(0,1,0),h.push(m/a,1),h.push(m/a,0),l.push(A.x,A.y,A.z),u.push(y,0,g),l.push(C.x,C.y,C.z),u.push(y,0,g),h.push(m/a,0),h.push(m/a,1),l.push(T.x,T.y,T.z),u.push(-y,0,-g),l.push(P.x,P.y,P.z),u.push(-y,0,-g),h.push(m/a,1),h.push(m/a,0),0!==p||0!==m){var I=8*p*a,E=I+8*(m-1)+0,R=I+8*m+0;s.push(R+1,E+1,E),s.push(R,R+1,E);var N=I+8*(m-1)+2,O=I+8*m+2;s.push(N,N+1,O+1),s.push(N,O+1,O);var L=I+8*(m-1)+4,x=I+8*m+4;s.push(x+1,L+1,L),s.push(x,x+1,L);var M=I+8*(m-1)+6,_=I+8*m+6;s.push(M,M+1,_+1),s.push(M,_+1,_)}}s.push(0,1,2),s.push(2,1,3);var k=l.length/3-4;s.push(k,k+2,k+1),s.push(k+2,k+3,k+1);var D=new c.P;return D.indices=s,D.positions=l,D.normals=u,D.uvs=h,D}(d,y,f,S,A,360),v=new l.eaF("ring",u),m.applyToMesh(v),v.convertToFlatShadedMesh(),v),this.helix2=this.helix1.clone(),this.helix2.rotate(r._0.Y,Math.PI,r.$x.WORLD),this.helix1.parent=this.getTransform(),this.helix2.parent=this.getTransform(),this.helixMaterial=new w(this.radius,y,g,s.materials.spaceStation,u),this.helix1.material=this.helixMaterial,this.helix2.material=this.helixMaterial;for(var I=C*S/2,E=0;E<=I;E++){var R=i.P.CreateCylinder("HelixHabitatArm".concat(E),{height:2*this.radius,diameter:y/3,tessellation:6},u);R.convertToFlatShadedMesh(),R.rotate(r._0.Z,Math.PI/2,r.$x.LOCAL),R.material=this.metalSectionMaterial;var N=E/I*P-P/2,O=-(2*Math.PI*S*E)/I;R.position.y=N,R.rotate(r._0.Y,O,r.$x.WORLD),R.parent=this.getTransform(),this.arms.push(R)}}return e=[{key:"update",value:function(e,t){var n,i,a=this;this.getTransform().rotate(r._0.Y,t/(0,f.hz)(this.radius,d.SU));var l=o.Pq.Distance(e,this.getTransform().getAbsolutePosition());l<35e4&&null===this.attachmentAggregate?(this.attachmentAggregate=(0,u.t)(this.attachment,s.DK.MESH,this.getTransform().getScene()),this.helix1Aggregate=(0,u.t)(this.helix1,s.DK.MESH,this.getTransform().getScene()),this.helix2Aggregate=(0,u.t)(this.helix2,s.DK.MESH,this.getTransform().getScene()),this.arms.forEach(function(e){var t=(0,u.t)(e,s.DK.MESH,a.getTransform().getScene());a.armAggregates.push(t)})):l>36e4&&null!==this.attachmentAggregate&&(this.attachmentAggregate.dispose(),this.attachmentAggregate=null,null==(n=this.helix1Aggregate)||n.dispose(),this.helix1Aggregate=null,null==(i=this.helix2Aggregate)||i.dispose(),this.helix2Aggregate=null,this.armAggregates.forEach(function(e){e.dispose()}),this.armAggregates.length=0)}},{key:"getTransform",value:function(){return this.root}},{key:"dispose",value:function(){var e,t,n;this.root.dispose(),this.attachment.dispose(),null==(e=this.attachmentAggregate)||e.dispose(),this.attachmentAggregate=null,this.helixMaterial.dispose(),this.metalSectionMaterial.dispose(),this.helix1.dispose(),this.helix2.dispose(),null==(t=this.helix1Aggregate)||t.dispose(),this.helix1Aggregate=null,null==(n=this.helix2Aggregate)||n.dispose(),this.helix2Aggregate=null,this.arms.forEach(function(e){e.dispose()}),this.arms.length=0,this.armAggregates.forEach(function(e){e.dispose()}),this.armAggregates.length=0}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},93132:function(e,t,n){"use strict";n.d(t,{g:()=>T});var r=n(35543),o=n(36801),i=n(90718),a=n(67450),s=n(52632),l=n(78100),c=n(83266),u=n(32220),h=n(19461),d=n(56545),f=n(93035),p=n(40634),m=n(30723),v=n(1134);function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(b=function(){return!!e})()}var S=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,r,o,i){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");a=t,s=["RingHabitatMaterial",i],a=y(a),(l=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,b()?Reflect.construct(a,s||[],y(this).constructor):a.apply(this,s))).mode=p.A.Material;var a,s,l,c=(0,v.$Z)("position"),u=(0,v.$Z)("normal"),h=(0,v.$Z)("uv"),d=(0,v.Lz)(),f=(0,v.yG)(d,c),m=(0,v.wr)(d,u),g=(0,v.lD)(h),S=(0,v.lK)(g.x,(0,v.f)(2*Math.PI*e/n)),w=(0,v.jb)((0,v.f)(1),(0,v.PM)((0,v.f)(.02),(0,v.tn)((0,v.lD)(u).y))),T=(0,v.lK)(g.y,(0,v.jh)((0,v.f)(1),(0,v.f)(r),w)),A=(0,v.Zc)(S,T),P=(0,v.PW)(),C=(0,v.yG)(P,f),I=(0,v.b5)(C);l.addOutputNode(I);var E=(0,v.se)(o.albedo,A,{convertToLinearSpace:!0}),R=(0,v.se)(o.normal,A),N=(0,v.se)(o.metallicRoughness,A),O=(0,v.se)(o.ambientOcclusion,A),L=(0,v.u2)(A,f,m,R.rgb,(0,v.f)(1)),x=(0,v.gs)(),M=(0,v.N1)(),_=(0,v.hG)(E.rgb,N.r,N.g,O.r,L,m,x,M,f),k=(0,v.lK)((0,v.lK)((0,v.TF)((0,v.f)(.48),(0,v.f)(.5),(0,v.jc)(S)),(0,v.jb)((0,v.f)(1),(0,v.TF)((0,v.f)(.5),(0,v.f)(.52),(0,v.jc)(S)))),(0,v.lK)((0,v.TF)((0,v.f)(.4),(0,v.f)(.45),(0,v.jc)(T)),(0,v.jb)((0,v.f)(1),(0,v.TF)((0,v.f)(.55),(0,v.f)(.6),(0,v.jc)(T))))),D=(0,v.eR)((0,v.f)(1),(0,v.f)(1),(0,v.f)(.7)),j=(0,v.WQ)(_,(0,v.lK)(k,D)),F=(0,v.rU)(j);return l.addOutputNode(F),l.build(),l}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e),t}(m.M);function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(){var e;function t(e,n,o,s){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");w(this,"root",void 0),w(this,"rng",void 0),w(this,"radius",void 0),w(this,"ringMaterial",void 0),w(this,"metalSectionMaterial",void 0),w(this,"ring",void 0),w(this,"ringAggregate",null),w(this,"attachment",void 0),w(this,"attachmentAggregate",null),w(this,"arms",[]),w(this,"armAggregates",[]),w(this,"habitableSurface",void 0),this.root=new a.V("RingHabitatRoot",s),this.rng=(0,u.p)(n),this.radius=5e3+1e4*this.rng(0);var c=Math.ceil(e/(2*Math.PI*(this.radius+250))/500),h=500*c;this.radius=e/(2*h*Math.PI)-250;var d=4+2*Math.floor(2*this.rng(1));this.metalSectionMaterial=new f.u("RingHabitatMetalSectionMaterial",o.materials.metalPanels,s),this.habitableSurface=h*(2*Math.PI*(this.radius+250)),this.attachment=i.P.CreateCylinder("RingHabitatAttachment",{diameterTop:100,diameterBottom:100,height:1.5*h,tessellation:d},s),this.attachment.convertToFlatShadedMesh(),this.attachment.material=this.metalSectionMaterial,this.attachment.rotate(r._0.Y,Math.PI/d,r.$x.WORLD),this.attachment.parent=this.getTransform();var p=Math.ceil(2*Math.PI*this.radius/500);this.ring=(0,l.t)(this.radius,500,h,p,s),this.ringMaterial=new S(this.radius,500,c,o.materials.spaceStation,s),this.ring.material=this.ringMaterial,this.ring.parent=this.getTransform();for(var m=d/2,v=0;v<=m;v++){var y=i.P.CreateCylinder("RingHabitatArm".concat(v),{height:2*this.radius,diameter:500/3,tessellation:6},s);y.convertToFlatShadedMesh(),y.rotate(r._0.Z,Math.PI/2,r.$x.LOCAL),y.material=this.metalSectionMaterial;var g=v/m*Math.PI*2;y.rotate(r._0.Y,g,r.$x.WORLD),y.parent=this.getTransform(),this.arms.push(y)}}return e=[{key:"update",value:function(e,t){var n,i=this;this.getTransform().rotate(r._0.Y,t/(0,d.hz)(this.radius,h.SU));var a=o.Pq.Distance(e,this.getTransform().getAbsolutePosition());a<35e4&&null===this.attachmentAggregate?(this.attachmentAggregate=(0,c.t)(this.attachment,s.DK.MESH,this.getTransform().getScene()),this.arms.forEach(function(e){var t=(0,c.t)(e,s.DK.MESH,i.getTransform().getScene());i.armAggregates.push(t)}),this.ringAggregate=(0,c.t)(this.ring,s.DK.MESH,this.getTransform().getScene())):a>36e4&&null!==this.attachmentAggregate&&(this.attachmentAggregate.dispose(),this.attachmentAggregate=null,this.armAggregates.forEach(function(e){e.dispose()}),this.armAggregates.length=0,null==(n=this.ringAggregate)||n.dispose(),this.ringAggregate=null)}},{key:"getTransform",value:function(){return this.root}},{key:"dispose",value:function(){var e,t;this.root.dispose(),this.attachment.dispose(),null==(e=this.attachmentAggregate)||e.dispose(),this.ring.dispose(),null==(t=this.ringAggregate)||t.dispose(),this.ringMaterial.dispose(),this.metalSectionMaterial.dispose(),this.arms.forEach(function(e){e.dispose()}),this.armAggregates.forEach(function(e){e.dispose()})}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},65773:function(e,t,n){"use strict";n.d(t,{K:()=>E});var r=n(45782),o=n(35543),i=n(36801),a=n(90718),s=n(67450),l=n(52632),c=n(78100),u=n(83266),h=n(89901),d=n(32220),f=n(19461),p=n(56545),m=n(97730),v=n(93035),y=n(40634),g=n(30723),b=n(39042),S=n(1134),w=n(13679);function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(P=function(){return!!e})()}var C=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,r,o,i,a){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");s=t,l=["LandingBayMaterial",a],s=T(s),(c=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,P()?Reflect.construct(s,l||[],T(this).constructor):s.apply(this,l))).mode=y.A.Material;var s,l,c,u=2*Math.PI*n,h=new b.R("NamePlateTexture",{width:.5*u/r*256,height:256},a,!0);h.drawText(e.name.toUpperCase(),null,null,"".concat(128,"px ").concat(w.w.MAIN_FONT),"white",null,!0,!0),c.onDisposeObservable.addOnce(function(){h.dispose()});var d=(0,S.$Z)("position"),f=(0,S.$Z)("normal"),p=(0,S.$Z)("uv"),m=(0,S.xz)(d),v=(0,S.lD)(m),g=(0,S.Lz)(),A=(0,S.yG)(g,d),C=(0,S.wr)(g,f),I=(0,S.jb)((0,S.f)(1),(0,S.PM)((0,S.f)(.02),(0,S.tn)((0,S.lD)(f).y))),E=(0,S.lK)((0,S.lD)(p).y,(0,S.jh)((0,S.f)(1),(0,S.f)(o),I)),R=(0,S.PW)(),N=(0,S.yG)(R,A),O=(0,S.b5)(N);c.addOutputNode(O);var L=(0,S.FP)(v.y,v.x,{target:S.We.FRAG}),x=(0,S.Bw)(m,{target:S.We.FRAG}),M=(0,S.Ew)(x,(0,S.f)(n-r/2),(0,S.f)(n+r/2),(0,S.f)(0),(0,S.f)(1)),_=(0,S.lK)(L,(0,S.f)(n/r)),k=(0,S.Zc)(_,E),D=(0,S.se)(i.albedo,k,{convertToLinearSpace:!0}),j=(0,S.se)(i.normal,k),F=(0,S.se)(i.metallicRoughness,k),U=(0,S.se)(i.ambientOcclusion,k),G=(0,S.lK)(L,(0,S.f)(1/Math.PI)),B=(0,S.PM)((0,S.f)(1),(0,S.lD)(f).y),H=(0,S.jh)((0,S.Zc)((0,S.f)(0),(0,S.f)(0)),(0,S.Zc)(G,M),B),Y=(0,S.se)(h,(0,S.jc)(H)),W=Y.a,z=(0,S.jh)(D.rgb,Y.rgb,W),q=(0,S.jh)(F.r,(0,S.f)(0),W),V=(0,S.jh)(F.g,(0,S.f)(.7),W),J=(0,S.jh)(U.r,(0,S.f)(1),W),X=(0,S.u2)(k,A,C,j.rgb,(0,S.jb)((0,S.f)(1),(0,S.lK)(W,(0,S.f)(.7)))),Z=(0,S.gs)(),K=(0,S.N1)(),Q=(0,S.hG)(z,q,V,J,X,C,Z,K,A),$=(0,S.rU)(Q);return c.addOutputNode($),c.build(),c}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e),t}(g.M);function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(){var e;function t(e,n,f,p){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");I(this,"root",void 0),I(this,"rng",void 0),I(this,"radius",void 0),I(this,"landingBayMaterial",void 0),I(this,"metalSectionMaterial",void 0),I(this,"ring",void 0),I(this,"ringAggregate",null),I(this,"arms",[]),I(this,"armAggregates",[]),I(this,"centralLight",void 0),I(this,"landingPads",[]),this.root=new s.V("LandingBayRoot",p),this.centralLight=new r.H("LandingBayCentralLight",i.Pq.Zero(),p),this.centralLight.parent=this.root,this.centralLight.intensity=1e3,this.rng=(0,d.p)(n),this.radius=500;var y=this.radius/3;this.metalSectionMaterial=new v.u("LandingBayMetalSectionMaterial",f.textures.materials.metalPanels,p);var g=2+Math.floor(3*this.rng(0)),b=Math.ceil(2*Math.PI*this.radius/y);b%2!=0&&(b+=1),this.ring=(0,c.t)(this.radius,y,g*y,b,p),this.landingBayMaterial=new C(e,this.radius,y,g,f.textures.materials.spaceStation,p),this.ring.material=this.landingBayMaterial,this.ring.parent=this.getTransform(),this.ringAggregate=(0,u.t)(this.ring,l.DK.MESH,p);for(var S=this.ring.getBoundingInfo().boundingBox.extendSize.y,w=y/4,T=1.618*this.radius,A=2*Math.asin(.5*this.radius/T),P=Math.sqrt(T*T-this.radius*this.radius),E=0;E<=6;E++){var R=a.P.CreateCylinder("RingHabitatArm".concat(E),{height:T,diameter:w,tessellation:4},p);R.convertToFlatShadedMesh(),R.rotate(o._0.Z,A,o.$x.LOCAL),R.material=this.metalSectionMaterial;var N=E/6*Math.PI*2;R.rotate(o._0.Y,N,o.$x.WORLD),R.translate(o._0.Y,-P-S,o.$x.WORLD),R.translate(o._0.Y,T/2,o.$x.LOCAL),R.parent=this.getTransform(),this.arms.push(R);var O=(0,u.t)(R,l.DK.BOX,p);this.armAggregates.push(O)}for(var L=b,x=0,M=0;M<g;M++)for(var _=0;_<L;_++){var k=new m.r(x++,(_+M)%2==0?h.a.SMALL:h.a.MEDIUM,f,p);k.getTransform().parent=this.getTransform(),k.getTransform().rotate(o._0.Z,Math.PI/2,o.$x.LOCAL),k.getTransform().rotate(o._0.X,(_+.5)*2*Math.PI/L,o.$x.LOCAL),k.getTransform().rotate(o._0.Y,-Math.PI/2,o.$x.LOCAL),k.getTransform().translate(i.Pq.Up(),-(this.radius-y/2)*Math.cos(Math.PI/L),o.$x.LOCAL),k.getTransform().translate(i.Pq.Forward(p.useRightHandedSystem),M*y-(g-1)*y/2,o.$x.LOCAL),this.landingPads.push(k)}this.getTransform().computeWorldMatrix(!0);var D=this.getTransform().getHierarchyBoundingVectors(),j=D.max.subtract(D.min),F=D.min.add(j.scale(.5));this.getTransform().getChildMeshes(!0).forEach(function(e){e.position.subtractInPlace(F)}),this.centralLight.includedOnlyMeshes=this.getTransform().getChildMeshes()}return e=[{key:"update",value:function(e,t){var n=this;this.getTransform().rotate(o._0.Y,t/(0,p.hz)(this.radius,.1*f.SU)),this.landingPads.forEach(function(t){var n=i.Pq.DistanceSquared(e,t.getTransform().getAbsolutePosition());t.getTransform().setEnabled(n<144e6)});var r=i.Pq.Distance(e,this.getTransform().getAbsolutePosition());r<35e4&&null===this.ringAggregate?(this.ringAggregate=(0,u.t)(this.ring,l.DK.MESH,this.getTransform().getScene()),this.arms.forEach(function(e){var t=(0,u.t)(e,l.DK.BOX,n.getTransform().getScene());n.armAggregates.push(t)})):r>36e4&&null!==this.ringAggregate&&(this.ringAggregate.dispose(),this.ringAggregate=null,this.armAggregates.forEach(function(e){e.dispose()}),this.armAggregates.length=0)}},{key:"getTransform",value:function(){return this.root}},{key:"dispose",value:function(){var e;this.root.dispose(),this.ring.dispose(),null==(e=this.ringAggregate)||e.dispose(),this.ringAggregate=null,this.landingBayMaterial.dispose(),this.metalSectionMaterial.dispose(),this.arms.forEach(function(e){e.dispose()}),this.armAggregates.forEach(function(e){e.dispose()}),this.armAggregates.length=0,this.landingPads.forEach(function(e){e.dispose()}),this.centralLight.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},97730:function(e,t,n){"use strict";n.d(t,{r:()=>g});var r=n(36801),o=n(90718),i=n(52632),a=n(80465),s=n(53024),l=n(78706),c=n(13679),u=n(40634),h=n(30723),d=n(1134);function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(m=function(){return!!e})()}var v=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,o,i){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");a=t,s=["LandingPadMaterial".concat(e),i],a=f(a),(l=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,m()?Reflect.construct(a,s||[],f(this).constructor):a.apply(this,s))).mode=u.A.Material;var a,s,l,h=o.get(e,i),p=(0,d.$Z)("position"),v=(0,d.$Z)("normal"),y=(0,d.$Z)("uv"),g=(0,d.lD)(y),b=(0,d.lD)((0,d.jb)(y,(0,d.f)(.5))),S=(0,d.Zc)((0,d.lK)(b.x,(0,d.f)(c.w.LANDING_PAD_ASPECT_RATIO)),b.y),w=(0,d.lK)((0,d.xz)(p),(0,d.f)(.1)),T=(0,d.Lz)(),A=(0,d.yG)(T,p),P=(0,d.wr)(T,v),C=(0,d.PW)(),I=(0,d.yG)(C,A),E=(0,d.b5)(I),R=(0,d.Zc)(g.y,(0,d.WQ)(g.x,(0,d.f)(.01))),N=(0,d.se)(h,R).a,O=(0,d.t6)(r.Pq.One()),L=(0,d.f)(.03),x=(0,d.PM)(g.x,L),M=(0,d.PM)((0,d.jb)((0,d.f)(1),g.x),L),_=(0,d.WQ)(x,M),k=(0,d.PM)(g.y,L),D=(0,d.PM)((0,d.jb)((0,d.f)(1),g.y),L),j=(0,d.WQ)(k,D),F=(0,d.jk)((0,d.WQ)(_,j),(0,d.f)(1)),U=(0,d.f)(.25),G=(0,d.f)(.01),B=(0,d.Bw)(S),H=(0,d.lK)((0,d.PM)((0,d.jb)(U,G),B),(0,d.PM)(B,(0,d.WQ)(U,G))),Y=(0,d.WQ)((0,d.WQ)(N,F),H),W=(0,d.se)(n.albedo,w,{convertToLinearSpace:!0}),z=(0,d.se)(n.metallicRoughness,w),q=(0,d.se)(n.normal,w),V=(0,d.se)(n.ambientOcclusion,w),J=(0,d.jh)(W.rgb,O,Y),X=(0,d.jh)(z.r,(0,d.f)(0),Y),Z=(0,d.jh)(z.g,(0,d.f)(.7),Y),K=(0,d.jh)(V.r,(0,d.f)(1),Y),Q=(0,d.u2)(w,A,P,q.rgb,(0,d.jb)((0,d.f)(1),(0,d.lK)(Y,(0,d.f)(.5)))),$=(0,d.gs)(),ee=(0,d.N1)(),et=(0,d.hG)(J,X,Z,K,Q,P,$,ee,A),en=(0,d.lK)(J,(0,d.y4)((0,d.f)(.05),(0,d.WQ)((0,d.f)(.05),(0,d.lK)(B,B)))),er=(0,d.rU)((0,d.WQ)(et,en));return l.addOutputNode(E),l.addOutputNode(er),l.build(),l}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e),t}(h.M);function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(){var e;function t(e,n,r,l){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");y(this,"deck",void 0),y(this,"deckAggregate",void 0),y(this,"deckMaterial",void 0),y(this,"crates",[]),y(this,"padNumber",void 0),y(this,"padSize",void 0),y(this,"boundingRadius",void 0),y(this,"targetInfo",void 0),y(this,"padHeight",.5),y(this,"width",void 0),y(this,"depth",void 0),this.padSize=n,this.width=40*n,this.depth=this.width*c.w.LANDING_PAD_ASPECT_RATIO,this.boundingRadius=this.depth/2,this.padNumber=e,this.deckMaterial=new v(e,r.textures.materials.concrete,r.textures.pools.landingPad,l),this.deck=o.P.CreateBox("Landing Pad ".concat(e),{width:this.width,depth:this.depth,height:this.padHeight},l),this.deck.material=this.deckMaterial,this.deckAggregate=new a.L(this.deck,i.DK.BOX,{mass:0,friction:10},l),this.deckAggregate.body.disablePreStep=!1,this.deckAggregate.shape.filterMembershipMask=c.H.ENVIRONMENT,this.deckAggregate.shape.filterCollideMask=c.H.DYNAMIC_OBJECTS;var u=Math.floor(5*Math.random());this.scatterAssets(r.objects.crate,u),this.targetInfo={type:s.L.LANDING_PAD,minDistance:4*this.getBoundingRadius(),maxDistance:6*this.getBoundingRadius()}}return e=[{key:"scatterAssets",value:function(e,t){for(var n,o=0;o<t;o++)n=this,function(t){var o=.5>Math.random()?-1:1,i=.5>Math.random()?-1:1,a=.2>Math.random()?.5:1,s=e.createInstance("crate".concat(t));s.scaling.scaleInPlace(a),s.parent=n.deck,s.position.y+=.25+a/2;var l=0;do if(s.position.x=o*(n.width-10*Math.random()-3)/2,s.position.z=i*(n.depth-10*Math.random()-3)/2,s.rotation.y=Math.random()*Math.PI*2,++l>10){s.dispose();break}while(!n.crates.every(function(e){return r.Pq.Distance(s.position,e.position)>1.5}));l<=10&&n.crates.push(s)}(o)}},{key:"getPadNumber",value:function(){return this.padNumber}},{key:"getPadSize",value:function(){return this.padSize}},{key:"getPadHeight",value:function(){return this.padHeight}},{key:"getTransform",value:function(){return this.deck}},{key:"getBoundingRadius",value:function(){return this.boundingRadius}},{key:"dispose",value:function(){this.deck.dispose(),this.deckAggregate.dispose(),this.deckMaterial.dispose(),this.crates.forEach(function(e){e.dispose()})}},{key:"getTypeName",value:function(){return l.A.t("objectTypes:landingPad")}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},93035:function(e,t,n){"use strict";n.d(t,{u:()=>c});var r=n(40634),o=n(30723),i=n(1134);function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(l=function(){return!!e})()}var c=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,o){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");s=t,c=[e,o],s=a(s),(u=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,l()?Reflect.construct(s,c||[],a(this).constructor):s.apply(this,c))).mode=r.A.Material;var s,c,u,h=i.$Z("position"),d=i.$Z("normal"),f=i.$Z("uv"),p=i.lD(h).y,m=i.lK(p,i.fV(.02)),v=i.lK(f,i.fV(6)),y=i.Zc(i.lD(v).x,m),g=i.Lz(),b=i.yG(g,h),S=i.wr(g,d),w=i.PW(),T=i.yG(w,b),A=i.b5(T),P=i.se(n.albedo,y,{convertToLinearSpace:!0}),C=i.se(n.metallicRoughness,y),I=i.se(n.ambientOcclusion,y),E=i.se(n.normal,y),R=i.u2(y,b,S,E.rgb,i.fV(1)),N=i.gs(),O=i.N1(),L=i.hG(P.rgb,C.r,C.g,I.r,R,S,N,O,b),x=i.rU(L);return u.addOutputNode(A),u.addOutputNode(x),u.build(),u}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e),t}(o.M)},51216:function(e,t,n){"use strict";n.d(t,{d:()=>d});var r=n(35543),o=n(36801),i=n(90718),a=n(52632),s=n(83266),l=n(32220),c=n(96839),u=n(93035);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){var e;function t(e,n,o,a){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");h(this,"attachment",void 0),h(this,"attachmentAggregate",null),h(this,"rng",void 0),h(this,"arms",[]),h(this,"armAggregates",[]),h(this,"solarPanels",[]),h(this,"solarPanelAggregates",[]),h(this,"metalSectionMaterial",void 0),this.rng=(0,l.p)(n);var s=(0,c.MA)([[1,.1],[2,.3],[3,.3],[4,.2],[5,.1]],this.rng(0)),d=200;1===s?d=1.618*Math.sqrt(e/2):2===s&&(d=1.2*Math.sqrt(e)),this.attachment=i.P.CreateCylinder("SolarSectionAttachment",{diameter:100,height:d,tessellation:s<3?6:2*s},a),this.attachment.convertToFlatShadedMesh(),this.metalSectionMaterial=new u.u("SolarSectionMetalMaterial",o.textures.materials.metalPanels,a),this.attachment.material=this.metalSectionMaterial;var f=100*(1-Math.sqrt(3)/2);if(1===s)this.generateSpikePattern(this.getTransform(),d,100,e,o.materials.solarPanel);else if(2===s){var p=d/2.5,m=i.P.CreateCylinder("Arm1",{height:p,diameter:50,tessellation:6},a);m.convertToFlatShadedMesh(),m.parent=this.getTransform(),m.material=this.metalSectionMaterial,m.rotate(r._0.X,Math.PI/2),m.translate(r._0.Y,(p+100-f)/2),this.generateSpikePattern(m,p,50,e/2,o.materials.solarPanel);var v=i.P.CreateCylinder("Arm2",{height:p,diameter:50,tessellation:6},a);v.convertToFlatShadedMesh(),v.parent=this.getTransform(),v.material=this.metalSectionMaterial,v.rotate(r._0.X,-Math.PI/2),v.translate(r._0.Y,(p+100-f)/2),this.generateSpikePattern(v,p,50,e/2,o.materials.solarPanel)}else s>=3&&this.generateStarPattern(s,e,o.materials.solarPanel)}return e=[{key:"generateSpikePattern",value:function(e,t,n,o,a){for(var s=this.getTransform().getScene(),l=Math.ceil(t/1e3),c=t/l-200,u=o/2/t,h=n*(1-Math.sqrt(3)/2),d=0;d<l;d++){var f=i.P.CreateBox("SolarPanel1",{height:.3,width:c,depth:u},s);f.parent=e,f.material=a,f.translate(r._0.Y,(c+200)*(d-(l-1)/2)),f.translate(r._0.Z,(u+n-h)/2),f.rotate(r._0.Z,Math.PI/2),this.solarPanels.push(f);var p=i.P.CreateBox("SolarPanel2",{height:.3,width:c,depth:u},s);p.parent=e,p.material=a,p.translate(r._0.Y,(c+200)*(d-(l-1)/2)),p.translate(r._0.Z,-(u+n-h)/2),p.rotate(r._0.Z,Math.PI/2),this.solarPanels.push(p)}}},{key:"generateStarPattern",value:function(e,t,n){for(var o=this.getTransform().getScene(),a=t/(2*e),s=2.618*Math.sqrt(a),l=0;l<=e;l++){var c=i.P.CreateCylinder("RingHabitatArm".concat(l),{height:s,diameter:100,tessellation:6},o);c.convertToFlatShadedMesh(),c.rotate(r._0.Z,Math.PI/2,r.$x.LOCAL);var u=l/e*Math.PI*2;c.rotate(r._0.Y,u,r.$x.WORLD),c.translate(r._0.Y,s/2,r.$x.LOCAL),c.parent=this.getTransform(),c.material=this.metalSectionMaterial,this.arms.push(c);var h=.3*e*a/s,d=100*(1-Math.sqrt(3)/2),f=i.P.CreateBox("SolarPanel1",{height:.3,width:s,depth:a/s},o);f.rotate(r._0.Z,Math.PI/2,r.$x.LOCAL),f.parent=c,f.translate(r._0.X,h),f.translate(r._0.Z,.5*(a/s+100-d)),f.material=n,this.solarPanels.push(f);var p=i.P.CreateBox("SolarPanel2",{height:.3,width:s,depth:a/s},o);p.rotate(r._0.Z,Math.PI/2,r.$x.LOCAL),p.parent=c,p.translate(r._0.X,h),p.translate(r._0.Z,-.5*(a/s+100-d)),p.material=n,this.solarPanels.push(p)}}},{key:"update",value:function(e){var t=this,n=o.Pq.Distance(e,this.getTransform().getAbsolutePosition());n<35e4&&null===this.attachmentAggregate?(this.attachmentAggregate=(0,s.t)(this.attachment,a.DK.MESH,this.getTransform().getScene()),this.arms.forEach(function(e){var n=(0,s.t)(e,a.DK.MESH,t.getTransform().getScene());t.armAggregates.push(n)}),this.solarPanels.forEach(function(e){var n=(0,s.t)(e,a.DK.BOX,t.getTransform().getScene());t.solarPanelAggregates.push(n)})):n>36e4&&null!==this.attachmentAggregate&&(this.attachmentAggregate.dispose(),this.attachmentAggregate=null,this.armAggregates.forEach(function(e){e.dispose()}),this.armAggregates.length=0,this.solarPanelAggregates.forEach(function(e){e.dispose()}),this.solarPanelAggregates.length=0)}},{key:"getTransform",value:function(){return this.attachment}},{key:"dispose",value:function(){var e;this.attachment.dispose(),null==(e=this.attachmentAggregate)||e.dispose(),this.attachmentAggregate=null,this.arms.forEach(function(e){e.dispose()}),this.armAggregates.forEach(function(e){e.dispose()}),this.solarPanels.forEach(function(e){e.dispose()}),this.solarPanelAggregates.forEach(function(e){e.dispose()}),this.metalSectionMaterial.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},17514:function(e,t,n){"use strict";n.d(t,{T:()=>o});var r,o=((r={})[r.UTILITY_SECTION=0]="UTILITY_SECTION",r[r.SOLAR_SECTION=1]="SOLAR_SECTION",r[r.RING_HABITAT=2]="RING_HABITAT",r[r.HELIX_HABITAT=3]="HELIX_HABITAT",r[r.CYLINDER_HABITAT=4]="CYLINDER_HABITAT",r)},37427:function(e,t,n){"use strict";n.d(t,{o:()=>f});var r=n(35543),o=n(36801),i=n(90718),a=n(52632),s=n(80465),l=n(67604),c=n(32220),u=n(13679),h=n(93035);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){var e;function t(e,n,a){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");d(this,"attachment",void 0),d(this,"rng",void 0),d(this,"attachmentAggregate",null),d(this,"metalSectionMaterial",void 0),d(this,"tanks",[]),d(this,"tankBodies",[]),d(this,"tankShape",void 0),this.metalSectionMaterial=new h.u("UtilitySectionMetalMaterial",n.textures.materials.metalPanels,a),this.rng=(0,c.p)(e),this.attachment=i.P.CreateCylinder("UtilitySectionRoot",{height:700,diameter:100,tessellation:6},a),this.attachment.convertToFlatShadedMesh(),this.attachment.material=this.metalSectionMaterial;var s=this.attachment.getHierarchyBoundingVectors(),l=s.max.subtract(s.min).scale(.5);if(this.tankShape=n.objects.sphericalTank.shape,.3>this.rng(0))for(var u=-3;u<=3;u++)for(var f=0;f<6;f++){var p=n.objects.sphericalTank.mesh.createInstance("SphericalTank");p.scalingDeterminant=2.4;var m=p.getHierarchyBoundingVectors(),v=m.max.subtract(m.min).scale(.5);p.position.x=l.x+v.x,p.parent=this.getTransform(),p.rotateAround(o.Pq.Zero(),r._0.Y,Math.PI/6+Math.PI/3*f),p.translate(r._0.Y,40*u),this.tanks.push(p)}}return e=[{key:"update",value:function(e){var t=this,n=e.subtract(this.getTransform().getAbsolutePosition()).length();n<35e4&&null===this.attachmentAggregate?(this.attachmentAggregate=new s.L(this.attachment,a.DK.MESH,{mass:0}),this.attachmentAggregate.body.disablePreStep=!1,this.attachmentAggregate.shape.filterMembershipMask=u.H.ENVIRONMENT,this.attachmentAggregate.shape.filterCollideMask=u.H.DYNAMIC_OBJECTS,this.tanks.forEach(function(e){var n=new l.a(e,a.AH.STATIC,!1,t.getTransform().getScene());n.setMassProperties({mass:0}),n.disablePreStep=!1,n.shape=t.tankShape,t.tankBodies.push(n)})):n>36e4&&null!==this.attachmentAggregate&&(this.attachmentAggregate.dispose(),this.attachmentAggregate=null,this.tankBodies.forEach(function(e){e.dispose()}),this.tankBodies.length=0)}},{key:"getTransform",value:function(){return this.attachment}},{key:"dispose",value:function(){var e;this.attachment.dispose(),null==(e=this.attachmentAggregate)||e.dispose(),this.metalSectionMaterial.dispose(),this.tanks.forEach(function(e){e.dispose()}),this.tankBodies.forEach(function(e){e.dispose()})}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},40995:function(e,t,n){"use strict";n.d(t,{D:()=>h});var r=n(90767),o=n(74334),i=n(28995),a=n(14265),s=n(36801),l=n(90718),c=n(39962);function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(){var e;function t(e){var n=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");u(this,"solidParticleSystem",void 0),u(this,"throttle",0),u(this,"nbParticlesAlive",0),u(this,"targetNbParticles",0),u(this,"recycledParticles",[]),u(this,"particleScaling",new s.Pq(.1,.1,4)),u(this,"particleRotationQuaternion",o.PT.Identity()),u(this,"particleDirection",s.Pq.Zero()),u(this,"particleToDirection",new Map),u(this,"tunnelAxis1",s.Pq.Zero()),u(this,"tunnelAxis2",s.Pq.Zero()),u(this,"particleSpeed",200),u(this,"emitPeriod",1),u(this,"emitCounter",0),u(this,"currentForce",s.Pq.Zero()),u(this,"lastDeltaSeconds",0);var h=new c.l("SPS",e),d=l.P.CreatePolyhedron("p",{type:1});h.addShape(d,t.MAX_NB_PARTICLES),d.setEnabled(!1),d.dispose(),h.buildMesh(),h.isAlwaysVisible=!0,this.solidParticleSystem=h,this.updateGlobals(),h.recycleParticle=function(e){return n.recycledParticles.push(e),e.isVisible=!1,e},h.initParticles=function(){var e=!0,t=!1,r=void 0;try{for(var o,i=h.particles[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a=o.value;n.initParticle(a),n.nbParticlesAlive>=n.targetNbParticles?h.recycleParticle(a):n.nbParticlesAlive++}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}},h.initParticles(),h.setParticles();var f=new r.F("mat",e);f.emissiveColor=new i.v9(1,1,1),f.disableLighting=!0,h.mesh.material=f,h.updateParticle=function(e){if(!e.isVisible)return e;e.velocity.addInPlace(n.currentForce.scale(n.lastDeltaSeconds)),e.position.addInPlace(e.velocity.scale(n.lastDeltaSeconds));var r=e.position.z;if(r>t.TUNNEL_LENGTH/2)return h.recycleParticle(e),n.nbParticlesAlive--,e;var o=1-(0,a.RangeToPercent)(r,-t.TUNNEL_LENGTH/2,t.TUNNEL_LENGTH/2);if(o<.5){var l=o/.5;e.color=i.ov.Lerp(new i.ov(.7,.7,1,1),new i.ov(.7,1,1,1),l),e.scaling=s.Pq.Lerp(s.Pq.Zero(),n.particleScaling,Math.min(2*l,1))}else{var c=(o-.5)/.5;e.color=i.ov.Lerp(new i.ov(.7,1,1,1),new i.ov(1,1,1,1),c),e.scaling=s.Pq.Lerp(n.particleScaling,s.Pq.Zero(),c*c)}return e}}return e=[{key:"initParticle",value:function(e){var n,r=30+(Math.random()-.5)*10,o=2*Math.random()*Math.PI;e.position.setAll(0),e.position.addInPlace(this.tunnelAxis1.scale(r*Math.cos(o))),e.position.addInPlace(this.tunnelAxis2.scale(r*Math.sin(o))),e.position.addInPlace(this.particleDirection.scale(10*Math.random())),e.position.z-=t.TUNNEL_LENGTH/2,this.particleToDirection.set(e,this.particleDirection.clone()),e.rotationQuaternion=this.particleRotationQuaternion,e.scaling=this.particleScaling;var i=null!=(n=this.particleToDirection.get(e))?n:this.particleDirection;this.particleToDirection.set(e,i),e.velocity.copyFrom(i.scale(this.particleSpeed))}},{key:"updateGlobals",value:function(){this.particleRotationQuaternion.copyFrom(o.PT.Identity()),this.particleDirection.copyFromFloats(0,0,1),this.tunnelAxis1.copyFrom(this.particleDirection.add(new s.Pq(Math.random(),Math.random(),Math.random()))),this.tunnelAxis1.subtractInPlace(this.particleDirection.scale(this.tunnelAxis1.dot(this.particleDirection))),this.tunnelAxis1.normalize(),this.tunnelAxis2.copyFrom(s.Pq.Cross(this.particleDirection,this.tunnelAxis1)),this.tunnelAxis2.normalize()}},{key:"instanceFromStock",value:function(){var e=this.recycledParticles.shift();if(void 0===e)throw Error("particle is undefined");e.isVisible=!0,this.initParticle(e)}},{key:"applyForce",value:function(e){this.currentForce.addInPlace(e)}},{key:"update",value:function(e){if(this.lastDeltaSeconds=e,this.particleSpeed=200*(1+this.throttle),this.updateGlobals(),this.targetNbParticles>0)for(this.emitPeriod=t.TUNNEL_LENGTH/(this.particleSpeed*this.targetNbParticles),this.emitCounter+=e;this.emitCounter>this.emitPeriod&&this.nbParticlesAlive<this.targetNbParticles&&this.recycledParticles.length>0;)this.emitCounter-=this.emitPeriod,this.instanceFromStock(),this.nbParticlesAlive++;this.emitCounter=this.emitCounter%this.emitPeriod,0===this.nbParticlesAlive&&this.solidParticleSystem.mesh.isEnabled()?this.solidParticleSystem.mesh.setEnabled(!1):this.nbParticlesAlive>0&&!this.solidParticleSystem.mesh.isEnabled()&&this.solidParticleSystem.mesh.setEnabled(!0),this.nbParticlesAlive>0&&this.solidParticleSystem.setParticles()}},{key:"setThrottle",value:function(e){this.throttle=e,this.targetNbParticles=0===e?0:Math.floor(Math.max(this.throttle,.1)*t.MAX_NB_PARTICLES)}},{key:"getTransform",value:function(){return this.solidParticleSystem.mesh}},{key:"dispose",value:function(){this.solidParticleSystem.dispose(),this.particleToDirection.clear()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();u(h,"TUNNEL_LENGTH",300),u(h,"MAX_NB_PARTICLES",3e3)},62978:function(e,t,n){"use strict";n.d(t,{Q:()=>W});var r=n(42130);n(90767),n(28995);var o=n(78930),i=n(16739),a=n(36801),s=n(56072);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(f=function(){return!!e})()}var p={WORLD:"world",WORLD_VIEW:"worldView",WORLD_VIEW_PROJECTION:"worldViewProjection",VIEW:"view",PROJECTION:"projection",VIEW_PROJECTION:"viewProjection",TIME:"time",PLAYER_POSITION:"playerPosition",CAMERA_POSITION:"cameraPosition",PLANET_POSITION:"planetPosition",PLANET_WORLD:"planetWorld"},m={BUTTERFLY_TEXTURE:"butterflyTexture"},v=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,r){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var i,l,h,v="butterflyMaterial";o.M.ShadersStore["".concat(v,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nuniform float time;\n\nuniform vec3 cameraPosition;\n\nuniform sampler2D butterflyTexture;\n\nvarying vec3 vPositionW;\nvarying vec2 vUV;\n\nvarying vec3 vNormalW;\n\n// This is used to render the grass blade to the depth buffer properly\n// (see https://forum.babylonjs.com/t/how-to-write-shadermaterial-to-depthrenderer/47227/3 and https://playground.babylonjs.com/#6GFJNR#161)\n#ifdef FORDEPTH\nvarying float vDepthMetric;\n#endif\n\nvarying vec3 vOriginalWorldPosition;\n\n// src: https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786\nvec3 hueShift( vec3 color, float hueAdjust ){\n    const vec3  kRGBToYPrime = vec3 (0.299, 0.587, 0.114);\n    const vec3  kRGBToI      = vec3 (0.596, -0.275, -0.321);\n    const vec3  kRGBToQ      = vec3 (0.212, -0.523, 0.311);\n\n    const vec3  kYIQToR     = vec3 (1.0, 0.956, 0.621);\n    const vec3  kYIQToG     = vec3 (1.0, -0.272, -0.647);\n    const vec3  kYIQToB     = vec3 (1.0, -1.107, 1.704);\n\n    float   YPrime  = dot (color, kRGBToYPrime);\n    float   I       = dot (color, kRGBToI);\n    float   Q       = dot (color, kRGBToQ);\n    float   hue     = atan (Q, I);\n    float   chroma  = sqrt (I * I + Q * Q);\n\n    hue += hueAdjust;\n\n    Q = chroma * sin (hue);\n    I = chroma * cos (hue);\n\n    vec3    yIQ   = vec3 (YPrime, I, Q);\n\n    return vec3( dot (yIQ, kYIQToR), dot (yIQ, kYIQToG), dot (yIQ, kYIQToB) );\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// taken from https://github.com/BarthPaleologue/feather/blob/main/assets/shaders/pbr/fragment.glsl\n// based on https://learnopengl.com/PBR/Lighting\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness) {\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness) {\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return num / denom;\n}\n\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n}\n\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\n}\n\nvec3 calculateLight(vec3 albedo, vec3 normal, float roughness, float metallic, vec3 lightDir, vec3 viewDir, vec3 lightColor) {\n    vec3 H = normalize(viewDir + lightDir);\n\n    vec3 F0 = vec3(0.04);\n    F0 = mix(F0, albedo, metallic);\n\n    vec3 F  = fresnelSchlick(max(dot(H, viewDir), 0.0), F0);\n    float NDF = DistributionGGX(normal, H, roughness);\n    float G   = GeometrySmith(normal, viewDir, lightDir, roughness);\n\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(normal, viewDir), 0.0) * max(dot(normal, lightDir), 0.0)  + 1.0; // + 1.0 to prevent division by zero at glancing angles\n    vec3 specular     = numerator / denominator;\n\n    vec3 kS = F;\n    vec3 kD = 1.0 - kS;\n\n    kD *= 1.0 - metallic;\n\n    vec3 radiance = lightColor;\n\n    float NdotL = max(dot(normal, lightDir), 0.0);\n\n    vec3 diffuse = kD * (albedo)/ PI;\n    return (diffuse + specular) * radiance * NdotL;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\nvoid main() {\n    vec4 butterflyColor = texture(butterflyTexture, vUV);\n    if(butterflyColor.a < 0.1) discard;\n\n    butterflyColor.rgb = hueShift(butterflyColor.rgb, vOriginalWorldPosition.x * 10.0 + vOriginalWorldPosition.z * 10.0);\n\n    vec3 normalW = vNormalW;\n\n    vec3 Lo = vec3(0.0);\n    \n    vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n    for(int i = 0; i < nbStars; i++) {\n        vec3 starPosition = star_positions[i];\n        vec3 lightDirectionW = normalize(starPosition - vPositionW);\n        float ndl = dot(normalW, lightDirectionW);\n        if (ndl < 0.0) {\n            normalW = -normalW;\n        }\n        Lo += calculateLight(butterflyColor.rgb, normalW, 1.0, 0.0, lightDirectionW, viewDirectionW, star_colors[i]);\n    }\n\n    Lo += butterflyColor.rgb * 0.2;\n\n    #ifdef FORDEPTH\n    gl_FragColor = vec4(vDepthMetric, 0.0, 0.0, 1.0);\n    #else\n    gl_FragColor = vec4(Lo, 1.0);\n    #endif\n} ",o.M.ShadersStore["".concat(v,"VertexShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nuniform mat4 viewProjection;\n\n//uniform mat4 world;\n\nuniform vec3 playerPosition;\n\nuniform float time;\n\nuniform vec3 planetPosition;\nuniform mat4 planetWorld;\n\nvarying vec3 vPositionW;\nvarying vec2 vUV;\n\nvarying vec3 vNormalW;\n\nvarying vec3 vOriginalWorldPosition;\n\n// This is used to render the grass blade to the depth buffer properly\n// (see https://forum.babylonjs.com/t/how-to-write-shadermaterial-to-depthrenderer/47227/3 and https://playground.babylonjs.com/#6GFJNR#161)\n#ifdef FORDEPTH\nuniform vec2 depthValues;\nvarying float vDepthMetric;\n#endif\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// rotation using https://www.wikiwand.com/en/Rodrigues%27_rotation_formula\nvec3 rotateAround(vec3 vector, vec3 axis, float theta) {\n    // Please note that unit vector are required, i did not divided by the norms\n    return cos(theta) * vector + cross(axis, vector) * sin(theta) + axis * dot(axis, vector) * (1.0 - cos(theta));\n}\n\nfloat easeOut(float t, float a) {\n    return 1.0 - pow(1.0 - t, a);\n}\n\nfloat easeIn(float t, float alpha) {\n    return pow(t, alpha);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n#include<instancesDeclaration>\n\nvoid main() {\n    #include<instancesVertex>\n\n    mat4 worldMatrix = planetWorld * finalWorld;\n    \n    vec3 objectWorld = worldMatrix[3].xyz;\n    vOriginalWorldPosition = objectWorld;\n\n    // high frequency movement for wing flap\n    objectWorld.y += 0.1 * sin(5.0 * time + objectWorld.x * 10.0 + objectWorld.z * 10.0);\n    // low frequency movement of larger amplitude for general movement\n    objectWorld.y += 0.5 * sin(0.2 * time + objectWorld.x * 15.0 + objectWorld.z * 15.0);\n\n    vec3 butterflyForward = vec3(1.0, 0.0, 0.0);\n\n    float rotationY = sin(0.5 * time + vOriginalWorldPosition.x * 10.0 + vOriginalWorldPosition.z * 10.0) * 3.14;\n    vec3 rotatedPosition = rotateAround(position, vec3(0.0, 1.0, 0.0), rotationY);\n    butterflyForward = rotateAround(butterflyForward, vec3(0.0, 1.0, 0.0), rotationY);\n\n    vec3 flyPosition = rotateAround(rotatedPosition, butterflyForward, sign(position.z) * cos(10.0 * time + objectWorld.x * 10.0 + objectWorld.z * 10.0));\n    flyPosition.y += 3.0;\n\n    objectWorld += butterflyForward * 0.5 * sin(0.5 * time + vOriginalWorldPosition.x * 10.0 + vOriginalWorldPosition.z * 10.0);\n\n    // avoid the player\n    vec3 playerToButterfly = objectWorld - playerPosition;\n    playerToButterfly.y = 0.0;\n    float distanceToPlayer = length(playerToButterfly);\n    if (distanceToPlayer < 2.0) {\n        objectWorld += normalize(playerToButterfly) * (2.0 - distanceToPlayer);\n    }\n\n    worldMatrix[3].xyz = objectWorld;\n\n    vec4 outPosition = viewProjection * worldMatrix * vec4(flyPosition, 1.0);\n    gl_Position = outPosition;\n\n    vPositionW = vec3(worldMatrix * vec4(flyPosition, 1.0));\n    vUV = uv;\n\n    vNormalW = vec3(worldMatrix * vec4(normal, 0.0));\n\n    #ifdef FORDEPTH\n    vDepthMetric = (-gl_Position.z + depthValues.x) / (depthValues.y);\n    #endif\n}";var y=["#define INSTANCES"];r&&y.push("#define FORDEPTH");var g=d(Object.values(p)).concat(d(Object.values(s.T)));return r&&g.push("depthValues"),i=n,l=[v,t,v,{attributes:["position","normal","uv"],uniforms:g,defines:y,samplers:d(Object.values(m))}],i=u(i),c(h=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,f()?Reflect.construct(i,l||[],u(this).constructor):i.apply(this,l)),"elapsedSeconds",0),c(h,"stars",[]),c(h,"playerPosition",a.Pq.Zero()),c(h,"planet",null),c(h,"scene",void 0),h.backFaceCulling=!1,h.setTexture(m.BUTTERFLY_TEXTURE,e),h.onBindObservable.add(function(){(0,s.G)(h.getEffect(),h.stars),h.getEffect().setVector3(p.PLAYER_POSITION,h.playerPosition),h.getEffect().setFloat(p.TIME,h.elapsedSeconds);var e=h.scene.activeCamera;if(null===e)throw Error("No active camera in the scene");h.getEffect().setVector3(p.CAMERA_POSITION,e.globalPosition),null!==h.planet&&(h.getEffect().setVector3(p.PLANET_POSITION,h.planet.getAbsolutePosition()),h.getEffect().setMatrix(p.PLANET_WORLD,h.planet.getWorldMatrix()))}),h.scene=t,h}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&h(n,e),t=[{key:"setPlanet",value:function(e){this.planet=e}},{key:"update",value:function(e,t,n){this.elapsedSeconds+=n,this.stars=e,this.playerPosition=t}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(i.B),y=n(75540),g=n(40634),b=n(30723),S=n(1134);function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(A=function(){return!!e})()}var P=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");r=t,o=["SolarPanelNodeMaterial",n],r=w(r),(i=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,A()?Reflect.construct(r,o||[],w(this).constructor):r.apply(this,o))).mode=g.A.Material;var r,o,i,a=S.$Z("position"),s=S.$Z("normal"),l=S.xz(a),c=S.lK(l,S.fV(.01)),u=S.Lz(),h=S.yG(u,a),d=S.wr(u,s),f=S.PW(),p=S.yG(f,h),m=S.b5(p),v=S.se(e.albedo,c,{convertToLinearSpace:!0}),y=S.se(e.metallicRoughness,c),b=S.se(e.normal,c),T=S.u2(c,h,d,b.rgb,S.fV(1)),P=S.gs(),C=S.N1(),I=S.hG(v.rgb,y.r,y.g,null,T,d,P,C,h),E=S.rU(I);return i.addOutputNode(m),i.addOutputNode(E),i.build(),i}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e),t}(b.M);n(47521),n(99018),n(56654);var C=n(60333),I=n(90718),E=n(92327),R=n(13679),N=n(49917),O=n(26016),L=n(68730),x=n(72856),M=n(80805);let _=n.p+"b0307e888da1a4a8.glb",k=n.p+"e60661ae9f520622.glb",D=n.p+"5c97585dd9bae174.glb",j=n.p+"da2179984b81de22.glb",F=n.p+"6e3c8c4fac92769e.glb",U=n.p+"b6d3718e88ba4334.babylon";function G(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function B(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}var H=n(87948);function Y(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function W(e,t){var n;return(n=function(){var n,o,i,s;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(l){switch(l.label){case 0:return[4,(0,H.P)(e,t)];case 1:var c,u,h,d,f;return c=n=l.sent(),(u=new r.f("crateMaterial",e)).baseTexture=c.materials.crate.albedo,u.normalTexture=c.materials.crate.normal,u.metallicRoughnessTexture=c.materials.crate.metallicRoughness,(h=new r.f("treeMaterial",e)).backFaceCulling=!1,h.baseTexture=c.materials.tree.albedo,h.transparencyMode=1,d=o={butterfly:new v(c.particles.butterfly,e,!1),butterflyDepth:new v(c.particles.butterfly,e,!0),grass:new y.y(e,c.noises,!1),grassDepth:new y.y(e,c.noises,!0),crate:u,solarPanel:new P(c.materials.solarPanel,e),tree:h},i=(f=function(){var n,r,o,i,s,l,c,u,h,f,p,m,v,y,g,b,S,w,T,A,P,G,H,Y,W,z,q,V,J,X,Z,K,Q,$,ee,et,en,er,eo,ei;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(ea){switch(ea.label){case 0:var es,el,ec,eu,eh;return n=(0,M.x)("Wanderer",D,e,t),r=(0,M.x)("Banana",_,e,t),o=(0,x.f)(e,t),i=(0,M.x)("Rock",k,e,t),s=(0,L.jP)(e,t),l=(0,M.x)("Tree",U,e,t),c=(0,M.x)("SphericalTank",F,e,t),u=(0,M.x)("StationEngine",j,e,t),es=new Float32Array(18),el=new Uint32Array(12),ec=new Float32Array(12),es[0]=0,es[1]=0,es[2]=-1,es[3]=1,es[4]=0,es[5]=-1,es[6]=0,es[7]=0,es[8]=0,es[9]=1,es[10]=0,es[11]=0,es[12]=0,es[13]=0,es[14]=1,es[15]=1,es[16]=0,es[17]=1,el[0]=0,el[1]=1,el[2]=2,el[3]=1,el[4]=3,el[5]=2,el[6]=2,el[7]=3,el[8]=4,el[9]=3,el[10]=5,el[11]=4,ec[0]=0,ec[1]=0,ec[2]=0,ec[3]=1,ec[4]=.5,ec[5]=0,ec[6]=.5,ec[7]=1,ec[8]=1,ec[9]=0,ec[10]=1,ec[11]=1,(eu=new N.P).positions=es,eu.indices=el,eu.uvs=ec,eh=new C.e("butterfly",e),eu.applyToMesh(eh),eh.createNormals(!1),eh.scaling.scaleInPlace(.2),eh.bakeCurrentTransformIntoVertices(),(h=eh).isVisible=!1,h.material=d.butterfly,(f=[(0,O.R)(e,3),(0,O.R)(e,1)]).forEach(function(e){e.material=d.grass,e.isVisible=!1}),(p=I.P.CreateBox("crate",{size:1},e)).isVisible=!1,p.material=d.crate,[4,n];case 1:if(!B(v=(m=ea.sent()).rootNodes[0],C.e))throw Error("Wanderer root node is not a Mesh");y=!0,g=!1,b=void 0;try{for(S=v.getChildMeshes()[Symbol.iterator]();!(y=(w=S.next()).done);y=!0)w.value.isVisible=!1}catch(e){g=!0,b=e}finally{try{y||null==S.return||S.return()}finally{if(g)throw b}}return m.addAllToScene(),[4,r];case 2:if(!B(A=(T=ea.sent()).rootNodes[0],C.e))throw Error("Banana root node is not a Mesh");A.isVisible=!1,P=!0,G=!1,H=void 0;try{for(Y=A.getChildMeshes()[Symbol.iterator]();!(P=(W=Y.next()).done);P=!0)W.value.isVisible=!1}catch(e){G=!0,H=e}finally{try{P||null==Y.return||Y.return()}finally{if(G)throw H}}return T.addAllToScene(),[4,i];case 3:if(!B(q=(z=ea.sent()).meshes[1],C.e))throw Error("Rock root node is not a Mesh");return q.setParent(null),q.position.y=.1,q.scaling.scaleInPlace(.2),q.bakeCurrentTransformIntoVertices(),q.checkCollisions=!0,q.isVisible=!1,z.addAllToScene(),[4,l];case 4:if(!B(J=(V=ea.sent()).meshes[0],C.e))throw Error("Tree root node is not a Mesh");return J.position.y=-1,J.scaling.scaleInPlace(3),J.bakeCurrentTransformIntoVertices(),J.checkCollisions=!0,J.isVisible=!1,J.material=d.tree,V.addAllToScene(),[4,c];case 5:if(!B(Z=(X=ea.sent()).meshes[1],C.e))throw Error("SphericalTank root node is not a Mesh");return Z.parent=null,Z.isVisible=!1,X.addAllToScene(),Q=Math.max((K=Z.getBoundingInfo().boundingBox).extendSize.x,K.extendSize.y,K.extendSize.z),Z.scaling.scaleInPlace(20/Q),Z.bakeCurrentTransformIntoVertices(),($=new E.Ei(a.Pq.Zero(),50,e)).filterMembershipMask=R.H.ENVIRONMENT,$.filterCollideMask=R.H.DYNAMIC_OBJECTS,[4,u];case 6:if(!B(et=(ee=ea.sent()).meshes[1],C.e))throw Error("StationEngine root node is not a Mesh");return et.parent=null,et.isVisible=!1,ee.addAllToScene(),er=Math.max((en=et.getBoundingInfo().boundingBox).extendSize.x,en.extendSize.y,en.extendSize.z),et.scalingDeterminant=1/er,et.bakeCurrentTransformIntoVertices(),(eo=new E.P8(et,e)).filterMembershipMask=R.H.ENVIRONMENT,eo.filterCollideMask=R.H.DYNAMIC_OBJECTS,ei={stationEngine:{mesh:et,shape:eo},sphericalTank:{mesh:Z,shape:$},tree:J},[4,s];case 7:return ei.asteroids=ea.sent(),ei.rock=q,[4,o];case 8:return[2,(ei.characters=ea.sent(),ei.banana=A,ei.butterfly=h,ei.grassBlades=f,ei.crate=p,ei.wanderer=v,ei)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=f.apply(e,t);function i(e){G(o,n,r,i,a,"next",e)}function a(e){G(o,n,r,i,a,"throw",e)}i(void 0)})})(),s={textures:n,materials:o},[4,i];case 2:return[2,(s.objects=l.sent(),s)]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var i=n.apply(e,t);function a(e){Y(i,r,o,a,s,"next",e)}function s(e){Y(i,r,o,a,s,"throw",e)}a(void 0)})})()}},89148:function(e,t,n){"use strict";n.d(t,{s:()=>a});var r=n(61193);let o=n.p+"d5954b20303380f2.env";function i(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function a(e,t){var n;return(n=function(){var n;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(i){switch(i.label){case 0:return[4,(0,r.B)("SkyBox",o,e,t)];case 1:return(n=i.sent()).gammaSpace=!0,[2,{milkyWay:n}]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function s(e){i(a,r,o,s,l,"next",e)}function l(e){i(a,r,o,s,l,"throw",e)}s(void 0)})})()}},87948:function(e,t,n){"use strict";n.d(t,{P:()=>ec}),n(26782),n(26843);var r=n(89148),o=n(61193);let i=n.p+"bb01909a761dd59e.jpg",a=n.p+"eaaed7ccc2ba9921.jpg",s=n.p+"630a019530ef5704.jpg",l=n.p+"c27eac851ca5324d.jpg";function c(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}let u=n.p+"5a0389c9819910b2.webp",h=n.p+"ba9851bb6546d88f.webp",d=n.p+"0a7a7460ddabdd70.webp",f=n.p+"a3aae68d4719966d.webp",p=n.p+"1e47fc25c1073bdd.webp",m=n.p+"d9b456349313af00.webp",v=n.p+"e6f910f9884873e9.webp",y=n.p+"e2ff3db7e24fbc7a.webp",g=n.p+"d8d046275a87c35f.webp",b=n.p+"63b47212ac3ad70b.webp",S=n.p+"36102aa730fccc3a.webp",w=n.p+"f2bc8a6547293b4f.webp",T=n.p+"5c3376b24e8f22c1.webp",A=n.p+"cedbcb547f40a202.webp",P=n.p+"7a7f9368abcc4925.webp",C=n.p+"4426a618a251511f.webp",I=n.p+"b027272aef20767d.webp",E=n.p+"ccd633e2037ec2a9.webp",R=n.p+"77f1f5596fbda77f.webp",N=n.p+"dc81fac0ad5fc3c3.png";function O(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}let L=n.p+"f01f871552075b82.webp",x=n.p+"f70b1e3a5099bed8.png",M=n.p+"a653579ffe7db6db.png";function _(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}let k=n.p+"16eca2caa7a61bd2.png",D=n.p+"e04d4a485e268704.png";function j(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}let F=n.p+"657c4969867a13da.webp",U=n.p+"3956dd5ca7138625.webp",G=n.p+"1460dfe721946eba.webp",B=n.p+"d82ba9b844dffa1c.webp",H=n.p+"48c0a4d6b6efda89.webp",Y=n.p+"08eb16c8d8a9d2a0.webp",W=n.p+"0e9385c3fa9e1a9c.webp",z=n.p+"9f29d69203ea7014.webp";function q(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}var V=n(78930),J=n(8413),X=function(){var e;function t(e){var n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");n=void 0,"lut"in this?Object.defineProperty(this,"lut",{value:n,enumerable:!0,configurable:!0,writable:!0}):this.lut=n,void 0===V.M.ShadersStore.flatCloudsLUTFragmentShader&&(V.M.ShadersStore.flatCloudsLUTFragmentShader='//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nvarying vec2 vUV;\n\nuniform float worleyFrequency;\nuniform float detailFrequency;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define PI 3.1415926535897932384626433832795\n\n// Uv range: [0, 1]\nvec3 toSphere(in vec2 uv)\n{\n    float theta = 2.0 * PI * uv.x + - PI / 2.0;\n    float phi = PI * uv.y;\n\n    return vec3(\n        cos(theta) * sin(phi),\n        cos(phi),\n        sin(theta) * sin(phi)\n    );\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// Cellular noise ("Worley noise") in 3D in GLSL.\n// Copyright (c) Stefan Gustavson 2011-04-19. All rights reserved.\n// This code is released under the conditions of the MIT license.\n// See LICENSE file for details.\n\n// Permutation polynomial: (34x^2 + x) mod 289\nvec4 permuteWorley(vec4 x) {\n    return mod((34.0 * x + 1.0) * x, 289.0);\n}\nvec3 permuteWorley(vec3 x) {\n    return mod((34.0 * x + 1.0) * x, 289.0);\n}\n\n// Cellular noise, returning F1 and F2 in a vec2.\n// Speeded up by using 2x2x2 search window instead of 3x3x3,\n// at the expense of some pattern artifacts.\n// F2 is often wrong and has sharp discontinuities.\n// If you need a good F2, use the slower 3x3x3 version.\n\nfloat K = 0.142857142857;// 1/7\nfloat Ko = 0.428571428571;// 1/2-K/2\nfloat K2 = 0.020408163265306;// 1/(7*7)\nfloat Kz = 0.166666666667;// 1/6\nfloat Kzo = 0.416666666667;// 1/2-1/6*2\n\nfloat worley(vec3 P) {\n    vec3 Pi = mod(floor(P), 289.0);\n    vec3 Pf = fract(P);\n    vec4 Pfx = Pf.x + vec4(0.0, -1.0, 0.0, -1.0);\n    vec4 Pfy = Pf.y + vec4(0.0, 0.0, -1.0, -1.0);\n    vec4 p = permuteWorley(Pi.x + vec4(0.0, 1.0, 0.0, 1.0));\n    p = permuteWorley(p + Pi.y + vec4(0.0, 0.0, 1.0, 1.0));\n    vec4 p1 = permuteWorley(p + Pi.z);// z+0\n    vec4 p2 = permuteWorley(p + Pi.z + vec4(1.0));// z+1\n    vec4 ox1 = fract(p1*K) - Ko;\n    vec4 oy1 = mod(floor(p1*K), 7.0)*K - Ko;\n    vec4 oz1 = floor(p1*K2)*Kz - Kzo;// p1 < 289 guaranteed\n    vec4 ox2 = fract(p2*K) - Ko;\n    vec4 oy2 = mod(floor(p2*K), 7.0)*K - Ko;\n    vec4 oz2 = floor(p2*K2)*Kz - Kzo;\n    vec4 dx1 = Pfx + ox1;\n    vec4 dy1 = Pfy + oy1;\n    vec4 dz1 = Pf.z + oz1;\n    vec4 dx2 = Pfx + ox2;\n    vec4 dy2 = Pfy + oy2;\n    vec4 dz2 = Pf.z - 1.0 + oz2;\n    vec4 d1 = dx1 * dx1 + dy1 * dy1 + dz1 * dz1;// z+0\n    vec4 d2 = dx2 * dx2 + dy2 * dy2 + dz2 * dz2;// z+1\n\n    // Sort out the two smallest distances (F1, F2)\n    // Cheat and sort out only F1\n    d1 = min(d1, d2);\n    d1.xy = min(d1.xy, d1.wz);\n    d1.x = min(d1.x, d1.y);\n    return sqrt(d1.x);\n}\n\nfloat completeWorley(vec3 p, int nbOctaves, float decay, float lacunarity) {\n    float totalAmplitude = 0.0;\n    float value = 0.0;\n    for (int i = 0; i < nbOctaves; ++i) {\n        totalAmplitude += 1.0 / pow(decay, float(i));\n        vec3 samplePoint = p * pow(lacunarity, float(i));\n        value += worley(samplePoint) / pow(decay, float(i));\n    }\n    return value / totalAmplitude;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\n\nfloat completeNoise(vec3 p, int nbOctaves, float decay, float lacunarity) {\n    float totalAmplitude = 0.0;\n    float amp = 1.0;\n    float samplePointMultiplier = 1.0;\n    float value = 0.0;\n    for(int i = 0; i < nbOctaves; i++) {\n        amp /= decay;\n        samplePointMultiplier *= lacunarity;\n        totalAmplitude += amp;\n        vec3 samplePoint = p * samplePointMultiplier;\n        value += amp * noise(samplePoint);\n    }\n    return value / totalAmplitude;\n}\n\nvoid main() {\n    vec3 sphere = toSphere(vUV);\n\n    float worley = completeWorley(sphere * worleyFrequency, 4, 2.0, 2.0);\n    float detailNoise = completeNoise(sphere * detailFrequency, 8, 2.0, 2.0);\n\n    gl_FragColor = vec4(vec3(1.0 - worley, detailNoise, 0.0), 1.0);\n}'),this.lut=new J.p("flatCloudLUT",4096,"flatCloudsLUT",e,void 0,!0,!1),this.lut.refreshRate=0}return e=[{key:"isReady",value:function(){return this.lut.isReady()}},{key:"setModel",value:function(e){this.lut.setFloat("worleyFrequency",e.frequency),this.lut.setFloat("detailFrequency",e.detailFrequency),this.lut.resetRefreshCounter()}},{key:"getTexture",value:function(){return this.lut}},{key:"dispose",value:function(){this.lut.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),Z=n(26067),K=function(){var e;function t(e){var n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");n=void 0,"lut"in this?Object.defineProperty(this,"lut",{value:n,enumerable:!0,configurable:!0,writable:!0}):this.lut=n,void 0===V.M.ShadersStore.telluricPlanetLutFragmentShader&&(V.M.ShadersStore.telluricPlanetLutFragmentShader="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nvarying vec2 vUV;\n\nuniform float minTemperature;\nuniform float maxTemperature;\n\nuniform float pressure;\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\n\nfloat completeNoise(vec3 p, int nbOctaves, float decay, float lacunarity) {\n    float totalAmplitude = 0.0;\n    float amp = 1.0;\n    float samplePointMultiplier = 1.0;\n    float value = 0.0;\n    for(int i = 0; i < nbOctaves; i++) {\n        amp /= decay;\n        samplePointMultiplier *= lacunarity;\n        totalAmplitude += amp;\n        vec3 samplePoint = p * samplePointMultiplier;\n        value += amp * noise(samplePoint);\n    }\n    return value / totalAmplitude;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define PI 3.1415926535897932384626433832795\n\n// Uv range: [0, 1]\nvec3 toSphere(in vec2 uv)\n{\n    float theta = 2.0 * PI * uv.x + - PI / 2.0;\n    float phi = PI * uv.y;\n\n    return vec3(\n        cos(theta) * sin(phi),\n        cos(phi),\n        sin(theta) * sin(phi)\n    );\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// https://www.omnicalculator.com/chemistry/boiling-point\n// https://www.wikiwand.com/en/Boiling_point#/Saturation_temperature_and_pressure\n// https://www.desmos.com/calculator/ctxerbh48s\n\n/**\n * @param {number} pressure in pascal\n * @returns {number} water boiling temperature in Kelvin\n*/\nfloat waterBoilingTemperature(float pressure) {\n    float P1 = 101325.0;// sea level pressure on Earth in pascal\n    float P2 = pressure;\n    float T1 = 273.15 + 100.0;// boiling point of water at sea level on Earth in Kelvin\n    float DH = 40660.0;\n    float R = 8.314;\n    if (P2 <= 0.0) return 0.0;// when pressure is 0, water cannot exist in liquid state\n    return 1.0 / (1.0 / T1 + log(P1 / P2) * (R / DH));\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat smoothSharpener(float x, float s) {\n    float offset = 0.5 - (1.0 / s);\n    return smoothstep(offset, 1.0 - offset, x);\n}\n\nvoid main() {\n    vec3 sphere = toSphere(vUV);\n\n    float waterMeltingPoint = 273.15;// fairly good approximation\n    float waterMeltingPoint01 = remap(waterMeltingPoint, minTemperature, maxTemperature, 0.0, 1.0);\n    float waterBoilingPoint01 = remap(waterBoilingTemperature(pressure), minTemperature, maxTemperature, 0.0, 1.0);\n\n    float moisture01 = completeNoise(sphere * 2.0, 5, 2.0, 2.0) * sqrt(1.0 - waterMeltingPoint01) * waterBoilingPoint01;\n    moisture01 = smoothSharpener(moisture01, 2.0);\n    moisture01 = clamp(moisture01, 0.0, 1.0);\n\n    vec3 domainWarping = 2.0 * vec3(\n        completeNoise(sphere + vec3(23.0, 57.0, -18.0), 5, 2.0, 2.0),\n        completeNoise(sphere + vec3(57.0, -18.0, 23.0), 5, 2.0, 2.0),\n        completeNoise(sphere + vec3(-18.0, 23.0, 57.0), 5, 2.0, 2.0)\n    ) - 0.5;\n\n    float noise = completeNoise(domainWarping + sphere * 10.0, 5, 2.0, 2.0);\n\n    gl_FragColor = vec4(moisture01, noise, 0.0, 0.0);\n}"),this.lut=new J.p("TelluricPlanetMaterialLut",4096,"telluricPlanetLut",e,null,!0,!1),this.lut.refreshRate=0}return e=[{key:"setPlanetPhysicsInfo",value:function(e,t,n){this.lut.setFloat("minTemperature",e),this.lut.setFloat("maxTemperature",t),this.lut.setFloat("pressure",n),this.lut.resetRefreshCounter()}},{key:"getTexture",value:function(){return this.lut}},{key:"dispose",value:function(){this.lut.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),Q=function(){var e;function t(e){var n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");n=void 0,"lut"in this?Object.defineProperty(this,"lut",{value:n,enumerable:!0,configurable:!0,writable:!0}):this.lut=n,void 0===V.M.ShadersStore.starLutFragmentShader&&(V.M.ShadersStore.starLutFragmentShader="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nvarying vec2 vUV;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\n\nfloat completeNoise(vec3 p, int nbOctaves, float decay, float lacunarity) {\n    float totalAmplitude = 0.0;\n    float amp = 1.0;\n    float samplePointMultiplier = 1.0;\n    float value = 0.0;\n    for(int i = 0; i < nbOctaves; i++) {\n        amp /= decay;\n        samplePointMultiplier *= lacunarity;\n        totalAmplitude += amp;\n        vec3 samplePoint = p * samplePointMultiplier;\n        value += amp * noise(samplePoint);\n    }\n    return value / totalAmplitude;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define PI 3.1415926535897932384626433832795\n\n// Uv range: [0, 1]\nvec3 toSphere(in vec2 uv)\n{\n    float theta = 2.0 * PI * uv.x + - PI / 2.0;\n    float phi = PI * uv.y;\n\n    return vec3(\n        cos(theta) * sin(phi),\n        cos(phi),\n        sin(theta) * sin(phi)\n    );\n}\n\nvoid main() {\n    vec3 sphere = toSphere(vUV);\n\n    vec3 domainWarping = 0.5 * vec3(\n    completeNoise(sphere + vec3(23.0, 57.0, -18.0), 5, 2.0, 2.0),\n    completeNoise(sphere + vec3(57.0, -18.0, 23.0), 5, 2.0, 2.0),\n    completeNoise(sphere + vec3(-18.0, 23.0, 57.0), 5, 2.0, 2.0)\n    ) - 0.5;\n\n    float noise = completeNoise(domainWarping + sphere * 10.0, 5, 2.0, 2.0);\n\n    gl_FragColor = vec4(noise, 0.0, 0.0, 0.0);\n}"),this.lut=new J.p("StarMaterialLut",256,"starLut",e,null,!0,!1),this.lut.refreshRate=0}return e=[{key:"getTexture",value:function(){return this.lut}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),$=n(73321),ee=n(39042),et=n(13679),en=function(){var e;function t(){var e,n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");e="landingPadTextures",n=new Map,e in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n}return e=[{key:"get",value:function(e,t){var n=this.landingPadTextures.get(e);if(void 0!==n)return n;var r=new ee.R("PadNumberTexture".concat(e),{width:1024,height:1024*et.w.LANDING_PAD_ASPECT_RATIO},t,!0),o="bold 256px ".concat(et.w.MAIN_FONT);return r.drawText("".concat(e),null,null,o,"white",null,!0,!0),this.landingPadTextures.set(e,r),r}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();let er=n.p+"6bfa0b52cc6e9769.webp",eo=n.p+"7bd5c10d031e6089.webp",ei=n.p+"66f8db04aeb27e05.png",ea=n.p+"9bc839a5f66dab27.jpg",es=n.p+"ed5f605a49d26fc4.jpg";function el(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function ec(e,t){var n;return(n=function(){var n,V,J,ee,et,el,ec,eu,eh,ed,ef,ep,em;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(ev){var ey,eg,eb,eS,ew;switch(ev.label){case 0:return n=(0,o.Q)("WaterNormalMap1",ea,e,t),V=(0,o.Q)("WaterNormalMap2",es,e,t),J=(0,o.Q)("EmptyTexture",er,e,t),ee=(0,o.Q)("SeamlessPerlin",eo,e,t),et=(0,r.s)(e,t),el=(ey=function(){var n,r,i,a,s,l,c,u,h,d,f,p,m;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(v){switch(v.label){case 0:return n=(0,o.Q)("RockNormalMetallicMap",Y,e,t),r=(0,o.Q)("RockAlbedoRoughnessMap",H,e,t),i=(0,o.Q)("GrassNormalMetallicMap",U,e,t),a=(0,o.Q)("GrassAlbedoRoughnessMap",F,e,t),s=(0,o.Q)("SnowNormalMetallicMap",B,e,t),l=(0,o.Q)("SnowAlbedoRoughness",G,e,t),c=(0,o.Q)("SandNormalMetallicMap",z,e,t),u=(0,o.Q)("SandAlbedoRoughnessMap",W,e,t),h={},d={},[4,n];case 1:return d.normalMetallic=v.sent(),[4,r];case 2:return h.rock=(d.albedoRoughness=v.sent(),d),f={},[4,i];case 3:return f.normalMetallic=v.sent(),[4,a];case 4:return h.grass=(f.albedoRoughness=v.sent(),f),p={},[4,s];case 5:return p.normalMetallic=v.sent(),[4,l];case 6:return h.snow=(p.albedoRoughness=v.sent(),p),m={},[4,c];case 7:return m.normalMetallic=v.sent(),[4,u];case 8:return[2,(h.sand=(m.albedoRoughness=v.sent(),m),h)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=ey.apply(e,t);function i(e){q(o,n,r,i,a,"next",e)}function a(e){q(o,n,r,i,a,"throw",e)}i(void 0)})})(),ec=(eg=function(){var n,r,i,a;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(s){switch(s.label){case 0:return n=(0,o.Q)("PlumeParticle",M,e,t),r=(0,o.Q)("FlareTexture",x,e,t),i=(0,o.Q)("Butterfly",L,e,t),a={},[4,n];case 1:return a.plume=s.sent(),[4,r];case 2:return a.flare=s.sent(),[4,i];case 3:return[2,(a.butterfly=s.sent(),a)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=eg.apply(e,t);function i(e){_(o,n,r,i,a,"next",e)}function a(e){_(o,n,r,i,a,"throw",e)}i(void 0)})})(),eu=(eb=function(){var n,r,i,a,s,l,c,O,L,x,M,_,k,D,j,F,U,G,B,H,Y,W,z,q,V,J,X;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(Z){switch(Z.label){case 0:return n=(0,o.Q)("SolarPanelAlbedo",A,e,t),r=(0,o.Q)("SolarPanelNormal",P,e,t),i=(0,o.Q)("SolarPanelMetallicRoughness",T,e,t),a=(0,o.Q)("SpaceStationAlbedo",I,e,t),s=(0,o.Q)("SpaceStationNormal",R,e,t),l=(0,o.Q)("SpaceStationMetallicRoughness",C,e,t),c=(0,o.Q)("SpaceStationAmbientOcclusion",E,e,t),O=(0,o.Q)("MetalPanelsAlbedo",b,e,t),L=(0,o.Q)("MetalPanelsNormal",w,e,t),x=(0,o.Q)("MetalPanelsMetallicRoughness",g,e,t),M=(0,o.Q)("MetalPanelsAmbientOcclusion",S,e,t),_=(0,o.Q)("TreeAlbedo",N,e,t),k=(0,o.Q)("ConcreteAlbedo",p,e,t),D=(0,o.Q)("ConcreteNormal",y,e,t),j=(0,o.Q)("ConcreteMetallicRoughness",v,e,t),F=(0,o.Q)("ConcreteAmbientOcclusion",m,e,t),U=(0,o.Q)("CrateAlbedo",u,e,t),G=(0,o.Q)("CrateNormal",f,e,t),B=(0,o.Q)("CrateMetallicRoughness",d,e,t),H=(0,o.Q)("CrateAmbientOcclusion",h,e,t),[4,_];case 1:return(Y=Z.sent()).hasAlpha=!0,W={},z={},[4,n];case 2:return z.albedo=Z.sent(),[4,r];case 3:return z.normal=Z.sent(),[4,i];case 4:return W.solarPanel=(z.metallicRoughness=Z.sent(),z),q={},[4,a];case 5:return q.albedo=Z.sent(),[4,s];case 6:return q.normal=Z.sent(),[4,l];case 7:return q.metallicRoughness=Z.sent(),[4,c];case 8:return W.spaceStation=(q.ambientOcclusion=Z.sent(),q),V={},[4,O];case 9:return V.albedo=Z.sent(),[4,L];case 10:return V.normal=Z.sent(),[4,x];case 11:return V.metallicRoughness=Z.sent(),[4,M];case 12:return W.metalPanels=(V.ambientOcclusion=Z.sent(),V),J={},[4,k];case 13:return J.albedo=Z.sent(),[4,D];case 14:return J.normal=Z.sent(),[4,j];case 15:return J.metallicRoughness=Z.sent(),[4,F];case 16:return W.concrete=(J.ambientOcclusion=Z.sent(),J),X={},[4,U];case 17:return X.albedo=Z.sent(),[4,G];case 18:return X.normal=Z.sent(),[4,B];case 19:return X.metallicRoughness=Z.sent(),[4,H];case 20:return[2,(W.crate=(X.ambientOcclusion=Z.sent(),X),W.tree={albedo:Y},W)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=eb.apply(e,t);function i(e){O(o,n,r,i,a,"next",e)}function a(e){O(o,n,r,i,a,"throw",e)}i(void 0)})})(),eh=(eS=function(){var n,r,c,u,h;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(d){switch(d.label){case 0:return n=(0,o.Q)("JupiterTexture",i,e,t),r=(0,o.Q)("SaturnTexture",s,e,t),c=(0,o.Q)("UranusTexture",l,e,t),u=(0,o.Q)("NeptuneTexture",a,e,t),h={},[4,n];case 1:return h.jupiter=d.sent(),[4,r];case 2:return h.saturn=d.sent(),[4,c];case 3:return h.uranus=d.sent(),[4,u];case 4:return[2,(h.neptune=d.sent(),h)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=eS.apply(e,t);function i(e){c(o,n,r,i,a,"next",e)}function a(e){c(o,n,r,i,a,"throw",e)}i(void 0)})})(),ed=(ew=function(){var n,r,i;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(a){switch(a.label){case 0:return n=(0,o.Q)("SaturnRingsTexture",k,e,t),r=(0,o.Q)("UranusRingsTexture",D,e,t),i={},[4,n];case 1:return i.saturn=a.sent(),[4,r];case 2:return[2,(i.uranus=a.sent(),i)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=ew.apply(e,t);function i(e){j(o,n,r,i,a,"next",e)}function a(e){j(o,n,r,i,a,"throw",e)}i(void 0)})})(),ef={},[4,el];case 1:return ef.terrains=ev.sent(),ep={},[4,n];case 2:return ep.normalMap1=ev.sent(),[4,V];case 3:return ef.water=(ep.normalMap2=ev.sent(),ep),[4,ec];case 4:return ef.particles=ev.sent(),[4,eu];case 5:return ef.materials=ev.sent(),[4,eh];case 6:return ef.gasPlanet=ev.sent(),[4,ed];case 7:return ef.rings=ev.sent(),[4,et];case 8:return ef.environment=ev.sent(),em={},[4,ee];case 9:return ef.noises=(em.seamlessPerlin=ev.sent(),em),ef.ui={cursorImageUrl:ei},[4,J];case 10:return[2,(ef.empty=ev.sent(),ef.pools={cloudsLut:new $.K(function(){return new X(e)}),ringsPatternLut:new $.K(function(){return new Z.q(e)}),starMaterialLut:new $.K(function(){return new Q(e)}),telluricPlanetMaterialLut:new $.K(function(){return new K(e)}),landingPad:new en},ef)]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var i=n.apply(e,t);function a(e){el(i,r,o,a,s,"next",e)}function s(e){el(i,r,o,a,s,"throw",e)}a(void 0)})})()}},61193:function(e,t,n){"use strict";n.d(t,{B:()=>c,Q:()=>l});var r=n(18008),o=n(92771);function i(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,l,"next",e)}function l(e){i(a,r,o,s,l,"throw",e)}s(void 0)})}}function s(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function l(e,t,n,r){return a(function(){var i;return s(this,function(a){switch(a.label){case 0:return null==r||r.startTask(),[4,new Promise(function(r){var i=new o.g(t,n,!1,!1,void 0,function(){r(i)});i.name=e})];case 1:return i=a.sent(),null==r||r.completeTask(),[2,i]}})})()}function c(e,t,n,o){return a(function(){var i;return s(this,function(a){switch(a.label){case 0:return null==o||o.startTask(),[4,new Promise(function(o){var i=r.b.CreateFromPrefilteredData(t,n);i.onLoadObservable.add(function(){o(i)}),i.name=e})];case 1:return i=a.sent(),null==o||o.completeTask(),[2,i]}})})()}},7661:function(e,t,n){"use strict";n.d(t,{U:()=>r});var r={STAR_SYSTEM_VIEW:1,STAR_MAP_VIEW:2,HYPER_SPACE:4}},85883:function(e,t,n){"use strict";n.d(t,{Y:()=>w}),n(10426);var r=n(11569),o=n(82060),i=n(74334),a=n(36801),s=n(36044),l=n(1831),c=n(9323),u=n(96824),h=n(13679),d=n(82886);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}var b=function(){function e(t,n,r,o){p(this,e),y(this,"name",void 0),y(this,"group",void 0),y(this,"weight",void 0),this.name=t,this.weight=r,this.group=n,this.group.play(o),this.group.setWeightForAllAnimatables(r)}return v(e,[{key:"moveTowardsWeight",value:function(e,t){this.weight=Math.min(Math.max(this.weight+t*Math.sign(e-this.weight),0),1),this.group.setWeightForAllAnimatables(this.weight)}}]),e}(),S=function e(t,n){p(this,e),y(this,"idleAnimation",void 0),y(this,"nonIdleAnimations",void 0),y(this,"currentAnimation",void 0),this.idleAnimation=t,this.nonIdleAnimations=n,this.currentAnimation=t},w=function(){function e(t,n){var c,u=this;p(this,e),y(this,"character",void 0),y(this,"characterNode",void 0),y(this,"skeleton",void 0),y(this,"headTransform",void 0),y(this,"firstPersonCamera",void 0),y(this,"thirdPersonCamera",void 0),y(this,"activeCamera",void 0),y(this,"characterWalkSpeed",1.8),y(this,"characterWalkSpeedBackwards",1.2),y(this,"characterRunSpeed",3.6),y(this,"characterRotationSpeed",6),y(this,"characterSwimSpeed",1.5),y(this,"idleAnim",void 0),y(this,"walkAnim",void 0),y(this,"walkBackAnim",void 0),y(this,"sambaAnim",void 0),y(this,"runningAnim",void 0),y(this,"swimmingIdleAnim",void 0),y(this,"swimmingForwardAnim",void 0),y(this,"jumpingAnim",void 0),y(this,"fallingIdleAnim",void 0),y(this,"skyDivingAnim",void 0),y(this,"nonIdleAnimations",void 0),y(this,"targetAnim",null),y(this,"groundedState",void 0),y(this,"fallingState",void 0),y(this,"swimmingState",void 0),y(this,"currentAnimationState",void 0),y(this,"closestWalkableObject",null),y(this,"distanceToGround",0),y(this,"raycastResult",new l.G),y(this,"scene",void 0),y(this,"jumpVelocity",a.Pq.Zero()),this.scene=n,this.character=t,this.getTransform().rotationQuaternion=i.PT.Identity();var f=n.getAnimationGroupByName("WalkingForward");if(null===f)throw Error("'WalkingForward' animation not found");var m=n.getAnimationGroupByName("WalkingBackwards");if(null===m)throw Error("'WalkingBackwards' animation not found");var v=n.getAnimationGroupByName("WalkingIdle");if(null===v)throw Error("'WalkingIdle' animation not found");var g=n.getAnimationGroupByName("Samba");if(null===g)throw Error("'Samba' animation not found");var w=n.getAnimationGroupByName("Running");if(null===w)throw Error("'Running' animation not found");var T=n.getAnimationGroupByName("FallingIdle");if(null===T)throw Error("'FallingIdle' animation not found");var A=n.getAnimationGroupByName("SkyDiving");if(null===A)throw Error("'SkyDiving' animation not found");var P=n.getAnimationGroupByName("SwimmingIdle");if(null===P)throw Error("'SwimmingIdle' animation not found");var C=n.getAnimationGroupByName("SwimmingForward");if(null===C)throw Error("'SwimmingForward' animation not found");var I=n.getAnimationGroupByName("Jumping");if(null===I)throw Error("'Jumping' animation not found");this.idleAnim=new b("idle",v,1,!0),this.walkAnim=new b("walk",f,0,!0),this.walkBackAnim=new b("walkBack",m,0,!0),this.sambaAnim=new b("samba",g,0,!0),this.runningAnim=new b("running",w,0,!0),this.fallingIdleAnim=new b("fallingIdle",T,0,!0),this.skyDivingAnim=new b("skydiving",A,0,!0),this.swimmingIdleAnim=new b("swimming",P,0,!0),this.swimmingForwardAnim=new b("swimmingForward",C,0,!0),this.jumpingAnim=new b("jumping",I,0,!1),this.nonIdleAnimations=[this.walkAnim,this.walkBackAnim,this.sambaAnim,this.runningAnim,this.fallingIdleAnim,this.jumpingAnim,this.skyDivingAnim,this.swimmingIdleAnim,this.swimmingForwardAnim],this.groundedState=new S(this.idleAnim,[this.walkAnim,this.walkBackAnim,this.sambaAnim,this.runningAnim]),this.fallingState=new S(this.fallingIdleAnim,[this.skyDivingAnim]),this.swimmingState=new S(this.swimmingIdleAnim,[this.swimmingForwardAnim]),this.currentAnimationState=this.groundedState,this.targetAnim=this.idleAnim,this.firstPersonCamera=new o.S("characterFirstPersonCamera",a.Pq.Zero(),n),this.firstPersonCamera.speed=0,this.firstPersonCamera.minZ=1,this.firstPersonCamera.parent=this.getTransform();var E=null==(c=this.character.getChildMeshes().find(function(e){return null!==e.skeleton}))?void 0:c.skeleton;if(null==E)throw Error("Skeleton not found");this.skeleton=E;var R=this.character.getChildMeshes().find(function(e){return e.name.includes("Alpha_Joints")});if(void 0===R)throw Error("Could not find the Alpha_Joints node in the character mesh");this.characterNode=R;var N=E.getBoneIndexByName("mixamorig:HeadTop_End"),O=E.bones[N];if(void 0===O)throw Error("Could not find the head bone in the skeleton");this.headTransform=new s.VR0("headTransform",n),this.headTransform.scaling.scaleInPlace(20),this.headTransform.attachToBone(O,R),this.thirdPersonCamera=new r.Lq("characterThirdPersonCamera",-1,Math.PI/3,10,new a.Pq(0,1.5,0),n),this.thirdPersonCamera.lowerRadiusLimit=2,this.thirdPersonCamera.upperRadiusLimit=500,this.thirdPersonCamera.minZ=1,this.thirdPersonCamera.maxZ=5*h.w.EARTH_RADIUS,this.thirdPersonCamera.wheelPrecision*=3,this.thirdPersonCamera.parent=this.getTransform(),this.activeCamera=this.firstPersonCamera,this.setFirstPersonCameraActive(),d.b.map.toggleCamera.on("complete",function(){u.getActiveCamera()===u.thirdPersonCamera?u.setFirstPersonCameraActive():u.setThirdPersonCameraActive()})}return v(e,[{key:"setFirstPersonCameraActive",value:function(){this.activeCamera=this.firstPersonCamera,this.character.getChildMeshes().forEach(function(e){e.setEnabled(!1)})}},{key:"setThirdPersonCameraActive",value:function(){this.activeCamera=this.thirdPersonCamera,this.character.getChildMeshes().forEach(function(e){e.setEnabled(!0)})}},{key:"setClosestWalkableObject",value:function(e){this.closestWalkableObject=e}},{key:"getActiveCamera",value:function(){return this.activeCamera}},{key:"getCameras",value:function(){return[this.firstPersonCamera,this.thirdPersonCamera]}},{key:"getTransform",value:function(){return this.character}},{key:"shouldLockPointer",value:function(){return!0}},{key:"update",value:function(e){var t=this.getTransform().getWorldMatrix().clone().invert();this.firstPersonCamera.position=a.Pq.TransformCoordinates(this.headTransform.getAbsolutePosition(),t),this.getTransform().rotate(i._0.Y,this.firstPersonCamera.rotation.y-Math.PI,i.$x.LOCAL),this.getTransform().computeWorldMatrix(!0),this.firstPersonCamera.rotation.y=Math.PI,this.firstPersonCamera.getViewMatrix(!0);var n=this.getTransform(),r=n.getAbsolutePosition().add(n.up.scale(5e4)),o=n.position.add(n.up.scale(-5e4));if(this.currentAnimationState===this.fallingState&&(this.jumpVelocity.addInPlace(n.up.scale(-9.8*e)),(0,c.Tl)(n,this.jumpVelocity.scale(e))),null!==this.closestWalkableObject){var s=n.getAbsolutePosition().subtract(this.closestWalkableObject.getTransform().getAbsolutePosition()).normalize();(0,c.Pf)(n,s)}if(this.scene.getPhysicsEngine().raycastToRef(r,o,this.raycastResult,{collideWith:h.H.ENVIRONMENT}),this.raycastResult.hasHit){var l=n.up,p=a.Pq.Dot(n.getAbsolutePosition().subtract(this.raycastResult.hitPointWorld),l);if(null!==this.closestWalkableObject&&g(this.closestWalkableObject,u.R)){var m,v,y=(null!=(v=null==(m=this.closestWalkableObject.model.ocean)?void 0:m.depth)?v:0)+this.closestWalkableObject.getRadius();p=Math.min(p,a.Pq.Distance(this.getTransform().getAbsolutePosition(),this.closestWalkableObject.getTransform().getAbsolutePosition())-y+1.3)}if(p<=.1){if((0,c.Tl)(n,l.scale(-p)),null!==this.closestWalkableObject&&g(this.closestWalkableObject,u.R)){var b,S,w=(null!=(S=null==(b=this.closestWalkableObject.model.ocean)?void 0:b.depth)?S:0)+this.closestWalkableObject.getRadius();a.Pq.Distance(this.getTransform().getAbsolutePosition(),this.closestWalkableObject.getTransform().getAbsolutePosition())-w<0?this.currentAnimationState=this.swimmingState:this.currentAnimationState=this.groundedState}else this.currentAnimationState=this.groundedState;this.distanceToGround=0,this.jumpVelocity=a.Pq.Zero()}else this.currentAnimationState=this.fallingState,this.distanceToGround=p}else this.currentAnimationState=this.fallingState,this.distanceToGround=5e4;var T=a.Pq.Zero();this.walkAnim.weight>0&&this.character.moveWithCollisions(this.character.forward.scaleInPlace(-this.characterWalkSpeed*e*this.walkAnim.weight)),this.walkBackAnim.weight>0&&this.character.moveWithCollisions(this.character.forward.scaleInPlace(this.characterWalkSpeedBackwards*e*this.walkBackAnim.weight)),this.runningAnim.weight>0&&this.character.moveWithCollisions(this.character.forward.scaleInPlace(-this.characterRunSpeed*e*this.runningAnim.weight));var A=(M=d.b.map.move.value,function(e){if(Array.isArray(e))return e}(M)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(M,2)||function(e,t){if(e){if("string"==typeof e)return f(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}}(M,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),P=A[0],C=A[1];this.currentAnimationState===this.swimmingState?(this.swimmingState.currentAnimation=this.swimmingIdleAnim,C>0&&(this.swimmingState.currentAnimation=this.swimmingForwardAnim,this.character.moveWithCollisions(this.character.forward.scaleInPlace(-this.characterSwimSpeed*e)))):this.currentAnimationState===this.groundedState?(this.groundedState.currentAnimation=this.idleAnim,C>0?this.groundedState.currentAnimation=this.walkAnim:C<0?this.groundedState.currentAnimation=this.walkBackAnim:d.b.map.run.value>0&&(this.groundedState.currentAnimation=this.runningAnim),d.b.map.samba.value>0&&(this.groundedState.currentAnimation=this.sambaAnim),"complete"===d.b.map.jump.state&&(this.targetAnim=this.jumpingAnim,this.jumpingAnim.weight=1,this.jumpingAnim.group.stop(),this.jumpingAnim.group.play(),this.currentAnimationState=this.fallingState,this.jumpVelocity=this.character.up.scale(10).add(this.character.forward.scale(-5)))):this.currentAnimationState===this.fallingState&&(this.distanceToGround<30?this.fallingState.currentAnimation=this.fallingIdleAnim:this.fallingState.currentAnimation=this.skyDivingAnim),this.targetAnim=this.currentAnimationState.currentAnimation;var I=this.currentAnimationState.currentAnimation!==this.currentAnimationState.idleAnimation;if(this.activeCamera===this.thirdPersonCamera&&I){var E=-Math.sign(P)*this.characterRotationSpeed*e;this.character.rotate(a.Pq.Up(),E),this.thirdPersonCamera.alpha+=E;var R=this.thirdPersonCamera.target;R.applyRotationQuaternionInPlace(i.PT.RotationAxis(a.Pq.Up(),-E)),this.thirdPersonCamera.target=R}else this.activeCamera===this.firstPersonCamera&&T.addInPlace(this.character.right.scale(P*this.characterWalkSpeed*e));var N=0,O=!0,L=!1,x=void 0;try{for(var M,_,k=this.nonIdleAnimations[Symbol.iterator]();!(O=(_=k.next()).done);O=!0){var D=_.value;D===this.targetAnim?D.moveTowardsWeight(1,e):D.moveTowardsWeight(0,e),N+=D.weight}}catch(e){L=!0,x=e}finally{try{O||null==k.return||k.return()}finally{if(L)throw x}}return this.idleAnim.moveTowardsWeight(Math.min(Math.max(1-N,0),1),e),this.character.computeWorldMatrix(!0),(0,c.Tl)(this.getTransform(),T),this.getActiveCamera().getViewMatrix(),T}},{key:"dispose",value:function(){this.character.dispose(),this.firstPersonCamera.dispose(),this.thirdPersonCamera.dispose()}}]),e}()},82886:function(e,t,n){"use strict";n.d(t,{b:()=>b});var r=n(54060),o=n(92487),i=n(86283),a=n(31272),s=n(16533),l=a._.KEYBOARD,c=new o.A({up:l.getControl("KeyW"),left:l.getControl("KeyA"),down:l.getControl("KeyS"),right:l.getControl("KeyD")}),u=new r.A({bindings:[c]}),h=l.getControl("Space"),d=new r.A({bindings:[h]}),f=new i.A(d),p=l.getControl("KeyX"),m=new r.A({bindings:[p]}),v=l.getControl("ShiftLeft"),y=new r.A({bindings:[v]}),g=new i.A(new r.A({bindings:[l.getControl("KeyB")]})),b=new s.X("CharacterInputs",{move:u,jump:f,samba:m,run:y,toggleCamera:g});b.setEnabled(!1)},61955:function(e,t,n){"use strict";n.d(t,{w:()=>f});var r=n(82060),o=n(74334),i=n(36801),a=n(36044),s=n(53843),l=n(32648),c=n(9323),u=n(13679),h=n(17966);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");d(this,"transform",void 0),d(this,"camera",void 0),d(this,"speed",1),d(this,"rotationSpeed",Math.PI/4),d(this,"inertia",i.Pq.Zero()),d(this,"rotationInertia",i.Pq.Zero()),this.transform=new a.VR0("playerController",e),this.transform.rotationQuaternion=o.PT.Identity(),this.camera=new r.S("defaultFirstPersonCamera",i.Pq.Zero(),e),this.camera.parent=this.transform,this.camera.speed=0,this.camera.fov=u.w.FOV,this.camera.rotationQuaternion=o.PT.Identity()}return e=[{key:"getCameras",value:function(){return[this.camera]}},{key:"getActiveCamera",value:function(){return this.camera}},{key:"getTransform",value:function(){return this.transform}},{key:"shouldLockPointer",value:function(){return!1}},{key:"update",value:function(e){this.rotationInertia.x=(0,l.aJ)(this.rotationInertia.x,h.Z.map.roll.value,.07,e),this.rotationInertia.y=(0,l.aJ)(this.rotationInertia.y,h.Z.map.pitch.value,.07,e),this.rotationInertia.z=(0,l.aJ)(this.rotationInertia.z,h.Z.map.yaw.value,.07,e),(0,c.CL)(this.transform,this.rotationInertia.x*this.rotationSpeed*e),(0,c.H7)(this.transform,this.rotationInertia.y*this.rotationSpeed*e),(0,c.oh)(this.transform,this.rotationInertia.z*this.rotationSpeed*e);var t=i.Pq.Forward(this.getTransform().getScene().useRightHandedSystem),n=this.camera.getDirection(t),r=this.getTransform().forward;if(!n.equalsWithEpsilon(r)){var a,u=(0,s.aL)(r,n);this.transform.rotationQuaternion=u.multiply(null!=(a=this.transform.rotationQuaternion)?a:o.PT.Identity()),this.camera.rotationQuaternion=o.PT.Identity()}this.speed*=1+h.Z.map.changeSpeed.value/20,this.inertia.x=(0,l.aJ)(this.inertia.x,h.Z.map.move.value["0"],.07,e),this.inertia.z=(0,l.aJ)(this.inertia.z,h.Z.map.move.value["1"],.07,e),this.inertia.y=(0,l.aJ)(this.inertia.y,h.Z.map.upDown.value,.07,e);var d=i.Pq.Zero(),f=this.transform.forward.scale(this.speed*e).scaleInPlace(this.inertia.z),p=this.transform.up.scale(this.speed*e).scaleInPlace(this.inertia.y),m=this.transform.right.scale(-this.speed*e).scaleInPlace(this.inertia.x);return d.addInPlace(f),d.addInPlace(p),d.addInPlace(m),(0,c.Tl)(this.transform,d),this.getActiveCamera().getViewMatrix(),d}},{key:"dispose",value:function(){this.transform.dispose(),this.camera.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},17966:function(e,t,n){"use strict";n.d(t,{Z:()=>w});var r=n(54060),o=n(15524),i=n(92487),a=n(31272),s=n(16533),l=a._.KEYBOARD,c=new i.A({up:l.getControl("KeyW"),left:l.getControl("KeyA"),down:l.getControl("KeyS"),right:l.getControl("KeyD")}),u=new r.A({bindings:[c]}),h=new o.hn({positive:l.getControl("NumpadAdd"),negative:l.getControl("NumpadSubtract")}),d=new r.A({bindings:[h]}),f=new o.hn({positive:l.getControl("Space"),negative:l.getControl("ShiftLeft")}),p=new r.A({bindings:[f]}),m=new o.hn({positive:l.getControl("KeyE"),negative:l.getControl("KeyQ")}),v=new r.A({bindings:[m]}),y=new o.hn({positive:l.getControl("KeyK"),negative:l.getControl("KeyI")}),g=new r.A({bindings:[y]}),b=new o.hn({positive:l.getControl("KeyJ"),negative:l.getControl("KeyL")}),S=new r.A({bindings:[b]}),w=new s.X("DefaultControlsInputs",{move:u,upDown:p,changeSpeed:d,roll:v,pitch:g,yaw:S})},53843:function(e,t,n){"use strict";n.d(t,{A:()=>h,K7:()=>l,Wo:()=>u,aL:()=>a,mL:()=>c,pv:()=>s,tr:()=>i});var r=n(36801),o=n(13298);function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.Pq;return t.copyFromFloats(e.x,e.y,e.z)}function a(e,t){if(e.equalsWithEpsilon(t))return r.PT.Identity();var n,i=r.Pq.Cross(e,t);if(1e-8>i.lengthSquared())return n=Math.abs(e.x)<Math.abs(e.y)?Math.abs(e.x)<Math.abs(e.z)?new r.Pq(1,0,0):new r.Pq(0,0,1):Math.abs(e.y)<Math.abs(e.z)?new r.Pq(0,1,0):new r.Pq(0,0,1),n=r.Pq.Cross(e,n).normalize(),r.PT.RotationAxis(n,Math.PI);var a=Math.acos((0,o.qE)(r.Pq.Dot(e,t),-1,1));return r.PT.RotationAxis(i.normalize(),a)}function s(e,t){return t.multiply(e.conjugate())}function l(e){return 2*Math.acos(e.w)}function c(e){return new r.Pq(e.x,e.y,e.z).normalize()}function u(e){var t=[],n=!0,r=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;t.push(s.x,s.y,s.z)}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return t}function h(e){var t=[],n=!0,r=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;t.push(s.r,s.g,s.b)}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return t}},32648:function(e,t,n){"use strict";n.d(t,{M2:()=>o,aJ:()=>a,f5:()=>i});var r=n(36801);function o(e){return e<.5?2*e*e:-1+(4-2*e)*e}function i(e,t,n,o,i){return r.PT.SlerpToRef(e,t,Math.pow(2,-o/n),i)}function a(e,t,n,r){return t+(e-t)*Math.pow(2,-r/n)}},34041:function(e,t,n){"use strict";n.d(t,{J:()=>s});var r=n(13298),o=n(9323),i=n(32648);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){var e;function t(e,n,r,o){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");a(this,"clock",0),a(this,"duration",void 0),a(this,"thetaAcc",0),a(this,"totalTheta",void 0),a(this,"axis",void 0),a(this,"transform",void 0),this.transform=e,this.axis=n,this.totalTheta=r,this.duration=o}return e=[{key:"update",value:function(e){if(!this.isFinished()){this.clock+=e;var t=(0,r.qE)(this.clock/this.duration,0,1),n=this.totalTheta*(0,i.M2)(t)-this.thetaAcc;this.thetaAcc+=n,(0,o.e$)(this.transform,this.axis,n)}}},{key:"isFinished",value:function(){return this.clock>=this.duration}},{key:"getProgress",value:function(){return this.clock/this.duration}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},43548:function(e,t,n){"use strict";n.d(t,{k:()=>s});var r=n(13298),o=n(9323),i=n(32648);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");a(this,"clock",0),a(this,"duration",void 0),a(this,"distanceAcc",0),a(this,"totalDistance",void 0),a(this,"direction",void 0),a(this,"transform",void 0),this.transform=e,this.duration=r,this.totalDistance=n.subtract(e.getAbsolutePosition()).length(),this.direction=n.subtract(e.getAbsolutePosition()).normalizeToNew()}return e=[{key:"update",value:function(e){if(!this.isFinished()){this.clock+=e;var t=(0,r.qE)(this.clock/this.duration,0,1),n=this.totalDistance*(0,i.M2)(t)-this.distanceAcc;this.distanceAcc+=n,(0,o.Tl)(this.transform,this.direction.scale(n))}}},{key:"isFinished",value:function(){return this.clock>=this.duration}},{key:"getProgress",value:function(){return this.clock/this.duration}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},1134:function(e,t,n){"use strict";n.d(t,{$Z:()=>x,Bw:()=>U,Ew:()=>G,FP:()=>F,Lz:()=>L,N1:()=>R,PM:()=>Z,PW:()=>O,TF:()=>K,WQ:()=>ee,We:()=>E,Zc:()=>q,b5:()=>ea,eR:()=>V,f:()=>_,fV:()=>M,gs:()=>N,hG:()=>eo,jb:()=>et,jc:()=>B,jh:()=>$,jk:()=>en,lD:()=>J,lK:()=>H,rU:()=>ei,se:()=>k,t6:()=>z,tn:()=>Q,u2:()=>er,wr:()=>j,xz:()=>X,y4:()=>Y,yG:()=>D});var r=n(14299),o=n(76387),i=n(13337),a=n(87508),s=n(75462),l=n(47866),c=n(41719),u=n(43118),h=n(10025);n(40976);var d=n(75422),f=n(99794),p=n(14890),m=n(57581),v=n(65670),y=n(19524),g=n(16094),b=n(71862),S=n(32451),w=n(1109),T=n(36578),A=n(52566),P=n(51572),C=n(78865),I=n(13211),E={VERT:C.n.Vertex,FRAG:C.n.Fragment,NEUTRAL:C.n.Neutral,VERT_AND_FRAG:C.n.VertexAndFragment};function R(e){var t,n=new c.O("cameraPosition");return n.target=null!=(t=null==e?void 0:e.target)?t:C.n.Neutral,n.setAsSystemValue(I.Z.CameraPosition),n.output}function N(e){var t,n=new c.O("view");return n.target=null!=(t=null==e?void 0:e.target)?t:C.n.Neutral,n.setAsSystemValue(I.Z.View),n.output}function O(e){var t,n=new c.O("ViewProjection");return n.target=null!=(t=null==e?void 0:e.target)?t:C.n.Neutral,n.setAsSystemValue(I.Z.ViewProjection),n.output}function L(e){var t,n=new c.O("world");return n.target=null!=(t=null==e?void 0:e.target)?t:C.n.Neutral,n.setAsSystemValue(I.Z.World),n.output}function x(e,t){var n,r=new c.O(e);return r.target=null!=(n=null==t?void 0:t.target)?n:C.n.Vertex,r.setAsAttribute(e),r.output}function M(e,t){var n,r=new c.O("float");return r.target=null!=(n=null==t?void 0:t.target)?n:C.n.Neutral,r.value=e,r.isConstant=!0,r.output}function _(e,t){return M(e,t)}function k(e,t,n){var r,o,i,s,l=new a.$("texture");return l.target=null!=(r=null==n?void 0:n.target)?r:C.n.Fragment,l.convertToGammaSpace=null!=(o=null==n?void 0:n.convertToGammaSpace)&&o,l.convertToLinearSpace=null!=(i=null==n?void 0:n.convertToLinearSpace)&&i,l.disableLevelMultiplication=null!=(s=null==n?void 0:n.disableLevelMultiplication)&&s,l.texture=e,t.connectTo(l.uv),l}function D(e,t,n){var r,o=new b.I("TransformPosition");return o.target=null!=(r=null==n?void 0:n.target)?r:C.n.Neutral,o.complementZ=0,o.complementW=1,t.connectTo(o.vector),e.connectTo(o.transform),o.output}function j(e,t,n){var r,o=new b.I("TransformDirection");return o.target=null!=(r=null==n?void 0:n.target)?r:C.n.Neutral,o.complementZ=0,o.complementW=0,t.connectTo(o.vector),e.connectTo(o.transform),o.output}function F(e,t,n){var r,i=new o.z("atan2");return i.target=null!=(r=null==n?void 0:n.target)?r:C.n.Neutral,e.connectTo(i.x),t.connectTo(i.y),i.output}function U(e,t){var n,r=new u.A("length");return r.target=null!=(n=null==t?void 0:t.target)?n:C.n.Neutral,e.connectTo(r.value),r.output}function G(e,t,n,r,o,i){var a,s=new m.r("remap");return s.target=null!=(a=null==i?void 0:i.target)?a:C.n.Neutral,e.connectTo(s.input),t.connectTo(s.sourceMin),n.connectTo(s.sourceMax),r.connectTo(s.targetMin),o.connectTo(s.targetMax),s.output}function B(e,t){var n,r=new S.D("fract");return r.operation=S.$.Fract,r.target=null!=(n=null==t?void 0:t.target)?n:C.n.Neutral,e.connectTo(r.input),r.output}function H(e,t,n){var r,o=new f.a("mul");return o.target=null!=(r=null==n?void 0:n.target)?r:C.n.Neutral,e.connectTo(o.left),t.connectTo(o.right),o.output}function Y(e,t,n){var r,o=new i.Z("div");return o.target=null!=(r=null==n?void 0:n.target)?r:C.n.Neutral,e.connectTo(o.left),t.connectTo(o.right),o.output}function W(e,t,n,r,o){var i,a=new w.v("Merge");return a.target=null!=(i=null==o?void 0:o.target)?i:C.n.Neutral,e.connectTo(a.x),t.connectTo(a.y),n&&n.connectTo(a.z),r&&r.connectTo(a.w),a}function z(e,t){var n,r=new c.O("Mesh UV scale factor");return r.target=null!=(n=null==t?void 0:t.target)?n:C.n.Neutral,r.isConstant=!0,r.value=e,r.output}function q(e,t,n){return W(e,t,null,null,n).xyOut}function V(e,t,n,r){return W(e,t,n,null,r).xyzOut}function J(e,t){var n,r=new T.g("split");switch(r.target=null!=(n=null==t?void 0:t.target)?n:C.n.Neutral,e.type){case P.y.Float:case P.y.Int:case P.y.Matrix:case P.y.Object:case P.y.AutoDetect:case P.y.BasedOnInput:case P.y.All:throw Error("Invalid input type");case P.y.Vector2:e.connectTo(r.xyIn);break;case P.y.Vector3:case P.y.Color3:e.connectTo(r.xyzIn);break;case P.y.Vector4:case P.y.Color4:e.connectTo(r.xyzw)}return r}function X(e,t){var n,r=J(e,t),o=new w.v("OutputXZ");return o.target=null!=(n=null==t?void 0:t.target)?n:C.n.Neutral,r.x.connectTo(o.x),r.z.connectTo(o.y),o.xyOut}function Z(e,t,n){var r,o=new y.e("step");return o.target=null!=(r=null==n?void 0:n.target)?r:C.n.Neutral,e.connectTo(o.edge),t.connectTo(o.value),o.output}function K(e,t,n,r){var o,i=new v.a("smoothstep");return i.target=null!=(o=null==r?void 0:r.target)?o:C.n.Neutral,e.connectTo(i.edge0),t.connectTo(i.edge1),n.connectTo(i.value),i.output}function Q(e,t){var n,r=new S.D("abs");return r.operation=S.$.Abs,r.target=null!=(n=null==t?void 0:t.target)?n:C.n.Neutral,e.connectTo(r.input),r.output}function $(e,t,n,r){var o,i=new h.f("mix");return i.target=null!=(o=null==r?void 0:r.target)?o:C.n.Neutral,e.connectTo(i.left),t.connectTo(i.right),n.connectTo(i.gradient),i.output}function ee(e,t,n){var o,i=new r.B("add");return i.target=null!=(o=null==n?void 0:n.target)?o:C.n.Neutral,e.connectTo(i.left),t.connectTo(i.right),i.output}function et(e,t,n){var r,o=new g._("sub");return o.target=null!=(r=null==n?void 0:n.target)?r:C.n.Neutral,e.connectTo(o.left),t.connectTo(o.right),o.output}function en(e,t,n){var r,o=new d.e("min");return o.target=null!=(r=null==n?void 0:n.target)?r:C.n.Neutral,e.connectTo(o.left),t.connectTo(o.right),o.output}function er(e,t,n,r,o,i){var a,s=new l.p("Perturb normal");return s.target=null!=(a=null==i?void 0:i.target)?a:C.n.Fragment,e.connectTo(s.uv),t.connectTo(s.worldPosition),n.connectTo(s.worldNormal),r.connectTo(s.normalMapColor),o.connectTo(s.strength),s.output}function eo(e,t,n,r,o,i,a,s,l,c){var u,h,d,f,m=new p.D("PBRMetallicRoughness");return m.target=null!=(u=null==c?void 0:c.target)?u:C.n.Fragment,m.useEnergyConservation=null==(h=null==c?void 0:c.useEnergyConservation)||h,m.useRadianceOcclusion=null==(d=null==c?void 0:c.useRadianceOcclusion)||d,m.useHorizonOcclusion=null==(f=null==c?void 0:c.useHorizonOcclusion)||f,e.connectTo(m.baseColor),t.connectTo(m.metallic),n.connectTo(m.roughness),null==r||r.connectTo(m.ambientOcc),o.connectTo(m.perturbedNormal),i.connectTo(m.worldNormal),a.connectTo(m.view),s.connectTo(m.cameraPosition),l.connectTo(m.worldPosition),m.lighting}function ei(e,t){var n,r,o=new s.h("FragmentOutput");return o.target=C.n.Fragment,o.convertToGammaSpace=null!=(n=null==t?void 0:t.convertToGammaSpace)&&n,o.convertToLinearSpace=null!=(r=null==t?void 0:t.convertToLinearSpace)&&r,e.connectTo(o.rgb),o}function ea(e,t){var n,r=new A.D("VertexOutput");return r.target=null!=(n=null==t?void 0:t.target)?n:C.n.Vertex,e.connectTo(r.vector),r}},4035:function(e,t,n){"use strict";n.d(t,{f:()=>s});var r=n(36801),o=n(42503),i=n(53843),a=n(13679);function s(e,t,n){for(var s=(0,i.tr)(n.getSystemGalacticPosition(e)),l=Math.ceil(t/a.w.STAR_SECTOR_SIZE),c=[],u=e.starSectorX-l;u<=e.starSectorX+l;u++)for(var h=e.starSectorY-l;h<=e.starSectorY+l;h++)for(var d=e.starSectorZ-l;d<=e.starSectorZ+l;d++)c.push(new r.Pq(u,h,d));return c.flatMap(function(a){var l=n.getSystemPositionsInStarSector(a.x,a.y,a.z).map(function(e){return(0,i.tr)(e)}),c=n.getSystemCoordinatesInStarSector(a.x,a.y,a.z);return l.map(function(e,t){var n=r.Pq.Distance(e,s),o=c[t];if(void 0===o)throw Error("Coordinates not found for the given index");return{coordinates:o,position:e,distance:n}}).filter(function(n){return n.distance<=t&&!(0,o.F)(n.coordinates,e)})})}},83266:function(e,t,n){"use strict";n.d(t,{s:()=>i,t:()=>a});var r=n(80465),o=n(13679);function i(e,t,n){t?n._hknp.HP_World_AddBody(n.world,e._pluginData.hpBodyId,e.startAsleep):n._hknp.HP_World_RemoveBody(n.world,e._pluginData.hpBodyId)}function a(e,t,n){var i=new r.L(e,t,{mass:0},n);return i.body.disablePreStep=!1,i.shape.filterMembershipMask=o.H.ENVIRONMENT,i.shape.filterCollideMask=o.H.DYNAMIC_OBJECTS,i}},76161:function(e,t,n){"use strict";n.d(t,{h:()=>i,q:()=>o});var r=n(74334);function o(e,t,n){return 2*Math.atan(t/r.Pq.Distance(n,e))}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.005;return o(e.getTransform().getAbsolutePosition(),e.getBoundingRadius(),t.globalPosition)/t.fov>n}},54571:function(e,t,n){"use strict";n.d(t,{x:()=>i});var r=n(78706);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(){var e;function t(e){var n=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"loadingDiv",null),o(this,"loadingTextDiv",null),o(this,"title",null),o(this,"progressBar",null),o(this,"loadingText",""),o(this,"loadingDivBackgroundColor","black"),o(this,"canvas",void 0),o(this,"resizeLoadingUI",function(){var e=n.canvas.getBoundingClientRect(),t=window.getComputedStyle(n.canvas).position;n.loadingDiv&&(n.loadingDiv.style.position="fixed"===t?"fixed":"absolute",n.loadingDiv.style.left="".concat(e.left,"px"),n.loadingDiv.style.top="".concat(e.top,"px"),n.loadingDiv.style.width="".concat(e.width,"px"),n.loadingDiv.style.height="".concat(e.height,"px"))}),this.canvas=e}return e=[{key:"displayLoadingUI",value:function(){if(!this.loadingDiv){this.loadingDiv=document.createElement("div"),this.loadingDiv.id="babylonjsLoadingDiv",this.title=document.createElement("h1"),this.title.innerText="Cosmos Journeyer",this.loadingDiv.appendChild(this.title);var e=document.createElement("div");e.classList.add("progressBarContainer"),this.loadingDiv.appendChild(e),this.progressBar=document.createElement("div"),this.progressBar.classList.add("progressBar"),e.appendChild(this.progressBar),this.loadingTextDiv=document.createElement("div"),this.loadingTextDiv.classList.add("loadingText"),this.loadingDiv.appendChild(this.loadingTextDiv),this.loadingTextDiv.innerText=this.loadingText;var t=new Image;t.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+",t.style.width="50%",t.style.gridColumn="1",t.style.gridRow="1",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.position="absolute";var n=document.createElement("div");n.classList.add("imageSpinnerContainer");var r=new Image;r.classList.add("loadingSpinner"),r.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==",n.appendChild(t),n.appendChild(r),e.appendChild(n),this.resizeLoadingUI(),window.addEventListener("resize",this.resizeLoadingUI),this.loadingDiv.style.backgroundColor=this.loadingDivBackgroundColor,document.body.appendChild(this.loadingDiv),this.loadingDiv.style.opacity="1"}}},{key:"hideLoadingUI",value:function(){var e=this;this.loadingDiv&&(this.loadingDiv.style.opacity="0",this.loadingDiv.addEventListener("transitionend",function(){e.loadingTextDiv&&(e.loadingTextDiv.remove(),e.loadingTextDiv=null),e.loadingDiv&&(e.loadingDiv.remove(),e.loadingDiv=null),window.removeEventListener("resize",e.resizeLoadingUI)}))}},{key:"setProgress",value:function(e,t){var n,o=t/e*100;this.loadingUIText="".concat(r.A.t("common:loading")," (").concat(t,"/").concat(e,")"),null==(n=this.progressBar)||n.style.setProperty("--progress","".concat(o,"%"))}},{key:"loadingUIText",get:function(){return this.loadingText},set:function(e){this.loadingText=e,this.loadingTextDiv&&(this.loadingTextDiv.innerHTML=this.loadingText)}},{key:"loadingUIBackgroundColor",get:function(){return this.loadingDivBackgroundColor},set:function(e){this.loadingDivBackgroundColor=e,this.loadingDiv&&(this.loadingDiv.style.backgroundColor=this.loadingDivBackgroundColor)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},96811:function(e,t,n){"use strict";n.d(t,{D:()=>s,s:()=>l});var r=n(35543),o=n(36801),i=n(13298),a=n(57404);function s(e,t,n){var s=(0,a.tQ)(e.semiMajorAxis,t),l=s>0?e.initialMeanAnomaly-2*Math.PI*n/s:0,c=(0,i.YX)(function(t){return(0,a.EF)(t,l,e.eccentricity)},l),u=Math.cos(c),h=Math.sin(c),d=(0,a.rB)(u,h,e.p),f=e.semiMajorAxis*Math.sqrt(1-Math.pow(e.eccentricity,2)),p=e.eccentricity*e.semiMajorAxis,m=new o.Pq(e.semiMajorAxis*u-p,0,f*h);m.scaleInPlace(d);var v=o.uq.RotationAxis(r._0.Y,e.argumentOfPeriapsis),y=o.uq.RotationAxis(r._0.Z,e.inclination),g=o.uq.RotationAxis(r._0.Y,e.longitudeOfAscendingNode);return o.Pq.TransformCoordinatesToRef(m,v,m),o.Pq.TransformCoordinatesToRef(m,y,m),o.Pq.TransformCoordinatesToRef(m,g,m),m}function l(e,t,n,r,i){var a=s(n,t,r);return o.Pq.TransformCoordinatesToRef(a,i,a),a.addInPlace(e)}},27460:function(e,t,n){"use strict";n.d(t,{d:()=>a});var r=n(61741),o=n(45643),i=n(78706);function a(e){switch(e.type){case r.T.MANDELBULB:case r.T.JULIA_SET:case r.T.MANDELBOX:case r.T.SIERPINSKI_PYRAMID:case r.T.MENGER_SPONGE:case r.T.DARK_KNIGHT:return i.A.t("objectTypes:anomaly");case r.T.GAS_PLANET:return i.A.t("objectTypes:gasPlanet");case r.T.TELLURIC_PLANET:return i.A.t("objectTypes:telluricPlanet");case r.T.TELLURIC_SATELLITE:return i.A.t("objectTypes:telluricMoon");case r.T.SPACE_STATION:return i.A.t("objectTypes:spaceStation");case r.T.SPACE_ELEVATOR:return i.A.t("objectTypes:spaceElevator");case r.T.STAR:return i.A.t("objectTypes:star",{stellarType:(0,o.aX)(e.blackBodyTemperature)});case r.T.NEUTRON_STAR:return i.A.t("objectTypes:neutronStar");case r.T.BLACK_HOLE:return i.A.t("objectTypes:blackHole");case r.T.CUSTOM:return i.A.t("objectTypes:custom")}}},94311:function(e,t,n){"use strict";n.d(t,{B:()=>u}),n(42996);var r=n(28995),o=n(16713);function i(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(c=function(){return!!e})()}var u=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e){var t,o,i;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");return o=n,i=[e],o=s(o),a(t=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,c()?Reflect.construct(o,i||[],s(this).constructor):o.apply(this,i)),"activeControls",null),a(t,"depthRenderer",null),t.clearColor=new r.ov(0,0,0,0),t.onNewCameraAddedObservable.add(function(e){null===t.depthRenderer&&(t.depthRenderer=t.enableDepthRenderer(e,!1,!0))}),t.onBeforeCameraRenderObservable.add(function(e){if(null===t.depthRenderer)throw Error("Depth renderer is null!");t.depthRenderer.getDepthMap().activeCamera=e}),t}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&l(n,e),t=[{key:"setActiveControls",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(n){switch(n.label){case 0:if(this.activeControls=e,this.setActiveCamera(e.getActiveCamera()),!e.shouldLockPointer())return[3,2];return[4,null==(t=this.getEngine().getRenderingCanvas())?void 0:t.requestPointerLock()];case 1:return n.sent(),[3,3];case 2:document.exitPointerLock(),n.label=3;case 3:return[2]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function s(e){i(a,r,o,s,l,"next",e)}function l(e){i(a,r,o,s,l,"throw",e)}s(void 0)})}).call(this)}},{key:"setActiveCamera",value:function(e){null!==this.activeCameras&&this.activeCameras.forEach(function(e){e.detachControl()}),null!==this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,this.activeCameras=[e],e.attachControl(!0)}},{key:"getActiveControls",value:function(){if(null===this.activeControls)throw Error("Controls not set");return this.activeControls}},{key:"getActiveCameras",value:function(){if(null===this.activeCameras)throw Error("No active camera in scene");return this.activeCameras}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(o.Z)},31272:function(e,t,n){"use strict";n.d(t,{_:()=>i});var r=n(80379),o=n(30189),i={KEYBOARD:new r.A({keyCode:!0}),POINTER:new o.A}},3818:function(e,t,n){"use strict";n.d(t,{i:()=>S});var r=n(54060),o=n(86283),i=n(31272),a=n(16533),s=i._.KEYBOARD,l=s.getControl("Escape"),c=new r.A({bindings:[l]}),u=new o.A(c),h=s.getControl("KeyM"),d=new r.A({bindings:[h]}),f=new o.A(d),p=s.getControl("KeyP"),m=new r.A({bindings:[p]}),v=new o.A(m),y=s.getControl("KeyV"),g=new r.A({bindings:[y]}),b=new o.A(g),S=new a.X("GeneralInputs",{togglePause:u,toggleStarMap:f,screenshot:v,videoCapture:b})},16533:function(e,t,n){"use strict";n.d(t,{X:()=>s});var r=n(54060),o=n(85200);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}var s=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");i(this,"name",void 0),i(this,"map",void 0),this.name=e,this.map=n}return e=[{key:"setEnabled",value:function(e){var t=!0,n=!1,i=void 0;try{for(var s,l=Object.values(this.map)[Symbol.iterator]();!(t=(s=l.next()).done);t=!0){var c=s.value;a(c,r.A)?c.enabled=e:a(c,o.A)&&(c.action.enabled=e)}}catch(e){n=!0,i=e}finally{try{t||null==l.return||l.return()}finally{if(n)throw i}}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},3211:function(e,t,n){"use strict";n.d(t,{n:()=>w});var r=n(54060),o=n(86283),i=n(31272),a=n(16533),s=i._.KEYBOARD,l=new r.A({bindings:[s.getControl("KeyT")]}),c=new o.A(l),u=new r.A({bindings:[s.getControl("KeyE")]}),h=new o.A(u),d=new r.A({bindings:[s.getControl("KeyJ")]}),f=new o.A(d),p=new r.A({bindings:[s.getControl("KeyU")]}),m=new o.A(p),v=new r.A({bindings:[s.getControl("KeyO")]}),y=new o.A(v),g=new r.A({bindings:[s.getControl("KeyC")]}),b=new o.A(g),S=new o.A(new r.A({bindings:[s.getControl("Numpad0")]})),w=new a.X("StarSystemInputs",{setTarget:c,toggleSpaceShipCharacter:h,jumpToSystem:f,toggleUi:m,toggleOrbitsAndAxis:y,cycleViews:b,printDebugInfo:S})},4064:function(e,t,n){"use strict";n.d(t,{e:()=>h});var r=n(36801),o=n(42503),i=n(53843),a=n(90160),s=n(3818),l=n(56367),c=n(63215),u=n(78706);function h(e,t,n,h){var d=e.currentItinerary;if(null===d)return u.A.t("missions:common:openStarMap",{starMapKey:(0,a.hg)(s.i.map.toggleStarMap,n).join(" ".concat(u.A.t("common:or")," "))});var f=d.at(-1),p=void 0!==f&&(0,o.F)(f,t),m=(0,i.tr)(h.getSystemGalacticPosition(e.currentSystem.model.coordinates));if(!p)return u.A.t("missions:common:openStarMap",{starMapKey:(0,a.hg)(s.i.map.toggleStarMap,n).join(" ".concat(u.A.t("common:or")," "))});var v=d[1],y=h.getSystemModelFromCoordinates(v);if(null===y)return u.A.t("missions:common:corruptedItinerary");var g=r.Pq.Distance((0,i.tr)(h.getSystemGalacticPosition(y.coordinates)),m);return u.A.t("missions:common:travelToNextSystem",{systemName:y.name,distance:(0,c.Fj)((0,l.E1)(g)),nbJumps:d.length-1})}},61032:function(e,t,n){"use strict";n.d(t,{P:()=>A});var r=n(98510),o=n(78706),i=n(7941),a=n(6215),s=n(66360),l=n(43628);function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");u(this,"children",void 0),u(this,"hasCompletedLock",!1),this.children=e}return e=[{key:"isCompleted",value:function(){return this.hasCompletedLock}},{key:"equals",value:function(e){if((null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!t[Symbol.hasInstance](e):!(e instanceof t))||this.children.length!==e.children.length)return!1;var n=!0,r=!1,o=void 0;try{for(var i,a=this.children.entries()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s,l=(s=i.value,function(e){if(Array.isArray(e))return e}(s)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(s,2)||function(e,t){if(e){if("string"==typeof e)return c(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}}(s,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=l[0],h=l[1],d=e.children[u];if(void 0!==d&&!h.equals(d))return!1}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return!0}},{key:"updateState",value:function(e){this.hasCompletedLock||(this.children.forEach(function(t){t.updateState(e)}),this.hasCompletedLock=this.children.every(function(e){return e.isCompleted()}))}},{key:"describe",value:function(e,t){return this.children.map(function(n){return n.describe(e,t)}).join(" ".concat(o.A.t("common:and")," "))}},{key:"describeNextTask",value:function(e,t,n){return this.hasCompletedLock?"Mission completed":this.children.map(function(r){return r.describeNextTask(e,t,n)}).join(" ".concat(o.A.t("common:and")," "))}},{key:"getTargetSystems",value:function(){return this.children.flatMap(function(e){return e.getTargetSystems()})}},{key:"serialize",value:function(){return{type:i.H.AND,children:this.children.map(function(e){return e.serialize()})}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");f(this,"children",void 0),f(this,"hasCompletedLock",!1),this.children=e}return e=[{key:"isCompleted",value:function(){return this.hasCompletedLock}},{key:"equals",value:function(e){if((null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!t[Symbol.hasInstance](e):!(e instanceof t))||this.children.length!==e.children.length)return!1;var n=!0,r=!1,o=void 0;try{for(var i,a=this.children.entries()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s,l=(s=i.value,function(e){if(Array.isArray(e))return e}(s)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(s,2)||function(e,t){if(e){if("string"==typeof e)return d(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}}(s,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=l[0],u=l[1],h=e.children[c];if(void 0!==h&&!u.equals(h))return!1}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return!0}},{key:"updateState",value:function(e){this.hasCompletedLock||(this.children.forEach(function(t){t.updateState(e)}),this.hasCompletedLock=this.children.some(function(e){return e.isCompleted()}))}},{key:"describe",value:function(e,t){return this.children.map(function(n){return n.describe(e,t)}).join(" ".concat(o.A.t("common:or")," "))}},{key:"describeNextTask",value:function(e,t,n){return this.hasCompletedLock?"Mission completed":this.children.map(function(r){return r.describeNextTask(e,t,n)}).join(" ".concat(o.A.t("common:or")," "))}},{key:"getTargetSystems",value:function(){return this.children.flatMap(function(e){return e.getTargetSystems()})}},{key:"serialize",value:function(){return{type:i.H.OR,children:this.children.map(function(e){return e.serialize()})}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");v(this,"children",void 0),v(this,"hasCompletedLock",!1),v(this,"activeChildIndex",0),this.children=e}return e=[{key:"isCompleted",value:function(){return this.hasCompletedLock}},{key:"equals",value:function(e){if((null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!t[Symbol.hasInstance](e):!(e instanceof t))||this.children.length!==e.children.length)return!1;var n=!0,r=!1,o=void 0;try{for(var i,a=this.children.entries()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s,l=(s=i.value,function(e){if(Array.isArray(e))return e}(s)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(s,2)||function(e,t){if(e){if("string"==typeof e)return m(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}}(s,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=l[0],u=l[1],h=e.children[c];if(void 0!==h&&!u.equals(h))return!1}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return!0}},{key:"updateState",value:function(e){if(!this.hasCompletedLock){var t=this.children[this.activeChildIndex];void 0!==t&&(t.updateState(e),t.isCompleted()&&this.activeChildIndex++,this.hasCompletedLock=this.children.every(function(e){return e.isCompleted()}))}}},{key:"setActiveChildIndex",value:function(e){if(e<0||e>=this.children.length)throw Error("Invalid index ".concat(e," for mission sequence node. Must be between 0 and ").concat(this.children.length-1));this.activeChildIndex=e}},{key:"describe",value:function(e,t){return this.children.map(function(n){return n.describe(e,t)}).join(" then ")}},{key:"describeNextTask",value:function(e,t,n){if(this.hasCompletedLock)return"Mission completed";var r=this.children[this.activeChildIndex];return void 0===r?"Mission error: activeChildIndex out of bounds":r.describeNextTask(e,t,n)}},{key:"getTargetSystems",value:function(){var e=this.children[this.activeChildIndex];return void 0===e?[]:e.getTargetSystems()}},{key:"serialize",value:function(){return{type:i.H.SEQUENCE,children:this.children.map(function(e){return e.serialize()}),activeChildIndex:this.activeChildIndex}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");b(this,"children",void 0),b(this,"hasCompletedLock",!1),this.children=e}return e=[{key:"isCompleted",value:function(){return this.hasCompletedLock}},{key:"equals",value:function(e){if((null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!t[Symbol.hasInstance](e):!(e instanceof t))||this.children.length!==e.children.length)return!1;var n=!0,r=!1,o=void 0;try{for(var i,a=this.children.entries()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s,l=(s=i.value,function(e){if(Array.isArray(e))return e}(s)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(s,2)||function(e,t){if(e){if("string"==typeof e)return g(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}}(s,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=l[0],u=l[1],h=e.children[c];if(void 0!==h&&!u.equals(h))return!1}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return!0}},{key:"updateState",value:function(e){this.hasCompletedLock||(this.children.forEach(function(t){t.updateState(e)}),this.hasCompletedLock=1===this.children.filter(function(e){return e.isCompleted()}).length)}},{key:"describe",value:function(e,t){return this.children.map(function(n){return n.describe(e,t)}).join(" xor ")}},{key:"describeNextTask",value:function(e,t,n){return this.hasCompletedLock?"Mission completed":this.children.map(function(r){return r.describeNextTask(e,t,n)}).join(" xor ")}},{key:"getTargetSystems",value:function(){return this.children.flatMap(function(e){return e.getTargetSystems()})}},{key:"serialize",value:function(){return{type:i.H.XOR,children:this.children.map(function(e){return e.serialize()})}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(){var e,t;function n(e,t,r,o){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");T(this,"tree",void 0),T(this,"reward",void 0),T(this,"missionGiver",void 0),T(this,"missionType",void 0),this.tree=e,this.reward=t,this.missionGiver=r,this.missionType=o}return e=[{key:"describeNextTask",value:function(e,t,n){return this.tree.describeNextTask(e,t,n)}},{key:"equals",value:function(e){return this.tree.equals(e.tree)}},{key:"getReward",value:function(){return this.reward}},{key:"getTargetSystems",value:function(){return this.tree.getTargetSystems()}},{key:"getTypeString",value:function(){switch(this.missionType){case r.P.SIGHT_SEEING_FLY_BY:return o.A.t("missions:sightseeing:flyBy");case r.P.SIGHT_SEEING_TERMINATOR_LANDING:return o.A.t("missions:sightseeing:terminatorLanding");case r.P.SIGHT_SEEING_ASTEROID_FIELD:return o.A.t("missions:sightseeing:asteroidFieldTrek");default:throw Error("Unknown sight seeing type: ".concat(String(this.missionType)))}}},{key:"describe",value:function(e){return this.tree.describe(this.missionGiver.systemCoordinates,e)}},{key:"isCompleted",value:function(){return this.tree.isCompleted()}},{key:"serialize",value:function(){return{missionGiver:this.missionGiver,tree:this.tree.serialize(),reward:this.reward,type:this.missionType}}},{key:"update",value:function(e){this.isCompleted()||this.tree.updateState(e)}}],t=[{key:"Deserialize",value:function(e,t){try{var r=function e(t,n){var r,o,c,u,d,f,m,v,g,b,w,T,A,P,C,I;switch(t.type){case i.H.AND:return r=t,o=n,new h(r.children.map(function(t){return e(t,o)}).filter(function(e){return null!==e}));case i.H.OR:return c=t,u=n,new p(c.children.map(function(t){return e(t,u)}).filter(function(e){return null!==e}));case i.H.XOR:return d=t,f=n,new S(d.children.map(function(t){return e(t,f)}).filter(function(e){return null!==e}));case i.H.SEQUENCE:return m=t,v=n,(g=new y(m.children.map(function(t){return e(t,v)}).filter(function(e){return null!==e}))).setActiveChildIndex(m.activeChildIndex),g;case i.H.ASTEROID_FIELD:return b=t,w=n,null==(T=a.q.New(b.objectId,w))||T.setState(b.state),T;case i.H.FLY_BY:return A=t,(P=new s.L(A.objectId)).setState(A.state),P;case i.H.TERMINATOR_LANDING:return C=t,(I=new l.V(C.objectId)).setState(C.state),I}}(e.tree,t);if(null===r)return null;return new n(r,e.reward,e.missionGiver,e.type)}catch(e){return console.warn("Failed to deserialize mission:",e),null}}}],e&&w(n.prototype,e),t&&w(n,t),n}()},6215:function(e,t,n){"use strict";n.d(t,{q:()=>g});var r=n(36801),o=n(74816),i=n(7941),a=n(61741),s=n(42503),l=n(78629),c=n(26274),u=n(53843),h=n(13298),d=n(56367),f=n(63215),p=n(78706),m=n(4064);function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(){var e,t;function n(e){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");y(this,"state",o.B.NOT_IN_SYSTEM),y(this,"objectId",void 0),y(this,"targetSystemCoordinates",void 0),this.objectId=e,this.targetSystemCoordinates=e.systemCoordinates}return e=[{key:"setState",value:function(e){this.state=e}},{key:"isCompleted",value:function(){return this.state===o.B.CLOSE_ENOUGH}},{key:"equals",value:function(e){return(null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):e instanceof n)&&(0,c.bJ)(this.objectId,e.objectId)}},{key:"updateState",value:function(e){if(!this.isCompleted()){var t=e.currentSystem,n=t.model;if(!(0,s.F)(n.coordinates,this.targetSystemCoordinates)){this.state=o.B.NOT_IN_SYSTEM;return}var i=t.getOrbitalObjectById(this.objectId.idInSystem),a=t.getCelestialBodies().find(function(e){return e===i});if(void 0!==a){var l=a.asteroidField;if(null!==l){var c=e.playerPosition,u=r.Pq.TransformCoordinates(c,a.getTransform().getWorldMatrix().clone().invert()),d=new r.Pq(u.x,0,u.z),f=d.length(),p=d.scaleInPlace((0,h.qE)(f,l.innerRadius,l.outerRadius)/f);1e3>r.Pq.Distance(u,p)?this.state=o.B.CLOSE_ENOUGH:this.state=o.B.TOO_FAR_IN_SYSTEM}}}}},{key:"describe",value:function(e,t){var n=r.Pq.Distance((0,u.tr)(t.getSystemGalacticPosition(e)),(0,u.tr)(t.getSystemGalacticPosition(this.targetSystemCoordinates))),o=t.getObjectModelByUniverseId(this.objectId),i=t.getSystemModelFromCoordinates(this.targetSystemCoordinates);return null===o||null===i?"ERROR: objectModel or systemModel is null":p.A.t("missions:sightseeing:describeAsteroidFieldTrek",{objectName:o.name,systemName:i.name,distance:n>0?(0,f.Fj)((0,d.E1)(n)):p.A.t("missions:common:here")})}},{key:"describeNextTask",value:function(e,t,n){if(this.isCompleted())return p.A.t("missions:asteroidField:missionCompleted");var r=n.getObjectModelByUniverseId(this.objectId);if(null===r)return"ERROR: targetObject is null";switch(this.state){case o.B.NOT_IN_SYSTEM:return(0,m.e)(e,this.targetSystemCoordinates,t,n);case o.B.TOO_FAR_IN_SYSTEM:return p.A.t("missions:common:getCloserToTarget",{objectName:r.name});case o.B.CLOSE_ENOUGH:return p.A.t("missions:asteroidField:missionCompleted")}}},{key:"getTargetSystems",value:function(){return[this.targetSystemCoordinates]}},{key:"serialize",value:function(){return{type:i.H.ASTEROID_FIELD,objectId:this.objectId,state:this.state}}}],t=[{key:"New",value:function(e,t){var r=t.getSystemModelFromCoordinates(e.systemCoordinates);if(null===r)return null;var o=(0,l.B)(e.idInSystem,r);return null===o||o.type!==a.T.TELLURIC_PLANET&&o.type!==a.T.GAS_PLANET||null===o.rings?null:new n(e)}}],e&&v(n.prototype,e),t&&v(n,t),n}()},66360:function(e,t,n){"use strict";n.d(t,{L:()=>v});var r=n(36801),o=n(70675),i=n(7941),a=n(61741),s=n(42503),l=n(26274),c=n(53843),u=n(27460),h=n(56367),d=n(63215),f=n(78706),p=n(4064);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");m(this,"state",o.Q.NOT_IN_SYSTEM),m(this,"objectId",void 0),m(this,"targetSystemCoordinates",void 0),this.objectId=e,this.targetSystemCoordinates=e.systemCoordinates}return e=[{key:"setState",value:function(e){this.state=e}},{key:"isCompleted",value:function(){return this.state===o.Q.CLOSE_ENOUGH}},{key:"equals",value:function(e){return(null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t)&&(0,l.bJ)(this.objectId,e.objectId)}},{key:"updateState",value:function(e){if(!this.isCompleted()){var t=e.currentSystem,n=t.model;if(!(0,s.F)(n.coordinates,this.targetSystemCoordinates)){this.state=o.Q.NOT_IN_SYSTEM;return}var i=t.getOrbitalObjectById(this.objectId.idInSystem);if(void 0!==i){var l=e.playerPosition,c=r.Pq.Distance(l,i.getTransform().getAbsolutePosition()),u=1;switch(i.type){case a.T.STAR:case a.T.TELLURIC_PLANET:case a.T.TELLURIC_SATELLITE:case a.T.GAS_PLANET:case a.T.MANDELBULB:case a.T.JULIA_SET:case a.T.MANDELBOX:case a.T.SIERPINSKI_PYRAMID:case a.T.MENGER_SPONGE:case a.T.DARK_KNIGHT:case a.T.SPACE_STATION:case a.T.SPACE_ELEVATOR:case a.T.CUSTOM:u=3;break;case a.T.NEUTRON_STAR:u=7e4;break;case a.T.BLACK_HOLE:u=10}c<i.getBoundingRadius()*u?this.state=o.Q.CLOSE_ENOUGH:this.state=o.Q.TOO_FAR_IN_SYSTEM}}}},{key:"describe",value:function(e,t){var n=r.Pq.Distance((0,c.tr)(t.getSystemGalacticPosition(e)),(0,c.tr)(t.getSystemGalacticPosition(this.targetSystemCoordinates))),o=t.getObjectModelByUniverseId(this.objectId),i=t.getSystemModelFromCoordinates(this.targetSystemCoordinates);return null===o||null===i?"ERROR: object or system model is null":f.A.t("missions:sightseeing:describeFlyBy",{objectType:(0,u.d)(o),systemName:i.name,distance:n>0?(0,d.Fj)((0,h.E1)(n)):f.A.t("missions:common:here")})}},{key:"describeNextTask",value:function(e,t,n){if(this.isCompleted())return f.A.t("missions:flyBy:missionCompleted");var r=n.getObjectModelByUniverseId(this.objectId);if(null===r)return"ERROR: target object is null";switch(this.state){case o.Q.NOT_IN_SYSTEM:return(0,p.e)(e,this.targetSystemCoordinates,t,n);case o.Q.TOO_FAR_IN_SYSTEM:return f.A.t("missions:common:getCloserToTarget",{objectName:r.name});case o.Q.CLOSE_ENOUGH:return f.A.t("missions:flyBy:missionCompleted")}}},{key:"getTargetSystems",value:function(){return[this.targetSystemCoordinates]}},{key:"serialize",value:function(){return{type:i.H.FLY_BY,objectId:this.objectId,state:this.state}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},43628:function(e,t,n){"use strict";n.d(t,{V:()=>v});var r=n(36801),o=n(1831),i=n(7941),a=n(44607),s=n(42503),l=n(26274),c=n(53843),u=n(56367),h=n(63215),d=n(78706),f=n(13679),p=n(4064);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");m(this,"state",a.f.NOT_IN_SYSTEM),m(this,"objectId",void 0),m(this,"targetSystemCoordinates",void 0),m(this,"raycastResult",new o.G),this.objectId=e,this.targetSystemCoordinates=e.systemCoordinates}return e=[{key:"setState",value:function(e){this.state=e}},{key:"isCompleted",value:function(){return this.state===a.f.LANDED}},{key:"equals",value:function(e){return(null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t)&&(0,l.bJ)(this.objectId,e.objectId)}},{key:"updateState",value:function(e){if(!this.isCompleted()){var t=e.currentSystem,n=t.model;if(!(0,s.F)(n.coordinates,this.targetSystemCoordinates)){this.state=a.f.NOT_IN_SYSTEM;return}var o=t.getOrbitalObjectById(this.objectId.idInSystem);if(void 0!==o){var i=e.playerPosition,l=o.getTransform().getAbsolutePosition();if(r.Pq.Distance(i,l)>o.getBoundingRadius()+1e5){this.state=a.f.TOO_FAR_IN_SYSTEM;return}var c=l.subtract(i).normalize();if(e.physicsEngine.raycastToRef(i,i.add(c.scale(5)),this.raycastResult,{collideWith:f.H.ENVIRONMENT}),this.raycastResult.hasHit){if((null==(u=this.raycastResult.body)?void 0:u.transformNode.parent)!==o.getTransform()){this.state=a.f.TOO_FAR_IN_SYSTEM;return}var u,h=t.getStellarObjects(),d=h.reduce(function(e,t){return e+t.model.mass},0),p=h.reduce(function(e,t){return e.add(t.getTransform().getAbsolutePosition().scale(t.model.mass))},r.Pq.Zero()).scaleInPlace(1/d),m=c.negate(),v=p.subtract(l).normalize();if(Math.abs(r.Pq.Dot(m,v))>Math.cos(Math.PI/6)){this.state=a.f.TOO_FAR_IN_SYSTEM;return}if(10>r.Pq.Distance(i,this.raycastResult.hitPointWorld)){this.state=a.f.LANDED;return}}this.state=a.f.TOO_FAR_IN_SYSTEM}}}},{key:"describe",value:function(e,t){var n=r.Pq.Distance((0,c.tr)(t.getSystemGalacticPosition(e)),(0,c.tr)(t.getSystemGalacticPosition(this.targetSystemCoordinates))),o=t.getObjectModelByUniverseId(this.objectId),i=t.getSystemModelFromCoordinates(this.targetSystemCoordinates);return null===o||null===i?"ERROR: object or system model is null":d.A.t("missions:sightseeing:describeTerminatorLanding",{objectName:o.name,systemName:i.name,distance:n>0?(0,h.Fj)((0,u.E1)(n)):d.A.t("missions:common:here")})}},{key:"describeNextTask",value:function(e,t,n){if(this.isCompleted())return d.A.t("missions:terminatorLanding:missionCompleted");var r=n.getObjectModelByUniverseId(this.objectId);if(null===r)return"ERROR: target object is null";switch(this.state){case a.f.NOT_IN_SYSTEM:return(0,p.e)(e,this.targetSystemCoordinates,t,n);case a.f.TOO_FAR_IN_SYSTEM:return d.A.t("missions:terminatorLanding:getCloserToTerminator",{objectName:r.name});case a.f.LANDED:return d.A.t("missions:terminatorLanding:missionCompleted")}}},{key:"getTargetSystems",value:function(){return[this.targetSystemCoordinates]}},{key:"serialize",value:function(){return{type:i.H.TERMINATOR_LANDING,objectId:this.objectId,state:this.state}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},61094:function(e,t,n){"use strict";n.d(t,{a:()=>y});var r=n(48462),o=n(59450),i=n(61032),a=n(44710);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t,n){if(!t.has(e))throw TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function c(e,t){var n=l(e,t,"get");return n.get?n.get.call(e):n.value}function u(e,t,n){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object");t.set(e,n)}function h(e,t,n){var r=l(e,t,"set");if(r.set)r.set.call(e,n);else{if(!r.writable)throw TypeError("attempted to set read only private field");r.value=n}return n}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return s(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var m=new WeakMap,v=new WeakMap,y=function(){var e,t;function n(e,t){var o=this;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");f(this,"uuid",void 0),u(this,m,{writable:!0,value:void 0}),u(this,v,{writable:!0,value:void 0}),f(this,"creationDate",void 0),f(this,"timePlayedSeconds",void 0),f(this,"visitedSystemHistory",[]),f(this,"discoveries",void 0),f(this,"visitedObjects",new Set),f(this,"currentItinerary",void 0),f(this,"systemBookmarks",void 0),f(this,"currentMissions",[]),f(this,"completedMissions",[]),f(this,"serializedSpaceships",[]),f(this,"instancedSpaceships",[]),f(this,"spareSpaceshipComponents",void 0),f(this,"tutorials",void 0),f(this,"onNameChangedObservable",new r.cP),f(this,"onBalanceChangedObservable",new r.cP),this.uuid=e.uuid,h(this,m,e.name),h(this,v,e.balance),this.creationDate=new Date(e.creationDate),this.timePlayedSeconds=e.timePlayedSeconds,this.visitedSystemHistory=e.visitedSystemHistory.map(function(e){return structuredClone(e)}),this.discoveries={local:e.discoveries.local.map(function(e){return structuredClone(e)}),uploaded:e.discoveries.uploaded.map(function(e){return structuredClone(e)})},this.discoveries.local.forEach(function(e){o.visitedObjects.add(JSON.stringify(e.objectId))}),this.discoveries.uploaded.forEach(function(e){o.visitedObjects.add(JSON.stringify(e.objectId))}),this.currentItinerary=structuredClone(e.currentItinerary),this.systemBookmarks=e.systemBookmarks.map(function(e){return structuredClone(e)}),this.currentMissions=e.currentMissions.map(function(e){return i.P.Deserialize(e,t)}).filter(function(e){return null!==e}),this.completedMissions=e.completedMissions.map(function(e){return i.P.Deserialize(e,t)}).filter(function(e){return null!==e}),this.serializedSpaceships=p(e.spaceShips),this.spareSpaceshipComponents=new Set(e.spareSpaceshipComponents),this.tutorials=e.tutorials}return e=[{key:"hasVisitedObject",value:function(e){return this.visitedObjects.has(JSON.stringify(e))}},{key:"addVisitedObjectIfNew",value:function(e){return!this.hasVisitedObject(e)&&(this.visitedObjects.add(JSON.stringify(e)),this.discoveries.local.push({objectId:e,discoveryTimestamp:Date.now(),explorerName:this.getName()}),!0)}},{key:"copyFrom",value:function(e,t){var n=this;this.uuid=e.uuid,this.setName(e.getName()),this.setBalance(e.getBalance()),this.creationDate=new Date(e.creationDate),this.timePlayedSeconds=e.timePlayedSeconds,this.visitedSystemHistory=e.visitedSystemHistory.map(function(e){return structuredClone(e)}),this.discoveries={local:e.discoveries.local.map(function(e){return structuredClone(e)}),uploaded:e.discoveries.uploaded.map(function(e){return structuredClone(e)})},this.visitedObjects.clear(),e.visitedObjects.forEach(function(e){n.visitedObjects.add(e)}),this.currentItinerary=null!==e.currentItinerary?p(e.currentItinerary):null,this.systemBookmarks=e.systemBookmarks.map(function(e){return structuredClone(e)}),this.currentMissions=e.currentMissions.map(function(e){return i.P.Deserialize(e.serialize(),t)}).filter(function(e){return null!==e}),this.completedMissions=e.completedMissions.map(function(e){return i.P.Deserialize(e.serialize(),t)}).filter(function(e){return null!==e}),this.serializedSpaceships=e.serializedSpaceships.map(function(e){return structuredClone(e)}),this.instancedSpaceships=p(e.instancedSpaceships),this.spareSpaceshipComponents=structuredClone(e.spareSpaceshipComponents),this.tutorials=structuredClone(e.tutorials)}},{key:"setName",value:function(e){h(this,m,e),this.onNameChangedObservable.notifyObservers(e)}},{key:"getName",value:function(){return c(this,m)}},{key:"setBalance",value:function(e){h(this,v,e),this.onBalanceChangedObservable.notifyObservers(e)}},{key:"getBalance",value:function(){return c(this,v)}},{key:"pay",value:function(e){this.setBalance(this.getBalance()-e)}},{key:"earn",value:function(e){this.setBalance(this.getBalance()+e)}}],t=[{key:"Default",value:function(e){return new n({uuid:crypto.randomUUID(),name:n.DEFAULT_NAME,balance:n.DEFAULT_BALANCE,creationDate:new Date().toISOString(),timePlayedSeconds:0,visitedSystemHistory:[],discoveries:{uploaded:[],local:[]},currentItinerary:null,systemBookmarks:[],currentMissions:[],completedMissions:[],spaceShips:[(0,o.Eq)()],spareSpaceshipComponents:[],tutorials:{flightCompleted:!1,stationLandingCompleted:!1,starMapCompleted:!1,fuelScoopingCompleted:!1}},e)}},{key:"Deserialize",value:function(e,t){return new n(e,t)}},{key:"Serialize",value:function(e){var t=e.serializedSpaceships.map(function(e){return(0,a.z)(JSON.stringify(e))}).map(function(e){return o.oC.safeParse(e).data}).filter(function(e){return void 0!==e});return{uuid:e.uuid,name:e.getName(),balance:e.getBalance(),creationDate:e.creationDate.toISOString(),timePlayedSeconds:Math.round(e.timePlayedSeconds),visitedSystemHistory:e.visitedSystemHistory.map(function(e){return structuredClone(e)}),discoveries:{local:e.discoveries.local.map(function(e){return structuredClone(e)}),uploaded:e.discoveries.uploaded.map(function(e){return structuredClone(e)})},currentItinerary:null!==e.currentItinerary?p(e.currentItinerary):null,systemBookmarks:e.systemBookmarks.map(function(e){return structuredClone(e)}),currentMissions:e.currentMissions.map(function(e){return e.serialize()}),completedMissions:e.completedMissions.map(function(e){return e.serialize()}),spaceShips:t.concat(e.instancedSpaceships.map(function(e){return e.serialize()})),spareSpaceshipComponents:Array.from(e.spareSpaceshipComponents),tutorials:e.tutorials}}}],e&&d(n.prototype,e),t&&d(n,t),n}();f(y,"DEFAULT_NAME","Python"),f(y,"DEFAULT_BALANCE",1e4)},41734:function(e,t,n){"use strict";n.d(t,{t:()=>y});var r=n(47347),o=n(78930),i=n(92771),a=n(62325),s=n(77621),l=n(54205),c=n(56754),u=n(56072);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}var y=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,a,h,p){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var y,g,b,S="julia";void 0===o.M.ShadersStore["".concat(S,"FragmentShader")]&&(o.M.ShadersStore["".concat(S,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\n// based on https://www.shadertoy.com/view/tsc3Rj and https://www.shadertoy.com/view/wdjGWR\n\nvarying vec2 vUV;\n\nuniform vec3 accentColor;\nuniform float elapsedSeconds;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\nuniform sampler2D textureSampler;\nuniform sampler2D depthSampler;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat saturate(float value) {\n    if(value < 0.0) return 0.0;\n    if(value > 1.0) return 1.0;\n    return value;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// taken from https://github.com/BarthPaleologue/feather/blob/main/assets/shaders/pbr/fragment.glsl\n// based on https://learnopengl.com/PBR/Lighting\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness) {\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness) {\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return num / denom;\n}\n\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n}\n\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\n}\n\nvec3 calculateLight(vec3 albedo, vec3 normal, float roughness, float metallic, vec3 lightDir, vec3 viewDir, vec3 lightColor) {\n    vec3 H = normalize(viewDir + lightDir);\n\n    vec3 F0 = vec3(0.04);\n    F0 = mix(F0, albedo, metallic);\n\n    vec3 F  = fresnelSchlick(max(dot(H, viewDir), 0.0), F0);\n    float NDF = DistributionGGX(normal, H, roughness);\n    float G   = GeometrySmith(normal, viewDir, lightDir, roughness);\n\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(normal, viewDir), 0.0) * max(dot(normal, lightDir), 0.0)  + 1.0; // + 1.0 to prevent division by zero at glancing angles\n    vec3 specular     = numerator / denominator;\n\n    vec3 kS = F;\n    vec3 kD = 1.0 - kS;\n\n    kD *= 1.0 - metallic;\n\n    vec3 radiance = lightColor;\n\n    float NdotL = max(dot(normal, lightDir), 0.0);\n\n    vec3 diffuse = kD * (albedo)/ PI;\n    return (diffuse + specular) * radiance * NdotL;\n}\n\n#define MARCHINGITERATIONS 64\n\n#define MARCHINGSTEP 1.0\n#define EPSILON 0.001\n\n#define SDF_STEPS 15\n\n// cosine based palette, 4 vec3 params\nvec3 cosineColor(in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d) {\n    return a + b * cos(6.28318*(c*t+d));\n}\nvec3 palette (float t) {\n    return cosineColor(t, vec3(0.5, 0.5, 0.5), vec3(0.5, 0.5, 0.5), vec3(0.07, 0.07, 0.07), accentColor);\n}\n\nvec2 sdf(vec3 pos)\n{\n    float t = elapsedSeconds / 3.0;\n    \n	vec4 c = 0.5*vec4(cos(t),cos(t*1.1),cos(t*2.3),cos(t*3.1));\n    vec4 z = vec4(pos, 0.0 );\n	vec4 nz;\n    \n	float md2 = 1.0;\n	float mz2 = dot(z,z);\n\n	for(int i=0;i<SDF_STEPS;i++)\n	{\n		md2*=4.0*mz2;\n	    nz.x=z.x*z.x-dot(z.yzw,z.yzw);\n		nz.yzw=2.0*z.x*z.yzw;\n		z=nz+c;\n\n		mz2 = dot(z,z);\n		if(mz2>4.0)\n        {\n			break;\n        }\n	}\n\n    float colorIndex = 50.0 * pow(md2, 0.128 / float(MARCHINGITERATIONS));\n\n    float distance = 0.25*sqrt(mz2/md2)*log(mz2);\n\n	return vec2(distance, colorIndex);\n}\n\n// TRACING A PATH : \n// measuring the distance to the nearest object on the x coordinate\n// and returning the color index on the y coordinate\nvec2 rayMarch(vec3 origin, vec3 ray, float initialDepth, out float steps) {\n    //t is the point at which we are in the measuring of the distance\n    float depth = initialDepth;\n    steps = 0.0;\n    float c = 0.0;\n\n    for (int i = 0; i < MARCHINGITERATIONS; i++) {\n        vec3 path = origin + ray * depth;\n        vec2 dist = sdf(path);\n        // we want t to be as large as possible at each step but not too big to induce artifacts\n        depth += MARCHINGSTEP * dist.x;\n        c += dist.y;\n        steps++;\n\n        if(depth > 15.0) {\n            break;\n        }\n    }\n\n    return vec2(depth, c);\n}\n\nfloat contrast(float val, float contrast_offset, float contrast_mid_level)\n{\n    return clamp((val - contrast_mid_level) * (1. + contrast_offset) + contrast_mid_level, 0., 1.);\n}\n\n\nfloat map(vec3 p){\n    return sdf(p).x;\n}\n\n//Determine if a point is in shadow - 1.0 = not in shadow\nfloat getShadow(vec3 rayOrigin, vec3 rayDir, vec3 starPosition) {\n    float t = 0.01;\n    float d = 0.0;\n    float shadow = 1.0;\n    for(int iter = 0; iter < 64; iter++){\n        d = map(rayOrigin + rayDir * t);\n        if(d < 0.0001){\n            return 0.5;\n        }\n        if(t > length(rayOrigin - starPosition) - 0.5){\n            break;\n        }\n        shadow = min(shadow, 32.0 * d / t);\n        t += d;\n    }\n    return 0.5 + 0.5 * shadow;\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n    // actual depth of the scene\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    float impactPoint, escapePoint;\n    if (!(rayIntersectSphere(camera_position, rayDir, object_position, object_radius * object_scaling_determinant, impactPoint, escapePoint))) {\n        gl_FragColor = screenColor;// if not intersecting with atmosphere, return original color\n        return;\n    }\n\n    // scale down so that everything happens in a sphere of radius 2\n    float inverseScaling = 1.0 / (0.5 * object_radius * object_scaling_determinant);\n\n    vec3 origin = camera_position - object_position; // the ray origin in world space\n    origin *= inverseScaling;\n\n    float steps;\n    vec2 juliaDepthAndIndex = rayMarch(origin, rayDir, max(impactPoint, 0.0) * inverseScaling, steps);\n\n    float realDepth = impactPoint + juliaDepthAndIndex.x / inverseScaling;\n\n    if (maximumDistance < realDepth) {\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec3 intersectionPoint = origin + juliaDepthAndIndex.x * rayDir;\n\n    // compute normal and anti-aliasing at the same time\n    vec3 p = intersectionPoint;\n    float delta = EPSILON * 2.0;\n    vec2 x1 = sdf(vec3(p.x + delta, p.y, p.z));\n    vec2 x2 = sdf(vec3(p.x - delta, p.y, p.z));\n    vec2 y1 = sdf(vec3(p.x, p.y + delta, p.z));\n    vec2 y2 = sdf(vec3(p.x, p.y - delta, p.z));\n    vec2 z1 = sdf(vec3(p.x, p.y, p.z + delta));\n    vec2 z2 = sdf(vec3(p.x, p.y, p.z - delta));\n\n    juliaDepthAndIndex += x1 + x2 + y1 + y2 + z1 + z2;\n    juliaDepthAndIndex /= 7.0;\n\n    intersectionPoint = origin + juliaDepthAndIndex.x * rayDir;\n\n    vec3 intersectionPointW = object_position + intersectionPoint / inverseScaling;\n\n    float intersectionDistance = length(intersectionPoint);\n\n    vec3 albedo = palette(juliaDepthAndIndex.y);\n    float roughness = 0.5;\n    float metallic = 0.5;\n    vec3 viewDir = normalize(camera_position - intersectionPointW);\n\n    vec3 normal = normalize(vec3(\n        x1.x - x2.x,\n        y1.x - y2.x,\n        z1.x - z2.x\n    ));\n    \n    vec3 color = vec3(0.0);\n    for (int i = 0; i < nbStars; i++) {\n        vec3 starDir = normalize(star_positions[i] - object_position);\n        float shadow = getShadow(intersectionPoint, starDir, star_positions[i]);\n        color += calculateLight(albedo, normal, roughness, metallic, starDir, viewDir, star_colors[i]) * shadow;\n    }\n\n    if(nbStars == 0) {\n        vec3 lightDir = normalize(vec3(1.0, 1.0, 1.0));\n        vec3 lightColor = vec3(1.0);\n        float shadow = getShadow(intersectionPoint, lightDir, intersectionPoint + lightDir * 100.0);\n        color += calculateLight(albedo, normal, roughness, metallic, lightDir, viewDir, lightColor) * shadow;\n    }\n\n\n    float ao = steps * 0.01;\n    ao = 1.0 - ao / (ao + 0.5);// reinhard\n    const float contrast_offset = 0.3;\n    const float contrast_mid_level = 0.5;\n    ao = contrast(ao, contrast_offset, contrast_mid_level);\n\n    color = smoothstep(0.0, 0.8, color * 2.0) * 2.0;\n\n    color *= (0.5 + 0.5 * ao);\n\n    gl_FragColor = mix(vec4(color, 1.0), screenColor, smoothstep(2.0, 15.0, intersectionDistance));\n\n}\n");var w={ELAPSED_SECONDS:"elapsedSeconds",ACCENT_COLOR:"accentColor"},T=m(Object.values(l.A)).concat(m(Object.values(s.o)),m(Object.values(u.T)),m(Object.values(w))),A=Object.values(c.R);return y=n,g=[e.name,S,T,A,1,null,i.g.BILINEAR_SAMPLINGMODE,h.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],y=f(y),d(b=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,v()?Reflect.construct(y,g||[],f(this).constructor):y.apply(this,g)),"elapsedSeconds",0),d(b,"activeCamera",null),b.onActivateObservable.add(function(e){b.activeCamera=e}),b.onApplyObservable.add(function(n){if(null===b.activeCamera)throw Error("Camera is null");(0,s.b)(n,b.activeCamera),(0,u.G)(n,p),(0,l.$)(n,e,t),n.setFloat(w.ELAPSED_SECONDS,b.elapsedSeconds),n.setColor3(w.ACCENT_COLOR,a),(0,c.C)(n,b.activeCamera,h)}),b}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&p(n,e),t=[{key:"update",value:function(e){this.elapsedSeconds+=e,this.elapsedSeconds%=3600}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(a.w)},40089:function(e,t,n){"use strict";n.d(t,{M:()=>y});var r=n(47347),o=n(78930),i=n(92771),a=n(62325),s=n(77621),l=n(54205),c=n(56754),u=n(56072);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}var y=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,a,h,p){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var y,g,b,S="mandelbox";void 0===o.M.ShadersStore["".concat(S,"FragmentShader")]&&(o.M.ShadersStore["".concat(S,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nvarying vec2 vUV;\n\nuniform float mr2;\nuniform float spread;\nuniform vec3 accentColor;\nuniform float elapsedSeconds;\nuniform float averageScreenSize;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\nuniform sampler2D textureSampler;\nuniform sampler2D depthSampler;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat saturate(float value) {\n    if(value < 0.0) return 0.0;\n    if(value > 1.0) return 1.0;\n    return value;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// taken from https://github.com/BarthPaleologue/feather/blob/main/assets/shaders/pbr/fragment.glsl\n// based on https://learnopengl.com/PBR/Lighting\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness) {\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness) {\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return num / denom;\n}\n\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n}\n\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\n}\n\nvec3 calculateLight(vec3 albedo, vec3 normal, float roughness, float metallic, vec3 lightDir, vec3 viewDir, vec3 lightColor) {\n    vec3 H = normalize(viewDir + lightDir);\n\n    vec3 F0 = vec3(0.04);\n    F0 = mix(F0, albedo, metallic);\n\n    vec3 F  = fresnelSchlick(max(dot(H, viewDir), 0.0), F0);\n    float NDF = DistributionGGX(normal, H, roughness);\n    float G   = GeometrySmith(normal, viewDir, lightDir, roughness);\n\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(normal, viewDir), 0.0) * max(dot(normal, lightDir), 0.0)  + 1.0; // + 1.0 to prevent division by zero at glancing angles\n    vec3 specular     = numerator / denominator;\n\n    vec3 kS = F;\n    vec3 kD = 1.0 - kS;\n\n    kD *= 1.0 - metallic;\n\n    vec3 radiance = lightColor;\n\n    float NdotL = max(dot(normal, lightDir), 0.0);\n\n    vec3 diffuse = kD * (albedo)/ PI;\n    return (diffuse + specular) * radiance * NdotL;\n}\n\n// Mandelbox DE from \n// http://www.fractalforums.com/3d-fractal-generation/a-mandelbox-distance-estimate-formula/msg21412/#msg21412\n// taken from https://www.shadertoy.com/view/llGXDR\n#define ITERS 10\n#define SCALE 3.0\n\nfloat distanceEstimator(vec3 position) {\n    float MR2 = mr2;\n    vec4 scalevec = vec4(SCALE, SCALE, SCALE, abs(SCALE)) / MR2;\n    float C1 = abs(SCALE-1.0), C2 = pow(abs(SCALE), float(1-ITERS));\n\n  vec4 p = vec4(position.xyz, 1.0), p0 = vec4(position.xyz, 1.0);  // p.w is knighty's DEfactor\n  for (int i=0; i<ITERS; i++) {\n    p.xyz = clamp(p.xyz, -1.0, 1.0) * 2.0 - p.xyz;  // box fold: min3, max3, mad3\n    float r2 = dot(p.xyz, p.xyz);  // dp3\n    p.xyzw *= clamp(max(MR2/r2, MR2), 0.0, 1.0);  // sphere fold: div1, max1.sat, mul4\n    p.xyzw = p*scalevec + p0 * spread;  // mad4\n  }\n  return (length(p.xyz) - C1) / p.w - C2;\n}\n\n/** https://www.shadertoy.com/view/llGXDR */\nfloat rayMarch(vec3 rayOrigin, vec3 rayDir, float initialDepth) {\n    float currentDepth = initialDepth;\n    float newDistance = initialDepth;\n    float stepSizeFactor = 1.3;\n    float oldDistance = 0.0;\n    float stepSize = 0.0;\n    float cerr = 10000.0;\n    float ct = 0.0;\n    float pixradius = 1.0 / averageScreenSize;\n    int inter = 0;\n    for (int i = 0; i < 64; i++) {\n        oldDistance = newDistance;\n        newDistance = distanceEstimator(rayOrigin + rayDir * currentDepth);\n        \n        //Detect intersections missed by over-relaxation\n        if(stepSizeFactor > 1.0 && abs(oldDistance) + abs(newDistance) < stepSize){\n            stepSize -= stepSizeFactor * stepSize;\n            stepSizeFactor = 1.0;\n            currentDepth += stepSize;\n            continue;\n        }\n        stepSize = stepSizeFactor * newDistance;\n        \n        float err = newDistance / currentDepth;\n        \n        if(abs(err) < abs(cerr)){\n            ct = currentDepth;\n            cerr = err;\n        }\n        \n        //Intersect when d / t < one pixel\n        if(abs(err) < pixradius) {\n            inter = 1;\n            break;\n        }\n        \n        currentDepth += stepSize;\n        /*if(currentDepth > 30.0){\n            break;\n        }*/\n    }\n    if(inter == 0){\n        ct = -1.0;\n    }\n    return ct;\n}\n\nfloat map(vec3 p){\n    return distanceEstimator(p);\n}\n\n//Approximate normal\nvec3 getNormal(vec3 p){\n    return normalize(vec3(map(vec3(p.x + 0.0001, p.yz)) - map(vec3(p.x - 0.0001, p.yz)),\n                          map(vec3(p.x, p.y + 0.0001, p.z)) - map(vec3(p.x, p.y - 0.0001, p.z)),\n                	      map(vec3(p.xy, p.z + 0.0001)) - map(vec3(p.xy, p.z - 0.0001))));\n}\n\n//Determine if a point is in shadow - 1.0 = not in shadow\nfloat getShadow(vec3 rayOrigin, vec3 rayDir, vec3 starPosition) {\n    float t = 0.01;\n    float d = 0.0;\n    float shadow = 1.0;\n    for(int iter = 0; iter < 64; iter++){\n        d = map(rayOrigin + rayDir * t);\n        if(d < 0.0001){\n            return 0.5;\n        }\n        if(t > length(rayOrigin - starPosition) - 0.5){\n            break;\n        }\n        shadow = min(shadow, 32.0 * d / t);\n        t += d;\n    }\n    return 0.5 + 0.5 * shadow;\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n    // actual depth of the scene\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    float impactPoint, escapePoint;\n    if (!(rayIntersectSphere(camera_position, rayDir, object_position, object_radius * object_scaling_determinant, impactPoint, escapePoint))) {\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    // scale down so that everything happens in a sphere of radius 2\n    float inverseScaling = 3.0 * SCALE / (1.0 * object_radius * object_scaling_determinant);\n\n    vec3 origin = camera_position - object_position; // the ray origin in world space\n    origin *= inverseScaling;\n\n    float rayDepth = rayMarch(origin, rayDir, max(impactPoint, 0.0) * inverseScaling);\n    if(rayDepth == -1.0){\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec3 intersectionPoint = origin + rayDepth * rayDir;\n\n    vec3 intersectionPointW = object_position + intersectionPoint / inverseScaling;\n\n    if(length(intersectionPointW - camera_position) > maximumDistance) {\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec3 normal = getNormal(intersectionPoint);\n\n    vec3 albedo = accentColor;\n    float roughness = 0.4;\n    float metallic = 0.2;\n    vec3 viewDir = normalize(camera_position - intersectionPointW);\n\n    vec3 color = vec3(0.0);\n    for (int i = 0; i < nbStars; i++) {\n        vec3 starDir = normalize(star_positions[i] - object_position);\n        float shadow = getShadow(intersectionPoint, starDir, star_positions[i]);\n        color += calculateLight(albedo, normal, roughness, metallic, starDir, viewDir, star_colors[i]) * shadow;\n    }\n\n    if(nbStars == 0) {\n        vec3 lightDir = normalize(vec3(1.0, 1.0, 1.0));\n        vec3 lightColor = vec3(1.0);\n        float shadow = getShadow(intersectionPoint, lightDir, intersectionPoint + lightDir * 100.0);\n        color += calculateLight(albedo, normal, roughness, metallic, lightDir, viewDir, lightColor) * shadow;\n    }\n\n    color = smoothstep(0.0, 0.8, color * 2.0) * 2.0;\n\n    gl_FragColor = vec4(color, 1.0);\n}\n");var w={ACCENT_COLOR:"accentColor",ELAPSED_SECONDS:"elapsedSeconds",MR2:"mr2",SPREAD:"spread",AVERAGE_SCREEN_SIZE:"averageScreenSize"},T=m(Object.values(l.A)).concat(m(Object.values(s.o)),m(Object.values(u.T)),m(Object.values(w))),A=Object.values(c.R);return y=n,g=[e.name,S,T,A,1,null,i.g.BILINEAR_SAMPLINGMODE,h.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],y=f(y),d(b=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,v()?Reflect.construct(y,g||[],f(this).constructor):y.apply(this,g)),"elapsedSeconds",0),d(b,"activeCamera",null),b.onActivateObservable.add(function(e){b.activeCamera=e}),b.onApplyObservable.add(function(n){if(null===b.activeCamera)throw Error("Camera is null");(0,s.b)(n,b.activeCamera),(0,u.G)(n,p),(0,l.$)(n,e,t),n.setFloat(w.MR2,a.mr2),n.setFloat(w.SPREAD,a.spread),n.setColor3(w.ACCENT_COLOR,a.color),n.setFloat(w.ELAPSED_SECONDS,b.elapsedSeconds),n.setFloat(w.AVERAGE_SCREEN_SIZE,(h.getEngine().getRenderWidth()+h.getEngine().getRenderHeight())/2),(0,c.C)(n,b.activeCamera,h)}),b}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&p(n,e),t=[{key:"update",value:function(e){this.elapsedSeconds+=e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(a.w)},14632:function(e,t,n){"use strict";n.d(t,{W:()=>y});var r=n(47347),o=n(78930),i=n(92771),a=n(62325),s=n(77621),l=n(54205),c=n(56754),u=n(56072);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}var y=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,a,h,p){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var y,g,b,S="mandelbulb";void 0===o.M.ShadersStore["".concat(S,"FragmentShader")]&&(o.M.ShadersStore["".concat(S,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\n// based on https://www.shadertoy.com/view/tsc3Rj and https://www.shadertoy.com/view/wdjGWR\n\nvarying vec2 vUV;\n\nuniform float power;\nuniform vec3 accentColor;\nuniform float elapsedSeconds;\nuniform float averageScreenSize;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\nuniform sampler2D textureSampler;\nuniform sampler2D depthSampler;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat saturate(float value) {\n    if(value < 0.0) return 0.0;\n    if(value > 1.0) return 1.0;\n    return value;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// taken from https://github.com/BarthPaleologue/feather/blob/main/assets/shaders/pbr/fragment.glsl\n// based on https://learnopengl.com/PBR/Lighting\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness) {\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness) {\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return num / denom;\n}\n\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n}\n\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\n}\n\nvec3 calculateLight(vec3 albedo, vec3 normal, float roughness, float metallic, vec3 lightDir, vec3 viewDir, vec3 lightColor) {\n    vec3 H = normalize(viewDir + lightDir);\n\n    vec3 F0 = vec3(0.04);\n    F0 = mix(F0, albedo, metallic);\n\n    vec3 F  = fresnelSchlick(max(dot(H, viewDir), 0.0), F0);\n    float NDF = DistributionGGX(normal, H, roughness);\n    float G   = GeometrySmith(normal, viewDir, lightDir, roughness);\n\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(normal, viewDir), 0.0) * max(dot(normal, lightDir), 0.0)  + 1.0; // + 1.0 to prevent division by zero at glancing angles\n    vec3 specular     = numerator / denominator;\n\n    vec3 kS = F;\n    vec3 kD = 1.0 - kS;\n\n    kD *= 1.0 - metallic;\n\n    vec3 radiance = lightColor;\n\n    float NdotL = max(dot(normal, lightDir), 0.0);\n\n    vec3 diffuse = kD * (albedo)/ PI;\n    return (diffuse + specular) * radiance * NdotL;\n}\n\n#define MARCHINGITERATIONS 64\n#define MANDELBROTSTEPS 15\n\n// cosine based palette, 4 vec3 params\nvec3 cosineColor(in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d) {\n    return a + b * cos(6.28318*(c*t+d));\n}\nvec3 palette (float t) {\n    return cosineColor(t, vec3(0.5, 0.5, 0.5), vec3(0.5, 0.5, 0.5), vec3(0.07, 0.07, 0.07), accentColor);\n}\n\n// distance estimator to a mandelbulb set\n// returns the distance to the set on the x coordinate \n// and the color on the y coordinate\nvec2 distanceEstimator(vec3 pos) {\n    float Power = power + 4.0 * sin(elapsedSeconds * 0.1);\n    vec3 z = pos;\n    float dr = 1.0;\n    float r = 0.0;\n    for (int i = 0; i < MANDELBROTSTEPS; i++) {\n        r = length(z);\n        if (r > 1.5) break;\n\n        // convert to polar coordinates\n        float theta = acos(z.z / r);\n        float phi = atan(z.y, z.x);\n        dr = pow(r, Power - 1.0) * Power * dr + 1.0;\n\n        // scale and rotate the point\n        float zr = pow(r, Power);\n        theta *= Power;\n        phi *= Power;\n\n        // convert back to cartesian coordinates\n        z = zr * vec3(sin(theta) * cos(phi), sin(phi) * sin(theta), cos(theta));\n        z += pos;\n    }\n\n    float distance = 0.5 * log(r) * r / dr;\n    float colorIndex = 50.0 * pow(dr, 0.128 / float(MARCHINGITERATIONS));\n\n    return vec2(distance, colorIndex);\n}\n\nfloat contrast(float val, float contrast_offset, float contrast_mid_level)\n{\n    return clamp((val - contrast_mid_level) * (1. + contrast_offset) + contrast_mid_level, 0., 1.);\n}\n\n\nvec2 rayMarch(vec3 rayOrigin, vec3 rayDir, float initialDepth, out float steps) {\n    float currentDepth = initialDepth;\n    float newDistance = initialDepth;\n    float stepSizeFactor = 1.3;\n    float oldDistance = 0.0;\n    float stepSize = 0.0;\n    float cerr = 10000.0;\n    float ct = 0.0;\n    float pixradius = 1.0 / averageScreenSize;\n    float color = 0.0;\n    int inter = 0;\n    for (int i = 0; i < MARCHINGITERATIONS; i++) {\n        steps = float(i);\n        oldDistance = newDistance;\n        vec2 distanceData = distanceEstimator(rayOrigin + rayDir * currentDepth);\n        newDistance = distanceData.x;        \n        color += distanceData.y;\n\n        //Detect intersections missed by over-relaxation\n        if(stepSizeFactor > 1.0 && abs(oldDistance) + abs(newDistance) < stepSize){\n            stepSize -= stepSizeFactor * stepSize;\n            stepSizeFactor = 1.0;\n            currentDepth += stepSize;\n            continue;\n        }\n        stepSize = stepSizeFactor * newDistance;\n        \n        float err = newDistance / currentDepth;\n        \n        if(abs(err) < abs(cerr)){\n            ct = currentDepth;\n            cerr = err;\n        }\n        \n        //Intersect when d / t < one pixel\n        if(abs(err) < pixradius) {\n            inter = 1;\n            break;\n        }\n        \n        currentDepth += stepSize;\n\n        /*if(currentDepth > 30.0){\n            break;\n        }*/\n    }\n    if(inter == 0){\n        ct = -1.0;\n    }\n    return vec2(ct, color);\n}\n\nfloat map(vec3 p){\n    return distanceEstimator(p).x;\n}\n\n//Approximate normal\nvec3 getNormal(vec3 p){\n    return normalize(vec3(map(vec3(p.x + 0.0001, p.yz)) - map(vec3(p.x - 0.0001, p.yz)),\n                          map(vec3(p.x, p.y + 0.0001, p.z)) - map(vec3(p.x, p.y - 0.0001, p.z)),\n                	      map(vec3(p.xy, p.z + 0.0001)) - map(vec3(p.xy, p.z - 0.0001))));\n}\n\n//Determine if a point is in shadow - 1.0 = not in shadow\nfloat getShadow(vec3 rayOrigin, vec3 rayDir, vec3 starPosition) {\n    float t = 0.01;\n    float d = 0.0;\n    float shadow = 1.0;\n    for(int iter = 0; iter < 64; iter++){\n        d = map(rayOrigin + rayDir * t);\n        if(d < 0.0001){\n            return 0.5;\n        }\n        if(t > length(rayOrigin - starPosition) - 0.5){\n            break;\n        }\n        shadow = min(shadow, 32.0 * d / t);\n        t += d;\n    }\n    return 0.5 + 0.5 * shadow;\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n    // actual depth of the scene\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    float impactPoint, escapePoint;\n    if (!(rayIntersectSphere(camera_position, rayDir, object_position, object_radius * object_scaling_determinant, impactPoint, escapePoint))) {\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    // scale down so that everything happens in a sphere of radius 2\n    float inverseScaling = 2.0 / (1.0 * object_radius * object_scaling_determinant);\n\n    vec3 origin = camera_position - object_position; // the ray origin in world space\n    origin *= inverseScaling;\n\n    float steps;\n    vec2 rayInfo = rayMarch(origin, rayDir, max(impactPoint, 0.0) * inverseScaling, steps);\n    float rayDepth = rayInfo.x;\n    float rayColor = rayInfo.y;\n    if(rayDepth == -1.0){\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec3 intersectionPoint = origin + rayDepth * rayDir;\n\n    vec3 intersectionPointW = object_position + intersectionPoint / inverseScaling;\n\n    if(length(intersectionPointW - camera_position) > maximumDistance) {\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec3 normal = getNormal(intersectionPoint);\n\n    vec3 albedo = palette(rayColor * 0.01);\n    float roughness = 0.4;\n    float metallic = 0.2;\n    vec3 viewDir = normalize(camera_position - intersectionPointW);\n\n    vec3 color = vec3(0.0);\n    for (int i = 0; i < nbStars; i++) {\n        vec3 starDir = normalize(star_positions[i] - object_position);\n        float shadow = getShadow(intersectionPoint, starDir, star_positions[i]);\n        color += calculateLight(albedo, normal, roughness, metallic, starDir, viewDir, star_colors[i]) * shadow;\n    }\n\n    if(nbStars == 0) {\n        vec3 lightDir = normalize(vec3(1.0, 1.0, 1.0));\n        vec3 lightColor = vec3(1.0);\n        float shadow = getShadow(intersectionPoint, lightDir, intersectionPoint + lightDir * 100.0);\n        color += calculateLight(albedo, normal, roughness, metallic, lightDir, viewDir, lightColor) * shadow;\n    }\n\n    float ao = steps * 0.01;\n    ao = 1.0 - ao / (ao + 0.5);// reinhard\n    const float contrast_offset = 0.3;\n    const float contrast_mid_level = 0.5;\n    ao = contrast(ao, contrast_offset, contrast_mid_level);\n\n    color = smoothstep(0.0, 0.8, color * 2.0) * 2.0;\n\n    color *= (0.5 + 0.5 * ao);\n\n    gl_FragColor = vec4(color, 1.0);\n}\n");var w={POWER:"power",ACCENT_COLOR:"accentColor",ELAPSED_SECONDS:"elapsedSeconds",AVERAGE_SCREEN_SIZE:"averageScreenSize"},T=m(Object.values(l.A)).concat(m(Object.values(s.o)),m(Object.values(u.T)),m(Object.values(w))),A=Object.values(c.R);return y=n,g=[e.name,S,T,A,1,null,i.g.BILINEAR_SAMPLINGMODE,h.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],y=f(y),d(b=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,v()?Reflect.construct(y,g||[],f(this).constructor):y.apply(this,g)),"elapsedSeconds",0),d(b,"activeCamera",null),b.onActivateObservable.add(function(e){b.activeCamera=e}),b.onApplyObservable.add(function(n){if(null===b.activeCamera)throw Error("Camera is null");(0,s.b)(n,b.activeCamera),(0,u.G)(n,p),(0,l.$)(n,e,t),n.setFloat(w.POWER,a.power),n.setColor3(w.ACCENT_COLOR,a.accentColor),n.setFloat(w.ELAPSED_SECONDS,b.elapsedSeconds),n.setFloat(w.AVERAGE_SCREEN_SIZE,(h.getEngine().getRenderWidth()+h.getEngine().getRenderHeight())/2),(0,c.C)(n,b.activeCamera,h)}),b}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&p(n,e),t=[{key:"update",value:function(e){this.elapsedSeconds+=e,this.elapsedSeconds%=3600}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(a.w)},21931:function(e,t,n){"use strict";n.d(t,{Q:()=>y});var r=n(47347),o=n(78930),i=n(92771),a=n(62325),s=n(77621),l=n(54205),c=n(56754),u=n(56072);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}var y=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,a,h,p){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var y,g,b,S="MengerSponge";void 0===o.M.ShadersStore["".concat(S,"FragmentShader")]&&(o.M.ShadersStore["".concat(S,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nvarying vec2 vUV;\n\nuniform vec3 accentColor;\nuniform float elapsedSeconds;\nuniform float averageScreenSize;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\nuniform sampler2D textureSampler;\nuniform sampler2D depthSampler;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat saturate(float value) {\n    if(value < 0.0) return 0.0;\n    if(value > 1.0) return 1.0;\n    return value;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// taken from https://github.com/BarthPaleologue/feather/blob/main/assets/shaders/pbr/fragment.glsl\n// based on https://learnopengl.com/PBR/Lighting\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness) {\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness) {\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return num / denom;\n}\n\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n}\n\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\n}\n\nvec3 calculateLight(vec3 albedo, vec3 normal, float roughness, float metallic, vec3 lightDir, vec3 viewDir, vec3 lightColor) {\n    vec3 H = normalize(viewDir + lightDir);\n\n    vec3 F0 = vec3(0.04);\n    F0 = mix(F0, albedo, metallic);\n\n    vec3 F  = fresnelSchlick(max(dot(H, viewDir), 0.0), F0);\n    float NDF = DistributionGGX(normal, H, roughness);\n    float G   = GeometrySmith(normal, viewDir, lightDir, roughness);\n\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(normal, viewDir), 0.0) * max(dot(normal, lightDir), 0.0)  + 1.0; // + 1.0 to prevent division by zero at glancing angles\n    vec3 specular     = numerator / denominator;\n\n    vec3 kS = F;\n    vec3 kD = 1.0 - kS;\n\n    kD *= 1.0 - metallic;\n\n    vec3 radiance = lightColor;\n\n    float NdotL = max(dot(normal, lightDir), 0.0);\n\n    vec3 diffuse = kD * (albedo)/ PI;\n    return (diffuse + specular) * radiance * NdotL;\n}\n\nfloat sdBox( vec3 p, vec3 b ) {\n  vec3  di = abs(p) - b;\n  float mc = max(di.x,max(di.y,di.z));\n  return min(mc,length(max(di,0.0)));\n}\n\nfloat boxIntersect( in vec3 ro, in vec3 rd, in vec3 rad ) {\n    vec3 m = 1.0/rd;\n    vec3 n = m*ro;\n    vec3 k = abs(m)*rad;\n	\n    vec3 t1 = -n - k;\n    vec3 t2 = -n + k;\n\n	float tN = max( max( t1.x, t1.y ), t1.z );\n	float tF = min( min( t2.x, t2.y ), t2.z );\n	\n	if( tN > tF || tF < 0.0) return 1e30;\n	return tN;\n}\n\n//https://www.shadertoy.com/view/XttfRN\nfloat distanceEstimator( in vec3 p ) {\n    float d = sdBox(p,vec3(1.0));\n    float s = .5;\n    for( int m=0; m<7; m++ ) {\n        vec3 a = fract( p*s )-.5;\n        s *= 3.;\n        vec3 r = abs(1.-6.*abs(a));\n        float da = max(r.x,r.y);\n        float db = max(r.y,r.z);\n        float dc = max(r.z,r.x);\n        float c = (min(da,min(db,dc))-1.0)/(2.*s);\n\n        if( c>d ) {\n          d = c;\n        }\n    }\n    return d;\n}\n\n/** https://www.shadertoy.com/view/llGXDR */\nfloat rayMarch(vec3 rayOrigin, vec3 rayDir, float initialDepth) {\n    float currentDepth = initialDepth;\n    float newDistance = initialDepth;\n    float stepSizeFactor = 1.3;\n    float oldDistance = 0.0;\n    float stepSize = 0.0;\n    float cerr = 10000.0;\n    float ct = 0.0;\n    float pixradius = 1.0 / averageScreenSize;\n    int inter = 0;\n    for (int i = 0; i < 64; i++) {\n        oldDistance = newDistance;\n        newDistance = distanceEstimator(rayOrigin + rayDir * currentDepth);\n        \n        //Detect intersections missed by over-relaxation\n        if(stepSizeFactor > 1.0 && abs(oldDistance) + abs(newDistance) < stepSize){\n            stepSize -= stepSizeFactor * stepSize;\n            stepSizeFactor = 1.0;\n            currentDepth += stepSize;\n            continue;\n        }\n        stepSize = stepSizeFactor * newDistance;\n        \n        float err = newDistance / currentDepth;\n        \n        if(abs(err) < abs(cerr)){\n            ct = currentDepth;\n            cerr = err;\n        }\n        \n        //Intersect when d / t < one pixel\n        if(abs(err) < pixradius) {\n            inter = 1;\n            break;\n        }\n        \n        currentDepth += stepSize;\n        /*if(currentDepth > 30.0){\n            break;\n        }*/\n    }\n    if(inter == 0){\n        ct = -1.0;\n    }\n    return ct;\n}\n\nfloat map(vec3 p){\n    return distanceEstimator(p);\n}\n\n//Approximate normal\nvec3 getNormal(vec3 p){\n    return normalize(vec3(map(vec3(p.x + 0.0001, p.yz)) - map(vec3(p.x - 0.0001, p.yz)),\n                          map(vec3(p.x, p.y + 0.0001, p.z)) - map(vec3(p.x, p.y - 0.0001, p.z)),\n                	      map(vec3(p.xy, p.z + 0.0001)) - map(vec3(p.xy, p.z - 0.0001))));\n}\n\n//Determine if a point is in shadow - 1.0 = not in shadow\nfloat getShadow(vec3 rayOrigin, vec3 rayDir, vec3 starPosition) {\n    float t = 0.01;\n    float d = 0.0;\n    float shadow = 1.0;\n    for(int iter = 0; iter < 64; iter++){\n        d = map(rayOrigin + rayDir * t);\n        if(d < 0.0001){\n            return 0.5;\n        }\n        if(t > length(rayOrigin - starPosition) - 0.5){\n            break;\n        }\n        shadow = min(shadow, 32.0 * d / t);\n        t += d;\n    }\n    return 0.5 + 0.5 * shadow;\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n    // actual depth of the scene\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    float impactPoint, escapePoint;\n    if (!(rayIntersectSphere(camera_position, rayDir, object_position, object_radius * object_scaling_determinant, impactPoint, escapePoint))) {\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    // scale down so that everything happens in a sphere of radius 2\n    float inverseScaling = 2.0 / (1.0 * object_radius * object_scaling_determinant);\n\n    vec3 origin = camera_position - object_position; // the ray origin in world space\n    origin *= inverseScaling;\n\n    float rayDepth = rayMarch(origin, rayDir, max(impactPoint, 0.0) * inverseScaling);\n    if(rayDepth == -1.0){\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec3 intersectionPoint = origin + rayDepth * rayDir;\n\n    vec3 intersectionPointW = object_position + intersectionPoint / inverseScaling;\n\n    if(length(intersectionPointW - camera_position) > maximumDistance) {\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec3 normal = getNormal(intersectionPoint);\n\n    vec3 albedo = accentColor;\n    float roughness = 0.4;\n    float metallic = 0.2;\n    vec3 viewDir = normalize(camera_position - intersectionPointW);\n\n    vec3 color = vec3(0.0);\n    for (int i = 0; i < nbStars; i++) {\n        vec3 starDir = normalize(star_positions[i] - object_position);\n        float shadow = getShadow(intersectionPoint, starDir, star_positions[i]);\n        color += calculateLight(albedo, normal, roughness, metallic, starDir, viewDir, star_colors[i]) * shadow;\n    }\n\n    if(nbStars == 0) {\n        vec3 lightDir = normalize(vec3(1.0, 1.0, 1.0));\n        vec3 lightColor = vec3(1.0);\n        float shadow = getShadow(intersectionPoint, lightDir, intersectionPoint + lightDir * 100.0);\n        color += calculateLight(albedo, normal, roughness, metallic, lightDir, viewDir, lightColor) * shadow;\n    }\n\n    color = smoothstep(0.0, 0.8, color * 2.0) * 2.0;\n\n    gl_FragColor = vec4(color, 1.0);\n}\n");var w={ACCENT_COLOR:"accentColor",ELAPSED_SECONDS:"elapsedSeconds",AVERAGE_SCREEN_SIZE:"averageScreenSize"},T=m(Object.values(l.A)).concat(m(Object.values(s.o)),m(Object.values(u.T)),m(Object.values(w))),A=Object.values(c.R);return y=n,g=[e.name,S,T,A,1,null,i.g.BILINEAR_SAMPLINGMODE,h.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],y=f(y),d(b=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,v()?Reflect.construct(y,g||[],f(this).constructor):y.apply(this,g)),"elapsedSeconds",0),d(b,"activeCamera",null),b.onActivateObservable.add(function(e){b.activeCamera=e}),b.onApplyObservable.add(function(n){if(null===b.activeCamera)throw Error("Camera is null");(0,s.b)(n,b.activeCamera),(0,u.G)(n,p),(0,l.$)(n,e,t),n.setColor3(w.ACCENT_COLOR,a.color),n.setFloat(w.ELAPSED_SECONDS,b.elapsedSeconds),n.setFloat(w.AVERAGE_SCREEN_SIZE,(h.getEngine().getRenderWidth()+h.getEngine().getRenderHeight())/2),(0,c.C)(n,b.activeCamera,h)}),b}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&p(n,e),t=[{key:"update",value:function(e){this.elapsedSeconds+=e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(a.w)},49466:function(e,t,n){"use strict";n.d(t,{$:()=>y});var r=n(47347),o=n(78930),i=n(92771),a=n(62325),s=n(77621),l=n(54205),c=n(56754),u=n(56072);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}var y=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,a,h,p){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var y,g,b,S="SierpinskiPyramid";void 0===o.M.ShadersStore["".concat(S,"FragmentShader")]&&(o.M.ShadersStore["".concat(S,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nvarying vec2 vUV;\n\nuniform vec3 accentColor;\nuniform float elapsedSeconds;\nuniform float averageScreenSize;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\nuniform sampler2D textureSampler;\nuniform sampler2D depthSampler;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat saturate(float value) {\n    if(value < 0.0) return 0.0;\n    if(value > 1.0) return 1.0;\n    return value;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// taken from https://github.com/BarthPaleologue/feather/blob/main/assets/shaders/pbr/fragment.glsl\n// based on https://learnopengl.com/PBR/Lighting\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness) {\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness) {\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return num / denom;\n}\n\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n}\n\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\n}\n\nvec3 calculateLight(vec3 albedo, vec3 normal, float roughness, float metallic, vec3 lightDir, vec3 viewDir, vec3 lightColor) {\n    vec3 H = normalize(viewDir + lightDir);\n\n    vec3 F0 = vec3(0.04);\n    F0 = mix(F0, albedo, metallic);\n\n    vec3 F  = fresnelSchlick(max(dot(H, viewDir), 0.0), F0);\n    float NDF = DistributionGGX(normal, H, roughness);\n    float G   = GeometrySmith(normal, viewDir, lightDir, roughness);\n\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(normal, viewDir), 0.0) * max(dot(normal, lightDir), 0.0)  + 1.0; // + 1.0 to prevent division by zero at glancing angles\n    vec3 specular     = numerator / denominator;\n\n    vec3 kS = F;\n    vec3 kD = 1.0 - kS;\n\n    kD *= 1.0 - metallic;\n\n    vec3 radiance = lightColor;\n\n    float NdotL = max(dot(normal, lightDir), 0.0);\n\n    vec3 diffuse = kD * (albedo)/ PI;\n    return (diffuse + specular) * radiance * NdotL;\n}\n\n// https://www.shadertoy.com/view/4dl3Wl\nfloat distanceEstimator(vec3 z) {\n    const float yOffset = 0.3;\n    const vec3 va = vec3(  0.0,  yOffset + 0.57735,  0.0 );\n    const vec3 vb = vec3(  0.0, -1.0 + yOffset,  1.15470 );\n    const vec3 vc = vec3(  1.0, -1.0 + yOffset, -0.57735 );\n    const vec3 vd = vec3( -1.0, -1.0 + yOffset, -0.57735 );\n    \n    vec3 p = z;\n	float a = 0.0;\n    float s = 1.0;\n    float r = 1.0;\n    float dm;\n    for( int i=0; i<9; i++ )\n	{\n        vec3 v;\n	    float d, t;\n		d = dot(p-va,p-va);            { v=va; dm=d; t=0.0; }\n        d = dot(p-vb,p-vb); if( d<dm ) { v=vb; dm=d; t=1.0; }\n        d = dot(p-vc,p-vc); if( d<dm ) { v=vc; dm=d; t=2.0; }\n        d = dot(p-vd,p-vd); if( d<dm ) { v=vd; dm=d; t=3.0; }\n		p = v + 2.0*(p - v); r*= 2.0;\n		a = t + 4.0*a; s*= 4.0;\n	}\n\n    float distance  = (sqrt(dm)-1.0)/r;\n    float address   = a/s;\n\n	return distance;\n}\n\n/** https://www.shadertoy.com/view/llGXDR */\nfloat rayMarch(vec3 rayOrigin, vec3 rayDir, float initialDepth) {\n    float currentDepth = initialDepth;\n    float newDistance = initialDepth;\n    float stepSizeFactor = 1.3;\n    float oldDistance = 0.0;\n    float stepSize = 0.0;\n    float cerr = 10000.0;\n    float ct = 0.0;\n    float pixradius = 1.0 / averageScreenSize;\n    int inter = 0;\n    for (int i = 0; i < 64; i++) {\n        oldDistance = newDistance;\n        newDistance = distanceEstimator(rayOrigin + rayDir * currentDepth);\n        \n        //Detect intersections missed by over-relaxation\n        if(stepSizeFactor > 1.0 && abs(oldDistance) + abs(newDistance) < stepSize){\n            stepSize -= stepSizeFactor * stepSize;\n            stepSizeFactor = 1.0;\n            currentDepth += stepSize;\n            continue;\n        }\n        stepSize = stepSizeFactor * newDistance;\n        \n        float err = newDistance / currentDepth;\n        \n        if(abs(err) < abs(cerr)){\n            ct = currentDepth;\n            cerr = err;\n        }\n        \n        //Intersect when d / t < one pixel\n        if(abs(err) < pixradius) {\n            inter = 1;\n            break;\n        }\n        \n        currentDepth += stepSize;\n        /*if(currentDepth > 30.0){\n            break;\n        }*/\n    }\n    if(inter == 0){\n        ct = -1.0;\n    }\n    return ct;\n}\n\nfloat map(vec3 p){\n    return distanceEstimator(p);\n}\n\n//Approximate normal\nvec3 getNormal(vec3 p){\n    return normalize(vec3(map(vec3(p.x + 0.0001, p.yz)) - map(vec3(p.x - 0.0001, p.yz)),\n                          map(vec3(p.x, p.y + 0.0001, p.z)) - map(vec3(p.x, p.y - 0.0001, p.z)),\n                	      map(vec3(p.xy, p.z + 0.0001)) - map(vec3(p.xy, p.z - 0.0001))));\n}\n\n//Determine if a point is in shadow - 1.0 = not in shadow\nfloat getShadow(vec3 rayOrigin, vec3 rayDir, vec3 starPosition) {\n    float t = 0.01;\n    float d = 0.0;\n    float shadow = 1.0;\n    for(int iter = 0; iter < 64; iter++){\n        d = map(rayOrigin + rayDir * t);\n        if(d < 0.0001){\n            return 0.5;\n        }\n        if(t > length(rayOrigin - starPosition) - 0.5){\n            break;\n        }\n        shadow = min(shadow, 32.0 * d / t);\n        t += d;\n    }\n    return 0.5 + 0.5 * shadow;\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n    // actual depth of the scene\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    float impactPoint, escapePoint;\n    if (!(rayIntersectSphere(camera_position, rayDir, object_position, object_radius * object_scaling_determinant, impactPoint, escapePoint))) {\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    // scale down so that everything happens in a sphere of radius 2\n    float inverseScaling = 2.0 / (1.0 * object_radius * object_scaling_determinant);\n\n    vec3 origin = camera_position - object_position; // the ray origin in world space\n    origin *= inverseScaling;\n\n    float rayDepth = rayMarch(origin, rayDir, max(impactPoint, 0.0) * inverseScaling);\n    if(rayDepth == -1.0){\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec3 intersectionPoint = origin + rayDepth * rayDir;\n\n    vec3 intersectionPointW = object_position + intersectionPoint / inverseScaling;\n\n    if(length(intersectionPointW - camera_position) > maximumDistance) {\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec3 normal = getNormal(intersectionPoint);\n\n    vec3 albedo = accentColor;\n    float roughness = 0.4;\n    float metallic = 0.2;\n    vec3 viewDir = normalize(camera_position - intersectionPointW);\n\n    vec3 color = vec3(0.0);\n    for (int i = 0; i < nbStars; i++) {\n        vec3 starDir = normalize(star_positions[i] - object_position);\n        float shadow = getShadow(intersectionPoint, starDir, star_positions[i]);\n        color += calculateLight(albedo, normal, roughness, metallic, starDir, viewDir, star_colors[i]) * shadow;\n    }\n\n    if(nbStars == 0) {\n        vec3 lightDir = normalize(vec3(1.0, 1.0, 1.0));\n        vec3 lightColor = vec3(1.0);\n        float shadow = getShadow(intersectionPoint, lightDir, intersectionPoint + lightDir * 100.0);\n        color += calculateLight(albedo, normal, roughness, metallic, lightDir, viewDir, lightColor) * shadow;\n    }\n\n    color = smoothstep(0.0, 0.8, color * 2.0) * 2.0;\n\n    gl_FragColor = vec4(color, 1.0);\n}\n");var w={ACCENT_COLOR:"accentColor",ELAPSED_SECONDS:"elapsedSeconds",AVERAGE_SCREEN_SIZE:"averageScreenSize"},T=m(Object.values(l.A)).concat(m(Object.values(s.o)),m(Object.values(u.T)),m(Object.values(w))),A=Object.values(c.R);return y=n,g=[e.name,S,T,A,1,null,i.g.BILINEAR_SAMPLINGMODE,h.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],y=f(y),d(b=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,v()?Reflect.construct(y,g||[],f(this).constructor):y.apply(this,g)),"elapsedSeconds",0),d(b,"activeCamera",null),b.onActivateObservable.add(function(e){b.activeCamera=e}),b.onApplyObservable.add(function(n){if(null===b.activeCamera)throw Error("Camera is null");(0,s.b)(n,b.activeCamera),(0,u.G)(n,p),(0,l.$)(n,e,t),n.setColor3(w.ACCENT_COLOR,a.accentColor),n.setFloat(w.ELAPSED_SECONDS,b.elapsedSeconds),n.setFloat(w.AVERAGE_SCREEN_SIZE,(h.getEngine().getRenderWidth()+h.getEngine().getRenderHeight())/2),(0,c.C)(n,b.activeCamera,h)}),b}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&p(n,e),t=[{key:"update",value:function(e){this.elapsedSeconds+=e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(a.w)},59241:function(e,t,n){"use strict";n.d(t,{Q:()=>s});var r=n(36801),o=n(13679);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a={ATMOSPHERE_RADIUS:"atmosphere_radius",ATMOSPHERE_RAYLEIGH_HEIGHT:"atmosphere_rayleighHeight",ATMOSPHERE_RAYLEIGH_COEFFS:"atmosphere_rayleighCoeffs",ATMOSPHERE_MIE_HEIGHT:"atmosphere_mieHeight",ATMOSPHERE_MIE_COEFFS:"atmosphere_mieCoeffs",ATMOSPHERE_MIE_ASYMMETRY:"atmosphere_mieAsymmetry",ATMOSPHERE_OZONE_HEIGHT:"atmosphere_ozoneHeight",ATMOSPHERE_OZONE_COEFFS:"atmosphere_ozoneCoeffs",ATMOSPHERE_OZONE_FALLOFF:"atmosphere_ozoneFalloff",ATMOSPHERE_SUN_INTENSITY:"atmosphere_sunIntensity"},s=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");i(this,"atmosphereRadius",void 0),i(this,"rayleighHeight",void 0),i(this,"rayleighScatteringCoefficients",void 0),i(this,"mieHeight",void 0),i(this,"mieScatteringCoefficients",void 0),i(this,"mieAsymmetry",void 0),i(this,"ozoneHeight",void 0),i(this,"ozoneAbsorptionCoefficients",void 0),i(this,"ozoneFalloff",void 0),i(this,"lightIntensity",void 0),this.atmosphereRadius=e+n,this.rayleighHeight=8e3*n/o.w.EARTH_ATMOSPHERE_THICKNESS,this.rayleighScatteringCoefficients=new r.Pq(58e-7,135e-7,331e-7).scaleInPlace(o.w.EARTH_ATMOSPHERE_THICKNESS/n),this.mieHeight=1200*n/o.w.EARTH_ATMOSPHERE_THICKNESS,this.mieScatteringCoefficients=new r.Pq(2e-5,2e-5,2e-5).scaleInPlace(o.w.EARTH_ATMOSPHERE_THICKNESS/n),this.mieAsymmetry=.76,this.ozoneHeight=25e3*n/o.w.EARTH_ATMOSPHERE_THICKNESS,this.ozoneAbsorptionCoefficients=new r.Pq(6e-7,18e-7,85e-9).scaleInPlace(o.w.EARTH_ATMOSPHERE_THICKNESS/n),this.ozoneFalloff=5e3*n/o.w.EARTH_ATMOSPHERE_THICKNESS,this.lightIntensity=15}return e=[{key:"setUniforms",value:function(e){e.setFloat(a.ATMOSPHERE_RADIUS,this.atmosphereRadius),e.setFloat(a.ATMOSPHERE_RAYLEIGH_HEIGHT,this.rayleighHeight),e.setVector3(a.ATMOSPHERE_RAYLEIGH_COEFFS,this.rayleighScatteringCoefficients),e.setFloat(a.ATMOSPHERE_MIE_HEIGHT,this.mieHeight),e.setVector3(a.ATMOSPHERE_MIE_COEFFS,this.mieScatteringCoefficients),e.setFloat(a.ATMOSPHERE_MIE_ASYMMETRY,this.mieAsymmetry),e.setFloat(a.ATMOSPHERE_OZONE_HEIGHT,this.ozoneHeight),e.setVector3(a.ATMOSPHERE_OZONE_COEFFS,this.ozoneAbsorptionCoefficients),e.setFloat(a.ATMOSPHERE_OZONE_FALLOFF,this.ozoneFalloff),e.setFloat(a.ATMOSPHERE_SUN_INTENSITY,this.lightIntensity)}},{key:"getUniformNames",value:function(){return Object.values(a)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},52030:function(e,t,n){"use strict";n.d(t,{D:()=>v});var r=n(47347),o=n(78930),i=n(92771),a=n(62325),s=n(77621),l=n(54205),c=n(56754),u=n(56072);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(m=function(){return!!e})()}var v=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,a,h,f){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");var v,y,g,b,S="atmosphericScattering";void 0===o.M.ShadersStore["".concat(S,"FragmentShader")]&&(o.M.ShadersStore["".concat(S,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision lowp float;\n\n#define DISABLE_UNIFORMITY_ANALYSIS\n\n#define PI 3.1415926535897932\n#define POINTS_FROM_CAMERA 12// number sample points along camera ray\n#define OPTICAL_DEPTH_POINTS 12// number sample points along light ray\n\nvarying vec2 vUV;// screen coordinates\n\n// uniforms\nuniform sampler2D textureSampler;// the original screen texture\nuniform sampler2D depthSampler;// the depth map of the camera\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform float atmosphere_radius;\n\nuniform float atmosphere_rayleighHeight; // height falloff of rayleigh scattering (in meters)\nuniform vec3 atmosphere_rayleighCoeffs; // rayleigh scattering coefficients\n\nuniform float atmosphere_mieHeight; // height falloff of mie scattering (in meters)\nuniform vec3 atmosphere_mieCoeffs; // mie scattering coefficients\nuniform float atmosphere_mieAsymmetry; // mie scattering asymmetry (between -1 and 1)\n\nuniform float atmosphere_ozoneHeight; // height of ozone layer in meters above the surface\nuniform vec3 atmosphere_ozoneCoeffs; // ozone absorption coefficients\nuniform float atmosphere_ozoneFalloff; // ozone falloff around the ozone layer in meters\n\nuniform float atmosphere_sunIntensity; // controls atmosphere overall brightness\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\n// based on https://www.youtube.com/watch?v=DxfEbulyFcY by Sebastian Lague\nvec3 densityAtPoint(vec3 densitySamplePoint) {\n    float heightAboveSurface = length(densitySamplePoint - object_position) - object_radius;// actual height above surface\n\n    // rayleigh and mie\n    vec3 density = vec3(exp(-heightAboveSurface / vec2(atmosphere_rayleighHeight, atmosphere_mieHeight)), 0.0);\n\n    // then, the ozone absorption\n    float denom = (atmosphere_ozoneHeight - heightAboveSurface) / atmosphere_ozoneFalloff;\n    density.z = (1.0 / (denom * denom + 1.0)) * density.x;\n\n    return density;\n}\n\nvec3 opticalDepth(vec3 rayOrigin, vec3 rayDir, float rayLength) {\n\n    float stepSize = rayLength / (float(OPTICAL_DEPTH_POINTS) - 1.0);// ray length between sample points\n\n    vec3 densitySamplePoint = rayOrigin;// that's where we start\n    vec3 accumulatedOpticalDepth = vec3(0.0);\n\n    for (int i = 0; i < OPTICAL_DEPTH_POINTS; i++) {\n        vec3 localDensity = densityAtPoint(densitySamplePoint);// we get the density at the sample point\n\n        accumulatedOpticalDepth += localDensity * stepSize;// linear approximation : density is constant between sample points\n\n        densitySamplePoint += rayDir * stepSize;// we move the sample point\n    }\n\n    return accumulatedOpticalDepth;\n}\n\nvec3 calculateLight(vec3 rayOrigin, vec3 starPosition, vec3 rayDir, float rayLength, vec3 originalColor) {\n\n    vec3 samplePoint = rayOrigin;// first sampling point coming from camera ray\n\n    vec3 starDir = normalize(starPosition - object_position);// direction to the light source\n\n    float stepSize = rayLength / (float(POINTS_FROM_CAMERA) - 1.0);// the ray length between sample points\n\n    vec3 inScatteredRayleigh = vec3(0.0);\n    vec3 inScatteredMie = vec3(0.0);\n\n    vec3 totalOpticalDepth = vec3(0.0);\n\n    for (int i = 0; i < POINTS_FROM_CAMERA; i++) {\n        float sunRayLengthInAtm = atmosphere_radius - length(samplePoint - object_position); // distance traveled by light through atmosphere from light source\n        float t0, t1;\n        if (rayIntersectSphere(samplePoint, starDir, object_position, atmosphere_radius, t0, t1)) {\n            sunRayLengthInAtm = t1;\n        }\n\n        vec3 sunRayOpticalDepth = opticalDepth(samplePoint, starDir, sunRayLengthInAtm);// scattered from the sun to the point\n\n        float viewRayLengthInAtm = stepSize * float(i);// distance traveled by light through atmosphere from sample point to cameraPosition\n        vec3 viewRayOpticalDepth = opticalDepth(samplePoint, -rayDir, viewRayLengthInAtm);// scattered from the point to the camera\n\n        // Now we need to calculate the transmittance\n        // this is essentially how much light reaches the current sample point due to scattering\n        vec3 transmittance = exp(-atmosphere_rayleighCoeffs * (sunRayOpticalDepth.x + viewRayOpticalDepth.x) - atmosphere_mieCoeffs * (sunRayOpticalDepth.y + viewRayOpticalDepth.y) - atmosphere_ozoneCoeffs * (sunRayOpticalDepth.z + viewRayOpticalDepth.z));\n\n        vec3 localDensity = densityAtPoint(samplePoint);// density at sample point\n        totalOpticalDepth += localDensity * stepSize;\n\n        inScatteredRayleigh += localDensity.x * transmittance * stepSize;// add the resulting amount of light scattered toward the camera\n        inScatteredMie += localDensity.y * transmittance * stepSize;\n\n        samplePoint += rayDir * stepSize;// move sample point along view ray\n    }\n\n    float costheta = dot(rayDir, starDir);\n    float costheta2 = costheta * costheta;\n\n    // scattering depends on the direction of the light ray and the view ray : it's the rayleigh phase function\n    // https://glossary.ametsoc.org/wiki/Rayleigh_phase_function\n    float phaseRayleigh = 3.0 / (16.0 * PI) * (1.0 + costheta2);\n\n    float g = atmosphere_mieAsymmetry;\n    float g2 = g * g;\n\n    // Cornette-Shanks phase function for Mie scattering\n    float phaseMie = (3.0 * (1.0 - g2) / (8.0 * PI * (2.0 + g2))) * (1.0 + costheta2) / pow(1.0 + g2 - 2.0 * g * costheta, 1.5);\n\n    inScatteredRayleigh *= phaseRayleigh * atmosphere_rayleighCoeffs;\n    inScatteredMie *= phaseMie * atmosphere_mieCoeffs;\n\n    // calculate how much light can pass through the atmosphere\n    vec3 opacity = exp(-(atmosphere_mieCoeffs * totalOpticalDepth.y + atmosphere_rayleighCoeffs * totalOpticalDepth.x + atmosphere_ozoneCoeffs * totalOpticalDepth.z));\n\n    return (inScatteredRayleigh + inScatteredMie) * atmosphere_sunIntensity + originalColor * opacity;\n}\n\nvec3 scatter(vec3 originalColor, vec3 rayOrigin, vec3 rayDir, float maximumDistance) {\n    float impactPoint, escapePoint;\n    if (!(rayIntersectSphere(rayOrigin, rayDir, object_position, atmosphere_radius, impactPoint, escapePoint))) {\n        return originalColor;// if not intersecting with atmosphere, return original color\n    }\n\n    impactPoint = max(0.0, impactPoint);// cannot be negative (the ray starts where the camera is in such a case)\n    escapePoint = min(maximumDistance, escapePoint);// occlusion with other scene objects\n\n    float distanceThroughAtmosphere = max(0.0, escapePoint - impactPoint);// probably doesn't need the max but for the sake of coherence the distance cannot be negative\n\n    vec3 firstPointInAtmosphere = rayOrigin + rayDir * impactPoint;// the first atmosphere point to be hit by the ray\n\n    vec3 light = vec3(0.0);\n    for (int i = 0; i < nbStars; i++) {\n        light = max(light, calculateLight(firstPointInAtmosphere, star_positions[i], rayDir, distanceThroughAtmosphere, originalColor.rgb));// calculate scattering\n    }\n\n    return light;\n}\n\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    // actual depth of the scene\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    // Cohabitation avec le shader d'oc\xe9an (un jour je merge)\n    float waterImpact, waterEscape;\n    if (rayIntersectSphere(camera_position, rayDir, object_position, object_radius, waterImpact, waterEscape)) {\n        maximumDistance = min(maximumDistance, waterImpact);\n    }\n\n    vec3 finalColor = scatter(screenColor.rgb, camera_position, rayDir, maximumDistance);// the color to be displayed on the screen\n\n    gl_FragColor = vec4(finalColor, 1.0);// displaying the final color\n}\n");var w=p(Object.values(l.A)).concat(p(Object.values(u.T)),p(Object.values(s.o)),p(a.getUniformNames())),T=p(Object.values(c.R));return v=t,y=["".concat(e.name,"AtmospherePostProcess"),S,w,T,1,null,i.g.BILINEAR_SAMPLINGMODE,f.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],v=d(v),b=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,m()?Reflect.construct(v,y||[],d(this).constructor):v.apply(this,y)),(g="activeCamera")in b?Object.defineProperty(b,g,{value:null,enumerable:!0,configurable:!0,writable:!0}):b[g]=null,b.onActivateObservable.add(function(e){b.activeCamera=e}),b.onApplyObservable.add(function(t){if(null===b.activeCamera)throw Error("Camera is null");(0,s.b)(t,b.activeCamera),(0,u.G)(t,h),(0,l.$)(t,e,n),a.setUniforms(t),(0,c.C)(t,b.activeCamera,f)}),b}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e),t}(a.w)},38645:function(e,t,n){"use strict";n.d(t,{$k:()=>a,Kn:()=>l,xP:()=>s});var r=n(70673),o=n(13298);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a={LAYER_RADIUS:"clouds_layerRadius",SMOOTHNESS:"clouds_smoothness",SPECULAR_POWER:"clouds_specularPower",FREQUENCY:"clouds_frequency",DETAIL_FREQUENCY:"clouds_detailFrequency",COVERAGE:"clouds_coverage",SHARPNESS:"clouds_sharpness",COLOR:"clouds_color",WORLEY_SPEED:"clouds_worleySpeed",DETAIL_SPEED:"clouds_detailSpeed",TIME:"time"},s={LUT:"clouds_lut"},l=function(){var e;function t(e,n,o){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");i(this,"model",void 0),i(this,"lut",void 0),i(this,"elapsedSeconds",0),i(this,"fallbackTexture",void 0),this.model=e,this.lut=n.get(),this.lut.setModel(e),this.fallbackTexture=(0,r.T)(o)}return e=[{key:"update",value:function(e){this.elapsedSeconds+=e}},{key:"setUniforms",value:function(e){e.setFloat(a.LAYER_RADIUS,this.model.layerRadius),e.setFloat(a.FREQUENCY,this.model.frequency),e.setFloat(a.DETAIL_FREQUENCY,this.model.detailFrequency),e.setFloat(a.COVERAGE,this.model.coverage),e.setFloat(a.SHARPNESS,this.model.sharpness),e.setColor3(a.COLOR,this.model.color),e.setFloat(a.WORLEY_SPEED,this.model.worleySpeed),e.setFloat(a.DETAIL_SPEED,this.model.detailSpeed),e.setFloat(a.SMOOTHNESS,this.model.smoothness),e.setFloat(a.SPECULAR_POWER,this.model.specularPower),e.setFloat(a.TIME,-this.elapsedSeconds%(2*Math.PI*(0,o.p_)(1e4*this.model.worleySpeed,1e4*this.model.detailSpeed)/this.model.worleySpeed))}},{key:"setSamplers",value:function(e){this.lut.isReady()?e.setTexture(s.LUT,this.lut.getTexture()):e.setTexture(s.LUT,this.fallbackTexture)}},{key:"dispose",value:function(e){e.release(this.lut)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},49351:function(e,t,n){"use strict";n.d(t,{O:()=>S});var r=n(47347),o=n(78930),i=n(92771),a=n(74334),s=n(36801),l=n(1831),c=n(62325),u=n(13298),h=n(77621),d=n(54205),f=n(56754);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return p(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(b=function(){return!!e})()}var S=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,c,p){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");var y,S,w,T="lensflare";void 0===o.M.ShadersStore["".concat(T,"FragmentShader")]&&(o.M.ShadersStore["".concat(T,"FragmentShader")]="precision lowp float;\n\n// based on https://www.shadertoy.com/view/wlcyzj\n\nvarying vec2 vUV;\n\nuniform sampler2D textureSampler;// the original screen texture\nuniform sampler2D depthSampler;// the depth map of the camera\n\nuniform float visibility;\nuniform vec3 clipPosition;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\nuniform vec3 flareColor;\nuniform float aspectRatio;\n\nfloat getSun(vec2 uv){\n    return length(uv) < 0.009 ? 1.0 : 0.0;\n}\n\n//from: https://www.shadertoy.com/view/XdfXRX\nvec3 lensflares(vec2 uv, vec2 pos, float fadeOut)\n{\n    vec2 main = uv-pos;\n    vec2 uvd = uv*(length(uv));\n\n    float ang = atan(main.y, main.x);\n    float dist = length(main);\n    dist = pow(dist, 0.1);\n\n    float f0 = 1.0/(length(uv-pos)*25.0+1.0);\n    f0 = pow(f0, 2.0);\n\n    f0 = f0+f0*(sin((ang+1.0/18.0)*12.0)*.1+dist*.1+.8);\n\n    f0 *= fadeOut;\n\n    float f2 = max(1.0/(1.0+32.0*pow(length(uvd+0.8*pos), 2.0)), .0)*00.25;\n    float f22 = max(1.0/(1.0+32.0*pow(length(uvd+0.85*pos), 2.0)), .0)*00.23;\n    float f23 = max(1.0/(1.0+32.0*pow(length(uvd+0.9*pos), 2.0)), .0)*00.21;\n\n    vec2 uvx = mix(uv, uvd, -0.5);\n\n    float f4 = max(0.01-pow(length(uvx+0.4*pos), 2.4), .0)*6.0;\n    float f42 = max(0.01-pow(length(uvx+0.45*pos), 2.4), .0)*5.0;\n    float f43 = max(0.01-pow(length(uvx+0.5*pos), 2.4), .0)*3.0;\n\n    uvx = mix(uv, uvd, -.4);\n\n    float f5 = max(0.01-pow(length(uvx+0.2*pos), 5.5), .0)*2.0;\n    float f52 = max(0.01-pow(length(uvx+0.4*pos), 5.5), .0)*2.0;\n    float f53 = max(0.01-pow(length(uvx+0.6*pos), 5.5), .0)*2.0;\n\n    uvx = mix(uv, uvd, -0.5);\n\n    float f6 = max(0.01-pow(length(uvx-0.3*pos), 1.6), .0)*6.0;\n    float f62 = max(0.01-pow(length(uvx-0.325*pos), 1.6), .0)*3.0;\n    float f63 = max(0.01-pow(length(uvx-0.35*pos), 1.6), .0)*5.0;\n\n    vec3 sunflare = vec3(f0);\n    vec3 lensflare = vec3(f2+f4+f5+f6, f22+f42+f52+f62, f23+f43+f53+f63);\n\n    return sunflare+lensflare;\n}\n\n\n// based on https://www.shadertoy.com/view/XsGfWV\n/*vec3 anflares(vec2 uv, float threshold, float intensity, float stretch, float brightness, float fadeOut)\n{\n    threshold = 1.0 - threshold;\n\n    vec3 hdr = vec3(getSun(uv));\n    hdr = vec3(floor(threshold+pow(hdr.r, 1.0)));\n\n    float d = intensity * fadeOut;\n    float c = intensity * stretch;\n\n    for (float i=c; i>-1.0; i--){\n        float texL = getSun(uv+vec2(i/d, 0.0));\n        float texR = getSun(uv-vec2(i/d, 0.0));\n\n        hdr += floor(threshold+pow(max(texL, texR), 4.0))*(1.0-i/c);\n    }\n\n    return hdr*brightness;\n}*/\n\n\nvec3 anflares(vec2 uv, float intensity, float stretch, float brightness)\n{\n    uv.x *= 1.0/(intensity*stretch);\n    uv.y *= 0.5;\n    return vec3(1.0 - smoothstep(0.0, 0.009, length(uv)))*brightness;\n}\n\nvoid main() {\n    vec4 screenColor = texture(textureSampler, vUV);\n\n    if (visibility == 0.0) {\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);\n\n    vec3 objectDirection = normalize(object_position - camera_position);\n\n    vec2 objectScreenPos = clipPosition.xy;\n    objectScreenPos.y = 1.0 - objectScreenPos.y;\n\n    // Normalized pixel coordinates (from 0 to 1)\n    vec2 uv = vUV - 0.5;\n    vec2 mouse = objectScreenPos - 0.5;\n\n    uv.x *= aspectRatio;\n    mouse.x *= aspectRatio;\n\n    vec3 col = screenColor.rgb;\n\n    // if angular radius is to great, fade the anflare out\n    float angularRadius = object_radius / length(object_position - camera_position);\n    float fadeOut = 1.0 - smoothstep(0.0, 0.1, angularRadius);\n\n    vec3 flare = lensflares(uv*1.5, mouse*1.5, fadeOut);\n\n    vec3 anflare = pow(anflares(uv-mouse, 400.0, 0.5, 0.6) * fadeOut, vec3(4.0));\n    anflare += smoothstep(0.0025, 1.0, anflare)*10.0;\n    anflare *= smoothstep(0.0, 1.0, anflare);\n\n    //vec3 anflare = pow(anflares(uv-mouse, 0.5, 400.0, 0.9, 0.1), vec3(4.0));\n\n    vec3 sun = getSun(uv-mouse) * fadeOut + (flare + anflare)*flareColor*2.0;\n\n    // no lensflare when looking away from the sun\n    sun *= smoothstep(0.0, 0.1, dot(objectDirection, rayDir));\n\n    col += sun * visibility;\n\n    // Output to screen\n    gl_FragColor = vec4(col, screenColor.a);\n}");var A={visibility:1,behindCamera:!1,clipPosition:new s.Pq},P={FLARE_COLOR:"flareColor",CLIP_POSITION:"clipPosition",VISIBILITY:"visibility",ASPECT_RATIO:"aspectRatio"},C=g(Object.values(d.A)).concat(g(Object.values(h.o)),g(Object.values(P))),I=Object.values(f.R);return y=t,S=[e.name+"LensFlare",T,C,I,1,null,i.g.BILINEAR_SAMPLINGMODE,p.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],y=v(y),m(w=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,b()?Reflect.construct(y,S||[],v(this).constructor):y.apply(this,S)),"settings",void 0),m(w,"activeCamera",null),w.settings=A,w.onActivateObservable.add(function(e){w.activeCamera=e}),w.onApplyObservable.add(function(t){if(null===w.activeCamera)throw Error("Camera is null");(0,h.b)(t,w.activeCamera),(0,d.$)(t,e,n),t.setColor3(P.FLARE_COLOR,c);var r,o=s.Pq.Project(e.getAbsolutePosition(),a.uq.IdentityReadOnly,p.getTransformMatrix(),w.activeCamera.viewport);A.behindCamera=o.z<0,t.setVector3(P.CLIP_POSITION,o);var i=new l.G,m=w.activeCamera.globalPosition,v=e.getAbsolutePosition();p.getPhysicsEngine().raycastToRef(m,v,i);var y=i.hasHit&&(null==(r=i.body)?void 0:r.transformNode)!==e||A.behindCamera;y&&A.visibility>0?A.visibility=(0,u.cP)(A.visibility,0,.5):!y&&A.visibility<1&&(A.visibility=(0,u.cP)(A.visibility,1,.5)),t.setFloat(P.VISIBILITY,A.visibility),t.setFloat(P.ASPECT_RATIO,p.getEngine().getScreenAspectRatio()),(0,f.C)(t,w.activeCamera,p)}),w}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e),t}(c.w)},11402:function(e,t,n){"use strict";n.d(t,{A:()=>y});var r=n(47347),o=n(78930),i=n(92771),a=n(36801),s=n(62325),l=n(77621),c=n(54205),u=n(56754);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}var y=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,s,h){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var p,y,g,b="matterjet";void 0===o.M.ShadersStore["".concat(b,"FragmentShader")]&&(o.M.ShadersStore["".concat(b,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision lowp float;\n\nvarying vec2 vUV;// screen coordinates\n\nuniform sampler2D textureSampler;// the original screen texture\nuniform sampler2D depthSampler;// the depth map of the camera\n\nuniform float time;\n\nuniform mat4 inverseRotation;\n\nuniform float dipoleTilt;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// rotation using https://www.wikiwand.com/en/Rodrigues%27_rotation_formula\nvec3 rotateAround(vec3 vector, vec3 axis, float theta) {\n    // Please note that unit vector are required, i did not divided by the norms\n    return cos(theta) * vector + cross(axis, vector) * sin(theta) + axis * dot(axis, vector) * (1.0 - cos(theta));\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nvec3 removeAxialTilt(vec3 tiltedVector, vec3 tiltedAxis) {\n    vec3 targetAxis = vec3(0.0, 1.0, 0.0);\n    vec3 rotationRemovalAxis = cross(tiltedAxis, targetAxis);\n    return rotateAround(tiltedVector, rotationRemovalAxis, acos(dot(tiltedAxis, targetAxis)));\n}\n\nfloat sdSpiral(vec3 p, float coneTheta, float frequency) {    \n    // Y-axis is now the spiral direction\n    float spiralPos = p.y; // Using Y instead of Z\n    float radius = spiralPos * tan(coneTheta);\n    float theta = frequency * spiralPos;\n    \n    // Spiral now wraps around Y-axis\n    vec3 spiralPoint = vec3(\n        radius * cos(theta),\n        spiralPos,          // Y position is our spiral progress\n        radius * sin(theta) // Z component completes the circular motion\n    );\n    \n    return length(p - spiralPoint);\n}\n\nfloat spiralDensity(vec3 p, float coneTheta, float coneHeight) {    \n    float frequency = 0.1;\n    float dist = sdSpiral(p, coneTheta, frequency);\n    \n    float heightFraction = abs(p.y) / coneHeight;\n\n    dist /= heightFraction;\n\n    float density = 1.0;\n\n    density *= exp(-0.02 * dist * dist);\n    \n    density *= 1.0 - smoothstep(0.0, 1.0, heightFraction);\n\n    density /= heightFraction;\n    \n    return density;\n}\n\n// from https://www.shadertoy.com/view/MtcXWr\n// Returns true if the ray intersects the closed cone.\n// If so, 't' is set to the first hit along the ray (entry if outside, exit if inside)\n// and 'distTrough' is set to the chord length of the ray inside the cone.\nbool rayIntersectCone(vec3 rayOrigin, vec3 rayDir,\n                      float coneHeight, float cosTheta,\n                      out float t, out float distTrough)\n{\n    vec3 coneUp = vec3(0.0, 1.0, 0.0);\n\n    float cosTheta2 = cosTheta * cosTheta;\n\n    // Compute tangent once.\n    float sinTheta = sqrt(max(0.0, 1.0 - cosTheta2));\n    float tanTheta = sinTheta / cosTheta;\n\n    // --- Determine if ray origin is inside the cone volume ---\n    bool inside = false;\n    {\n        vec3 v = rayOrigin;\n        float h = v.y;\n        if (h >= 0.0 && h <= coneHeight) {\n            float rAtH = h * tanTheta;\n            float d = length(v - coneUp * h);\n            if (d <= rAtH)\n                inside = true;\n        }\n    }\n    \n    // --- Collect candidate intersection t's ---\n    // We will add valid intersections from the lateral surface and the base.\n    float tCandidates[3];\n    int count = 0;\n    \n    // Intersection with the infinite cone's lateral surface.\n    vec3 co = rayOrigin;\n    float A = rayDir.y * rayDir.y - cosTheta2;\n    float B = 2.0 * (rayDir.y * co.y - dot(rayDir, co) * cosTheta2);\n    float C = co.y * co.y - dot(co, co) * cosTheta2;\n    \n    float det = B * B - 4.0 * A * C;\n    if (det >= 0.0)\n    {\n        float sqrtDet = sqrt(det);\n        float t1 = (-B - sqrtDet) / (2.0 * A);\n        float t2 = (-B + sqrtDet) / (2.0 * A);\n        \n        // Check t1 for validity (only consider if t>=0)\n        if (t1 >= 0.0)\n        {\n            vec3 cp1 = rayOrigin + t1 * rayDir;\n            float h1 = cp1.y;\n            if (h1 >= 0.0 && h1 <= coneHeight)\n                tCandidates[count++] = t1;\n        }\n        // Check t2\n        if (t2 >= 0.0)\n        {\n            vec3 cp2 = rayOrigin + t2 * rayDir;\n            float h2 = cp2.y;\n            if (h2 >= 0.0 && h2 <= coneHeight)\n                tCandidates[count++] = t2;\n        }\n    }\n    \n    // Intersection with the base plane.\n    vec3 baseCenter = coneUp * coneHeight;\n    float denom = rayDir.y;\n    if (abs(denom) > 1e-6)\n    {\n        float tBase = (baseCenter - rayOrigin).y / denom;\n        if (tBase >= 0.0)\n        {\n            vec3 hitPoint = rayOrigin + tBase * rayDir;\n            // Check if hitPoint is within the circular base.\n            float baseRadius = coneHeight * tanTheta;\n            if (length(hitPoint - baseCenter) <= baseRadius)\n                tCandidates[count++] = tBase;\n        }\n    }\n    \n    // If no valid intersections were found, return false.\n    if (count == 0)\n        return false;\n    \n    // --- Sort the candidate intersections in increasing order ---\n    for (int i = 0; i < count - 1; i++)\n    {\n        for (int j = i + 1; j < count; j++)\n        {\n            if (tCandidates[j] < tCandidates[i])\n            {\n                float tmp = tCandidates[i];\n                tCandidates[i] = tCandidates[j];\n                tCandidates[j] = tmp;\n            }\n        }\n    }\n    \n    // --- Determine entry and exit t values ---\n    float tEntry, tExit;\n    if (inside)\n    {\n        // If the ray origin is inside, entry is at t = 0 and the exit is the first candidate.\n        tEntry = 0.0;\n        tExit  = tCandidates[0];\n    }\n    else\n    {\n        // Outside: entry is the first hit, exit is the second (if present).\n        tEntry = tCandidates[0];\n        if (count > 1)\n            tExit = tCandidates[1];\n        else\n            tExit = tEntry; // Tangential hit: chord length is zero.\n    }\n    \n    // Set the outputs.\n    // We return tEntry as the “hit” point (for an outside ray, where the ray first enters the cone;\n    // for an inside ray, tEntry=0 is the starting point so we return the exit instead).\n    if (inside)\n        t = 0.0;\n    else\n        t = tEntry;\n    \n    distTrough = tExit - tEntry;\n    \n    return true;\n}\n\nvec3 rayMarchSpiral(vec3 rayOrigin, vec3 rayDir, float distThrough, int nbSteps, float coneTheta, float coneHeight, out float transmittance) {\n    vec3 col = vec3(0.0);\n    \n    transmittance = 1.0;\n    \n    float stepSize = distThrough / float(nbSteps);\n\n    for(int i = 0; i < nbSteps; i++) {\n        vec3 p = rayOrigin + float(i) * stepSize * rayDir;\n\n        float density = spiralDensity(p, coneTheta * 0.7, coneHeight);\n    \n        vec3 emission = 3.0 * vec3(0.3, 0.6, 1.0) * density;\n        float absorption = 0.2 * density;\n    \n        transmittance *= exp(-absorption * stepSize);\n        col += emission * transmittance * stepSize;\n    }\n\n    return col;\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n\n    // actual depth of the scene\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    float scaling_factor = object_radius * 10000.0;\n\n    // move in object's local space to simplify the calculations\n    vec3 rayOriginLocalSpace = mat3(inverseRotation) * (camera_position - object_position) / scaling_factor;\n    vec3 rayDirLocalSpace = mat3(inverseRotation) * rayDir;\n\n    float coneTheta = dipoleTilt;\n    float coneHeight = 100.0;\n\n    vec3 color = screenColor.rgb;\n    float finalAlpha = screenColor.a;\n\n    float t, distThrough;\n    if(rayIntersectCone(rayOriginLocalSpace, rayDirLocalSpace, coneHeight, cos(coneTheta + sign(coneTheta) * 0.2), t, distThrough) && t * scaling_factor < maximumDistance) {\n        vec3 startPoint = rayOriginLocalSpace + t * rayDirLocalSpace;\n\n        float transmittance;\n        vec3 jetColor = rayMarchSpiral(startPoint, rayDirLocalSpace, distThrough, 100, coneTheta, coneHeight, transmittance);\n\n        color = mix(jetColor, color, transmittance);\n        finalAlpha = max(transmittance, finalAlpha);\n    }\n\n    // flip the coordinates to display the other cone\n    rayOriginLocalSpace *= -1.0;\n    rayDirLocalSpace *= -1.0;\n\n    if(rayIntersectCone(rayOriginLocalSpace, rayDirLocalSpace, coneHeight, cos(coneTheta + sign(coneTheta) * 0.2), t, distThrough) && t * scaling_factor < maximumDistance) {\n        vec3 startPoint = rayOriginLocalSpace + t * rayDirLocalSpace;\n\n        float transmittance;\n        vec3 jetColor = rayMarchSpiral(startPoint, rayDirLocalSpace, distThrough, 100, coneTheta, coneHeight, transmittance);\n\n        color = mix(jetColor, color, transmittance);\n        finalAlpha = max(transmittance, finalAlpha);\n    }\n\n    gl_FragColor = vec4(color, finalAlpha);\n}");var S={elapsedSeconds:0,inverseRotation:a.uq.Identity(),dipoleTilt:s},w={TIME:"time",INVERSE_ROTATION:"inverseRotation",DIPOLE_TILT:"dipoleTilt"},T=m(Object.values(c.A)).concat(m(Object.values(l.o)),m(Object.values(w))),A=Object.values(u.R);return p=n,y=["".concat(e.name,"MatterJetPostProcess"),b,T,A,1,null,i.g.BILINEAR_SAMPLINGMODE,h.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],p=f(p),d(g=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,v()?Reflect.construct(p,y||[],f(this).constructor):p.apply(this,y)),"matterJetUniforms",void 0),d(g,"activeCamera",null),g.matterJetUniforms=S,g.onActivateObservable.add(function(e){g.activeCamera=e}),g.onApplyObservable.add(function(n){if(null===g.activeCamera)throw Error("Camera is null");(0,l.b)(n,g.activeCamera),(0,c.$)(n,e,t),n.setFloat(w.TIME,g.matterJetUniforms.elapsedSeconds%1e4),e.getWorldMatrix().getRotationMatrixToRef(g.matterJetUniforms.inverseRotation),g.matterJetUniforms.inverseRotation.transposeToRef(g.matterJetUniforms.inverseRotation),n.setMatrix(w.INVERSE_ROTATION,g.matterJetUniforms.inverseRotation),n.setFloat(w.DIPOLE_TILT,g.matterJetUniforms.dipoleTilt),(0,u.C)(n,g.activeCamera,h)}),g}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&p(n,e),t=[{key:"update",value:function(e){this.matterJetUniforms.elapsedSeconds+=e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(s.w)},33102:function(e,t,n){"use strict";n.d(t,{X:()=>eo}),n(69742);var r,o=n(47347),i=n(92771),a=n(36801),s=n(5212),l=n(34241),c=n(55679),u=n(92092),h=n(61741),d=n(95574),f=n(57836),p=n(41734),m=n(40089),v=n(14632),y=n(21931),g=n(49466),b=n(52030),S=n(78930),w=n(62325),T=n(77621),A=n(54205),P=n(56754),C=n(56072),I=n(38645);function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return E(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(x=function(){return!!e})()}var M=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,r,a,s){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var l,c,u,h="flatClouds";void 0===S.M.ShadersStore["".concat(h,"FragmentShader")]&&(S.M.ShadersStore["".concat(h,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision lowp float;\n\n#define DISABLE_UNIFORMITY_ANALYSIS\n\nvarying vec2 vUV;// screen coordinates\n\n// uniforms\nuniform sampler2D textureSampler;// the original screen texture\nuniform sampler2D depthSampler;// the depth map of the camera\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\nuniform float clouds_layerRadius;\nuniform float clouds_frequency;\nuniform float clouds_detailFrequency;\nuniform float clouds_coverage;\nuniform float clouds_sharpness;\nuniform vec3 clouds_color;\nuniform float clouds_worleySpeed;\nuniform float clouds_detailSpeed;\nuniform float clouds_specularPower;\nuniform float clouds_smoothness;\nuniform sampler2D clouds_lut;\n\nuniform float time;\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat saturate(float value) {\n    if(value < 0.0) return 0.0;\n    if(value > 1.0) return 1.0;\n    return value;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat smoothSharpener(float x, float s) {\n    float offset = 0.5 - (1.0 / s);\n    return smoothstep(offset, 1.0 - offset, x);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// rotation using https://www.wikiwand.com/en/Rodrigues%27_rotation_formula\nvec3 rotateAround(vec3 vector, vec3 axis, float theta) {\n    // Please note that unit vector are required, i did not divided by the norms\n    return cos(theta) * vector + cross(axis, vector) * sin(theta) + axis * dot(axis, vector) * (1.0 - cos(theta));\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat computeSpecularHighlight(vec3 sunDir, vec3 rayDir, vec3 normal, float smoothness, float specularPower) {\n    float specularAngle = acos(dot(normalize(sunDir - rayDir), normal));\n    float specularExponent = specularAngle / (1.0 - smoothness);\n\n    return exp(-specularExponent * specularExponent) * specularPower;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nvec3 removeAxialTilt(vec3 tiltedVector, vec3 tiltedAxis) {\n    vec3 targetAxis = vec3(0.0, 1.0, 0.0);\n    vec3 rotationRemovalAxis = cross(tiltedAxis, targetAxis);\n    return rotateAround(tiltedVector, rotationRemovalAxis, acos(dot(tiltedAxis, targetAxis)));\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nvec2 toUV(in vec3 n)\n{\n    vec2 uv;\n\n    uv.x = atan(-n.x, n.z);\n    uv.x = (uv.x + PI / 2.0) / (PI * 2.0) + PI * (28.670 / 360.0);\n\n    uv.y = acos(n.y) / PI;\n\n    return uv;\n}\n\nfloat cloudDensityAtPoint(vec3 samplePoint) {\n    vec3 rotationAxisPlanetSpace = vec3(0.0, 1.0, 0.0);\n\n    vec3 samplePointRotatedWorley = rotateAround(samplePoint, rotationAxisPlanetSpace, time * clouds_worleySpeed);\n    vec3 samplePointRotatedDetail = rotateAround(samplePoint, rotationAxisPlanetSpace, time * clouds_detailSpeed);\n\n    vec2 uvWorley = toUV(samplePointRotatedWorley);\n    vec2 uvDetail = toUV(samplePointRotatedDetail);\n\n    // trick from https://www.shadertoy.com/view/3dVSzm to avoid Greenwich artifacts\n    vec2 dfWorley = fwidth(uvWorley);\n    if(dfWorley.x > 0.5) dfWorley.x = 0.0;\n\n    vec2 dfDetail = fwidth(uvDetail);\n    if(dfDetail.x > 0.5) dfDetail.x = 0.0;\n\n    float density = textureLod(clouds_lut, uvWorley, log2(max(dfWorley.x, dfWorley.y) * 1024.0)).r;\n    density *= textureLod(clouds_lut, uvDetail, log2(max(dfDetail.x, dfDetail.y) * 1024.0)).g;\n\n    float cloudThickness = 2.0;//TODO: make this a uniform\n\n    density = saturate(density * cloudThickness);\n\n    density = smoothstep(clouds_coverage, 1.0, density);\n\n    density = smoothSharpener(density, clouds_sharpness);\n\n    return density;\n}\n\nfloat computeCloudCoverage(vec3 rayOrigin, vec3 rayDir, float maximumDistance, out vec3 cloudNormal) {\n    float impactPoint, escapePoint;\n\n    if (!(rayIntersectSphere(rayOrigin, rayDir, object_position, clouds_layerRadius, impactPoint, escapePoint))) {\n        return 0.0;// if not intersecting with atmosphere, return original color\n    }\n\n    // if ray intersect ocean, update maximum distance (the ocean is not it the depth buffer)\n    float waterImpact, waterEscape;\n    if (rayIntersectSphere(rayOrigin, rayDir, object_position, object_radius, waterImpact, waterEscape)) {\n        maximumDistance = min(maximumDistance, waterImpact);\n    }\n\n    if (impactPoint > maximumDistance || escapePoint < 0.0) return 0.0;\n\n    vec3 planetSpacePoint1 = normalize(rayOrigin + impactPoint * rayDir - object_position);\n    vec3 planetSpacePoint2 = normalize(rayOrigin + escapePoint * rayDir - object_position);\n\n    vec3 samplePoint1 = removeAxialTilt(planetSpacePoint1, object_rotationAxis);\n    vec3 samplePoint2 = removeAxialTilt(planetSpacePoint2, object_rotationAxis);\n\n    float cloudDensity = 0.0;\n    float cloudDensity1 = 0.0;\n    float cloudDensity2 = 0.0;\n\n    if (impactPoint > 0.0 && impactPoint < maximumDistance) {\n        cloudDensity1 += cloudDensityAtPoint(samplePoint1);\n        cloudDensity1 *= saturate((maximumDistance - impactPoint) / 10000.0);// fade away when close to surface\n        cloudDensity += cloudDensity1;\n    }\n\n    if (escapePoint > 0.0 && escapePoint < maximumDistance) {\n        cloudDensity2 += cloudDensityAtPoint(samplePoint2);\n        cloudDensity2 *= saturate((maximumDistance - escapePoint) / 10000.0);// fade away when close to surface\n        cloudDensity += cloudDensity2;\n    }\n\n    if (cloudDensity1 > cloudDensity2) cloudNormal = planetSpacePoint1;\n    else cloudNormal = planetSpacePoint2;\n\n    return cloudDensity;\n}\n\nfloat cloudShadows(vec3 closestPoint) {\n    float lightAmount = 1.0;\n    for (int i = 0; i < nbStars; i++) {\n        // direction to sun from point\n        vec3 sunDir = normalize(star_positions[i] - closestPoint);\n\n        // if ray toward sun does not intersect the cloud layer, then there can't be any cloud shadow\n        float t0, t1;\n        if (!rayIntersectSphere(closestPoint, sunDir, object_position, clouds_layerRadius, t0, t1)) continue;\n\n        // get the point of intersection with the cloud layer\n        vec3 samplePoint = normalize(closestPoint + t1 * sunDir - object_position);\n        if (dot(samplePoint, sunDir) < 0.0) continue;\n        samplePoint = removeAxialTilt(samplePoint, object_rotationAxis);\n        float density = cloudDensityAtPoint(samplePoint);\n        lightAmount -= density;\n    }\n\n    return 0.4 + saturate(lightAmount) * 0.6;\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n\n    // closest physical point from the camera in the direction of the pixel (occlusion)\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    vec3 closestPoint = camera_position + rayDir * maximumDistance;\n    float t0, t1;\n    if (rayIntersectSphere(camera_position, rayDir, object_position, object_radius, t0, t1)) {\n        closestPoint = camera_position + rayDir * min(t0, maximumDistance);\n    }\n\n    vec4 finalColor = screenColor;\n\n    // if the closest point is below the cloud layer, we must account for shadows\n    if (length(closestPoint - object_position) < clouds_layerRadius) finalColor.rgb *= cloudShadows(closestPoint);\n\n    vec3 cloudNormal;\n    float cloudDensity = computeCloudCoverage(camera_position, rayDir, maximumDistance, cloudNormal);\n\n    if (cloudDensity > 0.0) {\n        float ndl = 0.0;// dimming factor due to light inclination relative to vertex normal in world space\n        float specularHighlight = 0.0;\n        for (int i = 0; i < nbStars; i++) {\n            vec3 sunDir = normalize(star_positions[i] - object_position);\n\n            ndl += max(dot(cloudNormal, sunDir), -0.3) + 0.3;\n\n            if (length(camera_position - object_position) > clouds_layerRadius) {\n                // if above cloud coverage then specular highlight\n                specularHighlight += computeSpecularHighlight(sunDir, rayDir, cloudNormal, clouds_smoothness, clouds_specularPower);\n            }\n        }\n        ndl = saturate(ndl);\n\n        vec3 ambiant = mix(finalColor.rgb * (1.0 - cloudDensity), ndl * clouds_color, cloudDensity);\n\n        finalColor.rgb = ambiant + specularHighlight * cloudDensity;\n    }\n\n    gl_FragColor = finalColor;// displaying the final color\n}\n");var d=L(Object.values(A.A)).concat(L(Object.values(C.T)),L(Object.values(T.o)),L(Object.values(I.$k))),f=L(Object.values(P.R)).concat(L(Object.values(I.xP)));return l=n,c=["".concat(e.name,"CloudsPostProcess"),h,d,f,1,null,i.g.BILINEAR_SAMPLINGMODE,s.getEngine(),!1,null,o.Y.TEXTURETYPE_HALF_FLOAT],l=N(l),R(u=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,x()?Reflect.construct(l,c||[],N(this).constructor):l.apply(this,c)),"cloudUniforms",void 0),R(u,"activeCamera",null),u.cloudUniforms=r,u.onActivateObservable.add(function(e){u.activeCamera=e}),u.onApplyObservable.add(function(n){if(null===u.activeCamera)throw Error("FlatCloudsPostProcess: activeCamera is null");(0,T.b)(n,u.activeCamera),(0,C.G)(n,a),(0,A.$)(n,e,t),u.cloudUniforms.setUniforms(n),u.cloudUniforms.setSamplers(n),(0,P.C)(n,u.activeCamera,s)}),u}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&O(n,e),t=[{key:"update",value:function(e){this.cloudUniforms.update(e)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(w.w);function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(j=function(){return!!e})()}var F="colorCorrection";S.M.ShadersStore["".concat(F,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision lowp float;\n\nuniform float exposure;\nuniform float gamma;\nuniform float contrast;\nuniform float saturation;\nuniform float brightness;\n\nuniform sampler2D textureSampler;\n\nvarying vec2 vUV;\n\nvec3 acesTonemap(vec3 color){\n    mat3 m1 = mat3(\n    0.59719, 0.07600, 0.02840,\n    0.35458, 0.90834, 0.13383,\n    0.04823, 0.01566, 0.83777\n    );\n    mat3 m2 = mat3(\n    1.60475, -0.10208, -0.00327,\n    -0.53108,  1.10813, -0.07276,\n    -0.07367, -0.00605,  1.07602\n    );\n    vec3 v = m1 * color;\n    vec3 a = v * (v + 0.0245786) - 0.000090537;\n    vec3 b = v * (0.983729 * v + 0.4329510) + 0.238081;\n    return clamp(m2 * (a / b), 0.0, 1.0);\n}\n\nvoid main() {\n    vec3 color = texture2D(textureSampler, vUV).rgb;\n\n    float alpha = texture2D(textureSampler, vUV).a;\n\n    color *= exposure;\n\n    color = acesTonemap(color);\n\n    color = (color - 0.5) * contrast + 0.5 + brightness;\n    color = clamp(color, 0.0, 1.0);\n\n    vec3 grayscale = vec3(0.299, 0.587, 0.114) * color;\n    color = mix(grayscale, color, saturation);\n    color = clamp(color, 0.0, 1.0);\n\n    color = pow(color, vec3(gamma));\n\n    gl_FragColor = vec4(color, alpha);\n}\n";var U=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n){var r,a,s;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");return a=t,s=[e,F,["brightness","contrast","exposure","gamma","saturation"],["textureSampler"],1,null,i.g.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,null,o.Y.TEXTURETYPE_HALF_FLOAT],a=k(a),_(r=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,j()?Reflect.construct(a,s||[],k(this).constructor):a.apply(this,s)),"brightness",0),_(r,"contrast",1),_(r,"exposure",1),_(r,"gamma",1),_(r,"saturation",1),r._scene=n,r.onApplyObservable.add(function(e){e.setFloat("brightness",r.brightness),e.setFloat("contrast",r.contrast),e.setFloat("exposure",r.exposure),e.setFloat("gamma",r.gamma),e.setFloat("saturation",r.saturation)}),r}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&D(t,e),t}(w.w),G=n(49351),B=n(11402);function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e){return function(e){if(Array.isArray(e))return H(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return H(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(V=function(){return!!e})()}var J=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,r,a,s,l){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var c,u,h,d="ocean";void 0===S.M.ShadersStore["".concat(d,"FragmentShader")]&&(S.M.ShadersStore["".concat(d,"FragmentShader")]='//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision lowp float;\n\n#define DISABLE_UNIFORMITY_ANALYSIS\n\nvarying vec2 vUV;// screen coordinates\n\nuniform sampler2D textureSampler;// the original screen texture\nuniform sampler2D depthSampler;// the depth map of the camera\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\nuniform mat4 planetInverseRotationMatrix;\n\nuniform float ocean_radius;\nuniform float ocean_smoothness;\nuniform float ocean_specularPower;\nuniform float ocean_alphaModifier;\nuniform float ocean_depthModifier;\nuniform float ocean_waveBlendingSharpness;\n\nuniform float time;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\n// The MIT License\n// Copyright \xa9 2015 Inigo Quilez\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n// https://www.youtube.com/c/InigoQuilez\n// https://iquilezles.org\n\n\n// One simple way to avoid texture tile repetition, at the cost of 4 times the amount of\n// texture lookups (still much better than https://www.shadertoy.com/view/4tsGzf)\n//\n// More info: https://iquilezles.org/articles/texturerepetition\n\n//#define USEHASH\n\nvec4 hash4(vec2 p) { return fract(sin(vec4(1.0+dot(p, vec2(37.0, 17.0)),\n2.0+dot(p, vec2(11.0, 47.0)),\n3.0+dot(p, vec2(41.0, 29.0)),\n4.0+dot(p, vec2(23.0, 31.0))))*103.0); }\n\n#define inline\nvec4 textureNoTile(sampler2D samp, in vec2 uv) {\n    vec2 iuv = floor(uv);\n    vec2 fuv = fract(uv);\n\n    // generate per-tile transform\n    vec4 ofa = hash4(iuv + vec2(0.0, 0.0));\n    vec4 ofb = hash4(iuv + vec2(1.0, 0.0));\n    vec4 ofc = hash4(iuv + vec2(0.0, 1.0));\n    vec4 ofd = hash4(iuv + vec2(1.0, 1.0));\n\n    vec2 ddx = dFdx(uv);\n    vec2 ddy = dFdy(uv);\n\n    // transform per-tile uvs\n    ofa.zw = sign(ofa.zw-0.5);\n    ofb.zw = sign(ofb.zw-0.5);\n    ofc.zw = sign(ofc.zw-0.5);\n    ofd.zw = sign(ofd.zw-0.5);\n\n    // uv\'s, and derivarives (for correct mipmapping)\n    vec2 uva = uv*ofa.zw + ofa.xy; vec2 ddxa = ddx*ofa.zw; vec2 ddya = ddy*ofa.zw;\n    vec2 uvb = uv*ofb.zw + ofb.xy; vec2 ddxb = ddx*ofb.zw; vec2 ddyb = ddy*ofb.zw;\n    vec2 uvc = uv*ofc.zw + ofc.xy; vec2 ddxc = ddx*ofc.zw; vec2 ddyc = ddy*ofc.zw;\n    vec2 uvd = uv*ofd.zw + ofd.xy; vec2 ddxd = ddx*ofd.zw; vec2 ddyd = ddy*ofd.zw;\n\n    // fetch and blend\n    vec2 b = smoothstep(0.25, 0.75, fuv);\n\n    return mix(mix(textureGrad(samp, uva, ddxa, ddya),\n    textureGrad(samp, uvb, ddxb, ddyb), b.x),\n    mix(textureGrad(samp, uvc, ddxc, ddyc),\n    textureGrad(samp, uvd, ddxd, ddyd), b.x), b.y);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// https://bgolus.medium.com/normal-mapping-for-a-triplanar-shader-10bf39dca05a\n#define inline\nvec3 triplanarNormal(vec3 position, vec3 surfaceNormal, sampler2D normalMap, float scale) {\n    vec2 uvX = vec3(position).zy * scale;\n    vec2 uvY = vec3(position).xz * scale;\n    vec2 uvZ = vec3(position).xy * scale;\n\n    vec3 blendWeight = pow(abs(surfaceNormal), vec3(2.0));\n    blendWeight /= (blendWeight.x + blendWeight.y + blendWeight.z);\n\n    // get the normal from the normal map\n\n    vec3 tNormalX = textureNoTile(normalMap, uvX).rgb;\n    vec3 tNormalY = textureNoTile(normalMap, uvY).rgb;\n    vec3 tNormalZ = textureNoTile(normalMap, uvZ).rgb;\n\n    tNormalX.g = 1.0 - tNormalX.g;\n    tNormalY.g = 1.0 - tNormalY.g;\n    tNormalZ.g = 1.0 - tNormalZ.g;\n\n    tNormalX = tNormalX * 2.0 - 1.0;\n    tNormalY = tNormalY * 2.0 - 1.0;\n    tNormalZ = tNormalZ * 2.0 - 1.0;\n\n    // Swizzle world normals into tangent space and apply Whiteout blend\n    tNormalX = vec3(tNormalX.xy + surfaceNormal.zy, abs(tNormalX.z) * surfaceNormal.x);\n    tNormalY = vec3(tNormalY.xy + surfaceNormal.xz, abs(tNormalY.z) * surfaceNormal.y);\n    tNormalZ = vec3(tNormalZ.xy + surfaceNormal.xy, abs(tNormalZ.z) * surfaceNormal.z);\n\n    // Swizzle tangent normals to match world orientation and triblend\n    return normalize(\n    tNormalX.zyx * blendWeight.x +\n    tNormalY.xzy * blendWeight.y +\n    tNormalZ.xyz * blendWeight.z\n    );\n}\n\n#define inline\nvoid triPlanarMaterial(vec3 position, vec3 surfaceNormal, sampler2D albedoRoughnessMap, sampler2D normalMetallicMap, float scale, out vec3 albedo, out vec3 normal, out float roughness, out float metallic) {\n    vec2 uvX = vec3(position).zy * scale;\n    vec2 uvY = vec3(position).xz * scale;\n    vec2 uvZ = vec3(position).xy * scale;\n\n    // get the normal from the normal map\n    vec4 tNormalMetallicX = textureNoTile(normalMetallicMap, uvX);\n    vec4 tNormalMetallicY = textureNoTile(normalMetallicMap, uvY);\n    vec4 tNormalMetallicZ = textureNoTile(normalMetallicMap, uvZ);\n\n    vec3 tNormalX = tNormalMetallicX.rgb;\n    vec3 tNormalY = tNormalMetallicY.rgb;\n    vec3 tNormalZ = tNormalMetallicZ.rgb;\n\n    tNormalX = tNormalX * 2.0 - 1.0;\n    tNormalY = tNormalY * 2.0 - 1.0;\n    tNormalZ = tNormalZ * 2.0 - 1.0;\n\n    vec3 blendWeight = abs(surfaceNormal);\n    blendWeight = pow(blendWeight, vec3(2.0));\n    blendWeight /= (blendWeight.x + blendWeight.y + blendWeight.z);\n\n    // Swizzle world normals into tangent space and apply Whiteout blend\n    tNormalX = vec3(tNormalX.xy + surfaceNormal.zy, abs(tNormalX.z) * surfaceNormal.x);\n    tNormalY = vec3(tNormalY.xy + surfaceNormal.xz, abs(tNormalY.z) * surfaceNormal.y);\n    tNormalZ = vec3(tNormalZ.xy + surfaceNormal.xy, abs(tNormalZ.z) * surfaceNormal.z);\n\n    normal = normalize(\n    tNormalX.zyx * blendWeight.x +\n    tNormalY.xzy * blendWeight.y +\n    tNormalZ.xyz * blendWeight.z\n    );\n\n    // tri planar mapping of albedo\n    vec4 tAlbedoRoughnessX = textureNoTile(albedoRoughnessMap, uvX);\n    vec4 tAlbedoRoughnessY = textureNoTile(albedoRoughnessMap, uvY);\n    vec4 tAlbedoRoughnessZ = textureNoTile(albedoRoughnessMap, uvZ);\n\n    float gamma = 2.2;\n    vec3 tAlbedoX = pow(tAlbedoRoughnessX.rgb, vec3(gamma));\n    vec3 tAlbedoY = pow(tAlbedoRoughnessY.rgb, vec3(gamma));\n    vec3 tAlbedoZ = pow(tAlbedoRoughnessZ.rgb, vec3(gamma));\n\n    albedo =\n    tAlbedoX * blendWeight.x +\n    tAlbedoY * blendWeight.y +\n    tAlbedoZ * blendWeight.z;\n\n    // tri planar mapping of roughness\n    float tRoughnessX = tAlbedoRoughnessX.a;\n    float tRoughnessY = tAlbedoRoughnessY.a;\n    float tRoughnessZ = tAlbedoRoughnessZ.a;\n\n    roughness =\n    tRoughnessX * blendWeight.x +\n    tRoughnessY * blendWeight.y +\n    tRoughnessZ * blendWeight.z;\n\n    // tri planar mapping of metallic\n    float tMetallicX = tNormalMetallicX.a;\n    float tMetallicY = tNormalMetallicY.a;\n    float tMetallicZ = tNormalMetallicZ.a;\n\n    metallic =\n    tMetallicX * blendWeight.x +\n    tMetallicY * blendWeight.y +\n    tMetallicZ * blendWeight.z;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat saturate(float value) {\n    if(value < 0.0) return 0.0;\n    if(value > 1.0) return 1.0;\n    return value;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nvec3 applyQuaternion(vec4 quaternion, vec3 vector) {\n    float qx = quaternion.x;\n    float qy = quaternion.y;\n    float qz = quaternion.z;\n    float qw = quaternion.w;\n    float x = vector.x;\n    float y = vector.y;\n    float z = vector.z;\n    // apply quaternion to vector\n    float ix = qw * x + qy * z - qz * y;\n    float iy = qw * y + qz * x - qx * z;\n    float iz = qw * z + qx * y - qy * x;\n    float iw = -qx * x - qy * y - qz * z;\n    // calculate result * inverse quat\n    float nX = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n    float nY = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n    float nZ = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n\n    return vec3(nX, nY, nZ);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat computeSpecularHighlight(vec3 sunDir, vec3 rayDir, vec3 normal, float smoothness, float specularPower) {\n    float specularAngle = acos(dot(normalize(sunDir - rayDir), normal));\n    float specularExponent = specularAngle / (1.0 - smoothness);\n\n    return exp(-specularExponent * specularExponent) * specularPower;\n}\n\n// see https://farside.ph.utexas.edu/teaching/em/lectures/node104.html\nfloat fractionReflected(float cosThetaI, float cosThetaT, float n1, float n2) {\n    float alpha = abs(cosThetaI) > 0.01 ? cosThetaT / cosThetaI : 0.0;\n    float beta = n2 / n1;\n    return (1.0 - alpha * beta) * (1.0 - alpha * beta) / ((1.0 + alpha * beta) * (1.0 + alpha * beta));\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>\n\nvec3 triangleWave(vec3 x, float a) {\n    float p = 4.0 * a;\n    return (4.0 * a / p) * abs(mod(x, p) - p * 0.5);\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n\n    // actual depth of the scene\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    vec4 finalColor = screenColor;\n\n    float actualRadius = ocean_radius;\n\n    float impactPoint, escapePoint;\n    if (rayIntersectSphere(camera_position, rayDir, object_position, actualRadius, impactPoint, escapePoint) && impactPoint < maximumDistance) {\n        impactPoint = max(0.0, impactPoint);// cannot be negative (the ray starts where the camera is in such a case)\n        escapePoint = min(maximumDistance, escapePoint);// occlusion with other scene objects\n\n        float distanceThroughOcean = max(0.0, escapePoint - impactPoint);// probably doesn\'t need the max but for the sake of coherence the distance cannot be negative\n\n        vec3 samplePoint = camera_position + impactPoint * rayDir - object_position;\n\n        vec3 planetNormal = normalize(samplePoint);\n\n        vec3 samplePointPlanetSpace = mat3(planetInverseRotationMatrix) * samplePoint;\n\n        vec3 normalSamplePoint1 = triangleWave(samplePointPlanetSpace, 512.0);\n        vec3 normalSamplePoint2 = triangleWave(samplePointPlanetSpace, 512.0);\n\n        vec3 normalWave = planetNormal;\n        normalWave = triplanarNormal(normalSamplePoint1 + vec3(time, -time, -time) * 1.0, normalWave, normalMap2, 0.1);\n        normalWave = triplanarNormal(normalSamplePoint2 + vec3(-time, time, time) * 1.0, normalWave, normalMap1, 0.05);\n\n        float opticalDepth01 = 1.0 - exp(-distanceThroughOcean * ocean_depthModifier);\n        float alpha = exp(-distanceThroughOcean * ocean_alphaModifier);\n\n        vec3 deepColor = vec3(0.0, 22.0, 82.0)/255.0;\n        vec3 shallowColor = vec3(32.0, 193.0, 180.0)/255.0;\n        vec3 oceanColor = mix(shallowColor, deepColor, opticalDepth01);\n\n        vec3 ambiant = mix(oceanColor, screenColor.rgb, alpha);\n\n        // if the camera is not inside the ocean\n        if(impactPoint > 0.0) {\n            // color of the sky\n            vec3 reflectedSkyColor = vec3(0.6, 0.8, 0.95);\n\n            // refraction\n            float nAir = 1.0;\n            float nWater = 1.33;\n            float eta = nAir / nWater;\n            vec3 incidentRay = rayDir;\n            vec3 refractedRay = refract(incidentRay, normalWave, eta);\n\n            float cosThetaI = dot(-incidentRay, normalWave);\n            float cosThetaT = dot(refractedRay, -normalWave);\n\n            float amountReflected = fractionReflected(cosThetaI, cosThetaT, nAir, nWater);\n\n            ambiant = mix(ambiant, reflectedSkyColor, amountReflected);\n        }\n\n        float foamSize = 10.0;\n        float foamFactor = saturate((foamSize - distanceThroughOcean) / foamSize);\n        foamFactor = smoothstep(0.01, 1.0, foamFactor);\n        vec3 foamColor = vec3(0.8);\n        ambiant = mix(ambiant, foamColor, foamFactor);\n\n        finalColor.rgb = vec3(0.0);\n        for (int i = 0; i < nbStars; i++) {\n            vec3 sunDir = normalize(star_positions[i] - samplePoint);\n\n            float ndl = max(dot(planetNormal, sunDir), 0.0);\n            finalColor.rgb += ambiant * ndl * star_colors[i];\n\n            if (length(camera_position - object_position) > ocean_radius) {\n                // if above ocean surface then specular highlight\n                finalColor.rgb += computeSpecularHighlight(sunDir, rayDir, normalWave, ocean_smoothness, ocean_specularPower) * star_colors[i];\n            }\n        }\n    }\n\n    gl_FragColor = finalColor;\n}');var f=q(Object.values(T.o)).concat(q(Object.values(C.T)),q(Object.values(A.A)),q(r.getUniformNames())),p=q(Object.values(P.R)).concat(q(r.getSamplerNames()));return c=n,u=["".concat(e.name,"OceanPostProcess"),d,f,p,1,null,i.g.BILINEAR_SAMPLINGMODE,l.getEngine(),!1,null,o.Y.TEXTURETYPE_HALF_FLOAT],c=W(c),Y(h=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,V()?Reflect.construct(c,u||[],W(this).constructor):c.apply(this,u)),"planetTransform",void 0),Y(h,"oceanUniforms",void 0),Y(h,"activeCamera",null),h.planetTransform=e,h.oceanUniforms=r,h.onActivateObservable.add(function(e){return h.activeCamera=e}),h.onApplyObservable.add(function(n){if(null===h.activeCamera)throw Error("Camera is null");(0,T.b)(n,h.activeCamera),(0,C.G)(n,a),(0,A.$)(n,e,t),r.setUniforms(n,e),(0,P.C)(n,h.activeCamera,l),r.setSamplers(n,s)}),h}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&z(n,e),t=[{key:"update",value:function(e){this.oceanUniforms.time+=e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(w.w),X=((r={})[r.VOLUMETRIC_LIGHT=0]="VOLUMETRIC_LIGHT",r[r.OCEAN=1]="OCEAN",r[r.CLOUDS=2]="CLOUDS",r[r.ATMOSPHERE=3]="ATMOSPHERE",r[r.RING=4]="RING",r[r.MATTER_JETS=5]="MATTER_JETS",r[r.MANDELBULB=6]="MANDELBULB",r[r.JULIA_SET=7]="JULIA_SET",r[r.MANDELBOX=8]="MANDELBOX",r[r.SIERPINSKI_PYRAMID=9]="SIERPINSKI_PYRAMID",r[r.MENGER_SPONGE=10]="MENGER_SPONGE",r[r.BLACK_HOLE=11]="BLACK_HOLE",r[r.SHADOW=12]="SHADOW",r[r.LENS_FLARE=13]="LENS_FLARE",r),Z=n(96397),K=n(12044),Q=n(65726);function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var en=[X.VOLUMETRIC_LIGHT,X.MATTER_JETS,X.OCEAN,X.CLOUDS,X.ATMOSPHERE,X.MANDELBULB,X.JULIA_SET,X.MANDELBOX,X.SIERPINSKI_PYRAMID,X.MENGER_SPONGE,X.RING,X.BLACK_HOLE],er=[X.VOLUMETRIC_LIGHT,X.MATTER_JETS,X.BLACK_HOLE,X.MANDELBULB,X.JULIA_SET,X.MANDELBOX,X.SIERPINSKI_PYRAMID,X.MENGER_SPONGE,X.RING,X.OCEAN,X.CLOUDS,X.ATMOSPHERE],eo=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");ee(this,"engine",void 0),ee(this,"scene",void 0),ee(this,"renderingPipelineManager",void 0),ee(this,"renderingPipeline",void 0),ee(this,"currentRenderingOrder",en),ee(this,"volumetricLights",[]),ee(this,"oceans",[]),ee(this,"clouds",[]),ee(this,"atmospheres",[]),ee(this,"rings",[]),ee(this,"mandelbulbs",[]),ee(this,"mandelboxes",[]),ee(this,"sierpinskiPyramids",[]),ee(this,"mengerSponges",[]),ee(this,"juliaSets",[]),ee(this,"blackHoles",[]),ee(this,"matterJets",[]),ee(this,"shadows",[]),ee(this,"lensFlares",[]),ee(this,"objectPostProcesses",[this.volumetricLights,this.oceans,this.clouds,this.atmospheres,this.rings,this.mandelbulbs,this.juliaSets,this.mandelboxes,this.sierpinskiPyramids,this.mengerSponges,this.blackHoles,this.matterJets,this.shadows,this.lensFlares]),ee(this,"updatablePostProcesses",[this.oceans,this.clouds,this.blackHoles,this.matterJets,this.mandelbulbs,this.juliaSets,this.mandelboxes,this.sierpinskiPyramids]),ee(this,"celestialBodyToPostProcesses",new Map),ee(this,"colorCorrection",void 0),ee(this,"fxaa",void 0),ee(this,"colorCorrectionRenderEffect",void 0),ee(this,"fxaaRenderEffect",void 0),ee(this,"bloomRenderEffect",void 0),ee(this,"textures",void 0),this.scene=n,this.engine=n.getEngine(),this.textures=e,this.renderingPipelineManager=n.postProcessRenderPipelineManager,this.colorCorrection=new U("colorCorrection",n),this.colorCorrection.exposure=1.5,this.colorCorrection.gamma=1,this.colorCorrection.saturation=1.2,this.fxaa=new l.a("fxaa",1,null,i.g.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,o.Y.TEXTURETYPE_HALF_FLOAT),this.colorCorrectionRenderEffect=new c.l(n.getEngine(),"colorCorrectionRenderEffect",function(){return[r.colorCorrection]}),this.fxaaRenderEffect=new c.l(n.getEngine(),"fxaaRenderEffect",function(){return[r.fxaa]}),this.renderingPipeline=new u.m(n.getEngine(),"renderingPipeline"),this.renderingPipelineManager.addPipeline(this.renderingPipeline),this.bloomRenderEffect=new s.b(n,1,.3,32,o.Y.TEXTURETYPE_HALF_FLOAT),this.bloomRenderEffect.threshold=0}return e=[{key:"makeSplitRenderEffects",value:function(e,t,n,r){var o,i=null!=(o=this.celestialBodyToPostProcesses.get(t.getTransform()))?o:[],a=n.filter(function(e){return i.includes(e)}),s=n.filter(function(e){return!a.includes(e)});return[new c.l(r,"other".concat(e,"RenderEffect"),function(){return s}),new c.l(r,"body".concat(e,"RenderEffect"),function(){return a})]}},{key:"addStar",value:function(e,t){var n=[],r=new Q.N(e.mesh,e.volumetricLightUniforms,t,this.scene);this.volumetricLights.push(r),n.push(r);var o=new G.O(e.getTransform(),e.getBoundingRadius(),(0,f.C)(e.model.blackBodyTemperature),this.scene);if(this.lensFlares.push(o),n.push(o),null!==e.ringsUniforms){var i=new Z.b(e.getTransform(),e.ringsUniforms,e.model,[e.getLight()],this.scene);this.rings.push(i),n.push(i)}this.celestialBodyToPostProcesses.set(e.getTransform(),n)}},{key:"addNeutronStar",value:function(e,t){var n=[],r=new Q.N(e.mesh,e.volumetricLightUniforms,t,this.scene);this.volumetricLights.push(r),n.push(r);var o=new G.O(e.getTransform(),e.getBoundingRadius(),(0,f.C)(e.model.blackBodyTemperature),this.scene);this.lensFlares.push(o),n.push(o);var i=new B.A(e.getTransform(),e.getBoundingRadius(),e.model.dipoleTilt,this.scene);if(this.matterJets.push(i),n.push(i),null!==e.ringsUniforms){var a=new Z.b(e.getTransform(),e.ringsUniforms,e.model,[e.getLight()],this.scene);this.rings.push(a),n.push(a)}this.celestialBodyToPostProcesses.set(e.getTransform(),n)}},{key:"addBlackHole",value:function(e){var t=new d.$(e.getTransform(),e.blackHoleUniforms,this.scene);this.blackHoles.push(t),this.celestialBodyToPostProcesses.set(e.getTransform(),[t])}},{key:"addTelluricPlanet",value:function(e,t){var n=[];if(null!==e.atmosphereUniforms){var r=new b.D(e.getTransform(),e.getBoundingRadius(),e.atmosphereUniforms,t.map(function(e){return e.getLight()}),this.scene);this.atmospheres.push(r),n.push(r)}if(null!==e.oceanUniforms){var o=new J(e.getTransform(),e.getBoundingRadius(),e.oceanUniforms,t.map(function(e){return e.getLight()}),this.textures.water,this.scene);this.oceans.push(o),n.push(o)}if(null!==e.cloudsUniforms){var i=new M(e.getTransform(),e.getBoundingRadius(),e.cloudsUniforms,t.map(function(e){return e.getLight()}),this.scene);this.clouds.push(i),n.push(i)}if(null!==e.ringsUniforms){var a=new Z.b(e.getTransform(),e.ringsUniforms,e.model,t.map(function(e){return e.getLight()}),this.scene);this.rings.push(a),n.push(a)}var s=new K.U(e.getTransform(),e.getBoundingRadius(),e.ringsUniforms,e.cloudsUniforms,null!==e.model.ocean,t,this.scene);this.shadows.push(s),n.push(s),this.celestialBodyToPostProcesses.set(e.getTransform(),n)}},{key:"addGasPlanet",value:function(e,t){var n=[],r=new b.D(e.getTransform(),e.getBoundingRadius(),e.atmosphereUniforms,t.map(function(e){return e.getLight()}),this.scene);if(this.atmospheres.push(r),n.push(r),null!==e.ringsUniforms){var o=new Z.b(e.getTransform(),e.ringsUniforms,e.model,t.map(function(e){return e.getLight()}),this.scene);this.rings.push(o),n.push(o)}var i=new K.U(e.getTransform(),e.getBoundingRadius(),e.ringsUniforms,null,!1,t,this.scene);this.shadows.push(i),n.push(i),this.celestialBodyToPostProcesses.set(e.getTransform(),n)}},{key:"addMandelbulb",value:function(e,t,n,r){var o=new v.W(e,t,n,this.scene,r);this.mandelbulbs.push(o),this.celestialBodyToPostProcesses.set(e,[o])}},{key:"addJuliaSet",value:function(e,t,n,r){var o=new p.t(e,t,n.accentColor,this.scene,r);this.juliaSets.push(o),this.celestialBodyToPostProcesses.set(e,[o])}},{key:"addMandelbox",value:function(e,t,n,r){var o=new m.M(e,t,n,this.scene,r);this.mandelboxes.push(o),this.celestialBodyToPostProcesses.set(e,[o])}},{key:"addSierpinskiPyramid",value:function(e,t,n,r){var o=new g.$(e,t,n,this.scene,r);this.sierpinskiPyramids.push(o),this.celestialBodyToPostProcesses.set(e,[o])}},{key:"addMengerSponge",value:function(e,t,n,r){var o=new y.Q(e,t,n,this.scene,r);this.mengerSponges.push(o),this.celestialBodyToPostProcesses.set(e,[o])}},{key:"addCelestialBodies",value:function(e,t,n){var r,o=t.map(function(e){return e.getLight()}),i=!0,a=!1,s=void 0;try{for(var l,c=e[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value;switch(u.type){case h.T.STAR:this.addStar(u,n);break;case h.T.NEUTRON_STAR:this.addNeutronStar(u,n);break;case h.T.BLACK_HOLE:this.addBlackHole(u);break;case h.T.TELLURIC_PLANET:case h.T.TELLURIC_SATELLITE:this.addTelluricPlanet(u,t);break;case h.T.GAS_PLANET:this.addGasPlanet(u,t);break;case h.T.MANDELBULB:this.addMandelbulb(u.getTransform(),u.getRadius(),u.model,o);break;case h.T.JULIA_SET:this.addJuliaSet(u.getTransform(),u.getRadius(),u.model,o);break;case h.T.MANDELBOX:this.addMandelbox(u.getTransform(),u.getRadius(),u.model,o);break;case h.T.SIERPINSKI_PYRAMID:this.addSierpinskiPyramid(u.getTransform(),u.getRadius(),u.model,o);break;case h.T.MENGER_SPONGE:this.addMengerSponge(u.getTransform(),u.getRadius(),u.model,o);case h.T.DARK_KNIGHT:}}}catch(e){a=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}var d=null!=(r=e[0])?r:t[0];if(void 0===d)throw Error("No arguments provided to addCelestialBodies");this.rebuild(d)}},{key:"setCelestialBody",value:function(e){var t,n=null==(t=this.celestialBodyToPostProcesses.get(e.getTransform()))?void 0:t.find(function(e){var t;return null!=(t=Z.b)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}),r=void 0!==n?n.ringsUniforms.model.innerRadius:2*e.getBoundingRadius();a.Pq.DistanceSquared(e.getTransform().getAbsolutePosition(),this.scene.getActiveControls().getTransform().getAbsolutePosition())<Math.pow(r,2)?this.setSurfaceOrder(e):this.setSpaceOrder(e)}},{key:"setSpaceOrder",value:function(e){this.currentRenderingOrder!==en&&(this.currentRenderingOrder=en,this.rebuild(e))}},{key:"setSurfaceOrder",value:function(e){this.currentRenderingOrder!==er&&(this.currentRenderingOrder=er,this.rebuild(e))}},{key:"rebuild",value:function(e){var t=this;this.renderingPipelineManager.detachCamerasFromRenderPipeline(this.renderingPipeline.name,this.scene.cameras),this.renderingPipelineManager.removePipeline(this.renderingPipeline.name),this.renderingPipeline.dispose(),this.renderingPipeline=new u.m(this.scene.getEngine(),"renderingPipeline");var n=et(this.makeSplitRenderEffects("VolumetricLights",e,this.volumetricLights,this.engine),2),r=n[0],o=n[1],i=et(this.makeSplitRenderEffects("BlackHoles",e,this.blackHoles,this.engine),2),a=i[0],s=i[1],l=et(this.makeSplitRenderEffects("Oceans",e,this.oceans,this.engine),2),h=l[0],d=l[1],f=et(this.makeSplitRenderEffects("Clouds",e,this.clouds,this.engine),2),p=f[0],m=f[1],v=et(this.makeSplitRenderEffects("Atmospheres",e,this.atmospheres,this.engine),2),y=v[0],g=v[1],b=et(this.makeSplitRenderEffects("Rings",e,this.rings,this.engine),2),S=b[0],w=b[1],T=et(this.makeSplitRenderEffects("Mandelbulbs",e,this.mandelbulbs,this.engine),2),A=T[0],P=T[1],C=et(this.makeSplitRenderEffects("JuliaSets",e,this.juliaSets,this.engine),2),I=C[0],E=C[1],R=et(this.makeSplitRenderEffects("Mandelboxes",e,this.mandelboxes,this.engine),2),N=R[0],O=R[1],L=et(this.makeSplitRenderEffects("SierpinskiPyramids",e,this.sierpinskiPyramids,this.engine),2),x=L[0],M=L[1],_=et(this.makeSplitRenderEffects("MengerSponges",e,this.mengerSponges,this.engine),2),k=_[0],D=_[1],j=et(this.makeSplitRenderEffects("MatterJets",e,this.matterJets,this.engine),2),F=j[0],U=j[1],G=new c.l(this.engine,"ShadowRenderEffect",function(){return t.shadows}),B=new c.l(this.engine,"LensFlareRenderEffect",function(){return t.lensFlares});this.renderingPipeline.addEffect(G);var H=!0,Y=!1,W=void 0;try{for(var z,q=en[Symbol.iterator]();!(H=(z=q.next()).done);H=!0)switch(z.value){case X.VOLUMETRIC_LIGHT:this.renderingPipeline.addEffect(r);break;case X.BLACK_HOLE:this.renderingPipeline.addEffect(a);break;case X.OCEAN:this.renderingPipeline.addEffect(h);break;case X.CLOUDS:this.renderingPipeline.addEffect(p);break;case X.ATMOSPHERE:this.renderingPipeline.addEffect(y);break;case X.RING:this.renderingPipeline.addEffect(S);break;case X.MATTER_JETS:this.renderingPipeline.addEffect(F);break;case X.MANDELBULB:this.renderingPipeline.addEffect(A);break;case X.JULIA_SET:this.renderingPipeline.addEffect(I);break;case X.MANDELBOX:this.renderingPipeline.addEffect(N);break;case X.SIERPINSKI_PYRAMID:this.renderingPipeline.addEffect(x);break;case X.MENGER_SPONGE:this.renderingPipeline.addEffect(k);case X.SHADOW:case X.LENS_FLARE:}}catch(e){Y=!0,W=e}finally{try{H||null==q.return||q.return()}finally{if(Y)throw W}}var V=!0,J=!1,Z=void 0;try{for(var K,Q=this.currentRenderingOrder[Symbol.iterator]();!(V=(K=Q.next()).done);V=!0)switch(K.value){case X.VOLUMETRIC_LIGHT:this.renderingPipeline.addEffect(o);break;case X.BLACK_HOLE:this.renderingPipeline.addEffect(s);break;case X.OCEAN:this.renderingPipeline.addEffect(d);break;case X.CLOUDS:this.renderingPipeline.addEffect(m);break;case X.ATMOSPHERE:this.renderingPipeline.addEffect(g);break;case X.RING:this.renderingPipeline.addEffect(w);break;case X.MATTER_JETS:this.renderingPipeline.addEffect(U);break;case X.MANDELBULB:this.renderingPipeline.addEffect(P);break;case X.JULIA_SET:this.renderingPipeline.addEffect(E);break;case X.MANDELBOX:this.renderingPipeline.addEffect(O);break;case X.SIERPINSKI_PYRAMID:this.renderingPipeline.addEffect(M);break;case X.MENGER_SPONGE:this.renderingPipeline.addEffect(D);case X.LENS_FLARE:case X.SHADOW:}}catch(e){J=!0,Z=e}finally{try{V||null==Q.return||Q.return()}finally{if(J)throw Z}}this.renderingPipeline.addEffect(this.bloomRenderEffect),this.renderingPipeline.addEffect(B),this.renderingPipeline.addEffect(this.fxaaRenderEffect),this.renderingPipeline.addEffect(this.colorCorrectionRenderEffect),this.renderingPipelineManager.addPipeline(this.renderingPipeline),this.renderingPipelineManager.attachCamerasToRenderPipeline(this.renderingPipeline.name,this.scene.cameras)}},{key:"update",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.updatablePostProcesses.flat()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)o.value.update(e)}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"reset",value:function(){var e=this;this.renderingPipelineManager.detachCamerasFromRenderPipeline(this.renderingPipeline.name,this.scene.cameras),this.renderingPipelineManager.removePipeline(this.renderingPipeline.name),this.renderingPipeline.dispose(),this.renderingPipeline=new u.m(this.scene.getEngine(),"renderingPipeline"),this.renderingPipeline.addEffect(this.bloomRenderEffect),this.renderingPipeline.addEffect(this.fxaaRenderEffect),this.renderingPipeline.addEffect(this.colorCorrectionRenderEffect),this.renderingPipelineManager.addPipeline(this.renderingPipeline),this.renderingPipelineManager.attachCamerasToRenderPipeline(this.renderingPipeline.name,this.scene.cameras),this.scene.cameras.forEach(function(t){e.objectPostProcesses.forEach(function(e){e.forEach(function(e){e.dispose(t)})})}),this.objectPostProcesses.forEach(function(e){e.length=0}),this.celestialBodyToPostProcesses.clear()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},96397:function(e,t,n){"use strict";n.d(t,{b:()=>g});var r=n(47347),o=n(78930),i=n(92771),a=n(62325),s=n(77621),l=n(54205),c=n(56754),u=n(56072),h=n(95864);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return d(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}var g=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,a,d,m){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");var g,b,S,w="rings";void 0===o.M.ShadersStore["".concat(w,"FragmentShader")]&&(o.M.ShadersStore["".concat(w,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\n#define DISABLE_UNIFORMITY_ANALYSIS\n\nvarying vec2 vUV; // screen coordinates\n\nuniform sampler2D textureSampler; // the original screen texture\nuniform sampler2D depthSampler; // the depth map of the camera\n\n// ─── HG multi-lobe parameters (Cassini match) ───────────────────────────────────\n// Weights must sum to 1.0\nconst float rings_f1 = 0.60;  // lobe #1 (strong forward)\nconst float rings_f2 = 0.25;  // lobe #2 (back‑scatter plateau)\nconst float rings_f3 = 0.15;  // lobe #3 (quasi‑isotropic haze)\n\nconst float rings_g1 = 0.75;  // asymmetry forward (≈ diffractive peak)\nconst float rings_g2 = -0.30; // asymmetry backward (shadow‑hiding)\nconst float rings_g3 = 0.00;  // asymmetry isotropic\n\n// ─── scattering constants ──────────────────────────────────────────────────────\nconst float rings_w           = 0.90;   // single-scattering albedo (ice)\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform float rings_inner_radius;\nuniform float rings_outer_radius;\nuniform float rings_fade_out_distance;\nuniform sampler2D rings_pattern_lut;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nbool rayIntersectsPlane(vec3 rayOrigin, vec3 rayDir, vec3 planePosition, vec3 planeNormal, float tolerance, out float t) {\n    float denom = dot(rayDir, planeNormal);\n    if (abs(denom) <= tolerance) return false;// ray is parallel to the plane\n    t = dot(planeNormal, planePosition - rayOrigin) / denom;\n    return t >= 0.0;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat mod289(float x){ return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 mod289(vec4 x){ return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 perm(vec4 x){ return mod289(((x * 34.0) + 1.0) * x); }\n\nfloat noise(float r) {\n    float a = floor(r);\n    float d = r - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = vec4(a) + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + vec4(a);\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d + o1 * (1.0 - d);\n    vec2 o4 = o3.yw * d + o3.xz * (1.0 - d);\n\n    return o4.y * d + o4.x * (1.0 - d);\n}\n\n\nfloat completeNoise(float r, int nbOctaves, float decay, float lacunarity) {\n    float totalAmplitude = 0.0;\n    float amp = 1.0;\n    float samplePointMultiplier = 1.0;\n    float value = 0.0;\n    for (int i = 0; i < nbOctaves; i++) {\n        amp /= decay;\n        samplePointMultiplier *= lacunarity;\n        totalAmplitude += amp;\n        value += amp * noise(r * samplePointMultiplier);\n    }\n    return value / totalAmplitude;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n/**\n * Returns the albedo of the rings in r,g,b and the density in a.\n * The density is a value between 0 and 1.\n */\nvec4 ringPatternAtPoint(vec3 samplePoint) {\n    vec3 samplePointPlanetSpace = samplePoint - object_position;\n\n    float distanceToPlanet = length(samplePointPlanetSpace);\n    \n    // out if not intersecting with rings and interpolation area\n    if (distanceToPlanet < rings_inner_radius || distanceToPlanet > rings_outer_radius) return vec4(0.0);\n\n    float uvX = remap(distanceToPlanet, rings_inner_radius, rings_outer_radius, 0.0, 1.0);\n    vec2 uv = vec2(uvX, 0.0);\n    \n    vec4 result = texture2D(rings_pattern_lut, uv);\n\n    // fade at the edge of the texture to avoid sampling artifacts\n    result.a *= smoothstep(0.02, 0.03, uvX);\n    result.a *= (1.0 - smoothstep(0.97, 0.98, uvX));\n\n    return result;\n}\n\n// ───────────────────────────────────────────────────────────────────────────────\n// Henyey–Greenstein helper (returns *unnormalised* value)                       \n// (We divide by 4π later.)\nfloat hgLobe(float cosA, float g) {\n    float g2 = g*g;\n    return (1.0 - g2) * inversesqrt((1.0 + g2 - 2.0*g*cosA) * (1.0 + g2 - 2.0*g*cosA) * (1.0 + g2 - 2.0*g*cosA)); // (⋯)^-3/2 via invsqrt\xb3\n}\n\n// Triple-lobe HG – matches Cassini photometry \xb13 % RMS over 0.5–170 \xb0\nfloat hgBulkPhase3(float cosA) {\n    float p = 0.0;\n    p += rings_f1 * hgLobe(cosA, rings_g1);\n    p += rings_f2 * hgLobe(cosA, rings_g2);\n    p += rings_f3 * hgLobe(cosA, rings_g3);\n    return p / (4.0 * PI);\n}\n// ───────────────────────────────────────────────────────────────────────────────\n\nfloat tan2(float cosA) {\n    float cosA2 = cosA * cosA;\n    // tan\xb2(α) = (1 - cos\xb2(α)) / cos\xb2(α)\n    return (1.0 - cosA2) / (cosA2);\n}\n\n// Calculates the lighting contribution from a single star for the rings\nvec3 calculateStarLightingForRings(vec3 samplePoint, vec3 rayDir, vec3 ringAlbedo, vec3 starPosition, vec3 starColor) {\n    vec3 rayToSun = normalize(starPosition - samplePoint);\n    float cosA = dot(rayToSun, -rayDir);\n\n    // soft shadow from planet\n    float softShadowFactor = 1.0;\n    float t2, t3;\n    if (object_position != starPosition && rayIntersectSphere(samplePoint, rayToSun, object_position, object_radius, t2, t3)) {\n        vec3 cp = samplePoint + rayToSun * (t2 + t3) * 0.5;\n        float r01 = remap(length(cp - object_position), 0.0, object_radius, 0.0, 1.0);\n        softShadowFactor = smoothstep(0.98, 1.0, r01);\n    }\n\n    // single-scatter, triple-lobe HG\n    float phase = rings_w * hgBulkPhase3(cosA);\n\n    // ── Opposition surge (Hapke SHOE term) ────────────────────\n    float B0 = 1.2;  // amplitude\n    float h  = 0.01; // half-width (rad)\n    float B = B0 / (1.0 + tan2(cosA)/(h*h));\n    phase *= 1.0 + B;\n\n    // Isotropic multiple‐scattering approximation\n    // This avoids the rings being too dark\n    float multiScattering = 0.3;\n    phase += multiScattering;\n    \n    return starColor * ringAlbedo * phase * softShadowFactor;\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);\n\n    float depth = texture2D(depthSampler, vUV).r;\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView); // the pixel position in world space (near plane)\n\n    // actual depth of the scene\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position); // normalized direction of the ray\n\n    vec4 finalColor = screenColor;\n\n    float impactPoint;\n    if (rayIntersectsPlane(camera_position, rayDir, object_position, object_rotationAxis, 0.001, impactPoint)) {\n        // if the ray intersect the ring plane\n        if (impactPoint >= 0.0 && impactPoint < maximumDistance) {\n            // if the ray intersects the ring before any other object\n            float t0, t1;\n            if (!rayIntersectSphere(camera_position, rayDir, object_position, object_radius, t0, t1) || t0 > impactPoint) {\n                // if the ray is impacting a solid object after the ring plane\n                vec3 samplePoint = camera_position + impactPoint * rayDir;\n                vec4 pattern = ringPatternAtPoint(samplePoint);\n\n                vec3 ringAlbedo = pattern.rgb;\n\n                float ringOpacity = pattern.a;\n                ringOpacity *= smoothstep(rings_fade_out_distance * 2.0, rings_fade_out_distance * 5.0, impactPoint);\n\n                vec3 ringShadeColor = vec3(0.0);\n\n                for (int i = 0; i < nbStars; i++) {\n                    ringShadeColor += calculateStarLightingForRings(samplePoint, rayDir, ringAlbedo, star_positions[i], star_colors[i]);\n                }\n\n                finalColor = vec4(mix(finalColor.rgb, ringShadeColor, ringOpacity), 1.0);\n            }\n        }\n    }\n\n    gl_FragColor = finalColor;\n}");var T=v(Object.values(l.A)).concat(v(Object.values(u.T)),v(Object.values(s.o)),v(Object.values(h.eI))),A=v(Object.values(c.R)).concat(v(Object.values(h.aC)));return g=t,b=["".concat(a.name,"RingPostProcess"),w,T,A,1,null,i.g.BILINEAR_SAMPLINGMODE,m.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],g=p(g),f(S=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,y()?Reflect.construct(g,b||[],p(this).constructor):g.apply(this,b)),"ringsUniforms",void 0),f(S,"activeCamera",null),S.ringsUniforms=n,S.onActivateObservable.add(function(e){S.activeCamera=e}),S.onApplyObservable.add(function(t){if(null===S.activeCamera)throw Error("RingsPostProcess: activeCamera is null");(0,s.b)(t,S.activeCamera),(0,u.G)(t,d),(0,l.$)(t,e,a.radius),S.ringsUniforms.setUniforms(t),S.ringsUniforms.setSamplers(t),(0,c.C)(t,S.activeCamera,m)}),S}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e),t}(a.w)},26067:function(e,t,n){"use strict";n.d(t,{q:()=>a});var r=n(78930),o=n(8413),i=n(28995),a=function(){var e;function t(e){var n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");n=void 0,"lut"in this?Object.defineProperty(this,"lut",{value:n,enumerable:!0,configurable:!0,writable:!0}):this.lut=n,void 0===r.M.ShadersStore.ringsLUTFragmentShader&&(r.M.ShadersStore.ringsLUTFragmentShader="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nvarying vec2 vUV;\n\nuniform float seed;\nuniform float frequency;\nuniform vec3 albedo;\nuniform float innerRadius;\nuniform float outerRadius;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat mod289(float x){ return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 mod289(vec4 x){ return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 perm(vec4 x){ return mod289(((x * 34.0) + 1.0) * x); }\n\nfloat noise(float r) {\n    float a = floor(r);\n    float d = r - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = vec4(a) + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + vec4(a);\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d + o1 * (1.0 - d);\n    vec2 o4 = o3.yw * d + o3.xz * (1.0 - d);\n\n    return o4.y * d + o4.x * (1.0 - d);\n}\n\n\nfloat completeNoise(float r, int nbOctaves, float decay, float lacunarity) {\n    float totalAmplitude = 0.0;\n    float amp = 1.0;\n    float samplePointMultiplier = 1.0;\n    float value = 0.0;\n    for (int i = 0; i < nbOctaves; i++) {\n        amp /= decay;\n        samplePointMultiplier *= lacunarity;\n        totalAmplitude += amp;\n        value += amp * noise(r * samplePointMultiplier);\n    }\n    return value / totalAmplitude;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\nvoid main() {\n    float distanceToPlanet = remap(vUV.x, 0.0, 1.0, innerRadius, outerRadius);\n\n    float macroRingDensity = completeNoise(fract(seed) + distanceToPlanet * 1e-6 * frequency * 0.05, 1, 2.0, 2.0);\n    macroRingDensity = smoothstep(0.0, 0.7, macroRingDensity);\n\n    float microRingDensity = completeNoise(fract(seed) + distanceToPlanet * 1e-6 * frequency * 5.0, 5, 2.0, 2.0);\n\n    float mediumRingDensity = completeNoise(fract(seed) + distanceToPlanet * 1e-6 * frequency, 5, 2.0, 2.0);\n    mediumRingDensity = remap(mediumRingDensity, 0.0, 1.0, 0.4, 1.6);\n\n    float ringDensity = macroRingDensity * microRingDensity * mediumRingDensity;\n\n    const float rings_thickness   = 2.0;\n    float ringOpacity = 1.0 - exp(-ringDensity * rings_thickness);\n\n    gl_FragColor = vec4(albedo, ringOpacity);\n}"),this.lut=new o.p("ringsLUT",{width:4096,height:1},"ringsLUT",e,void 0,!0,!1),this.lut.refreshRate=0}return e=[{key:"setModel",value:function(e){this.lut.setFloat("seed",e.seed),this.lut.setFloat("frequency",e.frequency),this.lut.setColor3("albedo",i.v9.FromArray([e.albedo.r,e.albedo.g,e.albedo.b])),this.lut.setFloat("innerRadius",e.innerRadius),this.lut.setFloat("outerRadius",e.outerRadius),this.lut.resetRefreshCounter()}},{key:"isReady",value:function(){return this.lut.isReady()}},{key:"getTexture",value:function(){return this.lut}},{key:"dispose",value:function(){this.lut.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},95864:function(e,t,n){"use strict";n.d(t,{aC:()=>s,eI:()=>a,zl:()=>l});var r=n(70673);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a={RING_INNER_RADIUS:"rings_inner_radius",RING_OUTER_RADIUS:"rings_outer_radius",RING_FADE_OUT_DISTANCE:"rings_fade_out_distance"},s={RING_PATTERN_LUT:"rings_pattern_lut"},l=function(){var e,t;function n(e,t,o,a){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");i(this,"patternLut",void 0),i(this,"model",void 0),i(this,"fallbackTexture",void 0),i(this,"fadeOutDistance",void 0),this.model=e,this.fadeOutDistance=o,this.patternLut=t,this.fallbackTexture=(0,r.T)(a)}return e=[{key:"setUniforms",value:function(e){e.setFloat(a.RING_INNER_RADIUS,this.model.innerRadius),e.setFloat(a.RING_OUTER_RADIUS,this.model.outerRadius),e.setFloat(a.RING_FADE_OUT_DISTANCE,this.fadeOutDistance)}},{key:"setSamplers",value:function(e){"procedural"===this.patternLut.type&&this.patternLut.lut.isReady()?e.setTexture(s.RING_PATTERN_LUT,this.patternLut.lut.getTexture()):"textured"===this.patternLut.type?e.setTexture(s.RING_PATTERN_LUT,this.patternLut.texture):n.SetEmptySamplers(e,this.fallbackTexture)}},{key:"dispose",value:function(e){"procedural"===this.patternLut.type&&e.release(this.patternLut.lut)}}],t=[{key:"NewProcedural",value:function(e,t,r,o){var i=t.get();return i.setModel(e),new n(e,{type:"procedural",lut:i},r,o)}},{key:"NewTextured",value:function(e,t,r,o){var i;switch(e.textureId){case"saturn":i=t.rings.saturn;break;case"uranus":i=t.rings.uranus}return new n(e,{type:"textured",texture:i},r,o)}},{key:"New",value:function(e,t,r,o){switch(e.type){case"procedural":return n.NewProcedural(e,t.pools.ringsPatternLut,r,o);case"textured":return n.NewTextured(e,t,r,o)}}},{key:"SetEmptyUniforms",value:function(e){e.setFloat(a.RING_INNER_RADIUS,0),e.setFloat(a.RING_OUTER_RADIUS,0),e.setFloat(a.RING_FADE_OUT_DISTANCE,0)}},{key:"SetEmptySamplers",value:function(e,t){e.setTexture(s.RING_PATTERN_LUT,t)}}],e&&o(n.prototype,e),t&&o(n,t),n}()},12044:function(e,t,n){"use strict";n.d(t,{U:()=>S});var r=n(47347),o=n(78930),i=n(92771),a=n(62325),s=n(70673),l=n(95864),c=n(77621),u=n(54205),h=n(56754),d=n(56072);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n||e):o.value}})(e,t,n||e)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return f(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(b=function(){return!!e})()}var S=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,a,f,m,y,S){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var w,T,A,P="shadow";void 0===o.M.ShadersStore["".concat(P,"FragmentShader")]&&(o.M.ShadersStore["".concat(P,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision lowp float;\n\n#define DISABLE_UNIFORMITY_ANALYSIS\n\nvarying vec2 vUV;// screen coordinates\n\nuniform sampler2D textureSampler;// the original screen texture\nuniform sampler2D depthSampler;// the depth map of the camera\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\nfloat star_radiuses[MAX_STARS];\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\nuniform bool shadowUniforms_hasRings;\nuniform bool shadowUniforms_hasClouds;\nuniform bool shadowUniforms_hasOcean;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform float rings_inner_radius;\nuniform float rings_outer_radius;\nuniform float rings_fade_out_distance;\nuniform sampler2D rings_pattern_lut;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// returns whether or not a ray hits a sphere, if yes out intersection points\n// a good explanation of how it works : https://viclw17.github.io/2018/07/16/raytracing-ray-sphere-intersection/\nbool lineIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    return true;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nbool rayIntersectsPlane(vec3 rayOrigin, vec3 rayDir, vec3 planePosition, vec3 planeNormal, float tolerance, out float t) {\n    float denom = dot(rayDir, planeNormal);\n    if (abs(denom) <= tolerance) return false;// ray is parallel to the plane\n    t = dot(planeNormal, planePosition - rayOrigin) / denom;\n    return t >= 0.0;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat mod289(float x){ return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 mod289(vec4 x){ return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 perm(vec4 x){ return mod289(((x * 34.0) + 1.0) * x); }\n\nfloat noise(float r) {\n    float a = floor(r);\n    float d = r - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = vec4(a) + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + vec4(a);\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d + o1 * (1.0 - d);\n    vec2 o4 = o3.yw * d + o3.xz * (1.0 - d);\n\n    return o4.y * d + o4.x * (1.0 - d);\n}\n\n\nfloat completeNoise(float r, int nbOctaves, float decay, float lacunarity) {\n    float totalAmplitude = 0.0;\n    float amp = 1.0;\n    float samplePointMultiplier = 1.0;\n    float value = 0.0;\n    for (int i = 0; i < nbOctaves; i++) {\n        amp /= decay;\n        samplePointMultiplier *= lacunarity;\n        totalAmplitude += amp;\n        value += amp * noise(r * samplePointMultiplier);\n    }\n    return value / totalAmplitude;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n/**\n * Returns the albedo of the rings in r,g,b and the density in a.\n * The density is a value between 0 and 1.\n */\nvec4 ringPatternAtPoint(vec3 samplePoint) {\n    vec3 samplePointPlanetSpace = samplePoint - object_position;\n\n    float distanceToPlanet = length(samplePointPlanetSpace);\n    \n    // out if not intersecting with rings and interpolation area\n    if (distanceToPlanet < rings_inner_radius || distanceToPlanet > rings_outer_radius) return vec4(0.0);\n\n    float uvX = remap(distanceToPlanet, rings_inner_radius, rings_outer_radius, 0.0, 1.0);\n    vec2 uv = vec2(uvX, 0.0);\n    \n    vec4 result = texture2D(rings_pattern_lut, uv);\n\n    // fade at the edge of the texture to avoid sampling artifacts\n    result.a *= smoothstep(0.02, 0.03, uvX);\n    result.a *= (1.0 - smoothstep(0.97, 0.98, uvX));\n\n    return result;\n}\n\nfloat sphereOccultation(vec3 rayDir, float maximumDistance) {\n    if(length(camera_position + rayDir * maximumDistance - star_positions[0]) <= star_radiuses[0] + 1.0) {\n        // The point is on the surface of the star\n        return 1.0;\n    }\n    vec3 towardLight = normalize(star_positions[0] - (camera_position + rayDir * maximumDistance));\n    float t0, t1;\n    if (lineIntersectSphere(camera_position + rayDir * maximumDistance, towardLight, object_position, object_radius, t0, t1)) {\n        if (t0 > object_radius) {\n            // there is occultation\n            vec3 closestPointToPlanetCenter = camera_position + rayDir * maximumDistance + towardLight * (t0 + t1) * 0.5;\n            float closestDistanceToPlanetCenter = length(closestPointToPlanetCenter - object_position);\n            float r01 = remap(closestDistanceToPlanetCenter, 0.0, object_radius, 0.0, 1.0);\n            return 0.01 + 0.99 * smoothstep(0.85, 1.0, r01);\n        }\n    }\n    return 1.0;\n}\n\nfloat ringOccultation(vec3 rayDir, float maximumDistance) {\n    if (!shadowUniforms_hasRings) {\n        return 1.0;\n    }\n\n    float accDensity = 0.0;\n    for (int i = 0; i < nbStars; i++) {\n        vec3 towardLight = normalize(star_positions[i] - (camera_position + rayDir * maximumDistance));\n        float t2;\n        if (rayIntersectsPlane(camera_position + rayDir * maximumDistance, towardLight, object_position, object_rotationAxis, 0.001, t2)) {\n            vec3 shadowSamplePoint = camera_position + rayDir * maximumDistance + t2 * towardLight;\n            float nearOccultationFactor = smoothstep(100e3, 150e3, t2); // fade ring shadow when close to the rings\n            accDensity += pow(ringPatternAtPoint(shadowSamplePoint).a, 0.5) * nearOccultationFactor;\n        }\n    }\n    return pow(1.0 - accDensity, 4.0) * 0.99 + 0.01;\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n\n    // closest physical point from the camera in the direction of the pixel (occlusion)\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    vec4 finalColor = screenColor;\n\n    if (maximumDistance < camera_far) {\n        // There is a solid object in front of the camera\n        // maybe it is in this planet's shadow\n        float sphereShadow = sphereOccultation(rayDir, maximumDistance);\n\n        // maybe it is in the shadow of the rings\n        float ringShadow = ringOccultation(rayDir, maximumDistance);\n\n        finalColor.rgb *= min(sphereShadow, ringShadow);\n    }\n\n    gl_FragColor = finalColor;// displaying the final color\n}");var C={hasRings:null!==a,hasClouds:null!==f,hasOcean:m},I={STAR_RADIUSES:"star_radiuses",HAS_RINGS:"shadowUniforms_hasRings",HAS_CLOUDS:"shadowUniforms_hasClouds",HAS_OCEAN:"shadowUniforms_hasOcean"},E=g(Object.values(u.A)).concat(g(Object.values(d.T)),g(Object.values(c.o)),g(Object.values(l.eI)),g(Object.values(I))),R=g(Object.values(h.R)).concat(g(Object.values(l.aC)));return w=n,T=["".concat(e.name,"ShadowPostProcess"),P,E,R,1,null,i.g.BILINEAR_SAMPLINGMODE,S.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],w=v(w),p(A=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,b()?Reflect.construct(w,T||[],v(this).constructor):w.apply(this,T)),"shadowUniforms",void 0),p(A,"ringsUniforms",void 0),p(A,"activeCamera",null),p(A,"emptyTexture",void 0),A.shadowUniforms=C,A.ringsUniforms=a,A.emptyTexture=(0,s.T)(S),A.onActivateObservable.add(function(e){A.activeCamera=e}),A.onApplyObservable.add(function(n){if(null===A.activeCamera)throw Error("Camera is null");(0,c.b)(n,A.activeCamera),(0,d.G)(n,y.map(function(e){return e.getLight()})),(0,u.$)(n,e,t),n.setFloatArray(I.STAR_RADIUSES,y.map(function(e){return e.getBoundingRadius()})),n.setBool(I.HAS_RINGS,C.hasRings),n.setBool(I.HAS_CLOUDS,C.hasClouds),n.setBool(I.HAS_OCEAN,C.hasOcean),null===A.ringsUniforms?(l.zl.SetEmptyUniforms(n),l.zl.SetEmptySamplers(n,A.emptyTexture)):(A.ringsUniforms.setUniforms(n),A.ringsUniforms.setSamplers(n)),(0,h.C)(n,A.activeCamera,S)}),A}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&y(n,e),t=[{key:"dispose",value:function(e){m(v(n.prototype),"dispose",this).call(this,e),this.emptyTexture.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(a.w)},77621:function(e,t,n){"use strict";n.d(t,{b:()=>o,o:()=>r});var r={CAMERA_POSITION:"camera_position",CAMERA_PROJECTION:"camera_projection",CAMERA_INVERSE_PROJECTION:"camera_inverseProjection",CAMERA_VIEW:"camera_view",CAMERA_INVERSE_VIEW:"camera_inverseView",CAMERA_NEAR:"camera_near",CAMERA_FAR:"camera_far",CAMERA_FOV:"camera_fov"};function o(e,t){e.setVector3(r.CAMERA_POSITION,t.globalPosition),e.setMatrix(r.CAMERA_PROJECTION,t.getProjectionMatrix()),e.setMatrix(r.CAMERA_INVERSE_PROJECTION,t.getProjectionMatrix().clone().invert()),e.setMatrix(r.CAMERA_VIEW,t.getViewMatrix()),e.setMatrix(r.CAMERA_INVERSE_VIEW,t.getViewMatrix().clone().invert()),e.setFloat(r.CAMERA_NEAR,t.minZ),e.setFloat(r.CAMERA_FAR,t.maxZ),e.setFloat(r.CAMERA_FOV,t.fov)}},54205:function(e,t,n){"use strict";n.d(t,{$:()=>o,A:()=>r});var r={OBJECT_POSITION:"object_position",OBJECT_RADIUS:"object_radius",OBJECT_ROTATION_AXIS:"object_rotationAxis",OBJECT_SCALING_DETERMINANT:"object_scaling_determinant"};function o(e,t,n){e.setVector3(r.OBJECT_POSITION,t.getAbsolutePosition()),e.setFloat(r.OBJECT_RADIUS,n),e.setVector3(r.OBJECT_ROTATION_AXIS,t.up),e.setFloat(r.OBJECT_SCALING_DETERMINANT,t.scalingDeterminant)}},56754:function(e,t,n){"use strict";n.d(t,{C:()=>o,R:()=>r});var r={TEXTURE_SAMPLER:"textureSampler",DEPTH_SAMPLER:"depthSampler"};function o(e,t,n){var o=Object.values(n._depthRenderer).find(function(e){return e.getDepthMap().activeCamera===t});if(void 0===o)throw console.log("Depth renderer",n._depthRenderer),Error("Depth renderer not found for camera: "+t.name);e.setTexture(r.DEPTH_SAMPLER,o.getDepthMap())}},56072:function(e,t,n){"use strict";n.d(t,{G:()=>i,T:()=>o});var r=n(53843),o={STAR_POSITIONS:"star_positions",STAR_COLORS:"star_colors",NB_STARS:"nbStars"};function i(e,t){if(e.setInt(o.NB_STARS,t.length),0===t.length){e.setArray3(o.STAR_POSITIONS,[0,0,0]),e.setArray3(o.STAR_COLORS,[1,1,1]);return}e.setArray3(o.STAR_POSITIONS,(0,r.Wo)(t.map(function(e){return e.getAbsolutePosition()}))),e.setArray3(o.STAR_COLORS,(0,r.A)(t.map(function(e){return e.diffuse})))}},65726:function(e,t,n){"use strict";n.d(t,{N:()=>l});var r=n(92771);function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(s=function(){return!!e})()}var l=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,a,l){var c,u,h;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");if(null===l.activeCamera)throw Error("no camera");return u=t,h=["".concat(e.name,"VolumetricLight"),1,null,e,100,r.g.BILINEAR_SAMPLINGMODE,l.getEngine(),!1,l],u=i(u),(c=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,s()?Reflect.construct(u,h||[],i(this).constructor):u.apply(this,h)))._scene=l,c.exposure=n.exposure,c.decay=n.decay,c.excludedMeshes=function(e){if(Array.isArray(e))return o(e)}(a)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||function(e,t){if(e){if("string"==typeof e)return o(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}}(a)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),c}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e),t}(n(35261).g)},29007:function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{e:()=>o});var o=function e(){if(!(this instanceof e))throw TypeError("Cannot call a class as a function");r(this,"exposure",.26),r(this,"decay",.95)}},2047:function(e,t,n){"use strict";n.d(t,{Z:()=>c,b:()=>l});var r=n(36801),o=n(45063),i=n(61741),a=n(85303);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");s(this,"type",void 0),s(this,"relativeRange",void 0),s(this,"size",void 0),s(this,"quality",void 0),this.type=e.type,this.size=e.size,this.quality=e.quality;var n=(0,o.q)(e);this.relativeRange=n.relativeRange}return e=[{key:"serialize",value:function(){return{type:this.type,size:this.size,quality:this.quality}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function c(e,t,n){var o,s=n.type;switch(s){case i.T.TELLURIC_PLANET:case i.T.TELLURIC_SATELLITE:case i.T.GAS_PLANET:case i.T.MANDELBULB:case i.T.JULIA_SET:case i.T.MANDELBOX:case i.T.SIERPINSKI_PYRAMID:case i.T.MENGER_SPONGE:case i.T.DARK_KNIGHT:case i.T.STAR:o=1;break;case i.T.NEUTRON_STAR:o=7e4;break;case i.T.BLACK_HOLE:o=20;break;default:(0,a.dr)(s)}var l=o*e.relativeRange;return r.Pq.DistanceSquared(t,n.getTransform().position)<Math.pow(n.getBoundingRadius()*l,2)}},57719:function(e,t,n){"use strict";n.d(t,{J:()=>i});var r=n(18511);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"type",void 0),o(this,"fuelPerSecond",void 0),o(this,"size",void 0),o(this,"quality",void 0),this.type=e.type,this.size=e.size,this.quality=e.quality;var n=(0,r.k)(e);this.fuelPerSecond=n.fuelPerSecond}return e=[{key:"serialize",value:function(){return{type:this.type,size:this.size,quality:this.quality}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},16311:function(e,t,n){"use strict";n.d(t,{f:()=>i});var r=n(28831);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"type",void 0),o(this,"currentFuel",void 0),o(this,"maxFuel",void 0),o(this,"size",void 0),o(this,"quality",void 0),this.type=e.type;var n=(0,r.x)(e);this.maxFuel=n.maxFuel,this.currentFuel=n.maxFuel*e.currentFuel01,this.size=e.size,this.quality=e.quality}return e=[{key:"fill",value:function(e){var t=Math.min(e,this.maxFuel-this.currentFuel);return this.currentFuel+=t,t}},{key:"burnFuel",value:function(e){if(e>this.currentFuel)throw Error("Not enough fuel in the tank.");this.currentFuel-=e}},{key:"getCurrentFuel",value:function(){return this.currentFuel}},{key:"getMaxFuel",value:function(){return this.maxFuel}},{key:"serialize",value:function(){return{type:"fuelTank",size:this.size,quality:this.quality,currentFuel01:this.currentFuel/this.maxFuel}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},25157:function(e,t,n){"use strict";n.d(t,{Z:()=>i});var r=n(95293);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"type",void 0),o(this,"size",void 0),o(this,"quality",void 0),o(this,"maxSpeed",void 0),this.type=e.type,this.size=e.size,this.quality=e.quality;var n=(0,r.M)(e);this.maxSpeed=n.maxSpeed}return e=[{key:"serialize",value:function(){return{type:this.type,size:this.size,quality:this.quality}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},93981:function(e,t,n){"use strict";n.d(t,{f:()=>s});var r=n(54741),o=n(32648),i=n(13298);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){var e;function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(this instanceof t))throw TypeError("Cannot call a class as a function");a(this,"type",void 0),a(this,"defaultThrottle",.5),a(this,"throttle",1),a(this,"maxWarpSpeed",void 0),a(this,"rangeLY",void 0),a(this,"maxTargetSpeed",0),a(this,"currentSpeed",0),a(this,"state",0),a(this,"size",void 0),a(this,"quality",void 0),this.type=e.type,this.size=e.size,this.quality=e.quality;var o=(0,r.Y)(e);this.maxWarpSpeed=o.maxSpeed,this.rangeLY=o.rangeLy,this.state=+!!n}return e=[{key:"serialize",value:function(){return{type:this.type,size:this.size,quality:this.quality}}},{key:"enable",value:function(){this.state=1,this.throttle=this.defaultThrottle}},{key:"disengage",value:function(){this.state=2}},{key:"emergencyStop",value:function(){this.disable()}},{key:"disable",value:function(){this.state=0,this.maxTargetSpeed=0,this.throttle=0,this.currentSpeed=0}},{key:"isEnabled",value:function(){return 1===this.state}},{key:"isDisabled",value:function(){return 0===this.state}},{key:"isDisengaging",value:function(){return 2===this.state}},{key:"updateMaxTargetSpeed",value:function(e,n){var r=Math.max(0,e-n),o=1e4*Math.pow(.1*r/1e4,1.2);return this.maxTargetSpeed=(0,i.qE)(Math.max(1e3*r/1e4,o),t.MIN_WARP_SPEED,this.maxWarpSpeed),this.maxTargetSpeed}},{key:"increaseThrottle",value:function(e){this.throttle=(0,i.qE)(this.throttle+e,0,1)}},{key:"getWarpSpeed",value:function(){return this.currentSpeed}},{key:"getThrottle",value:function(){return this.throttle}},{key:"updateWarpDriveSpeed",value:function(e){this.currentSpeed=this.currentSpeed<this.maxTargetSpeed?(0,o.aJ)(this.currentSpeed,this.throttle*this.maxTargetSpeed,.1,e):(0,o.aJ)(this.currentSpeed,this.throttle*this.maxTargetSpeed,.6,e),this.currentSpeed=(0,i.qE)(this.currentSpeed,t.MIN_WARP_SPEED,this.maxWarpSpeed)}},{key:"update",value:function(e,n,r){switch(this.state){case 2:this.maxTargetSpeed*=.9,this.currentSpeed*=.9,this.maxTargetSpeed<=t.MIN_WARP_SPEED&&this.currentSpeed<=t.MIN_WARP_SPEED&&this.disable();break;case 1:this.updateMaxTargetSpeed(e,n),this.updateWarpDriveSpeed(r);break;case 0:this.maxTargetSpeed=0,this.currentSpeed=0,this.throttle=0}}},{key:"getFuelConsumptionRate",value:function(e){return .15*Math.pow((0,i.Ew)(e,t.MIN_WARP_SPEED,this.maxWarpSpeed,0,1)-.75,2)+.08}},{key:"getHyperJumpFuelConsumption",value:function(e){return 2*e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();a(s,"MIN_WARP_SPEED",3e4)},53392:function(e,t,n){"use strict";n.d(t,{u:()=>i});var r=n(36801),o=n(61741);function i(e,t,n){var i=e.getAbsolutePosition();if(r.Pq.Distance(i,n.getTransform().getAbsolutePosition())<1.03*n.getBoundingRadius())return!1;if(n.type!==o.T.GAS_PLANET&&n.type!==o.T.TELLURIC_PLANET&&n.type!==o.T.STAR&&n.type!==o.T.NEUTRON_STAR)return!0;var a=n.asteroidField;if(null===a)return!0;var s=n.getTransform().getWorldMatrix().clone().invert(),l=r.Pq.TransformCoordinates(i,s),c=r.Pq.TransformNormal(e.getDirection(r.Pq.Forward(e.getScene().useRightHandedSystem)),s),u=l.y,h=Math.sqrt(l.x*l.x+l.z*l.z),d=l.add(c.scale(.5*t)),f=d.y,p=Math.sqrt(d.x*d.x+d.z*d.z),m=a.innerRadius,v=a.outerRadius,y=h>m&&h<v,g=Math.abs(u)<a.patchThickness/2&&y,b=Math.sign(u)!==Math.sign(f)&&(p>m&&p<v||y);return!g&&!b}},43328:function(e,t,n){"use strict";n.d(t,{l:()=>M});var r=n(11569),o=n(82060),i=n(36801),a=n(36044),s=n(48462),l=n(28468),c=n(13997),u=n(13298);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");h(this,"elapsedSeconds",0),h(this,"duration",void 0),h(this,"intensity",void 0),h(this,"camera",void 0),this.camera=e,this.intensity=n,this.duration=r}return e=[{key:"sumOfSines",value:function(e,t,n){for(var r=0,o=0;o<5;o++)r+=Math.sin(2*Math.PI*t*e*Math.pow(2,o)+n)/Math.pow(2,o);return r}},{key:"update",value:function(e){if(!this.isFinished()){this.elapsedSeconds+=e;var t=(0,u.qE)(this.elapsedSeconds/this.duration,0,1);this.camera.alpha+=this.sumOfSines(t,10,0)*this.intensity,this.camera.beta+=this.sumOfSines(t,10,.38)*this.intensity}}},{key:"reset",value:function(){this.elapsedSeconds=0}},{key:"isFinished",value:function(){return this.elapsedSeconds>=this.duration}},{key:"getProgress",value:function(){return this.elapsedSeconds/this.duration}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),f=n(47402),p=n(68739);function m(e,t,n,r,o){var i=new p.vm;i.setEasingMode(p.KA.EASINGMODE_EASEINOUT),f.X5.CreateAndStartAnimation("quickAnimation",e,t,o,120,n,r,f.X5.ANIMATIONLOOPMODE_CONSTANT,i)}var v=n(90160),y=n(9323),g=n(3211),b=n(12577),S=n(89901),w=n(95369),T=n(78706),A=n(32648),P=n(53392),C=n(53314),I=n(84369);function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function R(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function N(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){R(i,r,o,a,s,"next",e)}function s(e){R(i,r,o,a,s,"throw",e)}a(void 0)})}}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var M=function(){var e,t;function n(e,t,u,h){var f=this;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");L(this,"spaceship",void 0),L(this,"thirdPersonCameraDefaultRadius",60),L(this,"thirdPersonCameraDefaultAlpha",1.57),L(this,"thirdPersonCameraDefaultBeta",3.14/2.2),L(this,"thirdPersonCamera",void 0),L(this,"thirdPersonCameraTransform",void 0),L(this,"firstPersonCamera",void 0),L(this,"cameraShakeAnimation",void 0),L(this,"closestLandableFacility",null),L(this,"targetFov",l.S0.ToRadians(60)),L(this,"onToggleWarpDrive",new s.cP),L(this,"onCompleteLanding",new s.cP),L(this,"rotationInertia",i.Pq.Zero()),L(this,"toggleWarpDriveHandler",void 0),L(this,"landingHandler",void 0),L(this,"emitLandingRequestHandler",void 0),L(this,"throttleToZeroHandler",void 0),L(this,"resetCameraHandler",void 0),L(this,"tts",void 0),L(this,"soundPlayer",void 0),this.spaceship=e,this.soundPlayer=u,this.tts=h,this.firstPersonCamera=new o.S("shipFirstPersonCamera",i.Pq.Zero(),t),this.firstPersonCamera.parent=this.getTransform(),this.firstPersonCamera.position=new i.Pq(0,1.5,8),this.thirdPersonCameraTransform=new a.VR0("thirdPersonCameraTransform",t),this.thirdPersonCamera=new r.Lq("shipThirdPersonCamera",this.thirdPersonCameraDefaultAlpha,this.thirdPersonCameraDefaultBeta,this.thirdPersonCameraDefaultRadius,i.Pq.Zero(),t),this.thirdPersonCamera.parent=this.thirdPersonCameraTransform,this.thirdPersonCamera.lowerRadiusLimit=1.2*Math.max(this.spaceship.boundingExtent.x,this.spaceship.boundingExtent.y,this.spaceship.boundingExtent.z)/2,this.thirdPersonCamera.upperRadiusLimit=500,this.cameraShakeAnimation=new d(this.thirdPersonCamera,.006,1),this.toggleWarpDriveHandler=function(){return N(function(){var e,t,n,r,o;return x(this,function(a){switch(a.label){case 0:if(null===(t=(e=this.getSpaceship()).getInternals().getWarpDrive()))return[2];if(n=e.getNearestOrbitalObject(),t.isDisabled()&&null!==n&&!(0,P.u)(e.getTransform(),0,n))return h.sayNow(c.yT.CHARLOTTE,c.bm.CANNOT_ENGAGE_WARP_DRIVE),[2];return[4,(0,w.t)()];case 1:return r=a.sent(),e.toggleWarpDrive(),t.isEnabled()?(h.sayNow(c.yT.CHARLOTTE,c.bm.ENGAGING_WARP_DRIVE),this.cameraShakeAnimation.reset(),e.setMainEngineThrottle(0)):(h.sayNow(c.yT.CHARLOTTE,c.bm.WARP_DRIVE_DISENGAGED),this.cameraShakeAnimation.reset(),null!==this.closestLandableFacility&&5e5>i.Pq.Distance(this.getTransform().getAbsolutePosition(),this.closestLandableFacility.getTransform().getAbsolutePosition())&&(o=(0,v.hg)(I._.map.emitLandingRequest,r).join(", "),(0,b.UI)(b.I9.SPACE_STATION,b.yg.INFO,"Don't forget to send a landing request with ".concat(o," before approaching the facility"),5e3,u))),[2]}})}).call(f)},I._.map.toggleWarpDrive.on("complete",this.toggleWarpDriveHandler),this.landingHandler=function(){return N(function(){var e,t,n,r,o;return x(this,function(a){switch(a.label){case 0:if(!(null!==(t=(e=this.getSpaceship()).getInternals().getWarpDrive())&&t.isEnabled()))return[3,2];return[4,(0,w.t)()];case 1:return n=a.sent(),r=(0,v.hg)(I._.map.toggleWarpDrive,n),(0,b.UI)(b.I9.SPACESHIP,b.yg.ERROR,"Cannot land while warp drive is enabled. You can use ".concat(r.join(", ")," to toggle your warp drive."),5e3,u),[2];case 2:if(null===(o=e.getClosestWalkableObject()))return[2];if(i.Pq.Distance(this.getTransform().getAbsolutePosition(),o.getTransform().getAbsolutePosition())>o.getBoundingRadius()+1e5)return(0,b.UI)(b.I9.SPACESHIP,b.yg.ERROR,"Too high to land",2e3,u),[2];return e.engageSurfaceLanding(o.getTransform()),[2]}})}).call(f)},I._.map.landing.on("complete",this.landingHandler),this.emitLandingRequestHandler=function(){var e=f.getSpaceship();if(!(e.isLanded()||e.isLanding())&&null!==f.closestLandableFacility){var t=f.closestLandableFacility.getLandingPadManager().handleLandingRequest({minimumPadSize:S.a.SMALL});if(null===t)return void(0,b.UI)(b.I9.SPACE_STATION,b.yg.ERROR,"Landing request rejected",2e3,u);h.enqueueSay(c.yT.CHARLOTTE,c.bm.LANDING_REQUEST_GRANTED),(0,b.UI)(b.I9.SPACE_STATION,b.yg.SUCCESS,"Landing request granted. Proceed to pad ".concat(t.getPadNumber()),3e4,u),e.engageLandingOnPad(t)}},I._.map.emitLandingRequest.on("complete",this.emitLandingRequestHandler),this.throttleToZeroHandler=function(){var e=f.getSpaceship();e.setMainEngineThrottle(0);var t=e.getInternals().getWarpDrive();null!==t&&t.increaseThrottle(-t.getThrottle())},I._.map.throttleToZero.on("complete",this.throttleToZeroHandler),this.resetCameraHandler=function(){m(f.thirdPersonCamera,"alpha",f.thirdPersonCamera.alpha,f.thirdPersonCameraDefaultAlpha,200),m(f.thirdPersonCamera,"beta",f.thirdPersonCamera.beta,f.thirdPersonCameraDefaultBeta,200),m(f.thirdPersonCamera,"radius",f.thirdPersonCamera.radius,f.thirdPersonCameraDefaultRadius,200),m(f.thirdPersonCamera,"target",f.thirdPersonCamera.target,i.Pq.Zero(),200)},I._.map.resetCamera.on("complete",this.resetCameraHandler),this.setSpaceship(e)}return e=[{key:"getTransform",value:function(){return this.getSpaceship().getTransform()}},{key:"shouldLockPointer",value:function(){return!1}},{key:"getActiveCamera",value:function(){return this.thirdPersonCamera}},{key:"getCameras",value:function(){return[this.thirdPersonCamera,this.firstPersonCamera]}},{key:"setClosestLandableFacility",value:function(e){this.closestLandableFacility=e}},{key:"getClosestLandableFacility",value:function(){return this.closestLandableFacility}},{key:"update",value:function(e){var t,n,r=this.getSpaceship();r.update(e),this.cameraShakeAnimation.isFinished()||this.cameraShakeAnimation.update(e);var o=(u=I._.map.rollPitch.value,function(e){if(Array.isArray(e))return e}(u)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(u,2)||function(e,t){if(e){if("string"==typeof e)return E(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}}(u,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],s=o[1];(I._.map.ignorePointer.value>0||r.isAutoPiloted())&&(a*=0,s*=0);var c=r.getInternals().getWarpDrive();if(null===c||c.isDisabled()){if(r.increaseMainEngineThrottle(e*I._.map.throttle.value),0!==I._.map.upDown.value){if(r.isLanded()){var u,h,d=r.getTargetLandingPad();null!==d&&(null==(h=this.closestLandableFacility)||h.getLandingPadManager().cancelLandingRequest(d)),r.takeOff()}else if(r.isLanding()){var f,p=r.getTargetLandingPad();null!==p&&(null==(f=this.closestLandableFacility)||f.getLandingPadManager().cancelLandingRequest(p)),r.cancelLanding()}r.aggregate.body.applyForce(this.getTransform().up.scale(98*I._.map.upDown.value),r.aggregate.body.getObjectCenterWorld())}if(!r.isLanded()){var m=this.getTransform().forward,v=this.getTransform().up,g=this.getTransform().right,b=r.aggregate.body.getAngularVelocity(),S=i.Pq.Zero(),w=b.dot(m),T=this.spaceship.maxRollSpeed*a;S.addInPlace(m.scale(.7*(T-w)));var P=b.dot(v),C=-this.spaceship.maxYawSpeed*a;S.addInPlace(v.scale(.7*(C-P)));var R=b.dot(g),N=this.spaceship.maxPitchSpeed*s;S.addInPlace(g.scale(.7*(N-R))),r.aggregate.body.applyAngularImpulse(S)}}else c.increaseThrottle(.5*e*I._.map.throttle.value),this.rotationInertia.x=(0,A.aJ)(this.rotationInertia.x,a,.07,e),this.rotationInertia.y=(0,A.aJ)(this.rotationInertia.y,s,.07,e),(0,y.CL)(this.getTransform(),this.spaceship.maxRollSpeed*this.rotationInertia.x*e),(0,y.oh)(this.getTransform(),-this.spaceship.maxYawSpeed*this.rotationInertia.x*e),(0,y.H7)(this.getTransform(),this.spaceship.maxPitchSpeed*this.rotationInertia.y*e),this.spaceship.warpTunnel.applyForce(new i.Pq(this.rotationInertia.x,this.rotationInertia.y,0).scale(-1));return this.thirdPersonCameraTransform.position=null===this.getTransform().parent?this.getTransform().position:this.getTransform().getAbsolutePosition(),this.thirdPersonCameraTransform.rotationQuaternion=(0,A.f5)(this.getTransform().absoluteRotationQuaternion,null!=(t=this.thirdPersonCameraTransform.rotationQuaternion)?t:i.PT.Identity(),.3,e,null!=(n=this.thirdPersonCameraTransform.rotationQuaternion)?n:i.PT.Identity()),this.thirdPersonCameraTransform.computeWorldMatrix(!0),this.targetFov=l.S0.ToRadians(60+10*r.getThrottle()),this.thirdPersonCamera.fov=(0,A.aJ)(this.thirdPersonCamera.fov,this.targetFov,.08,e),this.getActiveCamera().getViewMatrix(!0),this.getTransform().getAbsolutePosition()}},{key:"syncCameraTransform",value:function(){var e;null==(e=this.thirdPersonCameraTransform.rotationQuaternion)||e.copyFrom(this.getTransform().absoluteRotationQuaternion)}},{key:"reset",value:function(){this.resetCameraHandler(),this.cameraShakeAnimation.reset(),this.closestLandableFacility=null}},{key:"setSpaceship",value:function(e){var t=this;this.spaceship=e,this.thirdPersonCamera.parent=this.thirdPersonCameraTransform,this.firstPersonCamera.parent=this.getTransform(),this.spaceship.onFuelScoopStart.add(function(){t.tts.enqueueSay(c.yT.CHARLOTTE,c.bm.FUEL_SCOOPING)}),this.spaceship.onFuelScoopEnd.add(function(){t.tts.enqueueSay(c.yT.CHARLOTTE,c.bm.FUEL_SCOOPING_COMPLETE)}),this.spaceship.onLandingObservable.add(function(){return N(function(){var e,t;return x(this,function(n){switch(n.label){case 0:return[4,(0,w.t)()];case 1:return e=n.sent(),this.tts.enqueueSay(c.yT.CHARLOTTE,c.bm.LANDING_COMPLETE),this.getSpaceship().isLandedAtFacility()||(t=(0,v.hg)(g.n.map.toggleSpaceShipCharacter,e).join(", "),(0,b.UI)(b.I9.SPACESHIP,b.yg.INFO,T.A.t("notifications:landingComplete",{bindingsString:t}),5e3,this.soundPlayer)),[2]}})}).call(t)}),this.spaceship.onPlanetaryLandingEngaged.add(function(){(0,b.UI)(b.I9.SPACESHIP,b.yg.INFO,T.A.t("notifications:landingSequenceEngaged"),5e3,t.soundPlayer),t.tts.enqueueSay(c.yT.CHARLOTTE,c.bm.INITIATING_PLANETARY_LANDING)}),this.spaceship.onLandingCancelled.add(function(){(0,b.UI)(b.I9.SPACESHIP,b.yg.INFO,T.A.t("notifications:landingCancelled"),5e3,t.soundPlayer)}),this.spaceship.onTakeOff.add(function(){(0,b.UI)(b.I9.SPACESHIP,b.yg.INFO,T.A.t("notifications:takeOffSuccess"),2e3,t.soundPlayer)}),this.spaceship.onAutoPilotEngaged.add(function(){(0,b.UI)(b.I9.SPACESHIP,b.yg.INFO,T.A.t("notifications:autoPilotEngaged"),3e4,t.soundPlayer)}),this.spaceship.onWarpDriveDisabled.add(function(e){e&&t.tts.sayNow(c.yT.CHARLOTTE,c.bm.WARP_DRIVE_EMERGENCY_SHUT_DOWN),t.onToggleWarpDrive.notifyObservers(!1)}),this.spaceship.onWarpDriveEnabled.add(function(){t.onToggleWarpDrive.notifyObservers(!0)}),this.spaceship.onLandingObservable.add(function(){t.onCompleteLanding.notifyObservers()})}},{key:"getSpaceship",value:function(){return this.spaceship}},{key:"dispose",value:function(e){this.onToggleWarpDrive.clear(),this.onCompleteLanding.clear(),I._.map.toggleWarpDrive.off("complete",this.toggleWarpDriveHandler),I._.map.landing.off("complete",this.landingHandler),I._.map.emitLandingRequest.off("complete",this.emitLandingRequestHandler),I._.map.throttleToZero.off("complete",this.throttleToZeroHandler),I._.map.resetCamera.off("complete",this.resetCameraHandler),this.spaceship.dispose(e),this.thirdPersonCamera.dispose(),this.firstPersonCamera.dispose()}}],t=[{key:"CreateDefault",value:function(e,t,r,o){return new n(C.Z.CreateDefault(e,t,o),e,o,r)}}],e&&O(n.prototype,e),t&&O(n,t),n}()},84369:function(e,t,n){"use strict";n.d(t,{_:()=>E});var r=n(54060),o=n(15524),i=n(86283),a=n(31272),s=n(16533);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var c=a._.KEYBOARD,u=a._.POINTER,h=new r.A({bindings:[c.getControl("KeyL")]}),d=new i.A(h),f=new i.A(new r.A({bindings:[c.getControl("keyY")]})),p=new o.hn({positive:c.getControl("KeyR"),negative:c.getControl("KeyF")}),m=new r.A({bindings:[p]}),v=new o.hn({positive:c.getControl("KeyW"),negative:c.getControl("KeyS")}),y=new r.A({bindings:[v]}),g=new r.A({bindings:[u.getControl("position")],processors:[function(e){var t=function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,2)||function(e,t){if(e){if("string"==typeof e)return l(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=t[0],r=t[1];return n/=window.innerWidth,r/=window.innerHeight,r=2*r-1,n=(2*n-1)*(window.innerWidth/Math.max(window.innerWidth,window.innerHeight)),r*=window.innerHeight/Math.max(window.innerWidth,window.innerHeight),[n=Math.sign(n)*Math.pow(Math.max(0,Math.abs(n)-.1),2),r=Math.sign(r)*Math.pow(Math.max(0,Math.abs(r)-.1),2)]}]}),b=new r.A({bindings:[c.getControl("KeyH")]}),S=new i.A(b),w=new r.A({bindings:[c.getControl("ShiftLeft")]}),T=new r.A({bindings:[c.getControl("KeyX")]}),A=new i.A(T),P=new i.A(new r.A({bindings:[c.getControl("Numpad1")]})),C=new i.A(new r.A({bindings:[c.getControl("Numpad2")]})),I=new i.A(new r.A({bindings:[c.getControl("Numpad0")]})),E=new s.X("SpaceShipInputs",{landing:d,emitLandingRequest:f,upDown:m,throttle:y,rollPitch:g,toggleWarpDrive:S,ignorePointer:w,throttleToZero:A,previousMission:P,nextMission:C,resetCamera:I});E.setEnabled(!1)},53314:function(e,t,n){"use strict";n.d(t,{Z:()=>Z});var r,o=n(74334),i=n(36801),a=n(48462),s=n(52632),l=n(80465),c=n(92327),u=n(59450),h=n(61741),d=n(85630),f=n(40995),p=n(7661),m=n(76448),v=n(83266),y=n(9323),g=n(13679),b=n(53392),S=n(1831),w=n(53843);function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=((r={})[r.LANDING_PAD=0]="LANDING_PAD",r[r.CELESTIAL_BODY=1]="CELESTIAL_BODY",r),P=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");T(this,"physicsEngine",void 0),T(this,"target",null),T(this,"actionPlan",null),T(this,"currentActionIndex",0),T(this,"aggregate",void 0),T(this,"transform",void 0),T(this,"raycastResult",new S.G),T(this,"boundingExtent",void 0),T(this,"elapsedSeconds",0),T(this,"maxSecondsPerPlan",90),this.aggregate=e,this.transform=e.transformNode,this.physicsEngine=n;var r=this.transform.getHierarchyBoundingVectors();this.boundingExtent=r.max.subtract(r.min)}return e=[{key:"getTarget",value:function(){return this.target}},{key:"setTarget",value:function(e){if(this.target=e,this.currentActionIndex=0,this.elapsedSeconds=0,null===this.target){this.actionPlan=null;return}switch(this.target.kind){case 0:this.actionPlan=this.createLandingPadActionPlan(this.target.landingPad);break;case 1:this.actionPlan=this.createSurfaceActionPlan(this.target.celestialBody)}}},{key:"createLandingPadActionPlan",value:function(e){var t=this;return[{getTargetTransform:function(){return{position:e.getTransform().getAbsolutePosition().add(e.getTransform().up.scale(50)),rotation:e.getTransform().absoluteRotationQuaternion}},maxVelocityAtTarget:{linear:3,rotation:.1},maxVelocity:{linearY:20,rotation:.5},tolerance:{position:1.5,rotation:.1}},{getTargetTransform:function(){return{position:e.getTransform().getAbsolutePosition().add(e.getTransform().up.scale((e.getPadHeight()+t.boundingExtent.y)/2)),rotation:e.getTransform().absoluteRotationQuaternion}},maxVelocityAtTarget:{linear:3,rotation:.1},maxVelocity:{linearY:5,rotation:.5},tolerance:{position:.5,rotation:.1}}]}},{key:"createSurfaceActionPlan",value:function(e){var t=this;return[{getTargetTransform:function(){var n=t.transform.getAbsolutePosition(),r=e.position.subtract(n).normalize(),o=n.add(r.scale(-100)),a=n.add(r.scale(500));if(t.physicsEngine.raycastToRef(o,a,t.raycastResult,{collideWith:g.H.ENVIRONMENT}),!t.raycastResult.hasHit)return null;var s=t.raycastResult.hitNormalWorld,l=t.raycastResult.hitPointWorld.add(s.scale(t.boundingExtent.y/2)),c=t.transform.up;if(c.equalsWithEpsilon(s))return{position:l,rotation:t.transform.absoluteRotationQuaternion};var u=i.Pq.Cross(c,s),h=Math.acos(i.Pq.Dot(c,s));return{position:l,rotation:i.PT.RotationAxis(u,h).multiplyInPlace(t.transform.absoluteRotationQuaternion)}},maxVelocityAtTarget:{linear:3,rotation:.1},maxVelocity:{linearY:5,rotation:.5},tolerance:{position:5,rotation:.2}}]}},{key:"update",value:function(e){if(null===this.target||null===this.actionPlan)return 8;var t,n=this.actionPlan.at(this.currentActionIndex);if(void 0===n)return 2;this.elapsedSeconds+=e;var r=n.getTargetTransform();if(null===r)return 16;var o=r.position,a=r.rotation,s=n.tolerance,l=s.position,c=s.rotation,u=n.maxVelocityAtTarget,h=u.linear,d=u.rotation,f=n.maxVelocity,p=f.linearY,m=f.rotation,v=this.transform.getAbsolutePosition(),y=this.transform.absoluteRotationQuaternion,g=this.aggregate.body.getLinearVelocity(),b=this.aggregate.body.getAngularVelocity(),S=i.Pq.Distance(o,v),T=o.subtract(v).normalize(),A=(0,w.pv)(y,a),P=(0,w.K7)(A);if(S<=l&&Math.abs(P)<=c&&g.length()<h&&b.length()<d)return this.currentActionIndex===this.actionPlan.length-1?(this.setTarget(null),2):(this.currentActionIndex++,1);var C=null!=(t=this.aggregate.body.getMassProperties().mass)?t:1,I=this.transform.right,E=this.transform.up,R=this.transform.forward,N=T.dot(I)*p*2,O=T.dot(E)*p,L=T.dot(R)*p*2,x=g.dot(I),M=g.dot(E),_=g.dot(R);this.aggregate.body.applyForce(I.scale(C*(N-x)),v),this.aggregate.body.applyForce(E.scale(C*(O-M)),v),this.aggregate.body.applyForce(R.scale(C*(L-_)),v);var k=g.dot(T),D=g.subtract(T.scale(k));this.aggregate.body.applyForce(D.scale(-5*C),v);var j=(0,w.pv)(y,a),F=(0,w.K7)(j),U=(0,w.mL)(j),G=this.aggregate.body.getAngularVelocity(),B=G.dot(U),H=Math.sign(F)*Math.min(m,.4*Math.sqrt(Math.abs(F)));this.aggregate.body.applyAngularImpulse(U.scale(10*(H-B)));var Y=G.subtract(U.scale(B));return(this.aggregate.body.applyAngularImpulse(Y.scale(-2)),this.elapsedSeconds>this.maxSecondsPerPlan)?(this.setTarget(null),4):1}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),C=n(2047),I=n(57719),E=n(16311),R=n(25157),N=n(93981);function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");L(this,"maxSize",void 0),L(this,"types",void 0),L(this,"component",null),this.maxSize=e,this.types=t}return e=[{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){return(null===e||!!this.types.includes(e.type))&&(null===e||!(e.size>this.maxSize))&&(this.component=e,!0)}}],t=[{key:"NewWarpDrive",value:function(e){return new n(e,["warpDrive"])}},{key:"NewThrusters",value:function(e){return new n(e,["thrusters"])}},{key:"NewFuelTank",value:function(e){return new n(e,["fuelTank"])}},{key:"NewDiscoveryScanner",value:function(e){return new n(e,["discoveryScanner"])}},{key:"NewFuelScoop",value:function(e){return new n(e,["fuelScoop"])}},{key:"NewOptional",value:function(e){return new n(e,["fuelTank","discoveryScanner","fuelScoop"])}}],e&&O(n.prototype,e),t&&O(n,t),n}();function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");_(this,"type",void 0),_(this,"primary",void 0),_(this,"optionals",void 0),this.type=e.type;var r=e.components,o=r.primary,i=r.optional;e.type===u.D0.WANDERER&&(this.primary={warpDrive:x.NewWarpDrive(3),thrusters:x.NewThrusters(3),fuelTank:x.NewFuelTank(2)},this.optionals=[x.NewOptional(3),x.NewOptional(2),x.NewOptional(2)]),null!==o.warpDrive&&(this.primary.warpDrive.setComponent(new N.f(o.warpDrive))||n.add(o.warpDrive)),null!==o.thrusters&&(this.primary.thrusters.setComponent(new R.Z(o.thrusters))||n.add(o.thrusters)),null!==o.fuelTank&&(this.primary.fuelTank.setComponent(new E.f(o.fuelTank))||n.add(o.fuelTank));for(var a=0;a<i.length;a++){var s=i[a],l=this.optionals[a];if(void 0===l){console.error("Invalid optional component slot");continue}if(null==s){l.setComponent(null);continue}var c=void 0;switch(s.type){case"fuelTank":c=new E.f(s);break;case"fuelScoop":c=new I.J(s);break;case"discoveryScanner":c=new C.b(s)}l.setComponent(c)||n.add(s)}}return e=[{key:"getFuelTanks",value:function(){var e,t=[],n=this.primary.fuelTank.getComponent();return null!==n&&"fuelTank"===n.type&&t.push(n),t.push.apply(t,function(e){if(Array.isArray(e))return M(e)}(e=this.optionals.map(function(e){return e.getComponent()}).filter(function(e){return(null==e?void 0:e.type)==="fuelTank"}))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return M(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),t}},{key:"getFuelScoop",value:function(){var e;return null!=(e=this.optionals.map(function(e){return e.getComponent()}).find(function(e){return(null==e?void 0:e.type)==="fuelScoop"}))?e:null}},{key:"getDiscoveryScanner",value:function(){var e;return null!=(e=this.optionals.map(function(e){return e.getComponent()}).find(function(e){return(null==e?void 0:e.type)==="discoveryScanner"}))?e:null}},{key:"getWarpDrive",value:function(){var e=this.primary.warpDrive.getComponent();return null===e||"warpDrive"!==e.type?null:e}},{key:"getThrusters",value:function(){var e=this.primary.thrusters.getComponent();return null===e||"thrusters"!==e.type?null:e}},{key:"serialize",value:function(){var e,t,n,r,o,i,a={warpDrive:null!=(r=null==(e=this.getWarpDrive())?void 0:e.serialize())?r:null,fuelTank:null!=(o=null==(t=this.getFuelTanks().at(0))?void 0:t.serialize())?o:null,thrusters:null!=(i=null==(n=this.getThrusters())?void 0:n.serialize())?i:null},s=this.optionals.map(function(e){var t,n;return null!=(n=null==(t=e.getComponent())?void 0:t.serialize())?n:null}).filter(function(e){return null===e||(null==e?void 0:e.type)==="discoveryScanner"||(null==e?void 0:e.type)==="fuelTank"||(null==e?void 0:e.type)==="fuelScoop"});if(this.type===u.D0.WANDERER){if(void 0===s[0]||void 0===s[1]||void 0===s[2])throw Error("Optional components are undefined");return{primary:a,optional:[s[0],s[1],s[2]]}}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),D=n(45782),j=n(90767),F=n(35543),U=n(28995),G=n(16186),B=n(14265),H=n(90718),Y=n(39962);function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");W(this,"targetNbParticles",0),W(this,"nbParticlesAlive",0),W(this,"direction",F._0.Z),W(this,"particleSpeed",50),W(this,"recycledParticles",[]),W(this,"solidParticleSystem",void 0),W(this,"emitPeriod",1),W(this,"emitCounter",0),W(this,"lastDeltaSeconds",0),this.solidParticleSystem=new Y.l("SPS",n);var o=H.P.CreatePolyhedron("p",{type:1});this.solidParticleSystem.addShape(o,t.MAX_NB_PARTICLES),o.dispose(),this.solidParticleSystem.buildMesh(),this.solidParticleSystem.isAlwaysVisible=!0;var a=new i.Pq(.01,.01,.1);this.solidParticleSystem.initParticles=function(){var e=!0,n=!1,o=void 0;try{for(var i,a=r.solidParticleSystem.particles[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var s=i.value;r.initParticle(s),r.nbParticlesAlive>=r.targetNbParticles?(s.isVisible=!1,r.recycledParticles.push(s)):r.nbParticlesAlive++,s.position.z=G.X.RandomRange(0,t.TUNNEL_LENGTH)}}catch(e){n=!0,o=e}finally{try{e||null==a.return||a.return()}finally{if(n)throw o}}},this.solidParticleSystem.initParticles(),this.solidParticleSystem.setParticles();var s=new j.F("mat",n);s.emissiveColor=new U.v9(1,1,1),s.disableLighting=!0,this.solidParticleSystem.mesh.material=s,this.solidParticleSystem.updateParticle=function(e){if(!e.alive||!e.isVisible)return e;e.position.addInPlace(e.velocity.scale(r.lastDeltaSeconds));var n=e.position.z;if(n>t.TUNNEL_LENGTH)if(!(r.nbParticlesAlive<=r.targetNbParticles))return r.recycledParticles.push(e),e.isVisible=!1,r.nbParticlesAlive--,e;else r.initParticle(e);var o=(0,B.RangeToPercent)(n,0,t.TUNNEL_LENGTH);if(o<.5)e.color=U.ov.Lerp(new U.ov(0,0,1,1),new U.ov(0,1,1,1),o/.5),e.scaling=a;else{var s=(o-.5)/.5;e.color=U.ov.Lerp(new U.ov(0,1,1),new U.ov(1,0,1),s),e.scaling=i.Pq.Lerp(a,i.Pq.Zero(),s*s)}return e},this.solidParticleSystem.mesh.scaling.z=-1}return e=[{key:"initParticle",value:function(e){var n=t.PLUME_RADIUS*Math.sqrt(Math.random()),r=2*Math.random()*Math.PI,o=new i.Pq(n*Math.cos(r),n*Math.sin(r),Math.random()*t.TUNNEL_LENGTH);e.position.copyFrom(o),e.velocity.copyFrom(this.direction.scale(this.particleSpeed)),e.scaling=new i.Pq(0,0,0)}},{key:"setThrottle",value:function(e){this.targetNbParticles=Math.floor(t.MAX_NB_PARTICLES*e)}},{key:"instanceFromStock",value:function(){var e=this.recycledParticles.shift();if(void 0===e)throw Error("particle is undefined");e.isVisible=!0,this.initParticle(e)}},{key:"update",value:function(e){if(this.lastDeltaSeconds=e,this.targetNbParticles>0)for(this.emitPeriod=t.TUNNEL_LENGTH/(this.particleSpeed*this.targetNbParticles),this.emitCounter+=e;this.emitCounter>this.emitPeriod&&this.nbParticlesAlive<this.targetNbParticles&&this.recycledParticles.length>0;)this.emitCounter-=this.emitPeriod,this.instanceFromStock(),this.nbParticlesAlive++;this.emitCounter=this.emitCounter%this.emitPeriod,0===this.nbParticlesAlive&&this.solidParticleSystem.mesh.isEnabled()?this.solidParticleSystem.mesh.setEnabled(!1):this.nbParticlesAlive>0&&!this.solidParticleSystem.mesh.isEnabled()&&this.solidParticleSystem.mesh.setEnabled(!0),this.nbParticlesAlive>0&&this.solidParticleSystem.setParticles()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();W(z,"TUNNEL_LENGTH",5),W(z,"MAX_NB_PARTICLES",2e3),W(z,"PLUME_RADIUS",1.5);function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var V=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");q(this,"maxAuthority",3e3),q(this,"mesh",void 0),q(this,"throttle",0),q(this,"plume",void 0),q(this,"parentAggregate",void 0),q(this,"light",void 0),q(this,"lightMinIntensity",10),q(this,"lightMaxIntensity",100),this.mesh=e,this.plume=new z(e,e.getScene()),this.plume.solidParticleSystem.mesh.parent=e,this.parentAggregate=r,this.light=new D.H("thrusterLight",o.Pq.Zero(),e.getScene()),this.light.parent=e,this.light.position.addInPlace(n.scale(1))}return e=[{key:"setThrottle",value:function(e){this.throttle=e}},{key:"updateThrottle",value:function(e){this.throttle=Math.max(Math.min(1,this.throttle+e),0)}},{key:"getThrottle",value:function(){return this.throttle}},{key:"update",value:function(e){this.plume.update(e),this.plume.setThrottle(this.throttle),this.light.intensity=this.lightMinIntensity+(this.lightMaxIntensity-this.lightMinIntensity)*Math.max(0,this.throttle)}},{key:"dispose",value:function(){this.plume.solidParticleSystem.dispose(),this.mesh.dispose(),this.light.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Z=function(){var e,t;function n(e,t,r,i,u){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");X(this,"shipType",void 0),X(this,"id",void 0),X(this,"name",void 0),X(this,"instanceRoot",void 0),X(this,"aggregate",void 0),X(this,"collisionObservable",void 0),X(this,"landingComputer",void 0),X(this,"mainEngineThrottle",0),X(this,"mainEngineTargetSpeed",0),X(this,"thrusterForce",8e3),X(this,"maxRollSpeed",2),X(this,"maxYawSpeed",1),X(this,"maxPitchSpeed",3),X(this,"closestWalkableObject",null),X(this,"state",0),X(this,"nearestOrbitalObject",null),X(this,"nearestCelestialBody",null),X(this,"warpTunnel",void 0),X(this,"hyperSpaceTunnel",void 0),X(this,"scene",void 0),X(this,"targetLandingPad",null),X(this,"internals",void 0),X(this,"mainThrusters",[]),X(this,"isFuelScooping",!1),X(this,"enableWarpDriveSound",void 0),X(this,"disableWarpDriveSound",void 0),X(this,"acceleratingWarpDriveSound",void 0),X(this,"deceleratingWarpDriveSound",void 0),X(this,"hyperSpaceSound",void 0),X(this,"thrusterSound",void 0),X(this,"onFuelScoopStart",new a.cP),X(this,"onFuelScoopEnd",new a.cP),X(this,"onWarpDriveEnabled",new a.cP),X(this,"onWarpDriveDisabled",new a.cP),X(this,"onPlanetaryLandingEngaged",new a.cP),X(this,"onLandingObservable",new a.cP),X(this,"onLandingCancelled",new a.cP),X(this,"onTakeOff",new a.cP),X(this,"onAutoPilotEngaged",new a.cP),X(this,"boundingExtent",void 0),this.id=e.id,this.name=e.name,this.shipType=e.type;var h=i.objects.wanderer.instantiateHierarchy(null);if(null===h)throw Error("Wanderer object not found");this.instanceRoot=h,this.instanceRoot.rotationQuaternion=o.PT.Identity(),this.aggregate=new l.L(this.instanceRoot,s.DK.CONTAINER,{mass:10,restitution:.2},r);var v=!0,y=!1,b=void 0;try{for(var S,w=this.instanceRoot.getChildMeshes()[Symbol.iterator]();!(v=(S=w.next()).done);v=!0){var T=S.value;if(T.name.includes("mainThruster")){var A=new V(T,this.instanceRoot.forward.negate(),this.aggregate);this.mainThrusters.push(A);continue}var C=new c.WH(T,r);C.filterMembershipMask=g.H.DYNAMIC_OBJECTS,C.filterCollideMask=g.H.ENVIRONMENT|g.H.DYNAMIC_OBJECTS,this.aggregate.shape.addChildFromParent(this.instanceRoot,C,T)}}catch(e){y=!0,b=e}finally{try{v||null==w.return||w.return()}finally{if(y)throw b}}this.aggregate.body.disablePreStep=!1,this.aggregate.body.setAngularDamping(.9),this.aggregate.shape.filterMembershipMask=g.H.DYNAMIC_OBJECTS,this.aggregate.shape.filterCollideMask=g.H.ENVIRONMENT|g.H.DYNAMIC_OBJECTS,this.aggregate.body.setCollisionCallbackEnabled(!0),this.collisionObservable=this.aggregate.body.getCollisionObservable(),this.landingComputer=new P(this.aggregate,r.getPhysicsEngine()),this.warpTunnel=new f.D(r),this.warpTunnel.getTransform().parent=this.getTransform(),this.hyperSpaceTunnel=new d.R(this.getTransform().forward,r,i.textures.noises),this.hyperSpaceTunnel.setParent(this.getTransform()),this.hyperSpaceTunnel.setEnabled(!1),this.enableWarpDriveSound=u.createInstance(m.Wo.ENABLE_WARP_DRIVE,p.U.STAR_MAP_VIEW,1,!0),this.disableWarpDriveSound=u.createInstance(m.Wo.DISABLE_WARP_DRIVE,p.U.STAR_MAP_VIEW,1,!0),this.acceleratingWarpDriveSound=u.createInstance(m.Wo.ACCELERATING_WARP_DRIVE,p.U.STAR_SYSTEM_VIEW,0,!1),this.deceleratingWarpDriveSound=u.createInstance(m.Wo.DECELERATING_WARP_DRIVE,p.U.STAR_SYSTEM_VIEW,0,!1),this.hyperSpaceSound=u.createInstance(m.Wo.HYPER_SPACE,p.U.HYPER_SPACE,0,!1),this.thrusterSound=u.createInstance(m.Wo.THRUSTER,p.U.STAR_SYSTEM_VIEW,0,!1),this.internals=new k(e,t);var I=this.getTransform().getHierarchyBoundingVectors(),E=I.min,R=I.max;this.boundingExtent=R.subtract(E),this.thrusterSound.play(),this.acceleratingWarpDriveSound.play(),this.deceleratingWarpDriveSound.play(),this.hyperSpaceSound.play(),this.scene=r}return e=[{key:"getInternals",value:function(){return this.internals}},{key:"setClosestWalkableObject",value:function(e){this.closestWalkableObject=e}},{key:"getTransform",value:function(){return this.aggregate.transformNode}},{key:"setEnabled",value:function(e,t){this.instanceRoot.setEnabled(e),(0,v.s)(this.aggregate.body,e,t)}},{key:"setNearestOrbitalObject",value:function(e){this.nearestOrbitalObject=e}},{key:"setNearestCelestialBody",value:function(e){this.nearestCelestialBody=e}},{key:"enableWarpDrive",value:function(){var e=this.getInternals().getWarpDrive();null!==e&&(e.enable(),this.aggregate.body.setMotionType(s.AH.ANIMATED),this.aggregate.body.setLinearVelocity(i.Pq.Zero()),this.aggregate.body.setAngularVelocity(i.Pq.Zero()),this.thrusterSound.setVolume(0),this.enableWarpDriveSound.play(),this.onWarpDriveEnabled.notifyObservers())}},{key:"disableWarpDrive",value:function(){var e=this.getInternals().getWarpDrive();null!==e&&(e.disengage(),this.aggregate.body.setMotionType(s.AH.DYNAMIC),this.disableWarpDriveSound.play(),this.onWarpDriveDisabled.notifyObservers(!1))}},{key:"emergencyStopWarpDrive",value:function(){var e=this.getInternals().getWarpDrive();null!==e&&(e.emergencyStop(),this.aggregate.body.setMotionType(s.AH.DYNAMIC),this.disableWarpDriveSound.play(),this.onWarpDriveDisabled.notifyObservers(!0))}},{key:"toggleWarpDrive",value:function(){var e=this.getInternals().getWarpDrive();null!==e&&(e.isEnabled()?this.disableWarpDrive():this.enableWarpDrive())}},{key:"setMainEngineThrottle",value:function(e){this.mainEngineThrottle=e}},{key:"getSpeed",value:function(){var e=this.getInternals().getWarpDrive();return null!==e&&e.isEnabled()?e.getWarpSpeed():this.aggregate.body.getLinearVelocity().dot(this.getTransform().forward)}},{key:"getThrottle",value:function(){var e=this.getInternals().getWarpDrive();return null!==e&&e.isEnabled()?e.getThrottle():this.mainEngineThrottle}},{key:"increaseMainEngineThrottle",value:function(e){this.mainEngineThrottle=Math.max(-1,Math.min(1,this.mainEngineThrottle+e))}},{key:"getClosestWalkableObject",value:function(){return this.closestWalkableObject}},{key:"getNearestOrbitalObject",value:function(){return this.nearestOrbitalObject}},{key:"engageSurfaceLanding",value:function(e){var t;this.state=1,null==(t=this.landingComputer)||t.setTarget({kind:A.CELESTIAL_BODY,celestialBody:e}),this.onPlanetaryLandingEngaged.notifyObservers()}},{key:"isAutoPiloted",value:function(){var e;return(null==(e=this.landingComputer)?void 0:e.getTarget())!==null}},{key:"engageLandingOnPad",value:function(e){this.targetLandingPad=e}},{key:"getTargetLandingPad",value:function(){return this.targetLandingPad}},{key:"completeLanding",value:function(){var e;this.state=2,this.aggregate.body.setMotionType(s.AH.STATIC),this.aggregate.shape.filterCollideMask=g.H.DYNAMIC_OBJECTS,this.aggregate.shape.filterMembershipMask=g.H.ENVIRONMENT,null!==this.targetLandingPad&&this.getTransform().setParent(this.targetLandingPad.getTransform()),null==(e=this.landingComputer)||e.setTarget(null),this.onLandingObservable.notifyObservers()}},{key:"cancelLanding",value:function(){var e;this.state=0,this.getTransform().setParent(null),this.aggregate.body.setMotionType(s.AH.DYNAMIC),this.aggregate.shape.filterCollideMask=g.H.DYNAMIC_OBJECTS|g.H.ENVIRONMENT,this.aggregate.shape.filterMembershipMask=g.H.DYNAMIC_OBJECTS,null==(e=this.landingComputer)||e.setTarget(null),this.targetLandingPad=null,this.onLandingCancelled.notifyObservers()}},{key:"spawnOnPad",value:function(e){this.getTransform().setParent(null),this.engageLandingOnPad(e),this.getTransform().rotationQuaternion=o.PT.Identity(),this.getTransform().position.copyFromFloats(0,this.boundingExtent.y/2,0),this.getTransform().parent=e.getTransform(),this.completeLanding()}},{key:"isLanded",value:function(){return 2===this.state}},{key:"isLanding",value:function(){return 1===this.state}},{key:"isLandedAtFacility",value:function(){return this.isLanded()&&null!==this.targetLandingPad}},{key:"takeOff",value:function(){this.targetLandingPad=null,this.getTransform().setParent(null),(0,y.Tl)(this.getTransform(),this.getTransform().up.scale(5)),this.state=0,this.aggregate.body.setMotionType(s.AH.DYNAMIC),this.aggregate.shape.filterCollideMask=g.H.DYNAMIC_OBJECTS|g.H.ENVIRONMENT,this.aggregate.shape.filterMembershipMask=g.H.DYNAMIC_OBJECTS,this.aggregate.body.applyImpulse(this.getTransform().up.scale(200),this.getTransform().getAbsolutePosition()),this.onTakeOff.notifyObservers()}},{key:"handleFuelScoop",value:function(e){var t,n=this.getInternals().getFuelScoop();if(null!==n&&null!==this.nearestCelestialBody&&[h.T.STAR,h.T.GAS_PLANET].includes(this.nearestCelestialBody.model.type)){var r=i.Pq.Distance(this.getTransform().getAbsolutePosition(),this.nearestCelestialBody.getTransform().getAbsolutePosition());if(.01>Math.abs(this.getRemainingFuel()/this.getTotalFuelCapacity()-1)||r>2.3*this.nearestCelestialBody.getBoundingRadius()){this.isFuelScooping&&(this.isFuelScooping=!1,this.onFuelScoopEnd.notifyObservers());return}if(!(r>2*this.nearestCelestialBody.getBoundingRadius())){switch(!this.isFuelScooping&&(this.isFuelScooping=!0,this.onFuelScoopStart.notifyObservers()),this.nearestCelestialBody.model.type){case h.T.STAR:t=1;break;case h.T.GAS_PLANET:t=.3;break;case h.T.NEUTRON_STAR:case h.T.BLACK_HOLE:case h.T.TELLURIC_PLANET:case h.T.TELLURIC_SATELLITE:case h.T.MANDELBULB:case h.T.JULIA_SET:case h.T.MANDELBOX:case h.T.SIERPINSKI_PYRAMID:case h.T.MENGER_SPONGE:case h.T.DARK_KNIGHT:t=0}this.refuel(n.fuelPerSecond*t*e)}}}},{key:"updateWarpDrive",value:function(e){var t=this.getInternals().getWarpDrive();if(null!==t){var n=this.aggregate.transformNode.forward.scale(t.getWarpSpeed());this.warpTunnel.update(e);var r=i.Pq.Dot(n,this.aggregate.transformNode.forward),o=1/0,a=0;if(t.isEnabled()){if(null!==this.nearestOrbitalObject){(0,b.u)(this.getTransform(),this.getSpeed(),this.nearestOrbitalObject)||this.emergencyStopWarpDrive();var s=i.Pq.Distance(this.getTransform().getAbsolutePosition(),this.nearestOrbitalObject.getTransform().getAbsolutePosition()),l=this.nearestOrbitalObject.getBoundingRadius();o=Math.min(o,s),a=Math.max(l,a)}if(null!==this.nearestCelestialBody){var c=this.nearestCelestialBody.asteroidField;if(null!==c){var u,h,d,f,p,m,v,g,S=(u=this.getTransform().getAbsolutePosition(),d=(h=c.parent).position,f=u.subtract(d),p=Math.abs(i.Pq.Dot(f,h.up)),m=f.subtract(h.up.scale(p)).length(),v=c.innerRadius,g=c.outerRadius,m>v&&m<g?Math.abs(p):Math.sqrt(Math.min(Math.pow(m-v,2),Math.pow(m-g,2))+Math.pow(p,2)));S<o&&(o=S,a=c.patchThickness/2)}}this.mainThrusters.forEach(function(e){e.setThrottle(0)}),(0,y.Tl)(this.getTransform(),n.scale(e)),this.thrusterSound.setVolume(0),r<t.getWarpSpeed()?(this.acceleratingWarpDriveSound.setVolume(1),this.deceleratingWarpDriveSound.setVolume(0)):(this.deceleratingWarpDriveSound.setVolume(1),this.acceleratingWarpDriveSound.setVolume(0))}t.update(o,a,e),t.isEnabled()?this.warpTunnel.setThrottle(1-1/(1.1*(1+1e-7*t.getWarpSpeed()))):this.warpTunnel.setThrottle(0)}}},{key:"update",value:function(e){var t,n=this,r=this.getInternals().getThrusters();this.mainEngineTargetSpeed=this.mainEngineThrottle*(null!=(t=null==r?void 0:r.maxSpeed)?t:0),null!==this.targetLandingPad&&(this.mainEngineTargetSpeed/=8),this.updateWarpDrive(e),this.handleFuelScoop(e);var o=this.getInternals().getWarpDrive();if((null===o||o.isDisabled())&&2!==this.state){var a=this.aggregate.body.getLinearVelocity(),s=this.getTransform().getDirection(i.Pq.Forward(this.scene.useRightHandedSystem)),l=i.Pq.Dot(a,s);if(0!==this.mainEngineThrottle){var c=Math.abs(this.mainEngineThrottle);this.thrusterSound.setVolume(c)}else this.thrusterSound.setVolume(0);if(!this.isAutoPiloted()){var u=l-this.mainEngineTargetSpeed;Math.abs(u)>2&&(u<0?this.aggregate.body.applyForce(s.scale(this.thrusterForce),this.aggregate.body.getObjectCenterWorld()):this.aggregate.body.applyForce(s.scale(-.7*this.thrusterForce),this.aggregate.body.getObjectCenterWorld()));var h=a.subtract(s.scale(l));this.aggregate.body.applyForce(h.scale(-5),this.aggregate.body.getObjectCenterWorld())}if(this.mainThrusters.forEach(function(e){e.setThrottle(n.mainEngineThrottle)}),this.acceleratingWarpDriveSound.setVolume(0),this.deceleratingWarpDriveSound.setVolume(0),null!==this.targetLandingPad&&null!==this.landingComputer){var d=this.getTransform().getAbsolutePosition().subtract(this.targetLandingPad.getTransform().getAbsolutePosition()),f=d.length(),p=i.Pq.Dot(d,this.targetLandingPad.getTransform().up);f<600&&p>0&&1!==this.state&&(this.landingComputer.setTarget({kind:A.LANDING_PAD,landingPad:this.targetLandingPad}),this.state=1,this.onAutoPilotEngaged.notifyObservers())}}if(this.mainThrusters.forEach(function(t){t.update(e)}),null!==this.landingComputer)switch(this.landingComputer.update(e)){case 1:case 8:break;case 2:this.completeLanding();break;case 4:case 16:this.cancelLanding()}this.isAutoPiloted()&&this.setMainEngineThrottle(0);var m=null!==o&&o.isEnabled()?e*o.getFuelConsumptionRate(this.getSpeed()):e*this.mainEngineThrottle*.02;m<this.getRemainingFuel()?this.burnFuel(m):(this.emergencyStopWarpDrive(),this.mainEngineThrottle=0)}},{key:"getTotalFuelCapacity",value:function(){return this.getInternals().getFuelTanks().reduce(function(e,t){return e+t.getMaxFuel()},0)}},{key:"getRemainingFuel",value:function(){return this.getInternals().getFuelTanks().reduce(function(e,t){return e+t.getCurrentFuel()},0)}},{key:"burnFuel",value:function(e){if(e>this.getRemainingFuel())throw Error("Not enough fuel in the tanks.");var t=e,n=!0,r=!1,o=void 0;try{for(var i,a=this.getInternals().getFuelTanks()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value,l=s.getCurrentFuel();s.burnFuel(Math.min(t,l));var c=s.getCurrentFuel();t-=l-c}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return e-t}},{key:"refuel",value:function(e){var t=e,n=!0,r=!1,o=void 0;try{for(var i,a=this.getInternals().getFuelTanks()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value,l=s.getCurrentFuel();s.fill(Math.min(t,s.getMaxFuel()-l));var c=s.getCurrentFuel();t-=c-l}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return e-t}},{key:"serialize",value:function(){if(this.shipType===u.D0.WANDERER)return{id:this.id,name:this.name,type:this.shipType,components:this.getInternals().serialize()}}},{key:"dispose",value:function(e){e.freeInstance(this.enableWarpDriveSound),e.freeInstance(this.disableWarpDriveSound),e.freeInstance(this.acceleratingWarpDriveSound),e.freeInstance(this.deceleratingWarpDriveSound),e.freeInstance(this.thrusterSound),this.mainThrusters.forEach(function(e){e.dispose()}),this.mainThrusters.length=0,this.warpTunnel.dispose(),this.hyperSpaceTunnel.dispose(),this.aggregate.dispose(),this.instanceRoot.dispose(),this.onWarpDriveEnabled.clear(),this.onWarpDriveDisabled.clear(),this.onFuelScoopStart.clear(),this.onFuelScoopEnd.clear(),this.onPlanetaryLandingEngaged.clear(),this.onLandingObservable.clear()}}],t=[{key:"CreateDefault",value:function(e,t,r){return n.Deserialize((0,u.Eq)(),new Set,e,t,r)}},{key:"Deserialize",value:function(e,t,r,o,i){return new n(e,t,r,o,i)}}],e&&J(n.prototype,e),t&&J(n,t),n}()},25187:function(e,t,n){"use strict";n.d(t,{l:()=>em}),n(41605);var r=n(74631),o=n(74334),i=n(60333),a=n(48462),s=n(15524),l=n(97348),c=n(61741),u=n(42503),h=n(26274),d=n(7661),f=n(76448),p=n(13997),m=n(85883),v=n(82886),y=n(61955),g=n(17966),b=n(53843),S=n(34041),w=n(4035),T=n(90160),A=n(90141),P=n(9323),C=n(3211),I=n(33102),E=n(43328),R=n(53314),N=n(84369),O=n(81629),L=n(12577),x=n(36801),M=n(13298),_=n(63215),k=n(95369),D=n(78706);function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=function(){var e;function t(e,n,r){var o=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");j(this,"rootNode",void 0),j(this,"missionPanel",void 0),j(this,"missionPanelTitle",void 0),j(this,"missionPanelDescription",void 0),j(this,"missionPanelNextTask",void 0),j(this,"buttonContainer",void 0),j(this,"previousMissionButton",void 0),j(this,"missionCounter",void 0),j(this,"nextMissionButton",void 0),j(this,"activeMission",null),j(this,"player",void 0),this.player=e,this.rootNode=document.createElement("div"),this.rootNode.classList.add("currentMissionDisplay","flex-column"),this.missionPanel=document.createElement("div"),this.missionPanel.classList.add("missionPanel","flex-column"),this.rootNode.appendChild(this.missionPanel),this.missionPanelTitle=document.createElement("h2"),this.missionPanel.appendChild(this.missionPanelTitle),this.missionPanelDescription=document.createElement("p"),this.missionPanel.appendChild(this.missionPanelDescription),this.missionPanelNextTask=document.createElement("p"),this.missionPanel.appendChild(this.missionPanelNextTask),this.buttonContainer=document.createElement("div"),this.buttonContainer.classList.add("buttonContainer"),this.rootNode.appendChild(this.buttonContainer),this.previousMissionButton=document.createElement("p"),this.buttonContainer.appendChild(this.previousMissionButton);var i=document.createElement("span");i.innerText=D.A.t("missions:common:previous"),this.previousMissionButton.appendChild(i),this.missionCounter=document.createElement("p"),this.buttonContainer.appendChild(this.missionCounter),this.nextMissionButton=document.createElement("p"),this.buttonContainer.appendChild(this.nextMissionButton);var a=document.createElement("span");a.innerText=D.A.t("missions:common:next"),this.nextMissionButton.appendChild(a),(0,k.t)().then(function(e){(0,T.hg)(N._.map.previousMission,e).forEach(function(e){var t=document.createElement("span");t.classList.add("keySpan"),t.innerText=e,o.previousMissionButton.appendChild(t)}),(0,T.hg)(N._.map.nextMission,e).forEach(function(e){var t=document.createElement("span");t.classList.add("keySpan"),t.innerText=e,o.nextMissionButton.appendChild(t)})});var s=this.player.currentMissions[0];void 0===s?this.setNoMissionActive():this.setMission(s,n),N._.map.previousMission.on("complete",function(){o.setPreviousMission(n),o.previousMissionButton.animate([{transform:"scale(1)"},{transform:"scale(1.1)"},{transform:"scale(1)"}],{duration:200,easing:"ease"}),r.playNow(f.Wo.CLICK)}),N._.map.nextMission.on("complete",function(){o.setNextMission(n),o.nextMissionButton.animate([{transform:"scale(1)"},{transform:"scale(1.1)"},{transform:"scale(1)"}],{duration:200,easing:"ease"}),r.playNow(f.Wo.CLICK)})}return e=[{key:"update",value:function(e,t,n){var r=this.player.completedMissions.concat(this.player.currentMissions);if(this.buttonContainer.hidden=r.length<=1,null===this.activeMission&&void 0!==this.player.currentMissions[0])this.setMission(this.player.currentMissions[0],n);else if(null===this.activeMission&&0!==r.length){var o=r.at(0);void 0!==o?this.setMission(o,n):this.setNoMissionActive()}if(null!==this.activeMission){if(-1===r.indexOf(this.activeMission)){var i=r.at(0);void 0!==i?this.setMission(i,n):this.setNoMissionActive();return}this.rootNode.classList.toggle("completed",this.activeMission.tree.isCompleted());var a=this.activeMission.describeNextTask(e,t,n);a!==this.missionPanelNextTask.innerText&&(this.missionPanelNextTask.innerText=a)}}},{key:"setNextMission",value:function(e){if(null!==this.activeMission){var t=this.player.completedMissions.concat(this.player.currentMissions),n=t.indexOf(this.activeMission);if(-1===n){var r=t.at(0);void 0!==r?this.setMission(r,e):this.setNoMissionActive();return}var o=t.at(n+1);void 0!==o&&this.setMission(o,e)}}},{key:"setPreviousMission",value:function(e){if(null!==this.activeMission){var t=this.player.completedMissions.concat(this.player.currentMissions),n=t.indexOf(this.activeMission);if(-1===n){var r=t.at(0);void 0!==r?this.setMission(r,e):this.setNoMissionActive();return}if(0!==n){var o=t.at(n-1);void 0!==o&&this.setMission(o,e)}}}},{key:"setMission",value:function(e,t){this.activeMission=e,this.missionPanelTitle.innerText=e.getTypeString(),this.missionPanelDescription.innerText=e.describe(t);var n=this.player.completedMissions.concat(this.player.currentMissions),r=n.indexOf(this.activeMission);this.missionCounter.innerText="".concat(r+1,"/").concat(n.length)}},{key:"setNoMissionActive",value:function(){this.activeMission=null,this.missionPanelTitle.innerText=D.A.t("missions:common:noActiveMission"),this.missionPanelDescription.innerText=D.A.t("missions:common:whereToGetMissions"),this.missionCounter.innerText="0/0",this.rootNode.classList.remove("completed")}},{key:"dispose",value:function(){this.rootNode.remove()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();let U=n.p+"ba9d03d1e176880c.webp";function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B=function(){var e;function t(e,n,r){var o=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");G(this,"root",void 0),G(this,"throttleContainer",void 0),G(this,"throttleStripes",void 0),G(this,"speedIndicator",void 0),G(this,"cursor",void 0),G(this,"targetHelper",void 0),G(this,"targetDot",void 0),G(this,"currentTarget",null),G(this,"fuelIndicator",void 0),G(this,"currentMissionDisplay",void 0),this.root=document.createElement("div"),this.root.id="helmetOverlay",this.throttleContainer=document.createElement("div"),this.throttleContainer.id="throttle",this.root.appendChild(this.throttleContainer),this.throttleStripes=document.createElement("div"),this.throttleStripes.id="throttleStripes",this.throttleContainer.appendChild(this.throttleStripes),this.speedIndicator=document.createElement("div"),this.speedIndicator.id="speed",this.speedIndicator.innerText="0 km/h",this.root.appendChild(this.speedIndicator),this.targetHelper=document.createElement("div"),this.targetHelper.id="targetHelper",this.root.appendChild(this.targetHelper),this.targetDot=document.createElement("div"),this.targetDot.id="targetDot",this.targetHelper.appendChild(this.targetDot),this.fuelIndicator=document.createElement("div"),this.fuelIndicator.id="fuelIndicator",this.root.appendChild(this.fuelIndicator);var i=document.createElement("img");i.src=U,i.alt="Fuel canister icon",this.fuelIndicator.appendChild(i),this.currentMissionDisplay=new F(e,n,r),this.root.appendChild(this.currentMissionDisplay.rootNode),this.cursor=document.createElement("div"),this.cursor.classList.add("cursor"),this.root.appendChild(this.cursor),document.addEventListener("mousemove",function(e){o.cursor.style.left="".concat(e.clientX,"px"),o.cursor.style.top="".concat(e.clientY,"px");var t=Math.atan2(e.clientY-window.innerHeight/2,e.clientX-window.innerWidth/2);o.cursor.style.transform="translate(-50%, -50%) rotate(".concat(Math.PI/2+t,"rad)");var n=Math.min(Math.sqrt(Math.pow(e.clientX-window.innerWidth/2,2)+Math.pow(e.clientY-window.innerHeight/2,2))/Math.min(window.innerWidth,window.innerHeight),1);o.cursor.style.opacity="".concat((0,M.TF)(.1,.2,n))})}return e=[{key:"setVisibility",value:function(e){this.root.style.visibility=e?"visible":"hidden"}},{key:"isVisible",value:function(){return"visible"===this.root.style.visibility}},{key:"setTarget",value:function(e,t){var n=null===e||this.currentTarget===e;if(void 0!==t&&(n=!t),n){this.targetHelper.style.display="none",this.currentTarget=null;return}this.targetHelper.style.display="block",this.currentTarget=e}},{key:"update",value:function(e,t,n,r){if(null!==this.currentTarget){var i=this.currentTarget.getAbsolutePosition().subtract(e.getAbsolutePosition()).normalize(),a=x.Pq.TransformNormal(i,o.uq.Invert(e.getWorldMatrix()));this.targetDot.className=a.z<0?"targetDot":"targetDot behind",this.targetDot.style.top="".concat(50-50*a.y,"%"),this.targetDot.style.left="".concat(50+50*a.x,"%")}this.currentMissionDisplay.update(t,n,r)}},{key:"displaySpeed",value:function(e,t){this.throttleContainer.style.alignItems=e<0?"flex-start":"flex-end",this.throttleStripes.style.height="".concat((100*Math.abs(e)).toFixed(0),"%"),this.throttleStripes.classList.toggle("reversed",e<0),this.speedIndicator.innerText=(0,_.fi)(t)}},{key:"displayFuel",value:function(e,t){this.fuelIndicator.style.setProperty("--currentFuelLevel","".concat((100*e).toFixed(0),"%")),this.fuelIndicator.style.setProperty("--fuelLevelAfterJump","".concat(((e-t)*100).toFixed(0),"%"))}},{key:"dispose",value:function(){this.root.remove()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),H=n(42089),Y=n(89668),W=n(33871),z=n(89901),q=n(79618),V=n(37736),J=n(77504),X=n(43732),Z=n(92766),K=n(72262),Q=n(78921),$=n(56367),ee=n(13679),et=n(11569);function en(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var er=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");en(this,"spaceship",void 0),en(this,"thirdPersonCamera",void 0),this.spaceship=e,this.thirdPersonCamera=new et.Lq("shipThirdPersonCamera",0,0,50,x.Pq.Zero(),n)}return e=[{key:"getTransform",value:function(){return this.spaceship.getTransform()}},{key:"getActiveCamera",value:function(){return this.thirdPersonCamera}},{key:"getCameras",value:function(){return[this.thirdPersonCamera]}},{key:"shouldLockPointer",value:function(){return!1}},{key:"update",value:function(){return x.Pq.Zero()}},{key:"dispose",value:function(e){this.spaceship.dispose(e)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),eo=n(61094);function ei(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ea=function(){var e;function t(e,n,r,o){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");ei(this,"player",void 0),ei(this,"spaceshipControls",void 0),this.player=eo.a.Default(e),this.player.setName("AI");var i=this.player.serializedSpaceships.shift();if(void 0===i)throw Error("No spaceship serialized for AI player");var a=R.Z.Deserialize(i,this.player.spareSpaceshipComponents,n,r,o);this.spaceshipControls=new er(a,n)}return e=[{key:"dispose",value:function(e){this.spaceshipControls.dispose(e)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),es=n(2047),el=n(50551);function ec(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eu(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function eh(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){eu(i,r,o,a,s,"next",e)}function s(e){eu(i,r,o,a,s,"throw",e)}a(void 0)})}}function ed(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ef(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function ep(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var em=function(){var e;function t(e,n,i,l,c,u,p,m,y){var g=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");ed(this,"targetCursorLayer",void 0),ed(this,"spaceShipLayer",void 0),ed(this,"spaceStationLayer",void 0),ed(this,"isUiEnabled",!0),ed(this,"player",void 0),ed(this,"aiPlayers",[]),ed(this,"encyclopaedia",void 0),ed(this,"starSystemDatabase",void 0),ed(this,"scene",void 0),ed(this,"havokPlugin",void 0),ed(this,"defaultControls",null),ed(this,"spaceshipControls",null),ed(this,"characterControls",null),ed(this,"orbitRenderer",new q.G(el.h)),ed(this,"axisRenderer",new W.F(el.h)),ed(this,"starSystem",null),ed(this,"loader",new X.$),ed(this,"chunkForge",new V.u(ee.w.VERTEX_RESOLUTION)),ed(this,"onInitStarSystem",new a.cP),ed(this,"onBeforeJump",new a.cP),ed(this,"onAfterJump",new a.cP),ed(this,"jumpLock",!1),ed(this,"_isLoadingSystem",!1),ed(this,"onNewDiscovery",new a.cP),ed(this,"postProcessManager",void 0),ed(this,"keyboardLayoutMap",new Map),ed(this,"soundPlayer",void 0),ed(this,"tts",void 0),ed(this,"assets",void 0),this.player=n,this.encyclopaedia=c,this.starSystemDatabase=u,this.spaceShipLayer=new B(this.player,this.starSystemDatabase,p),document.body.appendChild(this.spaceShipLayer.root),this.scene=e,this.scene.skipPointerMovePicking=!0,this.scene.autoClear=!1,this.havokPlugin=l,this.soundPlayer=p,this.tts=m,this.assets=y,(0,k.t)().then(function(e){g.keyboardLayoutMap=null!=e?e:new Map}),C.n.map.toggleUi.on("complete",function(){g.isUiEnabled=!g.isUiEnabled,g.soundPlayer.playNow(f.Wo.CLICK)}),C.n.map.toggleOrbitsAndAxis.on("complete",function(){var e=!g.orbitRenderer.isVisible();e?g.soundPlayer.playNow(f.Wo.ENABLE_ORBIT_DISPLAY):g.soundPlayer.playNow(f.Wo.DISABLE_ORBIT_DISPLAY),g.orbitRenderer.setVisibility(e),g.axisRenderer.setVisibility(e)}),C.n.map.cycleViews.on("complete",function(){return eh(function(){return ep(this,function(e){switch(e.label){case 0:if(this.scene.getActiveControls()!==this.getSpaceshipControls())return[3,2];return[4,this.switchToDefaultControls(!0)];case 1:case 3:return e.sent(),[3,6];case 2:if(this.scene.getActiveControls()!==this.getDefaultControls())return[3,4];return[4,this.switchToCharacterControls()];case 4:if(this.scene.getActiveControls()!==this.getCharacterControls())return[3,6];return[4,this.switchToSpaceshipControls()];case 5:e.sent(),e.label=6;case 6:return[2]}})}).call(g)}),C.n.map.setTarget.on("complete",function(){var e=g.targetCursorLayer.getClosestToScreenCenterOrbitalObject();g.setTarget(e)}),C.n.map.jumpToSystem.on("complete",function(){return eh(function(){var e,t,n,r,i,a,s,l,c,u,h,f,m,v,y,g,w;return ep(this,function(T){switch(T.label){case 0:if(e=this,!ef(t=this.targetCursorLayer.getTarget(),Q.N)||null===(i=(r=(n=this.getSpaceshipControls()).getSpaceship()).getInternals().getWarpDrive())||this.jumpLock)return[2];if(this.jumpLock=!0,a=(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(this.getStarSystem().model.coordinates)),s=(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(t.systemCoordinates)),l=o.Pq.Distance(a,s),c=i.getHyperJumpFuelConsumption(l),r.getRemainingFuel()<c)return(0,L.UI)(L.I9.SPACESHIP,L.yg.ERROR,D.A.t("notifications:notEnoughFuel"),5e3,this.soundPlayer),this.jumpLock=!1,[2];return u=n.getTransform().forward,h=t.getTransform().getAbsolutePosition().subtract(n.getTransform().getAbsolutePosition()).normalize(),f=o.Pq.Cross(u,h),m=o.Pq.GetAngleBetweenVectors(u,h,f),v=new S.J(n.getTransform(),f,m,2*m),[4,new Promise(function(t){var n=e.scene.onBeforePhysicsObservable.add(function(){v.update(e.scene.getEngine().getDeltaTime()/1e3),v.isFinished()&&(n.remove(),t())})})];case 1:if(T.sent(),this.onBeforeJump.notifyObservers(),i.isEnabled()||r.enableWarpDrive(),r.hyperSpaceTunnel.setEnabled(!0),r.warpTunnel.getTransform().setEnabled(!1),r.hyperSpaceSound.setVolume(1),p.setInstanceMask(d.U.HYPER_SPACE),y=this.scene.onBeforeRenderObservable.add(function(){var t=e.scene.getEngine().getDeltaTime()/1e3;r.hyperSpaceTunnel.update(t),r.warpTunnel.update(t)}),r.burnFuel(c),g=t.systemCoordinates,null===(w=this.starSystemDatabase.getSystemModelFromCoordinates(g)))throw Error("System model not found for coordinates generated by getNeighborStarSystemCoordinates");return[4,this.loadStarSystem(w)];case 2:return T.sent(),this.initStarSystem(),r.hyperSpaceTunnel.setEnabled(!1),r.warpTunnel.getTransform().setEnabled(!0),r.hyperSpaceSound.setVolume(0),p.setInstanceMask(d.U.STAR_SYSTEM_VIEW),y.remove(),this.jumpLock=!1,this.player.visitedSystemHistory.push(this.getStarSystem().model.coordinates),this.onAfterJump.notifyObservers(),[2]}})}).call(g)}),C.n.map.toggleSpaceShipCharacter.on("complete",function(){return eh(function(){var e,t,n,r,o,i,a;return ep(this,function(l){switch(l.label){case 0:return e=this.getCharacterControls(),n=(t=this.getSpaceshipControls()).getSpaceship(),[4,(0,k.t)()];case 1:if(r=l.sent(),this.scene.getActiveControls()!==t)return[3,3];return e.getTransform().setEnabled(!0),v.b.setEnabled(!0),e.getTransform().setAbsolutePosition(t.getTransform().absolutePosition),(0,P.Tl)(e.getTransform(),t.getTransform().forward.scale(3+t.getSpaceship().boundingExtent.z/2)),(0,P.rD)(e.getTransform(),(0,P.hQ)(t.getTransform()).clone()),N._.setEnabled(!1),this.spaceShipLayer.setVisibility(!1),[4,this.scene.setActiveControls(e)];case 2:return l.sent(),n.acceleratingWarpDriveSound.setVolume(0),n.deceleratingWarpDriveSound.setVolume(0),[3,5];case 3:if(this.scene.getActiveControls()!==e)return[3,5];return e.getTransform().setEnabled(!1),v.b.setEnabled(!1),[4,this.scene.setActiveControls(t)];case 4:if(l.sent(),N._.setEnabled(!0),n.isLanded()){if(!ef(a=null==(o=N._.map.upDown.bindings[0])?void 0:o.control,s.hn))throw Error("Up down is not an axis composite");(0,L.UI)(L.I9.SPACESHIP,L.yg.INFO,D.A.t("notifications:howToLiftOff",{bindingsString:null==(i=(0,T.Lc)(a,r)[1])?void 0:i[1]}),5e3,this.soundPlayer)}l.label=5;case 5:return[2]}})}).call(g)}),C.n.map.printDebugInfo.on("complete",function(){var e=g.getStarSystem().getNearestOrbitalObject(o.Pq.Zero());console.log((0,h.Ei)(e.model,g.getStarSystem().model))}),new r.g("ambientLight",o.Pq.Zero(),this.scene).intensity=.02,this.postProcessManager=new I.X(y.textures,this.scene),this.scene.onBeforePhysicsObservable.add(function(){var e=i.getDeltaTime()/1e3;g.updateBeforePhysics(e*ee.w.TIME_MULTIPLIER)}),this.scene.onBeforeRenderObservable.add(function(){var e=i.getDeltaTime()*ee.w.TIME_MULTIPLIER/1e3;g.updateBeforeRender(e)}),this.scene.onAfterRenderObservable.add(function(){g.updateAfterRender()}),this.spaceShipLayer.setVisibility(!1),this.spaceStationLayer=new H.M(this.player,this.encyclopaedia,this.starSystemDatabase,this.soundPlayer),this.spaceStationLayer.setVisibility(!1),this.spaceStationLayer.onTakeOffObservable.add(function(){g.getSpaceshipControls().getSpaceship().takeOff()}),this.targetCursorLayer=new Y.p,window.StarSystemView=this}return e=[{key:"loadStarSystem",value:function(e){return eh(function(){var t,n,r,o;return ep(this,function(i){switch(i.label){case 0:if(t=this,this._isLoadingSystem)throw Error("Cannot load a new star system while the current one is loading");return this._isLoadingSystem=!0,null!==this.starSystem&&(this.aiPlayers.forEach(function(e){e.dispose(t.soundPlayer)}),this.aiPlayers.length=0,null==(n=this.spaceshipControls)||n.setClosestLandableFacility(null),null==(r=this.characterControls)||r.setClosestWalkableObject(null),this.chunkForge.reset(),this.postProcessManager.reset(),this.starSystem.dispose(),this.targetCursorLayer.reset(),this.spaceStationLayer.reset(),this.player.visitedSystemHistory.push(this.starSystem.model.coordinates)),o=this,[4,J.k.CreateAsync(e,this.loader,this.assets,this.scene)];case 1:return o.starSystem=i.sent(),[2,this.starSystem]}})}).call(this)}},{key:"initStarSystem",value:function(){var e=this,t=this.getStarSystem();t.initPositions(2,this.chunkForge),this.targetCursorLayer.reset(),this.postProcessManager.addCelestialBodies(t.getCelestialBodies(),t.getStellarObjects(),[t.starFieldBox.mesh]);var n=t.getCelestialBodies(),r=t.getOrbitalFacilities();n.forEach(function(t){e.targetCursorLayer.addObject(t)}),r.forEach(function(t){e.targetCursorLayer.addObject(t),t.getSubTargets().forEach(function(t){e.targetCursorLayer.addObject(t)});for(var n=0;n<Math.ceil(15*Math.random());n++){var r=new ea(e.starSystemDatabase,e.scene,e.assets,e.soundPlayer),o=t.getLandingPadManager().handleLandingRequest({minimumPadSize:z.a.SMALL});if(null===o){r.dispose(e.soundPlayer);break}e.aiPlayers.push(r),r.spaceshipControls.spaceship.spawnOnPad(o)}}),this.orbitRenderer.setOrbitalObjects(t.getOrbitalObjects(),this.scene),this.axisRenderer.setOrbitalObjects(t.getOrbitalObjects(),this.scene),this.spaceShipLayer.setTarget(null),this.targetCursorLayer.setTarget(null);var i=n[0];if(void 0===i)throw Error("No bodies in star system");var a=this.scene.getActiveControls(),s=4;ef(i,Z.a)?s=50:ef(i,K.G)&&(s=1e5);var c=this.player.visitedSystemHistory.at(-1);if(void 0===c)(0,A.Ez)(a,i,t,s);else{var h=(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(t.model.coordinates)),d=(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(c)).subtract(h).normalize();o.Pq.TransformCoordinatesToRef(d,t.getReferencePlaneRotation(),d);var f=d.scale(s*i.getBoundingRadius());a.getTransform().setAbsolutePosition(i.getTransform().getAbsolutePosition().add(f)),t.translateEverythingNow(a.getTransform().getAbsolutePosition().negate()),a.getTransform().setAbsolutePosition(o.Pq.Zero()),(0,P.t5)(a.getTransform(),i.getTransform().getAbsolutePosition(),this.scene.useRightHandedSystem)}var p=null==(S=this.spaceshipControls)?void 0:S.getSpaceship(),m=null!=(C=null==p||null==(T=p.getInternals().getWarpDrive())?void 0:T.rangeLY)?C:0,v=!0,y=!1,g=void 0;try{for(var S,T,C,I,E=(0,w.f)(t.model.coordinates,Math.min(m,ee.w.VISIBLE_NEIGHBORHOOD_MAX_RADIUS_LY),this.starSystemDatabase)[Symbol.iterator]();!(v=(I=E.next()).done);v=!0){var R=I.value,N=this.getStarSystem().addSystemTarget(R.coordinates,this.starSystemDatabase);null!==N&&this.targetCursorLayer.addObject(N)}}catch(e){y=!0,g=e}finally{try{v||null==E.return||E.return()}finally{if(y)throw g}}if(null!==this.player.currentItinerary){var O=this.player.currentItinerary[1];if((0,u.F)(t.model.coordinates,O)){var L=l.he.safeParse(this.player.currentItinerary.slice(1));L.success?(this.player.currentItinerary=L.data,this.setSystemAsTarget(this.player.currentItinerary[1])):this.player.currentItinerary=null}}this.onInitStarSystem.notifyObservers(),this.scene.getEngine().loadingScreen.hideLoadingUI(),this._isLoadingSystem=!1}},{key:"resetPlayer",value:function(){return eh(function(){var e,t,n,r,o;return ep(this,function(a){switch(a.label){case 0:if(this.postProcessManager.reset(),e=1e5*ee.w.EARTH_RADIUS,null===this.defaultControls&&(this.defaultControls=new y.w(this.scene),this.defaultControls.speed=.2*ee.w.EARTH_RADIUS,this.defaultControls.getCameras().forEach(function(t){return t.maxZ=e})),void 0===(t=this.player.serializedSpaceships.shift()))throw Error("No spaceship serialized in player");if(n=R.Z.Deserialize(t,this.player.spareSpaceshipComponents,this.scene,this.assets,this.soundPlayer),this.player.instancedSpaceships.push(n),null===this.spaceshipControls?(this.spaceshipControls=new E.l(n,this.scene,this.soundPlayer,this.tts),this.spaceshipControls.getCameras().forEach(function(t){return t.maxZ=e})):(r=this.spaceshipControls.getSpaceship(),this.spaceshipControls.reset(),this.spaceshipControls.setSpaceship(n),r.dispose(this.soundPlayer)),null!==this.characterControls)return[3,3];if(ef(o=this.assets.objects.characters.default.instantiateHierarchy(null),i.e))return[3,2];return[4,(0,O.sQ)("Character model is not a mesh!",this.soundPlayer)];case 1:return a.sent(),[3,3];case 2:this.characterControls=new m.Y(o,this.scene),this.characterControls.getTransform().setEnabled(!1),this.characterControls.getCameras().forEach(function(t){return t.maxZ=e}),a.label=3;case 3:return[4,this.scene.setActiveControls(this.spaceshipControls)];case 4:return a.sent(),[2]}})}).call(this)}},{key:"isJumpingBetweenSystems",value:function(){return this.jumpLock}},{key:"isLoadingSystem",value:function(){return this._isLoadingSystem}},{key:"updateBeforePhysics",value:function(e){if(!this._isLoadingSystem){var t=this.getStarSystem();this.chunkForge.update(this.assets),t.update(e,this.chunkForge);var n=t.getNearestCelestialBody(this.scene.getActiveControls().getActiveCamera().globalPosition);this.postProcessManager.setCelestialBody(n),this.postProcessManager.update(e)}}},{key:"updateBeforeRender",value:function(e){var t,n,r,i=this;if(!this._isLoadingSystem){var a=this.getStarSystem();if(null===this.spaceshipControls)throw Error("Spaceship controls is null");if(null===this.characterControls)throw Error("Character controls is null");this.scene.getActiveControls().getActiveCamera()!==this.scene.activeCamera&&(null==(n=this.scene.activeCamera)||n.detachControl(),this.scene.setActiveCamera(this.scene.getActiveControls().getActiveCamera()));var s=a.getNearestOrbitalObject(this.scene.getActiveControls().getTransform().getAbsolutePosition()),l=a.getNearestCelestialBody(this.scene.getActiveControls().getTransform().getAbsolutePosition()),u=this.spaceshipControls.getSpaceship(),d=u.getInternals().getDiscoveryScanner();if(null!==d&&(0,es.Z)(d,this.scene.getActiveControls().getTransform().getAbsolutePosition(),l)){var f=(0,h.Ei)(l.model,a.model);this.player.addVisitedObjectIfNew(f)&&((0,L.UI)(L.I9.EXPLORATION,L.yg.SUCCESS,D.A.t("notifications:newDiscovery",{objectName:l.model.name}),15e3,this.soundPlayer),this.tts.enqueueSay(p.yT.CHARLOTTE,p.bm.NEW_DISCOVERY),this.onNewDiscovery.notifyObservers(f))}u.setNearestOrbitalObject(s),u.setNearestCelestialBody(l);var m=u.getInternals().getWarpDrive();null!==m&&m.isEnabled()?this.spaceShipLayer.displaySpeed(m.getThrottle(),u.getSpeed()):this.spaceShipLayer.displaySpeed(u.getThrottle(),u.getSpeed());var v=this.targetCursorLayer.getTarget(),y=null!==v?(0,$.GI)(o.Pq.Distance(this.spaceshipControls.getTransform().getAbsolutePosition(),v.getTransform().getAbsolutePosition())):0,g=null!=(r=null==m?void 0:m.getHyperJumpFuelConsumption(y))?r:0;this.spaceShipLayer.displayFuel(u.getRemainingFuel()/u.getTotalFuelCapacity(),g/u.getTotalFuelCapacity()),this.characterControls.setClosestWalkableObject(s),u.setClosestWalkableObject(s),s.type===c.T.SPACE_STATION||s.type===c.T.SPACE_ELEVATOR?this.spaceshipControls.setClosestLandableFacility(s):this.spaceshipControls.setClosestLandableFacility(null),this.orbitRenderer.update(this.getStarSystem().getReferencePlaneRotation());var b={currentSystem:a,currentItinerary:this.player.currentItinerary,playerPosition:this.scene.getActiveControls().getTransform().getAbsolutePosition(),physicsEngine:this.scene.getPhysicsEngine()},S=[];this.player.currentMissions.forEach(function(e){!e.isCompleted()&&(e.update(b),e.isCompleted()&&(i.player.earn(e.getReward()),i.tts.enqueueSay(p.yT.CHARLOTTE,p.bm.MISSION_COMPLETE),S.push(e)))}),(t=this.player.completedMissions).push.apply(t,function(e){if(Array.isArray(e))return ec(e)}(S)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(S)||function(e,t){if(e){if("string"==typeof e)return ec(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ec(e,t)}}(S)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),this.player.currentMissions=this.player.currentMissions.filter(function(e){return!e.isCompleted()});var w=a.getStellarObjects().map(function(e){return e.getLight()});this.assets.materials.butterfly.update(w,this.scene.getActiveControls().getTransform().getAbsolutePosition(),e),this.assets.materials.butterflyDepth.update(w,this.scene.getActiveControls().getTransform().getAbsolutePosition(),e),this.assets.materials.grass.update(w,this.scene.getActiveControls().getTransform().getAbsolutePosition(),e),this.assets.materials.grassDepth.update(w,this.scene.getActiveControls().getTransform().getAbsolutePosition(),e)}}},{key:"updateAfterRender",value:function(){var e=this;if(!this._isLoadingSystem){var t=this.getStarSystem();if(null===this.spaceshipControls)throw Error("Spaceship controls is null");if(null===this.characterControls)throw Error("Character controls is null");var n=this.scene.getActiveControls(),r=this.spaceshipControls.getSpaceship(),o={currentSystem:t,currentItinerary:this.player.currentItinerary,playerPosition:n.getTransform().getAbsolutePosition(),physicsEngine:this.scene.getPhysicsEngine()};this.spaceShipLayer.update(n.getTransform(),o,this.keyboardLayoutMap,this.starSystemDatabase),this.targetCursorLayer.update(n.getActiveCamera());var i=r.getTargetLandingPad();if(null===i||r.isLanded()||this.targetCursorLayer.getTarget()===i||this.targetCursorLayer.setTarget(i),r.isLandedAtFacility()&&this.isUiEnabled){this.spaceStationLayer.setVisibility(!0);var a=this.spaceshipControls.getClosestLandableFacility();this.getStarSystem().getOrbitalFacilities().find(function(n){return n===a&&(e.spaceStationLayer.setStation(n.model,t.getOrbitalObjects().map(function(e){return e.model}).filter(function(e){return n.model.orbit.parentIds.includes(e.id)}),e.player),!0)})}else this.spaceStationLayer.setVisibility(!1);this.targetCursorLayer.setEnabled(this.isUiEnabled&&!r.isLandedAtFacility()),this.spaceShipLayer.setVisibility(this.isUiEnabled&&n===this.spaceshipControls&&!r.isLandedAtFacility())}}},{key:"getSpaceshipControls",value:function(){if(null===this.spaceshipControls)throw Error("Spaceship controls is null");return this.spaceshipControls}},{key:"getCharacterControls",value:function(){if(null===this.characterControls)throw Error("Character controls is null");return this.characterControls}},{key:"getDefaultControls",value:function(){if(null===this.defaultControls)throw Error("Default controls is null");return this.defaultControls}},{key:"switchToSpaceshipControls",value:function(){return eh(function(){var e,t,n;return ep(this,function(r){switch(r.label){case 0:return e=this.getSpaceshipControls(),t=this.getCharacterControls(),n=this.getDefaultControls(),this.spaceShipLayer.setVisibility(this.isUiEnabled),t.getTransform().setEnabled(!1),v.b.setEnabled(!1),[4,this.scene.setActiveControls(e)];case 1:return r.sent(),(0,P.rD)(e.getTransform(),(0,P.hQ)(n.getTransform()).clone()),e.syncCameraTransform(),e.getSpaceship().setEnabled(!0,this.havokPlugin),N._.setEnabled(!0),[2]}})}).call(this)}},{key:"switchToCharacterControls",value:function(){return eh(function(){var e,t,n,r;return ep(this,function(o){switch(o.label){case 0:return e=this.getSpaceshipControls(),t=this.getCharacterControls(),n=this.getDefaultControls(),this.spaceShipLayer.setVisibility(!1),t.getTransform().setEnabled(!0),v.b.setEnabled(!0),t.getTransform().setAbsolutePosition(n.getTransform().absolutePosition),[4,this.scene.setActiveControls(t)];case 1:return o.sent(),(0,P.rD)(t.getTransform(),(0,P.hQ)(n.getTransform()).clone()),(r=e.getSpaceship()).warpTunnel.setThrottle(0),r.setEnabled(!1,this.havokPlugin),N._.setEnabled(!1),this.stopBackgroundSounds(),[2]}})}).call(this)}},{key:"switchToDefaultControls",value:function(e){return eh(function(){var t,n,r,o,i,a,s,l,c,u;return ep(this,function(h){switch(h.label){case 0:return t=this.getSpaceshipControls(),n=this.getCharacterControls(),r=this.getDefaultControls(),[4,(0,k.t)()];case 1:return o=h.sent(),this.spaceShipLayer.setVisibility(!1),n.getTransform().setEnabled(!1),v.b.setEnabled(!1),(i=t.getSpaceship()).warpTunnel.setThrottle(0),i.setEnabled(!1,this.havokPlugin),N._.setEnabled(!1),this.stopBackgroundSounds(),[4,this.scene.setActiveControls(r)];case 2:return h.sent(),(0,P.rD)(r.getTransform(),(0,P.hQ)(t.getTransform()).clone()),e&&(l=(0,T.Fd)(null==(a=g.Z.map.move.bindings["0"])?void 0:a.control,o),c=(0,T.Lc)(null==(s=g.Z.map.upDown.bindings["0"])?void 0:s.control,o),u=l.concat(c),(0,L.UI)(L.I9.GENERAL,L.yg.INFO,"Move using ".concat(u.map(function(e){return e[1].replace("Key","")}).join(", ")),2e4,this.soundPlayer)),[2]}})}).call(this)}},{key:"stopBackgroundSounds",value:function(){var e=this.getSpaceshipControls().getSpaceship();e.acceleratingWarpDriveSound.setVolume(0),e.deceleratingWarpDriveSound.setVolume(0),e.thrusterSound.setVolume(0)}},{key:"getStarSystem",value:function(){if(null===this.starSystem)throw Error("Star system not initialized");return this.starSystem}},{key:"hideHtmlUI",value:function(){this.spaceShipLayer.setVisibility(!1),this.targetCursorLayer.setEnabled(!1),this.spaceStationLayer.setVisibility(!1)}},{key:"setUIEnabled",value:function(e){this.isUiEnabled=e}},{key:"setTarget",value:function(e){if(this.targetCursorLayer.getTarget()===e){this.spaceShipLayer.setTarget(null),this.targetCursorLayer.setTarget(null),this.soundPlayer.playNow(f.Wo.TARGET_UNLOCK);return}null!==e&&(this.spaceShipLayer.setTarget(e.getTransform()),this.targetCursorLayer.setTarget(e),this.soundPlayer.playNow(f.Wo.TARGET_LOCK))}},{key:"setSystemAsTarget",value:function(e){var t=this.getStarSystem().getSystemTargets().find(function(t){return(0,u.F)(t.systemCoordinates,e)});if(void 0===t){var n=this.getStarSystem().addSystemTarget(e,this.starSystemDatabase);null!==n&&(t=n,this.targetCursorLayer.addObject(t))}void 0!==t&&(this.targetCursorLayer.setTarget(t,!0),this.spaceShipLayer.setTarget(t.getTransform(),!0))}},{key:"render",value:function(){this.scene.render()}},{key:"attachControl",value:function(){this.scene.attachControl()}},{key:"detachControl",value:function(){this.scene.detachControl(),this.hideHtmlUI()}},{key:"getMainScene",value:function(){return this.scene}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},21080:function(e,t,n){"use strict";n.d(t,{b:()=>em}),n(56654),n(75781);var r=n(50355),o=n(52502),i=n(47402),a=n(90767),s=n(92771),l=n(28995),c=n(36801),u=n(60333),h=n(90718),d=n(48462),f=n(79076),p=n(16713),m=n(97348),v=n(61741),y=n(42503),g=n(76448),b=n(53843),S=n(14265),w=n(13298),T=n(32648);function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");A(this,"elapsedSeconds",0),A(this,"duration",void 0),A(this,"startRadius",void 0),A(this,"targetRadius",void 0),A(this,"camera",void 0),this.camera=e,this.duration=r,this.startRadius=e.radius,this.targetRadius=n}return e=[{key:"update",value:function(e){if(!this.isFinished()){this.elapsedSeconds+=e;var t=(0,w.qE)(this.elapsedSeconds/this.duration,0,1);this.camera.radius=(0,S.Lerp)(this.startRadius,this.targetRadius,(0,T.M2)(t))}}},{key:"isFinished",value:function(){return this.elapsedSeconds>=this.duration}},{key:"getProgress",value:function(){return this.elapsedSeconds/this.duration}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),C=n(34041),I=n(43548),E=n(9323),R=n(81629),N=n(12577),O=n(57836),L=n(13679);n(10426);var x=n(11569),M=n(74334),_=n(36044),k=n(34547);function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");j(this,"transform",void 0),j(this,"thirdPersonCamera",void 0),j(this,"speed",10),j(this,"inertia",c.Pq.Zero()),j(this,"scene",void 0),this.scene=e,this.transform=new _.VR0("starMapControls",e),this.transform.rotationQuaternion=M.PT.Identity(),this.thirdPersonCamera=new x.Lq("camera",0,Math.PI/2,10,c.Pq.Zero(),e),this.thirdPersonCamera.lowerRadiusLimit=5,this.thirdPersonCamera.upperRadiusLimit=1e5,this.thirdPersonCamera.minZ=1,this.thirdPersonCamera.maxZ=5*L.w.EARTH_RADIUS,this.thirdPersonCamera.wheelPrecision*=3,this.thirdPersonCamera.panningSensibility=0,this.thirdPersonCamera.parent=this.transform}return e=[{key:"getActiveCamera",value:function(){return this.thirdPersonCamera}},{key:"getCameras",value:function(){return[this.thirdPersonCamera]}},{key:"getTransform",value:function(){return this.transform}},{key:"shouldLockPointer",value:function(){return!1}},{key:"update",value:function(e){var t,n=(t=k.S.map.move.value,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(t,2)||function(e,t){if(e){if("string"==typeof e)return D(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=n[0],o=n[1];this.inertia.x=(0,T.aJ)(this.inertia.x,r,.15,e),this.inertia.z=(0,T.aJ)(this.inertia.z,o,.15,e);var i=k.S.map.upDown.value;this.inertia.y=(0,T.aJ)(this.inertia.y,i,.15,e),this.speed*=1+k.S.map.changeSpeed.value/20;var a=this.thirdPersonCamera.getDirection(c.Pq.Forward(this.scene.useRightHandedSystem)),s=this.thirdPersonCamera.getDirection(c.Pq.Right()),l=this.thirdPersonCamera.getDirection(c.Pq.Up()),u=a.scaleInPlace(this.inertia.z*e*this.speed).addInPlace(s.scaleInPlace(this.inertia.x*e*this.speed)).addInPlace(l.scaleInPlace(this.inertia.y*e*this.speed));return this.transform.position.addInPlace(u),u}},{key:"getSpeed",value:function(){return this.speed}},{key:"dispose",value:function(){this.transform.dispose(),this.thirdPersonCamera.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),U=n(96069),G=n(27460),B=n(78706);function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Y=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");H(this,"rootNode",void 0),H(this,"player",void 0),H(this,"selectedSystemCoordinates",null),H(this,"isSelectedSystemBookmarked",!1),this.rootNode=document.createElement("button"),this.rootNode.classList.add("bookmarkButton"),this.rootNode.textContent=B.A.t("starMap:bookmark"),this.player=e,this.rootNode.addEventListener("click",function(){if(null!==r.selectedSystemCoordinates){n.playNow(g.Wo.CLICK);var e=r.selectedSystemCoordinates;r.isSelectedSystemBookmarked?(r.player.systemBookmarks=r.player.systemBookmarks.filter(function(t){return!(0,y.F)(t,e)}),r.rootNode.classList.remove("bookmarked"),r.rootNode.textContent=B.A.t("starMap:bookmark")):(r.player.systemBookmarks.push(r.selectedSystemCoordinates),r.rootNode.classList.add("bookmarked"),r.rootNode.textContent=B.A.t("starMap:bookmarked")),r.isSelectedSystemBookmarked=!r.isSelectedSystemBookmarked}})}return e=[{key:"setSelectedSystemSeed",value:function(e){this.selectedSystemCoordinates=e,this.isSelectedSystemBookmarked=void 0!==this.player.systemBookmarks.find(function(t){return(0,y.F)(t,e)}),this.rootNode.classList.toggle("bookmarked",this.isSelectedSystemBookmarked),this.rootNode.textContent=this.isSelectedSystemBookmarked?B.A.t("starMap:bookmarked"):B.A.t("starMap:bookmark")}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function W(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var q=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");z(this,"htmlRoot",void 0),z(this,"systemCoordinates",void 0),z(this,"bookmarkIcon",void 0),z(this,"missionIcon",void 0),z(this,"iconMask",void 0),this.systemCoordinates=e,this.iconMask=t,this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("systemIcons"),this.bookmarkIcon=document.createElement("div"),this.bookmarkIcon.classList.add("bookmarkIcon"),1&t&&this.htmlRoot.appendChild(this.bookmarkIcon),this.missionIcon=document.createElement("div"),this.missionIcon.classList.add("missionIcon"),2&t&&this.htmlRoot.appendChild(this.missionIcon)}return e=[{key:"update",value:function(e,t){this.systemCoordinates=e;var n=1&this.iconMask,r=1&t;r&&!n?this.htmlRoot.appendChild(this.bookmarkIcon):!r&&n&&this.bookmarkIcon.remove();var o=2&this.iconMask,i=2&t;i&&!o?this.htmlRoot.appendChild(this.missionIcon):!i&&o&&this.missionIcon.remove(),this.iconMask=t}},{key:"getSystemCoordinates",value:function(){return this.systemCoordinates}},{key:"dispose",value:function(){this.htmlRoot.remove()}}],t=[{key:"IconMaskForSystem",value:function(e,t,n){var r=0;return t.find(function(t){return(0,y.F)(t,e)})&&(r|=1),n.find(function(t){return(0,y.F)(t,e)})&&(r|=2),r}}],e&&W(n.prototype,e),t&&W(n,t),n}();function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var J=function(){var e;function t(e,n,r,o){var i=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");V(this,"htmlRoot",void 0),V(this,"hoveredSystemCursorContainer",void 0),V(this,"hoveredSystemCursor",void 0),V(this,"selectedSystemCursorContainer",void 0),V(this,"selectedSystemCursor",void 0),V(this,"currentSystemCursorContainer",void 0),V(this,"currentSystemCursor",void 0),V(this,"infoPanel",void 0),V(this,"infoPanelStarPreview",void 0),V(this,"infoPanelTitle",void 0),V(this,"starSector",void 0),V(this,"nbPlanets",void 0),V(this,"distanceToSol",void 0),V(this,"humanPresence",void 0),V(this,"nbSpaceStations",void 0),V(this,"factions",void 0),V(this,"cursor",void 0),V(this,"shortHandUI",void 0),V(this,"shortHandUITitle",void 0),V(this,"shortHandUISystemType",void 0),V(this,"shortHandUIDistanceFromCurrent",void 0),V(this,"shortHandUIFactions",void 0),V(this,"shortHandUIButtonContainer",void 0),V(this,"shortHandUIPlotItineraryButton",void 0),V(this,"shortHandUIBookmarkButton",void 0),V(this,"selectedSystem",null),V(this,"hoveredSystem",null),V(this,"currentSystem",null),V(this,"systemIcons",[]),V(this,"scene",void 0),V(this,"player",void 0),V(this,"starSystemDatabase",void 0),V(this,"onSystemFocusObservable",new d.cP),this.scene=e,this.scene.hoverCursor="none",this.player=n,this.starSystemDatabase=r,this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("starMapUI"),document.body.appendChild(this.htmlRoot),this.selectedSystemCursorContainer=document.createElement("div"),this.selectedSystemCursorContainer.classList.add("targetCursorRoot"),this.htmlRoot.appendChild(this.selectedSystemCursorContainer),this.selectedSystemCursor=document.createElement("div"),this.selectedSystemCursor.classList.add("targetCursor","rounded"),this.selectedSystemCursorContainer.appendChild(this.selectedSystemCursor),this.selectedSystemCursor.addEventListener("click",function(){null!==i.selectedSystem&&i.onSystemFocusObservable.notifyObservers(i.selectedSystem)}),this.hoveredSystemCursorContainer=document.createElement("div"),this.hoveredSystemCursorContainer.classList.add("targetCursorRoot"),this.htmlRoot.appendChild(this.hoveredSystemCursorContainer),this.hoveredSystemCursor=document.createElement("div"),this.hoveredSystemCursor.classList.add("targetCursor","rounded"),this.hoveredSystemCursorContainer.appendChild(this.hoveredSystemCursor),this.hoveredSystemCursor.addEventListener("click",function(){null!==i.hoveredSystem&&i.onSystemFocusObservable.notifyObservers(i.hoveredSystem)}),this.currentSystemCursorContainer=document.createElement("div"),this.currentSystemCursorContainer.classList.add("targetCursorRoot"),this.htmlRoot.appendChild(this.currentSystemCursorContainer),this.currentSystemCursor=document.createElement("div"),this.currentSystemCursor.classList.add("targetCursor","rounded","target"),this.currentSystemCursorContainer.appendChild(this.currentSystemCursor),this.currentSystemCursor.addEventListener("click",function(){null!==i.currentSystem&&i.onSystemFocusObservable.notifyObservers(i.currentSystem)}),this.cursor=document.createElement("div"),this.cursor.classList.add("targetCursor"),this.infoPanel=document.createElement("div"),this.infoPanel.classList.add("starMapInfoPanel"),this.htmlRoot.appendChild(this.infoPanel),this.infoPanelStarPreview=document.createElement("div"),this.infoPanelStarPreview.classList.add("starMapInfoPanelStarPreview"),this.infoPanel.appendChild(this.infoPanelStarPreview),this.infoPanelTitle=document.createElement("h1"),this.infoPanelTitle.classList.add("starMapInfoPanelTitle"),this.infoPanel.appendChild(this.infoPanelTitle);var a=document.createElement("hr");this.infoPanel.appendChild(a),this.starSector=document.createElement("p"),this.starSector.classList.add("starMapInfoPanelStarSector"),this.infoPanel.appendChild(this.starSector);var s=document.createElement("hr");this.infoPanel.appendChild(s);var l=document.createElement("h2");l.textContent=B.A.t("starMap:generalInfo"),this.infoPanel.appendChild(l),this.nbPlanets=document.createElement("p"),this.nbPlanets.classList.add("starMapInfoPanelNbPlanets"),this.infoPanel.appendChild(this.nbPlanets),this.distanceToSol=document.createElement("p"),this.distanceToSol.classList.add("starMapInfoPanelDistanceToSol"),this.infoPanel.appendChild(this.distanceToSol),this.humanPresence=document.createElement("div"),this.humanPresence.classList.add("starMapInfoPanelHumanPresence"),this.infoPanel.appendChild(this.humanPresence);var c=document.createElement("h2");c.textContent=B.A.t("starMap:humanPresence"),this.humanPresence.appendChild(c),this.nbSpaceStations=document.createElement("p"),this.nbSpaceStations.classList.add("starMapInfoPanelNbSpaceStations"),this.humanPresence.appendChild(this.nbSpaceStations),this.factions=document.createElement("p"),this.factions.classList.add("starMapInfoPanelFactions"),this.humanPresence.appendChild(this.factions),this.cursor=document.createElement("div"),this.cursor.classList.add("cursor"),this.htmlRoot.appendChild(this.cursor),this.shortHandUI=document.createElement("div"),this.shortHandUI.classList.add("shortHandUI"),this.htmlRoot.appendChild(this.shortHandUI),this.shortHandUITitle=document.createElement("h2"),this.shortHandUI.appendChild(this.shortHandUITitle),this.shortHandUISystemType=document.createElement("p"),this.shortHandUI.appendChild(this.shortHandUISystemType),this.shortHandUIDistanceFromCurrent=document.createElement("p"),this.shortHandUI.appendChild(this.shortHandUIDistanceFromCurrent),this.shortHandUIFactions=document.createElement("p"),this.shortHandUI.appendChild(this.shortHandUIFactions),this.shortHandUIButtonContainer=document.createElement("div"),this.shortHandUIButtonContainer.classList.add("buttonContainer"),this.shortHandUI.appendChild(this.shortHandUIButtonContainer),this.shortHandUIPlotItineraryButton=document.createElement("button"),this.shortHandUIPlotItineraryButton.classList.add("plotItineraryButton"),this.shortHandUIPlotItineraryButton.textContent=B.A.t("starMap:plotItinerary"),this.shortHandUIButtonContainer.appendChild(this.shortHandUIPlotItineraryButton),this.shortHandUIBookmarkButton=new Y(n,o),this.shortHandUIButtonContainer.appendChild(this.shortHandUIBookmarkButton.rootNode),document.addEventListener("pointermove",function(e){i.cursor.style.transform="translate(calc(".concat(e.clientX,"px - 50%), calc(").concat(e.clientY,"px - 50%))")})}return e=[{key:"update",value:function(e,t){var n=this,r=this.scene.getEngine().getRenderWidth(),o=this.scene.getEngine().getRenderHeight(),i=this.scene.activeCamera;if(null===i)throw Error("No active camera found");if(this.rebuildSystemIcons(),this.systemIcons.forEach(function(r){var o=(0,b.tr)(n.starSystemDatabase.getSystemGalacticPosition(r.getSystemCoordinates())).add(t),a=c.Pq.Project(o,c.uq.IdentityReadOnly,i.getTransformationMatrix(),i.viewport);r.htmlRoot.classList.toggle("transparent",a.z<0),r.htmlRoot.style.left="".concat(100*a.x,"vw"),r.htmlRoot.style.top="".concat(100*a.y,"vh");var s=Math.max(40/c.Pq.Distance(o,e),3);r.htmlRoot.style.transform="translate(calc(-50% - ".concat(s,"vw), -50%)")}),this.shortHandUIPlotItineraryButton.disabled=null!==this.selectedSystem&&null!==this.currentSystem&&(0,y.F)(this.selectedSystem,this.currentSystem),null!==this.selectedSystem){var a=(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(this.selectedSystem)).addInPlace(t),s=c.Pq.Project(a,c.uq.IdentityReadOnly,i.getTransformationMatrix(),i.viewport);this.selectedSystemCursorContainer.classList.toggle("transparent",s.z<0||null!==this.currentSystem&&(0,y.F)(this.selectedSystem,this.currentSystem)),this.selectedSystemCursorContainer.style.left="".concat(100*s.x,"vw"),this.selectedSystemCursorContainer.style.top="".concat(100*s.y,"vh");var l=c.Pq.Distance(a,e),u=Math.max(5,100/l);this.selectedSystemCursorContainer.style.setProperty("--dim","".concat(u,"vh"));var h=Math.max(25,500/l);this.shortHandUI.style.visibility=s.z>=0?"visible":"hidden",this.shortHandUI.style.transform="translate(calc(".concat((s.x*r).toFixed(0),"px + ").concat(h,"px), calc(").concat((s.y*o).toFixed(0),"px - 50%))")}else this.shortHandUI.style.visibility="hidden",this.selectedSystemCursorContainer.classList.add("transparent");if(null===this.hoveredSystem||null===this.currentSystem||(0,y.F)(this.hoveredSystem,this.currentSystem))this.hoveredSystemCursorContainer.classList.add("transparent");else{var d=(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(this.hoveredSystem)).addInPlace(t),f=c.Pq.Project(d,c.uq.IdentityReadOnly,i.getTransformationMatrix(),i.viewport);this.hoveredSystemCursorContainer.classList.toggle("transparent",f.z<0),this.hoveredSystemCursorContainer.style.left="".concat(100*f.x,"vw"),this.hoveredSystemCursorContainer.style.top="".concat(100*f.y,"vh");var p=Math.max(5,100/c.Pq.Distance(d,e));this.hoveredSystemCursorContainer.style.setProperty("--dim","".concat(p,"vh"))}if(null!==this.currentSystem){var m=(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(this.currentSystem)).addInPlace(t),v=c.Pq.Project(m,c.uq.IdentityReadOnly,i.getTransformationMatrix(),i.viewport);this.currentSystemCursorContainer.classList.toggle("transparent",v.z<0),this.currentSystemCursorContainer.style.left="".concat(100*v.x,"vw"),this.currentSystemCursorContainer.style.top="".concat(100*v.y,"vh");var g=Math.max(5,100/c.Pq.Distance(m,e));this.currentSystemCursorContainer.style.setProperty("--dim","".concat(g,"vh"))}else this.currentSystemCursorContainer.classList.add("transparent")}},{key:"setHoveredSystem",value:function(e){e!==this.currentSystem&&e!==this.selectedSystem&&(this.hoveredSystem=e)}},{key:"setCurrentSystem",value:function(e){this.currentSystem=e}},{key:"setSelectedSystem",value:function(e,t){this.selectedSystem=e.coordinates;var n=(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(e.coordinates));if(null!==t){var r=(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(t));this.shortHandUIDistanceFromCurrent.textContent="".concat(B.A.t("starMap:distanceFromCurrent"),": ").concat(B.A.t("units:shortLy",{value:c.Pq.Distance(r,n).toFixed(1)}))}var o=e.stellarObjects[0];this.shortHandUISystemType.textContent=(0,G.d)(o),this.shortHandUIBookmarkButton.setSelectedSystemSeed(e.coordinates);var i=(0,O.C)(o.blackBodyTemperature),a=new l.v9(i.r,i.g,i.b).toHexString();if(this.infoPanelStarPreview.style.background=a,this.infoPanelStarPreview.style.boxShadow="0 0 20px ".concat(a),this.infoPanelTitle.textContent=e.name,this.shortHandUITitle.textContent=e.name,this.starSector.innerText="X:".concat(e.coordinates.starSectorX," Y:").concat(e.coordinates.starSectorY," Z:").concat(e.coordinates.starSectorZ,"\n            x:").concat(e.coordinates.localX.toFixed(2)," y:").concat(e.coordinates.localY.toFixed(2)," z:").concat(e.coordinates.localZ.toFixed(2)),this.nbPlanets.textContent="".concat(B.A.t("starMap:planets"),": ").concat(e.planets.length),this.distanceToSol.textContent="".concat(B.A.t("starMap:distanceToSol"),": ").concat(B.A.t("units:shortLy",{value:c.Pq.Distance(n,c.Pq.Zero()).toFixed(1)})),this.starSystemDatabase.isSystemInHumanBubble(e.coordinates)){var s=e.orbitalFacilities;this.nbSpaceStations.textContent="".concat(B.A.t("starMap:spaceStations"),": ").concat(s.length);var u=Array.from(new Set(s.map(function(e){return(0,U.fy)(e.faction)})));u.length>0?(this.factions.textContent="".concat(B.A.t("starMap:factions"),": ").concat(u.join(", ")),this.shortHandUIFactions.textContent="".concat(B.A.t("starMap:factions"),": ").concat(u.join(", "))):(this.factions.textContent="".concat(B.A.t("starMap:factions"),": ").concat(B.A.t("starMap:none")),this.shortHandUIFactions.textContent="".concat(B.A.t("starMap:factions"),": ").concat(B.A.t("starMap:none")))}else this.nbSpaceStations.textContent="".concat(B.A.t("starMap:spaceStations"),": 0"),this.factions.textContent="".concat(B.A.t("starMap:factions"),": ").concat(B.A.t("starMap:none")),this.shortHandUIFactions.textContent="".concat(B.A.t("starMap:factions"),": ").concat(B.A.t("starMap:none"))}},{key:"rebuildSystemIcons",value:function(){var e=this,t=this.player.systemBookmarks,n=this.player.currentMissions.flatMap(function(e){return e.getTargetSystems()}),r=t.concat(n).filter(function(e,t,n){return n.findIndex(function(t){return(0,y.F)(t,e)})===t}),o=[];this.systemIcons.forEach(function(e){var i=e.getSystemCoordinates();r.includes(i)?(e.update(i,q.IconMaskForSystem(i,t,n)),o.push(e),r.splice(r.indexOf(i),1)):e.dispose()}),this.systemIcons=o,r.forEach(function(r){var o=new q(r,q.IconMaskForSystem(r,t,n));o.htmlRoot.addEventListener("click",function(){e.onSystemFocusObservable.notifyObservers(o.getSystemCoordinates())}),e.htmlRoot.appendChild(o.htmlRoot),e.systemIcons.push(o)})}},{key:"dispose",value:function(){this.scene.dispose(),this.htmlRoot.remove()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),X=n(37004);function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e){return"".concat(e.x,",").concat(e.y,",").concat(e.z)}var $=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");K(this,"starInstances",[]),K(this,"blackHoleInstances",[]),K(this,"coordinates",void 0),K(this,"position",void 0),K(this,"systems",void 0),this.coordinates=e,this.position=e.scale(L.w.STAR_SECTOR_SIZE);var r=t.getSystemModelsInStarSector(this.coordinates.x,this.coordinates.y,this.coordinates.z);this.systems=r.map(function(e){return{model:e,position:(0,b.tr)(t.getSystemGalacticPosition(e.coordinates))}})}return e=[{key:"generate",value:function(){var e=this.getKey();return this.systems.map(function(t){var n=t.model,r=t.position;return{coordinates:n.coordinates,sectorString:e,position:r}})}},{key:"getKey",value:function(){return Q(this.coordinates)}}],t=[{key:"GetBoundingBox",value:function(e,t){return new X.I(new c.Pq(-1,-1,-1).scaleInPlace(L.w.STAR_SECTOR_SIZE/2),new c.Pq(1,1,1).scaleInPlace(L.w.STAR_SECTOR_SIZE/2),c.uq.Translation(e.x+t.x,e.y+t.y,e.z+t.z))}}],e&&Z(n.prototype,e),t&&Z(n,t),n}(),ee=n(4035),et=n(45321),en=n(85303);function er(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var eo=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");er(this,"startSystem",null),er(this,"targetSystem",null),er(this,"coordinatesToPrevious",new Map),er(this,"openList",new et.M(function(e,t){return e.G+e.H<t.G+t.H})),er(this,"closedList",[]),er(this,"jumpRange",10),er(this,"hasPath",!1),er(this,"nbIterations",0),er(this,"lastExploredNode",null),er(this,"starSystemDatabase",void 0),this.starSystemDatabase=e}return e=[{key:"init",value:function(e,t,n){this.coordinatesToPrevious.clear(),this.openList.clear(),this.closedList=[],this.hasPath=!1,this.nbIterations=0,this.lastExploredNode=null,this.startSystem={coordinates:e,position:(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(e))},this.targetSystem={coordinates:t,position:(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(t))},this.jumpRange=n}},{key:"hasBeenInit",value:function(){return null!==this.startSystem&&null!==this.targetSystem}},{key:"getHeuristic",value:function(e){var t=e.position;if(null===this.targetSystem)throw Error("Target system is undefined");var n=this.targetSystem.position;return c.Pq.Distance(t,n)}},{key:"getNeighbors",value:function(e){return(0,ee.f)(e.coordinates,this.jumpRange,this.starSystemDatabase).map(function(e){return{node:{coordinates:e.coordinates,position:e.position,G:0,H:0},distance:e.distance}})}},{key:"update",value:function(){if(null===this.startSystem||null===this.targetSystem)throw Error("Cannot update pathfinder without initializing it first");0===this.openList.size()&&this.openList.push({coordinates:this.startSystem.coordinates,position:this.startSystem.position,G:0,H:0});var e=this.openList.pop();if(void 0===e)throw Error("No more nodes to explore");if(this.closedList.push(e),this.lastExploredNode=e,(0,y.F)(e.coordinates,this.targetSystem.coordinates)){this.hasPath=!0;return}var t=this.getNeighbors(e),n=!0,r=!1,o=void 0;try{for(var i,a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)i=this,function(){var t=a.value,n=t.node,r=t.distance;if(!i.closedList.find(function(e){return(0,y.F)(e.coordinates,n.coordinates)})){var o=e.G+r,s=i.getHeuristic(n),l=i.openList.find(function(e){return(0,y.F)(e.coordinates,n.coordinates)});void 0!==l?o<l.G&&(l.G=o,l.H=s,i.coordinatesToPrevious.set(JSON.stringify(n.coordinates),e.coordinates)):(i.openList.push({coordinates:n.coordinates,position:n.position,G:o,H:s}),i.coordinatesToPrevious.set(JSON.stringify(n.coordinates),e.coordinates))}}()}catch(e){r=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}this.hasPath=!1,this.nbIterations++}},{key:"getPath",value:function(){if(null===this.startSystem||null===this.targetSystem)return(0,en._q)(Error("Cannot get path without initializing the pathfinder first"));if(!this.hasPath)return(0,en._q)(Error("No path found"));for(var e=[],t=this.targetSystem.coordinates;t!==this.startSystem.coordinates;){if(e.length>=0x100000000)return(0,en._q)(Error("Path between ".concat(JSON.stringify(this.startSystem.coordinates)," and ").concat(JSON.stringify(this.targetSystem.coordinates)," is too long, exceeding 2^32 elements! There might be a loop somewhere...")));e.push(t);var n=this.coordinatesToPrevious.get(JSON.stringify(t));if(void 0===n)return(0,en._q)(Error("Could not find a path to the target system"));t=n}return e.push(this.startSystem.coordinates),(0,en.ok)(e.reverse())}},{key:"getNbIterations",value:function(){return this.nbIterations}},{key:"hasFoundPath",value:function(){return this.hasPath}},{key:"getProgress",value:function(){if(null===this.startSystem||null===this.targetSystem)throw Error("Cannot get progress without initializing the pathfinder first");if(null===this.lastExploredNode)return 0;var e=this.startSystem.position,t=this.targetSystem.position,n=this.lastExploredNode.position,r=c.Pq.Distance(e,t);return 1-Math.max(0,Math.min(1,c.Pq.Distance(t,n)/r))}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),ei=n(35543);function ea(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var es=function(){var e;function t(e,n,r){var o=n.points,i=n.thickness,s=n.color;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");ea(this,"name",void 0),ea(this,"points",[]),ea(this,"cylinders",[]),ea(this,"material",void 0),ea(this,"thickness",void 0),ea(this,"scene",void 0),this.name=e,this.thickness=null!=i?i:.1,this.scene=r,this.material=new a.F("".concat(e,"Material"),r),this.material.emissiveColor=null!=s?s:l.v9.White(),this.setPoints(o)}return e=[{key:"setPoints",value:function(e){this.points=e;var t=Math.max(0,this.points.length-1),n=this.cylinders.length;if(t<n){for(var r,o=t;o<n;o++)null==(r=this.cylinders[o])||r.dispose();this.cylinders.length=t}if(t>n)for(var i=n;i<t;i++){var a=(0,_.zkL)("".concat(this.name,"Segment").concat(i),{height:1,diameter:this.thickness},this.scene);a.alwaysSelectAsActiveMesh=!0,a.material=this.material,this.cylinders.push(a)}this.init()}},{key:"init",value:function(){for(var e=0;e<this.points.length-1;e++){var t=this.cylinders[e],n=this.points[e],r=this.points[e+1];if(void 0!==t&&void 0!==n&&void 0!==r){var o=n.add(r).scaleInPlace(.5),i=r.subtract(n).length();t.position=o,t.scaling.y=Math.max(0,i-.05),t.lookAt(n),t.rotate(ei._0.X,Math.PI/2,ei.$x.LOCAL)}}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();let el=n.p+"6b0dfb02003b07fb.png",ec=n.p+"81fa7d04dd1de16e.png";function eu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eh(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function ed(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){eh(i,r,o,a,s,"next",e)}function s(e){eh(i,r,o,a,s,"throw",e)}a(void 0)})}}function ef(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ep(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var em=function(){var e;function t(e,n,r,o,i){var v=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");ef(this,"scene",void 0),ef(this,"controls",void 0),ef(this,"rotationAnimation",null),ef(this,"translationAnimation",null),ef(this,"radiusAnimation",null),ef(this,"player",void 0),ef(this,"encyclopaedia",void 0),ef(this,"starSystemDatabase",void 0),ef(this,"starMapCenterPosition",void 0),ef(this,"allowedStarSectorRelativeCoordinates",[]),ef(this,"starTemplate",void 0),ef(this,"blackHoleTemplate",void 0),ef(this,"starBuildStack",[]),ef(this,"recycledStars",[]),ef(this,"recycledBlackHoles",[]),ef(this,"starMapUI",void 0),ef(this,"selectedSystemCoordinates",null),ef(this,"currentSystemCoordinates",null),ef(this,"loadedStarSectors",new Map),ef(this,"coordinatesToInstanceMap",new Map),ef(this,"instanceToCoordinatesMap",new Map),ef(this,"travelLine",void 0),ef(this,"stellarPathfinder",void 0),ef(this,"onTargetSetObservable",new d.cP),ef(this,"currentStarSectorCoordinates",c.Pq.Zero()),ef(this,"cameraPositionToCenter",c.Pq.Zero()),ef(this,"soundPlayer",void 0),this.scene=new p.Z(n),this.scene.clearColor=new l.ov(0,0,0,1),this.scene.useRightHandedSystem=!0,this.scene.onDisposeObservable.addOnce(function(){v.starMapUI.dispose()}),this.soundPlayer=i,this.controls=new F(this.scene),this.controls.getCameras().forEach(function(e){return e.minZ=.01}),this.controls.getActiveCamera().attachControl(),this.player=e,this.encyclopaedia=r,this.starSystemDatabase=o,this.stellarPathfinder=new eo(o),this.starMapUI=new J(this.scene,this.player,this.starSystemDatabase,this.soundPlayer),this.starMapUI.onSystemFocusObservable.add(function(e){v.focusOnSystem(e)}),this.starMapUI.shortHandUIPlotItineraryButton.addEventListener("click",function(){return ed(function(){var e,t,n;return ep(this,function(r){switch(r.label){case 0:if(null!==this.currentSystemCoordinates)return[3,2];return[4,(0,R.sQ)("current system seed is null!",this.soundPlayer)];case 1:case 3:case 5:case 7:return r.sent(),[2];case 2:if(null!==this.selectedSystemCoordinates)return[3,4];return[4,(0,R.sQ)("selected system seed is null!",this.soundPlayer)];case 4:if(void 0!==(e=this.player.instancedSpaceships.at(0)))return[3,6];return[4,(0,R.sQ)("You do not own a spaceship! What have you done???",this.soundPlayer)];case 6:if(null!==(t=e.getInternals().getWarpDrive()))return[3,8];return[4,(0,R.sQ)("Your current spaceship has no warp drive! Install a warp drive to plot an itinerary.",this.soundPlayer)];case 8:if(n=t.rangeLY,(0,y.F)(this.selectedSystemCoordinates,this.currentSystemCoordinates))return[2];return this.soundPlayer.playNow(g.Wo.CLICK),this.stellarPathfinder.init(this.currentSystemCoordinates,this.selectedSystemCoordinates,n),[2]}})}).call(v)}),k.S.map.focusOnCurrentSystem.on("complete",function(){v.focusOnCurrentSystem()});var b=new f.e("pipeline",!1,this.scene,this.controls.getCameras());b.fxaaEnabled=!0,b.bloomEnabled=!0,b.bloomThreshold=0,b.bloomWeight=1.5,b.bloomKernel=128,b.imageProcessing.exposure=1,b.imageProcessing.contrast=1,this.starMapCenterPosition=c.Pq.Zero(),this.starTemplate=h.P.CreatePlane("star",{size:.6},this.scene),this.starTemplate.isPickable=!0,this.starTemplate.isVisible=!1,this.starTemplate.hasVertexAlpha=!0;var S=new s.g(ec,this.scene),w=new a.F("starMaterial",this.scene);w.emissiveTexture=S,w.transparencyMode=2,w.opacityTexture=S,w.opacityTexture.getAlphaFromRGB=!0,w.emissiveColor=l.v9.White(),w.freeze(),this.starTemplate.material=w,this.starTemplate.billboardMode=u.e.BILLBOARDMODE_ALL,this.starTemplate.registerInstancedBuffer("color",4),this.starTemplate.instancedBuffers.color=new l.ov(1,1,1,1),this.blackHoleTemplate=h.P.CreatePlane("blackHole",{size:.8},this.scene),this.blackHoleTemplate.isPickable=!0,this.blackHoleTemplate.isVisible=!1;var T=new a.F("blackHoleMaterial",this.scene);T.transparencyMode=2,T.diffuseTexture=new s.g(el,this.scene),T.diffuseTexture.hasAlpha=!0,T.emissiveColor=new l.v9(.9,1,1),T.freeze(),this.blackHoleTemplate.material=T,this.blackHoleTemplate.billboardMode=u.e.BILLBOARDMODE_ALL,this.blackHoleTemplate.registerInstancedBuffer("color",4),this.blackHoleTemplate.instancedBuffers.color=new l.ov(1,1,1,1),t.FADE_OUT_ANIMATION.setKeys([{frame:0,value:1},{frame:t.FADE_OUT_DURATION/60,value:0}]),t.FADE_IN_ANIMATION.setKeys([{frame:0,value:0},{frame:t.FADE_IN_DURATION/60,value:1}]),t.SHIMMER_ANIMATION.setKeys([{frame:0,value:1},{frame:t.SHIMMER_DURATION/60/2,value:1.4},{frame:t.SHIMMER_DURATION/60,value:1}]),this.travelLine=new es("travelLine",{points:[],thickness:.05,color:l.v9.Red()},this.scene);for(var A=-t.RENDER_RADIUS;A<=t.RENDER_RADIUS;A++)for(var P=-t.RENDER_RADIUS;P<=t.RENDER_RADIUS;P++)for(var C=-t.RENDER_RADIUS;C<=t.RENDER_RADIUS;C++)A*A+P*P+C*C>t.RENDER_RADIUS*t.RENDER_RADIUS||this.allowedStarSectorRelativeCoordinates.push(new c.Pq(A,P,C));this.scene.onBeforeRenderObservable.add(function(){return ed(function(){var e,t,n,r,o,i,a;return ep(this,function(s){switch(s.label){case 0:e=this.scene.getEngine().getDeltaTime()/1e3,null!==this.rotationAnimation&&this.rotationAnimation.update(e),null!==this.translationAnimation&&this.translationAnimation.update(e),null!==this.radiusAnimation&&this.radiusAnimation.update(e),this.controls.update(e),this.acknowledgeCameraMovement(),this.updateStarSectors(),t=5e4,n=10,r=0,s.label=1;case 1:if(!(r<n)||!this.stellarPathfinder.hasBeenInit()||this.stellarPathfinder.hasFoundPath()||this.stellarPathfinder.getNbIterations()>=t)return[3,6];if(this.stellarPathfinder.update(),!this.stellarPathfinder.hasFoundPath())return[3,4];if(this.soundPlayer.playNow(g.Wo.ITINERARY_COMPUTED),(o=this.stellarPathfinder.getPath()).success)return[3,3];return[4,(0,R.sQ)(o.error.message,this.soundPlayer)];case 2:return s.sent(),[3,5];case 3:return(i=m.he.safeParse(o.value)).success?(this.drawPath(i.data),this.player.currentItinerary=i.data):((0,N.UI)(N.I9.GENERAL,N.yg.ERROR,"Failed to parse itinerary: ".concat(i.error.message),5e3,this.soundPlayer),this.player.currentItinerary=null),void 0!==(a=o.value[1])&&this.onTargetSetObservable.notifyObservers(a),[3,5];case 4:this.stellarPathfinder.getNbIterations()>=t&&(0,N.UI)(N.I9.GENERAL,N.yg.ERROR,"Could not find a path to the target system after ".concat(t," iterations"),5e3,this.soundPlayer),s.label=5;case 5:return r++,[3,1];case 6:return this.stellarPathfinder.hasBeenInit()&&!this.stellarPathfinder.hasFoundPath()?this.starMapUI.shortHandUIPlotItineraryButton.classList.add("loading"):this.starMapUI.shortHandUIPlotItineraryButton.classList.remove("loading"),[2]}})}).call(v)}),this.scene.onAfterRenderObservable.add(function(){var e=v.scene.activeCamera;if(null===e)throw Error("No active camera!");v.starMapUI.update(e.globalPosition,v.starMapCenterPosition)}),window.StarMap=this}return e=[{key:"drawPath",value:function(e){var t=this,n=e.map(function(e){return(0,b.tr)(t.starSystemDatabase.getSystemGalacticPosition(e))});this.travelLine.setPoints(n)}},{key:"acknowledgeCameraMovement",value:function(){var e=this.scene.activeCamera;if(null===e)throw Error("No active camera!");e.globalPosition.length()>t.FLOATING_ORIGIN_DISTANCE&&this.translateCameraBackToOrigin(e),this.cameraPositionToCenter=e.globalPosition.subtract(this.starMapCenterPosition),this.currentStarSectorCoordinates=new c.Pq(Math.round(this.cameraPositionToCenter.x/L.w.STAR_SECTOR_SIZE),Math.round(this.cameraPositionToCenter.y/L.w.STAR_SECTOR_SIZE),Math.round(this.cameraPositionToCenter.z/L.w.STAR_SECTOR_SIZE))}},{key:"translateCameraBackToOrigin",value:function(e){var t=e.globalPosition.negate();this.controls.getTransform().position.addInPlace(t),this.controls.getActiveCamera().getViewMatrix(!0),this.starMapCenterPosition.addInPlace(t);var n=!0,r=!1,o=void 0;try{for(var i,a=this.scene.meshes[Symbol.iterator]();!(n=(i=a.next()).done);n=!0)i.value.position.addInPlace(t)}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"registerStarSector",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new $(e,this.starSystemDatabase);if(this.loadedStarSectors.set(r.getKey(),r),n){var o=r.generate(),i=!0,a=!1,s=void 0;try{for(var l,c,u=o[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var h=c.value;this.createInstance(h)}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}}else(l=this.starBuildStack).push.apply(l,function(e){if(Array.isArray(e))return eu(e)}(t=r.generate())||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return eu(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eu(e,t)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return r}},{key:"setCurrentStarSystem",value:function(e){this.currentSystemCoordinates=e,this.selectedSystemCoordinates=e;var t=new c.Pq(e.starSectorX,e.starSectorY,e.starSectorZ);if(this.loadedStarSectors.has(Q(t))){this.starMapUI.setCurrentSystem(e),this.focusOnCurrentSystem();return}this.registerStarSector(t,!0),this.starMapUI.setCurrentSystem(e);var n=t.subtract(this.currentStarSectorCoordinates).scaleInPlace(L.w.STAR_SECTOR_SIZE);(0,E.Tl)(this.controls.getTransform(),n),this.controls.getActiveCamera().getViewMatrix(!0),this.acknowledgeCameraMovement(),this.focusOnCurrentSystem(!0)}},{key:"updateStarSectors",value:function(){var e=this.scene.activeCamera;if(null===e)throw Error("No active camera!");var n=e.globalPosition,r=null===this.currentSystemCoordinates?null:this.coordinatesToInstanceMap.get(JSON.stringify(this.currentSystemCoordinates)),o=null===this.selectedSystemCoordinates?null:this.coordinatesToInstanceMap.get(JSON.stringify(this.selectedSystemCoordinates)),i=!0,a=!1,s=void 0;try{for(var l,u,h=this.loadedStarSectors.values()[Symbol.iterator]();!(i=(u=h.next()).done);i=!0)l=this,function(){var e=u.value;if(e.starInstances.forEach(function(e){e.isPickable=2025>c.Pq.DistanceSquared(e.position,n)}),e.blackHoleInstances.forEach(function(e){e.isPickable=2025>c.Pq.DistanceSquared(e.position,n)}),!(null!==r&&e.starInstances.concat(e.blackHoleInstances).includes(r)||null!==o&&e.starInstances.concat(e.blackHoleInstances).includes(o))){if(e.position.subtract(l.cameraPositionToCenter).length()/L.w.STAR_SECTOR_SIZE>t.RENDER_RADIUS+1){var i=!0,a=!1,s=void 0;try{for(var h,d=e.starInstances[Symbol.iterator]();!(i=(h=d.next()).done);i=!0){var f=h.value;l.fadeOutThenRecycle(f,l.recycledStars)}}catch(e){a=!0,s=e}finally{try{i||null==d.return||d.return()}finally{if(a)throw s}}var p=!0,m=!1,v=void 0;try{for(var y,g=e.blackHoleInstances[Symbol.iterator]();!(p=(y=g.next()).done);p=!0){var b=y.value;l.fadeOutThenRecycle(b,l.recycledBlackHoles)}}catch(e){m=!0,v=e}finally{try{p||null==g.return||g.return()}finally{if(m)throw v}}l.loadedStarSectors.delete(e.getKey())}}}()}catch(e){a=!0,s=e}finally{try{i||null==h.return||h.return()}finally{if(a)throw s}}var d=!0,f=!1,p=void 0;try{for(var m,v=this.allowedStarSectorRelativeCoordinates[Symbol.iterator]();!(d=(m=v.next()).done);d=!0){var y=m.value,g=this.currentStarSectorCoordinates.add(y),b=Q(g);if(!this.loadedStarSectors.has(b)){var S=$.GetBoundingBox(g.scale(L.w.STAR_SECTOR_SIZE),this.starMapCenterPosition);e.isInFrustum(S)&&this.registerStarSector(g)}}}catch(e){f=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw p}}this.buildNextStars(Math.min(2e3,t.GENERATION_RATE*this.controls.getSpeed()))}},{key:"buildNextStars",value:function(e){for(var t=0;t<e;t++){var n=this.starBuildStack.pop();if(void 0===n)return;if(!this.loadedStarSectors.has(n.sectorString)){e++;continue}this.createInstance(n)}}},{key:"createInstance",value:function(e){var t,n,i,a=this,s=e.coordinates,c=this.starSystemDatabase.getSystemModelFromCoordinates(s);if(null===c)throw Error("Could not find star system model for coordinates ".concat(JSON.stringify(s)));var h=c.stellarObjects[0],d="".concat(c.name," Billboard instance"),f=null,p=!1;if(h.type!==v.T.BLACK_HOLE){var m=this.recycledStars.shift();void 0!==m?((f=m).name=d,p=!0):f=this.starTemplate.createInstance(d)}else{var y=this.recycledBlackHoles.shift();void 0!==y?((f=y).name=d,p=!0):f=this.blackHoleTemplate.createInstance(d)}var b=f;b.billboardMode=u.e.BILLBOARDMODE_ALL,this.coordinatesToInstanceMap.set(JSON.stringify(s),b),this.instanceToCoordinatesMap.set(b,JSON.stringify(s)),b.position=e.position.add(this.starMapCenterPosition);var S=(0,O.C)(h.blackBodyTemperature);b.instancedBuffers.color=new l.ov(S.r,S.g,S.b,0),p&&b.setEnabled(!0),b.isPickable=!0,null==(t=b.actionManager)||t.dispose(),b.actionManager=new r.m(this.scene),b.actionManager.registerAction(new o.FH(r.m.OnPointerOverTrigger,function(){a.starMapUI.setHoveredSystem(s),a.soundPlayer.playNow(g.Wo.HOVER)})),b.actionManager.registerAction(new o.FH(r.m.OnPointerOutTrigger,function(){a.starMapUI.setHoveredSystem(null)})),b.actionManager.registerAction(new o.FH(r.m.OnPickTrigger,function(){a.soundPlayer.playNow(g.Wo.TARGET_LOCK),a.starMapUI.setSelectedSystem(c,a.currentSystemCoordinates),a.selectedSystemCoordinates=s,a.focusOnSystem(s)})),this.fadeIn(b),h.type===v.T.BLACK_HOLE?null==(n=this.loadedStarSectors.get(e.sectorString))||n.blackHoleInstances.push(b):null==(i=this.loadedStarSectors.get(e.sectorString))||i.starInstances.push(b)}},{key:"focusOnCurrentSystem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===this.currentSystemCoordinates?console.warn("No current system seed!"):this.focusOnSystem(this.currentSystemCoordinates,e)}},{key:"focusOnSystem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,b.tr)(this.starSystemDatabase.getSystemGalacticPosition(e)).add(this.starMapCenterPosition),r=this.controls.thirdPersonCamera.getDirection(c.Pq.Forward(this.scene.useRightHandedSystem)),o=n.subtract(this.controls.thirdPersonCamera.globalPosition).normalize(),i=Math.acos(c.Pq.Dot(r,o));if(t)(0,E.t5)(this.controls.getTransform(),n,this.scene.useRightHandedSystem),this.controls.getTransform().computeWorldMatrix(!0);else if(i>.02){var a=c.Pq.Cross(r,o).normalize();this.rotationAnimation=new C.J(this.controls.getTransform(),a,i,1)}var s=n.subtract(this.controls.getTransform().getAbsolutePosition()).normalize(),l=n.subtract(this.controls.getTransform().getAbsolutePosition()).length(),u=this.controls.getTransform().getAbsolutePosition().add(s.scaleInPlace(l));t?this.controls.getTransform().position=u:u.subtract(this.controls.getTransform().getAbsolutePosition()).lengthSquared()>.1&&(this.translationAnimation=new I.k(this.controls.getTransform(),u,1)),t?this.controls.thirdPersonCamera.radius=10:this.radiusAnimation=new P(this.controls.thirdPersonCamera,10,1),this.selectedSystemCoordinates=e;var h=this.starSystemDatabase.getSystemModelFromCoordinates(e);if(null===h)throw Error("Could not find star system model for coordinates ".concat(JSON.stringify(e)));this.starMapUI.setSelectedSystem(h,this.currentSystemCoordinates),this.starMapUI.setHoveredSystem(null)}},{key:"fadeIn",value:function(e){e.animations=[t.FADE_IN_ANIMATION],e.getScene().beginAnimation(e,0,t.FADE_IN_DURATION/60,!1,1,function(){e.animations=[t.SHIMMER_ANIMATION],e.getScene().beginAnimation(e,0,t.SHIMMER_DURATION/60,!0,.1+.2*Math.random())})}},{key:"fadeOutThenRecycle",value:function(e,n){var r=this;e.animations=[t.FADE_OUT_ANIMATION],e.getScene().beginAnimation(e,0,t.FADE_OUT_DURATION/60,!1,1,function(){e.setEnabled(!1);var t=r.instanceToCoordinatesMap.get(e);if(void 0===t)throw Error("No seed for instance!");r.coordinatesToInstanceMap.delete(t),r.instanceToCoordinatesMap.delete(e),n.push(e)})}},{key:"render",value:function(){this.scene.render()}},{key:"attachControl",value:function(){this.scene.attachControl(),this.starMapUI.htmlRoot.classList.remove("hidden"),null!==this.player.currentItinerary&&this.drawPath(this.player.currentItinerary)}},{key:"detachControl",value:function(){this.scene.detachControl(),this.starMapUI.htmlRoot.classList.add("hidden")}},{key:"getMainScene",value:function(){return this.scene}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();ef(em,"GENERATION_RATE",100),ef(em,"RENDER_RADIUS",6),ef(em,"FLOATING_ORIGIN_DISTANCE",1e3),ef(em,"FADE_OUT_ANIMATION",new i.X5("fadeIn","instancedBuffers.color.a",60,i.X5.ANIMATIONTYPE_FLOAT,i.X5.ANIMATIONLOOPMODE_CYCLE)),ef(em,"FADE_OUT_DURATION",1e3),ef(em,"FADE_IN_ANIMATION",new i.X5("fadeIn","instancedBuffers.color.a",60,i.X5.ANIMATIONTYPE_FLOAT,i.X5.ANIMATIONLOOPMODE_CYCLE)),ef(em,"FADE_IN_DURATION",1e3),ef(em,"SHIMMER_ANIMATION",new i.X5("shimmer","instancedBuffers.color.a",60,i.X5.ANIMATIONTYPE_FLOAT,i.X5.ANIMATIONLOOPMODE_CYCLE)),ef(em,"SHIMMER_DURATION",1e3)},34547:function(e,t,n){"use strict";n.d(t,{S:()=>g});var r=n(54060),o=n(15524),i=n(92487),a=n(86283),s=n(31272),l=n(16533),c=s._.KEYBOARD,u=new r.A({bindings:[c.getControl("KeyF")]}),h=new a.A(u),d=new i.A({up:c.getControl("KeyW"),left:c.getControl("KeyA"),down:c.getControl("KeyS"),right:c.getControl("KeyD")}),f=new r.A({bindings:[d]}),p=new o.hn({positive:c.getControl("NumpadAdd"),negative:c.getControl("NumpadSubtract")}),m=new r.A({bindings:[p]}),v=new o.hn({positive:c.getControl("Space"),negative:c.getControl("ShiftLeft")}),y=new r.A({bindings:[v]}),g=new l.X("StarMapInputs",{focusOnCurrentSystem:h,move:f,changeSpeed:m,upDown:y})},81629:function(e,t,n){"use strict";n.d(t,{QD:()=>a,TF:()=>i,gk:()=>l,sQ:()=>s});var r=n(76448),o=n(78706);function i(e,t,n){var i=document.createElement("dialog");return i.innerHTML='\n        <form method="dialog">\n            <p>'.concat(e,'</p>\n            <input type="text" value="').concat(t,'">\n            <menu>\n                <button type="reset" value="cancel">').concat(o.A.t("common:cancel"),'</button>\n                <button type="submit" value="ok">').concat(o.A.t("common:ok"),"</button>\n            </menu>\n        </form>\n    "),document.body.appendChild(i),i.showModal(),new Promise(function(e){var t=i.querySelector("input");t.focus(),t.select(),t.addEventListener("keydown",function(e){e.stopPropagation()}),i.addEventListener("reset",function(){n.playNow(r.Wo.CLICK),e(null),i.remove()}),i.addEventListener("close",function(){n.playNow(r.Wo.CLICK),"ok"===i.returnValue?e(t.value):e(null),i.remove()})})}function a(e,t){var n=document.createElement("dialog");return n.innerHTML='\n        <form method="dialog">\n            <p>'.concat(e,'</p>\n            <menu>\n                <button value="cancel">').concat(o.A.t("common:cancel"),'</button>\n                <button value="ok">').concat(o.A.t("common:confirm"),"</button>\n            </menu>\n        </form>\n    "),document.body.appendChild(n),n.showModal(),new Promise(function(e){n.addEventListener("close",function(){t.playNow(r.Wo.CLICK),e("ok"===n.returnValue),n.remove()})})}function s(e,t){var n=document.createElement("dialog");return n.innerHTML='\n        <form method="dialog">\n            <p>'.concat(e,'</p>\n            <menu>\n                <button value="ok">').concat(o.A.t("common:ok"),"</button>\n            </menu>\n        </form>\n    "),document.body.appendChild(n),n.showModal(),new Promise(function(e){n.addEventListener("close",function(){t.playNow(r.Wo.CLICK),e(),n.remove()})})}function l(e){var t=document.createElement("dialog");document.body.appendChild(t);var n=document.createElement("form");n.method="dialog",n.classList.add("flex-column"),t.appendChild(n);var i=document.createElement("p");i.textContent="Connect to an instance of the Encyclopaedia",n.appendChild(i);var a=document.createElement("input");a.type="url",a.placeholder="https://cosmosjourneyer.com/encyclopaediaTest/",a.required=!0,n.appendChild(a);var s=document.createElement("input");s.type="text",s.placeholder="accountId",n.appendChild(s);var l=document.createElement("input");l.type="password",l.placeholder="password",n.appendChild(l);var c=document.createElement("menu");n.appendChild(c);var u=document.createElement("button");u.type="reset",u.value="cancel",u.textContent=o.A.t("common:cancel"),c.appendChild(u);var h=document.createElement("button");return h.type="submit",h.value="connect",h.textContent="Connect",c.appendChild(h),t.showModal(),a.focus(),a.select(),t.querySelectorAll("input").forEach(function(e){e.addEventListener("keydown",function(e){e.stopPropagation()})}),new Promise(function(n){t.addEventListener("reset",function(){e.playNow(r.Wo.CLICK),n(null),t.remove()}),t.addEventListener("close",function(){e.playNow(r.Wo.CLICK),"connect"===t.returnValue?n({encyclopaediaUrlBase:a.value,accountId:s.value,password:l.value}):n(null),t.remove()})})}},12577:function(e,t,n){"use strict";n.d(t,{E$:()=>m,I9:()=>h,UI:()=>v,yg:()=>d});var r,o,i=n(76448),a=n(14620),s=n(74452),l=n(41077),c=n(23684);function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=((r={}).GENERAL="info",r.SPACESHIP="spaceship",r.EXPLORATION="exploration",r.SPACE_STATION="space-station",r),d=((o={}).INFO="info",o.SUCCESS="success",o.WARNING="warning",o.ERROR="error",o),f=function(){var e;function t(e,n,r,o,h){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");u(this,"progressSeconds",0),u(this,"progressDurationSeconds",void 0),u(this,"removalProgressSeconds",0),u(this,"removalDurationSeconds",.5),u(this,"htmlRoot",void 0),u(this,"isBeingRemoved",!1);var d=document.getElementById("notificationContainer");null===d&&((d=document.createElement("div")).id="notificationContainer",document.body.appendChild(d)),this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("notification",e);var f=document.createElement("div");f.classList.add("notification-content"),this.htmlRoot.appendChild(f);var p=document.createElement("img");switch(e){case"info":p.src=a;break;case"spaceship":p.src=c;break;case"exploration":p.src=s;break;case"space-station":p.src=l}p.classList.add("notification-icon"),f.appendChild(p);var m=document.createElement("p");m.textContent=r,f.appendChild(m);var v=document.createElement("div");v.classList.add("notification-progress");var y=document.createElement("div");switch(y.classList.add("notification-progress-bar"),v.appendChild(y),this.htmlRoot.appendChild(v),d.appendChild(this.htmlRoot),n){case"info":h.playNow(i.Wo.INFO);break;case"success":h.playNow(i.Wo.SUCCESS);break;case"warning":h.playNow(i.Wo.WARNING);break;case"error":h.playNow(i.Wo.ERROR)}y.style.animation="progress ".concat(o,"s linear"),this.progressDurationSeconds=o}return e=[{key:"update",value:function(e){this.progressSeconds<this.progressDurationSeconds?this.progressSeconds+=e:this.removalProgressSeconds+=e}},{key:"getProgress",value:function(){return Math.max(0,Math.min(1,this.progressSeconds/this.progressDurationSeconds))}},{key:"startRemoval",value:function(){this.isBeingRemoved=!0,this.htmlRoot.style.animation="popOut ".concat(this.removalDurationSeconds,"s ease-in-out")}},{key:"hasRemovalStarted",value:function(){return this.isBeingRemoved}},{key:"getRemovalProgress",value:function(){return Math.max(0,Math.min(1,this.removalProgressSeconds/this.removalDurationSeconds))}},{key:"dispose",value:function(){this.htmlRoot.remove()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),p=[];function m(e){p.forEach(function(t){t.update(e),1!==t.getProgress()||t.hasRemovalStarted()||t.startRemoval(),1===t.getRemovalProgress()&&t.dispose()}),p=p.filter(function(e){return 1>e.getRemovalProgress()})}function v(e,t,n,r,o){var i=new f(e,t,n,r/1e3,o);p.push(i)}},74459:function(e,t,n){"use strict";n.d(t,{X:()=>A});var r=n(48462),o=n(44710),i=n(85303),a=n(65617),s=n(26070);function l(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}var c=n(76448),u=n(81629),h=n(12577),d=n(78706);let f=n.p+"84ce2b6784367db0.webp",p=n.p+"8a1c03268bf466ec.webp",m=n.p+"1a462202fcf3027a.webp",v=n.p+"516b62e74a5c289b.webp",y=n.p+"59c8c9e9e3e40806.webp",g=n.p+"cffe491bb1a1152f.webp";function b(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function S(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){b(i,r,o,a,s,"next",e)}function s(e){b(i,r,o,a,s,"throw",e)}a(void 0)})}}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var A=function(){var e;function t(e,n){var o=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");w(this,"htmlRoot",void 0),w(this,"cmdrList",void 0),w(this,"onLoadSaveObservable",new r.cP),w(this,"soundPlayer",void 0),this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("saveLoadingPanelContent"),this.soundPlayer=n;var i=document.createElement("div");i.id="dropFileZone",this.htmlRoot.appendChild(i);var a=document.createElement("p");a.innerText=d.A.t("sidePanel:dropASaveFileHere"),i.appendChild(a),i.addEventListener("dragover",function(e){if(e.preventDefault(),e.stopPropagation(),i.classList.add("dragover"),i.classList.remove("invalid"),null===e.dataTransfer)throw Error("event.dataTransfer is null");e.dataTransfer.dropEffect="copy"}),i.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation(),i.classList.remove("dragover")}),i.addEventListener("drop",function(t){return S(function(){var n;return T(this,function(r){switch(r.label){case 0:if(t.preventDefault(),t.stopPropagation(),i.classList.remove("dragover"),null===t.dataTransfer)throw Error("event.dataTransfer is null");if(0===t.dataTransfer.files.length)throw Error("event.dataTransfer.files is empty");if(void 0!==(n=t.dataTransfer.files[0]))return[3,2];return[4,(0,u.sQ)("No file dropped",this.soundPlayer)];case 1:case 3:return r.sent(),[2];case 2:return[4,this.loadSaveFile(n,e)]}})}).call(o)}),i.addEventListener("click",function(){o.soundPlayer.playNow(c.Wo.CLICK);var t=document.createElement("input");t.type="file",t.accept="application/json",t.onchange=function(){return S(function(){var n;return T(this,function(r){switch(r.label){case 0:if(null===t.files)throw Error("fileInput.files is null");if(0===t.files.length)throw Error("fileInput.files is empty");if(void 0!==(n=t.files[0]))return[3,2];return[4,(0,u.sQ)("No file selected",this.soundPlayer)];case 1:case 3:return r.sent(),[2];case 2:return[4,this.loadSaveFile(n,e)]}})}).call(o)},t.click()}),this.cmdrList=document.createElement("div"),this.cmdrList.classList.add("cmdrList"),this.htmlRoot.appendChild(this.cmdrList)}return e=[{key:"populateCmdrList",value:function(e,t){return S(function(){var n,r,o,i,s,l,p,g,b,w,A,P,C,I,E,R,N,O,L;return T(this,function(x){switch(x.label){case 0:return n=this,this.cmdrList.innerHTML="",[4,t.getCmdrUuids()];case 1:r=x.sent(),o=new Map,i=!0,s=!1,l=void 0,x.label=2;case 2:x.trys.push([2,7,8,9]),p=r[Symbol.iterator](),x.label=3;case 3:if(i=(g=p.next()).done)return[3,6];return b=g.value,[4,t.getSavesForCmdr(b)];case 4:if(void 0===(w=x.sent()))return[3,5];o.set(b,w.manual.concat(w.auto)),x.label=5;case 5:return i=!0,[3,3];case 6:return[3,9];case 7:return A=x.sent(),s=!0,l=A,[3,9];case 8:try{i||null==p.return||p.return()}finally{if(s)throw l}return[7];case 9:o.forEach(function(e){e.sort(function(e,t){return t.timestamp-e.timestamp})}),r.sort(function(e,t){var n,r,i=null==(n=o.get(e))?void 0:n.at(0),a=null==(r=o.get(t))?void 0:r.at(0);if(void 0===i||void 0===a)throw Error("aLatestSave or bLatestSave is undefined");return a.timestamp-i.timestamp}),P=!0,C=!1,I=void 0,x.label=10;case 10:x.trys.push([10,15,16,17]),R=function(){var r,o,i,s,l,p,g,b,w,A,P,C,I,R,N,L,x,M,_;return T(this,function(k){switch(k.label){case 0:return r=O.value,[4,t.getSavesForCmdr(r)];case 1:if(void 0===(o=k.sent())||((i=document.createElement("div")).classList.add("cmdr"),E.cmdrList.appendChild(i),(s=o.auto.concat(o.manual)).sort(function(e,t){return t.timestamp-e.timestamp}),void 0===(l=s[0])))return[2,{v:void 0}];return(p=document.createElement("div")).classList.add("cmdrHeader"),i.appendChild(p),(g=document.createElement("div")).classList.add("cmdrHeaderText"),p.appendChild(g),(b=document.createElement("h3")).innerText=l.player.name,g.appendChild(b),(w=document.createElement("p")).innerText=d.A.t("sidePanel:lastPlayedOn",{val:new Date(l.timestamp),formatParams:{val:{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}}}),g.appendChild(w),(A=document.createElement("p")).innerText=d.A.t("sidePanel:journeyedFor",{nbHours:Math.ceil(l.player.timePlayedSeconds/60/60)}),g.appendChild(A),(P=document.createElement("div")).classList.add("cmdrHeaderButtons"),p.appendChild(P),(C=document.createElement("button")).classList.add("icon","large"),C.addEventListener("click",function(){n.soundPlayer.playNow(c.Wo.CLICK),n.onLoadSaveObservable.notifyObservers(l)}),P.appendChild(C),(I=document.createElement("img")).src=y,C.appendChild(I),(R=document.createElement("button")).classList.add("icon","large"),R.addEventListener("click",function(){return S(function(){var e,t;return T(this,function(n){switch(n.label){case 0:if(e=this,this.soundPlayer.playNow(c.Wo.CLICK),null!==(t=(0,a.fe)(l)))return[3,2];return[4,(0,u.sQ)("Could not create a URL from the save file.",this.soundPlayer)];case 1:case 3:return n.sent(),[2];case 2:return[4,navigator.clipboard.writeText(t.toString()).then(function(){(0,h.UI)(h.I9.GENERAL,h.yg.SUCCESS,d.A.t("notifications:copiedToClipboard"),5e3,e.soundPlayer)})]}})}).call(n)}),P.appendChild(R),(N=document.createElement("img")).src=v,R.appendChild(N),(L=document.createElement("div")).classList.add("savesList"),L.classList.add("hidden"),i.appendChild(L),s.forEach(function(r){var i=n.createSaveDiv(r,o.auto.includes(r),e,t);L.appendChild(i)}),(x=document.createElement("img")).src=m,(M=document.createElement("img")).src=f,(_=document.createElement("button")).classList.add("expandButton","icon","large"),_.appendChild(x),_.addEventListener("click",function(){n.soundPlayer.playNow(c.Wo.CLICK),L.classList.toggle("hidden"),_.innerHTML="",_.appendChild(L.classList.contains("hidden")?x:M)}),P.appendChild(_),[2]}})},N=r[Symbol.iterator](),x.label=11;case 11:if(P=(O=N.next()).done)return[3,14];return E=this,[5,function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(R())];case 12:var M;if("object"==((M=L=x.sent())&&"undefined"!=typeof Symbol&&M.constructor===Symbol?"symbol":typeof M))return[2,L.v];x.label=13;case 13:return P=!0,[3,11];case 14:return[3,17];case 15:return A=x.sent(),C=!0,I=A,[3,17];case 16:try{P||null==N.return||N.return()}finally{if(C)throw I}return[7];case 17:return[2]}})}).call(this)}},{key:"createSaveDiv",value:function(e,t,n,r){var o,i=this,s=document.createElement("div");s.classList.add("saveContainer");var l=document.createElement("div");l.classList.add("saveText"),s.appendChild(l);var f=document.createElement("p");f.innerText=(t?"[Auto] ":"")+new Date(e.timestamp).toLocaleString(),l.appendChild(f);var m=document.createElement("p"),b="inSpaceship"===e.playerLocation.type?e.shipLocations[e.playerLocation.shipId]:e.playerLocation;if(void 0===b)throw Error("locationToUse is undefined");if("inSpaceship"===b.type)throw Error("Spaceship inside a spaceship is not supported yet");var w="atStation"===b.type,A=n.getObjectModelByUniverseId(b.universeObjectId);m.innerText=d.A.t(w?"sidePanel:landedAt":"sidePanel:near",{location:null!=(o=null==A?void 0:A.name)?o:d.A.t("sidePanel:locationNotFound"),interpolation:{escapeValue:!1}}),l.appendChild(m);var P=document.createElement("div");if(P.classList.add("saveContent"),s.appendChild(P),void 0!==e.thumbnail){var C=document.createElement("div");C.classList.add("saveThumbnail");var I=document.createElement("img");I.src=e.thumbnail,I.alt="Save thumbnail",C.appendChild(I),P.appendChild(C)}var E=document.createElement("div");E.classList.add("saveButtons"),s.appendChild(E);var R=document.createElement("button");R.classList.add("icon","large"),R.addEventListener("click",function(){i.soundPlayer.playNow(c.Wo.CLICK),i.onLoadSaveObservable.notifyObservers(e)}),E.appendChild(R);var N=document.createElement("img");N.src=y,R.appendChild(N);var O=document.createElement("button");O.classList.add("icon","large"),O.addEventListener("click",function(){return S(function(){var t,n;return T(this,function(r){switch(r.label){case 0:if(t=this,this.soundPlayer.playNow(c.Wo.CLICK),null!==(n=(0,a.fe)(e)))return[3,2];return[4,(0,u.sQ)("Could not create a URL from the save file.",this.soundPlayer)];case 1:case 3:return r.sent(),[2];case 2:return[4,navigator.clipboard.writeText(n.toString()).then(function(){(0,h.UI)(h.I9.GENERAL,h.yg.INFO,d.A.t("notifications:copiedToClipboard"),5e3,t.soundPlayer)})]}})}).call(i)}),E.appendChild(O);var L=document.createElement("img");L.src=v,O.appendChild(L);var x=document.createElement("button");x.classList.add("icon","large"),x.addEventListener("click",function(){i.soundPlayer.playNow(c.Wo.CLICK);var t=new Blob([JSON.stringify(e)],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="".concat(e.player.name,"_").concat(e.timestamp,".json"),r.click(),URL.revokeObjectURL(n)}),E.appendChild(x);var M=document.createElement("img");M.src=p,x.appendChild(M);var _=document.createElement("button");_.classList.add("danger","icon","large"),_.addEventListener("click",function(){return S(function(){var t,n,o;return T(this,function(i){switch(i.label){case 0:return this.soundPlayer.playNow(c.Wo.CLICK),[4,(0,u.QD)(d.A.t("sidePanel:deleteSavePrompt"),this.soundPlayer)];case 1:if(!i.sent())return[2];return[4,r.deleteSaveForCmdr(e.player.uuid,e.uuid)];case 2:return i.sent(),[4,r.getSavesForCmdr(e.player.uuid)];case 3:if(void 0===(t=i.sent()))return[2];if(0!==t.auto.length||0!==t.manual.length)return[3,5];return[4,r.deleteCmdr(e.player.uuid)];case 4:i.sent(),null==(o=s.parentElement)||null==(n=o.parentElement)||n.remove(),i.label=5;case 5:return s.remove(),[2]}})}).call(i)}),E.appendChild(_);var k=document.createElement("img");return k.src=g,_.appendChild(k),s}},{key:"loadSaveFile",value:function(e,t){return S(function(){var n;return T(this,function(r){switch(r.label){case 0:var c;return[4,(c=function(){return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(n){return[2,new Promise(function(n){var r=new FileReader;r.onload=function(e){if(null===e.target)throw Error("event.target is null");var r,l=e.target.result;if(null===l)throw Error("data is null");if(null!=(r=ArrayBuffer)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](l):l instanceof r)throw Error("data is an ArrayBuffer");var c=(0,o.z)(l);null===c?n((0,i._q)({type:s.G.INVALID_JSON})):n((0,a.c_)(c,t))},r.readAsText(e)})]})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=c.apply(e,t);function i(e){l(o,n,r,i,a,"next",e)}function a(e){l(o,n,r,i,a,"throw",e)}i(void 0)})})()];case 1:if((n=r.sent()).success)return[3,3];return console.error(n.error),[4,(0,u.sQ)((0,s.k)(n.error),this.soundPlayer)];case 2:return r.sent(),[2,n];case 3:return this.onLoadSaveObservable.notifyObservers(n.value),[2,n]}})}).call(this)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},42089:function(e,t,n){"use strict";n.d(t,{M:()=>eL});var r=n(48462),o=n(76448),i=n(81629),a=n(78706),s=n(13679),l=n(12577),c=n(78629),u=n(27460),h=n(57404),d=n(63215);function f(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function p(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){f(i,r,o,a,s,"next",e)}function s(e){f(i,r,o,a,s,"throw",e)}a(void 0)})}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var y=function(){var e;function t(e,n,i,s){var c=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");m(this,"htmlRoot",void 0),m(this,"placeHolderText",void 0),m(this,"currentDiscovery",null),m(this,"onSellDiscovery",new r.cP),m(this,"objectName",void 0),m(this,"objectType",void 0),m(this,"siderealDayDuration",void 0),m(this,"orbitDuration",void 0),m(this,"orbitRadius",void 0),m(this,"sellDiscoveryButton",void 0),m(this,"player",void 0),m(this,"encyclopaedia",void 0),m(this,"soundPlayer",void 0),this.soundPlayer=s,this.player=e,this.encyclopaedia=n,this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("flex-column","discoveryDetails"),this.placeHolderText=document.createElement("p"),this.placeHolderText.textContent=a.A.t("explorationCenter:detailsPlaceholder"),this.objectName=document.createElement("h2"),this.objectType=document.createElement("p"),this.siderealDayDuration=document.createElement("p"),this.orbitDuration=document.createElement("p"),this.orbitRadius=document.createElement("p"),this.sellDiscoveryButton=document.createElement("button"),this.sellDiscoveryButton.textContent="Sell",this.sellDiscoveryButton.addEventListener("click",function(){return p(function(){var t,r;return v(this,function(a){switch(a.label){case 0:if(t=this,null===this.currentDiscovery)throw Error("The sell button should not be displayed when currentDiscovery is null");return this.soundPlayer.playNow(o.Wo.SUCCESS),[4,n.estimateDiscovery(this.currentDiscovery.objectId)];case 1:if(!(r=a.sent()).success)return(0,l.UI)(l.I9.GENERAL,l.yg.ERROR,r.error,5e3,this.soundPlayer),[2];return e.earn(r.value),e.discoveries.local=e.discoveries.local.filter(function(e){return e!==t.currentDiscovery}),e.discoveries.uploaded.push(this.currentDiscovery),this.onSellDiscovery.notifyObservers(this.currentDiscovery),[4,this.setDiscovery(null,i)];case 2:return a.sent(),[2]}})}).call(c)}),this.setDiscovery(null,i)}return e=[{key:"setDiscovery",value:function(e,t){return p(function(){var n,r,o,l,f,p;return v(this,function(m){switch(m.label){case 0:if(this.htmlRoot.innerHTML="",this.htmlRoot.classList.toggle("empty",null===e),this.currentDiscovery=e,null===this.currentDiscovery)return this.htmlRoot.appendChild(this.placeHolderText),[2];if(null!==(n=t.getSystemModelFromCoordinates(this.currentDiscovery.objectId.systemCoordinates)))return[3,2];return console.error(e),[4,(0,i.sQ)("System could not be found for the discovery. More information in the console.",this.soundPlayer)];case 1:case 3:return m.sent(),[2];case 2:if(r=(0,c.B)(this.currentDiscovery.objectId.idInSystem,n),this.objectName.innerText=null!=(o=null==r?void 0:r.name)?o:a.A.t("common:unknown"),this.htmlRoot.appendChild(this.objectName),null!==r)return[3,4];return console.error(e),[4,(0,i.sQ)("Object could not be found for the discovery. More information in the console.",this.soundPlayer)];case 4:if(this.objectType.innerText=a.A.t("orbitalObject:type",{value:(0,u.d)(r)}),this.htmlRoot.appendChild(this.objectType),this.siderealDayDuration.innerText=a.A.t("orbitalObject:siderealDayDuration",{value:(0,d.y$)(r.siderealDaySeconds)}),this.htmlRoot.appendChild(this.siderealDayDuration),l=r.orbit.parentIds.map(function(e){return(0,c.B)(e,n)}).reduce(function(e,t){var n;return e+(null!=(n=null==t?void 0:t.mass)?n:0)},0),f=(0,h.tQ)(r.orbit.semiMajorAxis,l),this.orbitDuration.innerText=a.A.t("orbit:period",{value:(0,d.y$)(f)}),this.htmlRoot.appendChild(this.orbitDuration),this.orbitRadius.innerText=a.A.t("orbit:radius",{value:(0,d.Fj)(r.orbit.semiMajorAxis)}),this.htmlRoot.appendChild(this.orbitRadius),!this.player.discoveries.local.includes(this.currentDiscovery))return[3,8];return[4,this.encyclopaedia.estimateDiscovery(this.currentDiscovery.objectId)];case 5:if(!(p=m.sent()).success)return[3,6];return this.htmlRoot.appendChild(this.sellDiscoveryButton),this.sellDiscoveryButton.textContent=a.A.t("common:sellFor",{price:"".concat(p.value.toLocaleString()).concat(s.w.CREDIT_SYMBOL)}),[3,8];case 6:return console.error(p.error),[4,(0,i.sQ)("Could not estimate the selling price. More information in the console.",this.soundPlayer)];case 7:m.sent(),m.label=8;case 8:return[2]}})}).call(this)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function S(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){b(i,r,o,a,s,"next",e)}function s(e){b(i,r,o,a,s,"throw",e)}a(void 0)})}}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return g(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var P="localOnly",C="uploadedOnly",I=function(){var e;function t(e,n,r,s){var c=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");w(this,"htmlRoot",void 0),w(this,"discoveryList",void 0),w(this,"discoveryDetails",void 0),w(this,"filter","all"),w(this,"selectedDiscovery",null),w(this,"sellAllButton",void 0),w(this,"discoveryToHtmlItem",new Map),w(this,"player",void 0),w(this,"encyclopaedia",void 0),w(this,"soundPlayer",void 0),this.player=n,this.encyclopaedia=e,this.soundPlayer=s,this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("flex-column","discoveryPanel");var u=document.createElement("h2");u.textContent=a.A.t("explorationCenter:explorationCenter"),this.htmlRoot.appendChild(u);var h=document.createElement("div");h.classList.add("flex-row","encyclopaediaContainer"),this.htmlRoot.appendChild(h);var d=document.createElement("p");d.textContent=a.A.t("explorationCenter:activeEncyclopaediaInstances",{value:e.getBackendString()}),h.appendChild(d);var f=document.createElement("button");f.classList.add("disabled"),f.textContent=a.A.t("explorationCenter:addNewInstance"),f.addEventListener("click",function(){return S(function(){return A(this,function(e){switch(e.label){case 0:return this.soundPlayer.playNow(o.Wo.CLICK),[4,(0,i.gk)(this.soundPlayer)];case 1:return e.sent(),[2]}})}).call(c)}),h.appendChild(f);var p=document.createElement("div");p.classList.add("flex-row","buttonHorizontalContainer"),this.htmlRoot.appendChild(p);var m=document.createElement("select");p.appendChild(m),this.sellAllButton=document.createElement("button"),this.sellAllButton.addEventListener("click",function(){return S(function(){var t,i,a,s,c,u,h,d;return A(this,function(f){switch(f.label){case 0:this.soundPlayer.playNow(o.Wo.CLICK),t=!0,i=!1,a=void 0,f.label=1;case 1:f.trys.push([1,6,7,8]),c=function(){var t,r;return A(this,function(o){switch(o.label){case 0:return t=h.value,[4,e.estimateDiscovery(t.objectId)];case 1:if(!(r=o.sent()).success)return(0,l.UI)(l.I9.GENERAL,l.yg.ERROR,r.error,5e3,s.soundPlayer),[2,"continue"];return n.earn(r.value),n.discoveries.local=n.discoveries.local.filter(function(e){return e!==t}),n.discoveries.uploaded.push(t),[2]}})},u=this.player.discoveries.local[Symbol.iterator](),f.label=2;case 2:if(t=(h=u.next()).done)return[3,5];return s=this,[5,function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(c())];case 3:f.sent(),f.label=4;case 4:return t=!0,[3,2];case 5:return[3,8];case 6:return d=f.sent(),i=!0,a=d,[3,8];case 7:try{t||null==u.return||u.return()}finally{if(i)throw a}return[7];case 8:return[4,this.populate(r)];case 9:return f.sent(),[2]}})}).call(c)}),p.appendChild(this.sellAllButton);var v=document.createElement("option");v.innerText=a.A.t("explorationCenter:filterLocal"),v.value=P,m.appendChild(v);var g=document.createElement("option");g.innerText=a.A.t("explorationCenter:filterUploaded"),g.value=C,m.appendChild(g);var b=document.createElement("option");b.innerText=a.A.t("explorationCenter:filterAll"),b.value="all",m.appendChild(b),m.value="all",m.addEventListener("change",function(){return S(function(){return A(this,function(e){switch(e.label){case 0:switch(this.soundPlayer.playNow(o.Wo.CLICK),m.value){case P:case C:case"all":return[3,1]}return[3,3];case 1:return this.filter=m.value,[4,this.populate(r)];case 2:return e.sent(),[3,4];case 3:throw Error("Invalid value of discoveryListSelect!");case 4:return[2]}})}).call(c)}),m.addEventListener("click",function(){c.soundPlayer.playNow(o.Wo.CLICK)});var T=document.createElement("div");T.classList.add("flex-row","contentHorizontalContainer"),this.htmlRoot.appendChild(T),this.discoveryList=document.createElement("div"),this.discoveryList.classList.add("flex-column","overflow-y-auto","discoveryList"),T.appendChild(this.discoveryList),this.discoveryDetails=new y(n,e,r,this.soundPlayer),this.discoveryDetails.onSellDiscovery.add(function(){return S(function(){return A(this,function(e){switch(e.label){case 0:return[4,this.populate(r)];case 1:return e.sent(),[2]}})}).call(c)}),T.appendChild(this.discoveryDetails.htmlRoot)}return e=[{key:"filterDiscoveryListByQuery",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.discoveryList.children[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a,s=o.value;a=HTMLDivElement,(null!=a&&"undefined"!=typeof Symbol&&a[Symbol.hasInstance]?!!a[Symbol.hasInstance](s):s instanceof a)&&(s.hidden=!s.innerHTML.toLowerCase().includes(e))}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"populate",value:function(e){return S(function(){var t,n,r,i,c,u,h,d,f,p,m,v,y,g,b,w,I,E;return A(this,function(R){switch(R.label){case 0:switch(t=this,this.discoveryList.innerHTML="",this.discoveryToHtmlItem.clear(),n=[],this.filter){case P:(r=n).push.apply(r,T(this.player.discoveries.local));break;case C:(i=n).push.apply(i,T(this.player.discoveries.uploaded));break;case"all":(c=n).push.apply(c,T(this.player.discoveries.local).concat(T(this.player.discoveries.uploaded)))}u=0,h=!0,d=!1,f=void 0,R.label=1;case 1:R.trys.push([1,6,7,8]),p=this.player.discoveries.local[Symbol.iterator](),R.label=2;case 2:if(h=(m=p.next()).done)return[3,5];return v=m.value,[4,this.encyclopaedia.estimateDiscovery(v.objectId)];case 3:if(!(y=R.sent()).success)return(0,l.UI)(l.I9.GENERAL,l.yg.ERROR,y.error,5e3,this.soundPlayer),[3,4];u+=y.value,R.label=4;case 4:return h=!0,[3,2];case 5:return[3,8];case 6:return g=R.sent(),d=!0,f=g,[3,8];case 7:try{h||null==p.return||p.return()}finally{if(d)throw f}return[7];case 8:if(this.sellAllButton.toggleAttribute("disabled",0===u),this.sellAllButton.innerText=a.A.t("common:sellAllFor",{price:"".concat(u.toLocaleString()).concat(s.w.CREDIT_SYMBOL)}),0===n.length)return(b=document.createElement("div")).classList.add("listItemContainer","flex-column"),this.discoveryList.appendChild(b),(w=document.createElement("h3")).innerText=a.A.t("explorationCenter:noDiscoveryTitle"),b.appendChild(w),(I=document.createElement("p")).innerText=a.A.t("explorationCenter:noDiscoveryText"),b.appendChild(I),[2];return(E=document.createElement("input")).type="search",E.placeholder=a.A.t("explorationCenter:searchForADiscovery"),E.addEventListener("keydown",function(e){e.stopPropagation()}),E.addEventListener("input",function(){t.filterDiscoveryListByQuery(E.value.toLowerCase())}),this.discoveryList.appendChild(E),n.forEach(function(n){var r,i=e.getObjectModelByUniverseId(n.objectId),s=document.createElement("div");s.classList.add("listItemContainer","flex-column"),s.classList.toggle("uploaded",t.player.discoveries.uploaded.includes(n)),s.addEventListener("click",function(){return S(function(){return A(this,function(t){switch(t.label){case 0:return this.soundPlayer.playNow(o.Wo.CLICK),null!==this.selectedDiscovery&&this.selectedDiscovery.classList.remove("selected"),this.selectedDiscovery=s,this.selectedDiscovery.classList.add("selected"),[4,this.discoveryDetails.setDiscovery(n,e)];case 1:return t.sent(),[2]}})}).call(t)}),t.discoveryToHtmlItem.set(n,s),t.discoveryList.appendChild(s);var l=document.createElement("h3");l.textContent=null!=(r=null==i?void 0:i.name)?r:a.A.t("common:unknown"),s.appendChild(l);var c=document.createElement("p");c.textContent=new Date(n.discoveryTimestamp).toLocaleDateString(),s.appendChild(c)}),[2]}})}).call(this)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),E=n(30020);function R(e){switch(e.type){case"warpDrive":return 2e4*(Math.pow(e.size,2)+e.quality);case"fuelScoop":return 7e3*(Math.pow(e.size,2)+e.quality);case"fuelTank":return 1e4*(Math.pow(e.size,2)+e.quality);case"discoveryScanner":return 5e3*(Math.pow(e.size,2)+e.quality);case"thrusters":return 15e3*(Math.pow(e.size,2)+e.quality)}}var N=n(2047),O=n(57719),L=n(16311),x=n(25157),M=n(93981);function _(e){switch(e.type){case"warpDrive":return new M.f(e);case"fuelScoop":return new O.J(e);case"fuelTank":return new L.f(e);case"discoveryScanner":return new N.b(e);case"thrusters":return new x.Z(e)}}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");k(this,"root",void 0),k(this,"placeHolderText",void 0),k(this,"selectedComponent",null),k(this,"onComponentSelect",new r.cP),this.root=document.createElement("div"),this.root.classList.add("componentBrowserUI","flex-column"),this.root.style.rowGap="10px",this.placeHolderText=document.createElement("p"),this.placeHolderText.innerText=a.A.t("spaceStation:noComponentSlotSelected"),this.placeHolderText.style.flexGrow="1",this.placeHolderText.style.justifyContent="center",this.placeHolderText.style.textAlign="center",this.placeHolderText.style.display="flex",this.placeHolderText.style.alignItems="center",this.root.appendChild(this.placeHolderText)}return e=[{key:"browseCategories",value:function(e,t,n){var r=this;this.root.innerHTML="",e.forEach(function(e){r.root.appendChild(r.createCategoryButton(e,t,n))})}},{key:"select",value:function(e){this.selectedComponent=e,this.onComponentSelect.notifyObservers(e)}},{key:"browse",value:function(e,t,n){var r=function(t){for(var n=function(n){var r=document.createElement("button");r.className="componentCategory",r.style.flex="1",r.innerText="".concat((0,E.q)(e)," ").concat(t).concat(s.w.QUALITY_CHARS.at(n)),r.addEventListener("click",function(){switch(e){case"warpDrive":case"fuelScoop":case"discoveryScanner":case"thrusters":o.select({type:e,size:t,quality:n});break;case"fuelTank":o.select({type:e,size:t,quality:n,currentFuel01:1})}}),g.appendChild(r)},r=0;r<s.w.QUALITY_CHARS.length;r++)n(r)},o=this;this.root.innerHTML="";var i=document.createElement("h2");i.innerText=a.A.t("spaceStation:yourSpareParts"),this.root.appendChild(i);var l=document.createElement("div");l.classList.add("flex-row","flex-wrap"),this.root.appendChild(l);var c=new Set,u=!0,h=!1,d=void 0;try{for(var f,p=n[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var m=f.value;m.type!==e||m.size>t||c.add(m)}}catch(e){h=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(h)throw d}}if(c.forEach(function(e){var t=document.createElement("button");t.className="componentCategory",t.innerText="".concat((0,E.q)(e.type)," ").concat(e.size).concat(s.w.QUALITY_CHARS.at(e.quality)),t.addEventListener("click",function(){o.select(e)}),l.appendChild(t)}),0===c.size){var v=document.createElement("p");v.innerText=a.A.t("spaceStation:noOwnedSparePartsForSlot"),l.appendChild(v)}var y=document.createElement("h2");y.innerText=a.A.t("spaceStation:availableSpareParts"),this.root.appendChild(y);var g=document.createElement("div");g.classList.add("flex-row","flex-wrap"),this.root.appendChild(g);for(var b=t;b<=t;b++)r(b)}},{key:"getSelectedComponent",value:function(){return this.selectedComponent}},{key:"createCategoryButton",value:function(e,t,n){var r=this,o=document.createElement("button");return o.className="componentCategory",o.innerText=(0,E.q)(e),o.addEventListener("click",function(){r.browse(e,t,n)}),o}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),j=n(45063),F=n(18511),U=n(28831),G=n(95293),B=n(54741);function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Y=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");H(this,"root",void 0),H(this,"placeHolderText",void 0),this.root=document.createElement("div"),this.root.className="componentSpec",this.placeHolderText=document.createElement("p"),this.placeHolderText.innerText=e,this.placeHolderText.style.flexGrow="1",this.placeHolderText.style.justifyContent="center",this.placeHolderText.style.textAlign="center",this.placeHolderText.style.display="flex",this.placeHolderText.style.alignItems="center",this.displayComponent(null)}return e=[{key:"displayComponent",value:function(e){if(this.root.innerHTML="",null===e)return void this.root.appendChild(this.placeHolderText);var t,n=document.createElement("h3"),r=null!=(t=s.w.QUALITY_CHARS.at(e.quality))?t:"[ERROR]";n.textContent="".concat((0,E.q)(e.type)," ").concat(e.size).concat(r),this.root.appendChild(n);var o=document.createElement("p");switch(o.innerText="".concat(a.A.t("spaceStation:value"),": ").concat(R(e).toLocaleString()," ").concat(s.w.CREDIT_SYMBOL),this.root.appendChild(o),e.type){case"warpDrive":this.root.appendChild(this.displayWarpDrive(e));break;case"fuelScoop":this.root.appendChild(this.displayFuelScoop(e));break;case"fuelTank":this.root.appendChild(this.displayFuelTank(e));break;case"discoveryScanner":this.root.appendChild(this.displayDiscoveryScanner(e));break;case"thrusters":this.root.appendChild(this.displayThrusters(e))}}},{key:"displayWarpDrive",value:function(e){var t=(0,B.Y)(e),n=document.createElement("div"),r=document.createElement("p");return r.innerText="".concat(a.A.t("spaceStation:range"),": ").concat(a.A.t("units:shortLy",{value:t.rangeLy.toLocaleString(void 0,{maximumSignificantDigits:3})})),n.appendChild(r),n}},{key:"displayFuelScoop",value:function(e){var t=(0,F.k)(e),n=document.createElement("div"),r=document.createElement("p");return r.innerText="".concat(a.A.t("spaceStation:scoopRate"),": ").concat(t.fuelPerSecond.toLocaleString(void 0,{maximumSignificantDigits:3})," L/s"),n.appendChild(r),n}},{key:"displayFuelTank",value:function(e){var t=(0,U.x)(e),n=document.createElement("div"),r=document.createElement("p");return r.innerText="".concat(a.A.t("spaceStation:capacity"),": ").concat(t.maxFuel.toLocaleString(void 0,{maximumSignificantDigits:3})," L"),n.appendChild(r),n}},{key:"displayDiscoveryScanner",value:function(e){var t=(0,j.q)(e),n=document.createElement("div"),r=document.createElement("p");return r.innerText="".concat(a.A.t("spaceStation:relativeRange"),": ").concat(t.relativeRange.toLocaleString(void 0,{maximumSignificantDigits:3})),n.appendChild(r),n}},{key:"displayThrusters",value:function(e){var t=(0,G.M)(e),n=document.createElement("div"),r=document.createElement("p");return r.innerText="".concat(a.A.t("spaceStation:maxSpeed"),": ").concat(t.maxSpeed.toLocaleString(void 0,{maximumSignificantDigits:3})," m/s"),n.appendChild(r),n}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function W(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var q=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");z(this,"root",void 0),z(this,"componentList",void 0),z(this,"componentBrowser",void 0),z(this,"rightPanel",void 0),z(this,"equippedComponentSpec",void 0),z(this,"storeButton",void 0),z(this,"sellButton",void 0),z(this,"selectedComponentSpec",void 0),z(this,"buyEquipButton",void 0),z(this,"equipButton",void 0),z(this,"activeSlotDiv",null),z(this,"activeSlot",null),this.root=document.createElement("div"),this.root.className="spaceshipOutfittingUI",this.componentList=document.createElement("div"),this.componentList.className="flex-column",this.root.appendChild(this.componentList),this.componentBrowser=new D,this.componentBrowser.onComponentSelect.add(function(t){r.selectedComponentSpec.displayComponent(t);var n=e.spareSpaceshipComponents.has(t);r.equipButton.disabled=!n,r.buyEquipButton.disabled=n}),this.root.appendChild(this.componentBrowser.root),this.rightPanel=document.createElement("div"),this.rightPanel.style.display="flex",this.rightPanel.style.flexDirection="column",this.rightPanel.style.background="transparent",this.rightPanel.style.padding="0px",this.rightPanel.style.rowGap="10px",this.root.appendChild(this.rightPanel);var l=document.createElement("h3");l.innerText=a.A.t("spaceStation:equippedComponent"),this.rightPanel.appendChild(l),this.equippedComponentSpec=new Y(a.A.t("spaceStation:noComponentEquippedOnSlot")),this.equippedComponentSpec.root.style.flexGrow="1",this.equippedComponentSpec.root.style.flex="1",this.rightPanel.appendChild(this.equippedComponentSpec.root);var c=document.createElement("div");c.style.display="flex",c.style.flexDirection="row",c.style.columnGap="10px",c.style.padding="0px",c.style.background="transparent",this.rightPanel.appendChild(c),this.storeButton=document.createElement("button"),this.storeButton.style.flexGrow="1",this.storeButton.innerText=a.A.t("spaceStation:storeButton"),this.storeButton.disabled=!0,this.storeButton.addEventListener("click",function(){if(null!==r.activeSlot){var t=r.activeSlot.getComponent();null!==t&&(r.activeSlot.setComponent(null),e.spareSpaceshipComponents.add(t.serialize()),r.handleClickOnSlot(r.activeSlot,e))}}),c.appendChild(this.storeButton),this.sellButton=document.createElement("button"),this.sellButton.style.flexGrow="1",this.sellButton.innerText=a.A.t("spaceStation:sellButton"),this.sellButton.disabled=!0,this.sellButton.addEventListener("click",function(){var t;return(t=function(){var t,r;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(l){switch(l.label){case 0:if(null===this.activeSlot||null===(t=this.activeSlot.getComponent()))return[2];return n.playNow(o.Wo.CLICK),r=.75*R(t.serialize()),[4,(0,i.QD)(a.A.t("spaceStation:sellConfirmation",{price:"".concat(r.toLocaleString()," ").concat(s.w.CREDIT_SYMBOL)}),n)];case 1:if(!l.sent())return[2];return this.activeSlot.setComponent(null),e.earn(r),this.handleClickOnSlot(this.activeSlot,e),[2]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(e){W(i,r,o,a,s,"next",e)}function s(e){W(i,r,o,a,s,"throw",e)}a(void 0)})}).call(r)}),c.appendChild(this.sellButton);var u=document.createElement("h3");u.innerText=a.A.t("spaceStation:selectedComponent"),this.rightPanel.appendChild(u),this.selectedComponentSpec=new Y(a.A.t("spaceStation:noComponentSelected")),this.selectedComponentSpec.root.style.flexGrow="1",this.selectedComponentSpec.root.style.flex="1",this.rightPanel.appendChild(this.selectedComponentSpec.root);var h=document.createElement("div");h.style.display="flex",h.style.flexDirection="row",h.style.columnGap="10px",h.style.padding="0px",h.style.background="transparent",this.rightPanel.appendChild(h),this.buyEquipButton=document.createElement("button"),this.buyEquipButton.style.flexGrow="1",this.buyEquipButton.innerText=a.A.t("spaceStation:buyEquipButton"),this.buyEquipButton.disabled=!0,this.buyEquipButton.addEventListener("click",function(){if(null!==r.activeSlot){var t=r.componentBrowser.getSelectedComponent();if(null!==t){var n=r.activeSlot.getComponent();null!==n&&(r.activeSlot.setComponent(null),e.spareSpaceshipComponents.add(n.serialize()));var o=R(t);e.pay(o),r.activeSlot.setComponent(_(t)),r.handleClickOnSlot(r.activeSlot,e)}}}),h.appendChild(this.buyEquipButton),this.equipButton=document.createElement("button"),this.equipButton.style.flexGrow="1",this.equipButton.innerText=a.A.t("spaceStation:equipButton"),this.equipButton.disabled=!0,this.equipButton.addEventListener("click",function(){if(null!==r.activeSlot){var t=r.componentBrowser.getSelectedComponent();if(null!==t&&e.spareSpaceshipComponents.has(t)){var n=r.activeSlot.getComponent();null!==n&&(r.activeSlot.setComponent(null),e.spareSpaceshipComponents.add(n.serialize())),r.activeSlot.setComponent(_(t)),e.spareSpaceshipComponents.delete(t),r.handleClickOnSlot(r.activeSlot,e)}}}),h.appendChild(this.equipButton)}return e=[{key:"generate",value:function(e,t,n){this.componentList.innerHTML="";var r=document.createElement("h2");r.innerText=a.A.t("spaceStation:primarySlots"),this.componentList.appendChild(r);var o=this.createComponentSlotUI(e.primary.warpDrive,t,n);this.componentList.appendChild(o);var i=this.createComponentSlotUI(e.primary.thrusters,t,n);this.componentList.appendChild(i);var s=this.createComponentSlotUI(e.primary.fuelTank,t,n);this.componentList.appendChild(s);var l=document.createElement("h2");l.innerText=a.A.t("spaceStation:optionalSlots"),this.componentList.appendChild(l);var c=!0,u=!1,h=void 0;try{for(var d,f=e.optionals[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var p=d.value,m=this.createComponentSlotUI(p,t,n);this.componentList.appendChild(m)}}catch(e){u=!0,h=e}finally{try{c||null==f.return||f.return()}finally{if(u)throw h}}}},{key:"createComponentSlotUI",value:function(e,t,n){var r=this,i=document.createElement("button"),s=e.getComponent();return i.textContent=null!==s?(0,E.q)(s.type):a.A.t("components:emptySlot"),i.classList.add("componentSlot"),i.addEventListener("click",function(){n.playNow(o.Wo.CLICK),r.handleClickOnSlot(e,t),null!==r.activeSlotDiv&&r.activeSlotDiv.classList.remove("active"),r.activeSlotDiv=i,i.classList.add("active")}),i}},{key:"handleClickOnSlot",value:function(e,t){var n,r;this.equippedComponentSpec.displayComponent(null!=(r=null==(n=e.getComponent())?void 0:n.serialize())?r:null),this.storeButton.disabled=null===e.getComponent(),this.sellButton.disabled=null===e.getComponent(),this.selectedComponentSpec.displayComponent(null),this.buyEquipButton.disabled=!0,this.equipButton.disabled=!0,this.activeSlot=e,e.types.length>1?this.componentBrowser.browseCategories(e.types,e.maxSize,t.spareSpaceshipComponents):void 0!==e.types[0]&&this.componentBrowser.browse(e.types[0],e.maxSize,t.spareSpaceshipComponents)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var J=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");V(this,"root",void 0),V(this,"currentSpaceshipContainer",void 0),V(this,"otherSpaceshipContainer",void 0),V(this,"spaceshipOutfittingUI",void 0),this.root=document.createElement("div");var r=document.createElement("h2");r.innerText=a.A.t("spaceStation:shipHangar"),this.root.appendChild(r),this.currentSpaceshipContainer=document.createElement("div"),this.currentSpaceshipContainer.classList.add("spaceshipContainer"),this.root.appendChild(this.currentSpaceshipContainer);var o=document.createElement("h2");o.innerText=a.A.t("spaceStation:otherSpaceships"),this.root.appendChild(o),this.otherSpaceshipContainer=document.createElement("div"),this.root.appendChild(this.otherSpaceshipContainer),this.spaceshipOutfittingUI=new q(e,n)}return e=[{key:"generate",value:function(e,t){var n=this;this.currentSpaceshipContainer.innerHTML="";var r=e.instancedSpaceships.at(0);if(void 0!==r){var i=document.createElement("h3");i.innerText=r.name,this.currentSpaceshipContainer.appendChild(i);var s=document.createElement("div");s.classList.add("fuelManagementContainer"),this.currentSpaceshipContainer.appendChild(s);var l=document.createElement("p");l.innerText="Fuel: ".concat(r.getRemainingFuel().toFixed(0)," / ").concat(r.getTotalFuelCapacity()),s.appendChild(l);var c=document.createElement("button");c.innerText=a.A.t("spaceStation:outfitting"),s.appendChild(c),c.addEventListener("click",function(){if(t.playNow(o.Wo.CLICK),c.classList.contains("active")){c.classList.remove("active"),n.currentSpaceshipContainer.removeChild(n.spaceshipOutfittingUI.root);return}c.classList.add("active"),n.spaceshipOutfittingUI.generate(r.getInternals(),e,t),n.currentSpaceshipContainer.appendChild(n.spaceshipOutfittingUI.root)});var u=document.createElement("button");u.innerText=a.A.t("spaceStation:refuel"),u.addEventListener("click",function(){t.playNow(o.Wo.CLICK);var n=r.getTotalFuelCapacity()-r.getRemainingFuel();e.pay(Math.round(10*n)),r.refuel(n),l.innerText="Fuel: ".concat(r.getRemainingFuel()," / ").concat(r.getTotalFuelCapacity())}),s.appendChild(u)}else this.currentSpaceshipContainer.innerText=a.A.t("spaceStation:noSpaceship");if(this.otherSpaceshipContainer.innerHTML="",0===e.serializedSpaceships.length){var h=document.createElement("p");h.innerText=a.A.t("spaceStation:noOtherSpaceship"),this.otherSpaceshipContainer.appendChild(h)}e.serializedSpaceships.forEach(function(e){var t=document.createElement("div");n.otherSpaceshipContainer.appendChild(t);var r=document.createElement("p");r.innerText=e.name,t.appendChild(r);var o=document.createElement("button");o.innerText="Switch to this spaceship",o.addEventListener("click",function(){throw Error("Not implemented")}),t.appendChild(o)})}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),X=n(96069),Z=n(92293);function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Q=n(47759);function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var et=n(81098),en=n(4035),er=n(98510),eo=n(61741),ei=n(26274),ea=n(32220),es=n(36801),el=n(53843),ec=n(61032),eu=n(6215),eh=n(66360),ed=n(43628);function ef(e,t,n){var r=function(e,t){switch(e.type){case er.P.SIGHT_SEEING_FLY_BY:return new eh.L(e.objectId);case er.P.SIGHT_SEEING_TERMINATOR_LANDING:return new ed.V(e.objectId);case er.P.SIGHT_SEEING_ASTEROID_FIELD:return eu.q.New(e.objectId,t)}}(t,n);if(null===r)return null;var o=t.objectId.systemCoordinates,i=(0,el.tr)(n.getSystemGalacticPosition(e.systemCoordinates)),a=(0,el.tr)(n.getSystemGalacticPosition(o)),s=es.Pq.Distance(i,a),l=n.getObjectModelByUniverseId(t.objectId),c=Math.max(5e3,1e3*Math.ceil(s));return((null==l?void 0:l.type)===eo.T.NEUTRON_STAR||(null==l?void 0:l.type)===eo.T.BLACK_HOLE)&&(c*=1.5),new ec.P(r,c,e,t.type)}function ep(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function em(e){return function(e){if(Array.isArray(e))return ep(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ev(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ev(e,t){if(e){if("string"==typeof e)return ep(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ep(e,t)}}var ey=n(56367),eg=function e(t,n,r){var i,s,l=this;if(!(this instanceof e))throw TypeError("Cannot call a class as a function");s=void 0,(i="rootNode")in this?Object.defineProperty(this,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[i]=s,this.rootNode=document.createElement("button"),this.rootNode.className="missionButton",this.rootNode.innerText=a.A.t("missions:common:accept"),n.currentMissions.find(function(e){return e.equals(t)})&&(this.rootNode.classList.add("accepted"),this.rootNode.innerText=a.A.t("missions:common:accepted")),this.rootNode.addEventListener("click",function(){if(r.playNow(o.Wo.CLICK),n.currentMissions.find(function(e){return e.equals(t)})){l.rootNode.classList.remove("accepted"),l.rootNode.innerText=a.A.t("missions:common:accept"),n.currentMissions=n.currentMissions.filter(function(e){return!e.equals(t)});return}l.rootNode.classList.add("accepted"),l.rootNode.innerText=a.A.t("missions:common:accepted"),n.currentMissions.push(t)})},eb=function e(t,n,r,o){if(!(this instanceof e))throw TypeError("Cannot call a class as a function");a=void 0,(i="rootNode")in this?Object.defineProperty(this,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):this[i]=a,this.rootNode=document.createElement("div"),this.rootNode.className="missionItem";var i,a,l=document.createElement("div");l.className="missionDescription",this.rootNode.appendChild(l);var c=document.createElement("h4");c.innerText=t.getTypeString(),l.appendChild(c);var u=document.createElement("p");u.innerText=t.describe(r),l.appendChild(u);var h=document.createElement("p");h.innerText="Reward: ".concat(s.w.CREDIT_SYMBOL).concat(t.getReward().toLocaleString()),l.appendChild(h);var d=document.createElement("div");d.className="missionButtonContainer",this.rootNode.appendChild(d);var f=new eg(t,n,o);d.appendChild(f.rootNode)};let eS=n.p+"9c9a8a93963b1eaf.webp",ew=n.p+"0c0ce4015439090c.webp";var eT=n(74452),eA=n(41077),eP=n(23684);let eC=n.p+"17bdf4ad942393a5.webp",eI=n.p+"91086f2a50d84883.webp";function eE(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function eR(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){eE(i,r,o,a,s,"next",e)}function s(e){eE(i,r,o,a,s,"throw",e)}a(void 0)})}}function eN(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eO(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var eL=function(){var e;function t(e,n,s,l){var c=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");eN(this,"rootHtml",void 0),eN(this,"header",void 0),eN(this,"headerWelcome",void 0),eN(this,"headerStationName",void 0),eN(this,"playerInfoContainer",void 0),eN(this,"playerNameContainer",void 0),eN(this,"playerName",void 0),eN(this,"editPlayerNameButton",void 0),eN(this,"playerBalance",void 0),eN(this,"mainPanel",void 0),eN(this,"actionsContainer",void 0),eN(this,"missionsButton",void 0),eN(this,"spaceshipHangarButton",void 0),eN(this,"tradingButton",void 0),eN(this,"explorationCenterButton",void 0),eN(this,"infoButton",void 0),eN(this,"takeOffButton",void 0),eN(this,"currentStation",null),eN(this,"currentStationParents",[]),eN(this,"mainPanelState",0),eN(this,"explorationCenterPanel",void 0),eN(this,"spaceshipDockPanel",void 0),eN(this,"onTakeOffObservable",new r.cP),eN(this,"soundPlayer",void 0),this.soundPlayer=l,e.onBalanceChangedObservable.add(function(e){c.updatePlayerBalance(e)}),e.onNameChangedObservable.add(function(e){c.updatePlayerName(e)}),this.rootHtml=document.createElement("div"),this.rootHtml.setAttribute("id","spaceStationUI"),document.body.appendChild(this.rootHtml),this.header=document.createElement("header"),this.header.setAttribute("class","spaceStationHeader"),this.rootHtml.appendChild(this.header),this.headerWelcome=document.createElement("p"),this.headerWelcome.setAttribute("class","welcomeTo"),this.headerWelcome.textContent=a.A.t("spaceStation:welcomeTo"),this.header.appendChild(this.headerWelcome),this.headerStationName=document.createElement("p"),this.headerStationName.setAttribute("class","spaceStationName"),this.header.appendChild(this.headerStationName),this.playerInfoContainer=document.createElement("div"),this.playerInfoContainer.setAttribute("class","playerInfo"),this.rootHtml.appendChild(this.playerInfoContainer),this.playerNameContainer=document.createElement("div"),this.playerNameContainer.setAttribute("class","playerName"),this.playerInfoContainer.appendChild(this.playerNameContainer),this.playerName=document.createElement("h2"),this.playerNameContainer.appendChild(this.playerName),this.editPlayerNameButton=document.createElement("button"),this.editPlayerNameButton.setAttribute("class","icon"),this.editPlayerNameButton.addEventListener("click",function(){return eR(function(){var t;return eO(this,function(n){switch(n.label){case 0:return this.soundPlayer.playNow(o.Wo.CLICK),[4,(0,i.TF)(a.A.t("spaceStation:cmdrNameChangePrompt"),e.getName(),this.soundPlayer)];case 1:if(null===(t=n.sent()))return[2];return e.setName(t),[2]}})}).call(c)}),this.playerNameContainer.appendChild(this.editPlayerNameButton);var u=document.createElement("img");u.setAttribute("src",eS),this.editPlayerNameButton.appendChild(u),this.playerBalance=document.createElement("p"),this.playerBalance.setAttribute("class","playerBalance"),this.playerInfoContainer.appendChild(this.playerBalance),this.mainPanel=document.createElement("div"),this.mainPanel.setAttribute("class","mainContainer hidden"),this.rootHtml.appendChild(this.mainPanel),this.explorationCenterPanel=new I(n,e,s,this.soundPlayer),this.actionsContainer=document.createElement("div"),this.actionsContainer.setAttribute("class","spaceStationActions"),this.rootHtml.appendChild(this.actionsContainer),this.missionsButton=document.createElement("div"),this.missionsButton.setAttribute("class","spaceStationAction missionsButton"),this.actionsContainer.appendChild(this.missionsButton);var h=document.createElement("img");h.setAttribute("src",eT),h.setAttribute("alt","Mission icon"),this.missionsButton.appendChild(h);var d=document.createElement("h2");d.textContent=a.A.t("spaceStation:missions"),this.missionsButton.appendChild(d);var f=document.createElement("p");f.textContent=a.A.t("spaceStation:missionsDescription"),this.missionsButton.appendChild(f),this.spaceshipHangarButton=document.createElement("div"),this.spaceshipHangarButton.setAttribute("class","spaceStationAction spaceshipButton"),this.actionsContainer.appendChild(this.spaceshipHangarButton);var p=document.createElement("img");p.setAttribute("src",eP),p.setAttribute("alt","Spaceship icon"),this.spaceshipHangarButton.appendChild(p);var m=document.createElement("h2");m.textContent=a.A.t("spaceStation:shipHangar"),this.spaceshipHangarButton.appendChild(m);var v=document.createElement("p");v.textContent=a.A.t("spaceStation:shipHangarDescription"),this.spaceshipHangarButton.appendChild(v),this.explorationCenterButton=document.createElement("div"),this.explorationCenterButton.setAttribute("class","spaceStationAction explorationCenterButton"),this.actionsContainer.appendChild(this.explorationCenterButton);var y=document.createElement("img");y.setAttribute("src",eC),y.setAttribute("alt","Exploration icon"),this.explorationCenterButton.appendChild(y);var g=document.createElement("h2");g.textContent=a.A.t("spaceStation:explorationCenter"),this.explorationCenterButton.appendChild(g);var b=document.createElement("p");b.textContent=a.A.t("spaceStation:explorationCenterDescription"),this.explorationCenterButton.appendChild(b),this.tradingButton=document.createElement("div"),this.tradingButton.setAttribute("class","spaceStationAction tradingButton disabled"),this.actionsContainer.appendChild(this.tradingButton);var S=document.createElement("img");S.setAttribute("src",eI),S.setAttribute("alt","Market icon"),this.tradingButton.appendChild(S);var w=document.createElement("h2");w.textContent=a.A.t("spaceStation:market"),this.tradingButton.appendChild(w);var T=document.createElement("p");T.textContent=a.A.t("spaceStation:marketDescription"),this.tradingButton.appendChild(T),this.infoButton=document.createElement("div"),this.infoButton.setAttribute("class","spaceStationAction infoButton"),this.actionsContainer.appendChild(this.infoButton);var A=document.createElement("img");A.setAttribute("src",eA),A.setAttribute("alt","Info icon"),this.infoButton.appendChild(A);var P=document.createElement("h2");P.textContent=a.A.t("spaceStation:stationInformation"),this.infoButton.appendChild(P);var C=document.createElement("p");C.textContent=a.A.t("spaceStation:stationInformationDescription"),this.infoButton.appendChild(C);var E=document.createElement("div");E.setAttribute("class","flexGrow"),this.actionsContainer.appendChild(E),this.takeOffButton=document.createElement("div"),this.takeOffButton.setAttribute("class","spaceStationAction takeOffButton"),this.actionsContainer.appendChild(this.takeOffButton);var R=document.createElement("img");R.setAttribute("src",ew),R.setAttribute("alt","Take-off icon"),this.takeOffButton.appendChild(R);var N=document.createElement("h2");N.textContent=a.A.t("spaceStation:takeOff"),this.takeOffButton.appendChild(N);var O=document.createElement("p");O.textContent=a.A.t("spaceStation:takeOffDescription"),this.takeOffButton.appendChild(O),this.missionsButton.addEventListener("click",function(){return eR(function(){return eO(this,function(t){switch(t.label){case 0:return this.soundPlayer.playNow(o.Wo.CLICK),[4,this.setMainPanelState(2,e,s)];case 1:return t.sent(),[2]}})}).call(c)}),this.spaceshipHangarButton.addEventListener("click",function(){return eR(function(){return eO(this,function(t){switch(t.label){case 0:return this.soundPlayer.playNow(o.Wo.CLICK),[4,this.setMainPanelState(3,e,s)];case 1:return t.sent(),[2]}})}).call(c)}),this.explorationCenterButton.addEventListener("click",function(){return eR(function(){return eO(this,function(t){switch(t.label){case 0:return this.soundPlayer.playNow(o.Wo.CLICK),[4,this.setMainPanelState(4,e,s)];case 1:return t.sent(),[2]}})}).call(c)}),this.infoButton.addEventListener("click",function(){return eR(function(){return eO(this,function(t){switch(t.label){case 0:return this.soundPlayer.playNow(o.Wo.CLICK),[4,this.setMainPanelState(1,e,s)];case 1:return t.sent(),[2]}})}).call(c)}),this.takeOffButton.addEventListener("click",function(){c.soundPlayer.playNow(o.Wo.CLICK),c.onTakeOffObservable.notifyObservers()}),this.spaceshipDockPanel=new J(e,l)}return e=[{key:"setMainPanelState",value:function(e,t,n){return eR(function(){return eO(this,function(r){switch(r.label){case 0:if(this.mainPanelState===e?this.mainPanelState=0:this.mainPanelState=e,null!==this.currentStation)return[3,2];return[4,(0,i.sQ)("No current station",this.soundPlayer)];case 1:return r.sent(),[2];case 2:switch(this.mainPanelState){case 1:return[3,3];case 2:return[3,4];case 3:return[3,5];case 4:return[3,6];case 0:return[3,8]}return[3,9];case 3:var o,a,s,l,c,u,f,p,m,v,y,g;return this.mainPanel.classList.remove("hidden"),this.mainPanel.innerHTML=(o=this.currentStation,a=this.currentStationParents,s=o.agricultureMix,l=a.map(function(e){return e.name}).join("-"),c=a.reduce(function(e,t){return e+t.mass},0),u=(0,h.tQ)(o.orbit.semiMajorAxis,c),"\n        <h2>General information</h2>\n        \n        <p>".concat(o.name," is orbiting ").concat(l," at a distance of ").concat((.001*o.orbit.semiMajorAxis).toLocaleString(void 0,{maximumSignificantDigits:3}),"km. \n        One orbit around ").concat(l," takes ").concat((u/86400).toLocaleString(void 0,{maximumSignificantDigits:3})," days</p>\n\n        <p>").concat(o.name," is affiliated to ").concat((0,X.fy)(o.faction),"</p>\n\n        <p>It is the home to ").concat(o.population.toLocaleString(void 0,{maximumSignificantDigits:3})," inhabitants, with a population density of ").concat(o.populationDensity.toLocaleString(void 0,{maximumSignificantDigits:3})," per km\xb2</p>\n\n        <h2>Agriculture mix</h2>\n\n        ").concat((f=function(e){return ee(e,1)[0]},p=function(e){var t=ee(e,2)[1];return(0,Q.tb)(t)},m=(0,Z.rLf)().value(f)(function(e){if(Array.isArray(e))return K(e)}(s)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(s)||function(e,t){if(e){if("string"==typeof e)return K(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return K(e,t)}}(s)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),v=(0,Z.JLW)().innerRadius(0).outerRadius(200),y=(0,Z.exT)(Z.GAA).domain([0,s.length]),g=m.map(function(e,t){return{path:v(e),data:e.data,color:y(t)}}),'\n    <svg viewBox="-250 -250 800 500">\n        '.concat(g.map(function(e,t){var n=e.path,r=e.data,o=e.color;return'\n        <g class="pie-slice-group">\n            <path d="'.concat(n,'" fill="').concat(o,'" class="pie-slice"></path>\n\n            <rect x="250" y="').concat((t-g.length/2)*40,'" width="30" height="30" fill="').concat(o,'"></rect>\n            <text x="290" y="').concat((t-g.length/2)*40+24,'" font-size="24">').concat(p(r),"</text>\n        </g>")}).join(""),"\n    </svg>\n    ")),"\n    ")),[3,9];case 4:return this.mainPanel.classList.remove("hidden"),this.mainPanel.innerHTML="",this.mainPanel.appendChild(function(e,t,n,r){var o=n.getSystemModelFromCoordinates(e.starSystemCoordinates);if(null===o)throw Error("Cannot generate missions for a space station in an unknown star system");var i=(f=Math.floor(Date.now()/1e3/60/60)%720,p=[],m=(0,ea.p)(e.seed+f),v=(0,ei.Ei)(e,o),(0,en.f)(o.coordinates,75,n).forEach(function(e){var t,r,o,i,a,s,l,c=e.coordinates,u=e.position,h=e.distance,d=n.getSystemModelFromCoordinates(c);null!==d&&p.push.apply(p,em((t=d,r=u,o=v,i=h,a=m,s=n,(l=[]).push.apply(l,em(function(e,t,n,r,o,i){var a=[],s=!0,l=!1,c=void 0;try{for(var u,h=e.anomalies.entries()[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d,f=(d=u.value,function(e){if(Array.isArray(e))return e}(d)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(d,2)||ev(d,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),p=f[0],m=f[1];if((0,et.uniformRandBool)(1/(1+1.5*r),o,38+p+t.length())&&m.type!==eo.T.DARK_KNIGHT){var v=ef(n,{type:er.P.SIGHT_SEEING_FLY_BY,objectId:{systemCoordinates:e.coordinates,idInSystem:m.id}},i);null!==v&&a.push(v)}}}catch(e){l=!0,c=e}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return a}(t,r,o,i,a,s))),l.push.apply(l,em(function(e,t,n){var r=[],o=e.stellarObjects.filter(function(e){return e.type===eo.T.NEUTRON_STAR}),i=!0,a=!1,s=void 0;try{for(var l,c=o[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value,h=ef(t,{type:er.P.SIGHT_SEEING_FLY_BY,objectId:{systemCoordinates:e.coordinates,idInSystem:u.id}},n);null!==h&&r.push(h)}}catch(e){a=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}return r}(t,o,s))),l.push.apply(l,em(function(e,t,n){var r=[],o=e.stellarObjects.filter(function(e){return e.type===eo.T.BLACK_HOLE}),i=!0,a=!1,s=void 0;try{for(var l,c=o[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value,h=ef(t,{type:er.P.SIGHT_SEEING_FLY_BY,objectId:{systemCoordinates:e.coordinates,idInSystem:u.id}},n);null!==h&&r.push(h)}}catch(e){a=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}return r}(t,o,s))),l)))}),p.push.apply(p,em(function(e,t,n){var r=[],o=!0,i=!1,a=void 0;try{for(var s,l=e.planets[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;if(null!==c.rings){var u=ef(t,{type:er.P.SIGHT_SEEING_ASTEROID_FIELD,objectId:{systemCoordinates:e.coordinates,idInSystem:c.id}},n);null!==u&&r.push(u)}}}catch(e){i=!0,a=e}finally{try{o||null==l.return||l.return()}finally{if(i)throw a}}return r}(o,v,n))),p.push.apply(p,em(function(e,t,n){var r=[],o=!0,i=!1,a=void 0;try{for(var s,l=e.planets[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;if(c.type===eo.T.TELLURIC_PLANET&&null===c.ocean){var u=ef(t,{type:er.P.SIGHT_SEEING_TERMINATOR_LANDING,objectId:{systemCoordinates:e.coordinates,idInSystem:c.id}},n);null!==u&&r.push(u)}}}catch(e){i=!0,a=e}finally{try{o||null==l.return||l.return()}finally{if(i)throw a}}return r}(o,v,n))),p.filter(function(e){return t.currentMissions.concat(t.completedMissions).every(function(t){return!e.equals(t)})})),a=(0,en.f)(o.coordinates,75,n),s=(0,ea.p)(e.seed),l=[],c=!0,u=!1,h=void 0;try{for(var f,p,m,v,y,g=a[Symbol.iterator]();!(c=(y=g.next()).done);c=!0)!function(){var e=y.value,t=n.getSystemModelFromCoordinates(e.coordinates);if(null===t)throw Error("System model not found for coordinates generated by getNeighborStarSystemCoordinates");var r=t.orbitalFacilities.map(function(t){return{model:t,distance:e.distance}});l=l.concat(r)}()}catch(e){u=!0,h=e}finally{try{c||null==g.return||g.return()}finally{if(u)throw h}}var b=l.filter(function(e,t){return(0,et.uniformRandBool)(1/(1+.02*Math.pow(e.distance,2)),s,325+t)}).filter(function(t){return t.model.faction===e.faction});b.sort(function(e,t){return e.distance-t.distance});var S=document.createElement("div"),w=document.createElement("h2");w.innerText="Missions",S.appendChild(w);var T=document.createElement("h3");T.innerText="Exploration",S.appendChild(T);var A=document.createElement("div");A.className="missionList",S.appendChild(A),i.forEach(function(e){var o=new eb(e,t,n,r);A.appendChild(o.rootNode)});var P=document.createElement("h3");P.innerText="Terraformation",S.appendChild(P);var C=document.createElement("h3");return C.innerText="Trading",S.appendChild(C),b.forEach(function(e){var t=e.model,n=e.distance,r=document.createElement("p");r.innerText="".concat(t.name," in ").concat(o.name," (").concat((0,d.Fj)((0,ey.E1)(n)),")"),S.appendChild(r)}),S}(this.currentStation,t,n,this.soundPlayer)),[3,9];case 5:return this.mainPanel.classList.remove("hidden"),this.mainPanel.innerHTML="",this.spaceshipDockPanel.generate(t,this.soundPlayer),this.mainPanel.appendChild(this.spaceshipDockPanel.root),[3,9];case 6:return this.mainPanel.classList.remove("hidden"),this.mainPanel.innerHTML="",[4,this.explorationCenterPanel.populate(n)];case 7:return r.sent(),this.mainPanel.appendChild(this.explorationCenterPanel.htmlRoot),[3,9];case 8:return this.mainPanel.classList.add("hidden"),this.mainPanel.innerHTML="",[3,9];case 9:return[2]}})}).call(this)}},{key:"setVisibility",value:function(e){(""===this.rootHtml.style.visibility||this.isVisible()!==e)&&(this.rootHtml.style.visibility=e?"visible":"hidden")}},{key:"isVisible",value:function(){return"hidden"!==this.rootHtml.style.visibility}},{key:"setStation",value:function(e,t,n){this.currentStation!==e&&(this.currentStation=e,this.currentStationParents=t,this.headerStationName.textContent=e.name,this.updatePlayerName(n.getName()),this.updatePlayerBalance(n.getBalance()))}},{key:"updatePlayerName",value:function(e){this.playerName.textContent="CMDR ".concat(e)}},{key:"updatePlayerBalance",value:function(e){this.playerBalance.textContent="Balance: ".concat(s.w.CREDIT_SYMBOL).concat(e.toLocaleString())}},{key:"reset",value:function(){this.currentStation=null,this.headerStationName.textContent="",this.playerName.textContent="",this.playerBalance.textContent="",this.mainPanel.classList.add("hidden"),this.mainPanel.innerHTML=""}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},89668:function(e,t,n){"use strict";n.d(t,{p:()=>d});var r=n(36801),o=n(74334),i=n(76161),a=n(13298),s=n(63215),l=n(53024);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");switch(c(this,"htmlRoot",void 0),c(this,"cursor",void 0),c(this,"textBlock",void 0),c(this,"nameText",void 0),c(this,"typeText",void 0),c(this,"distanceText",void 0),c(this,"etaText",void 0),c(this,"object",void 0),c(this,"lastDistance",0),c(this,"minDistance",void 0),c(this,"maxDistance",void 0),c(this,"minSize",void 0),c(this,"maxSize",void 0),c(this,"alpha",1),c(this,"screenCoordinates",r.Pq.Zero()),c(this,"isTarget",!1),c(this,"isInformationEnabled",!1),this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("targetCursorRoot"),this.htmlRoot.dataset.name=e.getTransform().name+" Target Cursor Root",this.cursor=document.createElement("div"),this.cursor.classList.add("targetCursor"),e.targetInfo.type){case l.L.CELESTIAL_BODY:this.cursor.classList.add("rounded"),this.minSize=5,this.maxSize=0;break;case l.L.FACILITY:this.cursor.classList.add("rotated"),this.minSize=3,this.maxSize=0;break;case l.L.ANOMALY:this.cursor.classList.add("rounded"),this.minSize=2,this.maxSize=0;break;case l.L.LANDING_PAD:this.cursor.classList.add("rotated"),this.minSize=1.5,this.maxSize=1.5;break;case l.L.STAR_SYSTEM:this.cursor.classList.add("rounded"),this.minSize=1.5,this.maxSize=1.5}this.textBlock=document.createElement("div"),this.textBlock.classList.add("targetCursorText"),this.nameText=document.createElement("p"),this.nameText.classList.add("targetCursorName"),this.nameText.textContent=e.getTransform().name,this.typeText=document.createElement("p"),this.typeText.classList.add("targetCursorType"),this.typeText.textContent=e.getTypeName(),this.distanceText=document.createElement("p"),this.distanceText.classList.add("targetCursorDistance"),this.distanceText.textContent="0 km",this.etaText=document.createElement("p"),this.etaText.classList.add("targetCursorEta"),this.etaText.textContent="∞",document.body.appendChild(this.htmlRoot),this.htmlRoot.appendChild(this.cursor),this.htmlRoot.appendChild(this.textBlock),this.textBlock.appendChild(this.nameText),this.textBlock.appendChild(this.typeText),this.textBlock.appendChild(this.distanceText),this.textBlock.appendChild(this.etaText),this.object=e,this.minDistance=e.targetInfo.minDistance,this.maxDistance=e.targetInfo.maxDistance}return e=[{key:"setTarget",value:function(e){this.isTarget=e,this.cursor.classList.toggle("target",e)}},{key:"setInformationEnabled",value:function(e){this.isInformationEnabled=e}},{key:"update",value:function(e){var t=this.object.getTransform().getAbsolutePosition().subtract(e.globalPosition),n=t.length(),l=t.scale(1/n),c=e.getDirection(r.Pq.Forward(e.getScene().useRightHandedSystem));r.Pq.Dot(l,c)>0&&this.alpha>0?(r.Pq.ProjectToRef(this.object.getTransform().getAbsolutePosition(),o.uq.IdentityReadOnly,e.getTransformationMatrix(),e.viewport,this.screenCoordinates),this.htmlRoot.classList.remove("hidden"),this.htmlRoot.style.left="".concat(this.screenCoordinates.x*e.getEngine().getRenderWidth(),"px"),this.htmlRoot.style.top="".concat(this.screenCoordinates.y*e.getEngine().getRenderHeight(),"px")):this.htmlRoot.classList.add("hidden");var u=this.lastDistance-n,h=0!==u?u/(e.getScene().getEngine().getDeltaTime()/1e3):0;t.scaleInPlace(1/n);var d=1.3*((0,i.q)(this.object.getTransform().getAbsolutePosition(),this.object.getBoundingRadius(),e.globalPosition)/e.fov)*100;this.minSize>0&&(d=Math.max(d,this.minSize)),this.maxSize>0&&(d=Math.min(d,this.maxSize)),this.htmlRoot.style.setProperty("--dim","".concat(d,"vh")),this.alpha=1,this.minDistance>0&&(this.alpha*=(0,a.TF)(.5*this.minDistance,this.minDistance,n)),this.maxDistance>0&&!this.isTarget&&(this.alpha*=(0,a.TF)(1.5*this.maxDistance,this.maxDistance,n)),this.cursor.style.opacity="".concat(Math.min(this.alpha,this.isTarget?1:.5)),this.textBlock.style.opacity=this.isInformationEnabled?"".concat(this.alpha):"0.0",this.distanceText.innerText=(0,s.Fj)(n);var f=n/h;this.etaText.innerText="ETA: "+(h>0?(0,s.Wf)(f):"∞"),this.lastDistance=n}},{key:"isVisible",value:function(){return this.alpha>0}},{key:"dispose",value:function(){this.htmlRoot.remove()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");h(this,"targetCursors",[]),h(this,"layerRoot",void 0),h(this,"target",null),h(this,"closestToScreenCenterOrbitalObject",null),this.layerRoot=document.createElement("div"),this.layerRoot.classList.add("targetCursorLayer"),document.body.appendChild(this.layerRoot)}return e=[{key:"setEnabled",value:function(e){this.layerRoot.style.display=e?"block":"none"}},{key:"isEnabled",value:function(){return"block"===this.layerRoot.style.display}},{key:"addObject",value:function(e){var t=new u(e);this.targetCursors.push(t),this.layerRoot.appendChild(t.htmlRoot)}},{key:"computeClosestToScreenCenterOrbitalObject",value:function(){var e=null,t=1/0;this.targetCursors.forEach(function(n){if(n.isVisible()){var o=n.screenCoordinates.subtract(new r.Pq(.5,.5,0)).length();o<t&&(t=o,e=n.object)}}),this.closestToScreenCenterOrbitalObject=e}},{key:"getClosestToScreenCenterOrbitalObject",value:function(){return this.closestToScreenCenterOrbitalObject}},{key:"reset",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.targetCursors[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)r.value.dispose()}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.targetCursors=[]}},{key:"setTarget",value:function(e,t){var n=this.target===e;if(void 0!==t&&(n=!t),n){this.target=null;return}this.target=e}},{key:"getTarget",value:function(){return this.target}},{key:"update",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.targetCursors[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;a.update(e);var s=Math.pow(a.screenCoordinates.x-.5,2)+Math.pow(a.screenCoordinates.y-.5,2)<.1*.1&&a.object===this.closestToScreenCenterOrbitalObject,l=a.object===this.target;a.setTarget(l),a.setInformationEnabled(l||s)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}this.computeClosestToScreenCenterOrbitalObject()}},{key:"dispose",value:function(){this.reset()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},58168:function(e,t,n){"use strict";n.d(t,{O:()=>p});var r=n(48462),o=n(76448),i=n(90160),a=n(81629),s=n(95369),l=n(78706),c=n(35789);function u(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,s,"next",e)}function s(e){u(i,r,o,a,s,"throw",e)}a(void 0)})}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var p=function(){var e;function t(e){var n=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");d(this,"root",void 0),d(this,"soundPlayer",void 0),d(this,"panel",void 0),d(this,"title",void 0),d(this,"contentContainer",void 0),d(this,"controls",void 0),d(this,"prevButton",void 0),d(this,"nextButton",void 0),d(this,"tutorialPanelsHtml",[]),d(this,"currentPanelIndex",0),d(this,"onQuitTutorial",new r.cP),this.soundPlayer=e,this.root=document.createElement("div"),this.root.classList.add("tutorialLayer"),this.panel=document.createElement("div"),this.panel.classList.add("tutorialPanel"),this.panel.classList.add("hidden"),this.title=document.createElement("h1"),this.title.innerText="Tutorial",this.panel.appendChild(this.title),this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("tutorialContentContainer"),this.panel.appendChild(this.contentContainer),this.controls=document.createElement("div"),this.controls.classList.add("tutorialControls"),this.prevButton=document.createElement("p");var u=document.createElement("span");u.innerText=l.A.t("tutorials:common:previous"),this.prevButton.appendChild(u),this.nextButton=document.createElement("p");var p=document.createElement("span");p.innerText=l.A.t("tutorials:common:next"),this.nextButton.appendChild(p),(0,s.t)().then(function(e){(0,i.hg)(c.I.map.prevPanel,e).forEach(function(e){var t=document.createElement("span");t.classList.add("keySpan"),t.innerText=e,n.prevButton.appendChild(t)}),(0,i.hg)(c.I.map.nextPanel,e).forEach(function(e){var t=document.createElement("span");t.classList.add("keySpan"),t.innerText=e,n.nextButton.appendChild(t)})}),this.controls.appendChild(this.prevButton),this.controls.appendChild(this.nextButton),this.panel.appendChild(this.controls),this.root.appendChild(this.panel),c.I.map.prevPanel.on("complete",function(){0!==n.currentPanelIndex&&(n.currentPanelIndex=Math.max(0,n.currentPanelIndex-1),n.updatePanelState(),n.prevButton.animate([{transform:"scale(1)"},{transform:"scale(1.1)"},{transform:"scale(1)"}],{duration:200,easing:"ease"}),n.soundPlayer.playNow(o.Wo.CLICK))}),c.I.map.nextPanel.on("complete",function(){return h(function(){return f(this,function(e){switch(e.label){case 0:if(this.currentPanelIndex!==this.tutorialPanelsHtml.length-1)return[3,2];return c.I.setEnabled(!1),[4,(0,a.QD)(l.A.t("tutorials:common:quitConfirm"),this.soundPlayer)];case 1:if(e.sent())return this.quitTutorial(),[2];return c.I.setEnabled(!0),[2];case 2:return this.currentPanelIndex=Math.min(this.tutorialPanelsHtml.length-1,this.currentPanelIndex+1),this.updatePanelState(),this.nextButton.animate([{transform:"scale(1)"},{transform:"scale(1.1)"},{transform:"scale(1)"}],{duration:200,easing:"ease"}),this.soundPlayer.playNow(o.Wo.CLICK),[2]}})}).call(n)})}return e=[{key:"setTutorial",value:function(e){return h(function(){var t;return f(this,function(n){switch(n.label){case 0:return this.isEnabled()&&this.quitTutorial(),this.title.innerText=e.getTitle(),t=this,[4,e.getContentPanelsHtml()];case 1:return t.tutorialPanelsHtml=n.sent(),this.currentPanelIndex=0,this.updatePanelState(),this.setEnabled(!0),[2]}})}).call(this)}},{key:"quitTutorial",value:function(){this.setEnabled(!1),this.soundPlayer.playNow(o.Wo.CLICK),this.onQuitTutorial.notifyObservers()}},{key:"setEnabled",value:function(e){this.panel.classList.toggle("hidden",!e),c.I.setEnabled(e)}},{key:"isEnabled",value:function(){return"block"===this.root.style.display}},{key:"updatePanelState",value:function(){var e;this.contentContainer.innerHTML=null!=(e=this.tutorialPanelsHtml[this.currentPanelIndex])?e:"ERROR: panels out of bounds",this.prevButton.classList.toggle("disabled",0===this.currentPanelIndex)}},{key:"dispose",value:function(){this.root.remove(),this.onQuitTutorial.clear()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},35789:function(e,t,n){"use strict";n.d(t,{I:()=>u});var r=n(54060),o=n(86283),i=n(31272),a=n(16533),s=i._.KEYBOARD,l=new o.A(new r.A({bindings:[s.getControl("Space")]})),c=new o.A(new r.A({bindings:[s.getControl("Backspace")]})),u=new a.X("TutorialControls",{nextPanel:l,prevPanel:c});u.setEnabled(!1)},69121:function(e,t,n){"use strict";n.d(t,{$:()=>b});var r=n(15524),o=n(65617),i=n(3211),a=n(84369),s=n(90160),l=n(95369),c=n(78706),u=n(35789);let h=n.p+"11dc1113634fe50c.webp",d=n.p+"c61bf281b39db7a1.webp";var f=JSON.parse('{"timestamp":1746349852196,"player":{"uuid":"00000000-0000-0000-0000-000000000000","name":"Python","balance":10000,"creationDate":"2024-11-12T16:46:36.350Z","timePlayedSeconds":235,"visitedSystemHistory":[],"discoveries":{"local":[],"uploaded":[]},"currentItinerary":[],"systemBookmarks":[],"currentMissions":[],"completedMissions":[],"spaceShips":[{"id":"109e8fd9-7582-44f2-ba31-4019996849a6","name":"Wanderer","type":"WANDERER","components":{"primary":{"warpDrive":{"type":"warpDrive","size":3,"quality":1},"fuelTank":{"type":"fuelTank","size":2,"quality":1,"currentFuel01":1},"thrusters":{"type":"thrusters","size":3,"quality":1}},"optional":[{"type":"fuelScoop","size":2,"quality":1},null,null]}}],"spareSpaceshipComponents":[],"tutorials":{"flightCompleted":false,"stationLandingCompleted":false,"starMapCompleted":false,"fuelScoopingCompleted":false}},"playerLocation":{"type":"inSpaceship","shipId":"109e8fd9-7582-44f2-ba31-4019996849a6"},"shipLocations":{"109e8fd9-7582-44f2-ba31-4019996849a6":{"type":"relative","universeObjectId":{"systemCoordinates":{"starSectorX":0,"starSectorY":0,"starSectorZ":1,"localX":-0.3591535053491376,"localY":0.22225331036478901,"localZ":-0.07379512236164654},"idInSystem":"[[]->star0]->gasPlanet0"},"position":{"x":-16609794.315173151,"y":40.544271673554235,"z":38868265.94964077},"rotation":{"x":0.1199683537492946,"y":0.1682183428106448,"z":0.4227603449804604,"w":0.8823739989061702}}}}');let p=n.p+"be02ec5d5d44c47a.webp",m=n.p+"7f0cf394f24ca075.webp",v=n.p+"71563c150609f9d0.webp",y=n.p+"4fbc00d29fac09d8.webp";function g(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}var b=function(){var e;function t(){var e;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");(e="coverImageSrc")in this?Object.defineProperty(this,e,{value:y,enumerable:!0,configurable:!0,writable:!0}):this[e]=y}return e=[{key:"getSaveData",value:function(e){return(0,o.c_)(f,e)}},{key:"getTitle",value:function(){return c.A.t("tutorials:flightTutorial:title")}},{key:"getDescription",value:function(){return c.A.t("tutorials:flightTutorial:description")}},{key:"getContentPanelsHtml",value:function(){var e;return(e=function(){var e,t,n,o,f,g,b,S,w,T;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(A){switch(A.label){case 0:return[4,(0,l.t)()];case 1:var P,C;if(o=A.sent(),f='\n        <div class="tutorialContent">\n            <img src="'.concat(y,'" alt="Welcome to Cosmos Journeyer">\n            <p>').concat(c.A.t("tutorials:flightTutorial:welcome"),"</p>\n            ").concat(c.A.t("tutorials:common:navigationInfo",{nextKeys:(0,s.hg)(u.I.map.nextPanel,o).join(" ".concat(c.A.t("common:or")," ")),previousKeys:(0,s.hg)(u.I.map.prevPanel,o).join(" ".concat(c.A.t("common:or")," "))}),"\n        </div>"),g='\n        <div class="tutorialContent">\n            <h2>'.concat(c.A.t("tutorials:flightTutorial:spaceShipRotationTitle"),"</h2>\n            <p>").concat(c.A.t("tutorials:flightTutorial:spaceShipRotationText1"),'</p>\n            <img src="').concat(d,'" alt="Spaceship Rotation">\n            <p>').concat(c.A.t("tutorials:flightTutorial:spaceShipRotationText2"),"</p>\n            <p>").concat(c.A.t("tutorials:flightTutorial:spaceShipRotationText3"),"</p>\n        </div>"),P=b=null==(e=a._.map.throttle.bindings["0"])?void 0:e.control,null!=(C=r.hn)&&"undefined"!=typeof Symbol&&C[Symbol.hasInstance]?!C[Symbol.hasInstance](P):!(P instanceof C))throw Error("Expected control to be an AxisComposite");return S=(0,s.Lc)(b,o),w='\n        <div class="tutorialContent">\n            <h2>'.concat(c.A.t("tutorials:flightTutorial:spaceShipThrustTitle"),"</h2>\n            <p>").concat(c.A.t("tutorials:flightTutorial:spaceShipThrustText1",{keyIncrease:null==(t=S[1])?void 0:t[1],keyDecrease:null==(n=S[0])?void 0:n[1],keyKill:(0,s.hg)(a._.map.throttleToZero,o).join(" ".concat(c.A.t("common:or")," "))}),'</p>\n            <img src="').concat(m,'" alt="Spaceship Thrust">\n            <p>').concat(c.A.t("tutorials:flightTutorial:spaceShipThrustText2"),"</p>\n            <p>").concat(c.A.t("tutorials:flightTutorial:spaceShipThrustText3"),"</p>\n        </div>"),T='\n        <div class="tutorialContent">\n            <h2>'.concat(c.A.t("tutorials:flightTutorial:spaceShipWarpDriveTitle"),"</h2>\n            <p>").concat(c.A.t("tutorials:flightTutorial:spaceShipWarpDriveText1"),"</p>\n            <p>").concat(c.A.t("tutorials:flightTutorial:spaceShipWarpDriveText2",{keyToggle:(0,s.hg)(a._.map.toggleWarpDrive,o).join(" ".concat(c.A.t("common:or")," "))}),"</p>\n            <p>").concat(c.A.t("tutorials:flightTutorial:spaceShipWarpDriveText3"),'</p>\n            <img src="').concat(v,'" alt="Warp Drive">\n        </div>'),[2,[f,g,w,T,'\n        <div class="tutorialContent">\n            <h2>'.concat(c.A.t("tutorials:flightTutorial:spaceShipTargetingTitle"),"</h2>\n            <p>").concat(c.A.t("tutorials:flightTutorial:spaceShipTargetingText1"),'</p>\n            <img src="').concat(p,'" alt="Spaceship Targeting">\n            <p>').concat(c.A.t("tutorials:flightTutorial:spaceShipTargetingText2",{keyTarget:(0,s.hg)(i.n.map.setTarget,o).join(" ".concat(c.A.t("common:or")," "))}),"</p>\n            <p>").concat(c.A.t("tutorials:flightTutorial:spaceShipTargetingText3"),"</p>\n        </div>"),'\n        <div class="tutorialContent">\n            <img src="'.concat(h,'" alt="Congratulations!">\n            <p>').concat(c.A.t("tutorials:flightTutorial:congratulationsText1"),"</p>\n            \n            ").concat(c.A.t("tutorials:common:tutorialEnding",{keyQuit:(0,s.hg)(u.I.map.nextPanel,o).join(" ".concat(c.A.t("common:or")," "))}),"\n        </div>")]]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){g(i,r,o,a,s,"next",e)}function s(e){g(i,r,o,a,s,"throw",e)}a(void 0)})})()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},55721:function(e,t,n){"use strict";n.d(t,{F:()=>f});var r=n(65617),o=n(90160),i=n(95369),a=n(78706),s=n(35789);let l=n.p+"622b10536dea9371.webp",c=n.p+"7f6c577114bc4bd9.webp",u=n.p+"38d4710f23ab0bbc.webp";var h=JSON.parse('{"timestamp":1742837548674,"player":{"uuid":"00000000-0000-0000-0000-000000000000","name":"Python","balance":10000,"creationDate":"2024-12-01T12:03:23.833Z","timePlayedSeconds":179,"visitedSystemHistory":[],"discoveries":{"local":[],"uploaded":[]},"currentItinerary":[],"systemBookmarks":[],"currentMissions":[],"completedMissions":[],"spaceShips":[{"id":"109e8fd9-7582-44f2-ba31-4019996849a6","name":"Wanderer","type":"WANDERER","components":{"primary":{"warpDrive":{"type":"warpDrive","size":3,"quality":1},"fuelTank":{"type":"fuelTank","size":2,"quality":1,"currentFuel01":1},"thrusters":{"type":"thrusters","size":3,"quality":1}},"optional":[{"type":"fuelScoop","size":2,"quality":1},null,null]}}],"tutorials":{"stationLandingCompleted":false,"fuelScoopingCompleted":false}},"playerLocation":{"type":"inSpaceship","shipId":"109e8fd9-7582-44f2-ba31-4019996849a6"},"shipLocations":{"109e8fd9-7582-44f2-ba31-4019996849a6":{"type":"relative","universeObjectId":{"systemCoordinates":{"starSectorX":0,"starSectorY":0,"starSectorZ":1,"localX":-0.2501476173056977,"localY":0.34461041625803823,"localZ":-0.27272668516856},"idInSystem":"[]->star0"},"position":{"x":7.450580596923828e-9,"y":0,"z":-204830121.8256823},"rotation":{"x":0,"y":-7.143865410341732e-8,"z":0,"w":0.9999999999999976}}}}');function d(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}var f=function(){var e;function t(){var e;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");(e="coverImageSrc")in this?Object.defineProperty(this,e,{value:c,enumerable:!0,configurable:!0,writable:!0}):this[e]=c}return e=[{key:"getSaveData",value:function(e){return(0,r.c_)(h,e)}},{key:"getTitle",value:function(){return a.A.t("tutorials:fuelScooping:title")}},{key:"getDescription",value:function(){return a.A.t("tutorials:fuelScooping:description")}},{key:"getContentPanelsHtml",value:function(){var e;return(e=function(){var e,t;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(n){switch(n.label){case 0:return[4,(0,i.t)()];case 1:return e=n.sent(),t='\n        <div class="tutorialContent">\n            <img src="'.concat(c,'" alt="Fuel scooping welcome image">\n            <p>').concat(a.A.t("tutorials:fuelScooping:welcome"),"</p>\n            \n            <p>").concat(a.A.t("tutorials:fuelScooping:whatIsFuel"),"</p>\n            \n            ").concat(a.A.t("tutorials:common:navigationInfo",{nextKeys:(0,o.hg)(s.I.map.nextPanel,e).join(" ".concat(a.A.t("common:or")," ")),previousKeys:(0,o.hg)(s.I.map.prevPanel,e).join(" ".concat(a.A.t("common:or")," "))}),"\n        </div>"),[2,[t,'\n        <div class="tutorialContent">\n            <img src="'.concat(l,'" alt="Fuel icon location">\n            \n            <p>').concat(a.A.t("tutorials:fuelScooping:whereFuelIcon"),"</p>            \n        </div>"),'\n        <div class="tutorialContent">\n            <img src="'.concat(u,'" alt="How to fuel scoop">\n            \n            <p>').concat(a.A.t("tutorials:fuelScooping:howToFuelScoop"),"</p>\n            \n            <p>").concat(a.A.t("tutorials:common:tutorialEnding",{keyQuit:(0,o.hg)(s.I.map.nextPanel,e).join(" ".concat(a.A.t("common:or")," "))}),"\n                </p>\n        </div>")]]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){d(i,r,o,a,s,"next",e)}function s(e){d(i,r,o,a,s,"throw",e)}a(void 0)})})()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},44124:function(e,t,n){"use strict";n.d(t,{r:()=>b});var r=n(65617),o=n(90160),i=n(3818),a=n(3211),s=n(34547),l=n(95369),c=n(78706),u=n(35789);let h=n.p+"48921a1f653c4d4a.webp",d=n.p+"db48757998c66b43.webp",f=n.p+"ed2eeb024ef7675a.webp",p=n.p+"1bddf8ff886c8d90.webp",m=n.p+"7fbfaa9da33e14d7.webp",v=n.p+"e81389088f2519a7.webp";var y=JSON.parse('{"timestamp":1746350637462,"player":{"uuid":"00000000-0000-0000-0000-000000000000","name":"Tutorial","balance":10000,"creationDate":"2025-05-04T09:19:23.017Z","timePlayedSeconds":249,"visitedSystemHistory":[],"discoveries":{"uploaded":[],"local":[]},"currentItinerary":[],"systemBookmarks":[],"currentMissions":[{"missionGiver":{"systemCoordinates":{"localX":0.49137314641446483,"localY":0.48043087077347135,"localZ":0.38353311777279386,"starSectorX":0,"starSectorY":0,"starSectorZ":0},"idInSystem":"[[[]->star0]->telluricPlanet1]->spaceStation0"},"tree":{"type":0,"objectId":{"systemCoordinates":{"starSectorX":1,"starSectorY":4,"starSectorZ":1,"localX":0.02561151633300418,"localY":-0.11083881119770872,"localZ":0.026431881136462},"idInSystem":"[[]->star0]->mengerSponge0"},"state":0},"reward":71000,"type":0},{"missionGiver":{"systemCoordinates":{"localX":0.49137314641446483,"localY":0.48043087077347135,"localZ":0.38353311777279386,"starSectorX":0,"starSectorY":0,"starSectorZ":0},"idInSystem":"[[[]->star0]->telluricPlanet1]->spaceStation0"},"tree":{"type":0,"objectId":{"systemCoordinates":{"starSectorX":2,"starSectorY":0,"starSectorZ":-1,"localX":-0.1854024420890037,"localY":-0.1628170444922601,"localZ":-0.42941410091212673},"idInSystem":"[]->blackHole0"},"state":0},"reward":70500,"type":0},{"missionGiver":{"systemCoordinates":{"localX":0.49137314641446483,"localY":0.48043087077347135,"localZ":0.38353311777279386,"starSectorX":0,"starSectorY":0,"starSectorZ":0},"idInSystem":"[[[]->star0]->telluricPlanet1]->spaceStation0"},"tree":{"type":0,"objectId":{"systemCoordinates":{"starSectorX":0,"starSectorY":-3,"starSectorZ":0,"localX":-0.21676538266090928,"localY":0.2942857922959541,"localZ":-0.1888475882303191},"idInSystem":"[]->blackHole0"},"state":0},"reward":100500,"type":0},{"missionGiver":{"systemCoordinates":{"localX":0.49137314641446483,"localY":0.48043087077347135,"localZ":0.38353311777279386,"starSectorX":0,"starSectorY":0,"starSectorZ":0},"idInSystem":"[[[]->star0]->telluricPlanet1]->spaceStation0"},"tree":{"type":0,"objectId":{"systemCoordinates":{"starSectorX":-3,"starSectorY":-1,"starSectorZ":0,"localX":0.2960593378152975,"localY":0.2122889010758553,"localZ":0.45815722456116104},"idInSystem":"[]->neutronStar0"},"state":0},"reward":103500,"type":0}],"completedMissions":[],"spaceShips":[{"id":"d91271ff-50a1-4bb6-8006-3b15636b7628","name":"Wanderer","type":"WANDERER","components":{"primary":{"warpDrive":{"type":"warpDrive","size":3,"quality":1},"fuelTank":{"type":"fuelTank","size":2,"quality":1,"currentFuel01":0.9999999999605679},"thrusters":{"type":"thrusters","size":3,"quality":1}},"optional":[null,{"type":"fuelScoop","size":2,"quality":1},{"type":"discoveryScanner","size":2,"quality":1}]}}],"spareSpaceshipComponents":[],"tutorials":{"flightCompleted":true,"stationLandingCompleted":true,"starMapCompleted":false,"fuelScoopingCompleted":false}},"playerLocation":{"type":"inSpaceship","shipId":"d91271ff-50a1-4bb6-8006-3b15636b7628"},"shipLocations":{"d91271ff-50a1-4bb6-8006-3b15636b7628":{"type":"relative","universeObjectId":{"systemCoordinates":{"localX":0.49137314641446483,"localY":0.48043087077347135,"localZ":0.38353311777279386,"starSectorX":0,"starSectorY":0,"starSectorZ":0},"idInSystem":"[[[]->star0]->telluricPlanet1]->spaceStation0"},"position":{"x":0,"y":0,"z":66758.3748405016},"rotation":{"x":-0.7528543156495244,"y":0.4437797951451762,"z":-0.15113211133886262,"w":0.4619837202306639}}}}');function g(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}var b=function(){var e;function t(){var e;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");(e="coverImageSrc")in this?Object.defineProperty(this,e,{value:d,enumerable:!0,configurable:!0,writable:!0}):this[e]=d}return e=[{key:"getSaveData",value:function(e){return(0,r.c_)(y,e)}},{key:"getTitle",value:function(){return c.A.t("tutorials:starMap:title")}},{key:"getDescription",value:function(){return c.A.t("tutorials:starMap:description")}},{key:"getContentPanelsHtml",value:function(){var e;return(e=function(){var e,t,n,r,y,g,b,S,w,T,A,P,C;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(I){switch(I.label){case 0:return[4,(0,l.t)()];case 1:return n=I.sent(),r='\n        <div class="tutorialContent">\n            <img src="'.concat(d,'" alt="Welcome to Cosmos Journeyer">\n            <p>').concat(c.A.t("tutorials:starMap:welcome"),"</p>\n            \n            ").concat(c.A.t("tutorials:common:navigationInfo",{nextKeys:(0,o.hg)(u.I.map.nextPanel,n).join(" ".concat(c.A.t("common:or")," ")),previousKeys:(0,o.hg)(u.I.map.prevPanel,n).join(" ".concat(c.A.t("common:or")," "))}),"\n        </div>"),y=(0,o.hg)(i.i.map.toggleStarMap,n).join(" ".concat(c.A.t("common:or")," ")),g='\n        <div class="tutorialContent">\n            <p>'.concat(c.A.t("tutorials:starMap:open1"),"</p> \n            <p>").concat(c.A.t("tutorials:starMap:open2",{keys:y}),'</p> \n            <img src="').concat(m,'" alt="Star map opening" class="tutorialImage">\n            <p>').concat(c.A.t("tutorials:starMap:open3"),"</p>\n        </div>"),b=(0,o.Fd)(null==(e=s.S.map.move.bindings["0"])?void 0:e.control,n),S=(0,o.Lc)(null==(t=s.S.map.upDown.bindings["0"])?void 0:t.control,n),w=b.concat(S).map(function(e){return e[1].replace("Key","")}).join(", "),T='\n        <div class="tutorialContent">\n            <p>'.concat(c.A.t("tutorials:starMap:controls1",{keys:w}),'</p>\n            <img src="').concat(h,'" alt="Star map controls" class="tutorialImage">\n            <p>').concat(c.A.t("tutorials:starMap:controls2"),"</p>\n        </div>"),A='\n        <div class="tutorialContent">\n            <p>'.concat(c.A.t("tutorials:starMap:missions1"),'</p>\n            <img src="').concat(p,'" alt="Star map missions" class="tutorialImage">\n            <p>').concat(c.A.t("tutorials:starMap:missions2"),"</p>\n        </div>"),P='\n        <div class="tutorialContent">\n            <p>'.concat(c.A.t("tutorials:starMap:system1"),"</p>\n            <p>").concat(c.A.t("tutorials:starMap:system2"),'</p>\n            <img src="').concat(v,'" alt="Star map system interactions" class="tutorialImage">\n            <p>').concat(c.A.t("tutorials:starMap:system3"),"</p>\n        </div>"),C=(0,o.hg)(a.n.map.jumpToSystem,n).join(" ".concat(c.A.t("common:or")," ")),[2,[r,g,T,A,P,'\n        <div class="tutorialContent">\n            <p>'.concat(c.A.t("tutorials:starMap:travel1"),"</p>\n            <p>").concat(c.A.t("tutorials:starMap:travel2",{keys:C}),'</p>\n            <img src="').concat(f,'" alt="Interstellar jump" class="tutorialImage">\n            <p>').concat(c.A.t("tutorials:starMap:travel3"),"</p>\n        </div>"),'\n        <div class="tutorialContent">\n            <img src="'.concat(d,'" alt="Welcome to Cosmos Journeyer">\n            <p>').concat(c.A.t("tutorials:starMap:congratulations"),"</p>\n            ").concat(c.A.t("tutorials:common:tutorialEnding",{keyQuit:(0,o.hg)(u.I.map.nextPanel,n).join(" ".concat(c.A.t("common:or")," "))}),"\n        </div>")]]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){g(i,r,o,a,s,"next",e)}function s(e){g(i,r,o,a,s,"throw",e)}a(void 0)})})()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},80617:function(e,t,n){"use strict";n.d(t,{M:()=>m});var r=n(65617),o=n(90160),i=n(84369),a=n(35789),s=n(95369),l=n(78706),c=JSON.parse('{"timestamp":1746350207037,"player":{"uuid":"00000000-0000-0000-0000-000000000000","name":"Python","balance":10000,"creationDate":"2025-03-07T09:48:44.326Z","timePlayedSeconds":871,"visitedSystemHistory":[{"starSectorX":0,"starSectorY":0,"starSectorZ":1,"localX":-0.4489430822194289,"localY":0.18747587394317422,"localZ":-0.31726073698013124},{"starSectorX":0,"starSectorY":0,"starSectorZ":0,"localX":-0.1980424619736348,"localY":-0.11183447093322618,"localZ":-0.20050806724490045},{"starSectorX":0,"starSectorY":0,"starSectorZ":1,"localX":-0.3591535053491376,"localY":0.22225331036478901,"localZ":-0.07379512236164654},{"starSectorX":0,"starSectorY":0,"starSectorZ":1,"localX":-0.3591535053491376,"localY":0.22225331036478901,"localZ":-0.07379512236164654}],"discoveries":{"local":[],"uploaded":[]},"currentItinerary":[],"systemBookmarks":[],"currentMissions":[],"completedMissions":[],"spaceShips":[{"id":"109e8fd9-7582-44f2-ba31-4019996849a6","name":"Wanderer","type":"WANDERER","components":{"primary":{"warpDrive":{"type":"warpDrive","size":3,"quality":1},"fuelTank":{"type":"fuelTank","size":2,"quality":1,"currentFuel01":1},"thrusters":{"type":"thrusters","size":3,"quality":1}},"optional":[{"type":"fuelScoop","size":2,"quality":1},null,null]}}],"spareSpaceshipComponents":[],"tutorials":{"flightCompleted":false,"stationLandingCompleted":false,"starMapCompleted":false,"fuelScoopingCompleted":false}},"playerLocation":{"type":"inSpaceship","shipId":"109e8fd9-7582-44f2-ba31-4019996849a6"},"shipLocations":{"109e8fd9-7582-44f2-ba31-4019996849a6":{"type":"relative","universeObjectId":{"systemCoordinates":{"starSectorX":0,"starSectorY":0,"starSectorZ":0,"localX":-0.1980424619736348,"localY":-0.11183447093322618,"localZ":-0.20050806724490045},"idInSystem":"[[[]->star0]->gasPlanet2]->spaceStation0"},"position":{"x":-31.7948781292356,"y":23776.794755394567,"z":-593.1514563596492},"rotation":{"x":0.23748468457812308,"y":0.6830126727000226,"z":-0.6629404143797889,"w":0.1939193462995527}}}}');let u=n.p+"8d57ae1b1151dd13.webp",h=n.p+"f578b0b6bac96871.webp",d=n.p+"626afbb6230d5aac.webp",f=n.p+"7d6d8654d79bf094.webp";function p(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}var m=function(){var e;function t(){var e;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");(e="coverImageSrc")in this?Object.defineProperty(this,e,{value:u,enumerable:!0,configurable:!0,writable:!0}):this[e]=u}return e=[{key:"getSaveData",value:function(e){return(0,r.c_)(c,e)}},{key:"getTitle",value:function(){return l.A.t("tutorials:stationLanding:title")}},{key:"getDescription",value:function(){return l.A.t("tutorials:stationLanding:description")}},{key:"getContentPanelsHtml",value:function(){var e;return(e=function(){var e,t,n;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return[4,(0,s.t)()];case 1:return e=r.sent(),t='\n        <div class="tutorialContent">\n            <img src="'.concat(u,'" alt="Space Station">\n            <p>').concat(l.A.t("tutorials:stationLanding:welcome"),"</p>\n            \n            <p>").concat(l.A.t("tutorials:stationLanding:whatAreStations"),"</p>\n            \n            ").concat(l.A.t("tutorials:common:navigationInfo",{nextKeys:(0,o.hg)(a.I.map.nextPanel,e).join(" ".concat(l.A.t("common:or")," ")),previousKeys:(0,o.hg)(a.I.map.prevPanel,e).join(" ".concat(l.A.t("common:or")," "))}),"\n        </div>"),n='\n        <div class="tutorialContent">\n            <img src="'.concat(h,'" alt="Space Station\'s landing bay">\n            \n            <p>').concat(l.A.t("tutorials:stationLanding:whereLandingBay"),"</p>\n            \n            <p>").concat(l.A.t("tutorials:stationLanding:landingRequest",{keys:(0,o.hg)(i._.map.emitLandingRequest,e).join(" ".concat(l.A.t("common:or")," "))}),"</p>\n            \n        </div>"),[2,[t,n,'\n        <div class="tutorialContent">\n            <img src="'.concat(d,'" alt="Space Station">    \n            <p>').concat(l.A.t("tutorials:stationLanding:requestAccepted"),"</p>\n        \n            <p>").concat(l.A.t("tutorials:stationLanding:beCareful"),"</p>\n            \n            <p>").concat(l.A.t("tutorials:stationLanding:autoLanding"),"</p>\n        </div>"),'\n        <div class="tutorialContent">\n            <img src="'.concat(f,'" alt="Space Station">\n            \n            <p>').concat(l.A.t("tutorials:stationLanding:services1"),"</p>\n            \n            <p>").concat(l.A.t("tutorials:stationLanding:services2"),"</p>\n            \n            <p>").concat(l.A.t("tutorials:common:tutorialEnding",{keyQuit:(0,o.hg)(a.I.map.nextPanel,e).join(" ".concat(l.A.t("common:or")," "))}),"\n                </p>\n        </div>")]]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){p(i,r,o,a,s,"next",e)}function s(e){p(i,r,o,a,s,"throw",e)}a(void 0)})})()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},84830:function(e,t,n){"use strict";n.d(t,{Jp:()=>a,UT:()=>l,d_:()=>c,je:()=>s});var r=n(35543),o=n(36801),i=n(96811);function a(e,t,n,r){var a=e.model.orbit;if(0===a.semiMajorAxis||0===t.length)return e.getTransform().position;var s=o.Pq.Zero(),l=0,c=!0,u=!1,h=void 0;try{for(var d,f=t[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var p=d.value,m=p.model.mass;s.addInPlace(p.getTransform().position.scale(m)),l+=m}}catch(e){u=!0,h=e}finally{try{c||null==f.return||f.return()}finally{if(u)throw h}}return s.scaleInPlace(1/l),(0,i.s)(s,l,a,r,n)}function s(e,t,n,r){if(0!==e.model.orbit.semiMajorAxis&&0!==t.length){var o=a(e,t,n,r);e.getTransform().position=o,e.getTransform().computeWorldMatrix(!0)}}function l(e,t){return 0===e.model.siderealDaySeconds?0:2*Math.PI*t/e.model.siderealDaySeconds}function c(e,t,n){var i=o.uq.RotationAxis(r._0.Z,e.model.orbit.inclination+e.model.axialTilt);i.multiplyToRef(t,i);var a=e.getTransform().rotationQuaternion;null===a&&(a=e.getTransform().rotationQuaternion=o.PT.Identity()),o.PT.FromRotationMatrixToRef(i,a),e.getTransform().computeWorldMatrix(!0);var s=l(e,n);0!==s&&(e.getTransform().rotate(r._0.Y,s,r.$x.LOCAL),e.getTransform().computeWorldMatrix(!0))}},53024:function(e,t,n){"use strict";n.d(t,{L:()=>o,v:()=>i});var r,o=((r={})[r.CELESTIAL_BODY=0]="CELESTIAL_BODY",r[r.FACILITY=1]="FACILITY",r[r.ANOMALY=2]="ANOMALY",r[r.LANDING_PAD=3]="LANDING_PAD",r[r.STAR_SYSTEM=4]="STAR_SYSTEM",r);function i(e){return{type:0,minDistance:10*e,maxDistance:0}}},76753:function(e,t,n){"use strict";n.d(t,{U:()=>u});var r=n(36801),o=n(32220),i=n(49027);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var u=function(){var e,t;function n(e,t,r,i,a){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");l(this,"seed",void 0),l(this,"rng",void 0),l(this,"parent",void 0),l(this,"averageRadius",void 0),l(this,"spread",void 0),l(this,"innerRadius",void 0),l(this,"outerRadius",void 0),l(this,"resolution",15),l(this,"patchSize",3e4),l(this,"patchThickness",2e3),l(this,"neighborCellsRenderRadius",2),l(this,"patches",new Map),l(this,"scene",void 0),this.seed=e,this.rng=(0,o.p)(this.seed),this.parent=t,this.innerRadius=r,this.outerRadius=i,this.averageRadius=(r+i)/2,this.spread=i-r,this.scene=a}return e=[{key:"update",value:function(e,t,o){var a=this.parent.getWorldMatrix().clone().invert(),s=r.Pq.TransformCoordinates(e,a),l=Math.round(s.x/this.patchSize),u=Math.round(s.y/this.patchSize)/5,h=Math.round(s.z/this.patchSize),d=!0,f=!1,p=void 0;try{for(var m,v=this.patches[Symbol.iterator]();!(d=(m=v.next()).done);d=!0){var y=c(m.value,2),g=y[0],b=y[1],S=b.cellX,w=b.cellZ,T=b.patch;Math.pow(l-S,2)+u*u+Math.pow(h-w,2)>=this.neighborCellsRenderRadius*this.neighborCellsRenderRadius?(T.clearInstances(),T.dispose(),this.patches.delete(g)):T.update(e,t,o)}}catch(e){f=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw p}}for(var A=-this.neighborCellsRenderRadius;A<=this.neighborCellsRenderRadius;A++)for(var P=-this.neighborCellsRenderRadius;P<=this.neighborCellsRenderRadius;P++){var C=l+A,I=h+P,E=Math.pow(C*this.patchSize,2)+Math.pow(I*this.patchSize,2);if(!(E<this.innerRadius*this.innerRadius||E>this.outerRadius*this.outerRadius||this.patches.has("".concat(C,";").concat(I)))&&!(Math.pow(l-C,2)+u*u+Math.pow(h-I,2)>=this.neighborCellsRenderRadius*this.neighborCellsRenderRadius)){var R=new r.Pq(C*this.patchSize,0,I*this.patchSize),N=c(n.CreateAsteroidBuffer(R,this.resolution,this.patchSize,this.patchThickness,this.innerRadius,this.outerRadius,t.length-1,this.rng),5),O=N[0],L=N[1],x=N[2],M=N[3],_=N[4],k=new i.q(O,L,x,M,_,this.parent);k.createInstances(),this.patches.set("".concat(C,";").concat(I),{patch:k,cellX:C,cellZ:I})}}}},{key:"dispose",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.patches.values()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)r.value.patch.dispose()}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.patches.clear()}}],t=[{key:"CreateAsteroidBuffer",value:function(e,t,n,o,i,a,s,l){for(var c=[],u=[],h=[],d=[],f=[],p=e.x*a*2+e.z,m=n/t,v=0;v<t;v++)for(var y=0;y<t;y++){var g=p/1e6+(v*t+y)/1e3,b=l(g)*m,S=l(g+4621)*m,w=e.x+v*m-n/2+b,T=e.z+y*m-n/2+S;if(!(w*w+T*T<i*i)&&!(w*w+T*T>a*a)){var A=e.y+(l(g+8781)-.5)*o,P=Math.floor(l(g+6549)*(s+1));c.push(new r.Pq(w,A,T));var C=new r.Pq(l(g+9512)-.5,l(g+7456)-.5,l(g+7410)-.5).normalize(),I=2*l(g+4239)*Math.PI;u.push(r.PT.RotationAxis(C,I)),h.push(P),d.push(new r.Pq(l(g+9630)-.5,l(g+3256)-.5,l(g+8520)-.5).normalize()),f.push(.2*l(g+1569))}}return[c,u,h,d,f]}}],e&&s(n.prototype,e),t&&s(n,t),n}()},49027:function(e,t,n){"use strict";n.d(t,{q:()=>l});var r=n(35543),o=n(36801),i=n(52632),a=n(67604);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){var e;function t(e,n,r,o,i,a){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");s(this,"parent",void 0),s(this,"instances",[]),s(this,"instancePhysicsBodies",[]),s(this,"positions",void 0),s(this,"rotations",void 0),s(this,"typeIndices",void 0),s(this,"rotationAxes",[]),s(this,"rotationSpeeds",[]),s(this,"nbInstances",0),s(this,"physicsRadius",15e3),this.parent=a,this.positions=e,this.rotations=n,this.typeIndices=r,this.rotationAxes=o,this.rotationSpeeds=i}return e=[{key:"clearInstances",value:function(){this.instancePhysicsBodies.forEach(function(e){e.dispose()}),this.instances.forEach(function(e){e.dispose()}),this.instancePhysicsBodies.length=0,this.instances.length=0,this.nbInstances=0}},{key:"createInstances",value:function(){this.clearInstances()}},{key:"update",value:function(e,n,s){var l=this;this.instances.forEach(function(t,c){var u,h=o.Pq.Distance(e,t.getAbsolutePosition()),d=l.rotationAxes[c],f=l.rotationSpeeds[c],p=l.typeIndices[c];if(void 0===d||void 0===f||void 0===p)throw Error("Rotation axis, speed, or type index is undefined.");var m=null==(u=n[p])?void 0:u.physicsShape;if(void 0===m)throw Error("Asteroid physics shape for type index ".concat(p," is undefined."));if(h<l.physicsRadius&&(null===t.physicsBody||void 0===t.physicsBody)){var v=new a.a(t,i.AH.DYNAMIC,!1,l.parent.getScene());v.setMassProperties({mass:1e3}),v.setAngularVelocity(d.scale(f)),v.setAngularDamping(0),v.disablePreStep=!1,v.shape=m,l.instancePhysicsBodies.push(v)}else if(h>l.physicsRadius+1e3&&null!==t.physicsBody&&void 0!==t.physicsBody){var y=l.instancePhysicsBodies.find(function(e){return e===t.physicsBody});void 0!==y&&(y.dispose(),l.instancePhysicsBodies.splice(l.instancePhysicsBodies.indexOf(y),1))}null===t.physicsBody&&t.rotate(d,f*s,r.$x.WORLD)});for(var c=0;c<t.BATCH_SIZE&&this.nbInstances!==this.positions.length;c++){var u=this.typeIndices[this.nbInstances];if(void 0===u)throw Error("Type index for instance ".concat(this.nbInstances," is undefined."));var h=n[u];if(void 0===h)throw Error("Asteroid for type index ".concat(u," is undefined."));var d=this.positions[this.nbInstances],f=this.rotations[this.nbInstances];if(void 0===d||void 0===f)throw Error("Position or rotation for instance ".concat(this.nbInstances," is undefined."));var p=h.mesh.createInstance("".concat(this.parent.name,"_AsteroidInstance").concat(this.nbInstances));p.position.copyFrom(d),p.rotationQuaternion=f,p.isPickable=!1,p.parent=this.parent,this.instances.push(p),this.nbInstances++}}},{key:"getNbInstances",value:function(){return this.nbInstances}},{key:"setEnabled",value:function(e){this.instances.forEach(function(t){t.setEnabled(e)})}},{key:"dispose",value:function(){this.clearInstances(),this.positions.length=0,this.rotations.length=0,this.typeIndices.length=0,this.rotationAxes.length=0,this.rotationSpeeds.length=0}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();s(l,"BATCH_SIZE",10)},33871:function(e,t,n){"use strict";n.d(t,{F:()=>i});var r=n(74334);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"axisMeshes",[]),o(this,"_isVisible",!1),o(this,"createAxisMeshFromPoints",void 0),this.createAxisMeshFromPoints=e}return e=[{key:"setOrbitalObjects",value:function(e,t){this.reset();var n=!0,r=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;this.createAxisMesh(s,t)}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}this.setVisibility(this._isVisible)}},{key:"createAxisMesh",value:function(e,t){var n=[new r.Pq(0,-(2*e.getBoundingRadius()),0),new r.Pq(0,2*e.getBoundingRadius(),0)],o=this.createAxisMeshFromPoints("".concat(e.getTransform().name,"AxisHelper"),n,{r:.4,g:.4,b:.4},t);o.parent=e.getTransform(),this.axisMeshes.push(o)}},{key:"setVisibility",value:function(e){this._isVisible=e;var t=!0,n=!1,r=void 0;try{for(var o,i=this.axisMeshes[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)o.value.setEnabled(e)}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"isVisible",value:function(){return this._isVisible}},{key:"reset",value:function(){this.axisMeshes.forEach(function(e){e.dispose(!1,!0)}),this.axisMeshes=[]}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},61012:function(e,t,n){"use strict";n.d(t,{i:()=>l});var r=n(42130),o=n(90718),i=n(27460),a=n(53024);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");s(this,"type",void 0),s(this,"model",void 0),s(this,"mesh",void 0),s(this,"material",void 0),s(this,"ringsUniforms",null),s(this,"asteroidField",null),s(this,"targetInfo",void 0),this.type=e.type,this.model=e,this.mesh=o.P.CreateSphere("DarkKnight",{diameter:this.model.radius,segments:256},n),this.material=new r.f("DarkKnightMaterial",n),this.material.metallic=1,this.material.roughness=0,this.material.disableLighting=!0,this.mesh.material=this.material,this.targetInfo={type:a.L.ANOMALY,minDistance:5*this.model.radius,maxDistance:100*this.model.radius}}return e=[{key:"getRadius",value:function(){return this.model.radius}},{key:"getBoundingRadius",value:function(){return this.model.radius}},{key:"getTypeName",value:function(){return(0,i.d)(this.model)}},{key:"getTransform",value:function(){return this.mesh}},{key:"dispose",value:function(){this.mesh.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},95344:function(e,t,n){"use strict";n.d(t,{i:()=>l});var r=n(36801),o=n(36044),i=n(27460),a=n(53024);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");s(this,"model",void 0),s(this,"type",void 0),s(this,"transform",void 0),s(this,"asteroidField",null),s(this,"ringsUniforms",null),s(this,"targetInfo",void 0),this.model=e,this.type=e.type,this.transform=new o.VR0(this.model.name,n),this.transform.rotationQuaternion=r.PT.Identity(),this.targetInfo=(0,a.v)(this.getBoundingRadius())}return e=[{key:"getTransform",value:function(){return this.transform}},{key:"getRadius",value:function(){return this.model.radius}},{key:"getBoundingRadius",value:function(){return this.model.radius}},{key:"getTypeName",value:function(){return(0,i.d)(this.model)}},{key:"dispose",value:function(){this.transform.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},79618:function(e,t,n){"use strict";n.d(t,{G:()=>l});var r=n(74334),o=n(96811),i=n(57404);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");s(this,"orbitMeshes",new Map),s(this,"orbitalObjectToParents",new Map),s(this,"_isVisible",!1),s(this,"createOrbitMeshFromPoints",void 0),this.createOrbitMeshFromPoints=e}return e=[{key:"setOrbitalObjects",value:function(e,t){this.reset();var n=!0,r=!1,o=void 0;try{for(var i,a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)i=this,function(){var n=a.value,r=e.filter(function(e){return n.model.orbit.parentIds.includes(e.model.id)});i.createOrbitMesh(n,r,t),i.orbitalObjectToParents.set(n,r)}()}catch(e){r=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}this.setVisibility(this.isVisible())}},{key:"createOrbitMesh",value:function(e,t,n){for(var r=t.reduce(function(e,t){return e+t.model.mass},0),a=e.model.orbit,s=Math.max(100,Math.round(Math.sqrt(a.semiMajorAxis/2e5))),l=(0,i.tQ)(a.semiMajorAxis,r)/s,c=[],u=0;u<s;u++){var h=u*l;c.push((0,o.D)(a,r,h))}void 0!==c[0]&&c.push(c[0]);var d=this.createOrbitMeshFromPoints("".concat(e.model.name,"OrbitHelper"),c,{r:.4,g:.4,b:.4},n);this.orbitMeshes.set(e,d)}},{key:"setVisibility",value:function(e){this._isVisible=e;var t=!0,n=!1,r=void 0;try{for(var o,i=this.orbitMeshes.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)o.value.setEnabled(e)}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"isVisible",value:function(){return this._isVisible}},{key:"update",value:function(e){if(this._isVisible){var t=!0,n=!1,o=void 0;try{for(var i,s=this.orbitalObjectToParents[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var l=(y=i.value,function(e){if(Array.isArray(e))return e}(y)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(y,2)||function(e,t){if(e){if("string"==typeof e)return a(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(y,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=l[0],u=l[1],h=this.orbitMeshes.get(c);if(void 0===h)throw Error("Orbit mesh not found");var d=r.Pq.Zero(),f=u.reduce(function(e,t){return e+t.model.mass},.001),p=!0,m=!1,v=void 0;try{for(var y,g,b=u[Symbol.iterator]();!(p=(g=b.next()).done);p=!0){var S=g.value;d.addInPlace(S.getTransform().position.scale(S.model.mass))}}catch(e){m=!0,v=e}finally{try{p||null==b.return||b.return()}finally{if(m)throw v}}d.scaleInPlace(1/f),h.position=d,h.rotationQuaternion=r.PT.FromRotationMatrix(e),h.computeWorldMatrix(!0)}}catch(e){n=!0,o=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw o}}}}},{key:"reset",value:function(){this.orbitMeshes.forEach(function(e){e.dispose(!1,!0)}),this.orbitMeshes.clear(),this.orbitalObjectToParents.clear()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},89901:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{G:()=>s,a:()=>a});function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i,a=((i={})[i.SMALL=1]="SMALL",i[i.MEDIUM=2]="MEDIUM",i[i.LARGE=3]="LARGE",i),s=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"unavailableLandingPads",new Set),o(this,"landingPads",void 0),this.landingPads=function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}return e=[{key:"handleLandingRequest",value:function(e){var t=this.getAvailableLandingPads().filter(function(t){return t.getPadSize()>=e.minimumPadSize}).sort(function(e,t){return e.getPadSize()-t.getPadSize()})[0];return void 0===t?null:(this.markPadAsUnavailable(t),t)}},{key:"cancelLandingRequest",value:function(e){this.markPadAsAvailable(e)}},{key:"getLandingPads",value:function(){return this.landingPads}},{key:"getAvailableLandingPads",value:function(){var e=this;return this.getLandingPads().filter(function(t){return!e.unavailableLandingPads.has(t)})}},{key:"markPadAsUnavailable",value:function(e){this.unavailableLandingPads.add(e)}},{key:"markPadAsAvailable",value:function(e){this.unavailableLandingPads.delete(e)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},86299:function(e,t,n){"use strict";n.d(t,{x:()=>M});var r=n(36801),o=n(36044),i=n(61741),a=n(35543),s=n(67450),l=n(52632),c=n(67604),u=n(83266),h=n(93035);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");d(this,"root",void 0),d(this,"skirt",void 0),d(this,"skirtAggregate",null),d(this,"skirtMaterial",void 0),d(this,"engines",[]),d(this,"engineBodies",[]),d(this,"engineShape",void 0),d(this,"scene",void 0),this.root=new s.V("EngineBayRoot",n),this.scene=n,this.skirt=o.PeD.CreateCylinder("EngineBaySkirt",{diameterTop:100,height:400,diameterBottom:250,tessellation:6},n),this.skirt.convertToFlatShadedMesh(),this.skirtMaterial=new h.u("EngineBayMetalSectionMaterial",e.textures.materials.metalPanels,n),this.skirt.material=this.skirtMaterial,this.skirt.parent=this.root;var i=e.objects.stationEngine.mesh.createInstance("Engine");this.engines.push(i);for(var l=0;l<6;l++){var c=e.objects.stationEngine.mesh.createInstance("Engine");c.rotate(a._0.Y,2*Math.PI/6*l,a.$x.LOCAL),c.translate(a._0.X,80,a.$x.LOCAL),this.engines.push(c)}this.engines.forEach(function(e){e.parent=r.root,e.translate(a._0.Y,-300,a.$x.LOCAL),e.scaling.scaleInPlace(100)});var u=this.getTransform().getHierarchyBoundingVectors(),f=u.max.add(u.min).scale(.5);this.root.getChildTransformNodes(!0).forEach(function(e){e.position.subtractInPlace(f)}),this.engineShape=e.objects.stationEngine.shape}return e=[{key:"update",value:function(e){var t=this,n=r.Pq.Distance(e,this.getTransform().getAbsolutePosition());n<35e4&&null===this.skirtAggregate?(this.skirtAggregate=(0,u.t)(this.skirt,l.DK.MESH,this.scene),this.engines.forEach(function(e){var n=new c.a(e,l.AH.STATIC,!1,t.scene);n.setMassProperties({mass:0}),n.shape=t.engineShape,n.disablePreStep=!1,t.engineBodies.push(n)})):n>36e4&&null!==this.skirtAggregate&&(this.skirtAggregate.dispose(),this.skirtAggregate=null,this.engineBodies.forEach(function(e){e.dispose()}),this.engineBodies.length=0)}},{key:"getTransform",value:function(){return this.root}},{key:"dispose",value:function(){var e;this.skirt.dispose(),this.skirtMaterial.dispose(),null==(e=this.skirtAggregate)||e.dispose(),this.engines.forEach(function(e){e.dispose()}),this.engineBodies.forEach(function(e){e.dispose()})}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),p=n(41397),m=n(25760),v=n(93132),y=n(65773),g=n(51216),b=n(17514),S=n(37427),w=n(76161),T=n(27460),A=n(53024),P=n(89901),C=n(47759),I=n(32220),E=n(97715),R=n(96839),N=n(96728),O=n(13679);function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M=function(){var e;function t(e,n,a,s){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");x(this,"name",void 0),x(this,"model",void 0),x(this,"type",i.T.SPACE_STATION),x(this,"solarSections",[]),x(this,"utilitySections",[]),x(this,"helixHabitats",[]),x(this,"ringHabitats",[]),x(this,"cylinderHabitats",[]),x(this,"landingBays",[]),x(this,"engineBays",[]),x(this,"root",void 0),x(this,"scene",void 0),x(this,"boundingRadius",void 0),x(this,"targetInfo",void 0),x(this,"landingPadManager",void 0),this.model=e,this.name=this.model.name,this.root=new o.VR0(this.name,s),this.root.rotationQuaternion=r.PT.Identity(),this.scene=s,this.generate(n,a),this.landingPadManager=new P.G(this.landingBays.flatMap(function(e){return e.landingPads}));var l=this.getTransform().getHierarchyBoundingVectors(),c=l.max.add(l.min).scale(.5),u=this.getTransform().getAbsolutePosition().subtract(c);this.getTransform().getChildTransformNodes(!0).forEach(function(e){return e.position.addInPlace(u)});var h=l.max.subtract(l.min).scale(.5);this.boundingRadius=Math.max(h.x,h.y,h.z),this.targetInfo={type:A.L.FACILITY,minDistance:6*this.getBoundingRadius(),maxDistance:0}}return e=[{key:"getLandingPadManager",value:function(){return this.landingPadManager}},{key:"getSubTargets",value:function(){return this.getLandingPadManager().getLandingPads()}},{key:"getBoundingRadius",value:function(){return this.boundingRadius}},{key:"getTypeName",value:function(){return(0,T.d)(this.model)}},{key:"computeCulling",value:function(e){this.getTransform().setEnabled((0,w.h)(this,e))}},{key:"generate",value:function(e,t){var n=this,r=0;e.forEach(function(e,t){r+=(0,E.ZP)(t.blackBodyTemperature,t.radius,e)});var o=(0,N.y)(this.model.solarPanelEfficiency,this.model.population*this.model.energyConsumptionPerCapitaKWh,r),i=100*this.model.population/this.model.populationDensity,a=0;this.model.agricultureMix.forEach(function(e){var t=function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,2)||function(e,t){if(e){if("string"==typeof e)return L(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,t)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r=t[0],o=t[1],i=n.model.population*O.w.INDIVIDUAL_AVERAGE_DAILY_INTAKE,s=O.w.HYDROPONIC_TO_CONVENTIONAL_RATIO*n.model.nbHydroponicLayers*(0,C.Zw)(o);a+=r*i/s});var s=(i+a)*1e3,l=new f(t,this.scene);l.getTransform().parent=this.getTransform();var c=l.getTransform();this.engineBays.push(l);var u=(0,I.p)(this.model.seed);c=this.addUtilitySections(c,5+Math.floor(5*u(564)),u,t);var h=new g.d(o,O.w.SEED_HALF_RANGE*u(31),t,this.scene);h.getTransform().parent=this.getTransform(),this.placeNode(h.getTransform(),c),c=h.getTransform(),this.solarSections.push(h),c=this.addUtilitySections(c,5+Math.floor(5*u(23)),u,t);var d=(0,R.MA)([[b.T.RING_HABITAT,.4],[b.T.HELIX_HABITAT,.3],[b.T.CYLINDER_HABITAT,.3]],u(17)),S=null;if(d===b.T.HELIX_HABITAT){var w=new m.i(s,O.w.SEED_HALF_RANGE*u(19),t.textures,this.scene);this.helixHabitats.push(w),S=w.getTransform()}else if(d===b.T.RING_HABITAT){var T=new v.g(s,O.w.SEED_HALF_RANGE*u(27),t.textures,this.scene);this.ringHabitats.push(T),S=T.getTransform()}else if(d===b.T.CYLINDER_HABITAT){var A=new p.U(s,O.w.SEED_HALF_RANGE*u(13),t.textures,this.scene);this.cylinderHabitats.push(A),S=A.getTransform()}if(null===S)throw Error("Node creation failed");this.placeNode(S,c),S.parent=this.root,c=S,c=this.addUtilitySections(c,5+Math.floor(5*u(23)),u,t);var P=new y.K(this.model,u(37)*O.w.SEED_HALF_RANGE,t,this.scene);this.landingBays.push(P),this.placeNode(P.getTransform(),c),P.getTransform().parent=this.getTransform()}},{key:"addUtilitySections",value:function(e,t,n,r){for(var o=e,i=0;i<t;i++){var a=new S.o(n(132+10*this.utilitySections.length)*O.w.SEED_HALF_RANGE,r,this.scene);this.utilitySections.push(a),this.placeNode(a.getTransform(),o),a.getTransform().parent=this.getTransform(),o=a.getTransform()}return o}},{key:"placeNode",value:function(e,t){var n=t.getHierarchyBoundingVectors(),r=n.max.subtract(n.min).scale(.5),o=e.getHierarchyBoundingVectors(),i=o.max.subtract(o.min).scale(.5),a=r.y,s=i.y;e.position=t.position.add(t.up.scale(a+s))}},{key:"update",value:function(e,t,n){this.solarSections.forEach(function(e){e.update(t)}),this.utilitySections.forEach(function(e){e.update(t)}),this.helixHabitats.forEach(function(e){e.update(t,n)}),this.ringHabitats.forEach(function(e){e.update(t,n)}),this.cylinderHabitats.forEach(function(e){e.update(t,n)}),this.landingBays.forEach(function(e){e.update(t,n)}),this.engineBays.forEach(function(e){e.update(t)})}},{key:"getTransform",value:function(){return this.root}},{key:"dispose",value:function(){this.solarSections.forEach(function(e){e.dispose()}),this.utilitySections.forEach(function(e){e.dispose()}),this.helixHabitats.forEach(function(e){e.dispose()}),this.ringHabitats.forEach(function(e){e.dispose()}),this.cylinderHabitats.forEach(function(e){e.dispose()}),this.landingBays.forEach(function(e){e.dispose()}),this.engineBays.forEach(function(e){e.dispose()}),this.root.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},61984:function(e,t,n){"use strict";n.d(t,{s:()=>N});var r=n(36801),o=n(90718),i=n(52632),a=n(80465),s=n(92327),l=n(61741),c=n(76161),u=n(27460),h=n(59241),d=n(95864),f=n(53024),p=n(76753),m=n(13679),v=n(78930),y=n(16739),g=n(56072);function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t,n){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n||e):o.value}})(e,t,n||e)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return b(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(P=function(){return!!e})()}var C={WORLD:"world",WORLD_VIEW_PROJECTION:"worldViewProjection",CAMERA_POSITION:"cameraPosition",SEED:"seed",TIME:"time",COLOR1:"color1",COLOR2:"color2",COLOR3:"color3",COLOR_SHARPNESS:"colorSharpness"},I=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,r,o){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var i,a,s,l,c="gasPlanetMaterial";return void 0===v.M.ShadersStore["".concat(c,"FragmentShader")]&&(v.M.ShadersStore["".concat(c,"FragmentShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#define MAX_STARS 5\n\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\nuniform int nbStars;// number of stars\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\nvarying vec3 vUnitSamplePoint;\n\nvarying vec3 vPosition;// position of the vertex varyingsphere space\n\nuniform vec3 cameraPosition;// camera position in world space\n\nuniform vec3 color1;\nuniform vec3 color2;\nuniform vec3 color3;\nuniform float colorSharpness;\n\nuniform float time;\n\nuniform float seed;\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n//\n\nvec4 mod289(vec4 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nfloat mod289(float x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nvec4 permute(vec4 x) {\n    return mod289(((x*34.0)+10.0)*x);\n}\n\nfloat permute(float x) {\n    return mod289(((x*34.0)+10.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat taylorInvSqrt(float r)\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 grad4(float j, vec4 ip)\n{\n    const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n    vec4 p,s;\n\n    p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n    p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n    s = vec4(lessThan(p, vec4(0.0)));\n    p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n    return p;\n}\n\n    // (sqrt(5) - 1)/4 = F4, used once below\n    #define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n{\n    const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n    0.276393202250021,  // 2 * G4\n    0.414589803375032,  // 3 * G4\n    -0.447213595499958); // -1 + 4 * G4\n\n    // First corner\n    vec4 i  = floor(v + dot(v, vec4(F4)) );\n    vec4 x0 = v -   i + dot(i, C.xxxx);\n\n    // Other corners\n\n    // Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n    vec4 i0;\n    vec3 isX = step( x0.yzw, x0.xxx );\n    vec3 isYZ = step( x0.zww, x0.yyz );\n    //  i0.x = dot( isX, vec3( 1.0 ) );\n    i0.x = isX.x + isX.y + isX.z;\n    i0.yzw = 1.0 - isX;\n    //  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n    i0.y += isYZ.x + isYZ.y;\n    i0.zw += 1.0 - isYZ.xy;\n    i0.z += isYZ.z;\n    i0.w += 1.0 - isYZ.z;\n\n    // i0 now contains the unique values 0,1,2,3 in each channel\n    vec4 i3 = clamp( i0, 0.0, 1.0 );\n    vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n    vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n    //  x0 = x0 - 0.0 + 0.0 * C.xxxx\n    //  x1 = x0 - i1  + 1.0 * C.xxxx\n    //  x2 = x0 - i2  + 2.0 * C.xxxx\n    //  x3 = x0 - i3  + 3.0 * C.xxxx\n    //  x4 = x0 - 1.0 + 4.0 * C.xxxx\n    vec4 x1 = x0 - i1 + C.xxxx;\n    vec4 x2 = x0 - i2 + C.yyyy;\n    vec4 x3 = x0 - i3 + C.zzzz;\n    vec4 x4 = x0 + C.wwww;\n\n    // Permutations\n    i = mod289(i);\n    float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n    vec4 j1 = permute( permute( permute( permute (\n    i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n    + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n    + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n    + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n    // Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n    // 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n    vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n    vec4 p0 = grad4(j0,   ip);\n    vec4 p1 = grad4(j1.x, ip);\n    vec4 p2 = grad4(j1.y, ip);\n    vec4 p3 = grad4(j1.z, ip);\n    vec4 p4 = grad4(j1.w, ip);\n\n    // Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    p4 *= taylorInvSqrt(dot(p4,p4));\n\n    // Mix contributions from the five corners\n    vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n    vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n    m0 = m0 * m0;\n    m1 = m1 * m1;\n    return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n    + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n}\n\nfloat simplex401(vec4 p) {\n    return (snoise(p) + 1.0) / 2.0;\n}\n\nfloat fractalSimplex4(vec4 p, int nbOctaves, float decay, float lacunarity) {\n    float totalAmplitude = 0.0;\n    float value = 0.0;\n    for(int i = 0; i < nbOctaves; ++i) {\n        totalAmplitude += 1.0 / pow(decay, float(i));\n        vec4 samplePoint = p * pow(lacunarity, float(i));\n        value += simplex401(samplePoint) / pow(decay, float(i));\n    }\n    return value / totalAmplitude;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat saturate(float value) {\n    if(value < 0.0) return 0.0;\n    if(value > 1.0) return 1.0;\n    return value;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat smoothSharpener(float x, float s) {\n    float offset = 0.5 - (1.0 / s);\n    return smoothstep(offset, 1.0 - offset, x);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// taken from https://github.com/BarthPaleologue/feather/blob/main/assets/shaders/pbr/fragment.glsl\n// based on https://learnopengl.com/PBR/Lighting\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness) {\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness) {\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return num / denom;\n}\n\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n}\n\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\n}\n\nvec3 calculateLight(vec3 albedo, vec3 normal, float roughness, float metallic, vec3 lightDir, vec3 viewDir, vec3 lightColor) {\n    vec3 H = normalize(viewDir + lightDir);\n\n    vec3 F0 = vec3(0.04);\n    F0 = mix(F0, albedo, metallic);\n\n    vec3 F  = fresnelSchlick(max(dot(H, viewDir), 0.0), F0);\n    float NDF = DistributionGGX(normal, H, roughness);\n    float G   = GeometrySmith(normal, viewDir, lightDir, roughness);\n\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(normal, viewDir), 0.0) * max(dot(normal, lightDir), 0.0)  + 1.0; // + 1.0 to prevent division by zero at glancing angles\n    vec3 specular     = numerator / denominator;\n\n    vec3 kS = F;\n    vec3 kD = 1.0 - kS;\n\n    kD *= 1.0 - metallic;\n\n    vec3 radiance = lightColor;\n\n    float NdotL = max(dot(normal, lightDir), 0.0);\n\n    vec3 diffuse = kD * (albedo)/ PI;\n    return (diffuse + specular) * radiance * NdotL;\n}\n\nvoid main() {\n    vec3 normalW = vNormalW;\n\n    float ndl = 0.0;\n    for (int i = 0; i < nbStars; i++) {\n        vec3 starLightRayW = normalize(star_positions[i] - vPositionW);// light ray direction in world space\n        ndl = max(ndl, max(0.0, dot(normalW, starLightRayW)));\n    }\n\n    vec4 seededSamplePoint = vec4(vUnitSamplePoint * 2.0, mod(seed, 1e3));\n\n    seededSamplePoint.y *= 2.5;\n\n    float latitude = seededSamplePoint.y;\n\n    float seedImpact = mod(seed, 1e3);\n\n    float warpingStrength = 2.0;\n    float warping = fractalSimplex4(seededSamplePoint + vec4(seedImpact, 0.0, 0.0, time * 0.01), 5, 2.0, 2.0) * warpingStrength;\n\n    float colorDecision1 = fractalSimplex4(vec4(latitude + warping, seedImpact, -seedImpact, seedImpact), 3, 2.0, 2.0);\n\n    float colorDecision2 = fractalSimplex4(vec4(latitude - warping, seedImpact, -seedImpact, seedImpact), 3, 2.0, 2.0);\n\n    vec3 albedo = mix(color2, color1, smoothstep(0.4, 0.6, colorDecision1));\n\n    albedo = 3.0 * mix(color3, albedo, smoothSharpener(colorDecision2, colorSharpness));\n\n    float roughness = 0.4;\n    float metallic = 0.0;\n\n    // pbr accumulation\n    vec3 Lo = vec3(0.0);\n    vec3 viewRayW = normalize(cameraPosition - vPositionW);\n    for (int i = 0; i < nbStars; i++) {\n        vec3 L = normalize(star_positions[i] - vPositionW);\n\n        Lo += calculateLight(albedo, normalW, roughness, metallic, L, viewRayW, star_colors[i]);\n    }\n\n    gl_FragColor = vec4(Lo, 1.0);\n}\n"),void 0===v.M.ShadersStore["".concat(c,"VertexShader")]&&(v.M.ShadersStore["".concat(c,"VertexShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 world;\nuniform mat4 worldViewProjection;\n\nuniform vec3 cameraPosition;\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n\nvarying vec3 vPosition;\n\nvarying vec3 vUnitSamplePoint;\n\nvoid main() {\n    vec4 outPosition = worldViewProjection * vec4(position, 1.0);\n    gl_Position = outPosition;\n\n    vPositionW = vec3(world * vec4(position, 1.0));\n\n    vNormalW = normalize(vec3(world * vec4(normal, 0.0)));\n\n    vPosition = position;\n\n    vUnitSamplePoint = normalize(vPosition);\n}"),i=n,a=["".concat(e,"GasSurfaceColor"),o,c,{attributes:["position","normal"],uniforms:A(Object.values(C)).concat(A(Object.values(g.T)))}],i=w(i),l=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,P()?Reflect.construct(i,a||[],w(this).constructor):i.apply(this,a)),(s="elapsedSeconds")in l?Object.defineProperty(l,s,{value:0,enumerable:!0,configurable:!0,writable:!0}):l[s]=0,l.setFloat(C.SEED,t),l.setArray3(C.COLOR1,[r.color1.r,r.color1.g,r.color1.b]),l.setArray3(C.COLOR2,[r.color2.r,r.color2.g,r.color2.b]),l.setArray3(C.COLOR3,[r.color3.r,r.color3.g,r.color3.b]),l.setFloat(C.COLOR_SHARPNESS,r.colorSharpness),l.onBindObservable.add(function(e){var t=e.getScene().activeCamera;if(null===t)throw Error("No active camera in the scene");l.getEffect().setVector3(C.CAMERA_POSITION,t.globalPosition)}),l}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&T(n,e),t=[{key:"update",value:function(e,t){var n=this;this.elapsedSeconds+=t,this.onBindObservable.addOnce(function(){(0,g.G)(n.getEffect(),e),n.getEffect().setFloat(C.TIME,n.elapsedSeconds%1e5)})}},{key:"dispose",value:function(e,t,r){S(w(n.prototype),"dispose",this).call(this,e,t,r)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(y.B),E=n(90767);function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N=function(){var e;function t(e,n,c,u){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");R(this,"model",void 0),R(this,"type",l.T.GAS_PLANET),R(this,"mesh",void 0),R(this,"material",void 0),R(this,"aggregate",void 0),R(this,"atmosphereUniforms",void 0),R(this,"ringsUniforms",void 0),R(this,"asteroidField",void 0),R(this,"targetInfo",void 0),this.model=e,this.mesh=o.P.CreateSphere(this.model.name,{diameter:2*this.model.radius,segments:64},u),this.mesh.rotationQuaternion=r.PT.Identity(),this.aggregate=new a.L(this.getTransform(),i.DK.CONTAINER,{mass:0,restitution:.2},u),this.aggregate.body.setMassProperties({inertia:r.Pq.Zero(),mass:0}),this.aggregate.body.disablePreStep=!1;var v=new s.Ei(r.Pq.Zero(),this.model.radius,u);this.aggregate.shape.addChildFromParent(this.getTransform(),v,this.mesh),"procedural"===this.model.colorPalette.type?this.material=new I(this.model.name,this.model.seed,this.model.colorPalette,u):this.material=function(e,t,n){var r=new E.F("gasPlanetMaterial",n);switch(e){case"jupiter":r.diffuseTexture=t.jupiter;break;case"saturn":r.diffuseTexture=t.saturn;break;case"uranus":r.diffuseTexture=t.uranus;break;case"neptune":r.diffuseTexture=t.neptune}return r.specularColor.setAll(.1),r.specularPower=32,r}(this.model.colorPalette.textureId,n.gasPlanet,u),this.mesh.material=this.material;var y=m.w.EARTH_ATMOSPHERE_THICKNESS*Math.max(1,this.model.radius/m.w.EARTH_RADIUS);this.atmosphereUniforms=new h.Q(this.getBoundingRadius(),y),null!==this.model.rings?(this.ringsUniforms=d.zl.New(this.model.rings,n,m.w.RINGS_FADE_OUT_DISTANCE,u),this.asteroidField=new p.U(this.model.seed,this.getTransform(),this.model.rings.innerRadius,this.model.rings.outerRadius,u)):(this.ringsUniforms=null,this.asteroidField=null),this.targetInfo=(0,f.v)(this.getBoundingRadius())}return e=[{key:"updateMaterial",value:function(e,t){var n;n=this.material,(null!=I&&"undefined"!=typeof Symbol&&I[Symbol.hasInstance]?!!I[Symbol.hasInstance](n):n instanceof I)&&this.material.update(e,t)}},{key:"getRadius",value:function(){return this.model.radius}},{key:"getBoundingRadius",value:function(){return this.model.radius}},{key:"getTypeName",value:function(){return(0,u.d)(this.model)}},{key:"computeCulling",value:function(e){this.mesh.isVisible=(0,c.h)(this,e)}},{key:"dispose",value:function(e){var t,n;this.mesh.dispose(),this.aggregate.dispose(),this.material.dispose(),null==(t=this.asteroidField)||t.dispose(),null==(n=this.ringsUniforms)||n.dispose(e)}},{key:"getTransform",value:function(){return this.mesh}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},96824:function(e,t,n){"use strict";n.d(t,{R:()=>es});var r,o,i=n(36801),a=n(36044),s=n(52632),l=n(80465),c=n(92327),u=n(61741),h=n(27460),d=n(59241),f=n(38645);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m={OCEAN_RADIUS:"ocean_radius",OCEAN_SMOOTHNESS:"ocean_smoothness",OCEAN_SPECULAR_POWER:"ocean_specularPower",OCEAN_ALPHA_MODIFIER:"ocean_alphaModifier",OCEAN_DEPTH_MODIFIER:"ocean_depthModifier",OCEAN_WAVE_BLENDING_SHARPNESS:"ocean_waveBlendingSharpness",PLANET_INVERSE_ROTATION_MATRIX:"planetInverseRotationMatrix",TIME:"time"},v={NORMAL_MAP_1:"normalMap1",NORMAL_MAP_2:"normalMap2"},y=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");p(this,"oceanRadius",void 0),p(this,"smoothness",void 0),p(this,"specularPower",void 0),p(this,"depthModifier",void 0),p(this,"alphaModifier",void 0),p(this,"waveBlendingSharpness",void 0),p(this,"time",void 0),this.oceanRadius=e+n,this.depthModifier=.0015,this.alphaModifier=.0025,this.specularPower=1,this.smoothness=.8,this.waveBlendingSharpness=.5,this.time=0}return e=[{key:"getUniformNames",value:function(){return Object.values(m)}},{key:"setUniforms",value:function(e,t){e.setFloat(m.OCEAN_RADIUS,this.oceanRadius),e.setFloat(m.OCEAN_SMOOTHNESS,this.smoothness),e.setFloat(m.OCEAN_SPECULAR_POWER,this.specularPower),e.setFloat(m.OCEAN_ALPHA_MODIFIER,this.alphaModifier),e.setFloat(m.OCEAN_DEPTH_MODIFIER,this.depthModifier),e.setFloat(m.OCEAN_WAVE_BLENDING_SHARPNESS,this.waveBlendingSharpness),e.setMatrix(m.PLANET_INVERSE_ROTATION_MATRIX,t.getWorldMatrix().getRotationMatrix().transpose()),e.setFloat(m.TIME,this.time%1e5)}},{key:"getSamplerNames",value:function(){return Object.values(v)}},{key:"setSamplers",value:function(e,t){e.setTexture(v.NORMAL_MAP_1,t.normalMap1),e.setTexture(v.NORMAL_MAP_2,t.normalMap2)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),g=n(95864),b=n(53024),S=n(76753),w=n(13679),T=n(78930),A=n(16739),P=n(81098),C=n(70673),I=n(56072),E=n(32220),R=((r={})[r.DEFAULT=0]="DEFAULT",r[r.MOISTURE=1]="MOISTURE",r[r.TEMPERATURE=2]="TEMPERATURE",r[r.NORMAL=3]="NORMAL",r[r.HEIGHT=4]="HEIGHT",r);function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e){return function(e){if(Array.isArray(e))return N(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return N(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_=function(){return!!e})()}var k={WORLD:"world",WORLD_VIEW_PROJECTION:"worldViewProjection",COLOR_MODE:"colorMode",PLANET_RADIUS:"planetRadius",CHUNK_POSITION_PLANET_SPACE:"chunkPositionPlanetSpace",CAMERA_POSITION:"cameraPosition",PLANET_WORLD_MATRIX:"planetWorldMatrix",WATER_LEVEL:"waterLevel",BEACH_SIZE:"beachSize",STEEP_SHARPNESS:"steepSharpness",MAX_ELEVATION:"maxElevation",MIN_TEMPERATURE:"minTemperature",MAX_TEMPERATURE:"maxTemperature",PRESSURE:"pressure",WATER_AMOUNT:"waterAmount"},D={LUT:"lut",PLAIN_NORMAL_METALLIC_MAP:"plainNormalMetallicMap",PLAIN_ALBEDO_ROUGHNESS_MAP:"plainAlbedoRoughnessMap",DESERT_NORMAL_METALLIC_MAP:"desertNormalMetallicMap",DESERT_ALBEDO_ROUGHNESS_MAP:"desertAlbedoRoughnessMap",SNOW_NORMAL_METALLIC_MAP:"snowNormalMetallicMap",SNOW_ALBEDO_ROUGHNESS_MAP:"snowAlbedoRoughnessMap",STEEP_NORMAL_METALLIC_MAP:"steepNormalMetallicMap",STEEP_ALBEDO_ROUGHNESS_MAP:"steepAlbedoRoughnessMap"},j=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,r,o){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var i,a,s,l,c,u="surfaceMaterial";void 0===T.M.ShadersStore["".concat(u,"FragmentShader")]&&(T.M.ShadersStore["".concat(u,"FragmentShader")]='//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\n#define DISABLE_UNIFORMITY_ANALYSIS\n\nuniform mat4 world;\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\nvarying vec3 vUnitSamplePoint;\nvarying vec3 vSphereNormalW;\nvarying vec3 vSamplePoint;\n\nvarying vec3 vPosition;// position of the vertex varyingchunk\nvarying vec3 vNormal;// normal of the vertex varyingsphere space\n\nuniform vec3 cameraPosition;// camera position in world space\n\n#define MAX_STARS 5\nuniform int nbStars;// number of stars\nuniform vec3 star_positions[MAX_STARS];\nuniform vec3 star_colors[MAX_STARS];\n\nuniform int colorMode;\n\nuniform sampler2D lut;\n\nuniform sampler2D plainAlbedoRoughnessMap;\nuniform sampler2D plainNormalMetallicMap;\n\nuniform sampler2D desertNormalMetallicMap;\nuniform sampler2D desertAlbedoRoughnessMap;\n\nuniform sampler2D snowNormalMetallicMap;\nuniform sampler2D snowAlbedoRoughnessMap;\n\nuniform sampler2D steepNormalMetallicMap;\nuniform sampler2D steepAlbedoRoughnessMap;\n\nuniform float planetRadius;// planet radius\nuniform float waterLevel;// controls sand layer\nuniform float beachSize;\n\nuniform float steepSharpness;// sharpness of demaracation between steepColor and normal colors\n\nuniform float maxElevation;\n\nuniform float pressure;\nuniform float minTemperature;\nuniform float maxTemperature;\n\nuniform float waterAmount;\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nvec2 toUV(in vec3 n)\n{\n    vec2 uv;\n\n    uv.x = atan(-n.x, n.z);\n    uv.x = (uv.x + PI / 2.0) / (PI * 2.0) + PI * (28.670 / 360.0);\n\n    uv.y = acos(n.y) / PI;\n\n    return uv;\n}\n\n// The MIT License\n// Copyright \xa9 2015 Inigo Quilez\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n// https://www.youtube.com/c/InigoQuilez\n// https://iquilezles.org\n\n\n// One simple way to avoid texture tile repetition, at the cost of 4 times the amount of\n// texture lookups (still much better than https://www.shadertoy.com/view/4tsGzf)\n//\n// More info: https://iquilezles.org/articles/texturerepetition\n\n//#define USEHASH\n\nvec4 hash4(vec2 p) { return fract(sin(vec4(1.0+dot(p, vec2(37.0, 17.0)),\n2.0+dot(p, vec2(11.0, 47.0)),\n3.0+dot(p, vec2(41.0, 29.0)),\n4.0+dot(p, vec2(23.0, 31.0))))*103.0); }\n\n#define inline\nvec4 textureNoTile(sampler2D samp, in vec2 uv) {\n    vec2 iuv = floor(uv);\n    vec2 fuv = fract(uv);\n\n    // generate per-tile transform\n    vec4 ofa = hash4(iuv + vec2(0.0, 0.0));\n    vec4 ofb = hash4(iuv + vec2(1.0, 0.0));\n    vec4 ofc = hash4(iuv + vec2(0.0, 1.0));\n    vec4 ofd = hash4(iuv + vec2(1.0, 1.0));\n\n    vec2 ddx = dFdx(uv);\n    vec2 ddy = dFdy(uv);\n\n    // transform per-tile uvs\n    ofa.zw = sign(ofa.zw-0.5);\n    ofb.zw = sign(ofb.zw-0.5);\n    ofc.zw = sign(ofc.zw-0.5);\n    ofd.zw = sign(ofd.zw-0.5);\n\n    // uv\'s, and derivarives (for correct mipmapping)\n    vec2 uva = uv*ofa.zw + ofa.xy; vec2 ddxa = ddx*ofa.zw; vec2 ddya = ddy*ofa.zw;\n    vec2 uvb = uv*ofb.zw + ofb.xy; vec2 ddxb = ddx*ofb.zw; vec2 ddyb = ddy*ofb.zw;\n    vec2 uvc = uv*ofc.zw + ofc.xy; vec2 ddxc = ddx*ofc.zw; vec2 ddyc = ddy*ofc.zw;\n    vec2 uvd = uv*ofd.zw + ofd.xy; vec2 ddxd = ddx*ofd.zw; vec2 ddyd = ddy*ofd.zw;\n\n    // fetch and blend\n    vec2 b = smoothstep(0.25, 0.75, fuv);\n\n    return mix(mix(textureGrad(samp, uva, ddxa, ddya),\n    textureGrad(samp, uvb, ddxb, ddyb), b.x),\n    mix(textureGrad(samp, uvc, ddxc, ddyc),\n    textureGrad(samp, uvd, ddxd, ddyd), b.x), b.y);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// https://bgolus.medium.com/normal-mapping-for-a-triplanar-shader-10bf39dca05a\n#define inline\nvec3 triplanarNormal(vec3 position, vec3 surfaceNormal, sampler2D normalMap, float scale) {\n    vec2 uvX = vec3(position).zy * scale;\n    vec2 uvY = vec3(position).xz * scale;\n    vec2 uvZ = vec3(position).xy * scale;\n\n    vec3 blendWeight = pow(abs(surfaceNormal), vec3(2.0));\n    blendWeight /= (blendWeight.x + blendWeight.y + blendWeight.z);\n\n    // get the normal from the normal map\n\n    vec3 tNormalX = textureNoTile(normalMap, uvX).rgb;\n    vec3 tNormalY = textureNoTile(normalMap, uvY).rgb;\n    vec3 tNormalZ = textureNoTile(normalMap, uvZ).rgb;\n\n    tNormalX.g = 1.0 - tNormalX.g;\n    tNormalY.g = 1.0 - tNormalY.g;\n    tNormalZ.g = 1.0 - tNormalZ.g;\n\n    tNormalX = tNormalX * 2.0 - 1.0;\n    tNormalY = tNormalY * 2.0 - 1.0;\n    tNormalZ = tNormalZ * 2.0 - 1.0;\n\n    // Swizzle world normals into tangent space and apply Whiteout blend\n    tNormalX = vec3(tNormalX.xy + surfaceNormal.zy, abs(tNormalX.z) * surfaceNormal.x);\n    tNormalY = vec3(tNormalY.xy + surfaceNormal.xz, abs(tNormalY.z) * surfaceNormal.y);\n    tNormalZ = vec3(tNormalZ.xy + surfaceNormal.xy, abs(tNormalZ.z) * surfaceNormal.z);\n\n    // Swizzle tangent normals to match world orientation and triblend\n    return normalize(\n    tNormalX.zyx * blendWeight.x +\n    tNormalY.xzy * blendWeight.y +\n    tNormalZ.xyz * blendWeight.z\n    );\n}\n\n#define inline\nvoid triPlanarMaterial(vec3 position, vec3 surfaceNormal, sampler2D albedoRoughnessMap, sampler2D normalMetallicMap, float scale, out vec3 albedo, out vec3 normal, out float roughness, out float metallic) {\n    vec2 uvX = vec3(position).zy * scale;\n    vec2 uvY = vec3(position).xz * scale;\n    vec2 uvZ = vec3(position).xy * scale;\n\n    // get the normal from the normal map\n    vec4 tNormalMetallicX = textureNoTile(normalMetallicMap, uvX);\n    vec4 tNormalMetallicY = textureNoTile(normalMetallicMap, uvY);\n    vec4 tNormalMetallicZ = textureNoTile(normalMetallicMap, uvZ);\n\n    vec3 tNormalX = tNormalMetallicX.rgb;\n    vec3 tNormalY = tNormalMetallicY.rgb;\n    vec3 tNormalZ = tNormalMetallicZ.rgb;\n\n    tNormalX = tNormalX * 2.0 - 1.0;\n    tNormalY = tNormalY * 2.0 - 1.0;\n    tNormalZ = tNormalZ * 2.0 - 1.0;\n\n    vec3 blendWeight = abs(surfaceNormal);\n    blendWeight = pow(blendWeight, vec3(2.0));\n    blendWeight /= (blendWeight.x + blendWeight.y + blendWeight.z);\n\n    // Swizzle world normals into tangent space and apply Whiteout blend\n    tNormalX = vec3(tNormalX.xy + surfaceNormal.zy, abs(tNormalX.z) * surfaceNormal.x);\n    tNormalY = vec3(tNormalY.xy + surfaceNormal.xz, abs(tNormalY.z) * surfaceNormal.y);\n    tNormalZ = vec3(tNormalZ.xy + surfaceNormal.xy, abs(tNormalZ.z) * surfaceNormal.z);\n\n    normal = normalize(\n    tNormalX.zyx * blendWeight.x +\n    tNormalY.xzy * blendWeight.y +\n    tNormalZ.xyz * blendWeight.z\n    );\n\n    // tri planar mapping of albedo\n    vec4 tAlbedoRoughnessX = textureNoTile(albedoRoughnessMap, uvX);\n    vec4 tAlbedoRoughnessY = textureNoTile(albedoRoughnessMap, uvY);\n    vec4 tAlbedoRoughnessZ = textureNoTile(albedoRoughnessMap, uvZ);\n\n    float gamma = 2.2;\n    vec3 tAlbedoX = pow(tAlbedoRoughnessX.rgb, vec3(gamma));\n    vec3 tAlbedoY = pow(tAlbedoRoughnessY.rgb, vec3(gamma));\n    vec3 tAlbedoZ = pow(tAlbedoRoughnessZ.rgb, vec3(gamma));\n\n    albedo =\n    tAlbedoX * blendWeight.x +\n    tAlbedoY * blendWeight.y +\n    tAlbedoZ * blendWeight.z;\n\n    // tri planar mapping of roughness\n    float tRoughnessX = tAlbedoRoughnessX.a;\n    float tRoughnessY = tAlbedoRoughnessY.a;\n    float tRoughnessZ = tAlbedoRoughnessZ.a;\n\n    roughness =\n    tRoughnessX * blendWeight.x +\n    tRoughnessY * blendWeight.y +\n    tRoughnessZ * blendWeight.z;\n\n    // tri planar mapping of metallic\n    float tMetallicX = tNormalMetallicX.a;\n    float tMetallicY = tNormalMetallicY.a;\n    float tMetallicZ = tNormalMetallicZ.a;\n\n    metallic =\n    tMetallicX * blendWeight.x +\n    tMetallicY * blendWeight.y +\n    tMetallicZ * blendWeight.z;\n}\n\n//https://www.desmos.com/calculator/8etk6vdfzi\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat smoothSharpener(float x, float s) {\n    float offset = 0.5 - (1.0 / s);\n    return smoothstep(offset, 1.0 - offset, x);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\nvec3 saturate(vec3 color) {\n    return clamp(color, 0.0, 1.0);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// https://www.omnicalculator.com/chemistry/boiling-point\n// https://www.wikiwand.com/en/Boiling_point#/Saturation_temperature_and_pressure\n// https://www.desmos.com/calculator/ctxerbh48s\n\n/**\n * @param {number} pressure in pascal\n * @returns {number} water boiling temperature in Kelvin\n*/\nfloat waterBoilingTemperature(float pressure) {\n    float P1 = 101325.0;// sea level pressure on Earth in pascal\n    float P2 = pressure;\n    float T1 = 273.15 + 100.0;// boiling point of water at sea level on Earth in Kelvin\n    float DH = 40660.0;\n    float R = 8.314;\n    if (P2 <= 0.0) return 0.0;// when pressure is 0, water cannot exist in liquid state\n    return 1.0 / (1.0 / T1 + log(P1 / P2) * (R / DH));\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfloat computeTemperature01(float elevation01, float absLatitude01, float ndl, float dayDuration) {\n    // TODO: do not hardcode both\n    float temperatureHeightFalloff = 1.2;\n    float temperatureLatitudeFalloff = 1.0;\n\n    // TODO: do not hardcode that factor\n    float temperatureRotationFactor = smoothstep(0.0, 1.0, 0.15 * dayDuration);\n\n    // https://www.desmos.com/calculator/apezlfvwic\n    float temperature01 = 1.0;\n\n    // temperature drops with latitude\n    // https://www.researchgate.net/profile/Anders-Levermann/publication/274494740/figure/fig3/AS:391827732615174@1470430419170/a-Surface-air-temperature-as-a-function-of-latitude-for-data-averaged-over-1961-90-for.png\n    temperature01 -= pow(temperatureLatitudeFalloff * absLatitude01, 3.0);\n\n    // temperature drops exponentially with elevation\n    temperature01 *= exp(-elevation01 * temperatureHeightFalloff);\n    \n    // temperature drops during nighttime (more ice)\n    temperature01 *= ndl * temperatureRotationFactor + 1.0 - temperatureRotationFactor;\n\n    // cannot exceed max and min temperatures\n    temperature01 = clamp(temperature01, 0.0, 1.0);\n\n    return temperature01;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// taken from https://github.com/BarthPaleologue/feather/blob/main/assets/shaders/pbr/fragment.glsl\n// based on https://learnopengl.com/PBR/Lighting\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nfloat DistributionGGX(vec3 N, vec3 H, float roughness) {\n    float a      = roughness*roughness;\n    float a2     = a*a;\n    float NdotH  = max(dot(N, H), 0.0);\n    float NdotH2 = NdotH*NdotH;\n\n    float num   = a2;\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n    denom = PI * denom * denom;\n\n    return num / denom;\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness) {\n    float r = (roughness + 1.0);\n    float k = (r*r) / 8.0;\n\n    float num   = NdotV;\n    float denom = NdotV * (1.0 - k) + k;\n\n    return num / denom;\n}\n\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\n    float NdotV = max(dot(N, V), 0.0);\n    float NdotL = max(dot(N, L), 0.0);\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\n\n    return ggx1 * ggx2;\n}\n\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\n}\n\nvec3 calculateLight(vec3 albedo, vec3 normal, float roughness, float metallic, vec3 lightDir, vec3 viewDir, vec3 lightColor) {\n    vec3 H = normalize(viewDir + lightDir);\n\n    vec3 F0 = vec3(0.04);\n    F0 = mix(F0, albedo, metallic);\n\n    vec3 F  = fresnelSchlick(max(dot(H, viewDir), 0.0), F0);\n    float NDF = DistributionGGX(normal, H, roughness);\n    float G   = GeometrySmith(normal, viewDir, lightDir, roughness);\n\n    vec3 numerator    = NDF * G * F;\n    float denominator = 4.0 * max(dot(normal, viewDir), 0.0) * max(dot(normal, lightDir), 0.0)  + 1.0; // + 1.0 to prevent division by zero at glancing angles\n    vec3 specular     = numerator / denominator;\n\n    vec3 kS = F;\n    vec3 kD = 1.0 - kS;\n\n    kD *= 1.0 - metallic;\n\n    vec3 radiance = lightColor;\n\n    float NdotL = max(dot(normal, lightDir), 0.0);\n\n    vec3 diffuse = kD * (albedo)/ PI;\n    return (diffuse + specular) * radiance * NdotL;\n}\n\nvoid main() {\n    vec3 viewRayW = normalize(cameraPosition - vPositionW);// view direction in world space\n\n    vec3 sphereNormalW = vSphereNormalW;\n\n    // diffuse lighting extinction\n    float ndl1 = 0.0;\n    for (int i = 0; i < nbStars; i++) {\n        vec3 starLightRayW = normalize(star_positions[i] - vPositionW);// light ray direction in world space\n        ndl1 += max(dot(sphereNormalW, starLightRayW), 0.0);\n    }\n    ndl1 = clamp(ndl1, 0.0, 1.0);\n\n    //FIXME: should use the angle between the axis and the normal\n    float latitude = acos(clamp(vUnitSamplePoint.y, -1.0, 1.0)) - 3.1415 / 2.0;\n    //float latitude = vUnitSamplePoint.y;\n    float absLatitude01 = abs(latitude);\n\n    float elevation = length(vPosition) - planetRadius;\n\n    float elevation01 = elevation / maxElevation;\n    float waterLevel01 = waterLevel / maxElevation;\n\n    float slope = 1.0 - abs(dot(vUnitSamplePoint, vNormal));\n\n    /// Analyse Physique de la plan\xe8te\n\n    float dayDuration = 1.0;\n\n    // pressions\n    //float waterSublimationPression = 0.006; //https://www.wikiwand.com/en/Sublimation_(phase_transition)#/Water\n\n    // Temperatures\n\n    float waterMeltingPoint = 273.15; // fairly good approximation\n    float waterMeltingPoint01 = (waterMeltingPoint - minTemperature) / (maxTemperature - minTemperature);\n    float waterBoilingPoint01 = (waterBoilingTemperature(pressure) - minTemperature) / (maxTemperature - minTemperature);\n\n    //https://qph.fs.quoracdn.net/main-qimg-6a0fa3c05fb4db3d7d081680aec4b541\n    //float co2SublimationTemperature = 0.0; // https://www.wikiwand.com/en/Sublimation_(phase_transition)#/CO2\n    // TODO: find the equation ; even better use a texture\n    //float co2SublimationTemperature01 = (co2SublimationTemperature - minTemperature) / (maxTemperature - minTemperature);\n\n    float temperature01 = computeTemperature01(elevation01, absLatitude01, ndl1, dayDuration);\n\n    float temperature = mix(minTemperature, maxTemperature, temperature01);\n\n    vec2 uv = toUV(vUnitSamplePoint);\n    // trick from https://www.shadertoy.com/view/3dVSzm to avoid Greenwich artifacts\n    vec2 df = fwidth(uv);\n    if (df.x > 0.5) df.x = 0.0;\n    vec4 lutResult = textureLod(lut, uv, log2(max(df.x, df.y) * 1024.0));\n\n    // moisture\n    float moisture01 = 0.0;// 0.0 = sec, 1.0 = humid : sec par d\xe9faut\n    if (waterMeltingPoint01 < 1.0) {\n        // if there is liquid water on the surface\n        moisture01 += lutResult.x;\n    }\n    if (pressure == 0.0) {\n        moisture01 += lutResult.y;\n    }\n    moisture01 = clamp(moisture01, 0.0, 1.0);\n\n\n    vec3 blendingNormal = vNormal;\n\n    // calcul de la couleur et de la normale\n    float plainFactor = 0.0,\n    desertFactor = 0.0,\n    snowFactor = 0.0;\n\n    // hard separation between wet and dry\n    float moistureSharpness = 10.0;\n    float moistureFactor = smoothSharpener(moisture01, moistureSharpness);\n\n    float beachFactor = smoothstep(waterLevel01 + beachSize / maxElevation, waterLevel01, elevation01);\n    beachFactor = smoothSharpener(beachFactor, 2.0);\n\n    plainFactor = 1.0;//- steepFactor;\n\n    // apply beach factor\n    plainFactor *= 1.0 - beachFactor;\n    //beachFactor *= 1.0 - steepFactor;\n\n    // blend with desert factor when above water\n    desertFactor = 1.0 - smoothstep(0.3, 0.5, moisture01);\n    desertFactor = smoothSharpener(desertFactor, 2.0);\n    plainFactor *= 1.0 - desertFactor;\n    beachFactor *= 1.0 - desertFactor;\n\n    // blend with snow factor when above water\n    snowFactor = 1.0 - smoothstep(-2.0, 0.0, temperature - abs(0.3 * (blendingNormal.z + blendingNormal.x + blendingNormal.y)) * 5.0);\n    snowFactor = smoothSharpener(snowFactor, 2.0);\n    plainFactor *= 1.0 - snowFactor;\n    beachFactor *= 1.0 - snowFactor;\n    desertFactor *= 1.0 - snowFactor;\n\n    float steepFactor = slope;\n    steepFactor = smoothstep(0.05, 0.3, steepFactor);\n    steepFactor = smoothSharpener(steepFactor, steepSharpness);\n    snowFactor *= 1.0 - steepFactor;\n    plainFactor *= 1.0 - steepFactor;\n    beachFactor *= 1.0 - steepFactor;\n    desertFactor *= 1.0 - steepFactor;\n\n    float scale = 0.05;\n\n    // Steep material\n    float steepScale = scale;\n    vec3 steepAlbedo;\n    vec3 steepNormal = vNormal;\n    float steepRoughness, steepMetallic;\n    if (steepFactor > 0.01) {\n        triPlanarMaterial(vSamplePoint, vNormal, steepAlbedoRoughnessMap, steepNormalMetallicMap, steepScale, steepAlbedo, steepNormal, steepRoughness, steepMetallic);\n    }\n\n    // Plain material\n    float plainScale = scale;\n    vec3 plainAlbedo;\n    vec3 plainNormal = vNormal;\n    float plainRoughness, plainMetallic;\n    if (plainFactor > 0.01) {\n        triPlanarMaterial(vSamplePoint, vNormal, plainAlbedoRoughnessMap, plainNormalMetallicMap, plainScale, plainAlbedo, plainNormal, plainRoughness, plainMetallic);\n    }\n\n    // Desert material\n    float desertScale = scale;\n    vec3 desertAlbedo;\n    vec3 desertNormal = vNormal;\n    float desertRoughness, desertMetallic;\n    if (desertFactor + beachFactor > 0.01) {\n        triPlanarMaterial(vSamplePoint, vNormal, desertAlbedoRoughnessMap, desertNormalMetallicMap, desertScale, desertAlbedo, desertNormal, desertRoughness, desertMetallic);\n    }\n\n    // Snow material\n    float snowScale = scale;\n    vec3 snowAlbedo;\n    vec3 snowNormal = vNormal;\n    float snowRoughness, snowMetallic;\n    if (snowFactor > 0.01) {\n        triPlanarMaterial(vSamplePoint, vNormal, snowAlbedoRoughnessMap, snowNormalMetallicMap, snowScale, snowAlbedo, snowNormal, snowRoughness, snowMetallic);\n    }\n\n    vec3 albedo = steepFactor * steepAlbedo + plainFactor * plainAlbedo + (desertFactor+beachFactor) * desertAlbedo + snowFactor * snowAlbedo;\n\n    vec3 normal = steepFactor * steepNormal + plainFactor * plainNormal + (desertFactor+beachFactor) * desertNormal + snowFactor * snowNormal;\n    normal = normalize(normal);\n\n    float roughness = steepFactor * steepRoughness + plainFactor * plainRoughness + (desertFactor+beachFactor) * desertRoughness + snowFactor * snowRoughness;\n\n    float metallic = steepFactor * steepMetallic + plainFactor * plainMetallic + (desertFactor+beachFactor) * desertMetallic + snowFactor * snowMetallic;\n\n    vec3 normalW = vNormalW;\n\n    // pbr accumulation\n    vec3 Lo = vec3(0.0);\n    vec3 V = normalize(cameraPosition - vPositionW);\n    for (int i = 0; i < nbStars; i++) {\n        vec3 L = normalize(star_positions[i] - vPositionW);\n\n        Lo += calculateLight(albedo, normalW, roughness, metallic, L, V, star_colors[i]);\n    }\n\n    Lo = pow(Lo, vec3(1.0 / 2.2));\n\n    vec3 screenColor = Lo;\n\n    if (colorMode == 1) screenColor = mix(vec3(1.0, 0.0, 0.0), vec3(0.0, 1.0, 0.0), moisture01);\n    if (colorMode == 2) screenColor = mix(vec3(0.1, 0.2, 1.0), vec3(1.0, 0.0, 0.0), temperature01);\n    if (colorMode == 3) screenColor = normal * 0.5 + 0.5;\n    if (colorMode == 4) screenColor = vec3(elevation01);\n    if (colorMode == 5) screenColor = vec3(1.0 - dot(normal, normalize(vPosition)));\n    if (colorMode == 6) screenColor = vec3(1.0 - slope);\n\n    gl_FragColor = vec4(screenColor, 1.0);// apply color and lighting\n} '),void 0===T.M.ShadersStore["".concat(u,"VertexShader")]&&(T.M.ShadersStore["".concat(u,"VertexShader")]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 world;\nuniform mat4 worldViewProjection;\n\nuniform vec3 chunkPositionPlanetSpace;\n\nuniform mat4 planetWorldMatrix;\nuniform float planetRadius;\n\nuniform vec3 cameraPosition;\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\nvarying vec3 vSphereNormalW;\n\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\nvarying vec3 vUnitSamplePoint;\nvarying vec3 vSamplePoint;\n\nvoid main() {\n    vec4 outPosition = worldViewProjection * vec4(position, 1.0);\n    gl_Position = outPosition;\n    \n    vPositionW = vec3(world * vec4(position, 1.0));\n    vNormalW = vec3(world * vec4(normal, 0.0));\n\n    // smooth normal when far away from the planet\n    vec3 planetPosition = vec3(planetWorldMatrix[3]);\n    float distanceToPlanet = max(0.0, length(cameraPosition - planetPosition) - planetRadius);\n    vec3 planetNormalW = normalize(vPositionW - planetPosition);\n\n    vNormalW = mix(vNormalW, planetNormalW, 0.9 * smoothstep(20e3, 300e3, distanceToPlanet));\n\n	vPosition = chunkPositionPlanetSpace + position;\n\n	vUnitSamplePoint = normalize(vPosition);\n    vSphereNormalW = vec3(planetWorldMatrix * vec4(vUnitSamplePoint, 0.0));\n\n    // Use a triangle wave to clamp our sample coordinates to the range [0, 1] in a periodic way\n    float a = 512.0;\n    float p = 4.0 * a;\n    // the phase is completely arbitrary, but it is an attempt to minimize the visual artifacts\n    vec3 phase = vec3(-132.0, 17.0, 53.0);\n    vSamplePoint = (4.0 * a / p) * abs(mod(vPosition + phase, p) - p * 0.5);\n\n	vNormal = normal;\n}\n"),i=n,a=["".concat(e.name,"SurfaceColor"),o,u,{attributes:["position","normal"],uniforms:M(Object.values(k)).concat(M(Object.values(I.T))),samplers:M(Object.values(D))}],i=L(i),O(s=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,_()?Reflect.construct(i,a||[],L(this).constructor):i.apply(this,a)),"planetModel",void 0),O(s,"plainNormalMetallicMap",void 0),O(s,"plainAlbedoRoughnessMap",void 0),O(s,"desertNormalMetallicMap",void 0),O(s,"desertAlbedoRoughnessMap",void 0),O(s,"snowNormalMetallic",void 0),O(s,"snowAlbedoRoughnessMap",void 0),O(s,"steepNormalMetallic",void 0),O(s,"steepAlbedoRoughnessMap",void 0),O(s,"colorMode",void 0),O(s,"beachSize",void 0),O(s,"steepSharpness",void 0);var h=(0,E.p)(e.seed);s.planetModel=e,s.beachSize=100+50*(0,P.centeredRand)(h,85),s.colorMode=R.DEFAULT,s.steepSharpness=2,s.plainNormalMetallicMap=t.grass.normalMetallic,s.plainAlbedoRoughnessMap=t.grass.albedoRoughness,s.desertNormalMetallicMap=t.sand.normalMetallic,s.desertAlbedoRoughnessMap=t.sand.albedoRoughness,s.snowNormalMetallic=t.snow.normalMetallic,s.snowAlbedoRoughnessMap=t.snow.albedoRoughness,s.steepNormalMetallic=t.rock.normalMetallic,s.steepAlbedoRoughnessMap=t.rock.albedoRoughness,null===e.ocean&&(null!==e.atmosphere?(s.plainNormalMetallicMap=t.sand.normalMetallic,s.plainAlbedoRoughnessMap=t.sand.albedoRoughness):(s.plainNormalMetallicMap=t.rock.normalMetallic,s.plainAlbedoRoughnessMap=t.rock.albedoRoughness));var d=(0,C.T)(o);s.setTexture("lut",d);var f=r.get();return f.setPlanetPhysicsInfo(s.planetModel.temperature.min,s.planetModel.temperature.max,null!=(c=null==(l=s.planetModel.atmosphere)?void 0:l.pressure)?c:0),f.getTexture().executeWhenReady(function(){s.setTexture(D.LUT,f.getTexture()),d.dispose()}),s.onDisposeObservable.addOnce(function(){r.release(f),d.dispose()}),s.updateTextures(),s.updateConstants(),s.onBindObservable.add(function(e){var t=e.getScene().activeCamera;if(null===t)throw Error("No active camera in the scene");s.getEffect().setVector3(k.CAMERA_POSITION,t.globalPosition),s.getEffect().setVector3(k.CHUNK_POSITION_PLANET_SPACE,e.position)}),s}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&x(n,e),t=[{key:"updateTextures",value:function(){this.setTexture(D.STEEP_NORMAL_METALLIC_MAP,this.steepNormalMetallic),this.setTexture(D.STEEP_ALBEDO_ROUGHNESS_MAP,this.steepAlbedoRoughnessMap),this.setTexture(D.PLAIN_NORMAL_METALLIC_MAP,this.plainNormalMetallicMap),this.setTexture(D.PLAIN_ALBEDO_ROUGHNESS_MAP,this.plainAlbedoRoughnessMap),this.setTexture(D.SNOW_NORMAL_METALLIC_MAP,this.snowNormalMetallic),this.setTexture(D.SNOW_ALBEDO_ROUGHNESS_MAP,this.snowAlbedoRoughnessMap),this.setTexture(D.DESERT_NORMAL_METALLIC_MAP,this.desertNormalMetallicMap),this.setTexture(D.DESERT_ALBEDO_ROUGHNESS_MAP,this.desertAlbedoRoughnessMap)}},{key:"updateConstants",value:function(){var e,t,n,r;this.setFloat(k.PLANET_RADIUS,this.planetModel.radius),this.setInt(k.COLOR_MODE,this.colorMode),this.setFloat(k.WATER_LEVEL,null!=(n=null==(e=this.planetModel.ocean)?void 0:e.depth)?n:0),this.setFloat(k.BEACH_SIZE,this.beachSize),this.setFloat(k.STEEP_SHARPNESS,this.steepSharpness),this.setFloat(k.MIN_TEMPERATURE,this.planetModel.temperature.min),this.setFloat(k.MAX_TEMPERATURE,this.planetModel.temperature.max),this.setFloat(k.PRESSURE,null!=(r=null==(t=this.planetModel.atmosphere)?void 0:t.pressure)?r:0),this.setFloat(k.WATER_AMOUNT,this.planetModel.waterAmount),this.setFloat(k.MAX_ELEVATION,this.planetModel.terrainSettings.continent_base_height+this.planetModel.terrainSettings.max_mountain_height+this.planetModel.terrainSettings.max_bump_height)}},{key:"update",value:function(e,t){var n=this;this.onBindObservable.addOnce(function(){n.getEffect().setMatrix(k.PLANET_WORLD_MATRIX,e),(0,I.G)(n.getEffect(),t)})}},{key:"setBeachSize",value:function(e){this.beachSize=e,this.updateConstants()}},{key:"getBeachSize",value:function(){return this.beachSize}},{key:"setColorMode",value:function(e){this.colorMode=e,this.updateConstants()}},{key:"getColorMode",value:function(){return this.colorMode}},{key:"setSteepSharpness",value:function(e){this.steepSharpness=e,this.updateConstants()}},{key:"getSteepSharpness",value:function(){return this.steepSharpness}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(A.B),F=n(9323),U=n(13298),G=n(35543),B=((o={})[o.UP=0]="UP",o[o.DOWN=1]="DOWN",o[o.LEFT=2]="LEFT",o[o.RIGHT=3]="RIGHT",o[o.FORWARD=4]="FORWARD",o[o.BACKWARD=5]="BACKWARD",o);function H(e){switch(e){case 0:return i.PT.RotationAxis(G._0.X,Math.PI/2);case 1:return i.PT.RotationAxis(G._0.X,-Math.PI/2);case 4:return i.PT.Identity();case 5:return i.PT.RotationAxis(G._0.Y,Math.PI);case 2:return i.PT.RotationAxis(G._0.Y,Math.PI/2);case 3:return i.PT.RotationAxis(G._0.Y,-Math.PI/2)}}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function W(e,t){var n=0,r=0,o=!0,a=!1,s=void 0;try{for(var l,c=t.entries()[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var u,h=(u=l.value,function(e){if(Array.isArray(e))return e}(u)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(u,2)||function(e,t){if(e){if("string"==typeof e)return Y(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,t)}}(u,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=h[0],f=h[1];switch(f){case 0:n-=e/2/Math.pow(2,d+1),r-=e/2/Math.pow(2,d+1);break;case 1:n+=e/2/Math.pow(2,d+1),r-=e/2/Math.pow(2,d+1);break;case 2:n+=e/2/Math.pow(2,d+1),r+=e/2/Math.pow(2,d+1);break;case 3:n-=e/2/Math.pow(2,d+1),r+=e/2/Math.pow(2,d+1);break;default:throw Error("".concat(f," is not a valid index for a child of a quadtree node !"))}}}catch(e){a=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(a)throw s}}return new i.Pq(n,r,0)}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var q=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");z(this,"chunksToDelete",void 0),z(this,"newChunks",void 0),z(this,"resolved",!1),this.newChunks=e,this.chunksToDelete=n}return e=[{key:"resolve",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.chunksToDelete[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)r.value.dispose()}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.chunksToDelete.length=0,this.newChunks.length=0,this.resolved=!0}},{key:"update",value:function(){this.isReadyToResolve()&&this.resolve(),this.resolveIfZombie()}},{key:"resolveIfZombie",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.newChunks[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)if(r.value.hasBeenDisposed())return void this.resolve()}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}},{key:"isReadyToResolve",value:function(){var e=this.newChunks.length;return this.newChunks.forEach(function(t){t.isLoaded()&&e--}),0===e}},{key:"isResolved",value:function(){return this.resolved}},{key:"dispose",value:function(){this.chunksToDelete.forEach(function(e){e.dispose()}),this.newChunks.forEach(function(e){e.dispose()}),this.chunksToDelete.length=0,this.newChunks.length=0}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();n(86189);var V=n(60333),J=n(76161),X=n(35743);function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Q=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");K(this,"parent",void 0),K(this,"instances",[]),K(this,"transforms",[]),K(this,"currentLod",null),K(this,"lods",[]),this.parent=e;for(var r=0;r<n.length;r+=16){var o=n.subarray(r,r+16),a=i.Pq.Zero(),s=i.PT.Zero(),l=i.Pq.Zero();(0,X.ck)(o,a,s,l),this.transforms.push({position:a,rotation:s,scaling:l})}}return e=[{key:"clearInstances",value:function(){if(null!==this.currentLod){var e=!0,t=!1,n=void 0;try{for(var r,o=this.instances[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)r.value.dispose()}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.currentLod=null}}},{key:"createInstances",value:function(e){this.clearInstances(),this.lods.length=0;var t=!0,n=!1,r=void 0;try{for(var o,i=e[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;this.lods.push(a)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}var s=this.lods.at(0);if(void 0===s)throw Error("No lod mesh was set.");this.currentLod={mesh:s.mesh,lodIndex:0},this.sendToGPU()}},{key:"sendToGPU",value:function(){if(null===this.currentLod)throw Error("Tried to send matrix buffer to GPU but no base mesh was set.");var e=!0,t=!1,n=void 0;try{for(var r,o=this.transforms[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value,a=this.currentLod.mesh.createInstance("instance".concat(this.instances.length));a.position.copyFrom(i.position.add(this.currentLod.mesh.position)),a.rotationQuaternion=i.rotation,a.scaling.copyFrom(i.scaling),this.instances.push(a),a.parent=this.parent,a.checkCollisions=this.currentLod.mesh.checkCollisions}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}},{key:"setEnabled",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.instances[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)o.value.setEnabled(e)}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"isEnabled",value:function(){var e=this.instances[0];return void 0!==e&&e.isEnabled()}},{key:"handleLod",value:function(e){if(0===this.lods.length)throw Error("No lod meshes were set.");if(null===this.currentLod)throw Error("No lod mesh was set.");var t=!0,n=!1,r=void 0;try{for(var o,i=Array.from(this.lods.entries()).reverse()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a,s=(a=o.value,function(e){if(Array.isArray(e))return e}(a)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(a,2)||function(e,t){if(e){if("string"==typeof e)return Z(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(e,t)}}(a,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=s[0],c=s[1];if(e>c.distance){if(l===this.currentLod.lodIndex)break;this.clearInstances(),this.currentLod={mesh:c.mesh,lodIndex:l},this.sendToGPU();break}}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"getCurrentMesh",value:function(){if(null===this.currentLod)throw Error("Tried to get base mesh but no base mesh was set.");return this.currentLod.mesh}},{key:"getLodMeshes",value:function(){return this.lods.map(function(e){return e.mesh})}},{key:"getNbInstances",value:function(){return this.instances.length}},{key:"dispose",value:function(){this.clearInstances(),this.lods.length=0}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),$=n(98968);function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var et=function(){var e;function t(e,n,r,o,i,a,s){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");ee(this,"mesh",void 0),ee(this,"depth",void 0),ee(this,"cubePosition",void 0),ee(this,"planetLocalPosition",void 0),ee(this,"planetModel",void 0),ee(this,"chunkSideLength",void 0),ee(this,"loaded",!1),ee(this,"parent",void 0),ee(this,"instancePatches",[]),ee(this,"aggregate",null),ee(this,"averageHeight",0),ee(this,"helpers",[]),ee(this,"disposed",!1);var l="D".concat(n,"P").concat(e.join(""));this.depth=e.length,this.chunkSideLength=a/Math.pow(2,this.depth),this.planetModel=i,this.mesh=new V.e("".concat(i.name,"_Chunk").concat(l),s),this.mesh.setEnabled(!1),this.mesh.material=o,this.mesh.parent=r.transformNode,this.parent=r.transformNode;var c=W(a,e);c.z-=a/2,c.applyRotationQuaternionInPlace(H(n)),this.cubePosition=c.clone(),c.normalize().scaleInPlace(a/2),this.planetLocalPosition=c.clone(),this.getTransform().position=c}return e=[{key:"getTransform",value:function(){return this.mesh}},{key:"init",value:function(e,t,n,r,o){if(this.hasBeenDisposed())throw Error("Tried to init ".concat(this.mesh.name," but it has been disposed"));if(e.applyToMesh(this.mesh,!1),this.mesh.freezeNormals(),this.depth>3&&(this.aggregate=new l.L(this.mesh,s.DK.MESH,{mass:0},this.mesh.getScene()),this.aggregate.body.setMotionType(s.AH.STATIC),this.aggregate.body.disablePreStep=!1,this.aggregate.shape.filterMembershipMask=w.H.ENVIRONMENT,this.aggregate.shape.filterCollideMask=w.H.DYNAMIC_OBJECTS),this.mesh.setEnabled(!0),this.loaded=!0,this.averageHeight=r,0!==t.length){var i=new Q(this.parent,(0,X._I)(n,3200));if(i.createInstances([{mesh:o.objects.rock,distance:0}]),this.instancePatches.push(i),null!==this.planetModel.atmosphere&&null!==this.planetModel.ocean&&this.getAverageHeight()>this.planetModel.ocean.depth+50){var a=new Q(this.parent,(0,X._I)(t,4800));a.createInstances([{mesh:o.objects.tree,distance:0}]),this.instancePatches.push(a);var c=new $.l((0,X._I)(t,800));c.createInstances([{mesh:o.objects.butterfly,distance:0}]),this.instancePatches.push(c);var u=new $.l(n);u.createInstances([{mesh:o.objects.grassBlades[0],distance:0},{mesh:o.objects.grassBlades[1],distance:50}]),this.instancePatches.push(u),o.materials.grass.setPlanet(this.parent),o.materials.grassDepth.setPlanet(this.parent),o.materials.butterfly.setPlanet(this.parent),o.materials.butterflyDepth.setPlanet(this.parent);var h=!0,d=!1,f=void 0;try{for(var p,m=Object.values(this.getTransform().getScene()._depthRenderer)[Symbol.iterator]();!(h=(p=m.next()).done);h=!0){var v=p.value;v.setMaterialForRendering(c.getLodMeshes(),o.materials.butterflyDepth),v.setMaterialForRendering(u.getLodMeshes(),o.materials.grassDepth)}}catch(e){d=!0,f=e}finally{try{h||null==m.return||m.return()}finally{if(d)throw f}}}}}},{key:"updatePosition",value:function(){null!==this.aggregate&&this.getTransform().setAbsolutePosition(i.Pq.TransformCoordinates(this.planetLocalPosition,this.parent.getWorldMatrix()))}},{key:"getAverageHeight",value:function(){return this.averageHeight}},{key:"getBoundingRadius",value:function(){return this.chunkSideLength/2}},{key:"isLoaded",value:function(){return this.loaded}},{key:"hasBeenDisposed",value:function(){return this.disposed}},{key:"dispose",value:function(){var e;null==(e=this.aggregate)||e.dispose(),this.helpers.forEach(function(e){e.dispose()}),this.helpers.length=0,this.instancePatches.forEach(function(e){e.dispose()}),this.instancePatches.length=0,this.mesh.dispose(),this.disposed=!0}},{key:"computeCulling",value:function(e){var t=this;if(this.isLoaded()){var n=e.globalPosition.subtract(this.getTransform().getAbsolutePosition()).normalize(),r=this.getTransform().getAbsolutePosition().add(n.scale(this.getBoundingRadius())).subtract(this.parent.getAbsolutePosition()).normalizeToNew(),o=e.globalPosition.subtract(this.parent.getAbsolutePosition()).normalizeToNew(),a=i.Pq.Dot(o,r)>=0&&(0,J.h)(this,e,4e-4);this.mesh.setEnabled(a),this.instancePatches.forEach(function(n){var r=Number.MAX_VALUE,o=e.globalPosition.subtract(t.getTransform().getAbsolutePosition()),i=t.getTransform().getAbsolutePosition().subtract(t.parent.getAbsolutePosition()).normalizeToNew(),a=i.scale(o.dot(i)),s=o.subtract(a).length();r=Math.min(r,s),n.setEnabled(s<200),n.handleLod(r)})}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),en=n(49447);function er(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eo(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}var ei=function(){var e;function t(e,n,r,o,i){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");er(this,"minDepth",void 0),er(this,"maxDepth",void 0),er(this,"tree",[]),er(this,"rootChunkLength",void 0),er(this,"direction",void 0),er(this,"scene",void 0),er(this,"deleteSemaphores",[]),er(this,"planetModel",void 0),er(this,"planetName",void 0),er(this,"planetSeed",void 0),er(this,"terrainSettings",void 0),er(this,"parent",void 0),er(this,"parentAggregate",void 0),er(this,"material",void 0),this.rootChunkLength=2*n.radius,this.planetName=n.name,this.planetSeed=n.seed,this.terrainSettings=n.terrainSettings,this.planetModel=n,this.minDepth=0,this.maxDepth=Math.ceil(Math.log2(this.rootChunkLength/(w.w.MIN_DISTANCE_BETWEEN_VERTICES*w.w.VERTEX_RESOLUTION))),this.scene=i,this.direction=e,this.parent=r.transformNode,this.parentAggregate=r,this.material=o}return e=[{key:"executeOnEveryChunk",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.tree,n=!0,r=!1,o=void 0;if(eo(t,et))e(t);else try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;this.executeOnEveryChunk(e,s)}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"requestDeletion",value:function(e,t){var n=this.getChunkList(e);this.deleteSemaphores.push(new q(t,n))}},{key:"getChunkList",value:function(e){var t=[];return this.executeOnEveryChunk(function(e){return t.push(e)},e),t}},{key:"update",value:function(e,t){this.deleteSemaphores.forEach(function(e){e.update()}),this.deleteSemaphores=this.deleteSemaphores.filter(function(e){return!e.isResolved()}),this.tree=this.updateLODRecursively(e,t),this.executeOnEveryChunk(function(e){e.updatePosition()})}},{key:"updateLODRecursively",value:function(e,t){var n,r,o,a,s,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.tree,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(c.length===this.maxDepth)return l;var u=(n=this.direction,r=this.rootChunkLength/2,o=(0,F.hQ)(this.parent),(a=W(2*r,c)).addInPlace(new i.Pq(0,0,-r)),s=H(n),a.applyRotationQuaternionInPlace(s),a.normalize().scaleInPlace(r),a.applyRotationQuaternionInPlace(o),a).normalizeToNew(),h=e.subtract(this.parent.getAbsolutePosition()).normalize(),d=this.planetModel.radius+(this.planetModel.terrainSettings.max_mountain_height+this.planetModel.terrainSettings.continent_base_height+this.planetModel.terrainSettings.max_bump_height)*.5,f=e.subtract(this.parent.getAbsolutePosition()).length(),p=Math.max(0,Math.acos(i.Pq.Dot(u,h))-8*(this.rootChunkLength/Math.pow(2,c.length))/(2*Math.PI*this.planetModel.radius)),m=Math.max(0,f-d)/this.planetModel.radius,v=this.maxDepth;v-=.8*Math.log2(1+p*Math.pow(2,this.maxDepth-this.minDepth)),v-=.8*Math.log2(1+m*Math.pow(2,this.maxDepth-this.minDepth));var y=(0,U.qE)(Math.floor(v),this.minDepth,this.maxDepth);if(eo(l,et)&&y>c.length){if(!l.isLoaded()||!l.mesh.isVisible||!l.mesh.isEnabled())return l;var g=[this.createChunk(c.concat([0]),t),this.createChunk(c.concat([1]),t),this.createChunk(c.concat([2]),t),this.createChunk(c.concat([3]),t)];return this.requestDeletion(l,g),g}if(eo(l,Array)){if(y<=c.length){var b=this.createChunk(c,t);return this.requestDeletion(l,[b]),b}return[this.updateLODRecursively(e,t,l[0],c.concat([0])),this.updateLODRecursively(e,t,l[1],c.concat([1])),this.updateLODRecursively(e,t,l[2],c.concat([2])),this.updateLODRecursively(e,t,l[3],c.concat([3]))]}return l}},{key:"createChunk",value:function(e,t){var n=new et(e,this.direction,this.parentAggregate,this.material,this.planetModel,this.rootChunkLength,this.scene),r={type:en.w.BUILD,planetName:this.planetName,planetSeed:this.planetSeed,planetDiameter:this.rootChunkLength,terrainSettings:this.terrainSettings,position:n.cubePosition,depth:e.length,direction:this.direction,chunk:n};return t.addTask(r),n}},{key:"computeCulling",value:function(e){this.executeOnEveryChunk(function(t){t.computeCulling(e)})}},{key:"dispose",value:function(){this.executeOnEveryChunk(function(e){e.dispose()}),this.tree=[],this.deleteSemaphores.forEach(function(e){e.dispose()}),this.deleteSemaphores.length=0}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function ea(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var es=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");ea(this,"model",void 0),ea(this,"type",void 0),ea(this,"sides",void 0),ea(this,"material",void 0),ea(this,"transform",void 0),ea(this,"aggregate",void 0),ea(this,"atmosphereUniforms",void 0),ea(this,"oceanUniforms",void 0),ea(this,"ringsUniforms",void 0),ea(this,"asteroidField",void 0),ea(this,"cloudsUniforms",void 0),ea(this,"targetInfo",void 0),this.model=e,this.type=e.type,this.transform=new a.VR0(this.model.name,r),this.transform.rotationQuaternion=i.PT.Identity(),this.aggregate=new l.L(this.getTransform(),s.DK.CONTAINER,{mass:0,restitution:.2},r),this.aggregate.body.setMassProperties({inertia:i.Pq.Zero(),mass:0}),this.aggregate.body.disablePreStep=!1;var o=new c.Ei(i.Pq.Zero(),this.model.radius,r);if(this.aggregate.shape.addChildFromParent(this.getTransform(),o,this.getTransform()),null!==this.model.atmosphere){var h=w.w.EARTH_ATMOSPHERE_THICKNESS*Math.max(1,this.model.radius/w.w.EARTH_RADIUS);this.atmosphereUniforms=new d.Q(this.getBoundingRadius(),h)}else this.atmosphereUniforms=null;null!==this.model.ocean?this.oceanUniforms=new y(this.getRadius(),this.model.ocean.depth):this.oceanUniforms=null,this.model.type===u.T.TELLURIC_PLANET&&null!==this.model.rings?(this.ringsUniforms=g.zl.New(this.model.rings,n.textures,w.w.RINGS_FADE_OUT_DISTANCE,r),this.asteroidField=new S.U(this.model.seed,this.getTransform(),this.model.rings.innerRadius,this.model.rings.outerRadius,r)):(this.ringsUniforms=null,this.asteroidField=null),null!==this.model.clouds?this.cloudsUniforms=new f.Kn(this.model.clouds,n.textures.pools.cloudsLut,r):this.cloudsUniforms=null,this.material=new j(this.model,n.textures.terrains,n.textures.pools.telluricPlanetMaterialLut,r),this.sides=[new ei(B.UP,this.model,this.aggregate,this.material,r),new ei(B.DOWN,this.model,this.aggregate,this.material,r),new ei(B.FORWARD,this.model,this.aggregate,this.material,r),new ei(B.BACKWARD,this.model,this.aggregate,this.material,r),new ei(B.RIGHT,this.model,this.aggregate,this.material,r),new ei(B.LEFT,this.model,this.aggregate,this.material,r)],this.targetInfo=(0,b.v)(this.getBoundingRadius()),this.targetInfo.maxDistance=this.model.type===u.T.TELLURIC_SATELLITE?8*this.model.orbit.semiMajorAxis:0}return e=[{key:"getTransform",value:function(){return this.transform}},{key:"getCloudsUniforms",value:function(){return this.cloudsUniforms}},{key:"getTypeName",value:function(){return(0,h.d)(this.model)}},{key:"updateLOD",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var i,a=this.sides[Symbol.iterator]();!(n=(i=a.next()).done);n=!0)i.value.update(e,t)}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"updateMaterial",value:function(e){this.material.update(this.getTransform().getWorldMatrix(),e)}},{key:"getRadius",value:function(){return this.model.radius}},{key:"getBoundingRadius",value:function(){var e,t;return this.getRadius()+(null!=(t=null==(e=this.model.ocean)?void 0:e.depth)?t:0)}},{key:"computeCulling",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.sides[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)o.value.computeCulling(e)}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"dispose",value:function(e,t){var n,r,o;this.sides.forEach(function(e){e.dispose()}),this.sides.length=0,null==(n=this.cloudsUniforms)||n.dispose(t),null==(r=this.ringsUniforms)||r.dispose(e),this.material.dispose(),this.aggregate.dispose(),this.transform.dispose(),null==(o=this.asteroidField)||o.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},37736:function(e,t,n){"use strict";n.d(t,{u:()=>u});var r=n(49917),o=n(49447),i=n(45321);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){var e;function t(e,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");a(this,"availableWorkers",[]),a(this,"busyWorkers",[]),a(this,"finishedWorkers",[]),a(this,"taskQueue",void 0),this.taskQueue=new i.M(r);for(var o=0;o<e;o++){var s=new Worker(new URL(n.p+n.u("9210"),n.b),Object.assign({},{type:"module"},{type:void 0}));this.availableWorkers.push(s)}}return e=[{key:"submitTask",value:function(e){this.taskQueue.push(e)}},{key:"hasTask",value:function(){return this.taskQueue.size()>0}},{key:"nextTask",value:function(){if(this.hasTask())return this.taskQueue.pop();throw Error("The workerpool has no task to dispatch")}},{key:"reset",value:function(){this.busyWorkers.forEach(function(e){e.terminate()}),this.availableWorkers=this.availableWorkers.concat(this.finishedWorkers).concat(this.busyWorkers),this.finishedWorkers=[],this.busyWorkers=[],this.availableWorkers.forEach(function(e){return e.onmessage=null}),this.taskQueue.clear()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");c(this,"nbVerticesPerRow",void 0),c(this,"workerPool",void 0),c(this,"applyTaskQueue",[]),this.nbVerticesPerRow=e;var n=navigator.hardwareConcurrency-1;this.workerPool=new s(n,function(e,t){return e.depth<t.depth})}return e=[{key:"addTask",value:function(e){this.workerPool.submitTask(e)}},{key:"executeNextTask",value:function(e){this.workerPool.hasTask()?this.dispatchBuildTask(this.workerPool.nextTask(),e):this.workerPool.finishedWorkers.push(e)}},{key:"dispatchBuildTask",value:function(e,t){var n=this;this.workerPool.busyWorkers.push(t);var i={taskType:o.w.BUILD,planetName:e.planetName,planetDiameter:e.planetDiameter,nbVerticesPerSide:this.nbVerticesPerRow,depth:e.depth,direction:e.direction,position:[e.position.x,e.position.y,e.position.z],terrainSettings:{continents_frequency:e.terrainSettings.continents_frequency,continents_fragmentation:e.terrainSettings.continents_fragmentation,continent_base_height:e.terrainSettings.continent_base_height,max_mountain_height:e.terrainSettings.max_mountain_height,max_bump_height:e.terrainSettings.max_bump_height,bumps_frequency:e.terrainSettings.bumps_frequency,mountains_frequency:e.terrainSettings.mountains_frequency},seed:e.planetSeed};t.postMessage(i),t.onmessage=function(i){var a=o.S.safeParse(i.data);if(a.success){var s=a.data,l=new r.P;l.positions=s.positions,l.normals=s.normals,l.indices=s.indices;var c={type:o.w.APPLY,vertexData:l,chunk:e.chunk,instancesMatrixBuffer:s.instancesMatrixBuffer,alignedInstancesMatrixBuffer:s.alignedInstancesMatrixBuffer,averageHeight:s.averageHeight};n.applyTaskQueue.push(c)}n.workerPool.hasTask()?n.dispatchBuildTask(n.workerPool.nextTask(),t):(n.workerPool.busyWorkers=n.workerPool.busyWorkers.filter(function(e){return e!==t}),n.workerPool.finishedWorkers.push(t))}}},{key:"executeNextApplyTask",value:function(e){for(var t=this.applyTaskQueue.shift();void 0!==t&&t.chunk.hasBeenDisposed();)t=this.applyTaskQueue.shift();t&&t.chunk.init(t.vertexData,t.instancesMatrixBuffer,t.alignedInstancesMatrixBuffer,t.averageHeight,e)}},{key:"update",value:function(e){for((t=this.workerPool.availableWorkers).push.apply(t,function(e){if(Array.isArray(e))return l(e)}(n=this.workerPool.finishedWorkers)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return l(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),this.workerPool.finishedWorkers=[];this.workerPool.availableWorkers.length>0;){var t,n,r=this.workerPool.availableWorkers.shift();if(void 0===r)break;this.executeNextTask(r)}this.executeNextApplyTask(e)}},{key:"reset",value:function(){this.applyTaskQueue.length=0,this.workerPool.reset()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},49447:function(e,t,n){"use strict";n.d(t,{S:()=>a,w:()=>i});var r,o=n(87829),i=((r={})[r.BUILD=0]="BUILD",r[r.APPLY=1]="APPLY",r),a=o.Ik({positions:o.Nl(Float32Array),normals:o.Nl(Float32Array),indices:o.Nl(Uint16Array),instancesMatrixBuffer:o.Nl(Float32Array),alignedInstancesMatrixBuffer:o.Nl(Float32Array),averageHeight:o.ai()})},98968:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{l:()=>i}),n(74793);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"matrixBuffer",void 0),o(this,"currentLod",null),o(this,"lods",[]),this.matrixBuffer=e}return e=[{key:"clearInstances",value:function(){null!==this.currentLod&&(this.currentLod.mesh.thinInstanceCount=0,this.currentLod=null)}},{key:"createInstances",value:function(e){this.clearInstances(),this.lods.length=0;var t=!0,n=!1,r=void 0;try{for(var o,i=e[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value,s=a.mesh.clone();s.makeGeometryUnique(),s.isVisible=!0,s.alwaysSelectAsActiveMesh=!0,this.lods.push({mesh:s,distance:a.distance})}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}var l=this.lods.at(0);if(void 0===l)throw Error("No lod mesh was set.");this.currentLod={mesh:l.mesh,lodIndex:0},this.sendToGPU()}},{key:"sendToGPU",value:function(){if(null===this.currentLod)throw Error("Tried to send matrix buffer to GPU but no base mesh was set.");this.currentLod.mesh.thinInstanceSetBuffer("matrix",this.matrixBuffer,16,!1)}},{key:"getNbInstances",value:function(){return null===this.currentLod?0:this.currentLod.mesh.thinInstanceCount}},{key:"setEnabled",value:function(e){null!==this.currentLod&&this.currentLod.mesh.setEnabled(e)}},{key:"isEnabled",value:function(){return null!==this.currentLod&&this.currentLod.mesh.isEnabled()}},{key:"handleLod",value:function(e){if(0===this.lods.length)throw Error("No lod meshes were set.");if(null===this.currentLod)throw Error("No lod mesh was set.");var t=!0,n=!1,o=void 0;try{for(var i,a=Array.from(this.lods.entries()).reverse()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s,l=(s=i.value,function(e){if(Array.isArray(e))return e}(s)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(s,2)||function(e,t){if(e){if("string"==typeof e)return r(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}(s,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=l[0],u=l[1];if(e>u.distance){if(c===this.currentLod.lodIndex)break;this.clearInstances(),this.currentLod={mesh:u.mesh,lodIndex:c},this.sendToGPU();break}}}catch(e){n=!0,o=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}}},{key:"getCurrentMesh",value:function(){if(null===this.currentLod)throw Error("Tried to get base mesh but no base mesh was set.");return this.currentLod.mesh}},{key:"getLodMeshes",value:function(){return this.lods.map(function(e){return e.mesh})}},{key:"dispose",value:function(){this.clearInstances(),this.lods.forEach(function(e){e.mesh.dispose()}),this.lods.length=0}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},3032:function(e,t,n){"use strict";n.d(t,{y:()=>c});var r=n(35939),o=n(92771),i=n(36801),a=n(90718),s=n(80878);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){var e;function t(e,n,c){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");l(this,"mesh",void 0),l(this,"material",void 0),l(this,"texture",void 0),l(this,"clonedTexture",void 0),s.m.MIN_RENDERINGGROUPS=Math.min(-1,s.m.MIN_RENDERINGGROUPS),c.environmentTexture=e,this.mesh=a.P.CreateBox("skybox",{size:n},c),this.mesh.renderingGroupId=-1,this.texture=e,this.texture.setReflectionTextureMatrix(i.uq.Identity()),this.clonedTexture=this.texture.clone(),this.clonedTexture.coordinatesMode=o.g.SKYBOX_MODE;var u=new r.s("skyboxMat",c);u.reflectionTexture=this.clonedTexture,u.backFaceCulling=!1,u.disableDepthWrite=!0,this.material=u,this.mesh.material=this.material,this.mesh.isPickable=!1,this.mesh.ignoreCameraMaxZ=!0,this.mesh.infiniteDistance=!0}return e=[{key:"setRotationMatrix",value:function(e){this.texture.setReflectionTextureMatrix(e),this.clonedTexture.setReflectionTextureMatrix(e)}},{key:"getTransform",value:function(){return this.mesh}},{key:"dispose",value:function(){this.material.dispose(),this.getTransform().dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},77504:function(e,t,n){"use strict";n.d(t,{k:()=>T});var r=n(74334),o=n(36801),i=n(61741),a=n(53843),s=n(9323),l=n(84830),c=n(92766),u=n(59008),h=n(78921),d=n(56367),f=n(13679),p=n(96824),m=n(3032);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function w(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return v(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var T=function(){var e,t;function n(e,t,i,a){var s=this;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");b(this,"scene",void 0),b(this,"starFieldBox",void 0),b(this,"referencePlaneRotation",r.uq.Identity()),b(this,"referencePosition",new o.Pq(0,0,0)),b(this,"model",void 0),b(this,"stellarObjects",void 0),b(this,"planets",[]),b(this,"satellites",[]),b(this,"anomalies",[]),b(this,"orbitalFacilities",[]),b(this,"objectToParents",new Map),b(this,"systemTargets",[]),b(this,"elapsedSeconds",0),b(this,"assets",void 0),this.scene=a,this.starFieldBox=new m.y(i.textures.environment.milkyWay,1e6,a),this.model=e,this.assets=i,this.stellarObjects=t.stellarObjects,this.planets=t.planets,this.satellites=t.satellites,this.anomalies=t.anomalies,this.orbitalFacilities=t.orbitalFacilities,this.getOrbitalObjects().forEach(function(e){s.objectToParents.set(e,s.getOrbitalObjects().filter(function(t){return e.model.orbit.parentIds.includes(t.model.id)}))})}return e=[{key:"getMostInfluentialObject",value:function(e){var t=this.getOrbitalObjects(),n=1/0,r=t[0];if(void 0===r)throw Error("There are no orbital objects in the solar system");var i=!0,a=!1,s=void 0;try{for(var l,c=t[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value,h=o.Pq.Distance(u.getTransform().position,e)/u.getBoundingRadius();h<n&&(n=h,r=u)}}catch(e){a=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}return r}},{key:"getNearestOrbitalObject",value:function(e){var t=this.getOrbitalObjects(),n=t[0];if(void 0===n)throw Error("There are no orbital objects in the solar system");var r=1/0,o=!0,i=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value,u=c.getTransform().getAbsolutePosition().subtract(e).length()-c.getBoundingRadius();u<r&&(n=c,r=u)}}catch(e){i=!0,a=e}finally{try{o||null==l.return||l.return()}finally{if(i)throw a}}return n}},{key:"getOrbitalFacilities",value:function(){return this.orbitalFacilities}},{key:"getCelestialBodies",value:function(){return w(this.getStellarObjects()).concat(w(this.getPlanetaryMassObjects()),w(this.getAnomalies()))}},{key:"getStellarObjects",value:function(){return this.stellarObjects}},{key:"getOrbitalObjects",value:function(){return w(this.getCelestialBodies()).concat(w(this.getOrbitalFacilities()))}},{key:"getPlanets",value:function(){return this.planets}},{key:"getTelluricPlanets",value:function(){return this.getPlanets().filter(function(e){return S(e,p.R)})}},{key:"getPlanetaryMassObjects",value:function(){return w(this.getPlanets()).concat(w(this.satellites))}},{key:"getAnomalies",value:function(){return this.anomalies}},{key:"getNearestCelestialBody",value:function(e){var t=this.getCelestialBodies();if(0===t.length)throw Error("There are no bodies or spacestation in the solar system");var n=null,r=-1,o=!0,i=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value,u=c.getTransform().getAbsolutePosition().subtract(e).length()-c.getRadius();(null===n||u<r)&&(n=c,r=u)}}catch(e){i=!0,a=e}finally{try{o||null==l.return||l.return()}finally{if(i)throw a}}if(null===n)throw Error("There are no bodies in the solar system");return n}},{key:"initPositions",value:function(e,t){this.update(Date.now()/1e3,t);for(var n=0;n<e;n++)this.update(1/60,t)}},{key:"update",value:function(e,t){this.elapsedSeconds+=e;var n=this.scene.getActiveControls(),a=n.getTransform().getAbsolutePosition(),u=this.getCelestialBodies(),h=this.getOrbitalFacilities(),d=this.getOrbitalObjects(),f=this.getMostInfluentialObject(a),p=this.getNearestCelestialBody(a),m=p.ringsUniforms,v=o.Pq.Distance(f.getTransform().position,a),y=v<3*f.getBoundingRadius();if(f===p&&null!==m&&(y=y||v<m.model.outerRadius),y=y&&!S(f,c.a)){var g=(0,l.UT)(f,e),b=f.getTransform().up.clone();o.Pq.TransformNormalToRef(b,this.referencePlaneRotation.transpose(),b),r.uq.RotationAxis(b,-g).multiplyToRef(this.referencePlaneRotation,this.referencePlaneRotation),this.starFieldBox.setRotationMatrix(this.referencePlaneRotation.transpose())}else(0,l.d_)(f,this.referencePlaneRotation,this.elapsedSeconds);var w=f.getTransform().position.clone(),T=this.objectToParents.get(f);if(void 0===T)throw Error("Nearest object parents are not defined");var A=(0,l.Jp)(f,T,this.referencePlaneRotation,this.elapsedSeconds).subtract(w).negate(),P=!0,C=!1,I=void 0;try{for(var E,R=d[Symbol.iterator]();!(P=(E=R.next()).done);P=!0){var N=E.value;N!==f&&(0,s.Tl)(N.getTransform(),A)}}catch(e){C=!0,I=e}finally{try{P||null==R.return||R.return()}finally{if(C)throw I}}this.referencePosition.addInPlace(A);var O=!0,L=!1,x=void 0;try{for(var M,_=d[Symbol.iterator]();!(O=(M=_.next()).done);O=!0){var k=M.value;if(k!==f){var D=this.objectToParents.get(k);if(void 0===D)throw Error("Parents of ".concat(k.model.name," are not defined"));(0,l.je)(k,D,this.referencePlaneRotation,this.elapsedSeconds),(0,l.d_)(k,this.referencePlaneRotation,this.elapsedSeconds)}}}catch(e){L=!0,x=e}finally{try{O||null==_.return||_.return()}finally{if(L)throw x}}var j=!0,F=!1,U=void 0;try{for(var G,B=this.systemTargets[Symbol.iterator]();!(j=(G=B.next()).done);j=!0)G.value.updatePosition(this.referencePlaneRotation,this.referencePosition)}catch(e){F=!0,U=e}finally{try{j||null==B.return||B.return()}finally{if(F)throw U}}n.update(e);var H=!0,Y=!1,W=void 0;try{for(var z,q,V=u[Symbol.iterator]();!(H=(q=V.next()).done);H=!0)null==(z=q.value.asteroidField)||z.update(n.getActiveCamera().globalPosition,this.assets.objects.asteroids,e)}catch(e){Y=!0,W=e}finally{try{H||null==V.return||V.return()}finally{if(Y)throw W}}var J=!0,X=!1,Z=void 0;try{for(var K,Q=this.getPlanetaryMassObjects()[Symbol.iterator]();!(J=(K=Q.next()).done);J=!0){var $=K.value;$.computeCulling(n.getActiveCamera()),($.type===i.T.TELLURIC_PLANET||$.type===i.T.TELLURIC_SATELLITE)&&$.updateLOD(n.getTransform().getAbsolutePosition(),t)}}catch(e){X=!0,Z=e}finally{try{J||null==Q.return||Q.return()}finally{if(X)throw Z}}var ee=n.getTransform().getAbsolutePosition(),et=!0,en=!1,er=void 0;try{for(var eo,ei=h[Symbol.iterator]();!(et=(eo=ei.next()).done);et=!0){var ea,es=eo.value,el=null!=(ea=this.objectToParents.get(es))?ea:[];es.update(el,ee,e),es.computeCulling(n.getActiveCamera())}}catch(e){en=!0,er=e}finally{try{et||null==ei.return||ei.return()}finally{if(en)throw er}}this.applyFloatingOrigin(),this.updateShaders(e)}},{key:"translateEverythingNow",value:function(e){var t=this.getOrbitalObjects(),n=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var l=i.value;(0,s.Tl)(l.getTransform(),e)}}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}this.referencePosition.addInPlace(e)}},{key:"applyFloatingOrigin",value:function(){var e=this.scene.getActiveControls();if(e.getTransform().getAbsolutePosition().length()>f.w.FLOATING_ORIGIN_THRESHOLD){var t=e.getTransform().getAbsolutePosition().negate();this.translateEverythingNow(t),null===e.getTransform().parent&&(0,s.Tl)(e.getTransform(),t)}}},{key:"updateShaders",value:function(e){var t=this.getStellarObjects(),n=this.getPlanetaryMassObjects(),r=!0,o=!1,i=void 0;try{for(var a,s,l=n[Symbol.iterator]();!(r=(s=l.next()).done);r=!0)s.value.updateMaterial(t.map(function(e){return e.getLight()}),e)}catch(e){o=!0,i=e}finally{try{r||null==l.return||l.return()}finally{if(o)throw i}}var c=!0,h=!1,d=void 0;try{for(var f,p=t[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var m=f.value;S(m,u.F)&&m.updateMaterial(e)}}catch(e){h=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(h)throw d}}null==(a=this.scene.activeCamera)||a.getViewMatrix(!0)}},{key:"addSystemTarget",value:function(e,t){var n=(0,a.tr)(t.getSystemGalacticPosition(this.model.coordinates)),r=(0,a.tr)(t.getSystemGalacticPosition(e)),i=(0,d.E1)(o.Pq.Distance(n,r)),s=r.subtract(n).normalize();o.Pq.TransformCoordinatesToRef(s,this.referencePlaneRotation,s);var l=t.getSystemModelFromCoordinates(e);if(null===l)return null;var c=new h.N(l,s.scale(i),this.scene);return this.systemTargets.push(c),c}},{key:"getSystemTargets",value:function(){return this.systemTargets}},{key:"getReferencePlaneRotation",value:function(){return this.referencePlaneRotation}},{key:"getOrbitalObjectById",value:function(e){return this.getOrbitalObjects().find(function(t){return t.model.id===e})}},{key:"dispose",value:function(){this.objectToParents.clear();var e=this.assets.textures.pools;this.orbitalFacilities.forEach(function(e){e.dispose()}),this.anomalies.forEach(function(e){e.dispose()}),this.satellites.forEach(function(t){t.dispose(e.ringsPatternLut,e.cloudsLut)}),this.planets.forEach(function(t){t.dispose(e.ringsPatternLut,e.cloudsLut)}),this.stellarObjects.forEach(function(t){t.dispose(e.ringsPatternLut)}),this.systemTargets.forEach(function(e){e.dispose()}),this.systemTargets.length=0,this.starFieldBox.dispose()}}],t=[{key:"CreateAsync",value:function(e,t,r,o){var i;return(i=function(){return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(i){switch(i.label){case 0:return[4,t.load(e,r,o)];case 1:return[2,new n(e,i.sent(),r,o)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=i.apply(e,t);function a(e){y(o,n,r,a,s,"next",e)}function s(e){y(o,n,r,a,s,"throw",e)}a(void 0)})})()}}],e&&g(n.prototype,e),t&&g(n,t),n}()},43732:function(e,t,n){"use strict";n.d(t,{$:()=>ea});var r=n(36801),o=n(61741),i=n(78629);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var s=n(61984),l=n(96824),c=n(92766),u=n(72262),h=n(59008),d=n(85303);function f(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function p(e){var t;return(t=function(){return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(t){return[2,new Promise(function(t){setTimeout(function(){t()},e)})]})},function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(e){f(i,r,o,a,s,"next",e)}function s(e){f(i,r,o,a,s,"throw",e)}a(void 0)})})()}var m=n(61012),v=n(95344),y=n(36044),g=n(90718),b=n(35543),S=n(60333),w=n(53024),T=n(78706),A=n(93035),P=n(40634),C=n(30723),I=n(1134);function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(N=function(){return!!e})()}var O=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n,o){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");i=t,a=[e,o],i=E(i),(s=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,N()?Reflect.construct(i,a||[],E(this).constructor):i.apply(this,a))).mode=P.A.Material;var i,a,s,l=I.$Z("position"),c=I.$Z("normal"),u=I.$Z("uv"),h=I.t6(new r.I9(2,10)),d=I.lK(u,h),f=I.Lz(),p=I.yG(f,l),m=I.wr(f,c),v=I.PW(),y=I.yG(v,p),g=I.b5(y),b=I.se(n.albedo,d,{convertToLinearSpace:!0}),S=I.se(n.metallicRoughness,d),w=I.se(n.ambientOcclusion,d),T=I.se(n.normal,d),A=I.u2(d,p,m,T.rgb,I.fV(1)),C=I.gs(),R=I.N1(),O=I.hG(b.rgb,S.r,S.g,w.r,A,m,C,R,p),L=I.rU(O);return s.addOutputNode(g),s.addOutputNode(L),s.build(),s}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&R(t,e),t}(C.M);function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x=function(){var e;function t(e,n,o,i){var a=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");L(this,"transform",void 0),L(this,"solarPanelMaterial",void 0),L(this,"metalSectionMaterial",void 0),L(this,"boundingRadius",void 0),L(this,"targetInfo",void 0),this.transform=new y.VR0("SpaceElevatorClimber",i),this.solarPanelMaterial=e,this.metalSectionMaterial=new A.u("SpaceElevatorClimberMetalSectionMaterial",o,i);for(var s=Math.PI/6,l=-Math.PI/2+s/2,c=Math.PI/2-s/2,u=[],h=l;h<=c;h+=(c-l)/64){var d=100*Math.cos(h),f=100*Math.sin(h);u.push(new r.Pq(d,0,f))}var p=(0,y.VX8)("ClimberRightRing",{path:u,cap:S.e.CAP_ALL,radius:10},i);p.scaling.y=.5,p.parent=this.transform,p.material=new O("ClimberRingMaterial",n,i),p.clone("ClimberLeftRing").rotate(b._0.Y,Math.PI);var m=(0,y.anF)("ClimberArm1",{height:200,width:1.25,depth:1.25},i);m.material=this.metalSectionMaterial,m.rotate(b._0.Z,Math.PI/2,b.$x.WORLD),m.parent=this.transform,[Math.PI/4,-Math.PI/4].forEach(function(e,t){var n=m.clone("ClimberArm".concat(t+2));n.rotate(b._0.Y,e,b.$x.WORLD),n.parent=a.transform});var v=Math.PI/6,g=(0,y.anF)("ClimberSolarPanel1",{width:100,height:.1,depth:20},i);g.material=this.solarPanelMaterial,g.position.x=150,g.parent=this.transform,[v,-v,Math.PI+v,Math.PI-v,Math.PI].forEach(function(e,t){var n=g.clone("ClimberSolarPanel".concat(t+2));n.parent=a.transform,n.rotateAround(r.Pq.Zero(),b._0.Y,e)}),this.boundingRadius=200,this.targetInfo={type:w.L.FACILITY,minDistance:7*this.getBoundingRadius(),maxDistance:3e3*this.getBoundingRadius()}}return e=[{key:"getBoundingRadius",value:function(){return this.boundingRadius}},{key:"getTypeName",value:function(){return T.A.t("objectTypes:spaceElevatorClimber")}},{key:"getTransform",value:function(){return this.transform}},{key:"dispose",value:function(){this.solarPanelMaterial.dispose(),this.metalSectionMaterial.dispose(),this.transform.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),M=n(41397),_=n(25760),k=n(93132),D=n(65773),j=n(51216),F=n(17514),U=n(37427),G=n(76161),B=n(27460),H=n(9323),Y=n(89901),W=n(47759),z=n(32220),q=n(13298),V=n(97715),J=n(96839),X=n(96728),Z=n(13679);function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $(e,t){if(e){if("string"==typeof e)return K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return K(e,t)}}var ee=function(){var e;function t(e,n,i,a){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");Q(this,"name",void 0),Q(this,"model",void 0),Q(this,"type",o.T.SPACE_ELEVATOR),Q(this,"solarSections",[]),Q(this,"utilitySections",[]),Q(this,"helixHabitats",[]),Q(this,"ringHabitats",[]),Q(this,"cylinderHabitats",[]),Q(this,"landingBays",[]),Q(this,"tether",void 0),Q(this,"tetherLength",void 0),Q(this,"tetherMaterial",void 0),Q(this,"climber",void 0),Q(this,"root",void 0),Q(this,"scene",void 0),Q(this,"boundingRadius",void 0),Q(this,"elapsedSeconds",0),Q(this,"targetInfo",void 0),Q(this,"landingPadManager",void 0),this.model=e,this.name=this.model.name,this.root=new y.VR0(this.name,a),this.root.rotationQuaternion=r.PT.Identity(),this.scene=a,this.tetherLength=this.model.tetherLength,this.tether=g.P.CreateCylinder("".concat(this.name," Tether"),{height:this.tetherLength,diameter:10,tessellation:6},this.scene),this.tether.convertToFlatShadedMesh(),this.tetherMaterial=new A.u("TetherMaterial",i.textures.materials.metalPanels,a),this.tether.material=this.tetherMaterial,this.climber=new x(i.materials.solarPanel,i.textures.materials.crate,i.textures.materials.metalPanels,a),this.climber.getTransform().parent=this.tether,this.climber.getTransform().position.y=this.tetherLength/2,this.generate(n,i),this.landingPadManager=new Y.G(this.landingBays.flatMap(function(e){return e.landingPads}));var s=this.getTransform().getHierarchyBoundingVectors(),l=s.max.add(s.min).scale(.5),c=this.getTransform().getAbsolutePosition().subtract(l);this.tether.parent=this.getTransform(),this.getTransform().getChildTransformNodes(!0).forEach(function(e){return e.position.addInPlace(c)});var u=s.max.subtract(s.min).scale(.5);this.boundingRadius=Math.max(u.x,u.y,u.z),this.targetInfo={type:w.L.FACILITY,minDistance:6*this.getBoundingRadius(),maxDistance:0}}return e=[{key:"getLandingPadManager",value:function(){return this.landingPadManager}},{key:"getSubTargets",value:function(){var e;return[this.climber].concat(function(e){if(Array.isArray(e))return K(e)}(e=this.getLandingPadManager().getLandingPads())||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||$(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}},{key:"getBoundingRadius",value:function(){return this.boundingRadius}},{key:"getTypeName",value:function(){return(0,B.d)(this.model)}},{key:"computeCulling",value:function(e){this.getTransform().setEnabled((0,G.h)(this,e))}},{key:"generate",value:function(e,t){var n=this,r=0;e.forEach(function(e,t){r+=(0,V.ZP)(t.blackBodyTemperature,t.radius,e)});var o=(0,X.y)(this.model.solarPanelEfficiency,this.model.population*this.model.energyConsumptionPerCapitaKWh,r),i=100*this.model.population/this.model.populationDensity,a=0;this.model.agricultureMix.forEach(function(e){var t=function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,2)||$(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r=t[0],o=t[1],i=n.model.population*Z.w.INDIVIDUAL_AVERAGE_DAILY_INTAKE,s=Z.w.HYDROPONIC_TO_CONVENTIONAL_RATIO*n.model.nbHydroponicLayers*(0,W.Zw)(o);a+=r*i/s});var s=(i+a)*1e3,l=this.tether,c=(0,z.p)(this.model.seed);l=this.addUtilitySections(l,5+Math.floor(5*c(564)),c,t);var u=(0,J.MA)([[F.T.RING_HABITAT,.5],[F.T.HELIX_HABITAT,.3],[F.T.CYLINDER_HABITAT,.2]],c(17)),h=null;if(u===F.T.HELIX_HABITAT){var d=new _.i(s,Z.w.SEED_HALF_RANGE*c(19),t.textures,this.scene);this.helixHabitats.push(d),h=d.getTransform()}else if(u===F.T.RING_HABITAT){var f=new k.g(s,Z.w.SEED_HALF_RANGE*c(27),t.textures,this.scene);this.ringHabitats.push(f),h=f.getTransform()}else if(u===F.T.CYLINDER_HABITAT){var p=new M.U(s,Z.w.SEED_HALF_RANGE*c(13),t.textures,this.scene);this.cylinderHabitats.push(p),h=p.getTransform()}if(null===h)throw Error("Node creation failed");this.placeNode(h,l),h.parent=this.root,l=h,l=this.addUtilitySections(l,5+Math.floor(5*c(23)),c,t);var m=new j.d(o,Z.w.SEED_HALF_RANGE*c(31),t,this.scene);m.getTransform().parent=this.getTransform(),this.placeNode(m.getTransform(),l),l=m.getTransform(),this.solarSections.push(m),l=this.addUtilitySections(l,5+Math.floor(5*c(23)),c,t);var v=new D.K(this.model,c(37)*Z.w.SEED_HALF_RANGE,t,this.scene);this.landingBays.push(v),this.placeNode(v.getTransform(),l),v.getTransform().parent=this.getTransform()}},{key:"addUtilitySections",value:function(e,t,n,r){for(var o=e,i=0;i<t;i++){var a=new U.o(n(132+10*this.utilitySections.length)*Z.w.SEED_HALF_RANGE,r,this.scene);this.utilitySections.push(a),this.placeNode(a.getTransform(),o),a.getTransform().parent=this.getTransform(),o=a.getTransform()}return o}},{key:"placeNode",value:function(e,t){var n=t.getHierarchyBoundingVectors(),r=n.max.subtract(n.min).scale(.5),o=e.getHierarchyBoundingVectors(),i=o.max.subtract(o.min).scale(.5),a=r.y,s=i.y;e.position=t.position.add(t.up.scale(a+s))}},{key:"update",value:function(e,t,n){var r=e[0];if(void 0===r)throw Error("Space Elevator should have exactly one parent");var o=this.getTransform().position.subtract(r.getTransform().position).normalize();(0,H.Pf)(this.getTransform(),o),this.elapsedSeconds+=n,this.helixHabitats.forEach(function(e){e.update(t,n)}),this.ringHabitats.forEach(function(e){e.update(t,n)}),this.cylinderHabitats.forEach(function(e){e.update(t,n)}),this.landingBays.forEach(function(e){e.update(t,n)});var i=2*this.tetherLength/(300/3.6);this.climber.getTransform().position.y=(0,q.Ew)((0,q.qE)(1.05*(0,q.E1)(this.elapsedSeconds/i),0,1),0,1,-this.tetherLength/2,this.tetherLength/2)}},{key:"getTransform",value:function(){return this.root}},{key:"dispose",value:function(){this.solarSections.forEach(function(e){e.dispose()}),this.utilitySections.forEach(function(e){e.dispose()}),this.helixHabitats.forEach(function(e){e.dispose()}),this.ringHabitats.forEach(function(e){e.dispose()}),this.cylinderHabitats.forEach(function(e){e.dispose()}),this.landingBays.forEach(function(e){e.dispose()}),this.tether.dispose(),this.tetherMaterial.dispose(),this.climber.dispose(),this.root.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),et=n(86299);function en(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function er(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){en(i,r,o,a,s,"next",e)}function s(e){en(i,r,o,a,s,"throw",e)}a(void 0)})}}function eo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ei(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var ea=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");eo(this,"loadingIndex",void 0),eo(this,"maxLoadingIndex",void 0),eo(this,"offset",1e8),eo(this,"timeOut",160),this.loadingIndex=0,this.maxLoadingIndex=1}return e=[{key:"getLoadingProgress",value:function(){return this.loadingIndex/this.maxLoadingIndex}},{key:"load",value:function(e,t,n){return er(function(){var r,o,i,a,s,l;return ei(this,function(c){switch(c.label){case 0:return r=e.stellarObjects.length+e.planets.length+e.satellites.length+e.anomalies.length+e.orbitalFacilities.length,this.loadingIndex=0,this.maxLoadingIndex=r,[4,p(1e3)];case 1:return c.sent(),[4,this.loadStellarObjects(e.stellarObjects,t,n)];case 2:return o=c.sent(),[4,this.loadPlanets(e.planets,t,n)];case 3:return i=c.sent(),[4,this.loadSatellites(e.satellites,t,n)];case 4:return a=c.sent(),[4,this.loadAnomalies(e.anomalies,n)];case 5:return s=c.sent(),[4,this.loadOrbitalFacilities(e,t,n)];case 6:return l=c.sent(),[4,p(1e3)];case 7:return c.sent(),[2,{stellarObjects:o,planets:i,satellites:a,anomalies:s,orbitalFacilities:l}]}})}).call(this)}},{key:"loadStellarObjects",value:function(e,t,n){return er(function(){var i,a,s,l,f,m,v,y,g;return ei(this,function(b){switch(b.label){case 0:i=[],a=!0,s=!1,l=void 0,b.label=1;case 1:b.trys.push([1,6,7,8]),f=e[Symbol.iterator](),b.label=2;case 2:if(a=(m=f.next()).done)return[3,5];switch(console.log("Loading stellar object:",(v=m.value).name),y=void 0,v.type){case o.T.STAR:y=new h.F(v,t.textures,n);break;case o.T.BLACK_HOLE:y=new c.a(v,t.textures.environment.milkyWay,n);break;case o.T.NEUTRON_STAR:y=new u.G(v,t.textures,n)}return i.push(y),y.getTransform().setAbsolutePosition(new r.Pq(this.offset*++this.loadingIndex,0,0)),[4,p(this.timeOut)];case 3:b.sent(),b.label=4;case 4:return a=!0,[3,2];case 5:return[3,8];case 6:return g=b.sent(),s=!0,l=g,[3,8];case 7:try{a||null==f.return||f.return()}finally{if(s)throw l}return[7];case 8:if(!(0,d.EI)(i))throw Error("No stellar objects found in the star system");return[2,i]}})}).call(this)}},{key:"loadAnomalies",value:function(e,t){return er(function(){var n,i,a,s,l,c,u,h,d;return ei(this,function(f){switch(f.label){case 0:n=[],i=!0,a=!1,s=void 0,f.label=1;case 1:f.trys.push([1,6,7,8]),l=e[Symbol.iterator](),f.label=2;case 2:if(i=(c=l.next()).done)return[3,5];switch(console.log("Loading Anomaly:",(u=c.value).name),h=void 0,u.type){case o.T.MANDELBULB:case o.T.JULIA_SET:case o.T.MANDELBOX:case o.T.SIERPINSKI_PYRAMID:case o.T.MENGER_SPONGE:h=new v.i(u,t);break;case o.T.DARK_KNIGHT:h=new m.i(u,t)}return n.push(h),h.getTransform().setAbsolutePosition(new r.Pq(this.offset*++this.loadingIndex,0,0)),[4,p(this.timeOut)];case 3:f.sent(),f.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return d=f.sent(),a=!0,s=d,[3,8];case 7:try{i||null==l.return||l.return()}finally{if(a)throw s}return[7];case 8:return[2,n]}})}).call(this)}},{key:"loadOrbitalFacilities",value:function(e,t,n){return er(function(){var s,l,c,u,h,d,f,m,v,y;return ei(this,function(g){switch(g.label){case 0:s=[],l=!0,c=!1,u=void 0,g.label=1;case 1:g.trys.push([1,6,7,8]),h=e.orbitalFacilities[Symbol.iterator](),g.label=2;case 2:if(l=(d=h.next()).done)return[3,5];switch(m=function e(t,n){var r=new Map,s=!0,l=!1,c=void 0;try{for(var u,h=t.orbit.parentIds[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value,f=(0,i.B)(d,n);if(null!==f){if(f.type===o.T.STAR||f.type===o.T.NEUTRON_STAR||f.type===o.T.BLACK_HOLE){r.set(f,t.orbit.semiMajorAxis);continue}var p=e(f,n),m=!0,v=!1,y=void 0;try{for(var g,b=p[Symbol.iterator]();!(m=(g=b.next()).done);m=!0){var S,w=(S=g.value,function(e){if(Array.isArray(e))return e}(S)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(S,2)||function(e,t){if(e){if("string"==typeof e)return a(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(S,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),T=w[0],A=w[1];r.set(T,A)}}catch(e){v=!0,y=e}finally{try{m||null==b.return||b.return()}finally{if(v)throw y}}}}}catch(e){l=!0,c=e}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return r}(f=d.value,e),v=void 0,f.type){case o.T.SPACE_STATION:v=new et.x(f,m,t,n);break;case o.T.SPACE_ELEVATOR:v=new ee(f,m,t,n)}return s.push(v),v.getTransform().setAbsolutePosition(new r.Pq(this.offset*++this.loadingIndex,0,0)),[4,p(this.timeOut)];case 3:g.sent(),g.label=4;case 4:return l=!0,[3,2];case 5:return[3,8];case 6:return y=g.sent(),c=!0,u=y,[3,8];case 7:try{l||null==h.return||h.return()}finally{if(c)throw u}return[7];case 8:return[2,s]}})}).call(this)}},{key:"loadPlanets",value:function(e,t,n){return er(function(){var i,a,c,u,h,d,f,m,v;return ei(this,function(y){switch(y.label){case 0:i=[],a=!0,c=!1,u=void 0,y.label=1;case 1:y.trys.push([1,6,7,8]),h=e[Symbol.iterator](),y.label=2;case 2:if(a=(d=h.next()).done)return[3,5];switch(console.log("Loading planet",(f=d.value).name),m=void 0,f.type){case o.T.TELLURIC_PLANET:m=new l.R(f,t,n);break;case o.T.GAS_PLANET:m=new s.s(f,t.textures,t.textures.pools.ringsPatternLut,n)}return m.getTransform().setAbsolutePosition(new r.Pq(this.offset*++this.loadingIndex,0,0)),i.push(m),[4,p(this.timeOut)];case 3:y.sent(),y.label=4;case 4:return a=!0,[3,2];case 5:return[3,8];case 6:return v=y.sent(),c=!0,u=v,[3,8];case 7:try{a||null==h.return||h.return()}finally{if(c)throw u}return[7];case 8:return[2,i]}})}).call(this)}},{key:"loadSatellites",value:function(e,t,n){return er(function(){var o,i,a,s,c,u,h,d,f;return ei(this,function(m){switch(m.label){case 0:o=[],i=!0,a=!1,s=void 0,m.label=1;case 1:m.trys.push([1,6,7,8]),c=e[Symbol.iterator](),m.label=2;case 2:if(i=(u=c.next()).done)return[3,5];return console.log("Loading satellite:",(h=u.value).name),(d=new l.R(h,t,n)).getTransform().setAbsolutePosition(new r.Pq(this.offset*++this.loadingIndex,0,0)),o.push(d),[4,p(this.timeOut)];case 3:m.sent(),m.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return f=m.sent(),a=!0,s=f,[3,8];case 7:try{i||null==c.return||c.return()}finally{if(a)throw s}return[7];case 8:return[2,o]}})}).call(this)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},92766:function(e,t,n){"use strict";n.d(t,{a:()=>d});var r=n(5566),o=n(45782),i=n(36801),a=n(36044),s=n(61741),l=n(27460),c=n(53024),u=n(14351);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){var e;function t(e,n,l){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");h(this,"name",void 0),h(this,"transform",void 0),h(this,"light",void 0),h(this,"model",void 0),h(this,"type",s.T.BLACK_HOLE),h(this,"ringsUniforms",null),h(this,"asteroidField",null),h(this,"blackHoleUniforms",void 0),h(this,"targetInfo",void 0),this.model=e,this.name=this.model.name,this.transform=new a.VR0(this.model.name,l),this.transform.rotationQuaternion=i.PT.Identity(),this.light=new o.H("".concat(this.model.name,"Light"),i.Pq.Zero(),l),this.light.falloffType=r.v.FALLOFF_STANDARD,this.light.parent=this.getTransform(),0===this.model.accretionDiskRadius&&(this.light.intensity=0),this.blackHoleUniforms=new u.PW(this.model,n),this.targetInfo=(0,c.v)(this.getBoundingRadius())}return e=[{key:"getTransform",value:function(){return this.transform}},{key:"getLight",value:function(){return this.light}},{key:"getTypeName",value:function(){return(0,l.d)(this.model)}},{key:"getRadius",value:function(){return this.model.radius}},{key:"getBoundingRadius",value:function(){return this.getRadius()}},{key:"dispose",value:function(){this.light.dispose(),this.transform.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},95574:function(e,t,n){"use strict";n.d(t,{$:()=>y});var r=n(47347),o=n(78930),i=n(92771),a=n(62325),s=n(77621),l=n(54205),c=n(56754),u=n(14351);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}var y=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,a){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var h,p,y,g="blackhole";void 0===o.M.ShadersStore["".concat(g,"FragmentShader")]&&(o.M.ShadersStore["".concat(g,"FragmentShader")]="precision highp float;\n\n#define DISABLE_UNIFORMITY_ANALYSIS\n\n// based on https://www.shadertoy.com/view/tsBXW3\n\n#define DISK_STEPS 12.0//disk texture layers\n\nvarying vec2 vUV;\n\nuniform float time;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3 object_position;\nuniform float object_radius;\nuniform vec3 object_rotationAxis;\nuniform float object_scaling_determinant;\n\nuniform float accretionDiskRadius;\nuniform float rotationPeriod;\nuniform float warpingMinkowskiFactor;\n\nuniform float schwarzschildRadius;\nuniform float frameDraggingFactor;\n\n//TODO: make these uniforms\nconst float accretionDiskHeight = 100.0;\nconst bool hasAccretionDisk = true;\n\nuniform sampler2D textureSampler;\nuniform sampler2D depthSampler;\n\nuniform samplerCube starfieldTexture;\n\nuniform mat4 starfieldRotation;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nuniform vec3  camera_position;\nuniform mat4  camera_projection;\nuniform mat4  camera_view;\nuniform mat4  camera_inverseProjection;\nuniform mat4  camera_inverseView;\nuniform float camera_near;\nuniform float camera_far;\nuniform float camera_fov;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// remap a value comprised between low1 and high1 to a value between low2 and high2\nfloat remap(float value, float low1, float high1, float low2, float high2) {\n    return low2 + (value - low1) * (high2 - low2) / (high1 - low1);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// compute the world position of a pixel from its uv coordinates\n// This is an evolution from the code found here\n// https://forum.babylonjs.com/t/pixel-position-in-world-space-from-fragment-postprocess-shader-issue/30232\n// also see https://www.babylonjs-playground.com/#1PHYB0#318 for smaller scale testing\n// This is a revised version that works with the reverse depth buffer\nvec3 worldFromUV(vec2 pos, mat4 inverseProjection, mat4 inverseView) {\n    vec4 ndc = vec4(pos.xy * 2.0 - 1.0, 1.0, 1.0); // get ndc position (z = 1 because the depth buffer is reversed)\n    vec4 posVS = inverseProjection * ndc; // unproject the ndc coordinates : we are now in view space if i understand correctly\n    vec4 posWS = inverseView * posVS; // then we use inverse view to get to world space, division by w to get actual coordinates\n    return  posWS.xyz / posWS.w;\n}\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nvec2 uvFromWorld(vec3 pos, mat4 projection, mat4 view) {\n    vec4 uvRaw = projection * view * vec4(pos, 1.0);\n    vec2 uv = uvRaw.xy / uvRaw.w;\n    uv = (uv + 1.0) / 2.0;\n    return uv;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// rotation using https://www.wikiwand.com/en/Rodrigues%27_rotation_formula\nvec3 rotateAround(vec3 vector, vec3 axis, float theta) {\n    // Please note that unit vector are required, i did not divided by the norms\n    return cos(theta) * vector + cross(axis, vector) * sin(theta) + axis * dot(axis, vector) * (1.0 - cos(theta));\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// A narrower version of line intersect sphere. It will return true only when the intersection is at a positive distance from the ray origin.\nbool rayIntersectSphere(vec3 rayOrigin, vec3 rayDir, vec3 spherePosition, float sphereRadius, out float t0, out float t1) {\n    vec3 relativeOrigin = rayOrigin - spherePosition;// rayOrigin in sphere space\n\n    float a = 1.0;\n    float b = 2.0 * dot(relativeOrigin, rayDir);\n    float c = dot(relativeOrigin, relativeOrigin) - sphereRadius*sphereRadius;\n\n    float d = b*b - 4.0*a*c;\n\n    if (d < 0.0) return false;// no intersection\n\n    float s = sqrt(d);\n\n    float r0 = (-b - s) / (2.0*a);\n    float r1 = (-b + s) / (2.0*a);\n\n    t0 = min(r0, r1);\n    t1 = max(r0, r1);\n\n    //return true;\n    return t1 > 0.0;\n}\n\nvec3 projectOnPlane(vec3 vector, vec3 planeNormal) {\n    return vector - dot(vector, planeNormal) * planeNormal;\n}\n\nfloat angleBetweenVectors(vec3 a, vec3 b) {\n    // the clamping is necessary to prevent undefined values when acos(x) has |x| > 1\n    return acos(clamp(dot(normalize(a), normalize(b)), -1.0, 1.0));\n}\n\nfloat hash(float x) { return fract(sin(x) * 152754.742); }\nfloat hash(vec2 x) { return hash(x.x + hash(x.y)); }\n\nfloat valueNoise(vec2 p, float f) {\n    float bl = hash(floor(p*f + vec2(0.0, 0.0)));\n    float br = hash(floor(p*f + vec2(1.0, 0.0)));\n    float tl = hash(floor(p*f + vec2(0.0, 1.0)));\n    float tr = hash(floor(p*f + vec2(1.0, 1.0)));\n\n    vec2 fr = fract(p*f);\n    fr = (3. - 2.*fr)*fr*fr;\n    float b = mix(bl, br, fr.x);\n    float t = mix(tl, tr, fr.x);\n    return mix(b, t, fr.y);\n}\n\nvec4 raymarchDisk(vec3 rayDir, vec3 initialPosition) {\n    if (!hasAccretionDisk) return vec4(0.0);// no disk\n\n    vec3 samplePoint = initialPosition;\n    float distanceToCenter = length(samplePoint);// distance to the center of the disk\n    float relativeDistance = distanceToCenter / schwarzschildRadius;\n    float relativeDiskRadius = accretionDiskRadius / schwarzschildRadius;\n\n    vec3 diskNormal = object_rotationAxis;\n\n    vec3 projectedRayDir = projectOnPlane(rayDir, diskNormal);\n    vec3 projectedInitialPosition = projectOnPlane(initialPosition, diskNormal);\n\n    float projectionDistance = length(projectedRayDir - rayDir);// if the vector is parallel to the disk the the projection distance is near 0. We use it to increase the step size.\n\n    float stepSize = 0.02 * distanceToCenter / projectionDistance;//FIXME: this is not correct, but it works\n\n    samplePoint += stepSize * rayDir;//FIXME: somehow when I remove this line, the disk has no thickness\n\n    // elementary rotation around the hole\n    vec3 deltaPos = rotateAround(projectedInitialPosition, diskNormal, 0.01);\n    deltaPos = normalize(deltaPos - projectedInitialPosition);\n\n    float parallel = dot(projectedRayDir, deltaPos);\n\n    float redShift = (1.0 + parallel) / 2.0;\n\n    float diskMix = smoothstep(0.3, 0.9, relativeDistance / relativeDiskRadius); // transition between inner and outer color\n    vec3 innerDiskColor = vec3(1.0, 0.8, 0.1);\n    vec3 outerDiskColor = vec3(0.5, 0.13, 0.02) * 0.2;\n    vec3 insideCol =  mix(innerDiskColor, outerDiskColor, diskMix) * 1.25;\n\n    vec3 redShiftMult = mix(vec3(1.6, 1.0, 2.0) * 3.0, vec3(0.4, 0.2, 0.1) * 0.5, redShift);//FIXME: need more realistic redshift\n    insideCol *= redShiftMult;\n\n    vec4 diskColor = vec4(0.0);\n    for (float i = 0.0; i < DISK_STEPS; i++) {\n        samplePoint -= stepSize * rayDir / DISK_STEPS;\n\n        vec3 projectedSamplePoint = projectOnPlane(samplePoint, diskNormal);\n\n        float intensity = 1.0 - (i / DISK_STEPS);\n        distanceToCenter = length(samplePoint);\n        relativeDistance = distanceToCenter / schwarzschildRadius;\n\n        float diskMask = 1.0;\n        diskMask *= smoothstep(1.5, 2.5, relativeDistance); // Fade the disk when too close to the event horizon. 1.5 is the IBCO (innermost bound circular orbit) for a Schwarzschild black hole. It is also called the photon sphere.\n        diskMask *= clamp(1.0 - relativeDistance / relativeDiskRadius, 0.0, 1.0); //smoothstep(0.0, 1.0, relativeDiskRadius - relativeDistance);// The 2.0 is only for aesthetics\n\n        // rotation of the disk\n        float theta = -2.0 * 3.1415 * time / rotationPeriod;\n        vec3 rotatedProjectedSamplePoint = rotateAround(projectedSamplePoint, diskNormal, theta);\n\n        float angle = angleBetweenVectors(rotatedProjectedSamplePoint, vec3(0.0, 0.0, 1.0));\n        float u = 0.5 * time + intensity * 0.2 + 4.0 * relativeDistance;// some kind of disk coordinate (spiral)\n        const float noiseFrequency = 1.0;\n        vec2 noiseSamplePoint = vec2(angle * 2.0, u);\n        float noise = valueNoise(noiseSamplePoint, noiseFrequency); // 1st octave\n        noise = noise * 0.66 + 0.33 * valueNoise(noiseSamplePoint, noiseFrequency * 2.0); // 2nd octave\n        noise = pow(noise, 0.8);\n        noise = max(0.2, noise);\n\n        float alpha = diskMask * noise * intensity;\n\n        // blending with current color in the disk\n        diskColor = mix(diskColor, vec4(insideCol * intensity, 1.0), alpha);\n    }\n\n    return diskColor;\n}\n\n/**\n * Bends the light ray toward the black hole according to its distance\n * The bending is tweaked to reach 0 when far enough so that we can skip some calculations\n */\nvec3 bendRay(vec3 rayDir, vec3 blackholeDir, float distanceToCenter2, float maxBendDistance, float stepSize) {\n    float bendForce = schwarzschildRadius / distanceToCenter2; //bending force (physical)\n    bendForce -= schwarzschildRadius / (maxBendDistance * maxBendDistance); // bend force is 0 at maxBendDistance (non physical)\n    bendForce = stepSize * max(0.0, bendForce); // multiply by step size, and clamp negative values\n    return normalize(rayDir + bendForce * blackholeDir); //bend ray towards BH\n}\n\nfloat customLength(vec3 v) {\n    float p = warpingMinkowskiFactor;\n    return pow(pow(abs(v.x), p) + pow(abs(v.y), p) + pow(abs(v.z), p), 1.0 / p);\n}\n\nvoid main() {\n    vec4 screenColor = texture2D(textureSampler, vUV);// the current screen color\n\n    vec3 pixelWorldPosition = worldFromUV(vUV, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n    vec3 rayDir = normalize(pixelWorldPosition - camera_position);// normalized direction of the ray\n\n    float depth = texture2D(depthSampler, vUV).r;// the depth corresponding to the pixel in the depth map\n\n    // actual depth of the scene\n    float maximumDistance = length(pixelWorldPosition - camera_position) * remap(depth, 0.0, 1.0, camera_near, camera_far);\n\n    float maxBendDistance = max(accretionDiskRadius * 3.0, schwarzschildRadius * 15.0);\n\n    float t0, t1;\n    if(!rayIntersectSphere(camera_position, rayDir, object_position, maxBendDistance, t0, t1)) {\n        // the light ray will not be affected by the black hole, we can skip the calculations\n        gl_FragColor = screenColor;\n        return;\n    }\n\n    vec4 colOut = vec4(0.0);\n\n    vec3 rayPositionBlackHoleSpace = camera_position - object_position;// position of the camera in blackhole space\n\n    bool suckedInBH = false;\n    bool escapedBH = false;\n    bool occluded = false;\n\n    if (maximumDistance < length(rayPositionBlackHoleSpace)) occluded = true;\n\n    vec4 col = vec4(0.0);\n    vec4 glow = vec4(0.0);\n\n    if (!occluded) {\n        for (int disks = 0; disks < 15; disks++) {\n            float distanceToCenter = 0.0;//distance to BH\n\n            vec3 projectedPosition = vec3(0.0);\n            float projectedDistance = 0.0;\n\n            vec3 projectedRayDir = vec3(0.0);\n            float rayDirProjectedDistance = 0.0;\n\n            for (int h = 0; h < 6; h++) {\n                //reduces tests for exit conditions (to minimise branching)\n                distanceToCenter = customLength(rayPositionBlackHoleSpace);//distance to BH\n                vec3 dirToBlackHole = -rayPositionBlackHoleSpace / distanceToCenter;//direction to BH\n                float distanceToCenter2 = distanceToCenter * distanceToCenter;\n\n                projectedPosition = projectOnPlane(rayPositionBlackHoleSpace, object_rotationAxis);\n                projectedDistance = length(projectedPosition - rayPositionBlackHoleSpace);\n\n                projectedRayDir = projectOnPlane(rayDir, object_rotationAxis);\n                rayDirProjectedDistance = length(projectedRayDir - rayDir);\n\n                float stepSize = 0.92 * projectedDistance / rayDirProjectedDistance;//conservative distance to disk (y==0)\n                float farLimit = distanceToCenter * 0.5;//limit step size far from to BH\n                float closeLimit = distanceToCenter * 0.1 + 0.05 * distanceToCenter2 / schwarzschildRadius;//limit step size close to BH\n                stepSize = min(stepSize, min(farLimit, closeLimit));\n\n                // Frame dragging computation below: (see https://www.shadertoy.com/view/sdjcWm)\n                // Compute a vector in the direction of the BH's rotation\n                vec3 pos_cross_pole_axis = cross(object_rotationAxis, -dirToBlackHole);\n                // Compute sin^2(latitude) of the current ray position\n                float sin2_colatitude = length(pos_cross_pole_axis);\n                sin2_colatitude = sin2_colatitude * sin2_colatitude;\n\n                // the frame dragging rate is approximately proportional to 1/(r^2 * sin^2(colatitude)) (See: https://en.wikipedia.org/wiki/Frame-dragging)\n                vec3 frameDragForce = frameDraggingFactor * schwarzschildRadius * schwarzschildRadius * normalize(pos_cross_pole_axis) * sin2_colatitude / distanceToCenter2;\n\n                rayDir = bendRay(rayDir, dirToBlackHole, distanceToCenter2, maxBendDistance, stepSize);\n                rayPositionBlackHoleSpace += stepSize * (rayDir - frameDragForce);\n\n                if(hasAccretionDisk) {\n                    // the distance in the unit of the schwarzschild radius\n                    float relativeDistance = distanceToCenter / schwarzschildRadius;\n                    // the glow mask fades the glow when to close to the horizon (the photon sphere has a radius of 1.5 * schwarzschild, so 1.0 is slightly below for artistic reasons: bloom leaks at the camera level)\n                    float glowMask = smoothstep(1.0, 2.5, relativeDistance);\n                    col += 0.5 * vec4(1.0, 0.9, 0.6, 1.0) * (stepSize / schwarzschildRadius) * glowMask / (relativeDistance * relativeDistance);\n                }\n            }\n\n            if (distanceToCenter < schwarzschildRadius) {\n                suckedInBH = true;\n                break;\n            } else if (distanceToCenter > schwarzschildRadius * 5000.0) {\n                escapedBH = true;\n                break;\n            } else if (projectedDistance <= accretionDiskHeight) {\n                //ray hit accretion disk //FIXME: Break when rotate around edge of disk\n                vec4 diskCol = raymarchDisk(rayDir, rayPositionBlackHoleSpace);//render disk\n                rayPositionBlackHoleSpace += accretionDiskHeight * rayDir / rayDirProjectedDistance;// we get out of the disk\n                col += diskCol * (1.0 - col.a);\n            }\n\n            if (suckedInBH || escapedBH) break;\n        }\n    }\n\n    // getting the screen coordinate of the end of the bended ray\n    vec2 uv = uvFromWorld(rayPositionBlackHoleSpace + object_position, camera_projection, camera_view);\n    // check if there is an object occlusion\n    vec3 pixelWorldPositionEndRay = worldFromUV(uv, camera_inverseProjection, camera_inverseView);// the pixel position in world space (near plane)\n    vec3 rayDirToEndRay = normalize(pixelWorldPositionEndRay - camera_position);// normalized direction of the ray\n\n    float depthEndRay = texture2D(depthSampler, uv).r;// the depth corresponding to the pixel in the depth map\n    for(int i = 0; i < 10; i++) {\n        vec2 offset = (vec2(hash(float(i)), hash(float(i + 1))) - 0.5) * 0.01;\n        depthEndRay = min(depthEndRay, texture2D(depthSampler, uv + offset).r);\n    }\n    // closest physical point from the camera in the direction of the pixel (occlusion)\n    vec3 closestPointEndRay = (pixelWorldPositionEndRay - camera_position) * remap(depthEndRay, 0.0, 1.0, camera_near, camera_far);\n    float maximumDistanceEndRay = length(closestPointEndRay);// the maxium ray length due to occlusion\n    float BHDistance = length(camera_position - object_position);\n\n    bool behindBH = dot(closestPointEndRay - camera_position, closestPointEndRay - object_position) >= 0.0;\n    // checking for alignment: camera, object, blackhole in this order\n    behindBH = behindBH && dot(closestPointEndRay - camera_position, object_position - camera_position) >= 0.0;\n\n    vec4 bg = vec4(0.0);\n    if(uv.x > 0.0 && uv.x < 1.0 && uv.y > 0.0 && uv.y < 1.0 && behindBH) {\n        bg = texture2D(textureSampler, uv);\n    } else {\n        rayDir = vec3(starfieldRotation * vec4(rayDir, 1.0));\n        rayDir.z *= -1.0;\n        bg = texture(starfieldTexture, rayDir);\n    }\n\n    vec4 finalColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    if (occluded) {\n        finalColor = screenColor;\n    } else if (suckedInBH) {\n        finalColor = vec4(col.rgb * col.a, 1.0);\n    } else if (escapedBH) {\n        finalColor = vec4(mix(bg.rgb, col.rgb + glow.rgb *(col.a +  glow.a), col.a), 1.0);\n    } else {\n        finalColor = vec4(col.rgb + glow.rgb *(col.a +  glow.a), 1.0);\n    }\n\n    gl_FragColor = finalColor;\n}\n");var b=m(Object.values(l.A)).concat(m(Object.values(s.o)),m(Object.values(u.Wp))),S=m(Object.values(c.R)).concat(m(Object.values(u.YK)));return h=n,p=[e.name,g,b,S,1,null,i.g.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,null,r.Y.TEXTURETYPE_HALF_FLOAT],h=f(h),d(y=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,v()?Reflect.construct(h,p||[],f(this).constructor):h.apply(this,p)),"activeCamera",null),d(y,"blackHoleUniforms",void 0),y.blackHoleUniforms=t,y.onActivateObservable.add(function(e){y.activeCamera=e}),y.onApplyObservable.add(function(n){if(null===y.activeCamera)throw Error("Camera is null");(0,s.b)(n,y.activeCamera),(0,l.$)(n,e,t.schwarzschildRadius),t.setUniforms(n,e),(0,c.C)(n,y.activeCamera,a),t.setSamplers(n)}),y}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&p(n,e),t=[{key:"update",value:function(e){this.blackHoleUniforms.time+=e,this.blackHoleUniforms.time%=3600}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(a.w)},14351:function(e,t,n){"use strict";n.d(t,{PW:()=>s,Wp:()=>i,YK:()=>a});var r=n(81401);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i={STARFIELD_ROTATION:"starfieldRotation",TIME:"time",SCHWARZSCHILD_RADIUS:"schwarzschildRadius",FRAME_DRAGGING_FACTOR:"frameDraggingFactor",ACCRETION_DISK_RADIUS:"accretionDiskRadius",WARPING_MINKOWSKI_FACTOR:"warpingMinkowskiFactor",ROTATION_PERIOD:"rotationPeriod",ROTATION_AXIS:"rotationAxis",FORWARD_AXIS:"forwardAxis"},a={STARFIELD_TEXTURE:"starfieldTexture"},s=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"accretionDiskRadius",void 0),o(this,"rotationPeriod",void 0),o(this,"warpingMinkowskiFactor",void 0),o(this,"schwarzschildRadius",void 0),o(this,"frameDraggingFactor",void 0),o(this,"time",0),o(this,"backgroundTexture",void 0),this.accretionDiskRadius=e.accretionDiskRadius,this.rotationPeriod=1.5,this.warpingMinkowskiFactor=2,this.schwarzschildRadius=e.radius;var i=(0,r.Mm)(e.mass,e.siderealDaySeconds);this.frameDraggingFactor=i/e.mass,this.backgroundTexture=n}return e=[{key:"setUniforms",value:function(e,t){e.setMatrix(i.STARFIELD_ROTATION,this.backgroundTexture.getReflectionTextureMatrix()),e.setFloat(i.TIME,this.time),e.setFloat(i.SCHWARZSCHILD_RADIUS,this.schwarzschildRadius),e.setFloat(i.FRAME_DRAGGING_FACTOR,this.frameDraggingFactor),e.setFloat(i.ACCRETION_DISK_RADIUS,this.accretionDiskRadius),e.setFloat(i.WARPING_MINKOWSKI_FACTOR,this.warpingMinkowskiFactor),e.setFloat(i.ROTATION_PERIOD,this.rotationPeriod),e.setVector3(i.ROTATION_AXIS,t.up),e.setVector3(i.FORWARD_AXIS,t.forward)}},{key:"setSamplers",value:function(e){e.setTexture(a.STARFIELD_TEXTURE,this.backgroundTexture)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},72262:function(e,t,n){"use strict";n.d(t,{G:()=>w});var r=n(5566),o=n(45782),i=n(36801),a=n(90718),s=n(52632),l=n(80465),c=n(92327),u=n(61741),h=n(76161),d=n(27460),f=n(95864),p=n(29007),m=n(53024),v=n(76753),y=n(57836),g=n(13679),b=n(78393);function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(){var e;function t(e,n,h){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");S(this,"model",void 0),S(this,"type",u.T.NEUTRON_STAR),S(this,"mesh",void 0),S(this,"light",void 0),S(this,"material",void 0),S(this,"aggregate",void 0),S(this,"volumetricLightUniforms",new p.e),S(this,"ringsUniforms",void 0),S(this,"asteroidField",void 0),S(this,"targetInfo",void 0),this.model=e,this.mesh=a.P.CreateSphere(this.model.name,{diameter:2*this.model.radius,segments:32},h),this.mesh.rotationQuaternion=i.PT.Identity(),this.aggregate=new l.L(this.getTransform(),s.DK.CONTAINER,{mass:0,restitution:.2},h),this.aggregate.body.setMassProperties({inertia:i.Pq.Zero(),mass:0}),this.aggregate.body.disablePreStep=!1;var d=new c.Ei(i.Pq.Zero(),this.model.radius,h);this.aggregate.shape.addChildFromParent(this.getTransform(),d,this.mesh),this.light=new o.H("".concat(this.model.name,"Light"),i.Pq.Zero(),h);var w=(0,y.C)(this.model.blackBodyTemperature);this.light.diffuse.copyFromFloats(w.r,w.g,w.b),this.light.falloffType=r.v.FALLOFF_STANDARD,this.light.parent=this.getTransform(),this.material=new b.I(this.model.seed,this.model.blackBodyTemperature,n.pools.starMaterialLut,h),this.mesh.material=this.material,null!==this.model.rings?(this.ringsUniforms=f.zl.New(this.model.rings,n,g.w.RINGS_FADE_OUT_DISTANCE,h),this.asteroidField=new v.U(this.model.seed,this.getTransform(),this.model.rings.innerRadius,this.model.rings.outerRadius,h)):(this.ringsUniforms=null,this.asteroidField=null),this.targetInfo=(0,m.v)(this.getBoundingRadius())}return e=[{key:"getTransform",value:function(){return this.mesh}},{key:"getTypeName",value:function(){return(0,d.d)(this.model)}},{key:"getLight",value:function(){return this.light}},{key:"updateMaterial",value:function(e){this.material.update(e)}},{key:"getRadius",value:function(){return this.model.radius}},{key:"getBoundingRadius",value:function(){return this.getRadius()}},{key:"computeCulling",value:function(e){this.mesh.isVisible=(0,h.h)(this,e)}},{key:"dispose",value:function(e){var t,n;this.aggregate.dispose(),this.mesh.dispose(),this.light.dispose(),this.material.dispose(),null==(t=this.asteroidField)||t.dispose(),null==(n=this.ringsUniforms)||n.dispose(e)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},59008:function(e,t,n){"use strict";n.d(t,{F:()=>S});var r=n(5566),o=n(45782),i=n(36801),a=n(90718),s=n(52632),l=n(80465),c=n(61741),u=n(76161),h=n(27460),d=n(95864),f=n(29007),p=n(53024),m=n(76753),v=n(57836),y=n(13679),g=n(78393);function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(){var e;function t(e,n,u){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");b(this,"mesh",void 0),b(this,"light",void 0),b(this,"material",void 0),b(this,"aggregate",void 0),b(this,"volumetricLightUniforms",new f.e),b(this,"ringsUniforms",void 0),b(this,"asteroidField",void 0),b(this,"model",void 0),b(this,"type",c.T.STAR),b(this,"targetInfo",void 0),this.model=e,this.mesh=a.P.CreateSphere(this.model.name,{diameter:2*this.model.radius,segments:32},u),this.mesh.rotationQuaternion=i.PT.Identity(),this.aggregate=new l.L(this.getTransform(),s.DK.SPHERE,{mass:0,restitution:.2},u),this.aggregate.body.setMassProperties({inertia:i.Pq.Zero(),mass:0}),this.aggregate.body.disablePreStep=!1,this.light=new o.H("".concat(this.model.name,"Light"),i.Pq.Zero(),u);var h=(0,v.C)(this.model.blackBodyTemperature);this.light.diffuse.copyFromFloats(h.r,h.g,h.b),this.light.falloffType=r.v.FALLOFF_STANDARD,this.light.parent=this.getTransform(),this.material=new g.I(this.model.seed,this.model.blackBodyTemperature,n.pools.starMaterialLut,u),this.mesh.material=this.material,null!==this.model.rings?(this.ringsUniforms=d.zl.New(this.model.rings,n,y.w.RINGS_FADE_OUT_DISTANCE,u),this.asteroidField=new m.U(this.model.seed,this.getTransform(),this.model.rings.innerRadius,this.model.rings.outerRadius,u)):(this.ringsUniforms=null,this.asteroidField=null),this.targetInfo=(0,p.v)(this.getBoundingRadius())}return e=[{key:"getTransform",value:function(){return this.mesh}},{key:"getLight",value:function(){return this.light}},{key:"getTypeName",value:function(){return(0,h.d)(this.model)}},{key:"updateMaterial",value:function(e){this.material.update(e)}},{key:"getRadius",value:function(){return this.model.radius}},{key:"getBoundingRadius",value:function(){return this.getRadius()}},{key:"computeCulling",value:function(e){this.mesh.isVisible=(0,u.h)(this,e)}},{key:"dispose",value:function(e){var t,n;this.aggregate.dispose(),this.material.dispose(),this.light.dispose(),null==(t=this.asteroidField)||t.dispose(),null==(n=this.ringsUniforms)||n.dispose(e),this.mesh.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},78393:function(e,t,n){"use strict";n.d(t,{I:()=>m});var r=n(78930),o=n(16739),i=n(70673),a=n(57836);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return s(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(d=function(){return!!e})()}var f={WORLD:"world",WORLD_VIEW_PROJECTION:"worldViewProjection",SEED:"seed",STAR_COLOR:"starColor",TIME:"time"},p={LUT:"lut"},m=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e,t,o,s){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");var u,m,v,y,g,b,S,w="starMaterial";null!=(y=r.M.ShadersStore)[g="".concat(w,"FragmentShader")]||(y[g]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nvarying vec3 vPosition;// position of the vertex varyingsphere space\nvarying vec3 vUnitSamplePoint;\n\nuniform vec3 starColor;\nuniform float time;\n\nuniform float seed;\n\nuniform sampler2D lut;\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// rotation using https://www.wikiwand.com/en/Rodrigues%27_rotation_formula\nvec3 rotateAround(vec3 vector, vec3 axis, float theta) {\n    // Please note that unit vector are required, i did not divided by the norms\n    return cos(theta) * vector + cross(axis, vector) * sin(theta) + axis * dot(axis, vector) * (1.0 - cos(theta));\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n\nvec2 toUV(in vec3 n)\n{\n    vec2 uv;\n\n    uv.x = atan(-n.x, n.z);\n    uv.x = (uv.x + PI / 2.0) / (PI * 2.0) + PI * (28.670 / 360.0);\n\n    uv.y = acos(n.y) / PI;\n\n    return uv;\n}\n\nvoid main() {\n    float plasmaSpeed = 0.005;\n    vec3 samplePoint1 = rotateAround(vUnitSamplePoint, vec3(0.0, 1.0, 0.0), time * plasmaSpeed);\n    vec3 samplePoint2 = rotateAround(vUnitSamplePoint, vec3(0.0, 1.0, 0.0), -time * plasmaSpeed);\n\n    vec2 uv1 = toUV(samplePoint1);\n    vec2 df1 = fwidth(uv1);\n    if(df1.x > 0.5) df1.x = 0.0;\n\n    vec2 uv2 = toUV(samplePoint2);\n    vec2 df2 = fwidth(uv2);\n    if(df2.x > 0.5) df2.x = 0.0;\n\n    float noiseValue1 = textureLod(lut, uv1, log2(max(df1.x, df1.y) * 1024.0)).r;\n    float noiseValue2 = textureLod(lut, uv2, log2(max(df2.x, df2.y) * 1024.0)).r;\n\n    float noiseValue = noiseValue1 * noiseValue2;\n\n    vec3 finalColor = starColor;\n\n    finalColor -= vec3(pow(noiseValue, 4.0));\n\n    gl_FragColor = vec4(finalColor, 1.0);// apply color and lighting\n} "),null!=(b=r.M.ShadersStore)[S="".concat(w,"VertexShader")]||(b[S]="//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nprecision highp float;\n\nattribute vec3 position;\n\nuniform mat4 world;\nuniform mat4 worldViewProjection;\n\nvarying vec3 vPositionW;\nvarying vec3 vPosition;\nvarying vec3 vUnitSamplePoint;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nvec3 applyQuaternion(vec4 quaternion, vec3 vector) {\n    float qx = quaternion.x;\n    float qy = quaternion.y;\n    float qz = quaternion.z;\n    float qw = quaternion.w;\n    float x = vector.x;\n    float y = vector.y;\n    float z = vector.z;\n    // apply quaternion to vector\n    float ix = qw * x + qy * z - qz * y;\n    float iy = qw * y + qz * x - qx * z;\n    float iz = qw * z + qx * y - qy * x;\n    float iw = -qx * x - qy * y - qz * z;\n    // calculate result * inverse quat\n    float nX = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n    float nY = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n    float nZ = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n\n    return vec3(nX, nY, nZ);\n}\n\nvoid main() {\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n\n    vPositionW = vec3(world * vec4(position, 1.0));\n\n    vPosition = position;\n\n    vUnitSamplePoint = normalize(position);\n}"),u=n,m=["starColor",s,w,{attributes:["position"],uniforms:h(Object.values(f)),samplers:h(Object.values(p))}],u=c(u),l(v=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,d()?Reflect.construct(u,m||[],c(this).constructor):u.apply(this,m)),"starSeed",void 0),l(v,"starColor",void 0),l(v,"elapsedSeconds",0);var T=(0,i.T)(s);v.setTexture("lut",T);var A=o.get();return A.getTexture().executeWhenReady(function(){v.setTexture(p.LUT,A.getTexture()),T.dispose()}),v.starSeed=e,v.starColor=(0,a.C)(t),v.onBindObservable.add(function(){v.getEffect().setFloat(f.TIME,v.elapsedSeconds%1e5),v.getEffect().setColor3(f.STAR_COLOR,v.starColor),v.getEffect().setFloat(f.SEED,v.starSeed)}),v.onDisposeObservable.addOnce(function(){o.release(A),T.dispose()}),v}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&u(n,e),t=[{key:"update",value:function(e){this.elapsedSeconds+=e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(o.B)},78921:function(e,t,n){"use strict";n.d(t,{N:()=>c});var r=n(36801),o=n(36044),i=n(53024),a=n(56367),s=n(78706);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");l(this,"name",void 0),l(this,"transform",void 0),l(this,"systemCoordinates",void 0),l(this,"referencePlanePosition",void 0),l(this,"targetInfo",{type:i.L.STAR_SYSTEM,minDistance:(0,a.E1)(2),maxDistance:(0,a.E1)(.2)}),this.name=e.name,this.transform=new o.VR0(this.name,r),this.systemCoordinates=e.coordinates,this.referencePlanePosition=n,this.transform.position.copyFrom(n)}return e=[{key:"updatePosition",value:function(e,t){r.Pq.TransformCoordinatesToRef(this.referencePlanePosition,e,this.transform.position),this.transform.position.addInPlace(t),this.transform.computeWorldMatrix(!0)}},{key:"getTransform",value:function(){return this.transform}},{key:"dispose",value:function(){this.getTransform().dispose()}},{key:"getBoundingRadius",value:function(){return 0}},{key:"getTypeName",value:function(){return s.A.t("objectTypes:starSystem")}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},78706:function(e,t,n){"use strict";n.d(t,{A:()=>s,L:()=>a});var r=n(24536),o=n(87829);function i(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function a(){var e;return(e=function(){var e,t;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(i){switch(i.label){case 0:var a,s,l;return t=null!=(e=new URLSearchParams(window.location.search).get("lang"))?e:navigator.language,[4,(0,r.Ts)({lng:t,debug:!1,fallbackLng:"en-US",resources:(a=n(67459),s={},l=o.g1(o.Yj(),o.Yj()),a.keys().forEach(function(e){var t,n=e.split("/"),r=n[1];if(void 0===r)throw Error("Language folder is undefined: some json files are at root level in the locales folder");var o=n.slice(2,n.length-1),i=n.at(-1);if(void 0===i)throw Error("File name is undefined");var c=i.split(".")[0];if(void 0===c)throw Error("Could not split file name from extension: ".concat(i));s[r]=null!=(t=s[r])?t:{};var u=s[r];o.forEach(function(e){if("string"==typeof u)throw Error("Encountered recursion error when iterating locale subfolders!");e in u||(u[e]={}),u=u[e]});var h=l.parse(a(e));u[c]=h}),s)})];case 1:return i.sent(),document.querySelectorAll("*[data-i18n]").forEach(function(e){var t=e.getAttribute("data-i18n");if(null===t)throw Error("data-i18n attribute is null");e.innerHTML=(0,r.t)(t)}),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,l,"next",e)}function l(e){i(a,r,o,s,l,"throw",e)}s(void 0)})})()}let s=r.Ay},13679:function(e,t,n){"use strict";n.d(t,{H:()=>o,w:()=>r});var r={UNIVERSE_SEED:Math.PI,POWER_PLAY_SEED:77,EARTH_RADIUS:1e6,VERTEX_RESOLUTION:64,MIN_DISTANCE_BETWEEN_VERTICES:1.5,CLOUD_LAYER_HEIGHT:7e3,EARTH_ATMOSPHERE_THICKNESS:1e5,OCEAN_DEPTH:7e3,TIME_MULTIPLIER:1,CHUNK_RENDERING_DISTANCE_MULTIPLIER:2,ENABLE_VOLUMETRIC_CLOUDS:!1,SEED_HALF_RANGE:1e4,FLOATING_ORIGIN_THRESHOLD:500,HUMAN_BUBBLE_RADIUS_LY:100,VISIBLE_NEIGHBORHOOD_MAX_RADIUS_LY:20,CREDIT_SYMBOL:"₽",STAR_SECTOR_SIZE:20,INDIVIDUAL_AVERAGE_DAILY_INTAKE:2250,HYDROPONIC_TO_CONVENTIONAL_RATIO:3.5,FOV:n(28468).S0.ToRadians(60),LANDING_PAD_ASPECT_RATIO:1.618,RINGS_FADE_OUT_DISTANCE:15e3,MAIN_FONT:"Nasalization",MAX_AUTO_SAVES:5,SHARED_POSITION_SAVE_UUID:"sharedPositionSave",TUTORIAL_SAVE_UUID:"00000000-0000-0000-0000-000000000000",QUALITY_CHARS:"FEDCBA"},o={ENVIRONMENT:1,DYNAMIC_OBJECTS:2}},47759:function(e,t,n){"use strict";n.d(t,{U9:()=>i,Zw:()=>a,fC:()=>o,tb:()=>s});var r,o=((r={})[r.POTATO=0]="POTATO",r[r.YAM=1]="YAM",r[r.SWEET_POTATO=2]="SWEET_POTATO",r[r.RICE=3]="RICE",r[r.PEANUT=4]="PEANUT",r[r.WHEAT=5]="WHEAT",r[r.LENTIL=6]="LENTIL",r[r.CASSAVA=7]="CASSAVA",r),i=[0,1,2,3,4,5,6,7];function a(e){switch(e){case 0:return 54e3;case 1:return 47e3;case 2:return 7e4;case 3:return 49e3;case 4:return 36e3;case 5:return 4e4;case 6:return 23e3;case 7:return 27e3;default:throw Error("Unknown crop type")}}function s(e){switch(e){case 0:return"Potato";case 1:return"Yam";case 2:return"Sweet potato";case 3:return"Rice";case 4:return"Peanut";case 5:return"Wheat";case 6:return"Lentil";case 7:return"Cassava";default:throw Error("Unknown crop type")}}},71980:function(e,t,n){"use strict";function r(e){var t,n,r,o=e.h,i=e.s,a=e.v,s=(o%360+360)%360,l=a*i,c=l*(1-Math.abs(s/60%2-1)),u=a-l;return s>=0&&s<60?(t=l,n=c,r=0):s>=60&&s<120?(t=c,n=l,r=0):s>=120&&s<180?(t=0,n=l,r=c):s>=180&&s<240?(t=0,n=c,r=l):s>=240&&s<300?(t=c,n=0,r=l):(t=l,n=0,r=c),{r:t+u,g:n+u,b:r+u}}n.d(t,{M:()=>r})},19223:function(e,t,n){"use strict";n.d(t,{G:()=>o});var r,o=((r={})[r.AXIAL_TILT=100]="AXIAL_TILT",r[r.ORBIT=200]="ORBIT",r[r.RADIUS=1e3]="RADIUS",r[r.ORBITAL_PLANE_ALIGNMENT=1600]="ORBITAL_PLANE_ALIGNMENT",r[r.RINGS=1200]="RINGS",r[r.POWER=300]="POWER",r[r.ACCENT_COLOR=400]="ACCENT_COLOR",r[r.TEMPERATURE=1100]="TEMPERATURE",r[r.STELLAR_TYPE=1900]="STELLAR_TYPE",r[r.PRESSURE=1800]="PRESSURE",r[r.WATER_AMOUNT=1700]="WATER_AMOUNT",r[r.TERRAIN=1500]="TERRAIN",r[r.DIPOLE_TILT=1300]="DIPOLE_TILT",r[r.SIDEREAL_DAY_SECONDS=2500]="SIDEREAL_DAY_SECONDS",r)},32220:function(e,t,n){"use strict";n.d(t,{p:()=>o});var r=n(25054);function o(e){return(0,r.seededSquirrelNoise)(e)}},73321:function(e,t,n){"use strict";n.d(t,{K:()=>o});function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");r(this,"ctor",void 0),r(this,"pool",void 0),this.ctor=e,this.pool=[]}return e=[{key:"get",value:function(){var e;return null!=(e=this.pool.pop())?e:this.ctor()}},{key:"release",value:function(e){this.pool.push(e)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},44710:function(e,t,n){"use strict";n.d(t,{z:()=>i});var r=n(87829),o=r.g1(r.L5());function i(e){try{var t=JSON.parse(e);return o.parse(t)}catch(e){return null}}},95369:function(e,t,n){"use strict";function r(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}function o(){var e;return(e=function(){var e,t,n;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return[4,null==(t=navigator.keyboard)||null==(e=t.getLayoutMap)?void 0:e.call(t)];case 1:return[2,null!=(n=r.sent())?n:null]}})},function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,l,"next",e)}function l(e){r(a,o,i,s,l,"throw",e)}s(void 0)})})()}n.d(t,{t:()=>o})},13298:function(e,t,n){"use strict";function r(e,t,n){return Math.min(Math.max(e,t),n)}function o(e,t,n){return e>t?Math.max(t,e-n):Math.min(t,e+n)}function i(e,t,n){var r=Math.min(1,Math.max(0,(n-e)/(t-e)));return r*r*(3-2*r)}function a(e){return 2*Math.abs(e-Math.floor(e+.5))}function s(e,t,n,r,o){return r+(e-t)*(o-r)/(n-t)}function l(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=t,o=0;o<n;o++){var i=e(r);if(1e-8>Math.abs(i))break;var a=(e(r+1e-4)-i)/1e-4;r-=i/a}return r}n.d(t,{E1:()=>a,Ew:()=>s,TF:()=>i,YX:()=>l,cP:()=>o,p_:()=>function e(t,n){return 0===n?t:e(n,t%n)},qE:()=>r})},81401:function(e,t,n){"use strict";n.d(t,{Mm:()=>a,kt:()=>i});var r=n(19461),o=n(56545);function i(e){return e*Math.pow(r.C,2)/(2*r.G)}function a(e,t){return function(e,t){if(0===t)return 0;var n=(0,o.F4)(e);return .4*e*n*n*(2*Math.PI/t)}(e,t)/(e*r.C)}},19461:function(e,t,n){"use strict";n.d(t,{AU:()=>a,C:()=>o,G:()=>i,G3:()=>u,Ow:()=>h,SU:()=>d,W4:()=>l,fM:()=>r,jm:()=>s,kG:()=>c,th:()=>f});var r=946728e10,o=0x11de784a,i=66743e-15,a=15e10,s=5972e21,l=7348e19,c=1898e24,u=1989e27,h=69634e4,d=9.81,f=101325},57404:function(e,t,n){"use strict";n.d(t,{EF:()=>o,oe:()=>s,rB:()=>i,tQ:()=>a});var r=n(19461);function o(e,t,n){return t-e+n*Math.sin(e)}function i(e,t,n){return 1/Math.pow(Math.pow(Math.abs(e),n)+Math.pow(Math.abs(t),n),1/n)}function a(e,t){return 0===t?0:2*Math.PI*Math.sqrt(Math.pow(e,3)/(r.G*t))}function s(e,t){var n=2*Math.PI/e;return Math.cbrt(r.G*t/(n*n))}},97715:function(e,t,n){"use strict";function r(e,t,n){return 567e-10*Math.pow(e,4)*4*Math.PI*Math.pow(t,2)/(4*Math.PI*Math.pow(n,2))}n.d(t,{ZP:()=>r})},45321:function(e,t,n){"use strict";function r(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function o(e,t,n){if(!t.has(e))throw TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function i(e,t){var n=o(e,t,"get");return n.get?n.get.call(e):n.value}function a(e,t,n){r(e,t),t.set(e,n)}function s(e,t,n){var r=o(e,t,"set");if(r.set)r.set.call(e,n);else{if(!r.writable)throw TypeError("attempted to set read only private field");r.value=n}return n}function l(e,t,n){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return n}function c(e,t){r(e,t),t.add(e)}n.d(t,{M:()=>b});var u=function(e){return(e+1>>>1)-1},h=function(e){return(e<<1)+1},d=function(e){return e+1<<1},f=new WeakMap,p=new WeakMap,m=new WeakSet,v=new WeakSet,y=new WeakSet,g=new WeakSet,b=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");c(this,m),c(this,v),c(this,y),c(this,g),a(this,f,{writable:!0,value:void 0}),a(this,p,{writable:!0,value:void 0}),s(this,f,[]),s(this,p,e)}return e=[{key:"size",value:function(){return i(this,f).length}},{key:"isEmpty",value:function(){return 0===this.size()}},{key:"peek",value:function(){return i(this,f)[0]}},{key:"push",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){i(e,f).push(t),l(e,y,T).call(e)}),this.size()}},{key:"pop",value:function(){var e=this.peek(),t=this.size()-1;return t>0&&l(this,v,w).call(this,0,t),i(this,f).pop(),l(this,g,A).call(this),e}},{key:"clear",value:function(){i(this,f).length=0}},{key:"find",value:function(e){return i(this,f).find(e)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function S(e,t){return void 0!==i(this,f)[e]&&void 0!==i(this,f)[t]&&i(this,p).call(this,i(this,f)[e],i(this,f)[t])}function w(e,t){var n;void 0!==i(this,f)[e]&&void 0!==i(this,f)[t]&&(n=[i(this,f)[t],i(this,f)[e]],i(this,f)[e]=n[0],i(this,f)[t]=n[1])}function T(){for(var e=this.size()-1;e>0&&l(this,m,S).call(this,e,u(e));)l(this,v,w).call(this,e,u(e)),e=u(e)}function A(){for(var e=0;h(e)<this.size()&&l(this,m,S).call(this,h(e),e)||d(e)<this.size()&&l(this,m,S).call(this,d(e),e);){var t=d(e)<this.size()&&l(this,m,S).call(this,d(e),h(e))?d(e):h(e);l(this,v,w).call(this,e,t),e=t}}},96839:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var n=t*e.reduce(function(e,t){return e+o(t,2)[1]},0),r=0,i=!0,a=!1,s=void 0;try{for(var l,c=e[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=o(l.value,2),h=u[0],d=u[1];if(r+=d,n<r)return h}}catch(e){a=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}throw Error("Wheel of fortune failed")}function a(e,t,n){for(var r=[],o=0,i=0;i<e;i++){var a=-Math.log(t(n+i))/1;r.push(a),o+=a}return r.map(function(e){return e/o})}n.d(t,{MA:()=>i,s1:()=>a})},96728:function(e,t,n){"use strict";function r(e,t,n){return t/(e*n)}n.d(t,{y:()=>r})},57836:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(t,{C:()=>c});var a=new function e(t,n,r,i,a,s,l,c,u,h){if(!(this instanceof e))throw TypeError("Cannot call a class as a function");o(this,"name",void 0),o(this,"xRed",void 0),o(this,"yRed",void 0),o(this,"xGreen",void 0),o(this,"yGreen",void 0),o(this,"xBlue",void 0),o(this,"yBlue",void 0),o(this,"xWhite",void 0),o(this,"yWhite",void 0),o(this,"gamma",void 0),this.name=t,this.xRed=n,this.yRed=r,this.xGreen=i,this.yGreen=a,this.xBlue=s,this.yBlue=l,this.xWhite=c,this.yWhite=u,this.gamma=h}("HDTV",.67,.33,.21,.71,.15,.06,.3127,.3291,0),s=5e3;function l(e){var t=1e-9*e;return 374183e-21*Math.pow(t,-5)/(Math.exp(.014388/(t*s))-1)}function c(e){s=e;var t,n,r,o,c,u,h,d,f,p,m,v,y,g,b,S,w,T,A,P,C,I,E,R,N,O,L,x,M,_,k,D,j,F,U=i(function(e){var t,n,r=0,o=0,i=0,a=[[.0014,0,.0065],[.0022,1e-4,.0105],[.0042,1e-4,.0201],[.0076,2e-4,.0362],[.0143,4e-4,.0679],[.0232,6e-4,.1102],[.0435,.0012,.2074],[.0776,.0022,.3713],[.1344,.004,.6456],[.2148,.0073,1.0391],[.2839,.0116,1.3856],[.3285,.0168,1.623],[.3483,.023,1.7471],[.3481,.0298,1.7826],[.3362,.038,1.7721],[.3187,.048,1.7441],[.2908,.06,1.6692],[.2511,.0739,1.5281],[.1954,.091,1.2876],[.1421,.1126,1.0419],[.0956,.139,.813],[.058,.1693,.6162],[.032,.208,.4652],[.0147,.2586,.3533],[.0049,.323,.272],[.0024,.4073,.2123],[.0093,.503,.1582],[.0291,.6082,.1117],[.0633,.71,.0782],[.1096,.7932,.0573],[.1655,.862,.0422],[.2257,.9149,.0298],[.2904,.954,.0203],[.3597,.9803,.0134],[.4334,.995,.0087],[.5121,1,.0057],[.5945,.995,.0039],[.6784,.9786,.0027],[.7621,.952,.0021],[.8425,.9154,.0018],[.9163,.87,.0017],[.9786,.8163,.0014],[1.0263,.757,.0011],[1.0567,.6949,.001],[1.0622,.631,8e-4],[1.0456,.5668,6e-4],[1.0026,.503,3e-4],[.9384,.4412,2e-4],[.8544,.381,2e-4],[.7514,.321,1e-4],[.6424,.265,0],[.5419,.217,0],[.4479,.175,0],[.3608,.1382,0],[.2835,.107,0],[.2187,.0816,0],[.1649,.061,0],[.1212,.0446,0],[.0874,.032,0],[.0636,.0232,0],[.0468,.017,0],[.0329,.0119,0],[.0227,.0082,0],[.0158,.0057,0],[.0114,.0041,0],[.0081,.0029,0],[.0058,.0021,0],[.0041,.0015,0],[.0029,.001,0],[.002,7e-4,0],[.0014,5e-4,0],[.001,4e-4,0],[7e-4,2e-4,0],[5e-4,2e-4,0],[3e-4,1e-4,0],[2e-4,1e-4,0],[2e-4,1e-4,0],[1e-4,0,0],[1e-4,0,0],[1e-4,0,0],[0,0,0]];for(t=0,n=380;n<780.1;t++,n+=5){var s=e(n),l=a[t];if(void 0===l)throw Error("cie_colour_match_i is undefined");r+=s*l[0],o+=s*l[1],i+=s*l[2]}var c=r+o+i;return[r/c,o/c,i/c]}(l),3),G=U[0],B=U[1],H=U[2],Y=i((c=1-((r=a.xRed)+(o=a.yRed)),d=1-((u=a.xGreen)+(h=a.yGreen)),m=1-((f=a.xBlue)+(p=a.yBlue)),g=1-((v=a.xWhite)+(y=a.yWhite)),b=h*m-p*d,S=f*d-u*m,w=u*p-f*h,T=p*c-o*m,A=r*m-f*c,P=f*o-r*p,C=o*d-h*c,I=u*c-r*d,E=r*h-u*o,R=(b*v+S*y+w*g)/y,N=(T*v+A*y+P*g)/y,O=(C*v+I*y+E*g)/y,[(b/=R)*G+(S/=R)*B+(w/=R)*H,(T/=N)*G+(A/=N)*B+(P/=N)*H,(C/=O)*G+(I/=O)*B+(E/=O)*H]),3),W=Y[0],z=Y[1],q=Y[2];return W=(t=i((L=W,x=z,M=q,(_=-(_=(_=(_=0<L?0:L)<x?_:x)<M?_:M))>0&&(L+=_,x+=_,M+=_),[L+_,x+_,M+_]),3))[0],z=t[1],q=t[2],W=(n=i((0===(F=Math.max(k=W,Math.max(D=z,j=q)))&&(F=1),[k/F,D/F,j/F]),3))[0],{r:W,g:z=n[1],b:q=n[2]}}},63215:function(e,t,n){"use strict";n.d(t,{Fj:()=>s,Sl:()=>u,Wf:()=>l,fi:()=>a,i3:()=>h,y$:()=>c});var r=n(78706),o=n(19461),i=n(56367);function a(e){return e<1e3?"".concat(e.toFixed(0)," m/s"):e<1e6?"".concat((e/1e3).toFixed(2)," km/s"):e<2e7?"".concat((e/1e6).toFixed(2)," Mm/s"):"".concat((e/o.C).toFixed(2)," c")}function s(e){return e<1e3?r.A.t("units:shortM",{value:e.toFixed(0)}):e<1e6?r.A.t("units:shortKm",{value:(e/1e3).toFixed(2)}):e<3e8?r.A.t("units:shortMm",{value:(e/1e6).toFixed(2)}):e<(0,i.E1)(.1)?r.A.t("units:shortLs",{value:(0,i.N9)(e).toFixed(2)}):r.A.t("units:shortLy",{value:(0,i.GI)(e).toFixed(2)})}function l(e){if(e<60)return r.A.t("units:shortSeconds",{count:Number(e.toFixed(0))});if(e<3600)return r.A.t("units:shortMinutes",{count:Number((e/60).toFixed(0))});if(e<86400)return r.A.t("units:shortHours",{count:Number((e/3600).toFixed(0))});if(e<0x1e187e0)return r.A.t("units:shortDays",{count:Number((e/86400).toFixed(0))});if(e<315576e3)return r.A.t("units:shortYears",{count:Number((e/0x1e187e0).toFixed(0))});else return"∞"}function c(e){var t=e,n=Math.floor(t/0x1e187e0),o=Math.floor((t-=365.25*n*86400)/86400),i=Math.floor((t-=24*o*3600)/3600),a=Math.floor((t-=60*i*60)/60),s=Math.floor(t-=60*a),l=[];return n>0&&l.push(r.A.t("units:years",{count:n})),o>0&&l.push(r.A.t("units:days",{count:o})),i>0&&l.push(r.A.t("units:hours",{count:i})),a>0&&l.push(r.A.t("units:minutes",{count:a})),s>0&&l.push(r.A.t("units:seconds",{count:s})),l.join(" ")}var u="abcdefghijklmnopqrstuvwxyz",h="αβγδεζηθικλμνξοπρστυφχψω".split("").reverse().join("")},19413:function(e,t,n){"use strict";n.d(t,{HX:()=>l,pN:()=>s});var r=n(81098),o=["Aldrin","Apollo","Archimedes","Armstrong","Asimov","Babbage","Blinn","Bohr","Boole","Bradbury","Catmull","Clark","Clarke","Copernicus","Curie","Darwin","Egan","Einstein","Fermat","Feynman","Fibonacci","Franklin","Gagarin","Galileo","Gauss","Gemini","Glenn","Goodal","Gouraud","Hawking","Heinlein","Heisenberg","Herbert","Huygens","Kepler","Kubrick","Laika","LeCun","Lovelace","Mercury","Musk","Newton","Pascal","Pasteur","Pesquet","Phong","Picard","Pratchett","Pythagoras","Rayleigh","Shotwell","Stanford","Sutherland","Suzanne","Tesla","Tolkien","Tolstoy","Torvalds","Turing","Verne","Von Braun","Von Neumann"],i=["Abode","Apex","Bar","Bastion","Citadel","Colony","Constellation","Discovery","Domain","Elysium","Endeavour","Enterprise","Epiphany","Eternity","Expanse","Foundation","Frontier","Habitat","Haven","Horizon","Inception","Interstellar","Journey","Laboratory","Nexus","Oasis","Orbital","Outpost","Paradise","Pinnacle","Prospect","Prosperity","Refuge","Resort","Sanctuary","Settlement","Station","Terminal","Tranquility","Transcendence","Unity","Utopia","Vanguard","Vision","Zenith"],a=["Ascension","Ascending","Bridge","Climb","Climbing","Elevated","Elevation","Elevator","Ladder","Lift","Lifting","Rising","Skyward","Soaring","Upward"];function s(e,t){var n=i[Math.floor(e(t)*i.length)],a=o[Math.floor(e(t+1)*o.length)];return"".concat(a).concat((0,r.uniformRandBool)(.5,e,t+2)?"'s":""," ").concat(n)}function l(e,t){var n=a[Math.floor(e(t)*a.length)],i=o[Math.floor(e(t+1)*o.length)];return"".concat(i).concat((0,r.uniformRandBool)(.5,e,t+2)?"'s":""," ").concat(n)}},85303:function(e,t,n){"use strict";function r(e){return{success:!0,value:e}}function o(e){return{success:!1,error:e}}function i(e){return e.length>0}function a(e){throw Error("Unexpected value: ".concat(String(e)))}n.d(t,{EI:()=>i,_q:()=>o,dr:()=>a,ok:()=>r})},12594:function(e,t,n){"use strict";e.exports={}},88996:function(e){"use strict";e.exports={rE:"1.11.0-dev"}},77025:function(e){"use strict";e.exports=JSON.parse('{"loading":"Loading, please wait...","fullscreen":"Press F11 to enable fullscreen","or":"or","and":"and","sellFor":"Sell for {{price}}","sellAllFor":"Sell all for {{price}}","unknown":"Unknown","cancel":"Cancel","confirm":"Confirm","ok":"OK"}')},27904:function(e){"use strict";e.exports=JSON.parse('{"emptySlot":"Empty Slot","warpDrive":"Warp Drive","fuelTank":"Fuel Tank","fuelScoop":"Fuel Scoop","discoveryScanner":"Discovery Scanner","thrusters":"Thrusters"}')},33064:function(e){"use strict";e.exports=JSON.parse('{"explorationCenter":"Exploration Center","activeEncyclopaediaInstances":"Active Encyclopaedia instances: {{value}}","addNewInstance":"Add new instance","filterLocal":"Local data","filterUploaded":"Uploaded data","filterAll":"All data","searchForADiscovery":"Search for a discovery","noDiscoveryTitle":"No new discoveries","noDiscoveryText":"The universe awaits!","detailsPlaceholder":"Select a discovery to see more details."}')},87226:function(e){"use strict";e.exports=JSON.parse('{"newJourney":"New Journey","loadSave":"Load Save","settings":"Settings","tutorials":"Tutorials","contribute":"Contribute","credits":"Credits","about":"About"}')},39351:function(e){"use strict";e.exports=JSON.parse('{"missionCompleted":"Mission completed. Careful with the asteroids CMDR!"}')},25977:function(e){"use strict";e.exports=JSON.parse('{"travelToTargetSystem":"Travel to {{systemName}} ({{distance}}).","openStarMap":"Press {{starMapKey}} to open the Star Map.","travelToNextSystem":"Continue your journey by passing through {{systemName}} ({{distance}}). There are {{nbJumps}} jumps left before reaching your destination.","getCloserToTarget":"Fly closer to {{objectName}}","corruptedItinerary":"The itinerary is corrupted. Open the star map to plot a new course.","here":"here","accept":"Accept","accepted":"Accepted","noActiveMission":"No active mission","whereToGetMissions":"You can get missions at space stations.","next":"Next","previous":"Previous"}')},48564:function(e){"use strict";e.exports=JSON.parse('{"missionCompleted":"Mission completed. Enjoy the view CMDR!"}')},81872:function(e){"use strict";e.exports=JSON.parse('{"describeFlyBy":"Fly by the {{objectType}} in {{systemName}} ({{distance}})","describeTerminatorLanding":"Land near the terminator of {{objectName}} in {{systemName}} ({{distance}})","describeAsteroidFieldTrek":"Trek in the asteroid field of {{objectName}} in {{systemName}} ({{distance}})","flyBy":"Fly by","terminatorLanding":"Terminator landing","asteroidFieldTrek":"Asteroid field trek"}')},77032:function(e){"use strict";e.exports=JSON.parse('{"getCloserToTerminator":"Get closer to {{objectName}}\'s terminator","missionCompleted":"Mission completed. Enjoy the view CMDR!"}')},8256:function(e){"use strict";e.exports=JSON.parse('{"howToFly":"Your pointer controls the pitch and roll of your spaceship. The neutral position is at the center of the screen.","landingSequenceEngaged":"Landing sequence engaged","landingComplete":"Landing complete! Use {{bindingsString}} to disembark.","landingCancelled":"Landing cancelled","autoPilotEngaged":"Auto-pilot engaged. Sit back and relax.","takeOffSuccess":"Take off successful","copiedToClipboard":"Copied to clipboard","howToLiftOff":"Hold {{bindingsString}} to lift off.","howToHyperSpace":"Align your ship with the system target using the target helper on the bottom right of your screen then press {{bindingsString}} to make a hyperspace jump.","notEnoughFuel":"Cannot perform the hyperspace jump. Not enough fuel! You can refuel at a station or scooping around a star or gas giant.","saveVersionMismatch":"[VERSION_WARNING] The save file version ({{saveVersion}}) does not match the current version ({{currentVersion}}). Loading may result in unexpected behavior.","invalidSaveFileJson":"The save file is not a valid JSON. Please check your save file.","failedToParseSaves":"Could not parse saves. Please check the console for more information.","invalidStorageFormat":"Invalid storage format. Please check the console for more information.","saveOk":"Saved to local storage successfully","cantSaveTutorial":"Cannot save during a tutorial","newDiscovery":"Discovered {{objectName}}. Data recorded.","unknownKeyboardLayout":"Could not detect your keyboard layout. QWERTY layout will be used by default."}')},3888:function(e){"use strict";e.exports=JSON.parse('{"starSystem":"Star system","star":"{{stellarType}} Star","neutronStar":"Neutron Star","blackHole":"Black Hole","gasPlanet":"Gas planet","telluricPlanet":"Telluric Planet","telluricMoon":"Telluric Moon","spaceStation":"Space Station","spaceElevator":"Space Elevator","custom":"Custom Object","spaceElevatorClimber":"Space Elevator Climber","anomaly":"Anomaly","landingPad":"Landing Pad"}')},8316:function(e){"use strict";e.exports=JSON.parse('{"period":"orbital period: {{value}}","radius":"orbital radius: {{value}}"}')},93794:function(e){"use strict";e.exports=JSON.parse('{"siderealDayDuration":"Sidereal day duration: {{value}}","type":"Type: {{value}}"}')},78245:function(e){"use strict";e.exports=JSON.parse('{"resume":"Resume","save":"Save Game","load":"Load Game","tutorials":"Tutorials","settings":"Settings","contribute":"Contribute","share":"Share Position","screenshot":"Take Screenshot"}')},73255:function(e){"use strict";e.exports=JSON.parse('{"loadSave":"Load a save","dropASaveFileHere":"Drop a save file here","lastPlayedOn":"Last explored on {{val, datetime}}","journeyedFor":"Journeyed for {{nbHours}} hours","cmdrNameChangePrompt":"How would you like to name this Commander? This action will affect all saves of this Commander.","deleteSavePrompt":"Deleting this save is irreversible. You can still download a backup first! Are you sure you want to proceed?","landedAt":"Landed at {{location}}","near":"Near {{location}}","locationNotFound":"Error: Location not found in database","settings":"Settings","tutorials":"Tutorials","tutorialsWarning":"If this is your first time playing, you can simply start a new game: the tutorials will be naturally presented during the game!","contribute":"Contribute","bugReports":"Bug Reports","bugReportsText":"If you experience any bug during your exploration, please add it to the <a href=\\"https://github.com/BarthPaleologue/CosmosJourneyer/issues\\">issue tracker</a>. You can also send an email at <a href=\\"mailto:barth.paleologue@cosmosjourneyer.com\\">barth.paleologue@cosmosjourneyer.com</a>. Sending screenshots and save files can help enormously with the debugging process.","translation":"Translation","translationText":"Translating Cosmos Journeyer makes it accessible to more people around the world! You don\'t need any coding skills, only proficiency in a language not currently supported or that can be enhanced. You can access the translation guide <a href=\\"https://github.com/BarthPaleologue/CosmosJourneyer/blob/main/CONTRIBUTING.md#translation\\">here</a>.","knowHowToCode":"Know how to code?","knowHowToCodeText":"Cosmos Journeyer is an open-source project which means anyone can help build it! Why not you?\\n You can check out <a target=\\"_blank\\" href=\\"https://github.com/BarthPaleologue/CosmosJourneyer\\">the repository of the project</a> for more details. Please take a look at the contributing guidelines before starting to contribute to Cosmos Journeyer.","supportFinancially":"Support financially","supportFinanciallyText":"Building Cosmos Journeyer takes a lot of time and effort while being free for everyone. Please consider sponsoring the project on <a target=\\"_blank\\" href=\\"https://www.patreon.com/barthpaleologue\\">Patreon</a> or <a target=\\"_blank\\" href=\\"https://ko-fi.com/cosmosjourneyer\\">Ko-fi</a>. Your support will help me dedicate more time to the project and make it even better!","credits":"Credits","contributors":"Contributors","programming":"Programming","materials":"Materials","icons":"Icons","audioSettings":"Audio Settings","font":"Font","music":"Music","musicVolume":"Music Volume","soundEffects":"Sound Effects","specialThanks":"Special Thanks","about":"About","aboutText":"Hello fellow explorer!\\nI am the creator of Cosmos Journeyer, and I am glad you\'re interested in this project. It was years in the making you see: back in 2016 already, when I was working on my 3D planetarium, I dreamed about making the planets fully explorable. But then I was limited by how little I knew about computer graphics.\\n\\nI only started Cosmos Journeyer years later as a way to escape from the stress of my studies in French \\"classes pr\xe9paratoires\\". At first, it was only a small procedural planet generator, which was called PlanetEngine. But as ideas kept on coming, I continued working on it for years and the project grew way beyond what I had imagined at first.\\n\\nAs I understand now that such projects cannot be achieved alone, I decided to open-source Cosmos Journeyer so that anyone can freely use and modify it to their liking and even contribute to the project.\\n\\nI hope you will enjoy CosmosJourneyer as much as I enjoy making it!","emailContact":"If you have any question about Cosmos Journeyer, feel free to contact me at <a href=\\"mailto:barth.paleologue@cosmosjourneyer.com\\">barth.paleologue@cosmosjourneyer.com</a>"}')},96690:function(e){"use strict";e.exports=JSON.parse('{"welcomeTo":"Welcome to","missions":"Missions","missionsDescription":"Find your next destination","market":"Market","marketDescription":"Buy and sell resources","explorationCenter":"Exploration Center","explorationCenterDescription":"Sell your discoveries to the Encyclopaedia","shipHangar":"Ship Hangar","shipHangarDescription":"Refuel and outfit your ship","stationInformation":"Station","stationInformationDescription":"Station information","takeOff":"Take Off","takeOffDescription":"Continue your journey","outfitting":"Outfitting","refuel":"Refuel","otherSpaceships":"Other Spaceships","noOtherSpaceship":"No other spaceship","cmdrNameChangePrompt":"How do you want to be called Commander?","primarySlots":"Primary","optionalSlots":"Optionals","equippedComponent":"Equipped","storeButton":"Store","sellButton":"Sell","sellConfirmation":"Are you sure you want to sell this component for {{price}}?","selectedComponent":"Selected","buyEquipButton":"Buy & Equip","equipButton":"Equip","yourSpareParts":"Your spare parts","availableSpareParts":"Available spare parts","noComponentSlotSelected":"No component slot selected","noOwnedSparePartsForSlot":"You don\'t own compatible spare parts for this slot","noComponentEquippedOnSlot":"No component equipped on this slot","noComponentSelected":"No component selected","value":"Value","range":"Range","scoopRate":"Scoop Rate","capacity":"Capacity","relativeRange":"Relative Range","maxSpeed":"Max Speed"}')},61830:function(e){"use strict";e.exports=JSON.parse('{"distance":"Distance","planets":"Planets","plotItinerary":"Plot Itinerary","bookmark":"Bookmark","bookmarked":"Bookmarked","distanceToSol":"Distance to Sol","distanceFromCurrent":"Distance","humanPresence":"Human Presence","spaceStations":"Space Stations","factions":"Factions","none":"None","generalInfo":"General"}')},95509:function(e){"use strict";e.exports=JSON.parse('{"moreWillComeSoon":"More tutorials will come in the future!","navigationInfo":"<p>To move forward in the tutorial, simply press {{nextKeys}}. You can go back to the previous panel by pressing {{previousKeys}}.</p>","quit":"Quit","next":"Next","previous":"Previous","tutorialEnding":"<p>This tutorial and others are available at any time from the main menu and the pause menu.</p><p>Press {{keyQuit}} to leave the tutorial.</p>","loadTutorialWillLeaveGame":"Loading this tutorial will leave your current game. An autosave has just been made. Continue loading the tutorial?","quitConfirm":"You are about to quit the tutorial. Are you sure?"}')},51752:function(e){"use strict";e.exports=JSON.parse('{"title":"Flight Tutorial","description":"Learn the basics of space flight in less than 5 minutes.","welcome":"Welcome to Cosmos Journeyer, Commander! If this is your first time, this tutorial will cover the basics of space flight.","spaceShipRotationTitle":"Spaceship Rotation","spaceShipRotationText1":"The spaceship rotation is controlled by the mouse. Moving the mouse left or right will make the spaceship roll. Moving the mouse up or down will make the spaceship pitch.","spaceShipRotationText2":"The yellow arrow on the screen is there to help you understand the orientation of the spaceship. Its opacity also indicates the rate of rotation.","spaceShipRotationText3":"Try to get a feel for the controls by rotating the spaceship. You will get better at it with practice.","spaceShipThrustTitle":"Spaceship Thrust","spaceShipThrustText1":"You can throttle the main engines with {{keyIncrease}} and {{keyDecrease}}. Pressing {{keyKill}} will set the throttle to zero.","spaceShipThrustText2":"Your throttle is displayed as a vertical progress bar on the bottom right of the screen alongside your speed.","spaceShipThrustText3":"Try flying around in the asteroid field to get familiar with the controls.","spaceShipWarpDriveTitle":"Warp Drive","spaceShipWarpDriveText1":"Moving between planets and stars will often require faster than light (FTL) travel in order to reach your destination before the heat death of the universe.","spaceShipWarpDriveText2":"Your spaceship comes equipped with a warp drive to do just that. Pressing {{keyToggle}} will toggle the warp drive on and off. The warp throttle can be adjusted like for the main engines.","spaceShipWarpDriveText3":"Fly up or down to leave the asteroid field and then engage your warp drive to fly away to the stars!","spaceShipTargetingTitle":"Targeting","spaceShipTargetingText1":"Getting lost in space is fairly easy! Thankfully your spaceship comes equipped with a targeting system to help with that.","spaceShipTargetingText2":"Pressing {{keyTarget}} will target the object closest to the center of the screen. This will display the info until you get close enough (it will then fade out). Space stations have a squarish target icon.","spaceShipTargetingText3":"The radar (on the bottom right of the screen) can help you with orientation when you are not facing your target. An empty circle means the target is behind your ship, while a full dot means the target is in front of your ship.","congratulationsText1":"Congratulations, Commander! You have completed the flight tutorial. You are now ready to explore the cosmos. Good luck, and have fun!"}')},25904:function(e){"use strict";e.exports=JSON.parse('{"title":"Fuel Scooping","description":"Learn how to manage your fuel in space.","welcome":"Welcome, Commander! This tutorial will teach you how to avoid running out of fuel during your exploration.","whatIsFuel":"All ships consume fuel to travel through space between stars. Without fuel, you could end up stranded far from any civilization!","whereFuelIcon":"Your ship\'s fuel level is indicated by the gauge at the bottom right of the interface (highlighted in yellow in the image above).\\n\\n The gauge is initially white and empties with each use of the frame shift drive. The further the destination, the more the gauge empties.","howToFuelScoop":"It is possible to collect fuel around stars and gas giants. To do this, fly as close as possible to the star and watch the fuel gauge increase."}')},27722:function(e){"use strict";e.exports=JSON.parse('{"title":"Star Map","description":"Master interstellar travel with the star map.","welcome":"This tutorial will teach you how to use the star map to master interstellar travel.","open1":"Finding your way among the stars is not trivial without a map.","open2":"To open the star map, press <strong>{{keys}}</strong>.","open3":"Pressing the same key again will close the star map.","controls1":"You can drag the camera around the center of the view with the mouse. To translate the center of the view, use <strong>{{keys}}</strong>.","controls2":"You can zoom with the mouse wheel, and nearby stars can be selected by clicking on them.","missions1":"If you have ongoing missions, you can find your destinations thanks to the orange icons on the map.","missions2":"You can click on the icon to target the system","system1":"Once you have selected a system, its infos will be displayed on the left of the screen.","system2":"You can add it to your bookmarks by clicking the \\"Bookmark\\" button.","system3":"To plot an itinerary, click on the \\"Plot itinerary\\" button. This will create a sequence of interstellar jumps for you to follow","travel1":"To follow your itinerary, close the star map and align your ship with your target.","travel2":"Once aligned, press <strong>{{keys}}</strong> to warp to the system.","travel3":"You can repeat this process until you reach your destination.","congratulations":"Congratulations! You now know how to use the star map. I hope you will find it useful in your interstellar adventures!"}')},87255:function(e){"use strict";e.exports=JSON.parse('{"title":"Space stations","description":"Learn how to land at a space station.","welcome":"Welcome, Commander! This tutorial will teach you how to land at a space station.","whatAreStations":"Space stations are large orbital facilities where you can find missions, take care of your ship and trade commodities.","whereLandingBay":"In order to land, you must find the landing bay as shown in the picture. The bay is a small ring at one of the station ends.","landingRequest":"To get access to the bay, start by sending a landing request to the station using {{keys}}.","requestAccepted":"Once your request is accepted, you can get closer to your landing pad.","beCareful":"Going to fast might result in your ship crashing in the station, so be careful!","autoLanding":"The ship will land itself safely during the final approach.","services1":"Once your ship has landed, you can access the various services of the station.","services2":"Take your time to explore them. You can take new missions, refuel your ship and more before leaving for space again!"}')},76355:function(e){"use strict";e.exports=JSON.parse('{"shortM":"{{value}} m","shortKm":"{{value}} km","shortMm":"{{value}} Mm","shortLy":"{{value}} ly","shortLs":"{{value}} ls","years_one":"{{count}} year","years_other":"{{count}} years","days_one":"{{count}} day","days_other":"{{count}} days","hours_one":"{{count}} hour","hours_other":"{{count}} hours","minutes_one":"{{count}} minute","minutes_other":"{{count}} minutes","seconds_one":"{{count}} second","seconds_other":"{{count}} seconds","shortYears":"{{count}} y","shortDays":"{{count}} d","shortHours":"{{count}} h","shortMinutes":"{{count}} m","shortSeconds":"{{count}} s"}')},39094:function(e){"use strict";e.exports=JSON.parse('{"loading":"Chargement...","fullscreen":"Appuyez sur F11 pour entrer en plein \xe9cran !","or":"ou","and":"et","sellFor":"Vendre pour {{price}}","sellAllFor":"Vendre tout pour {{price}}","unknown":"Inconnu","cancel":"Annuler","confirm":"Confirmer","ok":"OK"}')},57103:function(e){"use strict";e.exports=JSON.parse('{"emptySlot":"Emplacement vide","warpDrive":"Moteur de distorsion","fuelTank":"R\xe9servoir de carburant","fuelScoop":"R\xe9colteur de carburant","discoveryScanner":"Scanner de d\xe9couverte","thrusters":"Propulseurs"}')},31385:function(e){"use strict";e.exports=JSON.parse('{"explorationCenter":"Centre d\'exploration","activeEncyclopaediaInstances":"Instances actives de l\'Encyclopaedia : {{value}}","addNewInstance":"Ajouter une nouvelle instance","filterLocal":"Donn\xe9es locales","filterUploaded":"Donn\xe9es t\xe9l\xe9charg\xe9es","filterAll":"Toutes les donn\xe9es","searchForADiscovery":"Chercher une d\xe9couverte","noDiscoveryTitle":"Pas de nouvelles d\xe9couvertes","noDiscoveryText":"L\'univers vous attend !","detailsPlaceholder":"S\xe9lectionnez une d\xe9couverte pour voir plus de d\xe9tails."}')},84473:function(e){"use strict";e.exports=JSON.parse('{"newJourney":"Nouveau Voyage","loadSave":"Charger une partie","settings":"Param\xe8tres","tutorials":"Tutoriels","contribute":"Contribuer","credits":"Cr\xe9dits","about":"A propos"}')},50292:function(e){"use strict";e.exports=JSON.parse('{"missionCompleted":"Mission r\xe9ussie. Attention aux ast\xe9ro\xefdes CMDR !"}')},29180:function(e){"use strict";e.exports=JSON.parse('{"travelToTargetSystem":"Voyagez jusqu\'\xe0 {{systemName}} ({{distance}}).","openStarMap":"Appuyez sur {{starMapKey}} pour ouvrir la carte stellaire.","travelToNextSystem":"Poursuivez votre voyage en passant par {{systemName}} ({{distance}}). Il reste {{nbJumps}} sauts avant d\'arriver \xe0 destination.","getCloserToTarget":"Approchez vous de {{objectName}}","corruptedItinerary":"L\'itin\xe9raire est corrompu. Ouvrez la carte stellaire pour tracer un nouveau parcours.","here":"ici","accept":"Accepter","accepted":"Accept\xe9e","noActiveMission":"Pas de mission active","whereToGetMissions":"Vous pouvez obtenir des missions dans les stations spatiales.","next":"Suivant","previous":"Pr\xe9c\xe9dent"}')},41083:function(e){"use strict";e.exports=JSON.parse('{"missionCompleted":"Mission r\xe9ussie. Profitez de la vue CMDR !"}')},75503:function(e){"use strict";e.exports=JSON.parse('{"describeFlyBy":"Survoler {{objectType}} dans {{systemName}} ({{distance}})","describeTerminatorLanding":"Att\xe9rir pr\xe8s du terminateur de {{objectName}} dans {{systemName}} ({{distance}})","describeAsteroidFieldTrek":"Excursion au sein du champ d\'ast\xe9ro\xefdes de {{objectName}} dans {{systemName}} ({{distance}})","flyBy":"Survol","terminatorLanding":"Atterrissage au terminateur","asteroidFieldTrek":"Excursion au champ d\'ast\xe9ro\xefdes"}')},76083:function(e){"use strict";e.exports=JSON.parse('{"getCloserToTerminator":"Approchez vous du terminateur de {{objectName}}","missionCompleted":"Mission r\xe9ussie. Profitez de la vue CMDR !"}')},5713:function(e){"use strict";e.exports=JSON.parse('{"howToFly":"La souris contr\xf4le le tangage et le roulis du vaisseau. La position neutre se trouve au centre de l\'\xe9cran.","landingSequenceEngaged":"D\xe9but de la s\xe9quence d\'atterrissage.","landingComplete":"Atterrissage r\xe9ussi ! Utilisez {{bindingsString}} pour sortir du vaisseau.","landingCancelled":"Atterrissage annul\xe9.","autoPilotEngaged":"Pilote automatique activ\xe9. D\xe9tendez-vous.","takeOffSuccess":"D\xe9collage r\xe9ussi.","copiedToClipboard":"Copi\xe9 dans le presse-papiers.","howToLiftOff":"Maintenez {{bindingsString}} pour d\xe9coller.","howToHyperSpace":"Alignez votre vaisseau avec la cible du syst\xe8me de destination \xe0 l\'aide du radar de cible en bas \xe0 droite de l\'\xe9cran. Appuyez ensuite sur {{bindingsString}} pour enclencher le saut hyperspatial.","notEnoughFuel":"Saut hyperspatial impossible. Carburant insuffisant! Le carburant peut \xeatre achet\xe9 en station ou r\xe9colt\xe9 autour d\'une \xe9toile ou d\'une g\xe9ante gazeuse.","saveVersionMismatch":"[VERSION_WARNING] La version du fichier de sauvegarde ({{saveVersion}}) ne correspond pas \xe0 la version actuelle ({{currentVersion}}). Le chargement peut entra\xeener un comportement inattendu.","invalidSaveFileJson":"Le fichier de sauvegarde n\'est pas un JSON valide. Veuillez v\xe9rifier votre fichier de sauvegarde.","failedToParseSaves":"Echec de l\'analyse des sauvegardes. Veuillez consulter la console pour plus d\'informations.","invalidStorageFormat":"Format de stockage invalide. Veuillez consulter la console pour plus d\'informations.","saveOk":"Sauvegard\xe9 avec succ\xe8s dans le stockage local.","cantSaveTutorial":"Impossible de sauvegarder pendant un tutoriel.","newDiscovery":"D\xe9couverte de {{objectName}}. Enregistrement des donn\xe9es effectu\xe9es.","unknownKeyboardLayout":"Impossible de d\xe9tecter votre disposition de clavier. La disposition QWERTY sera utilis\xe9e par d\xe9faut."}')},40597:function(e){"use strict";e.exports=JSON.parse('{"starSystem":"Syst\xe8me Solaire","star":"\xc9toile de type {{stellarType}}","neutronStar":"\xc9toile \xe0 Neutrons","blackHole":"Trou Noir","gasPlanet":"Plan\xe8te Gazeuse","telluricPlanet":"Plan\xe8te Tellurique","telluricMoon":"Lune Tellurique","spaceStation":"Station Spatiale","spaceElevator":"Ascenseur Spatial","custom":"Objet Personnalis\xe9","spaceElevatorClimber":"Nacelle de l\'Ascenseur Spatial","anomaly":"Anomalie","landingPad":"Plateforme d\'Atterrissage"}')},40009:function(e){"use strict";e.exports=JSON.parse('{"period":"P\xe9riode orbitale : {{value}}","radius":"Rayon de l\'orbite : {{value}}"}')},40023:function(e){"use strict";e.exports=JSON.parse('{"siderealDayDuration":"Dur\xe9e d\'une journ\xe9e sid\xe9rale: {{value}}","type":"Type : {{value}}"}')},81876:function(e){"use strict";e.exports=JSON.parse('{"resume":"Reprendre","save":"Sauvegarder","load":"Charger","tutorials":"Tutoriels","settings":"Param\xe8tres","contribute":"Contribuer","share":"Partager la position","screenshot":"Capture d\'\xe9cran"}')},90506:function(e){"use strict";e.exports=JSON.parse('{"loadSave":"Charger une sauvegarde","dropASaveFileHere":"D\xe9posez un fichier de sauvegarde ici","lastPlayedOn":"Derni\xe8re exploration le {{val, datetime}}","journeyedFor":"Explor\xe9 pendant {{nbHours}} heures","cmdrNameChangePrompt":"Comment souhaitez-vous appeler ce Commandant ? Cette action affectera toutes les sauvegardes de ce Commandant.","deleteSavePrompt":"La suppression de cette sauvegarde est irr\xe9versible. Vous pouvez toujours t\xe9l\xe9charger une copie avant ! \xcates-vous s\xfbr de vouloir continuer ?","landedAt":"Pos\xe9 \xe0 {{location}}","near":"Pr\xe8s de {{location}}","locationNotFound":"Erreur: Localisation introuvable dans la base de donn\xe9es","tutorials":"Tutoriels","tutorialsWarning":"Si c\'est la premi\xe8re fois que vous jouez, vous pouvez simplement commencer une nouvelle partie : les tutoriels seront naturellement pr\xe9sent\xe9s au cours de la partie !","settings":"Param\xe8tres","contribute":"Contribuer","bugReports":"Signaler un bug","bugReportsText":"Si vous rencontrez un bug lors de votre exploration, merci de l\'ajouter au <a href=\\"https://github.com/BarthPaleologue/CosmosJourneyer/issues\\">tracker de bugs</a>. Vous pouvez aussi envoyer un email \xe0 <a href=\\"mailto:barth.paleologue@cosmosjourneyer.com\\">barth.paleologue@cosmosjourneyer.com</a>. Envoyer des captures d\'\xe9cran et des fichiers de sauvegarde peut grandement aider le processus de d\xe9bogage.","translation":"Traduction","translationText":"Traduire Cosmos Journeyer le rend accessible \xe0 plus de personnes \xe0 travers le monde ! Vous n\'avez pas besoin de comp\xe9tences en programmation, seulement d\'une ma\xeetrise d\'une langue non support\xe9e ou qui peut \xeatre am\xe9lior\xe9e. Vous pouvez acc\xe9der au guide de traduction <a href=\\"https://github.com/BarthPaleologue/CosmosJourneyer/CONTRIBUTING.md#translation\\">ici</a>.","knowHowToCode":"Vous savez coder ?","knowHowToCodeText":"Cosmos Journeyer est un projet open-source, ce qui signifie que n\'importe qui peut aider \xe0 le construire ! Pourquoi pas vous ?\\n Vous pouvez consulter <a target=\\"_blank\\" href=\\"https://github.com/BarthPaleologue/CosmosJourneyer\\">le d\xe9p\xf4t du projet</a> pour plus de d\xe9tails. Merci de lire les directives de contribution avant de commencer \xe0 contribuer \xe0 Cosmos Journeyer.","supportFinancially":"Soutenir financi\xe8rement","supportFinanciallyText":"Construire Cosmos Journeyer demande beaucoup de temps et d\'efforts tout en \xe9tant gratuit pour tout le monde. Si le coeur vous en dit, vous pouvez sponsoriser le projet via <a target=\\"_blank\\" href=\\"https://www.patreon.com/barthpaleologue\\">Patreon</a> ou <a target=\\"_blank\\" href=\\"https://ko-fi.com/cosmosjourneyer\\">Ko-fi</a>. Votre soutien m\'aidera \xe0 consacrer plus de temps au projet et \xe0 le rendre encore meilleur !","credits":"Cr\xe9dits","contributors":"Contributeurs","programming":"Programmation","materials":"Mat\xe9riaux","icons":"Ic\xf4nes","font":"Police","music":"Musique","soundEffects":"Effets sonores","specialThanks":"Remerciements","about":"\xc0 propos","aboutText":"Bienvenue cher explorateur !\\nJe suis le cr\xe9ateur de Cosmos Journeyer, et je suis ravi que vous soyez int\xe9ress\xe9. Longtemps, j\'ai r\xeav\xe9 de faire ce project. En 2016 d\xe9j\xe0 lorsque je travaillais sur mon Plan\xe9tarium en 3D, j\'imaginais rendre les plan\xe8tes enti\xe8rement explorables. Mais mes connaissances en informatique graphique \xe9taient alors trop limit\xe9es.\\n\\nJ\'ai commenc\xe9 Cosmos Journeyer bien des ann\xe9es plus tard, comme une fa\xe7on d\'\xe9chapper au stress des concours des classes pr\xe9paratoires. Cela a commenc\xe9 par un petit g\xe9n\xe9rateur de plan\xe8tes, que j\'appelais PlanetEngine (\\"moteur \xe0 plan\xe8te\\"). Mais plus je travaillais dessus, et plus j\'avais des nouvelles id\xe9es. Apr\xe8s plus de 3 ann\xe9es de travail, je peux dire que le projet est all\xe9 bien au del\xe0 de ce que j\'imaginais pouvoir faire au d\xe9but.\\n\\nIl serait illusoire de penser que je puisse seul terminer Cosmos Journeyer un jour. C\'est pourquoi j\'ai d\xe9cid\xe9 de rendre le projet open-source, afin que chacun puisse l\'utiliser et le modifier \xe0 sa guise, et m\xeame contribuer au projet dans les ann\xe9es \xe0 venir.\\n\\nJ\'esp\xe8re que vous aimerez Cosmos Journeyer autant que j\'aime le cr\xe9er !","emailContact":"Si vous avez des questions sur Cosmos Journeyer, n\'h\xe9sitez pas \xe0 me contacter \xe0 <a href=\\"mailto:barth.paleologue@cosmosjourneyer.com\\">barth.paleologue@cosmosjourneyer.com</a>"}')},47897:function(e){"use strict";e.exports=JSON.parse('{"welcomeTo":"Bienvenue \xe0","missions":"Missions","missionsDescription":"Trouvez votre prochaine destination","market":"March\xe9","marketDescription":"Achetez et vendez des ressources","explorationCenter":"Centre d\'exploration","explorationCenterDescription":"Vendez vos d\xe9couvertes \xe0 l\'Encyclop\xe9die","shipHangar":"Hangar de vaisseaux","shipHangarDescription":"Faites le plein et \xe9quipez votre vaisseau","stationInformation":"Station","stationInformationDescription":"Informations sur la station","takeOff":"D\xe9coller","takeOffDescription":"Continuez votre voyage","outfitting":"\xc9quipement","refuel":"Faire le plein","otherSpaceships":"Autres vaisseaux","noOtherSpaceship":"Aucun autre vaisseau","cmdrNameChangePrompt":"Comment souhaitez-vous \xeatre appel\xe9 Commandant ?","primarySlots":"Primordiaux","optionalSlots":"Optionnels","equippedComponent":"\xc9quip\xe9","storeButton":"Stocker","sellButton":"Vendre","sellConfirmation":"\xcates-vous s\xfbr de vouloir vendre ce composant pour {{price}} ?","selectedComponent":"S\xe9lectionn\xe9","buyEquipButton":"Acheter & \xc9quiper","equipButton":"\xc9quiper","yourSpareParts":"Vos pi\xe8ces de rechange","availableSpareParts":"Pi\xe8ces de rechange disponibles","noComponentSlotSelected":"Aucun emplacement de composant s\xe9lectionn\xe9","noOwnedSparePartsForSlot":"Vous ne poss\xe9dez pas de pi\xe8ces de rechange compatibles pour cet emplacement","noComponentEquippedOnSlot":"Aucun composant \xe9quip\xe9 sur cet emplacement","noComponentSelected":"Aucun composant s\xe9lectionn\xe9","value":"Valeur","range":"Port\xe9e","scoopRate":"Taux de collecte","capacity":"Capacit\xe9","relativeRange":"Port\xe9e relative","maxSpeed":"Vitesse max"}')},39:function(e){"use strict";e.exports=JSON.parse('{"distance":"Distance","planets":"Plan\xe8tes","plotItinerary":"Tracer l\'itin\xe9raire","bookmark":"Favoris","bookmarked":"Favoris","distanceToSol":"Distance \xe0 Sol","distanceFromCurrent":"Distance","humanPresence":"Pr\xe9sence humaine","spaceStations":"Stations spatiales","factions":"Factions","none":"Aucune","generalInfo":"G\xe9n\xe9ral"}')},87946:function(e){"use strict";e.exports=JSON.parse('{"moreWillComeSoon":"Plus de tutoriels dans le futur !","navigationInfo":"<p>Pour avancer dans le tutoriel, appuyez sur {{nextKeys}}. Vous pouvez revenir aux \xe9tapes pr\xe9c\xe9dentes avec {{previousKeys}}.</p>","quit":"Quitter","next":"Suivant","previous":"Pr\xe9c\xe9dent","tutorialEnding":"<p>Ce tutoriel et d\'autres sont disponibles \xe0 tout moment depuis le menu principal et le menu de pause.</p><p>Appuyez sur {{keyQuit}} pour quitter le tutoriel.</p>","loadTutorialWillLeaveGame":"Charger ce tutoriel quittera votre partie actuelle. Une sauvegarde automatique vient d\'\xeatre effectu\xe9e. Continuer de charger le tutoriel ?","quitConfirm":"Vous \xeates sur le point de quitter le tutoriel. \xcates-vous s\xfbr ?"}')},62687:function(e){"use strict";e.exports=JSON.parse('{"title":"Les bases du vol","description":"Apprenez les bases du vol spatial en moins de 5 minutes.","welcome":"Bienvenue dans Cosmos Journeyer, Commandant ! Si c\'est votre premi\xe8re fois, ce tutoriel couvre les bases du vol spatial.","spaceShipRotationTitle":"Rotation du vaisseau","spaceShipRotationText1":"La rotation du vaisseau est contr\xf4l\xe9e par la souris. D\xe9placer la souris \xe0 gauche ou \xe0 droite contr\xf4le le roulis du vaisseau. D\xe9placer la souris en haut ou en bas fera cabrer ou piquer le vaisseau.","spaceShipRotationText2":"La fl\xe8che jaune \xe0 l\'\xe9cran est l\xe0 pour vous aider \xe0 comprendre l\'orientation du vaisseau. Son opacit\xe9 indique \xe9galement la vitesse de rotation.","spaceShipRotationText3":"Essayez de vous familiariser avec les commandes en faisant tourner le vaisseau. Vous vous am\xe9liorerez avec la pratique.","spaceShipThrustTitle":"Propulsion du vaisseau","spaceShipThrustText1":"Vous pouvez ajuster la propulsion avec {{keyIncrease}} et {{keyDecrease}}. Presser {{keyKill}} mettra la propulsion \xe0 z\xe9ro.","spaceShipThrustText2":"Votre propulsion est affich\xe9e sous forme de barre de progression verticale en bas \xe0 droite de l\'\xe9cran, \xe0 c\xf4t\xe9 de votre vitesse.","spaceShipThrustText3":"Essayez de voler dans le champ d\'ast\xe9ro\xefdes pour vous familiariser avec les commandes.","spaceShipWarpDriveTitle":"Moteur \xe0 distorsion","spaceShipWarpDriveText1":"Se d\xe9placer entre les plan\xe8tes et les \xe9toiles n\xe9cessitera souvent de voyager plus rapidement que la lumi\xe8re (PRL) afin d\'arriver avant la mort de l\'univers.","spaceShipWarpDriveText2":"Votre vaisseau est \xe9quip\xe9 d\'un moteur \xe0 distorsion pour cela. Appuyer sur {{keyToggle}} activera ou d\xe9sactivera le moteur \xe0 distorsion. L\'intensit\xe9 de la distorsion peut \xeatre ajust\xe9e comme pour la pouss\xe9e des moteurs principaux.","spaceShipWarpDriveText3":"Sortez du champ d\'ast\xe9ro\xefdes par le haut ou le bas, puis activez votre moteur \xe0 distorsion pour vous envoler vers les \xe9toiles !","spaceShipTargetingTitle":"Ciblage","spaceShipTargetingText1":"Il est facile de se perdre dans l\'espace ! Heureusement votre vaisseau est \xe9quip\xe9 d\'un syst\xe8me de ciblage.","spaceShipTargetingText2":"La cible la plus proche du centre de l\'\xe9cran peut \xeatre v\xe9rouill\xe9e/d\xe9v\xe9rouill\xe9e en pressant {{keyTarget}}. Les information de la cible vont s\'afficher jusqu\'\xe0 ce que le vaisseau soit assez proche pour rendre le ciblage inutile. Les stations spatiales sont reconnaissables \xe0 leur icone carr\xe9e.","spaceShipTargetingText3":"Le radar (situ\xe9 en bas \xe0 droite de l\'\xe9cran) peut vous aider \xe0 recentrer votre cible au centre de l\'\xe9cran. Un point vide signifie que la cible se trouve derri\xe8re le vaisseau alors qu\'un point plein indique que la cible se trouve devant le vaisseau.","congratulationsText1":"F\xe9licitations, Commandant ! Vous avez termin\xe9 le tutoriel de vol. Vous \xeates maintenant pr\xeat \xe0 explorer le cosmos. Bonne chance et amusez-vous bien !"}')},9371:function(e){"use strict";e.exports=JSON.parse('{"title":"Gestion du carburant","description":"Apprenez \xe0 g\xe9rer votre carburant dans l\'espace.","welcome":"Bienvenue, Commandant ! Ce tutoriel vous apprendra \xe0 \xe9viter la panne s\xe8che lors de votre exploration.","whatIsFuel":"Tous les vaisseaux consomment du carburant pour traverser l\'espace entre les \xe9toiles. Sans carburant, vous pourriez finir coinc\xe9 loin de toute civilisation !","whereFuelIcon":"Le niveau de carburant de votre vaisseau est indiqu\xe9 par la jauge en bas \xe0 droite de l\'interface (encadr\xe9e en jaune dans l\'image ci-dessus).\\n\\n La jauge est initialement blanche et se vide \xe0 chaque utilisation du moteur \xe0 distortion. Plus la destination est \xe9loign\xe9e et plus la jauge se vide.","howToFuelScoop":"Il est possible de r\xe9colter du carburant autour des \xe9toiles et des g\xe9antes gazeuses. Pour cela, volez au plus pr\xe8s de l\'astre et observez la jauge de carburant augmenter."}')},58491:function(e){"use strict";e.exports=JSON.parse('{"title":"Carte Stellaire","description":"Ma\xeetrisez le voyage interstellaire avec la carte stellaire.","welcome":"Ce tutoriel va vous apprendre comment utiliser la carte stellaire pour ma\xeetriser le voyage interstellaire.","open1":"Trouver son chemin parmi les \xe9toiles peut se r\xe9v\xe9ler d\xe9licat sans une carte.","open2":"Pour ouvrir la carte stellaire, appuyez sur <strong>{{keys}}</strong>.","open3":"Appuyer \xe0 nouveau sur la m\xeame touche fermera la carte stellaire.","controls1":"Vous pouvez d\xe9placer la cam\xe9ra autour du centre de la vue avec la souris. Pour d\xe9placer le centre de la vue, utilisez <strong>{{keys}}</strong>.","controls2":"Vous pouvez zoomer avec la molette de la souris, et les \xe9toiles proches peuvent \xeatre s\xe9lectionn\xe9es en cliquant dessus.","missions1":"Si vous avez des missions en cours, vous pouvez trouver vos destinations gr\xe2ce aux ic\xf4nes oranges sur la carte.","missions2":"Vous pouvez cliquer sur l\'ic\xf4ne pour cibler le syst\xe8me","system1":"Une fois que vous avez s\xe9lectionn\xe9 un syst\xe8me, ses informations s\'afficheront sur la gauche de l\'\xe9cran.","system2":"Vous pouvez l\'ajouter \xe0 vos favoris en cliquant sur le bouton \\"Favoris\\".","system3":"Pour tracer un itin\xe9raire, cliquez sur le bouton \\"Tracer itin\xe9raire\\". Cela cr\xe9era une s\xe9quence de sauts interstellaires \xe0 suivre","travel1":"Pour suivre votre itin\xe9raire, fermez la carte stellaire et alignez votre vaisseau avec votre cible.","travel2":"Une fois align\xe9, appuyez sur <strong>{{keys}}</strong> pour voyager vers le syst\xe8me.","travel3":"Vous pouvez r\xe9p\xe9ter ce processus jusqu\'\xe0 ce que vous atteigniez votre destination.","congratulations":"F\xe9licitations ! Vous savez maintenant comment utiliser la carte stellaire. J\'esp\xe8re que vous la trouverez utile dans vos aventures spatiales !"}')},8308:function(e){"use strict";e.exports=JSON.parse('{"title":"Stations spatiales","description":"Apprenez \xe0 atterrir \xe0 une station spatiale.","welcome":"Bienvenue, Commandant ! Ce tutoriel vous apprendra \xe0 atterrir \xe0 une station spatiale.","whatAreStations":"Les stations spatiales sont de grandes installations orbitales o\xf9 vous pouvez trouver des missions, prendre soin de votre vaisseau et \xe9changer des marchandises.","whereLandingBay":"Pour atterrir, vous devez trouver la baie d\'atterrissage comme indiqu\xe9 sur l\'image. La baie est un petit anneau \xe0 l\'une des extr\xe9mit\xe9s de la station.","landingRequest":"Pour acc\xe9der \xe0 la baie, commencez par envoyer une demande d\'atterrissage \xe0 la station en utilisant {{keys}}.","requestAccepted":"Une fois votre demande accept\xe9e, vous pouvez vous rapprocher de votre plateforme d\'atterrissage.","beCareful":"Aller trop vite pourrait entra\xeener le crash de votre vaisseau dans la station, alors soyez prudent !","autoLanding":"Le vaisseau atterrira en toute s\xe9curit\xe9 lors de l\'approche finale.","services1":"Une fois votre vaisseau atterri, vous pouvez acc\xe9der aux diff\xe9rents services de la station.","services2":"Prenez le temps de les explorer. Vous pouvez prendre de nouvelles missions, ravitailler votre vaisseau et plus encore avant de repartir dans l\'espace !"}')},16402:function(e){"use strict";e.exports=JSON.parse('{"shortM":"{{value}} m","shortKm":"{{value}} km","shortMm":"{{value}} Mm","shortLy":"{{value}} al","shortLs":"{{value}} sl","years_one":"{{count}} ann\xe9e","years_other":"{{count}} ann\xe9es","days_one":"{{count}} jour","days_other":"{{count}} jours","hours_one":"{{count}} heure","hours_other":"{{count}} heures","minutes_one":"{{count}} minute","minutes_other":"{{count}} minutes","seconds_one":"{{count}} seconde","seconds_other":"{{count}} secondes","shortYears":"{{count}} a","shortDays":"{{count}} j","shortHours":"{{count}} h","shortMinutes":"{{count}} m","shortSeconds":"{{count}} s"}')}}]);