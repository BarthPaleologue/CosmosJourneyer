"use strict";(globalThis.webpackChunk_cosmos_journeyer_game=globalThis.webpackChunk_cosmos_journeyer_game||[]).push([["3470"],{78701(t,e,i){i.r(e),i.d(e,{FlowGraphPlayAnimationBlock:()=>s});var n=i(69962),r=i(50286),a=i(89110),o=i(27719);class s extends n.M{constructor(t){super(t,["animationLoop","animationEnd","animationGroupLoop"]),this.config=t,this.speed=this.registerDataInput("speed",r.Es),this.loop=this.registerDataInput("loop",r.RI),this.from=this.registerDataInput("from",r.Es,0),this.to=this.registerDataInput("to",r.Es),this.currentFrame=this.registerDataOutput("currentFrame",r.Es),this.currentTime=this.registerDataOutput("currentTime",r.Es),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",r.Vv),this.animationGroup=this.registerDataInput("animationGroup",r.Vv,t?.animationGroup),this.animation=this.registerDataInput("animation",r.Vv),this.object=this.registerDataInput("object",r.Vv)}_preparePendingTasks(t){let e=this.animationGroup.getValue(t),i=this.animation.getValue(t);if(!e&&!i)return this._reportError(t,"No animation or animation group provided");{let n=this.currentAnimationGroup.getValue(t);n&&n!==e&&n.dispose();let r=e;if(i&&!r){let e=this.object.getValue(t);if(!e)return this._reportError(t,"No target object provided");let n=Array.isArray(i)?i:[i],a=n[0].name;r=new o.AnimationGroup("flowGraphAnimationGroup-"+a+"-"+e.name,t.configuration.scene);let s=!1,u=t._getGlobalContextVariable("interpolationAnimations",[]);for(let t of n)r.addTargetedAnimation(t,e),-1!==u.indexOf(t.uniqueId)&&(s=!0);s&&this._checkInterpolationDuplications(t,n,e)}let a=this.speed.getValue(t)||1,s=this.from.getValue(t)??0,u=this.to.getValue(t)||r.to,l=!isFinite(u)||this.loop.getValue(t);this.currentAnimationGroup.setValue(r,t);let p=t._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==p.indexOf(r.uniqueId)&&r.stop();try{r.start(l,a,s,u),r.onAnimationGroupEndObservable.add(()=>this._onAnimationGroupEnd(t)),r.onAnimationEndObservable.add(()=>this._eventsSignalOutputs.animationEnd._activateSignal(t)),r.onAnimationLoopObservable.add(()=>this._eventsSignalOutputs.animationLoop._activateSignal(t)),r.onAnimationGroupLoopObservable.add(()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(t)),p.push(r.uniqueId),t._setGlobalContextVariable("currentlyRunningAnimationGroups",p)}catch(e){this._reportError(t,e)}}}_reportError(t,e){super._reportError(t,e),this.currentFrame.setValue(-1,t),this.currentTime.setValue(-1,t)}_executeOnTick(t){let e=this.currentAnimationGroup.getValue(t);e&&(this.currentFrame.setValue(e.getCurrentFrame(),t),this.currentTime.setValue(e.animatables[0]?.elapsedTime??0,t))}_execute(t){this._startPendingTasks(t)}_onAnimationGroupEnd(t){this._removeFromCurrentlyRunning(t,this.currentAnimationGroup.getValue(t)),this._resetAfterCanceled(t),this.done._activateSignal(t)}_checkInterpolationDuplications(t,e,i){for(let n of t._getGlobalContextVariable("currentlyRunningAnimationGroups",[])){let r=t.assetsContext.animationGroups.find(t=>t.uniqueId===n);if(r)for(let n of r.targetedAnimations)for(let a of e)n.animation.targetProperty===a.targetProperty&&n.target===i&&this._stopAnimationGroup(t,r)}}_stopAnimationGroup(t,e){e.stop(!0),e.dispose(),this._removeFromCurrentlyRunning(t,e)}_removeFromCurrentlyRunning(t,e){let i=t._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),n=i.indexOf(e.uniqueId);-1!==n&&(i.splice(n,1),t._setGlobalContextVariable("currentlyRunningAnimationGroups",i))}_cancelPendingTasks(t){let e=this.currentAnimationGroup.getValue(t);e&&this._stopAnimationGroup(t,e)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,a.Y5)("FlowGraphPlayAnimationBlock",s)}}]);