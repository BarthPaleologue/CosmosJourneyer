/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunk_cosmos_journeyer_game=globalThis.webpackChunk_cosmos_journeyer_game||[]).push([["3808"],{91857:function(e,t,n){e.exports=n.p+"fd7997898bbeb1f1.wasm"},78381:function(e,t,n){e.exports=n.p+"869739fc3ede15e2.js"},67556:function(e,t,n){n.d(t,{QU:()=>d});var r=n(67902),a=n(29743),i=n(52628),o=(0,a.p)(i.w.POWER_PLAY_SEED),s=0,l=(0,r.makeNoise3D)(function(){return o(s++)}),c=(0,a.p)(i.w.POWER_PLAY_SEED+598),u=0,h=(0,r.makeNoise3D)(function(){return c(u++)});function d(e){var t,n;return{materialistSpiritualist:(t=e.x,.5*l(.2*t,.2*e.y,.2*e.z)+.5),capitalistCommunist:(n=e.x,.5*h(.2*n,.2*e.y,.2*e.z)+.5)}}},76945:function(e,t,n){function r(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{bk:()=>v,Wo:()=>p,Lr:()=>m});var s,l=function(){function e(t,n,a,i){r(this,e),o(this,"sound",void 0),o(this,"targetVolume",void 0),o(this,"volumeMultiplier",void 0),o(this,"playbackSpeedMultiplier",void 0),o(this,"maskFactor",1),o(this,"mask",void 0);var s=t.clone();if(null===s)throw Error("Cloned sound was null!");this.sound=s,this.mask=n,this.targetVolume=a,this.volumeMultiplier=t.getVolume(),this.playbackSpeedMultiplier=t.getPlaybackRate(),this.sound.updateOptions({playbackRate:this.playbackSpeedMultiplier,volume:this.targetVolume*this.volumeMultiplier*this.maskFactor,loop:!i})}return i(e,[{key:"play",value:function(){this.sound.play()}},{key:"setVolume",value:function(e){this.targetVolume=e,this.sound.setVolume(this.targetVolume*this.volumeMultiplier*this.maskFactor,.5)}},{key:"setMaskFactor",value:function(e){this.maskFactor=e,this.sound.setVolume(this.targetVolume*this.volumeMultiplier*this.maskFactor,.5)}},{key:"getMask",value:function(){return this.mask}},{key:"dispose",value:function(){this.sound.dispose()}}]),e}(),c=function(){function e(){r(this,e)}return i(e,[{key:"play",value:function(){}},{key:"setVolume",value:function(){}},{key:"setMaskFactor",value:function(){}},{key:"getMask",value:function(){return 0}},{key:"dispose",value:function(){}}]),e}();function u(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=((s={})[s.CLICK=0]="CLICK",s[s.HOVER=1]="HOVER",s[s.SUCCESS=2]="SUCCESS",s[s.ERROR=3]="ERROR",s[s.WARNING=4]="WARNING",s[s.INFO=5]="INFO",s[s.ENABLE_ORBIT_DISPLAY=6]="ENABLE_ORBIT_DISPLAY",s[s.DISABLE_ORBIT_DISPLAY=7]="DISABLE_ORBIT_DISPLAY",s[s.TARGET_LOCK=8]="TARGET_LOCK",s[s.TARGET_UNLOCK=9]="TARGET_UNLOCK",s[s.ITINERARY_COMPUTED=10]="ITINERARY_COMPUTED",s[s.OPEN_PAUSE_MENU=11]="OPEN_PAUSE_MENU",s[s.ENABLE_WARP_DRIVE=12]="ENABLE_WARP_DRIVE",s[s.DISABLE_WARP_DRIVE=13]="DISABLE_WARP_DRIVE",s[s.ACCELERATING_WARP_DRIVE=14]="ACCELERATING_WARP_DRIVE",s[s.DECELERATING_WARP_DRIVE=15]="DECELERATING_WARP_DRIVE",s[s.HYPER_SPACE=16]="HYPER_SPACE",s[s.THRUSTER=17]="THRUSTER",s),m=function(){function e(t){u(this,e),f(this,"sounds",void 0),f(this,"isPlaying",!1),f(this,"soundQueue",[]),f(this,"soundInstances",new Set),f(this,"soundInstanceMask",15),this.sounds=t}return d(e,[{key:"getSoundFromType",value:function(e){switch(e){case 0:case 4:case 5:return this.sounds.menuSelect;case 2:return this.sounds.success;case 3:return this.sounds.error;case 1:case 6:case 7:return this.sounds.menuHover;case 8:return this.sounds.targetLock;case 9:case 10:return this.sounds.targetUnlock;case 11:return this.sounds.openPauseMenu;case 12:return this.sounds.enableWarpDrive;case 13:return this.sounds.disableWarpDrive;case 14:return this.sounds.acceleratingWarpDrive;case 15:return this.sounds.deceleratingWarpDrive;case 16:return this.sounds.hyperSpace;case 17:return this.sounds.thruster}}},{key:"playNow",value:function(e){this.getSoundFromType(e).play()}},{key:"enqueuePlay",value:function(e){this.soundQueue.push(this.getSoundFromType(e))}},{key:"createInstance",value:function(e,t,n,r){var a=new l(this.getSoundFromType(e),t,n,r);return this.soundInstances.add(a),a.setMaskFactor(+((t&this.soundInstanceMask)!=0)),a}},{key:"freeInstance",value:function(e){this.soundInstances.delete(e),e.dispose()}},{key:"setInstanceMask",value:function(e){this.soundInstanceMask=e}},{key:"update",value:function(){var e=this,t=!0,n=!1,r=void 0;try{for(var a,i=this.soundInstances[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,s=(o.getMask()&this.soundInstanceMask)!=0;o.setMaskFactor(+!!s)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}if(!this.isPlaying){var l=this.soundQueue.shift();void 0!==l&&(this.isPlaying=!0,l.play(),l.onEndedObservable.addOnce(function(){e.isPlaying=!1}))}}}]),e}(),v=function(){function e(){u(this,e)}return d(e,[{key:"playNow",value:function(){}},{key:"enqueuePlay",value:function(){}},{key:"createInstance",value:function(){return new c}},{key:"freeInstance",value:function(){}},{key:"setInstanceMask",value:function(){}},{key:"update",value:function(){}}]),e}()},12014:function(e,t,n){n.d(t,{_l:()=>l,bm:()=>s,yT:()=>o});function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a,i,o=((a={})[a.CHARLOTTE=0]="CHARLOTTE",a),s=((i={})[i.INITIATING_PLANETARY_LANDING=0]="INITIATING_PLANETARY_LANDING",i[i.LANDING_REQUEST_GRANTED=1]="LANDING_REQUEST_GRANTED",i[i.LANDING_COMPLETE=2]="LANDING_COMPLETE",i[i.MISSION_COMPLETE=3]="MISSION_COMPLETE",i[i.NEW_DISCOVERY=4]="NEW_DISCOVERY",i[i.CANNOT_ENGAGE_WARP_DRIVE=5]="CANNOT_ENGAGE_WARP_DRIVE",i[i.WARP_DRIVE_EMERGENCY_SHUT_DOWN=6]="WARP_DRIVE_EMERGENCY_SHUT_DOWN",i[i.WARP_DRIVE_DISENGAGED=7]="WARP_DRIVE_DISENGAGED",i[i.ENGAGING_WARP_DRIVE=8]="ENGAGING_WARP_DRIVE",i[i.FUEL_SCOOPING=9]="FUEL_SCOOPING",i[i.FUEL_SCOOPING_COMPLETE=10]="FUEL_SCOOPING_COMPLETE",i[i.LOW_FUEL_WARNING=11]="LOW_FUEL_WARNING",i),l=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");r(this,"voiceLines",void 0),r(this,"isPlaying",!1),r(this,"soundQueue",new Set),this.voiceLines=e}return e=[{key:"getLineFromVoiceLines",value:function(e,t){switch(t){case 0:return e.initiatingPlanetaryLanding;case 1:return e.landingRequestGranted;case 2:return e.landingComplete;case 3:return e.missionComplete;case 4:return e.newDiscovery;case 5:return e.cannotEngageWarpDrive;case 6:return e.warpDriveEmergencyShutDown;case 7:return e.warpDriveDisengaged;case 8:return e.engagingWarpDrive;case 9:return e.fuelScooping;case 10:return e.fuelScoopingComplete;case 11:return e.lowFuelWarning}}},{key:"getVoiceLinesFromSpeaker",value:function(e){if(0===e)return this.voiceLines.charlotte}},{key:"sayNow",value:function(e,t){this.getLineFromVoiceLines(this.getVoiceLinesFromSpeaker(e),t).play()}},{key:"enqueueSay",value:function(e,t){this.soundQueue.add(this.getLineFromVoiceLines(this.getVoiceLinesFromSpeaker(e),t))}},{key:"update",value:function(){var e=this;if(!this.isPlaying){var t=this.soundQueue.values().next().value;void 0!==t&&(this.soundQueue.delete(t),this.isPlaying=!0,t.play(),t.onEndedObservable.addOnce(function(){e.isPlaying=!1}))}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},95237:function(e,t,n){n.d(t,{K:()=>tV}),n(44777),n(54785),n(58953);var r,a=n(10363),i=n(31845),o=n(97835),s=n(97782),l=n(49477),c=n(91839),u=n(7469),h=n(38241),d=n(70149),f=n(30451),p=n(58934),m=n(14407),v=n(95631);function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function b(e){function t(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(b=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new b(e)}function g(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}function w(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){g(i,r,a,o,s,"next",e)}function s(e){g(i,r,a,o,s,"throw",e)}o(void 0)})}}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function P(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var k=function(){var e,t;function n(e){var t,r;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");r=void 0,(t="rootHandle")in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[t]=r,this.rootHandle=e}return e=[{key:"getDirectoryHandle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return w(function(){var n,r,a,i,o,s,l,c,u,h;return P(this,function(d){switch(d.label){case 0:d.trys.push([0,9,,10]),n=e.split("/").filter(Boolean),r=this.rootHandle,a=!0,i=!1,o=void 0,d.label=1;case 1:d.trys.push([1,6,7,8]),s=n[Symbol.iterator](),d.label=2;case 2:if(a=(l=s.next()).done)return[3,5];return c=l.value,[4,r.getDirectoryHandle(c,{create:t})];case 3:r=d.sent(),d.label=4;case 4:return a=!0,[3,2];case 5:return[3,8];case 6:return u=d.sent(),i=!0,o=u,[3,8];case 7:try{a||null==s.return||s.return()}finally{if(i)throw o}return[7];case 8:return[2,r];case 9:if(E(h=d.sent(),DOMException)&&"NotFoundError"===h.name)return[2,null];throw h;case 10:return[2]}})}).call(this)}},{key:"getFileHandle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return w(function(){var n,r,a,i;return P(this,function(o){switch(o.label){case 0:if(o.trys.push([0,3,,4]),void 0===(r=(n=e.split("/").filter(Boolean)).pop()))throw Error("Invalid file path");return[4,this.getDirectoryHandle("/"+n.join("/"),t)];case 1:if(!(a=o.sent()))return[2,null];return[4,a.getFileHandle(r,{create:t})];case 2:return[2,o.sent()];case 3:if(E(i=o.sent(),DOMException)&&"NotFoundError"===i.name)return[2,null];throw i;case 4:return[2]}})}).call(this)}},{key:"createDirectory",value:function(e){return w(function(){var t;return P(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.getDirectoryHandle(e,!0)];case 1:return n.sent(),[2,!0];case 2:return t=n.sent(),console.error("Failed to create directory: ".concat(e),t),[2,!1];case 3:return[2]}})}).call(this)}},{key:"deleteDirectory",value:function(e){return w(function(){var t,n,r,a;return P(this,function(i){switch(i.label){case 0:if(i.trys.push([0,3,,4]),void 0===(n=(t=e.split("/").filter(Boolean)).pop()))return[2,!1];return[4,this.getDirectoryHandle("/"+t.join("/"))];case 1:if(!(r=i.sent()))return[2,!1];return[4,r.removeEntry(n,{recursive:!0})];case 2:return i.sent(),[2,!0];case 3:return a=i.sent(),console.error("Failed to delete directory: ".concat(e),a),[2,!1];case 4:return[2]}})}).call(this)}},{key:"listDirectory",value:function(e){return w(function(){var t,n,r,a,i,o,s,l,c,u;return P(this,function(h){switch(h.label){case 0:return h.trys.push([0,14,,15]),[4,this.getDirectoryHandle(e)];case 1:if(!(t=h.sent()))return[2,null];n=[],r=!1,a=!1,h.label=2;case 2:h.trys.push([2,7,8,13]),o=function(e){var t,n,r,a=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);a--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new b(t.call(e));n="@@asyncIterator",r="@@iterator"}throw TypeError("Object is not async iterable")}(t.entries()),h.label=3;case 3:return[4,o.next()];case 4:var d;if(!(r=!(s=h.sent()).done))return[3,6];l=(function(e){if(Array.isArray(e))return e}(d=s.value)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var i=[],o=!0,s=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(i.push(n.value),1!==i.length);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==a.return||a.return()}finally{if(s)throw r}}return i}}(d,1)||function(e,t){if(e){if("string"==typeof e)return y(e,1);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,1)}}(d,1)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],n.push(l),h.label=5;case 5:return r=!1,[3,3];case 6:return[3,13];case 7:return c=h.sent(),a=!0,i=c,[3,13];case 8:if(h.trys.push([8,,11,12]),!(r&&null!=o.return))return[3,10];return[4,o.return()];case 9:h.sent(),h.label=10;case 10:return[3,12];case 11:if(a)throw i;return[7];case 12:return[7];case 13:return[2,n.sort()];case 14:return u=h.sent(),console.error("Failed to list directory: ".concat(e),u),[2,null];case 15:return[2]}})}).call(this)}},{key:"directoryExists",value:function(e){return w(function(){return P(this,function(t){switch(t.label){case 0:return[4,this.getDirectoryHandle(e)];case 1:return[2,null!==t.sent()]}})}).call(this)}},{key:"writeFile",value:function(e,t){return w(function(){var n,r,a;return P(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),[4,this.getFileHandle(e,!0)];case 1:if(!(n=i.sent()))return[2,!1];return[4,n.createWritable()];case 2:return[4,(r=i.sent()).write(t)];case 3:return i.sent(),[4,r.close()];case 4:return i.sent(),[2,!0];case 5:return a=i.sent(),console.error("Failed to write file: ".concat(e),a),[2,!1];case 6:return[2]}})}).call(this)}},{key:"readFile",value:function(e){return w(function(){var t,n;return P(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,this.getFileHandle(e)];case 1:if(!(t=r.sent()))return[2,null];return[4,t.getFile()];case 2:return[4,r.sent().text()];case 3:return[2,r.sent()];case 4:return n=r.sent(),console.error("Failed to read file: ".concat(e),n),[2,null];case 5:return[2]}})}).call(this)}},{key:"deleteFile",value:function(e){return w(function(){var t,n,r,a;return P(this,function(i){switch(i.label){case 0:if(i.trys.push([0,3,,4]),void 0===(n=(t=e.split("/").filter(Boolean)).pop()))return[2,!1];return[4,this.getDirectoryHandle("/"+t.join("/"))];case 1:if(!(r=i.sent()))return[2,!1];return[4,r.removeEntry(n)];case 2:return i.sent(),[2,!0];case 3:return a=i.sent(),console.error("Failed to delete file: ".concat(e),a),[2,!1];case 4:return[2]}})}).call(this)}},{key:"fileExists",value:function(e){return w(function(){return P(this,function(t){switch(t.label){case 0:return[4,this.getFileHandle(e)];case 1:return[2,null!==t.sent()]}})}).call(this)}}],t=[{key:"CreateAsync",value:function(){return w(function(){var e,t;return P(this,function(r){switch(r.label){case 0:if(!n.IsSupported())return[2,(0,p._q)(Error("OPFS is not supported in this browser"))];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,navigator.storage.getDirectory()];case 2:return e=r.sent(),[2,(0,p.ok)(new n(e))];case 3:return console.error("Failed to create OPFSFileSystem:",t=r.sent()),[2,(0,p._q)(t)];case 4:return[2]}})})()}},{key:"IsSupported",value:function(){return"storage"in navigator&&"getDirectory"in navigator.storage}}],e&&S(n.prototype,e),t&&S(n,t),n}(),C=n(64753),A=n(52628),T=n(21298),L=n(59883);function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function M(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}function R(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){M(i,r,a,o,s,"next",e)}function s(e){M(i,r,a,o,s,"throw",e)}o(void 0)})}}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}}function N(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var V=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");O(this,"fileSystem",void 0),O(this,"universeBackend",void 0),O(this,"corruptedSaves",[]),this.fileSystem=e,this.universeBackend=t}return e=[{key:"getCorruptedSaves",value:function(){var e;return function(e){if(Array.isArray(e))return I(e)}(e=this.corruptedSaves)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},{key:"loadSaveFile",value:function(e){return R(function(){var t,n,r,a,i;return N(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,5]),[4,this.fileSystem.readFile(e)];case 1:if(null===(t=o.sent()))return[2,null];if(!(n=(0,C.z)(t)))throw Error("Invalid JSON");if(!(r=(0,T.c_)(n,this.universeBackend)).success)throw Error("Save validation failed: ".concat((0,L.k)(r.error)));return[2,r.value];case 2:return a=o.sent(),[4,this.fileSystem.readFile(e)];case 3:return i=o.sent(),this.corruptedSaves.push({filePath:e,error:a,rawContent:null!=i?i:""}),console.error("Corrupted save file: ".concat(e),a),[4,this.quarantineCorruptedSave(e)];case 4:return o.sent(),[2,null];case 5:return[2]}})}).call(this)}},{key:"quarantineCorruptedSave",value:function(e){return R(function(){var t,n,r,a;return N(this,function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),[4,this.fileSystem.readFile(e)];case 1:if(null===(t=i.sent()))return[3,4];return r=(n=e.replace("/saves/","/corrupted/")).substring(0,n.lastIndexOf("/")),[4,this.fileSystem.createDirectory(r)];case 2:return i.sent(),[4,this.fileSystem.writeFile(n,t)];case 3:i.sent(),i.label=4;case 4:return[4,this.fileSystem.deleteFile(e)];case 5:return i.sent(),[3,7];case 6:return a=i.sent(),console.error("Failed to quarantine corrupted save: ".concat(e),a),[3,7];case 7:return[2]}})}).call(this)}},{key:"getSavesForCmdr",value:function(e){return R(function(){var t,r,a,i,o,s,l,c,u,h,d,f,p,m,v,y,b,g,w,S,E,P;return N(this,function(k){switch(k.label){case 0:return t="".concat(n.SAVES_DIR,"/").concat(e),[4,this.fileSystem.directoryExists(t)];case 1:if(!k.sent())return[2,void 0];return r=[],a=[],i="".concat(t,"/manual"),[4,this.fileSystem.listDirectory(i)];case 2:if(null===(o=k.sent()))return[3,10];s=!0,l=!1,c=void 0,k.label=3;case 3:k.trys.push([3,8,9,10]),u=o[Symbol.iterator](),k.label=4;case 4:if(s=(h=u.next()).done)return[3,7];return d=h.value,[4,this.loadSaveFile("".concat(i,"/").concat(d))];case 5:if(null===(f=k.sent()))return[3,6];r.push(f),k.label=6;case 6:return s=!0,[3,4];case 7:return[3,10];case 8:return p=k.sent(),l=!0,c=p,[3,10];case 9:try{s||null==u.return||u.return()}finally{if(l)throw c}return[7];case 10:return m="".concat(t,"/auto"),[4,this.fileSystem.listDirectory(m)];case 11:if(null===(v=k.sent()))return[3,19];y=!0,b=!1,g=void 0,k.label=12;case 12:k.trys.push([12,17,18,19]),w=v[Symbol.iterator](),k.label=13;case 13:if(y=(S=w.next()).done)return[3,16];return E=S.value,[4,this.loadSaveFile("".concat(m,"/").concat(E))];case 14:if(null===(P=k.sent()))return[3,15];a.push(P),k.label=15;case 15:return y=!0,[3,13];case 16:return[3,19];case 17:return p=k.sent(),b=!0,g=p,[3,19];case 18:try{y||null==w.return||w.return()}finally{if(b)throw g}return[7];case 19:return r.sort(function(e,t){return t.timestamp-e.timestamp}),a.sort(function(e,t){return t.timestamp-e.timestamp}),[2,{manual:r,auto:a}]}})}).call(this)}},{key:"deleteSaveForCmdr",value:function(e,t){return R(function(){var r,a,i;return N(this,function(o){switch(o.label){case 0:return r="".concat(n.SAVES_DIR,"/").concat(e),a="".concat(r,"/manual/").concat(t,".json"),[4,this.fileSystem.fileExists(a)];case 1:if(!o.sent())return[3,3];return[4,this.fileSystem.deleteFile(a)];case 2:case 5:return[2,o.sent()];case 3:return i="".concat(r,"/auto/").concat(t,".json"),[4,this.fileSystem.fileExists(i)];case 4:if(!o.sent())return[3,6];return[4,this.fileSystem.deleteFile(i)];case 6:return[2,!1]}})}).call(this)}},{key:"deleteCmdr",value:function(e){return R(function(){var t;return N(this,function(r){switch(r.label){case 0:return t="".concat(n.SAVES_DIR,"/").concat(e),[4,this.fileSystem.deleteDirectory(t)];case 1:return[2,r.sent()]}})}).call(this)}},{key:"getCmdrUuids",value:function(){return R(function(){var e,t;return N(this,function(r){switch(r.label){case 0:return e=n.SAVES_DIR,[4,this.fileSystem.directoryExists(e)];case 1:if(!r.sent())return[2,[]];return[4,this.fileSystem.listDirectory(e)];case 2:return[2,null!=(t=r.sent())?t:[]]}})}).call(this)}},{key:"addManualSave",value:function(e,t){return R(function(){var r,a,i;return N(this,function(o){switch(o.label){case 0:return r="".concat(n.SAVES_DIR,"/").concat(e),a="".concat(r,"/manual"),[4,this.fileSystem.createDirectory(r)];case 1:return o.sent(),[4,this.fileSystem.createDirectory(a)];case 2:return o.sent(),i="".concat(a,"/").concat(t.uuid,".json"),[4,this.fileSystem.fileExists(i)];case 3:if(o.sent())return[2,!1];return[4,this.fileSystem.writeFile(i,JSON.stringify(t))];case 4:return[2,o.sent()]}})}).call(this)}},{key:"addAutoSave",value:function(e,t){return R(function(){var r,a,i;return N(this,function(o){switch(o.label){case 0:return r="".concat(n.SAVES_DIR,"/").concat(e),a="".concat(r,"/auto"),[4,this.fileSystem.createDirectory(r)];case 1:return o.sent(),[4,this.fileSystem.createDirectory(a)];case 2:return o.sent(),i="".concat(a,"/").concat(t.uuid,".json"),[4,this.fileSystem.fileExists(i)];case 3:if(o.sent())return[2,!1];return[4,this.fileSystem.writeFile(i,JSON.stringify(t))];case 4:if(!o.sent())return[2,!1];return[4,this.cleanupAutoSaves(e)];case 5:return o.sent(),[2,!0]}})}).call(this)}},{key:"cleanupAutoSaves",value:function(e){return R(function(){var t,r,a,i,o,s,l,c,u,h,d,f;return N(this,function(p){switch(p.label){case 0:return t="".concat(n.SAVES_DIR,"/").concat(e,"/auto"),[4,this.fileSystem.listDirectory(t)];case 1:if(!(r=p.sent()))return[2];a=[],i=!0,o=!1,s=void 0,p.label=2;case 2:p.trys.push([2,7,8,9]),l=r[Symbol.iterator](),p.label=3;case 3:if(i=(c=l.next()).done)return[3,6];return u=c.value,[4,this.loadSaveFile("".concat(t,"/").concat(u))];case 4:null!==(h=p.sent())&&a.push({uuid:h.uuid,timestamp:h.timestamp}),p.label=5;case 5:return i=!0,[3,3];case 6:return[3,9];case 7:return d=p.sent(),o=!0,s=d,[3,9];case 8:try{i||null==l.return||l.return()}finally{if(o)throw s}return[7];case 9:a.sort(function(e,t){return t.timestamp-e.timestamp}),p.label=10;case 10:if(!(a.length>A.w.MAX_AUTO_SAVES))return[3,13];if(void 0===(f=a.pop()))return[3,12];return[4,this.fileSystem.deleteFile("".concat(t,"/").concat(f.uuid,".json"))];case 11:p.sent(),p.label=12;case 12:return[3,10];case 13:return[2]}})}).call(this)}},{key:"importSaves",value:function(e){return R(function(){var t,n,r,a,i,o,s,l,c,u,h,d,f,p,m,v,y,b,g,w,S;return N(this,function(E){switch(E.label){case 0:t=[],n=!0,r=!1,a=void 0;try{for(i=Object.entries(e)[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var P;P=o.value,l=(s=function(e){if(Array.isArray(e))return e}(P)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var i=[],o=!0,s=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(i.push(n.value),2!==i.length);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==a.return||a.return()}finally{if(s)throw r}}return i}}(P,2)||_(P,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],c=s[1],u=!0,h=!1,d=void 0;try{for(f=c.manual[Symbol.iterator]();!(u=(p=f.next()).done);u=!0)m=p.value,t.push(this.addManualSave(l,m))}catch(e){h=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}v=!0,y=!1,b=void 0;try{for(g=c.auto[Symbol.iterator]();!(v=(w=g.next()).done);v=!0)S=w.value,t.push(this.addAutoSave(l,S))}catch(e){y=!0,b=e}finally{try{v||null==g.return||g.return()}finally{if(y)throw b}}}}catch(e){r=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}return[4,Promise.all(t)];case 1:return[2,E.sent().every(function(e){return e})]}})}).call(this)}},{key:"exportSaves",value:function(){return R(function(){var e,t,n,r,a,i,o,s,l,c;return N(this,function(u){switch(u.label){case 0:return e={},[4,this.getCmdrUuids()];case 1:t=u.sent(),n=!0,r=!1,a=void 0,u.label=2;case 2:u.trys.push([2,7,8,9]),i=t[Symbol.iterator](),u.label=3;case 3:if(n=(o=i.next()).done)return[3,6];return s=o.value,[4,this.getSavesForCmdr(s)];case 4:void 0!==(l=u.sent())&&(e[s]=l),u.label=5;case 5:return n=!0,[3,3];case 6:return[3,9];case 7:return c=u.sent(),r=!0,a=c,[3,9];case 8:try{n||null==i.return||i.return()}finally{if(r)throw a}return[7];case 9:return[2,e]}})}).call(this)}}],t=[{key:"CreateAsync",value:function(e,t){return R(function(){return N(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.createDirectory(n.SAVES_DIR)];case 1:return r.sent(),[2,(0,p.ok)(new n(e,t))];case 2:return console.error("Failed to create SaveBackendMultiFile:",r.sent()),[2,(0,p._q)({type:L.G.INVALID_JSON})];case 3:return[2]}})})()}}],e&&x(n.prototype,e),t&&x(n,t),n}();O(V,"SAVES_DIR","/saves");var D=n(31411),B=n(4529),F=n(97078),j=n(66371),W=n(34537);function U(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");G(this,"save",void 0),G(this,"encyclopaedia",void 0),G(this,"universe",void 0),this.save=e,this.encyclopaedia=n,this.universe=r}return e=[{key:"New",value:function(){var e;return(e=function(){var e,n,r,a,i,o,s;return function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(l){switch(l.label){case 0:return e=new W.Y((0,F.u)()),e.registerGeneralPlugin(function(e){return(0,f.g)([e.coordinates.starSectorX,e.coordinates.starSectorY,e.coordinates.starSectorZ,e.coordinates.localX,e.coordinates.localY,e.coordinates.localZ])>.5},function(e){var t=e.stellarObjects.map(function(e){return e.id});return e.anomalies.push((0,j.S)(t)),e}),(n=new v.k).backends.push(new m.A(e)),[4,D.E.CreateAsync(new B.m(B.m.SAVES_KEY),new B.m(B.m.BACKUP_SAVE_KEY),e)];case 1:return r=l.sent(),a=void 0,[4,k.CreateAsync()];case 2:if(!(i=l.sent()).success)return[3,8];return[4,V.CreateAsync(i.value,e)];case 3:if(!(o=l.sent()).success)return[3,7];if(!r.success)return[3,6];return[4,r.value.exportSaves()];case 4:return s=l.sent(),[4,o.value.importSaves(s)];case 5:l.sent(),l.label=6;case 6:return a=o.value,[3,8];case 7:r.success&&(a=r.value),l.label=8;case 8:if(void 0===a)return[2,(0,p._q)(Error("Failed to initialize save backend: OPFS not supported and legacy save backend failed"))];return[2,(0,p.ok)(new t(a,n,e))]}})},function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){U(i,r,a,o,s,"next",e)}function s(e){U(i,r,a,o,s,"throw",e)}o(void 0)})})()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t,e),t}(),z=n(86223);n(26484),n(99949);var q=n(83771);let Q=n.p+"17af999e7b7ad57f.mp3",K=n.p+"041ff9a253ed825d.mp3",Y=n.p+"1549759e283bd206.ogg",X=n.p+"31e17b20ef567c2c.ogg",J=n.p+"39989db1f505d453.ogg",Z=n.p+"d0fafb23c7d554d6.mp3",$=n.p+"e681fd4fea79fa37.ogg",ee=n.p+"2a8bc67628c05fba.ogg",et=n.p+"1814b3aace9cf589.ogg",en=n.p+"bf4b326c5ffca2bb.mp3",er=n.p+"368a319571c58001.ogg",ea=n.p+"c1c5397b26a6c809.ogg",ei=n.p+"920dd9f7b92185e2.ogg";function eo(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}var es=n(1933);let el=n.p+"d03a87f2075d6f53.mp3",ec=n.p+"02b9b418f00b21c6.mp3",eu=n.p+"cd82c2ed886f9749.mp3",eh=n.p+"5d862e8381583459.mp3",ed=n.p+"c83251e2246e7d88.mp3",ef=n.p+"64c7906a8f900679.mp3",ep=n.p+"2da6813008740281.mp3",em=n.p+"d0bfa528e576d380.mp3",ev=n.p+"b3ce59bafdbe5a25.mp3",ey=n.p+"cb1faa14ee3af51b.mp3",eb=n.p+"398d2c8156e90ba6.mp3",eg=n.p+"03f6eca0cfdf0539.mp3";function ew(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}function eS(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}var eE=n(31964);function eP(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}var ek=n(35904),eC=n(39393);function eA(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var eT=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");eA(this,"currentMusic",null),eA(this,"silenceSeconds",0),eA(this,"volume",1),eA(this,"fadeSeconds",3),eA(this,"pauseMusicWhenPaused",!1),eA(this,"starSystemView",void 0),eA(this,"musics",void 0),this.musics=e,this.starSystemView=n;var a=eC.$.audioEngine;if(null===a)throw Error("Audio context is null");a.onAudioUnlockedObservable.addOnce(function(){if(null!==r.currentMusic){var e=r.currentMusic;r.currentMusic=null,r.setMusic(e)}})}return e=[{key:"setMusicFromSelection",value:function(e){if(!(null!==this.currentMusic&&e.includes(this.currentMusic))){var t=e[Math.floor(Math.random()*e.length)];void 0!==t&&this.setMusic(t)}}},{key:"setMusic",value:function(e){if(this.currentMusic!==e){if(null!==this.currentMusic){this.currentMusic.setVolume(0,this.fadeSeconds),this.currentMusic=null,this.silenceSeconds=this.fadeSeconds;return}null!==e&&(this.currentMusic=e,this.currentMusic.stop(),this.currentMusic.setVolume(0),this.currentMusic.play(),this.currentMusic.setVolume(this.volume,this.fadeSeconds),console.log("currently playing",this.currentMusic.name))}}},{key:"setSoundtrackVolume",value:function(e){this.volume=e,null!==this.currentMusic&&this.currentMusic.setVolume(e)}},{key:"getVolume",value:function(){return this.volume}},{key:"update",value:function(e,t,n,r){if(null!==this.currentMusic){if(e&&this.pauseMusicWhenPaused&&this.currentMusic.isPlaying)return void this.currentMusic.pause();if(!e&&this.currentMusic.isPaused)return void this.currentMusic.play();e||this.currentMusic.isPlaying||(this.currentMusic=null,this.silenceSeconds=30+(Math.random()-.5)*20)}if(this.silenceSeconds>0){this.silenceSeconds-=r;return}if(!this.starSystemView.isLoadingSystem()){var a=this.starSystemView.getSpaceshipControls().getSpaceship(),i=this.starSystemView.scene.getActiveControls()===this.starSystemView.getCharacterControls(),o=this.starSystemView.scene.getActiveControls().getTransform().getAbsolutePosition(),l=this.starSystemView.getStarSystem().getNearestOrbitalObject(o),c=s.Pq.Distance(o,l.getTransform().getAbsolutePosition());if(!t||n)return void this.setMusic(this.musics.wandering);if(!a.isLanded()&&null!==a.getTargetLandingPad())return void this.setMusic(this.musics.straussBlueDanube);var u=a.getInternals().getWarpDrive();switch(l.model.type){case"blackHole":this.setMusicFromSelection([this.musics.soaring]);return;case"mandelbulb":case"juliaSet":case"mandelbox":case"sierpinskiPyramid":case"mengerSponge":case"darkKnight":if(c<100*l.getBoundingRadius())return void this.setMusicFromSelection([this.musics.spacialWinds,this.musics.echoesOfTime]);break;case"star":case"neutronStar":case"telluricPlanet":case"telluricSatellite":case"gasPlanet":case"custom":break;case"spaceStation":case"spaceElevator":if((null===u||u.isDisabled())&&c<10*l.getBoundingRadius())return void this.setMusic(this.musics.equatorialComplex)}if(null!==u&&u.isEnabled()){var h=[this.musics.atlanteanTwilight,this.musics.infinitePerspective,this.musics.mesmerize];this.setMusicFromSelection(h);return}if(!a.isLanded()&&(null===u||u.isDisabled())){var d=[this.musics.thatZenMoment,this.musics.deepRelaxation,this.musics.peaceOfMind];this.setMusicFromSelection(d);return}if(i||a.isLanded()){var f=[this.musics.thatZenMoment,this.musics.deepRelaxation,this.musics.peaceOfMind,this.musics.mesmerize,this.musics.reawakening];this.setMusicFromSelection(f);return}this.setMusic(null)}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),eL=n(76945),eI=n(12014),eM=n(88768),eR=n(61800),ex=n(16580),eO=n(38547),e_=n(61125),eN=n(98406),eV=n(7647),eD=n(32907),eB=n(76937),eF=n(8590),ej=n(3141),eW=n(42917),eU=n(8330),eG=function(){var e;function t(){var e,n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");n=void 0,(e="htmlRoot")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n,this.htmlRoot=this.createPanelHTML()}return e=[{key:"createPanelHTML",value:function(){var e=document.createElement("div");e.className="sidePanel";var t=document.createElement("h2");t.textContent=eW.A.t("sidePanel:about"),e.appendChild(t);var n=document.createElement("p");n.className="aboutText",n.style.whiteSpace="pre-line",n.textContent=eW.A.t("sidePanel:aboutText"),e.appendChild(n);var r=document.createElement("p");r.className="signature",r.textContent="Barth\xe9lemy Pal\xe9ologue",e.appendChild(r);var a=document.createElement("p");a.className="aboutText",a.style.whiteSpace="pre-line",a.innerHTML=eW.A.t("sidePanel:emailContact"),e.appendChild(a);var i=document.createElement("h3");return i.textContent=eW.A.t("sidePanel:specialThanks"),e.appendChild(i),["In\xe8s Varhol, my partner, for her unwavering love and support","Christine Lombez, my mother, for her trust and for shaping the person I am today","Victor Pal\xe9ologue, my brother, for inspiring my journey into programming","Eric Lombez, my uncle, for giving me my first capable computer, paving the way for my passion for computer graphics","Martin Molli and Malo Lereste, my friends and Elite Dangerous squadmates, for their invaluable feedback and camaraderie that enriched this project."].forEach(function(t){var n=document.createElement("p");n.textContent=t,e.appendChild(n)}),e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),eH=function(){var e;function t(){var e,n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");n=void 0,(e="htmlRoot")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n,this.htmlRoot=this.createPanelHTML()}return e=[{key:"createPanelHTML",value:function(){var e=document.createElement("div");e.className="sidePanel";var t=document.createElement("h2");t.textContent=eW.A.t("sidePanel:contribute"),e.appendChild(t);var n=document.createElement("h3");n.textContent=eW.A.t("sidePanel:bugReports"),e.appendChild(n);var r=document.createElement("p");r.innerHTML=eW.A.t("sidePanel:bugReportsText"),e.appendChild(r);var a=document.createElement("h3");a.textContent=eW.A.t("sidePanel:translation"),e.appendChild(a);var i=document.createElement("p");i.innerHTML=eW.A.t("sidePanel:translationText"),e.appendChild(i);var o=document.createElement("h3");o.textContent=eW.A.t("sidePanel:knowHowToCode"),e.appendChild(o);var s=document.createElement("p");s.innerHTML=eW.A.t("sidePanel:knowHowToCodeText"),e.appendChild(s);var l=document.createElement("h3");l.textContent=eW.A.t("sidePanel:supportFinancially"),e.appendChild(l);var c=document.createElement("p");return c.innerHTML=eW.A.t("sidePanel:supportFinanciallyText"),e.appendChild(c),e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),ez=function(){var e;function t(){var e,n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");n=void 0,(e="htmlRoot")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n,this.htmlRoot=this.createPanelHTML()}return e=[{key:"createPanelHTML",value:function(){var e=document.createElement("div");e.className="sidePanel";var t=document.createElement("h2");t.textContent=eW.A.t("sidePanel:credits"),e.appendChild(t);var n=document.createElement("h3");n.textContent=eW.A.t("sidePanel:contributors"),e.appendChild(n);var r=document.createElement("div");r.className="contributors-section";var a=document.createElement("img");a.src="https://contrib.rocks/image?repo=BarthPaleologue/CosmosJourneyer",a.alt="Contributors",a.className="contributors-image",r.appendChild(a),e.appendChild(r);var i=document.createElement("h3");i.textContent=eW.A.t("sidePanel:programming"),e.appendChild(i),['Created by <a target="_blank" href="https://barth.paleologue.fr">Barth\xe9lemy Pal\xe9ologue</a>','Webpack configuration & Refactorings by <a target="_blank" href="https://github.com/happy44300">Martin Molli</a>','Built with <a target="_blank" href="https://www.babylonjs.com/">BabylonJS</a> and its awesome forum','Planet surface rendering based on <a target="_blank" href="https://www.youtube.com/watch?v=hHGshzIXFWY&list=PLRL3Z3lpLmH3PNGZuDNf2WXnLTHpN9hXy">SimonDev\'s 3D World Generation video series</a>','Star colors made using <a target="_blank" href="https://www.fourmilab.ch/documents/specrend/">John Walker\'s "Colour Rendering of Spectra"</a>','Black hole shader based on <a target="_blank" href="https://www.shadertoy.com/view/tsBXW3">set111 implementation on shadertoy</a>','Lens flare shader based on <a target="_blank" href="https://www.shadertoy.com/view/wlcyzj">TheNosiriN implementation on shadertoy</a>','Fractal raymarching based on <a target="_blank" href="https://www.shadertoy.com/view/tsc3Rj">Nazlbit\'s implementation</a> and <a target="_blank" href="https://www.shadertoy.com/view/wdjGWR">Myro\'s implementation</a> on shadertoy','Mandelbox raymarching based on <a target="_blank" href="https://www.shadertoy.com/view/llGXDR">geoff\'s implementation</a> on shadertoy','Sierpinski raymarching based on <a target="_blank" href="https://www.shadertoy.com/view/4dl3Wl">Inigo Quilez\'s implementation</a> on shadertoy','Menger Sponge raymarching based on <a target="_blank" href="https://www.shadertoy.com/view/XttfRN">reinder\'s implementation</a> on shadertoy'].forEach(function(t){var n=document.createElement("p");n.innerHTML=t,e.appendChild(n)});var o=document.createElement("h3");o.textContent=eW.A.t("sidePanel:materials"),e.appendChild(o),['Awesome PBR materials from <a target="_blank" href="https://freepbr.com">freepbr.com</a>','Solar panel material from <a target="_blank" href="https://ambientCG.com">ambientCG.com</a>, licensed under the Creative Commons CC0 1.0 Universal License.','Jupiter texture from <a target="_blank" href="https://www.solarsystemscope.com/textures/">Solar System Scope</a>, licensed under Attribution 4.0 International license','Saturn texture from <a target="_blank" href="https://www.solarsystemscope.com/textures/">Solar System Scope</a>, licensed under Attribution 4.0 International license','Uranus texture from <a target="_blank" href="https://www.solarsystemscope.com/textures/">Solar System Scope</a>, licensed under Attribution 4.0 International license','Neptune texture from <a target="_blank" href="https://www.solarsystemscope.com/textures/">Solar System Scope</a>, licensed under Attribution 4.0 International license','Saturn rings from <a target="_blank" href="https://www.solarsystemscope.com/textures/">Solar System Scope</a>, licensed under Attribution 4.0 International license','Uranus rings from <a target="_blank" href="https://planetpixelemporium.com/uranus.html">Planet Pixel Emporium</a>, licensed under the terms specified <a target="_blank" href="https://planetpixelemporium.com/planets.html">here</a>'].forEach(function(t){var n=document.createElement("p");n.innerHTML=t,e.appendChild(n)});var s=document.createElement("h3");s.textContent=eW.A.t("sidePanel:icons"),e.appendChild(s),['Gasoline icon created by <a target="_blank" href="https://www.flaticon.com/free-icons/gasoline" title="gasoline icons">Freepik - Flaticon</a>','Astronomy icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/astronomay" title="astronomy icons">3ab2ou - Flaticon</a>','Space-station icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/space-station" title="space-station icons">Freepik - Flaticon</a>','Space-exploration icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/space-exploration" title="space-exploration icons">Dewi Sari - Flaticon</a>','Expand icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/expand" title="expand icons">Google - Flaticon</a>','Play icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/play" title="play icons">Freepik - Flaticon</a>','Download icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/download" title="download icons">Debi Alpa Nugraha - Flaticon</a>','Delete icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/delete" title="delete icons">bqlqn - Flaticon</a>','Edit icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/edit" title="edit icons">Kiranshastry - Flaticon</a>','Information icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/information" title="information icons">Freepik - Flaticon</a>','Link icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/link" title="link icons">Creaticca Creative Agency - Flaticon</a>','Exploration icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/exploration" title="exploration icons">SprSprK - Flaticon</a>','Launch icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/launch" title="launch icons">Freepik - Flaticon</a>','Barter icons created by <a target="_blank" href="https://www.flaticon.com/free-icons/barter" title="barter icons">Ahmad Roaayala - Flaticon</a>'].forEach(function(t){var n=document.createElement("p");n.innerHTML=t,e.appendChild(n)});var l=document.createElement("h3");l.textContent=eW.A.t("sidePanel:font"),e.appendChild(l);var c=document.createElement("p");c.innerHTML='<a target="_blank" href="https://typodermicfonts.com/nasalization/">Nasalization font</a> by Typodermic Fonts',e.appendChild(c);var u=document.createElement("h3");u.textContent=eW.A.t("sidePanel:music"),e.appendChild(u),['<a target="_blank" href="https://freesound.org/people/Andrewkn/sounds/455855/">Wandering</a> by Andrewkn','"Deep Relaxation" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>','"Atlantean Twilight" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>','"That Zen Moment" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>','"Echoes of Time v2" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>','"Infinite Perspective" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>','"Peace of Mind" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>','"Spacial Winds" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>','"Mesmerize" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>','"Reawakening" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>','"Equatorial Complex" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>','"Soaring" <a target="_blank" href="https://incompetech.com">Kevin MacLeod (incompetech.com)</a> Licensed under Creative Commons: By <a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">Attribution 4.0 License</a>'].forEach(function(t){var n=document.createElement("p");n.innerHTML=t,e.appendChild(n)});var h=document.createElement("h3");return h.textContent=eW.A.t("sidePanel:soundEffects"),e.appendChild(h),['<a target="_blank" href="https://freesound.org/people/DrMinky/sounds/166186/">Menu screen mouse over</a> by <a target="_blank" href="https://freesound.org/people/DrMinky/">DrMinky</a> | License: <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Attribution 4.0</a>','<a target="_blank" href="https://freesound.org/people/lollosound/sounds/386992/">17 DISTORZIONE.WAV</a> by <a target="_blank" href="https://freesound.org/people/lollosound/">lollosound</a> | License: <a target="_blank" href="http://creativecommons.org/publicdomain/zero/1.0/">Creative Commons 0</a>','<a target="_blank" href="https://freesound.org/people/NHumphrey/sounds/204418/">Large Engine.wav</a> by <a target="_blank" href="https://freesound.org/people/NHumphrey/">NHumphrey</a> | License: <a target="_blank" href="http://creativecommons.org/publicdomain/zero/1.0/">Creative Commons 0</a>','<a target="_blank" href="https://freesound.org/people/MATRIXXX_/sounds/702805/">Futuristic Inspect Sound, UI, or In-Game Notification.wav</a> by <a target="_blank" href="https://freesound.org/people/MATRIXXX_/">MATRIXXX_</a> | License: <a target="_blank" href="http://creativecommons.org/publicdomain/zero/1.0/">Creative Commons 0</a>','<a target="_blank" href="https://freesound.org/people/Timbre/sounds/539503/">endless acceleration.flac</a> by <a target="_blank" href="https://freesound.org/people/Timbre/">Timbre</a> | License: <a target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">Attribution NonCommercial 4.0</a>','<a target="_blank" href="https://freesound.org/people/LimitSnap_Creations/sounds/318688/">Rocket Thrust effect.wav</a> by <a target="_blank" href="https://freesound.org/people/LimitSnap_Creations/">LimitSnap_Creations</a> | License: <a target="_blank" href="http://creativecommons.org/publicdomain/zero/1.0/">Creative Commons 0</a>','<a target="_blank" href="https://freesound.org/people/original_sound/sounds/372197/">Error Bleep 4</a> by <a target="_blank" href="https://freesound.org/people/original_sound/">original_sound</a> | License: <a target="_blank" href="http://creativecommons.org/licenses/by/3.0/">Attribution 3.0</a>','<a target="_blank" href="https://freesound.org/people/copyc4t/sounds/554089/">Echoed Blip</a> by <a target="_blank" href="https://freesound.org/people/copyc4t/">copyc4t</a> | License: <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Attribution 4.0</a>','<a target="_blank" href="https://youtu.be/cKkDMiGUbUw?si=dHDqjFx57tgOfNeL">The Blue Danube Waltz</a> from Johann Strauss','Spaceship voice generated using <a target="_blank" href="https://elevenlabs.io">ElevenLabs</a>'].forEach(function(t){var n=document.createElement("p");n.innerHTML=t,e.appendChild(n)}),e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),eq=n(25656);function eQ(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var eK=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");eQ(this,"htmlRoot",void 0),eQ(this,"content",void 0),this.content=new eq.X(e,n,r),this.htmlRoot=this.createPanelHTML()}return e=[{key:"createPanelHTML",value:function(){var e=document.createElement("div");e.className="sidePanel";var t=document.createElement("h2");return t.textContent=eW.A.t("sidePanel:loadSave"),e.appendChild(t),e.appendChild(this.content.htmlRoot),e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),eY=n(93039),eX=n(92985),eJ=n(36960),eZ=n(44175),e$=n(22687),e0=n(16855),e1=n(31694),e2=n(34576),e4=n(88782),e3=n(80104),e5=[eO.i,e3.n,e2.S,e1._,e$.b,e0.Z,e4.I],e6=n(42792);function e7(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function e8(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}function e9(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var i=[],o=!0,s=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==a.return||a.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return e7(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e7(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var tt=function(){var e;function t(e){var n,r;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");r=void 0,(n="htmlRoot")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this.htmlRoot=this.createPanelHTML(e)}return e=[{key:"createPanelHTML",value:function(e){var t=document.createElement("div");t.className="sidePanel";var n=document.createElement("h2");n.textContent=eW.A.t("sidePanel:settings"),t.appendChild(n);var r=document.createElement("div");r.classList.add("settings-section");var a=document.createElement("h3");a.textContent=eW.A.t("sidePanel:audioSettings"),a.style.fontFamily="Nasalization, sans-serif",r.appendChild(a);var i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.gap="10px",i.style.fontFamily="Nasalization, sans-serif";var o=document.createElement("label");o.textContent=eW.A.t("sidePanel:musicVolume"),o.style.fontFamily="Nasalization, sans-serif",o.style.minWidth="80px",o.style.flexGrow="1",o.style.color="#fff",o.style.fontWeight="bold",o.style.letterSpacing="1px",o.style.fontSize="1.1em",i.appendChild(o);var s=document.createElement("input");s.type="range",s.min="0",s.max="1",s.step="0.05",s.value=e.getVolume().toString(),s.style.margin="0 10px",s.style.accentColor="#ffffff";var l=document.createElement("span");return l.textContent=(100*parseFloat(s.value)).toFixed(0)+"%",l.style.fontFamily="Nasalization, sans-serif",l.style.color="#fff",l.style.backgroundColor="#1a1a1a",l.style.padding="2px 8px",l.style.borderRadius="4px",l.style.fontWeight="bold",l.style.fontSize="1em",l.style.marginLeft="4px",l.style.minWidth="50px",l.style.textAlign="center",s.addEventListener("input",function(){var t=parseFloat(s.value);l.textContent=(100*t).toFixed(0)+"%",e.setSoundtrackVolume(t)}),i.appendChild(s),i.appendChild(l),r.appendChild(i),t.appendChild(r),this.initializeInputControls(t),t}},{key:"initializeInputControls",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(n){switch(n.label){case 0:return[4,(0,e6.t)()];case 1:return t=n.sent(),e5.forEach(function(n){var r=document.createElement("div");r.classList.add("map");var a=document.createElement("h3");a.textContent=n.name.replace(/([A-Z])/g," $1").trim(),r.appendChild(a);var i=!0,o=!1,s=void 0;try{for(var l,c=Object.entries(n.map)[Symbol.iterator]();!(i=(l=c.next()).done);i=!0)!function(){var e=te(l.value,2),n=e[0],a=e[1],i=new Map;(e9(a,eY.A)?a.bindings:a.action.bindings).forEach(function(e){if(e9(e.control,eJ.A))(0,eZ.Fd)(e.control,t).forEach(function(e){var t,n=te(e,2),r=n[0],a=n[1];i.has(r)||i.set(r,[]),null==(t=i.get(r))||t.push(a)});else if(e9(e.control,eX.OG)){var n,r=(0,eZ.Xi)(e.control,t);i.has("BUTTON")||i.set("BUTTON",[]),null==(n=i.get("BUTTON"))||n.push(r)}else if(e9(e.control,eX.hn))(0,eZ.Lc)(e.control,t).forEach(function(e){var t,n=te(e,2),r=n[0],a=n[1];i.has(r)||i.set(r,[]),null==(t=i.get(r))||t.push(a)});else if(e9(e.control,eX.mD))(0,eZ.Jc)(e.control).forEach(function(e){var t,n=te(e,2),r=n[0],a=n[1];i.has(r)||i.set(r,[]),null==(t=i.get(r))||t.push(a)});else if(e9(e.control,eX.fX))(0,eZ.qA)().forEach(function(e){var t,n=te(e,2),r=n[0],a=n[1];i.has(r)||i.set(r,[]),null==(t=i.get(r))||t.push(a)});else throw Error("Unknown control type")});var o=document.createElement("div"),s=document.createElement("p");if(s.textContent=n.replace(/([A-Z])/g," $1").trim(),o.appendChild(s),1===i.size){o.classList.add("actionSingle");var c=document.createElement("div");c.classList.add("valuesContainer");var u=!0,h=!1,d=void 0;try{for(var f,p=i.values()[Symbol.iterator]();!(u=(f=p.next()).done);u=!0)f.value.forEach(function(e){var t=document.createElement("p");t.innerText=e,c.appendChild(t)})}catch(e){h=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(h)throw d}}o.appendChild(c)}else o.classList.add("actionMultiple"),i.forEach(function(e,t){var n=document.createElement("div");n.classList.add("subAction");var r=document.createElement("p");r.textContent=t;var a=document.createElement("div");a.classList.add("valuesContainer"),e.forEach(function(e){var t=document.createElement("p");t.innerText=e,a.appendChild(t)}),n.appendChild(r),n.appendChild(a),o.appendChild(n)});r.appendChild(o)}()}catch(e){o=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw s}}e.appendChild(r)}),[2]}})},function(){var e=this,n=arguments;return new Promise(function(r,a){var i=t.apply(e,n);function o(e){e8(i,r,a,o,s,"next",e)}function s(e){e8(i,r,a,o,s,"throw",e)}o(void 0)})})()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),tn=n(48104),tr=n(71518),ta=n(52107),ti=n(35514);function to(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ts=function e(){var t=this;if(!(this instanceof e))throw TypeError("Cannot call a class as a function");to(this,"htmlRoot",void 0),to(this,"onTutorialSelected",new eB.cP),to(this,"availableTutorials",void 0),this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("tutorialsMenuContainer"),this.availableTutorials=[new tn.$,new ti.M,new ta.r,new tr.F],this.availableTutorials.forEach(function(e){var n=document.createElement("div");n.classList.add("tutorial");var r=document.createElement("h2");r.textContent=e.getTitle(),n.appendChild(r);var a=document.createElement("img");a.src=e.coverImageSrc,a.alt=e.getTitle(),n.appendChild(a);var i=document.createElement("p");i.textContent=e.getDescription(),n.appendChild(i),t.htmlRoot.appendChild(n),n.addEventListener("click",function(){t.onTutorialSelected.notifyObservers(e)})});var n=document.createElement("p");n.classList.add("moreWillCome"),n.textContent=eW.A.t("tutorials:common:moreWillComeSoon"),this.htmlRoot.appendChild(n)};function tl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tc=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");tl(this,"htmlRoot",void 0),tl(this,"content",void 0),this.content=new ts,this.htmlRoot=this.createPanelHTML()}return e=[{key:"createPanelHTML",value:function(){var e=document.createElement("div");e.classList.add("sidePanel","tutorials");var t=document.createElement("h2");t.textContent=eW.A.t("sidePanel:tutorials"),e.appendChild(t);var n=document.createElement("p");return n.setAttribute("align","center"),n.textContent=eW.A.t("sidePanel:tutorialsWarning"),e.appendChild(n),e.appendChild(this.content.htmlRoot),e}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function tu(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}function th(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var td=((r={})[r.LOAD_SAVE=0]="LOAD_SAVE",r[r.SETTINGS=1]="SETTINGS",r[r.TUTORIALS=2]="TUTORIALS",r[r.CONTRIBUTE=3]="CONTRIBUTE",r[r.CREDITS=4]="CREDITS",r[r.ABOUT=5]="ABOUT",r),tf=function(){var e;function t(e,n,r,a,i){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");th(this,"activeRightPanel",null),th(this,"loadSavePanel",void 0),th(this,"settingsPanel",void 0),th(this,"tutorialsPanel",void 0),th(this,"contributePanel",void 0),th(this,"creditsPanel",void 0),th(this,"aboutPanel",void 0),th(this,"universeBackend",void 0),th(this,"saveBackend",void 0),this.universeBackend=e,this.saveBackend=n,this.loadSavePanel=new eK(e,r,i),this.attachCloseButton(this.loadSavePanel.htmlRoot),document.body.appendChild(this.loadSavePanel.htmlRoot),this.settingsPanel=new tt(a),this.attachCloseButton(this.settingsPanel.htmlRoot),document.body.appendChild(this.settingsPanel.htmlRoot),this.tutorialsPanel=new tc,this.attachCloseButton(this.tutorialsPanel.htmlRoot),document.body.appendChild(this.tutorialsPanel.htmlRoot),this.contributePanel=new eH,this.attachCloseButton(this.contributePanel.htmlRoot),document.body.appendChild(this.contributePanel.htmlRoot),this.creditsPanel=new ez,this.attachCloseButton(this.creditsPanel.htmlRoot),document.body.appendChild(this.creditsPanel.htmlRoot),this.aboutPanel=new eG,this.attachCloseButton(this.aboutPanel.htmlRoot),document.body.appendChild(this.aboutPanel.htmlRoot)}return e=[{key:"panelFromType",value:function(e){switch(e){case 0:return this.loadSavePanel.htmlRoot;case 1:return this.settingsPanel.htmlRoot;case 2:return this.tutorialsPanel.htmlRoot;case 3:return this.contributePanel.htmlRoot;case 4:return this.creditsPanel.htmlRoot;case 5:return this.aboutPanel.htmlRoot;default:return(0,p.dr)(e)}}},{key:"attachCloseButton",value:function(e){var t=this;if(!e.querySelector(".close-button")){var n=document.createElement("button");n.innerText="X",n.className="close-button",n.addEventListener("click",function(){t.hideActivePanel()}),e.appendChild(n)}}},{key:"toggleActivePanel",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(n){switch(n.label){case 0:if(t=this.panelFromType(e),this.activeRightPanel===t)return[2];if(0!==e)return[3,2];return[4,this.loadSavePanel.content.populateCmdrList(this.universeBackend,this.saveBackend)];case 1:n.sent(),n.label=2;case 2:return null!==this.activeRightPanel&&this.hideActivePanel(),this.activeRightPanel=t,t.classList.add("visible"),[2]}})},function(){var e=this,n=arguments;return new Promise(function(r,a){var i=t.apply(e,n);function o(e){tu(i,r,a,o,s,"next",e)}function s(e){tu(i,r,a,o,s,"throw",e)}o(void 0)})}).call(this)}},{key:"hideActivePanel",value:function(){null!==this.activeRightPanel&&(this.activeRightPanel.classList.remove("visible"),this.activeRightPanel=null)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function tp(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}function tm(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){tp(i,r,a,o,s,"next",e)}function s(e){tp(i,r,a,o,s,"throw",e)}o(void 0)})}}function tv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ty(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var tb=function(){var e;function t(e,n,r,a){var i=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");tv(this,"scene",void 0),tv(this,"controls",void 0),tv(this,"starSystemView",void 0),tv(this,"starSystemModel",void 0),tv(this,"onStartObservable",new eB.cP),tv(this,"onContributeObservable",new eB.cP),tv(this,"onCreditsObservable",new eB.cP),tv(this,"onAboutObservable",new eB.cP),tv(this,"htmlRoot",void 0),tv(this,"title",void 0),tv(this,"version",void 0),tv(this,"startButton",void 0),tv(this,"loadSaveButton",void 0),tv(this,"settingsButton",void 0),tv(this,"tutorialsButton",void 0),tv(this,"contributeButton",void 0),tv(this,"creditsButton",void 0),tv(this,"aboutButton",void 0),tv(this,"menuItems",void 0),tv(this,"sidePanels",void 0),tv(this,"universeObjectId",void 0),tv(this,"startAnimationDurationSeconds",5),this.sidePanels=e,this.starSystemView=n,this.scene=this.starSystemView.scene,this.controls=this.starSystemView.getDefaultControls(),this.starSystemView.setUIEnabled(!1);var o=r.getSystemModelFromCoordinates({localX:.49137314641446483,localY:.48043087077347135,localZ:.38353311777279386,starSectorX:0,starSectorY:0,starSectorZ:0});if(null===o)throw Error("Cannot find system");var s=o.planets.at(1);if(void 0===s)throw Error("Cannot find planet with index 2");this.universeObjectId=(0,z.Ei)(s,o),this.starSystemModel=o;var l=this.createMainMenuHTML();this.htmlRoot=l.htmlRoot,this.title=l.title,this.version=l.version,this.startButton=l.startButton,this.loadSaveButton=l.loadSaveButton,this.settingsButton=l.settingsButton,this.tutorialsButton=l.tutorialsButton,this.contributeButton=l.contributeButton,this.creditsButton=l.creditsButton,this.aboutButton=l.aboutButton,this.menuItems=l.menuItems,this.htmlRoot.style.display="none",document.body.appendChild(this.htmlRoot);var c=this.version.querySelector("a");if(null===c)throw Error("version link does not exist!");c.textContent="Alpha ".concat(eU.rE),[this.startButton,this.loadSaveButton,this.settingsButton,this.tutorialsButton,this.contributeButton,this.creditsButton,this.aboutButton].forEach(function(e){e.addEventListener("mouseenter",function(){a.playNow(eL.Wo.HOVER)}),e.addEventListener("click",function(){a.playNow(eL.Wo.CLICK)})}),this.startButton.addEventListener("click",function(){i.startAnimation(function(){return i.onStartObservable.notifyObservers()})}),this.loadSaveButton.addEventListener("click",function(){return tm(function(){return ty(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(td.LOAD_SAVE)];case 1:return e.sent(),[2]}})}).call(i)}),this.sidePanels.loadSavePanel.content.onLoadSaveObservable.add(function(){i.hide()}),this.settingsButton.addEventListener("click",function(){return tm(function(){return ty(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(td.SETTINGS)];case 1:return e.sent(),[2]}})}).call(i)}),this.tutorialsButton.addEventListener("click",function(){return tm(function(){return ty(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(td.TUTORIALS)];case 1:return e.sent(),[2]}})}).call(i)}),this.contributeButton.addEventListener("click",function(){return tm(function(){return ty(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(td.CONTRIBUTE)];case 1:return e.sent(),this.onContributeObservable.notifyObservers(),[2]}})}).call(i)}),this.creditsButton.addEventListener("click",function(){return tm(function(){return ty(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(td.CREDITS)];case 1:return e.sent(),this.onCreditsObservable.notifyObservers(),[2]}})}).call(i)}),this.aboutButton.addEventListener("click",function(){return tm(function(){return ty(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(td.ABOUT)];case 1:return e.sent(),this.onAboutObservable.notifyObservers(),[2]}})}).call(i)})}return e=[{key:"createMainMenuHTML",value:function(){var e=document.createElement("div");e.className="mainMenu";var t=document.createElement("h1");t.textContent="Cosmos Journeyer",e.appendChild(t);var n=document.createElement("p");n.className="version";var r=document.createElement("a");r.target="_blank",r.href="https://github.com/BarthPaleologue/CosmosJourneyer/releases",n.appendChild(r),e.appendChild(n);var a=document.createElement("ul");a.className="leftSideMenu";var i=document.createElement("li");i.textContent=eW.A.t("mainMenu:newJourney"),a.appendChild(i);var o=document.createElement("li");o.textContent=eW.A.t("mainMenu:loadSave"),a.appendChild(o);var s=document.createElement("li");s.textContent=eW.A.t("mainMenu:settings"),a.appendChild(s);var l=document.createElement("li");l.textContent=eW.A.t("mainMenu:tutorials"),a.appendChild(l);var c=document.createElement("li");c.textContent=eW.A.t("mainMenu:contribute"),a.appendChild(c);var u=document.createElement("li");u.textContent=eW.A.t("mainMenu:credits"),a.appendChild(u);var h=document.createElement("li");return h.textContent=eW.A.t("mainMenu:about"),a.appendChild(h),e.appendChild(a),{htmlRoot:e,title:t,version:n,startButton:i,loadSaveButton:o,settingsButton:s,tutorialsButton:l,contributeButton:c,creditsButton:u,aboutButton:h,menuItems:a}}},{key:"init",value:function(){return tm(function(){var e;return ty(this,function(t){switch(t.label){case 0:return e=this,[4,this.starSystemView.loadStarSystem(this.starSystemModel)];case 1:return t.sent(),this.starSystemView.onInitStarSystem.addOnce(function(){return tm(function(){var e,t;return ty(this,function(n){switch(n.label){case 0:return[4,this.starSystemView.switchToDefaultControls(!1)];case 1:if(n.sent(),e="blackHole"===this.starSystemModel.stellarObjects[0].type?8:2,void 0===(t=this.starSystemView.getStarSystem().getOrbitalObjectById(this.universeObjectId.idInSystem)))throw Error("Could not find object with ID ".concat(JSON.stringify(this.universeObjectId)));return(0,eR.$Q)(this.controls,t,this.starSystemView.getStarSystem(),e),[2]}})}).call(e)}),this.starSystemView.targetCursorLayer.setEnabled(!1),this.htmlRoot.style.display="block",[2]}})}).call(this)}},{key:"startAnimation",value:function(e){var t=this;this.sidePanels.hideActivePanel();var n=this.starSystemView.getStarSystem(),r=this.controls.getTransform().forward,a=n.getOrbitalObjectById(this.universeObjectId.idInSystem),i=n.getCelestialBodies().find(function(e){return e===a});if(void 0===i)throw Error("No corresponding celestial body found");var o=i.getTransform().getAbsolutePosition().subtract(this.controls.getTransform().getAbsolutePosition()).normalize(),l=s.Pq.Cross(r,o),c=s.Pq.GetAngleBetweenVectors(r,o,l),u=(0,eR.og)(i,n,.9),h=new eF.J(this.controls.getTransform(),l,c,this.startAnimationDurationSeconds),d=new ej.k(this.controls.getTransform(),u,this.startAnimationDurationSeconds);this.title.animate([{marginTop:this.title.style.marginTop,opacity:1},{marginTop:"30vh",opacity:0}],{duration:1e3*this.startAnimationDurationSeconds,easing:"ease-in-out",fill:"forwards"});var f=function(){var n=t.scene.getEngine().getDeltaTime()/1e3;if(d.isFinished()||d.update(n),h.isFinished()){t.scene.onBeforeRenderObservable.removeCallback(f),t.htmlRoot.style.display="none",t.starSystemView.setUIEnabled(!0),e();return}h.update(n)};this.scene.onBeforeRenderObservable.add(f,void 0,!0),this.hideMenu(),this.hideVersion()}},{key:"hideVersion",value:function(){this.version.style.transform="translateY(100%)"}},{key:"hideMenu",value:function(){this.menuItems.style.left="-20%"}},{key:"hide",value:function(){this.hideVersion(),this.hideMenu(),this.sidePanels.hideActivePanel(),this.htmlRoot.style.display="none"}},{key:"isVisible",value:function(){return"none"!==this.htmlRoot.style.display}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),tg=n(36071);function tw(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}function tS(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){tw(i,r,a,o,s,"next",e)}function s(e){tw(i,r,a,o,s,"throw",e)}o(void 0)})}}function tE(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tP(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var tk=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");tE(this,"rootNode",void 0),tE(this,"mask",void 0),tE(this,"screenshotButton",void 0),tE(this,"shareButton",void 0),tE(this,"contributeButton",void 0),tE(this,"tutorialsButton",void 0),tE(this,"settingsButton",void 0),tE(this,"loadButton",void 0),tE(this,"saveButton",void 0),tE(this,"resumeButton",void 0),tE(this,"sidePanels",void 0),tE(this,"onScreenshot",new eB.cP),tE(this,"onShare",new eB.cP),tE(this,"onSave",new eB.cP),tE(this,"onResume",new eB.cP),this.sidePanels=e,this.mask=document.createElement("div"),this.mask.id="pauseMask",this.rootNode=document.createElement("ul"),this.rootNode.id="pauseMenu",this.rootNode.classList.add("leftSideMenu");var a=function(e,t){var n=document.createElement("li");return n.id=e,n.classList.add("button"),n.innerText=eW.A.t(t),r.rootNode.appendChild(n),n};this.resumeButton=a("resumeButton","pauseMenu:resume"),this.saveButton=a("saveButton","pauseMenu:save"),this.loadButton=a("loadButton","pauseMenu:load"),this.tutorialsButton=a("pauseTutorialsButton","pauseMenu:tutorials"),this.settingsButton=a("pauseSettingsButton","pauseMenu:settings"),this.contributeButton=a("pauseContributeButton","pauseMenu:contribute"),this.screenshotButton=a("screenshotButton","pauseMenu:screenshot"),this.shareButton=a("shareButton","pauseMenu:share"),this.mask.appendChild(this.rootNode),document.body.appendChild(this.mask),this.screenshotButton.addEventListener("click",function(){return r.onScreenshot.notifyObservers()}),this.shareButton.addEventListener("click",function(){return r.onShare.notifyObservers()}),this.contributeButton.addEventListener("click",function(){return tS(function(){return tP(this,function(e){switch(e.label){case 0:return n.playNow(eL.Wo.CLICK),[4,this.sidePanels.toggleActivePanel(td.CONTRIBUTE)];case 1:return e.sent(),[2]}})}).call(r)}),this.tutorialsButton.addEventListener("click",function(){return tS(function(){return tP(this,function(e){switch(e.label){case 0:return n.playNow(eL.Wo.CLICK),[4,this.sidePanels.toggleActivePanel(td.TUTORIALS)];case 1:return e.sent(),[2]}})}).call(r)}),this.settingsButton.addEventListener("click",function(){return tS(function(){return tP(this,function(e){switch(e.label){case 0:return n.playNow(eL.Wo.CLICK),[4,this.sidePanels.toggleActivePanel(td.SETTINGS)];case 1:return e.sent(),[2]}})}).call(r)}),this.loadButton.addEventListener("click",function(){return tS(function(){return tP(this,function(e){switch(e.label){case 0:return n.playNow(eL.Wo.CLICK),[4,this.sidePanels.toggleActivePanel(td.LOAD_SAVE)];case 1:return e.sent(),[2]}})}).call(r)}),this.saveButton.addEventListener("click",function(){return r.onSave.notifyObservers()}),this.resumeButton.addEventListener("click",function(){return r.onResume.notifyObservers()}),this.rootNode.querySelectorAll("li").forEach(function(e){e.addEventListener("mouseenter",function(){n.playNow(eL.Wo.HOVER)}),e.addEventListener("click",function(){n.playNow(eL.Wo.CLICK)})}),this.setVisibility(!1)}return e=[{key:"setVisibility",value:function(e){this.rootNode.style.display=e?"grid":"none",this.mask.style.display=e?"block":"none",e||this.sidePanels.hideActivePanel()}},{key:"isVisible",value:function(){return"none"!==this.rootNode.style.display}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),tC=n(23043),tA=n(66379),tT=n(7657),tL=n(39044);function tI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tM=function(){var e;function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");tI(this,"container",void 0),tI(this,"activeNotifications",[]),tI(this,"isVisible",!0),tI(this,"soundPlayer",void 0),tI(this,"document",void 0),this.soundPlayer=e,this.document=n;var r=this.document.createElement("div");r.classList.add("notification-container"),this.document.body.appendChild(r),this.container=r}return e=[{key:"update",value:function(e){this.activeNotifications.forEach(function(t){t.update(e),1!==t.getProgress()||t.hasRemovalStarted()||t.startRemoval(),1===t.getRemovalProgress()&&t.dispose()}),this.activeNotifications=this.activeNotifications.filter(function(e){return 1>e.getRemovalProgress()})}},{key:"create",value:function(e,t,n,r){var a=new tg.Eg(e,t,n,r/1e3,this.soundPlayer,this.container,this.document);this.activeNotifications.push(a)}},{key:"setVisible",value:function(e){this.isVisible!==e&&(this.isVisible=e,e?this.container.style.removeProperty("display"):this.container.style.display="none")}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function tR(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,a)}function tx(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){tR(i,r,a,o,s,"next",e)}function s(e){tR(i,r,a,o,s,"throw",e)}o(void 0)})}}function tO(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t_(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tN(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var tV=function(){var e,t;function r(e,t,n,a,i,o,l,c,u){var h=this;if(!(this instanceof r))throw TypeError("Cannot call a class as a function");t_(this,"engine",void 0),t_(this,"assets",void 0),t_(this,"starSystemView",void 0),t_(this,"starMap",void 0),t_(this,"musicConductor",void 0),t_(this,"soundPlayer",void 0),t_(this,"tts",void 0),t_(this,"notificationManager",void 0),t_(this,"mainMenu",void 0),t_(this,"pauseMenu",void 0),t_(this,"sidePanels",void 0),t_(this,"tutorialLayer",void 0),t_(this,"activeView",void 0),t_(this,"state",0),t_(this,"videoRecorder",null),t_(this,"player",void 0),t_(this,"backend",void 0),t_(this,"elapsedSeconds",0),t_(this,"autoSavePeriodSeconds",300),t_(this,"autoSaveTimerSeconds",0),t_(this,"isAutoSaveEnabled",!0),this.engine=t,this.assets=n,this.player=e,this.player.onNameChangedObservable.add(function(){return tx(function(){return tN(this,function(e){switch(e.label){case 0:return[4,this.createManualSave()];case 1:return e.sent(),[2]}})}).call(h)}),this.backend=o,this.player.discoveries.uploaded.forEach(function(e){return tx(function(){return tN(this,function(t){switch(t.label){case 0:return[4,this.backend.encyclopaedia.contributeDiscoveryIfNew(e)];case 1:return t.sent(),[2]}})}).call(h)}),this.starSystemView=a,this.starSystemView.onBeforeJump.add(function(){return tx(function(){return tN(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(h)}),this.starSystemView.onAfterJump.add(function(){return tx(function(){var e;return tN(this,function(t){switch(t.label){case 0:return e=this,[4,this.createAutoSave()];case 1:if(t.sent(),this.player.tutorials.fuelScoopingCompleted)return[3,3];return[4,this.tutorialLayer.setTutorial(new tr.F)];case 2:t.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.fuelScoopingCompleted=!0}),t.label=3;case 3:return[2]}})}).call(h)}),this.starSystemView.onNewDiscovery.add(function(){return tx(function(){return tN(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(h)}),this.musicConductor=new eT(this.assets.audio.musics,this.starSystemView),this.soundPlayer=l,this.tts=c,this.notificationManager=u,this.starMap=i,this.starMap.onTargetSetObservable.add(function(e){h.starSystemView.setSystemAsTarget(e)}),this.starMap.detachControl(),this.starSystemView.attachControl(),this.activeView=this.starSystemView,l.setInstanceMask(ek.U.STAR_SYSTEM_VIEW),this.tutorialLayer=new tC.O(this.soundPlayer),document.body.appendChild(this.tutorialLayer.root),this.sidePanels=new tf(this.backend.universe,this.backend.save,this.soundPlayer,this.musicConductor,this.notificationManager),this.sidePanels.loadSavePanel.content.onLoadSaveObservable.add(function(e){t.onEndFrameObservable.addOnce(function(){return tx(function(){return tN(this,function(t){switch(t.label){case 0:if(!this.isPaused())return[3,2];return[4,this.createAutoSave()];case 1:t.sent(),t.label=2;case 2:return[4,this.resume()];case 3:return t.sent(),this.starSystemView.setUIEnabled(!0),[4,this.loadSave(e)];case 4:return t.sent(),[2]}})}).call(h)})}),this.mainMenu=new tb(this.sidePanels,this.starSystemView,this.backend.universe,this.soundPlayer),this.mainMenu.onStartObservable.add(function(){return tx(function(){var e,t,n;return tN(this,function(r){switch(r.label){case 0:return e=this,[4,this.tutorialLayer.setTutorial(new tn.$)];case 1:return r.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.flightCompleted=!0}),[4,this.starSystemView.switchToSpaceshipControls()];case 2:return r.sent(),t=this.starSystemView.getSpaceshipControls().getTransform().getAbsolutePosition(),n=this.starSystemView.getStarSystem().getOrbitalFacilities().reduce(function(e,n){return s.Pq.DistanceSquared(t,n.getTransform().getAbsolutePosition())<s.Pq.DistanceSquared(t,e.getTransform().getAbsolutePosition())?n:e}),this.starSystemView.setTarget(n),[4,this.createAutoSave()];case 3:return r.sent(),[2]}})}).call(h)}),this.sidePanels.tutorialsPanel.content.onTutorialSelected.add(function(e){return tx(function(){return tN(this,function(t){switch(t.label){case 0:if(this.mainMenu.isVisible())return[3,3];return[4,this.createAutoSave()];case 1:return t.sent(),[4,(0,eD.QD)(eW.A.t("tutorials:common:loadTutorialWillLeaveGame"),this.soundPlayer)];case 2:if(!t.sent())return[2];t.label=3;case 3:return this.sidePanels.hideActivePanel(),this.loadTutorial(e),[2]}})}).call(h)}),this.starSystemView.getSpaceshipControls().onToggleWarpDrive.add(function(e){return tx(function(){var t,n,r,a,i,o;return tN(this,function(l){switch(l.label){case 0:if(t=this,e||this.player.tutorials.stationLandingCompleted||null===(r=(n=this.starSystemView.getSpaceshipControls()).getClosestLandableFacility())||(a=n.getTransform().getAbsolutePosition(),i=r.getTransform().position,o=10*r.getBoundingRadius(),s.Pq.DistanceSquared(a,i)>Math.pow(o,2)))return[2];return[4,this.tutorialLayer.setTutorial(new ti.M)];case 1:return l.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){t.player.tutorials.stationLandingCompleted=!0}),[2]}})}).call(h)}),this.starSystemView.getSpaceshipControls().onCompleteLanding.add(function(){return tx(function(){return tN(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(h)}),this.starSystemView.onInitStarSystem.add(function(){var e=h.starSystemView.getStarSystem().model;h.starMap.setCurrentStarSystem(e.coordinates,!1)}),this.starSystemView.spaceStationLayer.onTakeOffObservable.add(function(){return tx(function(){var e;return tN(this,function(t){switch(t.label){case 0:if(e=this,this.player.tutorials.starMapCompleted)return[2];return[4,this.tutorialLayer.setTutorial(new ta.r)];case 1:return t.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.starMapCompleted=!0}),[2]}})}).call(h)}),this.pauseMenu=new tk(this.sidePanels,this.soundPlayer),this.pauseMenu.onResume.add(function(){return h.resume()}),this.pauseMenu.onScreenshot.add(function(){return h.takeScreenshot()}),this.pauseMenu.onShare.add(function(){h.engine.onEndFrameObservable.addOnce(function(){return tx(function(){var e,t,n;return tN(this,function(r){switch(r.label){case 0:return e=this,[4,this.generateSaveData()];case 1:if((t=r.sent()).player.uuid=A.w.SHARED_POSITION_SAVE_UUID,null!==(n=(0,T.fe)(t)))return[3,3];return[4,(0,eD.sQ)("Could not create a shareable link.",this.soundPlayer)];case 2:case 4:return r.sent(),[2];case 3:return[4,navigator.clipboard.writeText(n.toString()).then(function(){e.notificationManager.create(tg.I9.GENERAL,tg.yg.INFO,eW.A.t("notifications:copiedToClipboard"),2e3)})]}})}).call(h)})}),this.pauseMenu.onSave.add(function(){return tx(function(){return tN(this,function(e){switch(e.label){case 0:return[4,this.createManualSave()];case 1:return e.sent()?this.notificationManager.create(tg.I9.GENERAL,tg.yg.SUCCESS,eW.A.t("notifications:saveOk"),2e3):this.notificationManager.create(tg.I9.GENERAL,tg.yg.ERROR,eW.A.t("notifications:cantSaveTutorial"),2e3),[2]}})}).call(h)}),window.addEventListener("blur",function(){h.mainMenu.isVisible()||h.starSystemView.isLoadingSystem()||h.pause()}),window.addEventListener("mouseleave",function(){h.mainMenu.isVisible()||h.starSystemView.isLoadingSystem()||h.pause()}),window.addEventListener("resize",function(){h.engine.resize(!0)}),window.addEventListener("beforeunload",function(){return tx(function(){return tN(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(h)}),eO.i.map.toggleStarMap.on("complete",function(){return tx(function(){return tN(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.toggleStarMap()];case 1:return e.sent(),[2]}})}).call(h)}),eO.i.map.screenshot.on("complete",function(){return tx(function(){return tN(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.takeScreenshot()];case 1:return e.sent(),[2]}})}).call(h)}),eO.i.map.videoCapture.on("complete",function(){return tx(function(){return tN(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.takeVideoCapture()];case 1:return e.sent(),[2]}})}).call(h)}),eO.i.map.togglePause.on("complete",function(){!h.mainMenu.isVisible()&&(h.isPaused()||h.pause())}),window.CosmosJourneyer=this}return e=[{key:"pause",value:function(){this.isPaused()||this.mainMenu.isVisible()||(this.state=2,document.exitPointerLock(),this.activeView===this.starSystemView&&this.starSystemView.stopBackgroundSounds(),this.soundPlayer.playNow(eL.Wo.OPEN_PAUSE_MENU),this.pauseMenu.setVisibility(!0))}},{key:"resume",value:function(){return tx(function(){var e;return tN(this,function(t){switch(t.label){case 0:if(!this.isPaused())return[2];if(this.state=1,this.soundPlayer.playNow(eL.Wo.CLICK),this.pauseMenu.setVisibility(!1),!(this.activeView===this.starSystemView&&this.starSystemView.scene.getActiveControls().shouldLockPointer()))return[3,2];return[4,null==(e=this.engine.getRenderingCanvas())?void 0:e.requestPointerLock()];case 1:t.sent(),t.label=2;case 2:return[2]}})}).call(this)}},{key:"isPaused",value:function(){return 2===this.state}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return tx(function(){var t;return tN(this,function(n){switch(n.label){case 0:if(t=this,e)return[3,2];return[4,this.mainMenu.init()];case 1:n.sent(),n.label=2;case 2:return this.starSystemView.initStarSystem(),this.engine.runRenderLoop(function(){var e=t.engine.getDeltaTime()/1e3;t.elapsedSeconds+=e,t.player.timePlayedSeconds+=e,t.autoSaveTimerSeconds+=e,t.autoSaveTimerSeconds>=t.autoSavePeriodSeconds&&(t.autoSaveTimerSeconds%=t.autoSavePeriodSeconds,t.mainMenu.isVisible()||t.starSystemView.isJumpingBetweenSystems()||t.createAutoSave()),t.notificationManager.update(e),t.musicConductor.update(t.isPaused(),t.activeView===t.starSystemView,t.mainMenu.isVisible(),e),t.soundPlayer.update(),t.tts.update(),t.isPaused()||t.activeView.render()}),this.state=1,[2]}})}).call(this)}},{key:"toggleStarMap",value:function(){return tx(function(){var e,t;return tN(this,function(n){switch(n.label){case 0:if(this.activeView!==this.starSystemView)return[3,1];return this.soundPlayer.setInstanceMask(ek.U.STAR_MAP_VIEW),this.starSystemView.targetCursorLayer.setEnabled(!1),document.exitPointerLock(),this.starSystemView.detachControl(),this.starMap.attachControl(),e=this.starMap,this.activeView=e,e.focusOnCurrentSystem(),[3,3];case 1:if(this.starMap.detachControl(),this.starSystemView.attachControl(),this.soundPlayer.setInstanceMask(ek.U.STAR_SYSTEM_VIEW),this.activeView=this.starSystemView,!this.starSystemView.scene.getActiveControls().shouldLockPointer())return[3,3];return[4,null==(t=this.engine.getRenderingCanvas())?void 0:t.requestPointerLock()];case 2:n.sent(),n.label=3;case 3:return[2]}})}).call(this)}},{key:"takeScreenshot",value:function(){return tx(function(){var e;return tN(this,function(t){switch(t.label){case 0:if(null!==(e=this.activeView.getMainScene().activeCamera))return[3,2];return[4,(0,eD.sQ)("Cannot take screenshot: camera is null",this.soundPlayer)];case 1:return t.sent(),[2,!1];case 2:return l.S0.CreateScreenshot(this.engine,e,{precision:1}),[2,!0]}})}).call(this)}},{key:"takeVideoCapture",value:function(){return tx(function(){return tN(this,function(e){switch(e.label){case 0:if(!c.g.IsSupported(this.engine))return console.warn("Your browser does not support video recording!"),[2];if(null===this.videoRecorder&&(this.videoRecorder=new c.g(this.engine,{fps:60,recordChunckSize:3e6,mimeType:"video/webm;codecs=h264"})),!this.videoRecorder.isRecording)return[3,1];return this.videoRecorder.stopRecording(),[3,3];case 1:return[4,this.videoRecorder.startRecording("planetEngine.webm",Number(prompt("Enter video duration in seconds","10"))).then()];case 2:e.sent(),e.label=3;case 3:return[2]}})}).call(this)}},{key:"getCurrentUniverseCoordinates",value:function(e){var t=this.starSystemView.getStarSystem(),n=e.getAbsolutePosition(),r=t.getNearestOrbitalObject(n),a=(0,z.Ei)(r.model,t.model),i=r.getTransform().computeWorldMatrix(!0).clone().invert(),o=s.Pq.TransformCoordinates(n,i);o.length()<1.1*r.getBoundingRadius()&&o.copyFromFloats(0,0,5*r.getBoundingRadius());var l=e.absoluteRotationQuaternion,c=r.getTransform().absoluteRotationQuaternion.clone().invert(),u=l.multiply(c);return{type:"relative",universeObjectId:a,position:{x:o.x,y:o.y,z:o.z},rotation:{x:u.x,y:u.y,z:u.z,w:u.w}}}},{key:"generateSaveData",value:function(){return tx(function(){var e,t,n,r,a,i;return tN(this,function(o){switch(o.label){case 0:if(t=(e=this.starSystemView.getSpaceshipControls()).getSpaceship(),n=this.getCurrentUniverseCoordinates(e.getTransform()),r=t.isLandedAtFacility()?{type:"atStation",universeObjectId:n.universeObjectId}:n,a=this.activeView.getMainScene().activeCamera,i="",!a)return[3,2];return[4,l.S0.CreateScreenshotAsync(this.engine,a,{width:320,height:180,precision:.8})];case 1:i=o.sent(),o.label=2;case 2:return[2,{uuid:crypto.randomUUID(),timestamp:Date.now(),player:e_.a.Serialize(this.player),playerLocation:{type:"inSpaceship",shipId:t.id},shipLocations:t_({},t.id,r),thumbnail:i}]}})}).call(this)}},{key:"createManualSave",value:function(){return tx(function(){var e,t,n,r,a;return tN(this,function(i){switch(i.label){case 0:if(this.player.uuid===A.w.TUTORIAL_SAVE_UUID)return[2,!1];if(this.player.uuid!==A.w.SHARED_POSITION_SAVE_UUID)return[3,2];return this.player.uuid=crypto.randomUUID(),n=(t=this.player).setName,[4,(0,eD.TF)(eW.A.t("spaceStation:cmdrNameChangePrompt"),this.player.getName(),this.soundPlayer)];case 1:n.apply(t,[null!=(e=i.sent())?e:"Python"]),i.label=2;case 2:return[4,this.generateSaveData()];case 3:return a=(r=i.sent()).player.uuid,[2,this.backend.save.addManualSave(a,r)]}})}).call(this)}},{key:"setAutoSaveEnabled",value:function(e){this.isAutoSaveEnabled=e}},{key:"createAutoSave",value:function(){return tx(function(){var e,t;return tN(this,function(n){switch(n.label){case 0:if(!this.isAutoSaveEnabled)return[2];return[4,this.generateSaveData()];case 1:if((t=(e=n.sent()).player.uuid)===A.w.SHARED_POSITION_SAVE_UUID||t===A.w.TUTORIAL_SAVE_UUID)return[2];return[4,this.backend.save.addAutoSave(t,e)];case 2:return n.sent(),this.autoSaveTimerSeconds=0,[2]}})}).call(this)}},{key:"downloadSaveFile",value:function(){var e=this;this.engine.onEndFrameObservable.addOnce(function(){return tx(function(){var e,t,n,r;return tN(this,function(a){switch(a.label){case 0:return[4,this.generateSaveData()];case 1:return e=new Blob([JSON.stringify(a.sent())],{type:"application/json"}),t=URL.createObjectURL(e),(n=document.createElement("a")).href=t,r=new Date().toLocaleString().replace(/[^0-9a-zA-Z]/g,"_"),n.download="CMDR_".concat(this.player.getName(),"_").concat(r,".json"),n.click(),[2]}})}).call(e)})}},{key:"loadTutorial",value:function(e){var t=this;this.engine.onEndFrameObservable.addOnce(function(){return tx(function(){var t,n;return tN(this,function(r){switch(r.label){case 0:if(this.mainMenu.hide(),this.mainMenu.isVisible())return[3,2];return[4,this.createAutoSave()];case 1:r.sent(),r.label=2;case 2:if((t=e.getSaveData(this.backend.universe)).success)return[3,4];return console.error(t.error),[4,(0,eD.sQ)(eW.A.t("The tutorial save has errors and could not be loaded! Check the console for more information."),this.soundPlayer)];case 3:return r.sent(),[2];case 4:return[4,this.loadSave(t.value)];case 5:return r.sent(),this.player.uuid=A.w.TUTORIAL_SAVE_UUID,[4,this.resume()];case 6:return r.sent(),[4,this.tutorialLayer.setTutorial(e)];case 7:return r.sent(),this.starSystemView.setUIEnabled(!0),n=this.starSystemView.getStarSystem().getNearestOrbitalObject(this.starSystemView.scene.getActiveControls().getTransform().getAbsolutePosition()),(0,tL.t5)(this.starSystemView.getSpaceshipControls().getTransform(),n.getTransform().getAbsolutePosition(),this.starSystemView.scene.useRightHandedSystem),[2]}})}).call(t)})}},{key:"loadSave",value:function(e){return tx(function(){var t,n,r,a,i,o;return tN(this,function(s){switch(s.label){case 0:if(t=this,"inSpaceship"===(n=e.playerLocation).type)return[3,1];return r=n,[3,6];case 1:if(void 0!==(a=e.shipLocations[n.shipId]))return[3,3];return[4,(0,eD.sQ)("Player is in spaceship, but said spaceship does not exist. The loading procedure has been aborted.",this.soundPlayer)];case 2:case 4:return s.sent(),[2];case 3:if("inSpaceship"!==a.type)return[3,5];return[4,(0,eD.sQ)("Spaceship inside spaceships is not yet supported. The loading procedure has been aborted.",this.soundPlayer)];case 5:r=a,s.label=6;case 6:if(null!==(i=this.backend.universe.getSystemModelFromCoordinates(r.universeObjectId.systemCoordinates)))return[3,8];return[4,(0,eD.sQ)("Cannot load universe coordinates: system model not found. The loading procedure has been aborted.",this.soundPlayer)];case 7:return s.sent(),[2];case 8:return o=e_.a.Deserialize(e.player,this.backend.universe),this.player.copyFrom(o,this.backend.universe),this.player.discoveries.uploaded.forEach(function(e){return tx(function(){return tN(this,function(t){switch(t.label){case 0:return[4,this.backend.encyclopaedia.contributeDiscoveryIfNew(e)];case 1:return t.sent(),[2]}})}).call(t)}),[4,this.starSystemView.resetPlayer()];case 9:return s.sent(),this.engine.loadingScreen.displayLoadingUI(),[4,this.starSystemView.loadStarSystem(i)];case 10:if(s.sent(),0!==this.state)return[3,12];return[4,this.init(!0)];case 11:return s.sent(),[3,13];case 12:this.starSystemView.initStarSystem(),s.label=13;case 13:if("inSpaceship"!==n.type)return[3,15];return[4,this.starSystemView.switchToSpaceshipControls()];case 14:return s.sent(),[3,17];case 15:return[4,this.starSystemView.switchToCharacterControls()];case 16:s.sent(),s.label=17;case 17:return[4,this.loadLocation(r)];case 18:return s.sent(),this.engine.loadingScreen.hideLoadingUI(),null!==this.player.currentItinerary&&this.starSystemView.setSystemAsTarget(this.player.currentItinerary[1]),[2]}})}).call(this)}},{key:"loadLocation",value:function(e){return tx(function(){return tN(this,function(t){switch(t.label){case 0:if("relative"!==e.type)return[3,2];return[4,this.loadRelativeLocation(e)];case 1:return t.sent(),[3,4];case 2:if("atStation"!==e.type)return[3,4];return[4,this.loadAtStationLocation(e)];case 3:t.sent(),t.label=4;case 4:return[2]}})}).call(this)}},{key:"loadRelativeLocation",value:function(e){return tx(function(){var t,n,r,a,i,l;return tN(this,function(c){switch(c.label){case 0:if(t=this.starSystemView.scene.getActiveControls().getTransform(),void 0!==(r=(n=this.starSystemView.getStarSystem()).getOrbitalObjectById(e.universeObjectId.idInSystem)))return[3,2];return a=n.getStellarObjects()[0],(0,eR.fE)(a,new s.Pq(0,0,4*a.getBoundingRadius()),new o.PT(0,0,0,1),t),[4,(0,eD.sQ)("The object you are trying to spawn near to could not be found. You will spawn around the first stellar object of the system instead.",this.soundPlayer)];case 1:return c.sent(),[2];case 2:return(0,eR.fE)(r,new s.Pq(e.position.x,e.position.y,e.position.z),new o.PT(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),t),(i=s.Pq.Distance(t.getAbsolutePosition(),r.getTransform().getAbsolutePosition()))<1.1*(l=r.getBoundingRadius())&&(i<.1?t.position.addInPlace(new s.Pq(0,0,5*l)):t.position.scaleInPlace(1.1*l/i)),this.starSystemView.targetCursorLayer.setTarget(r),this.starSystemView.spaceShipLayer.setTarget(r.getTransform()),[2]}})}).call(this)}},{key:"loadAtStationLocation",value:function(e){return tx(function(){var t,n,r,a,i,l;return tN(this,function(c){switch(c.label){case 0:if(t=this.starSystemView.scene.getActiveControls().getTransform(),void 0!==(r=(n=this.starSystemView.getStarSystem()).getOrbitalObjectById(e.universeObjectId.idInSystem))&&("spaceStation"===r.type||"spaceElevator"===r.type))return[3,2];return a=n.getStellarObjects()[0],(0,eR.fE)(a,new s.Pq(0,0,4*a.getBoundingRadius()),new o.PT(0,0,0,1),t),[4,(0,eD.sQ)("The space station you are trying to spawn at could not be found. You will spawn around the first stellar object of the system instead.",this.soundPlayer)];case 1:case 3:return c.sent(),[2];case 2:if(void 0!==(i=r.getLandingPadManager().getAvailableLandingPads().at(0)))return[3,4];return l=r,(0,eR.fE)(l,new s.Pq(0,0,4*l.getBoundingRadius()),new o.PT(0,0,0,1),t),[4,(0,eD.sQ)("There are no available pads at the space station you are trying to spawn at. You have been moved outside of the station instead.",this.soundPlayer)];case 4:return this.starSystemView.getSpaceshipControls().getSpaceship().spawnOnPad(i),[2]}})}).call(this)}}],t=[{key:"CreateAsync",value:function(){return tx(function(){var e,t,o,l,c,f,p,m,v,y,b,g,w,S,E,P,k,C,A,T,L;return tN(this,function(I){switch(I.label){case 0:return e=document.createElement("canvas"),document.body.prepend(e),e.width=window.innerWidth,e.height=window.innerHeight,t=new eM.x(e),[4,H.New()];case 1:if((o=I.sent()).success)return[3,3];return[4,(0,eD.sQ)(o.error.message,new eL.bk)];case 2:throw I.sent(),o.error;case 3:if(l=o.value,!window.location.search.includes("webgpu"))return[3,5];return[4,i.J.CreateAsync(e,{twgslOptions:{wasmPath:new URL(n(91857),n.b).href,jsPath:new URL(n(78381),n.b).href},audioEngine:!0})];case 4:return f=I.sent(),[3,6];case 5:f=new a.N(e,!0,{preserveDrawingBuffer:!0,useHighPrecisionMatrix:!0,doNotHandleContextLost:!0,audioEngine:!0}),I.label=6;case 6:return(c=f).useReverseDepthBuffer=!0,c.loadingScreen=t,c.loadingScreen.displayLoadingUI(),window.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight,c.resize(!0)}),[4,(0,eW.L)()];case 7:return I.sent(),console.log("API: ".concat(c.isWebGPU?"WebGPU":"WebGL")),console.log("GPU detected: ".concat(c.extractDriverInfo())),[4,(0,d.A)()];case 8:var M,R;return p=I.sent(),console.log("Havok initialized"),m=e_.a.Default(l.universe),(v=new ex.B(c,{useFloatingOrigin:!0})).useRightHandedSystem=!0,(y=new h.Z(c,{useFloatingOrigin:!0})).useRightHandedSystem=!0,y.clearColor.set(0,0,0,1),(b=new u.P(!0,p)).setVelocityLimits(1e4,1e4),v.enablePhysics(s.Pq.Zero(),b),(g=new tA.C).addProgressCallback(function(e,n){t.setProgress(e,n)}),M=v,w=(R=function(){var e,t,n;return function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:var a;return e=(a=function(){var e,t,n,r;return function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(a){switch(a.label){case 0:var i,o;return e=(0,es.d)(g),t=(i=function(){var e,t,n,r,a,i,o,s,l,c,u,h,d,f,p;return function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(m){switch(m.label){case 0:return t=(e=function(e,t,n){return null==g||g.startTask(),new Promise(function(r){var a=new q.A(e,t,null,function(){r(a)},n)}).then(function(e){return null==g||g.completeTask(),e})})("Wandering",Q,{loop:!0,streaming:!0}),n=e("StraussBlueDanube",ea,{streaming:!0}),r=e("DeepRelaxation",Y,{streaming:!0}),a=e("AtlanteanTwilight",K,{streaming:!0}),i=e("InfinitePerspective",$,{streaming:!0}),o=e("ThatZenMoment",ei,{streaming:!0}),s=e("EchoesOfTime",X,{streaming:!0}),l=e("PeaceOfMind",et,{streaming:!0}),c=e("SpacialWinds",Z,{streaming:!0}),u=e("Mesmerize",ee,{streaming:!0}),h=e("Reawakening",en,{streaming:!0}),d=e("EquatorialComplex",J,{streaming:!0}),f=e("Soaring",er,{streaming:!0}),p={},[4,t];case 1:return p.wandering=m.sent(),[4,n];case 2:return p.straussBlueDanube=m.sent(),[4,r];case 3:return p.deepRelaxation=m.sent(),[4,a];case 4:return p.atlanteanTwilight=m.sent(),[4,i];case 5:return p.infinitePerspective=m.sent(),[4,o];case 6:return p.thatZenMoment=m.sent(),[4,s];case 7:return p.echoesOfTime=m.sent(),[4,l];case 8:return p.peaceOfMind=m.sent(),[4,c];case 9:return p.spacialWinds=m.sent(),[4,u];case 10:return p.mesmerize=m.sent(),[4,h];case 11:return p.reawakening=m.sent(),[4,d];case 12:return p.equatorialComplex=m.sent(),[4,f];case 13:return[2,(p.soaring=m.sent(),p)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=i.apply(e,t);function o(e){eo(a,n,r,o,s,"next",e)}function s(e){eo(a,n,r,o,s,"throw",e)}o(void 0)})})(),n=(o=function(){var e,t,n,r,a,i,o,s,l,c,u,h,d,f,p;return function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(m){switch(m.label){case 0:return t=(e=function(e,t,n){return null==g||g.startTask(),new Promise(function(r){var a=new q.A(e,t,null,function(){r(a)},n)}).then(function(e){return null==g||g.completeTask(),e})})("InitiatingPlanetaryLanding",ed),n=e("LandingRequestGranted",ep),r=e("LandingComplete",ef),a=e("MissionComplete",ev),i=e("NewDiscovery",ey),o=e("CannotEngageWarpDrive",el),s=e("WarpDriveEmergencyShutDown",eg),l=e("WarpDriveDisengaged",eb),c=e("EngagingWarpDrive",ec),u=e("FuelScoopingVoice",eu),h=e("FuelScoopingCompleteVoice",eh),d=e("LowFuelWarning",em),f={},p={},[4,t];case 1:return p.initiatingPlanetaryLanding=m.sent(),[4,n];case 2:return p.landingRequestGranted=m.sent(),[4,r];case 3:return p.landingComplete=m.sent(),[4,a];case 4:return p.missionComplete=m.sent(),[4,i];case 5:return p.newDiscovery=m.sent(),[4,o];case 6:return p.cannotEngageWarpDrive=m.sent(),[4,s];case 7:return p.warpDriveEmergencyShutDown=m.sent(),[4,l];case 8:return p.warpDriveDisengaged=m.sent(),[4,c];case 9:return p.engagingWarpDrive=m.sent(),[4,u];case 10:return p.fuelScooping=m.sent(),[4,h];case 11:return p.fuelScoopingComplete=m.sent(),[4,d];case 12:return[2,(f.charlotte=(p.lowFuelWarning=m.sent(),p),f)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=o.apply(e,t);function i(e){ew(a,n,r,i,s,"next",e)}function s(e){ew(a,n,r,i,s,"throw",e)}i(void 0)})})(),r={},[4,e];case 1:return r.sounds=a.sent(),[4,t];case 2:return r.musics=a.sent(),[4,n];case 3:return[2,(r.speakerVoiceLines=a.sent(),r)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=a.apply(e,t);function o(e){eS(i,n,r,o,s,"next",e)}function s(e){eS(i,n,r,o,s,"throw",e)}o(void 0)})})(),t=(0,eE.Q)(M,g),n={},[4,e];case 1:return n.audio=r.sent(),[4,t];case 2:return[2,(n.rendering=r.sent(),n)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=R.apply(e,t);function i(e){eP(a,n,r,i,o,"next",e)}function o(e){eP(a,n,r,i,o,"throw",e)}i(void 0)})})(),S=(0,tT.H)(y,g),[4,w];case 9:return E=I.sent(),[4,S];case 10:return P=I.sent(),k=new eL.Lr(E.audio.sounds),C=new eI._l(E.audio.speakerVoiceLines),A=new tM(k),T=new eV.l(v,m,c,b,l.encyclopaedia,l.universe,k,C,A,E.rendering),L=new eN.E(m,y,P,l.encyclopaedia,l.universe,k,A),[4,T.resetPlayer()];case 11:return I.sent(),[4,(0,e6.t)()];case 12:if(null!==I.sent())return[3,14];return[4,(0,eD.sQ)(eW.A.t("notifications:unknownKeyboardLayout"),k)];case 13:I.sent(),I.label=14;case 14:return[2,new r(m,c,E,T,L,l,k,C,A)]}})})()}}],e&&tO(r.prototype,e),t&&tO(r,t),r}()},44175:function(e,t,n){function r(e){var t=[];return e.children.forEach(function(n,r){"x"===r||"y"===r||t.push([r,e.name])}),t}function a(e,t){var n=[];if(e.children.forEach(function(e,r){if("x"!==r&&"y"!==r){var a,i,o=e.name;o=o.replace("key:",""),o=null!=(i=null==t||null==(a=t.get(o))?void 0:a.toUpperCase())?i:o,n.push([r,o])}}),void 0===n[0]||void 0===n[1]||void 0===n[2]||void 0===n[3])throw Error("DPadComposite keys are undefined");return[n[2],n[0],n[3],n[1]]}function i(){return[["x","pointerX"],["y","pointerY"]]}function o(e,t){var n,r,a=e.name;return a=a.replace("key:",""),a=null!=(r=null==t||null==(n=t.get(a))?void 0:n.toUpperCase())?r:a}function s(e,t){var n=[];return e.children.forEach(function(e,r){var a,i,o=e.name;o=o.replace("key:",""),o=null!=(i=null==t||null==(a=t.get(o))?void 0:a.toUpperCase())?i:o,n.push([r,o])}),n}function l(e,t){return e.action.bindings.map(function(e){return o(e.control,t)})}n.d(t,{Fd:()=>a,Jc:()=>r,Lc:()=>s,Xi:()=>o,hg:()=>l,qA:()=>i})},61800:function(e,t,n){n.d(t,{$Q:()=>c,Ez:()=>l,fE:()=>s,og:()=>u});var r=n(52754),a=n(97782),i=n(39044);function o(e,t){var n=-1,r=t[0];if(void 0===r)throw Error("no bodieees !");var a=!0,i=!1,o=void 0;try{for(var s,l=t[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,u=e.subtract(c.getTransform().getAbsolutePosition()).length();(-1===n||u<n)&&(r=c,n=u)}}catch(e){i=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return r}function s(e,t,n,r){var o=e.getBoundingRadius(),s=t.length(),l=Math.max(2*o,s),c=e.getTransform().getWorldMatrix(),u=a.Pq.TransformCoordinates(t.scale(l/(s+1e-4)),c);r.setAbsolutePosition(u);var h=e.getTransform().absoluteRotationQuaternion,d=n.multiply(h);(0,i.rD)(r,d)}function l(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,s=o(t.getTransform().getAbsolutePosition(),n.getStellarObjects());if(s===t)e.getTransform().setAbsolutePosition(t.getTransform().getAbsolutePosition().add(new a.Pq(0,.2,1).scaleInPlace(t.getBoundingRadius()*r)));else{var l=t.getTransform().getAbsolutePosition().subtract(s.getTransform().getAbsolutePosition()),c=l.length();l.scaleInPlace(1/c);var u=s.getTransform().getAbsolutePosition().add(l.scale(c-r*t.getBoundingRadius()));e.getTransform().setAbsolutePosition(u)}(0,i.t5)(e.getTransform(),t.getTransform().getAbsolutePosition(),e.getTransform().getScene().useRightHandedSystem)}function c(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,s=o(t.getTransform().getAbsolutePosition(),n.getStellarObjects());if(s===t)e.getTransform().setAbsolutePosition(t.getTransform().getAbsolutePosition().add(new a.Pq(0,.2,1).scaleInPlace(t.getBoundingRadius()*r)));else{var l=t.getTransform().getAbsolutePosition().subtract(s.getTransform().getAbsolutePosition()),c=l.length();l.scaleInPlace(1/c);var u=t.getTransform().up,h=a.Pq.Cross(l,u),d=s.getTransform().getAbsolutePosition().add(l.scale(c+1.5*t.getBoundingRadius())).add(h.scale(4*t.getBoundingRadius()));e.getTransform().setAbsolutePosition(d),(0,i.lB)(e.getTransform(),t.getTransform().getAbsolutePosition(),l,-Math.PI/16)}var f=s.getTransform().getAbsolutePosition().subtract(t.getTransform().getAbsolutePosition()).normalize(),p=t.getTransform().getAbsolutePosition().add(f.scale(4*t.getBoundingRadius()));(0,i.t5)(e.getTransform(),p,e.getTransform().getScene().useRightHandedSystem),e.getTransform().computeWorldMatrix(!0),(0,i.CL)(e.getTransform(),-Math.PI/8),e.getActiveCamera().getViewMatrix(!0),e.getActiveCamera().getProjectionMatrix(!0)}function u(e,t,n){var i=e.asteroidField;if(null===i)throw Error("The body does not have an asteroid field");var s=e.getTransform().getAbsolutePosition(),l=(0,r.Lerp)(i.innerRadius,i.outerRadius,n),c=o(s,t.getStellarObjects()),u=s.subtract(c.getTransform().getAbsolutePosition()).normalize(),h=e.getTransform().up,d=a.Pq.Cross(u,h).normalize();return s.add(d.scale(l)).add(h.scale(i.patchThickness))}},39044:function(e,t,n){n.d(t,{CL:()=>d,H7:()=>f,Pf:()=>h,Tl:()=>o,e$:()=>l,hQ:()=>c,lB:()=>s,oh:()=>p,rD:()=>u,t5:()=>i});var r=n(29608),a=n(97782);function i(e,t,n){e.lookAt(t),n&&e.rotate(r._0.Y,Math.PI)}function o(e,t){e.setAbsolutePosition(e.getAbsolutePosition().add(t)),e.computeWorldMatrix(!0)}function s(e,t,n,r){e.rotateAround(t,n,r),e.computeWorldMatrix(!0)}function l(e,t,n){e.rotate(t,n,r.$x.WORLD)}function c(e){if(null===e.rotationQuaternion)throw Error("Null quaternion for ".concat(e.name));return e.rotationQuaternion}function u(e,t){e.rotationQuaternion=t,e.computeWorldMatrix(!0)}function h(e,t){if(!t.equalsWithEpsilon(e.up,1e-7)){var n=e.up;l(e,a.Pq.Cross(t,n),-Math.acos(a.Pq.Dot(t,n)))}}function d(e,t){l(e,e.forward,t)}function f(e,t){l(e,e.right,t)}function p(e,t){l(e,e.up,t)}},32634:function(e,t,n){n.d(t,{e:()=>o});var r=n(76945),a=n(52628);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t,n,o){var s=e[0];if(void 0===s)return Promise.resolve(null);var l=new Promise(function(e){j=e}),c=document.createElement("div");c.style.position="fixed",c.style.inset="0",c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",c.style.background="rgba(0, 0, 0, 0.2)",c.style.zIndex="1000",c.style.pointerEvents="auto",c.tabIndex=-1;var u=null!=(W=null==o?void 0:o.useVirtualCursor)?W:null!==document.pointerLockElement;c.style.cursor=u?"none":"default";var h=function(e,t,n){return Math.min(Math.max(e,t),n)},d="http://www.w3.org/2000/svg",f=getComputedStyle(document.documentElement).getPropertyValue("--accent-color-dark").trim(),p=2*Math.PI/e.length,m=-Math.PI/2,v="radial-choice-".concat(Math.random().toString(36).slice(2)),y=getComputedStyle(document.documentElement).getPropertyValue("--accent-color").trim(),b=getComputedStyle(document.documentElement).getPropertyValue("--accent-color-light").trim(),g=document.createElement("div");g.style.position="relative",g.style.width="".concat(500,"px"),g.style.height="".concat(500,"px"),g.style.borderRadius="50%",g.style.boxShadow="0 0 25px rgba(0, 0, 0, 0.6)",g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",c.appendChild(g);var w=document.createElementNS(d,"svg");w.setAttribute("viewBox","0 0 ".concat(500," ").concat(500)),w.style.width="100%",w.style.height="100%",w.style.position="absolute",w.style.inset="0",g.appendChild(w);var S=document.createElementNS(d,"defs");w.appendChild(S);var E=document.createElement("div");E.style.color="white",E.style.fontFamily=a.w.MAIN_FONT,E.style.fontSize="2em",E.style.textAlign="center",E.style.pointerEvents="none",E.style.maxWidth="60%",E.style.zIndex="2",g.appendChild(E);var P=[],k=0,C=function(t){var n;return null!=(n=e[t])?n:s},A=function(e,t){var n=g.getBoundingClientRect();return{x:e-(n.left+n.width/2),y:t-(n.top+n.height/2)}},T=function(n){k=(n+e.length)%e.length,P.forEach(function(e,t){var n=e.path,r=e.label,a=t===k;n.style.fill=a?b:y,r.style.color="white",r.style.textShadow=a?"0 0 8px rgba(255, 255, 255, 0.6)":"none"}),E.textContent=t(C(k))},L=function(e,t){var n=A(e,t),r=n.x,a=n.y,i=k,o=1/0;P.forEach(function(e,t){var n=e.center,s=r-n.x,l=a-n.y,c=s*s+l*l;c<o&&(o=c,i=t)}),i!==k&&T(i)},I=function(){c.removeEventListener("keydown",O),c.removeEventListener("click",x),c.removeEventListener("mousemove",_),u&&Z(),c.isConnected&&c.remove()},M=!1,R=function(e){M||(M=!0,I(),n.playNow(r.Wo.CLICK),j(e))},x=function(){R(C(k))},O=function(e){e.stopPropagation(),"Escape"===e.key&&(e.preventDefault(),R(null))},_=function(e){L(e.clientX,e.clientY)},N=function(e,t){return{x:250+Math.cos(e)*t,y:250+Math.sin(e)*t}},V=function(e,t){var n=N(e,247),r=N(t,247),a=N(t,137),i=N(e,137),o=t-e<=Math.PI?"0":"1";return["M ".concat(n.x," ").concat(n.y),"A ".concat(247," ").concat(247," 0 ").concat(o," 1 ").concat(r.x," ").concat(r.y),"L ".concat(a.x," ").concat(a.y),"A ".concat(137," ").concat(137," 0 ").concat(o," 0 ").concat(i.x," ").concat(i.y),"Z"].join(" ")},D=!0,B=!1,F=void 0;try{for(var j,W,U,G=e.entries()[Symbol.iterator]();!(D=(U=G.next()).done);D=!0)!function(){var e,n=(e=U.value,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var i=[],o=!0,s=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(i.push(n.value),2!==i.length);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==a.return||a.return()}finally{if(s)throw r}}return i}}(e,2)||function(e,t){if(e){if("string"==typeof e)return i(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,2)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=n[0],o=n[1],s=m+p*r,l=s+0,c=s+p-0,u=(l+c)/2,h=document.createElementNS(d,"g");h.style.cursor="pointer";var f=document.createElementNS(d,"clipPath"),b=document.createElementNS(d,"path"),g="".concat(v,"-").concat(r);f.id=g,f.setAttribute("clipPathUnits","userSpaceOnUse"),b.setAttribute("d",V(l,c)),f.appendChild(b),S.appendChild(f);var E=document.createElementNS(d,"path");E.setAttribute("d",V(l,c)),E.setAttribute("clip-path","url(#".concat(g,")")),E.style.fill=y,E.style.transition="fill 0.12s ease, filter 0.12s ease";var k=N(u,192),C=192*(c-l),A=Math.max(Math.min(.75*C,160),70),L=document.createElementNS(d,"foreignObject");L.setAttribute("x",(k.x-A/2).toString()),L.setAttribute("y",(k.y-35).toString()),L.setAttribute("width",A.toString()),L.setAttribute("height","70"),L.style.pointerEvents="none";var I=document.createElement("div");I.textContent=t(o),I.style.fontFamily=a.w.MAIN_FONT,I.style.fontSize="20px",I.style.lineHeight="1.25",I.style.color="rgba(35, 35, 35, 0.85)",I.style.fontWeight="400",I.style.display="flex",I.style.alignItems="center",I.style.justifyContent="center",I.style.textAlign="center",I.style.width="100%",I.style.height="100%",I.style.boxSizing="border-box",I.style.padding="6px 10px",I.style.wordBreak="break-word",I.style.overflowWrap="anywhere",I.style.pointerEvents="none",L.appendChild(I),h.appendChild(E),h.appendChild(L),h.addEventListener("mouseenter",function(){T(r)}),h.addEventListener("click",function(e){e.stopPropagation(),R(o)}),P.push({path:E,label:I,center:{x:192*Math.cos(u),y:192*Math.sin(u)}}),w.appendChild(h)}()}catch(e){B=!0,F=e}finally{try{D||null==G.return||G.return()}finally{if(B)throw F}}var H=document.createElementNS(d,"g");H.style.pointerEvents="none";var z=document.createElementNS(d,"circle");z.setAttribute("cx","250"),z.setAttribute("cy","250"),z.setAttribute("r","247"),z.style.fill="none",z.style.stroke=f,z.style.strokeWidth="6",z.style.strokeLinejoin="round",H.appendChild(z);var q=document.createElementNS(d,"circle");q.setAttribute("cx","250"),q.setAttribute("cy","250"),q.setAttribute("r","137"),q.style.fill="none",q.style.stroke=f,q.style.strokeWidth="6",q.style.strokeLinejoin="round",H.appendChild(q);for(var Q=0;Q<e.length;Q+=1){var K=m+p*Q+0,Y=N(K,247),X=N(K,137),J=document.createElementNS(d,"line");J.setAttribute("x1",Y.x.toString()),J.setAttribute("y1",Y.y.toString()),J.setAttribute("x2",X.x.toString()),J.setAttribute("y2",X.y.toString()),J.style.stroke=f,J.style.strokeWidth="6",J.style.strokeLinecap="round",H.appendChild(J)}w.appendChild(H);var Z=function(){};if(u){var $={x:window.innerWidth/2,y:window.innerHeight/2},ee=document.createElement("div");ee.classList.add("virtualCursor"),ee.style.position="fixed",ee.style.left="0",ee.style.top="0",ee.style.zIndex="1001",c.appendChild(ee);var et=function(e,t){$.x=h(e,0,window.innerWidth),$.y=h(t,0,window.innerHeight),ee.style.transform="translate(calc(".concat($.x,"px - 50%), calc(").concat($.y,"px - 50%))"),L($.x,$.y)},en=function(e){et($.x+e.movementX,$.y+e.movementY)},er=function(e){0===e.button&&(e.preventDefault(),e.stopPropagation(),R(C(k)))},ea=function(){et($.x,$.y)};et($.x,$.y),window.addEventListener("mousemove",en,!0),window.addEventListener("mousedown",er,!0),window.addEventListener("resize",ea),Z=function(){window.removeEventListener("mousemove",en,!0),window.removeEventListener("mousedown",er,!0),window.removeEventListener("resize",ea),ee.remove()}}return document.body.appendChild(c),c.focus({preventScroll:!0}),c.addEventListener("click",x),c.addEventListener("keydown",O),c.addEventListener("mousemove",_),T(0),l}},36071:function(e,t,n){n.d(t,{Eg:()=>f,I9:()=>h,yg:()=>d});var r,a,i=n(76945);let o=n.p+"e11ee3cdd6bf505e.webp";var s=n(43056),l=n(66913),c=n(74520);function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=((r={}).GENERAL="info",r.SPACESHIP="spaceship",r.EXPLORATION="exploration",r.SPACE_STATION="space-station",r),d=((a={}).INFO="info",a.SUCCESS="success",a.WARNING="warning",a.ERROR="error",a),f=function(){var e;function t(e,n,r,a,h,d,f){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");u(this,"progressSeconds",0),u(this,"progressDurationSeconds",void 0),u(this,"removalProgressSeconds",0),u(this,"removalDurationSeconds",.5),u(this,"htmlRoot",void 0),u(this,"isBeingRemoved",!1),this.htmlRoot=f.createElement("div"),this.htmlRoot.classList.add("notification",e);var p=f.createElement("div");p.classList.add("notification-content"),this.htmlRoot.appendChild(p);var m=f.createElement("img");switch(e){case"info":m.src=o;break;case"spaceship":m.src=c;break;case"exploration":m.src=s;break;case"space-station":m.src=l}m.classList.add("notification-icon"),p.appendChild(m);var v=f.createElement("p");v.textContent=r,p.appendChild(v);var y=f.createElement("div");y.classList.add("notification-progress");var b=f.createElement("div");switch(b.classList.add("notification-progress-bar"),y.appendChild(b),this.htmlRoot.appendChild(y),d.appendChild(this.htmlRoot),n){case"info":h.playNow(i.Wo.INFO);break;case"success":h.playNow(i.Wo.SUCCESS);break;case"warning":h.playNow(i.Wo.WARNING);break;case"error":h.playNow(i.Wo.ERROR)}b.style.animation="progress ".concat(a,"s linear"),this.progressDurationSeconds=a}return e=[{key:"update",value:function(e){this.progressSeconds<this.progressDurationSeconds?this.progressSeconds+=e:this.removalProgressSeconds+=e}},{key:"getProgress",value:function(){return Math.max(0,Math.min(1,this.progressSeconds/this.progressDurationSeconds))}},{key:"startRemoval",value:function(){this.isBeingRemoved=!0,this.htmlRoot.style.animation="popOut ".concat(this.removalDurationSeconds,"s ease-in-out")}},{key:"hasRemovalStarted",value:function(){return this.isBeingRemoved}},{key:"getRemovalProgress",value:function(){return Math.max(0,Math.min(1,this.removalProgressSeconds/this.removalDurationSeconds))}},{key:"dispose",value:function(){this.htmlRoot.remove()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},94754:function(e,t,n){n.d(t,{h:()=>o}),n(30630);var r=n(55322);n(94524);var a=n(55308);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var o=function(e,t,n,o){var s=new r.ov(n.r,n.g,n.b,1),l=t.map(function(){return s});return(0,a.sh)(e,{points:function(e){if(Array.isArray(e))return i(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return i(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),colors:l,updatable:!1},o)}},72334:function(e,t,n){n.d(t,{_I:()=>a,ck:()=>i});var r=n(97782);function a(e,t){for(var n=Math.floor(e.length/16),r=Math.floor(n/t),a=new Float32Array(16*r),i=0;i<r;i++){var o=16*Math.floor(Math.random()*n);a.set(e.subarray(o,o+16),16*i)}return a}function i(e,t,n,a){if(void 0===e[0]||void 0===e[1]||void 0===e[2]||void 0===e[3]||void 0===e[4]||void 0===e[5]||void 0===e[6]||void 0===e[7]||void 0===e[8]||void 0===e[9]||void 0===e[10]||void 0===e[11]||void 0===e[12]||void 0===e[13]||void 0===e[14]||void 0===e[15])throw Error("Matrix is not defined");t.set(e[12],e[13],e[14]);var i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);a.set(i,i,i);var o=r.uq.Identity();o.setRowFromFloats(0,e[0]/i,e[1]/i,e[2]/i,0),o.setRowFromFloats(1,e[4]/i,e[5]/i,e[6]/i,0),o.setRowFromFloats(2,e[8]/i,e[9]/i,e[10]/i,0),o.setRowFromFloats(3,0,0,0,1),n.copyFrom(r.PT.FromRotationMatrix(o))}},30451:function(e,t,n){function r(e,t,n){return(0x466f45d*e^0x127409f*t^0x4f9ffb7*n)%1e9}function a(e){var t=0x811c9dc5,n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;t^=s,t=Math.imul(t,0x1000193)}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return(t>>>=0)/0xffffffff}n.d(t,{E:()=>r,g:()=>a})},97678:function(e,t,n){n.d(t,{E1:()=>i,F1:()=>s,GI:()=>a,N9:()=>o,kK:()=>l,tR:()=>c});var r=n(82748);function a(e){return e/r.fM}function i(e){return e*r.fM}function o(e){return e/r.C}function s(e){return e+273.15}function l(e){return e*r.AU}function c(e){return Math.PI/180*e}}}]);