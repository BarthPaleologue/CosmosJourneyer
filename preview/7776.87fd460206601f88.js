/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["7776"],{66131:function(e,r,s){s.d(r,{Hd:()=>U,je:()=>R,nO:()=>B,M0:()=>w,jC:()=>F,pB:()=>P});class t{constructor(){this.children=[]}isValid(e){return!0}process(e,r,s){let t="";if(this.line){let s=this.line,n=r.processor;if(n){n.lineProcessor&&(s=n.lineProcessor(s,r.isFragment,r.processingContext));let t=r.processor?.attributeKeywordName??"attribute",i=r.isFragment&&r.processor?.varyingFragmentKeywordName?r.processor?.varyingFragmentKeywordName:!r.isFragment&&r.processor?.varyingVertexKeywordName?r.processor?.varyingVertexKeywordName:"varying";!r.isFragment&&n.attributeProcessor&&this.line.startsWith(t)?s=n.attributeProcessor(this.line,e,r.processingContext):n.varyingProcessor&&(n.varyingCheck?.(this.line,r.isFragment)||!n.varyingCheck&&this.line.startsWith(i))?s=n.varyingProcessor(this.line,r.isFragment,e,r.processingContext):n.uniformProcessor&&n.uniformRegexp&&n.uniformRegexp.test(this.line)?r.lookForClosingBracketForUniformBuffer||(s=n.uniformProcessor(this.line,r.isFragment,e,r.processingContext)):n.uniformBufferProcessor&&n.uniformBufferRegexp&&n.uniformBufferRegexp.test(this.line)?r.lookForClosingBracketForUniformBuffer||(s=n.uniformBufferProcessor(this.line,r.isFragment,r.processingContext),r.lookForClosingBracketForUniformBuffer=!0):n.textureProcessor&&n.textureRegexp&&n.textureRegexp.test(this.line)?s=n.textureProcessor(this.line,r.isFragment,e,r.processingContext):(n.uniformProcessor||n.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!r.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?n.uniformProcessor&&(s=n.uniformProcessor(this.line,r.isFragment,e,r.processingContext)):n.uniformBufferProcessor&&(s=n.uniformBufferProcessor(this.line,r.isFragment,r.processingContext),r.lookForClosingBracketForUniformBuffer=!0)),r.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(r.lookForClosingBracketForUniformBuffer=!1,n.endOfUniformBufferProcessor&&(s=n.endOfUniformBufferProcessor(this.line,r.isFragment,r.processingContext)))}t+=s+"\n"}for(let n of this.children)t+=n.process(e,r,s);return this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true",s[this.additionalDefineKey]=e[this.additionalDefineKey]),t}}class n{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(e){for(let r of(this._lines.length=0,e)){if(!r||"\r"===r)continue;if("#"===r[0]){this._lines.push(r);continue}let e=r.trim();if(!e)continue;if(e.startsWith("//")){this._lines.push(r);continue}let s=e.indexOf(";");if(-1===s)this._lines.push(e);else if(s===e.length-1)e.length>1&&this._lines.push(e);else{let e=r.split(";");for(let r=0;r<e.length;r++){let s=e[r];s&&(s=s.trim())&&this._lines.push(s+(r!==e.length-1?";":""))}}}}}class i extends t{process(e,r,s){for(let t=0;t<this.children.length;t++){let n=this.children[t];if(n.isValid(e))return n.process(e,r,s)}return""}}class o extends t{isValid(e){return this.testExpression.isTrue(e)}}class l{isTrue(e){return!0}static postfixToInfix(e){let r=[];for(let s of e)if(void 0===l._OperatorPriority[s])r.push(s);else{let e=r[r.length-1],t=r[r.length-2];r.length-=2,r.push(`(${t}${s}${e})`)}return r[r.length-1]}static infixToPostfix(e){let r=l._InfixToPostfixCache.get(e);if(r)return r.accessTime=Date.now(),r.result;if(!e.includes("&&")&&!e.includes("||")&&!e.includes(")")&&!e.includes("("))return[e];let s=[],t=-1,n=()=>{""!==(c=c.trim())&&(s.push(c),c="")},i=e=>{t<l._Stack.length-1&&(l._Stack[++t]=e)},o=()=>l._Stack[t],f=()=>-1===t?"!!INVALID EXPRESSION!!":l._Stack[t--],a=0,c="";for(;a<e.length;){let r=e.charAt(a),u=a<e.length-1?e.substring(a,2+a):"";if("("===r)c="",i(r);else if(")"===r){for(n();-1!==t&&"("!==o();)s.push(f());f()}else if(l._OperatorPriority[u]>1){for(n();-1!==t&&l._OperatorPriority[o()]>=l._OperatorPriority[u];)s.push(f());i(u),a++}else c+=r;a++}for(n();-1!==t;)"("===o()?f():s.push(f());return l._InfixToPostfixCache.size>=l.InfixToPostfixCacheLimitSize&&l.ClearCache(),l._InfixToPostfixCache.set(e,{result:s,accessTime:Date.now()}),s}static ClearCache(){let e=Array.from(l._InfixToPostfixCache.entries()).sort((e,r)=>e[1].accessTime-r[1].accessTime);for(let r=0;r<l.InfixToPostfixCacheCleanupSize;r++)l._InfixToPostfixCache.delete(e[r][0])}}l.InfixToPostfixCacheLimitSize=5e4,l.InfixToPostfixCacheCleanupSize=25e3,l._InfixToPostfixCache=new Map,l._OperatorPriority={")":0,"(":1,"||":2,"&&":3},l._Stack=["","","","","","","","","","","","","","","","","","","",""];class f extends l{constructor(e,r=!1){super(),this.define=e,this.not=r}isTrue(e){let r=void 0!==e[this.define];return this.not&&(r=!r),r}}class a extends l{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}class c extends l{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}class u extends l{constructor(e,r,s){super(),this.define=e,this.operand=r,this.testValue=s}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(e){let r=!1,s=parseInt(void 0!=e[this.define]?e[this.define]:this.define),t=parseInt(void 0!=e[this.testValue]?e[this.testValue]:this.testValue);if(isNaN(s)||isNaN(t))return!1;switch(this.operand){case">":r=s>t;break;case"<":r=s<t;break;case"<=":r=s<=t;break;case">=":r=s>=t;break;case"==":r=s===t;break;case"!=":r=s!==t}return r}}var h=s(5813),p=s(45959);let d=/defined\s*?\((.+?)\)/g,g=/defined\s*?\[(.+?)\]/g,x=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,m=/__decl__/,C=/light\{X\}.(\w*)/g,_=/\{X\}/g,S=[],y=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function P(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}function w(e,r,s,t){r.processor?.preProcessShaderCode&&(e=r.processor.preProcessShaderCode(e,r.isFragment)),R(e,r,e=>{r.processCodeAfterIncludes&&(e=r.processCodeAfterIncludes(r.isFragment?"fragment":"vertex",e,r.defines)),s(function(e,r,s){let t=function(e,r){if(r.processor?.noPrecision)return e;let s=r.shouldUseHighPrecisionShader;return -1===e.indexOf("precision highp float")?e=s?"precision highp float;\n"+e:"precision mediump float;\n"+e:s||(e=e.replace("precision highp float","precision mediump float")),e}(e,r);if(!r.processor||0===r.processor.shaderLanguage&&-1!==t.indexOf("#version 3")&&(t=t.replace("#version 300 es",""),!r.processor.parseGLES3))return t;let n=r.defines,i=O(r,s);r.processor.preProcessor&&(t=r.processor.preProcessor(t,n,i,r.isFragment,r.processingContext));let o={};return t=k(t,i,r,o),r.processor.postProcessor&&(t=r.processor.postProcessor(t,n,r.isFragment,r.processingContext,s?{drawBuffersExtensionDisabled:!s.getCaps().drawBuffersExtension}:{},i,o)),s?._features.needShaderCodeInlining&&(t=s.inlineShaderCode(t)),t}(e,r,t),e)})}function F(e,r,s,t){r.processor?.preProcessShaderCode&&(e=r.processor.preProcessShaderCode(e,r.isFragment)),R(e,r,e=>{var n,i,o;let l,f,a,c;r.processCodeAfterIncludes&&(e=r.processCodeAfterIncludes(r.isFragment?"fragment":"vertex",e,r.defines)),s((n=e,i=r,o=t,l=n,f=i.defines,a=O(i,o),i.processor?.preProcessor&&(l=i.processor.preProcessor(l,f,a,i.isFragment,i.processingContext)),l=k(l,a,i,c={}),i.processor?.postProcessor&&(l=i.processor.postProcessor(l,f,i.isFragment,i.processingContext,o?{drawBuffersExtensionDisabled:!o.getCaps().drawBuffersExtension}:{},a,c)),o._features.needShaderCodeInlining&&(l=o.inlineShaderCode(l)),l),e)})}function B(e,r,s){return s.processor&&s.processor.finalizeShaders?s.processor.finalizeShaders(e,r,s.processingContext):{vertexCode:e,fragmentCode:r}}function E(e){let r=/defined\((.+)\)/.exec(e);if(r&&r.length)return new f(r[1].trim(),"!"===e[0]);let s="",t=0;for(s of["==","!=",">=","<=","<",">"])if((t=e.indexOf(s))>-1)break;if(-1===t)return new f(e);let n=e.substring(0,t).trim(),i=e.substring(t+s.length).trim();return new u(n,s,i)}function I(e,r){let s=new o,t=e.substring(0,r),n=e.substring(r);return n=n.substring(0,(n.indexOf("//")+1||n.length+1)-1).trim(),"#ifdef"===t?s.testExpression=new f(n):"#ifndef"===t?s.testExpression=new f(n,!0):s.testExpression=function(e){e=e.replace(d,"defined[$1]");let r=l.infixToPostfix(e),s=[];for(let e of r)if("||"!==e&&"&&"!==e)s.push(e);else if(s.length>=2){let r=s[s.length-1],t=s[s.length-2];s.length-=2;let n="&&"==e?new c:new a;"string"==typeof r&&(r=r.replace(g,"defined($1)")),"string"==typeof t&&(t=t.replace(g,"defined($1)")),n.leftOperand="string"==typeof t?E(t):t,n.rightOperand="string"==typeof r?E(r):r,s.push(n)}let t=s[s.length-1];return"string"==typeof t&&(t=t.replace(g,"defined($1)")),"string"==typeof t?E(t):t}(n),s}function A(e,r,s,n){let i=e.currentLine;for(;T(e,s,n);){let o=(i=e.currentLine).substring(0,5).toLowerCase();if("#else"===o){let s=new t;r.children.push(s),T(e,s,n);return}if("#elif"===o){let e=I(i,5);r.children.push(e),s=e}}}function T(e,r,s){for(;e.canRead;){e.lineIndex++;let n=e.currentLine;if(n.indexOf("#")>=0){let t=y.exec(n);if(t&&t.length){switch(t[0]){case"#ifdef":{let t=new i;r.children.push(t);let o=I(n,6);t.children.push(o),A(e,t,o,s);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{let t=new i;r.children.push(t);let o=I(n,7);t.children.push(o),A(e,t,o,s);break}case"#if":{let t=new i,o=I(n,3);r.children.push(t),t.children.push(o),A(e,t,o,s)}}continue}}let o=new t;if(o.line=n,r.children.push(o),"#"===n[0]&&"d"===n[1]){let e=n.replace(";","").split(" ");o.additionalDefineKey=e[1],3===e.length&&(o.additionalDefineValue=e[2])}}return!1}function k(e,r,s,i){let o=new t,l=new n;return l.lineIndex=-1,l.lines=e.split("\n"),T(l,o,i),o.process(r,s,i)}function O(e,r){let s=e.defines,t={};for(let e of s){let r=e.replace("#define","").replace(";","").trim().split(" ");t[r[0]]=r.length>1?r[1]:""}return e.processor?.shaderLanguage===0&&(t.GL_ES="true"),t.__VERSION__=e.version,t[e.platformName]="true",(0,p.tj)(t,r?.isNDCHalfZRange,r?.useReverseDepthBuffer,r?.useExactSrgbConversions),t}function R(e,r,s){let t;for(S.length=0;null!==(t=x.exec(e));)S.push(t);let n=String(e),i=[e],o=!1;for(let e of S){let t=e[1];if(-1!==t.indexOf("__decl__")&&(t=t.replace(m,""),r.supportsUniformBuffers&&(t=t.replace("Vertex","Ubo").replace("Fragment","Ubo")),t+="Declaration"),r.includesShadersStore[t]){let s=r.includesShadersStore[t];if(e[2]){let r=e[3].split(",");for(let e=0;e<r.length;e+=2){let t=RegExp(r[e],"g"),n=r[e+1];s=s.replace(t,n)}}if(e[4]){let t=e[5];if(-1!==t.indexOf("..")){let e=t.split(".."),n=parseInt(e[0]),i=parseInt(e[1]),o=s.slice(0);s="",isNaN(i)&&(i=r.indexParameters[e[1]]);for(let e=n;e<i;e++)r.supportsUniformBuffers||(o=o.replace(C,(e,r)=>r+"{X}")),s+=o.replace(_,e.toString())+"\n"}else r.supportsUniformBuffers||(s=s.replace(C,(e,r)=>r+"{X}")),s=s.replace(_,t)}let n=[];for(let r of i){let t=r.split(e[0]);for(let e=0;e<t.length-1;e++)n.push(t[e]),n.push(s);n.push(t[t.length-1])}i=n,o=o||s.indexOf("#include<")>=0||s.indexOf("#include <")>=0}else{let e=r.shadersRepository+"ShadersInclude/"+t+".fx";U.loadFile(e,e=>{r.includesShadersStore[t]=e,R(i.join(""),r,s)});return}}S.length=0,n=i.join(""),o?R(n.toString(),r,s):s(n)}let U={loadFile:(e,r,s,t,n,i)=>{throw(0,h.n)("FileTools")}}},45959:function(e,r,s){s.d(r,{iL:()=>i,kZ:()=>f,sb:()=>o,sg:()=>n,tj:()=>l});var t=s(5813);s(78664);let n={};function i(e,r,s=""){return s+(r?r+"\n":"")+e}function o(e,r,s,i,o,l,f){let a=f||n.loadFile;if(a)return a(e,r,s,i,o,l);throw(0,t.n)("FileTools")}function l(e,r,s,t){if(e){r?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,s?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,t?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS;return}{let e="";return r&&(e+="#define IS_NDC_HALF_ZRANGE"),s&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),t&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}function f(e,r,s=!1,t){switch(e){case 3:{let e=(r instanceof ArrayBuffer,new Int8Array(r));return t&&e.set(new Int8Array(t)),e}case 0:{let e=(r instanceof ArrayBuffer,new Uint8Array(r));return t&&e.set(new Uint8Array(t)),e}case 4:{let e=new Int16Array(r instanceof ArrayBuffer?r:s?r/2:r);return t&&e.set(new Int16Array(t)),e}case 5:case 8:case 9:case 10:case 2:{let e=new Uint16Array(r instanceof ArrayBuffer?r:s?r/2:r);return t&&e.set(new Uint16Array(t)),e}case 6:{let e=new Int32Array(r instanceof ArrayBuffer?r:s?r/4:r);return t&&e.set(new Int32Array(t)),e}case 7:case 11:case 12:case 13:case 14:case 15:{let e=new Uint32Array(r instanceof ArrayBuffer?r:s?r/4:r);return t&&e.set(new Uint32Array(t)),e}case 1:{let e=new Float32Array(r instanceof ArrayBuffer?r:s?r/4:r);return t&&e.set(new Float32Array(t)),e}}let n=(r instanceof ArrayBuffer,new Uint8Array(r));return t&&n.set(new Uint8Array(t)),n}}}]);