/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunk_cosmos_journeyer_game=globalThis.webpackChunk_cosmos_journeyer_game||[]).push([["3073"],{65750(e,t,r){r.d(t,{FG:()=>a,Kq:()=>w,ZR:()=>f,tb:()=>d});var n=r(40082);r(73669);function a(e,t){let r=0;for(let n=0;n<65536;++n)(0==n||e[n>>3]&1<<(7&n))&&(t[r++]=n);let n=r-1;for(;r<65536;)t[r++]=0;return n}function l(e,t,r,a,l){for(;r<e;)t=t<<8|(0,n.fz)(a,l),r+=8;return{l:t>>(r-=e)&(1<<e)-1,c:t,lc:r}}function i(e,t,r,a){return{c:e=e<<8|(0,n.fz)(r,a),lc:t+=8}}function o(e,t,r,n,a,l,o,u,f){if(e==t){if(n<8){let e=i(r,n,a,l);r=e.c,n=e.lc}let e=r>>(n-=8);if(e=new Uint8Array([e])[0],u.value+e>f)return null;let t=o[u.value-1];for(;e-- >0;)o[u.value++]=t}else{if(!(u.value<f))return null;o[u.value++]=e}return{c:r,lc:n}}let u=Array(59);function f(e,t,r,a,f,s){let c=r.value,h=(0,n.PX)(t,r),d=(0,n.PX)(t,r);r.value+=4;let w=(0,n.PX)(t,r);if(r.value+=4,h<0||h>=65537||d<0||d>=65537)throw Error("Wrong HUF_ENCSIZE");let p=Array(65537),y=Array(16384);for(let e=0;e<16384;e++)y[e]={},y[e].len=0,y[e].lit=0,y[e].p=null;let b=a-(r.value-c);if(!function(e,t,r,n,a,i){let o=0,f=0;for(;n<=a;n++){if(t.value-t.value>r)return;let u=l(6,o,f,e,t),s=u.l;if(o=u.c,f=u.lc,i[n]=s,63==s){if(t.value-t.value>r)throw Error("Error in HufUnpackEncTable");let s=(u=l(8,o,f,e,t)).l+6;if(o=u.c,f=u.lc,n+s>a+1)throw Error("Error in HufUnpackEncTable");for(;s--;)i[n++]=0;n--}else if(s>=59){let e=s-59+2;if(n+e>a+1)throw Error("Error in HufUnpackEncTable");for(;e--;)i[n++]=0;n--}}!function(e){for(let e=0;e<=58;++e)u[e]=0;for(let t=0;t<65537;++t)u[e[t]]+=1;let t=0;for(let e=58;e>0;--e){let r=t+u[e]>>1;u[e]=t,t=r}for(let t=0;t<65537;++t){let r=e[t];r>0&&(e[t]=r|u[r]++<<6)}}(i)}(e,r,b,h,d,p),w>8*(a-(r.value-c)))throw Error("Wrong hufUncompress");!function(e,t,r,n){for(;t<=r;t++){let r=e[t]>>6,a=63&e[t];if(r>>a)throw Error("Invalid table entry");if(a>14){let e=n[r>>a-14];if(e.len)throw Error("Invalid table entry");if(e.lit++,e.p){let t=e.p;e.p=Array(e.lit);for(let r=0;r<e.lit-1;++r)e.p[r]=t[r]}else e.p=[,];e.p[e.lit-1]=t}else if(a){let e=0;for(let l=1<<14-a;l>0;l--){let l=n[(r<<14-a)+e];if(l.len||l.p)throw Error("Invalid table entry");l.len=a,l.lit=t,e++}}}}(p,h,d,y),function(e,t,r,n,a,l,u,f,s){let c=0,h=0,d=Math.trunc(n.value+(a+7)/8);for(;n.value<d;){let a=i(c,h,r,n);for(c=a.c,h=a.lc;h>=14;){let w=t[c>>h-14&16383];if(w.len){h-=w.len;let e=o(w.lit,l,c,h,r,n,f,s,u);e&&(c=e.c,h=e.lc)}else{let t;if(!w.p)throw Error("hufDecode issues");for(t=0;t<w.lit;t++){let p=63&e[w.p[t]];for(;h<p&&n.value<d;)c=(a=i(c,h,r,n)).c,h=a.lc;if(h>=p&&e[w.p[t]]>>6==(c>>h-p&(1<<p)-1)){h-=p;let e=o(w.p[t],l,c,h,r,n,f,s,u);e&&(c=e.c,h=e.lc);break}}if(t==w.lit)throw Error("HufDecode issues")}}}let w=8-a&7;for(c>>=w,h-=w;h>0;){let e=t[c<<14-h&16383];if(e.len){h-=e.len;let t=o(e.lit,l,c,h,r,n,f,s,u);t&&(c=t.c,h=t.lc)}else throw Error("HufDecode issues")}}(p,y,e,r,w,d,s,f,{value:0})}function s(e){let t=65535&e;return t>32767?t-65536:t}function c(e,t){let r=s(e),n=s(t),a=r+(1&n)+(n>>1);return{a:a,b:a-n}}function h(e,t){let r=65535&t,n=(65535&e)-(r>>1)&65535;return{a:r+n-32768&65535,b:n}}function d(e,t,r,n,a,l,i){let o,u,f=i<16384,s=r>a?a:r,d=1;for(;d<=s;)d<<=1;for(d>>=1,o=d,d>>=1;d>=1;){let i,s,w,p,y=(u=0)+l*(a-o),b=l*d,v=l*o,S=n*d,E=n*o;for(;u<=y;u+=v){let a=u,l=u+n*(r-o);for(;a<=l;a+=E){let r=a+S,n=a+b,l=n+S;if(f){let o=c(e[a+t],e[n+t]);i=o.a,w=o.b,s=(o=c(e[r+t],e[l+t])).a,p=o.b,o=c(i,s),e[a+t]=o.a,e[r+t]=o.b,o=c(w,p),e[n+t]=o.a,e[l+t]=o.b}else{let o=h(e[a+t],e[n+t]);i=o.a,w=o.b,s=(o=h(e[r+t],e[l+t])).a,p=o.b,o=h(i,s),e[a+t]=o.a,e[r+t]=o.b,o=h(w,p),e[n+t]=o.a,e[l+t]=o.b}}if(r&d){let r,n=a+b;i=(r=f?c(e[a+t],e[n+t]):h(e[a+t],e[n+t])).a,e[n+t]=r.b,e[a+t]=i}}if(a&d){let a=u,l=u+n*(r-o);for(;a<=l;a+=E){let r,n=a+S;i=(r=f?c(e[a+t],e[n+t]):h(e[a+t],e[n+t])).a,e[n+t]=r.b,e[a+t]=i}}o=d,d>>=1}return u}function w(e,t,r){for(let n=0;n<r;++n)t[n]=e[t[n]]}},73887(e,t,r){r.d(t,{S4:()=>i,VE:()=>u,_k:()=>f,r:()=>o,tg:()=>s});var n=r(65750),a=r(9752),l=r(40082);function i(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function o(e){let t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array((0,a._)(t)),n=new Uint8Array(r.length);return(0,l.XE)(r),(0,l.KA)(r,n),new DataView(n.buffer)}function u(e){let t=e.array.slice(e.offset.value,e.offset.value+e.size),r=fflate.unzlibSync(t),n=new Uint8Array(r.length);return(0,l.XE)(r),(0,l.KA)(r,n),new DataView(n.buffer)}function f(e){let t=e.array.slice(e.offset.value,e.offset.value+e.size),r=fflate.unzlibSync(t),n=e.lines*e.channels*e.width,a=1==e.type?new Uint16Array(n):new Uint32Array(n),l=0,i=0,o=[,,,,];for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:o[0]=l,o[1]=o[0]+e.width,l=o[1]+e.width;for(let n=0;n<e.width;++n)t+=r[o[0]++]<<8|r[o[1]++],a[i]=t,i++;break;case 2:o[0]=l,o[1]=o[0]+e.width,o[2]=o[1]+e.width,l=o[2]+e.width;for(let n=0;n<e.width;++n)t+=r[o[0]++]<<24|r[o[1]++]<<16|r[o[2]++]<<8,a[i]=t,i++}}return new DataView(a.buffer)}function s(e){let t=e.viewer,r={value:e.offset.value},a=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),i=new Uint8Array(8192),o=0,u=Array(e.channels);for(let t=0;t<e.channels;t++)u[t]={},u[t].start=o,u[t].end=u[t].start,u[t].nx=e.width,u[t].ny=e.lines,u[t].size=e.type,o+=u[t].nx*u[t].ny*u[t].size;let f=(0,l.Jn)(t,r),s=(0,l.Jn)(t,r);if(s>=8192)throw Error("Wrong PIZ_COMPRESSION BITMAP_SIZE");if(f<=s)for(let e=0;e<s-f+1;e++)i[e+f]=(0,l._S)(t,r);let c=new Uint16Array(65536),h=(0,n.FG)(i,c),d=(0,l.PX)(t,r);(0,n.ZR)(e.array,t,r,d,a,o);for(let t=0;t<e.channels;++t){let e=u[t];for(let r=0;r<u[t].size;++r)(0,n.tb)(a,e.start+r,e.nx,e.size,e.ny,e.nx*e.size,h)}(0,n.Kq)(c,a,o);let w=0,p=new Uint8Array(a.buffer.byteLength);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let e=u[t],r=e.nx*e.size,n=new Uint8Array(a.buffer,2*e.end,2*r);p.set(n,w),w+=2*r,e.end+=r}return new DataView(p.buffer)}r(73669)},9752(e,t,r){r.d(t,{_:()=>n});function n(e){let t=e.byteLength,r=[],n=0,a=new DataView(e);for(;t>0;){let e=a.getInt8(n++);if(e<0){let l=-e;t-=l+1;for(let e=0;e<l;e++)r.push(a.getUint8(n++))}else{t-=2;let l=a.getUint8(n++);for(let t=0;t<e+1;t++)r.push(l)}}return r}},77739(e,t,r){var n,a;r.d(t,{V:()=>n,u:()=>l}),(a=n||(n={}))[a.Float=0]="Float",a[a.HalfFloat=1]="HalfFloat";class l{}l.DefaultOutputType=n.HalfFloat,l.FFLATEUrl="https://unpkg.com/fflate@0.8.2"},40082(e,t,r){r.d(t,{Ff:()=>y,Jn:()=>d,KA:()=>g,LD:()=>b,PX:()=>c,Sn:()=>v,T$:()=>f,XE:()=>E,_S:()=>h,cL:()=>s,fz:()=>w,he:()=>l,tB:()=>p,zX:()=>S});var n,a,l,i,o=r(50377);r(73669),(n=l||(l={}))[n.NO_COMPRESSION=0]="NO_COMPRESSION",n[n.RLE_COMPRESSION=1]="RLE_COMPRESSION",n[n.ZIPS_COMPRESSION=2]="ZIPS_COMPRESSION",n[n.ZIP_COMPRESSION=3]="ZIP_COMPRESSION",n[n.PIZ_COMPRESSION=4]="PIZ_COMPRESSION",n[n.PXR24_COMPRESSION=5]="PXR24_COMPRESSION",(a=i||(i={}))[a.INCREASING_Y=0]="INCREASING_Y",a[a.DECREASING_Y=1]="DECREASING_Y";let u=function(){let e=new ArrayBuffer(4),t=new Float32Array(e),r=new Uint32Array(e),n=new Uint32Array(512),a=new Uint32Array(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(n[e]=0,n[256|e]=32768,a[e]=24,a[256|e]=24):t<-14?(n[e]=1024>>-t-14,n[256|e]=1024>>-t-14|32768,a[e]=-t-1,a[256|e]=-t-1):t<=15?(n[e]=t+15<<10,n[256|e]=t+15<<10|32768,a[e]=13,a[256|e]=13):t<128?(n[e]=31744,n[256|e]=64512,a[e]=24,a[256|e]=24):(n[e]=31744,n[256|e]=64512,a[e]=13,a[256|e]=13)}let l=new Uint32Array(2048),i=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;(8388608&t)==0;)t<<=1,r-=8388608;t&=-8388609,r+=0x38800000,l[e]=t|r}for(let e=1024;e<2048;++e)l[e]=0x38000000+(e-1024<<13);for(let e=1;e<31;++e)i[e]=e<<23;i[31]=0x47800000,i[32]=0x80000000;for(let e=33;e<63;++e)i[e]=0x80000000+(e-32<<23);i[63]=0xc7800000;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:r,baseTable:n,shiftTable:a,mantissaTable:l,exponentTable:i,offsetTable:o}}();function f(e,t){let r=new Uint8Array(e),n=0;for(;0!=r[t.value+n];)n+=1;let a=new TextDecoder().decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,a}function s(e,t){let r=e.getInt32(t.value,!0);return t.value+=4,r}function c(e,t){let r=e.getUint32(t.value,!0);return t.value+=4,r}function h(e,t){let r=e.getUint8(t.value);return t.value+=1,r}function d(e,t){let r=e.getUint16(t.value,!0);return t.value+=2,r}function w(e,t){let r=e[t.value];return t.value+=1,r}function p(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r}function y(e,t){let r=e.getFloat32(t.value,!0);return t.value+=4,r}function b(e,t){var r;let n,a;return n=(31744&(r=d(e,t)))>>10,a=1023&r,(r>>15?-1:1)*(n?31===n?a?NaN:1/0:Math.pow(2,n-15)*(1+a/1024):a/1024*6103515625e-14)}function v(e,t){var r=y(e,t);if(Math.abs(r)>65504)throw Error("Value out of range.Consider using float instead of half-float.");r=(0,o.Clamp)(r,-65504,65504),u.floatView[0]=r;let n=u.uint32View[0],a=n>>23&511;return u.baseTable[a]+((8388607&n)>>u.shiftTable[a])}function S(e,t,r,n){var a;switch(r){case"string":case"stringvector":case"iccProfile":let l;return a=e.buffer,l=new TextDecoder().decode(new Uint8Array(a).slice(t.value,t.value+n)),t.value=t.value+n,l;case"chlist":return function(e,t,r){let n=t.value,a=[];for(;t.value<n+r-1;){let r=f(e.buffer,t),n=s(e,t),l=h(e,t);t.value+=3;let i=s(e,t),o=s(e,t);a.push({name:r,pixelType:n,pLinear:l,xSampling:i,ySampling:o})}return t.value+=1,a}(e,t,n);case"chromaticities":let o,u,d,w,p,b;return o=y(e,t),u=y(e,t),d=y(e,t),w=y(e,t),p=y(e,t),b=y(e,t),{redX:o,redY:u,greenX:d,greenY:w,blueX:p,blueY:b,whiteX:y(e,t),whiteY:y(e,t)};case"compression":return h(e,t);case"box2i":let v,S;return v=s(e,t),S=s(e,t),{xMin:v,yMin:S,xMax:s(e,t),yMax:s(e,t)};case"lineOrder":return i[h(e,t)];case"float":return y(e,t);case"v2f":return[y(e,t),y(e,t)];case"v3f":let E;return E=y(e,t),[E,y(e,t),y(e,t)];case"int":return s(e,t);case"rational":return[s(e,t),c(e,t)];case"timecode":return[c(e,t),c(e,t)];case"preview":return t.value+=n,"skipped";default:t.value+=n;return}}function E(e){for(let t=1;t<e.length;t++){let r=e[t-1]+e[t]-128;e[t]=r}}function g(e,t){let r=0,n=Math.floor((e.length+1)/2),a=0,l=e.length-1;for(;!(a>l)&&(t[a++]=e[r++],!(a>l));){;t[a++]=e[n++]}}},20897(e,t,r){r.d(t,{d:()=>o,u:()=>u});var n=r(40082),a=r(73887);r(73669);var l=r(75012),i=r(77739);async function o(e,t,r,o){let u={size:0,viewer:t,array:new Uint8Array(t.buffer),offset:r,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,channelLineOffsets:{},scanOrder:()=>0,bytesPerLine:0,outLineWidth:0,lines:0,scanlineBlockSize:0,inputSize:null,type:0,uncompress:null,getter:()=>0,format:5,outputChannels:0,decodeChannels:{},blockCount:null,byteArray:null,linearSpace:!1,textureType:0};switch(e.compression){case n.he.NO_COMPRESSION:u.lines=1,u.uncompress=a.S4;break;case n.he.RLE_COMPRESSION:u.lines=1,u.uncompress=a.r;break;case n.he.ZIPS_COMPRESSION:u.lines=1,u.uncompress=a.VE,await l.S0.LoadScriptAsync(i.u.FFLATEUrl);break;case n.he.ZIP_COMPRESSION:u.lines=16,u.uncompress=a.VE,await l.S0.LoadScriptAsync(i.u.FFLATEUrl);break;case n.he.PIZ_COMPRESSION:u.lines=32,u.uncompress=a.tg;break;case n.he.PXR24_COMPRESSION:u.lines=16,u.uncompress=a._k,await l.S0.LoadScriptAsync(i.u.FFLATEUrl);break;default:throw Error(n.he[e.compression]+" is unsupported")}u.scanlineBlockSize=u.lines;let f={};for(let t of e.channels)switch(t.name){case"R":case"G":case"B":case"A":case"Y":f[t.name]=!0,u.type=t.pixelType}let s=!1;if(f.R&&f.G&&f.B&&f.A)u.outputChannels=4,u.decodeChannels={R:0,G:1,B:2,A:3};else if(f.R&&f.G&&f.B)s=!0,u.outputChannels=4,u.decodeChannels={R:0,G:1,B:2,A:3};else if(f.R&&f.G)u.outputChannels=2,u.decodeChannels={R:0,G:1};else if(f.R)u.outputChannels=1,u.decodeChannels={R:0};else if(f.Y)u.outputChannels=1,u.decodeChannels={Y:0};else throw Error("EXRLoader.parse: file contains unsupported data channels.");if(1===u.type)switch(o){case i.V.Float:u.getter=n.LD,u.inputSize=2;break;case i.V.HalfFloat:u.getter=n.Jn,u.inputSize=2}else if(2===u.type)switch(o){case i.V.Float:u.getter=n.Ff,u.inputSize=4;break;case i.V.HalfFloat:u.getter=n.Sn,u.inputSize=4}else throw Error("Unsupported pixelType "+u.type+" for "+e.compression);u.blockCount=u.height/u.scanlineBlockSize;for(let e=0;e<u.blockCount;e++)(0,n.tB)(t,r);let c=u.width*u.height*u.outputChannels;switch(o){case i.V.Float:u.byteArray=new Float32Array(c),u.textureType=1,s&&u.byteArray.fill(1,0,c);break;case i.V.HalfFloat:u.byteArray=new Uint16Array(c),u.textureType=2,s&&u.byteArray.fill(15360,0,c);break;default:throw Error("Unsupported type: "+o)}let h=0;for(let t of e.channels)void 0!==u.decodeChannels[t.name]&&(u.channelLineOffsets[t.name]=h*u.width),h+=2*t.pixelType;return u.bytesPerLine=u.width*h,u.outLineWidth=u.width*u.outputChannels,"INCREASING_Y"===e.lineOrder?u.scanOrder=e=>e:u.scanOrder=e=>u.height-1-e,4==u.outputChannels?(u.format=5,u.linearSpace=!0):(u.format=6,u.linearSpace=!1),u}function u(e,t,r,l){let i={value:0};for(let o=0;o<e.height/e.scanlineBlockSize;o++){let u=(0,n.cL)(r,l)-t.dataWindow.yMin;e.size=(0,n.PX)(r,l),e.lines=u+e.scanlineBlockSize>e.height?e.height-u:e.scanlineBlockSize;let f=e.size<e.lines*e.bytesPerLine&&e.uncompress?e.uncompress(e):(0,a.S4)(e);l.value+=e.size;for(let r=0;r<e.scanlineBlockSize;r++){let n=o*e.scanlineBlockSize,a=r+e.scanOrder(n);if(a>=e.height)continue;let l=r*e.bytesPerLine,u=(e.height-1-a)*e.outLineWidth;for(let r=0;r<e.channels;r++){let n=t.channels[r].name,a=e.channelLineOffsets[n],o=e.decodeChannels[n];if(void 0!==o){i.value=l+a;for(let t=0;t<e.width;t++){let r=u+t*e.outputChannels+o;e.byteArray&&(e.byteArray[r]=e.getter(f,i))}}}}}}},33324(e,t,r){r.d(t,{V:()=>l});var n=r(12479),a=r(40082);function l(e,t){if(0x1312f76!=e.getUint32(0,!0))throw Error("Incorrect OpenEXR format");let r=e.getUint8(4),l=e.getUint8(5);t.value=8;let i={},o=!0;for(;o;){let r=(0,a.T$)(e.buffer,t);if(r){let l=(0,a.T$)(e.buffer,t),o=(0,a.PX)(e,t),u=(0,a.zX)(e,t,l,o);void 0===u?n.V.Warn(`Unknown header attribute type ${l}'.`):i[r]=u}else o=!1}if((-5&l)!=0)throw Error("Unsupported file format");return{version:r,spec:{singleTile:!!(2&l),longName:!!(4&l),deepFormat:!!(8&l),multiPart:!!(16&l)},...i}}},73669(){},40216(e,t,r){r.d(t,{_ExrTextureLoader:()=>o,g:()=>u});var n=r(33324),a=r(20897),l=r(77739),i=r(12479);class o{constructor(){this.supportCascades=!1}loadCubeData(e,t,r,n,a){throw".exr not supported in Cube."}loadData(e,t,r){let o=new DataView(e.buffer),u={value:0},f=(0,n.V)(o,u);(0,a.d)(f,o,u,l.u.DefaultOutputType).then(e=>{(0,a.u)(e,f,o,u),r(f.dataWindow.xMax-f.dataWindow.xMin+1,f.dataWindow.yMax-f.dataWindow.yMin+1,t.generateMipMaps,!1,()=>{let r=t.getEngine();t.format=f.format,t.type=e.textureType,t.invertY=!1,t._gammaSpace=!f.linearSpace,e.byteArray&&r._uploadDataToTextureDirectly(t,e.byteArray,0,0,void 0,!0)})}).catch(e=>{i.V.Error("Failed to load EXR texture: ",e)})}}async function u(e){let t=new DataView(e),r={value:0},o=(0,n.V)(t,r);try{let e=await (0,a.d)(o,t,r,l.V.Float);if((0,a.u)(e,o,t,r),!e.byteArray)return i.V.Error("Failed to decode EXR data: No byte array available."),{width:0,height:0,data:null};return{width:o.dataWindow.xMax-o.dataWindow.xMin+1,height:o.dataWindow.yMax-o.dataWindow.yMin+1,data:new Float32Array(e.byteArray)}}catch(e){i.V.Error("Failed to load EXR data: ",e)}return{width:0,height:0,data:null}}}}]);