/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunk_cosmos_journeyer_game=globalThis.webpackChunk_cosmos_journeyer_game||[]).push([["295"],{85854:function(e,t,s){s.d(t,{t:()=>r});var n=s(91816),i=s(44386),o=s(31996);class r extends n.Ui{constructor(e,t,s){super(e,t,s),this._analyzer=null}get analyzer(){return this._analyzer??(this._analyzer=new o.sQ(this._subGraph))}get volume(){return(0,i.pN)(this._subGraph,"volume")}set volume(e){let t=(0,i.sf)(this._subGraph);if(!t)throw Error("No volume subnode");t.volume=e}dispose(){super.dispose(),this._analyzer?.dispose(),this._analyzer=null,this._subGraph.dispose()}setVolume(e,t=null){let s=(0,i.sf)(this._subGraph);if(!s)throw Error("No volume subnode");s.setVolume(e,t)}}},53894:function(e,t,s){s.d(t,{e:()=>i});var n=s(91816);class i extends n.Ui{constructor(e,t){super(e,t,3)}connect(e){if(!this._connect(e))throw Error("Connect failed")}disconnect(e){if(!this._disconnect(e))throw Error("Disconnect failed")}disconnectAll(){if(!this._downstreamNodes)throw Error("Disconnect failed");let e=this._downstreamNodes.values();for(let t=e.next();!t.done;t=e.next())if(!this._disconnect(t.value))throw Error("Disconnect failed")}}},49354:function(e,t,s){s.d(t,{CA:()=>r,Z7:()=>a,i_:()=>o});var n=s(77034),i=s(53894);class o extends i.e{constructor(e){super("Analyzer",e)}setOptions(e){this.fftSize=e.analyzerFFTSize??n.IR.fftSize,this.minDecibels=e.analyzerMinDecibels??n.IR.minDecibels,this.maxDecibels=e.analyzerMaxDecibels??n.IR.maxDecibels,this.smoothing=e.analyzerSmoothing??n.IR.smoothing}}function r(e){return e.getSubNode("Analyzer")}function a(e,t,s){e.callOnSubNode("Analyzer",e=>{e[t]=s})}},44386:function(e,t,s){s.d(t,{Sy:()=>o,pN:()=>a,sf:()=>r});var n=s(53894);let i={volume:1};class o extends n.e{constructor(e){super("Volume",e)}setOptions(e){this.volume=e.volume??i.volume}}function r(e){return e.getSubNode("Volume")}function a(e,t){return r(e)?.[t]??i[t]}},77034:function(e,t,s){s.d(t,{GA:()=>i,IR:()=>n,zx:()=>o});let n={fftSize:2048,minDecibels:-100,maxDecibels:-30,smoothing:.8};function i(e){return e.analyzerEnabled||void 0!==e.analyzerFFTSize||void 0!==e.analyzerMinDecibels||void 0!==e.analyzerMaxDecibels||void 0!==e.analyzerSmoothing}class o{get frequencyBinCount(){return this.fftSize/2}}},31996:function(e,t,s){s.d(t,{Hi:()=>l,hU:()=>u,sQ:()=>h});var n=s(283),i=s(77034),o=s(49354);let r=null,a=null;function u(){return r||(r=new Uint8Array),r}function l(){return a||(a=new Float32Array),a}class h extends i.zx{constructor(e){super(),this._fftSize=i.IR.fftSize,this._maxDecibels=i.IR.maxDecibels,this._minDecibels=i.IR.minDecibels,this._smoothing=i.IR.smoothing,this._subGraph=e}get fftSize(){return this._fftSize}set fftSize(e){this._fftSize=e,(0,o.Z7)(this._subGraph,"fftSize",e)}get isEnabled(){return null!==(0,o.CA)(this._subGraph)}get minDecibels(){return this._minDecibels}set minDecibels(e){this._minDecibels=e,(0,o.Z7)(this._subGraph,"minDecibels",e)}get maxDecibels(){return this._maxDecibels}set maxDecibels(e){this._maxDecibels=e,(0,o.Z7)(this._subGraph,"maxDecibels",e)}get smoothing(){return this._smoothing}set smoothing(e){this._smoothing=e,(0,o.Z7)(this._subGraph,"smoothing",e)}dispose(){let e=(0,o.CA)(this._subGraph);e&&(this._subGraph.removeSubNodeAsync(e),e.dispose())}async enableAsync(){(0,o.CA)(this._subGraph)||await this._subGraph.createAndAddSubNodeAsync("Analyzer")}getByteFrequencyData(){let e=(0,o.CA)(this._subGraph);return e?e.getByteFrequencyData():(n.V.Warn("AudioAnalyzer not enabled"),this.enableAsync(),u())}getFloatFrequencyData(){let e=(0,o.CA)(this._subGraph);return e?e.getFloatFrequencyData():(n.V.Warn("AudioAnalyzer not enabled"),this.enableAsync(),l())}}},5727:function(e,t,s){s.d(t,{H:()=>_});class n{constructor(){this._createSubNodePromises={},this._isDisposed=!1,this._subNodes={},this._onSubNodeDisposed=e=>{delete this._subNodes[e.name],this._onSubNodesChanged()}}callOnSubNode(e,t){let s=this.getSubNode(e);s?t(s):this._createSubNodePromisesResolvedAsync().then(()=>{let s=this.getSubNode(e);s?t(s):this.createAndAddSubNodeAsync(e).then(e=>{t(e)})})}createAndAddSubNodeAsync(e){var t;return(t=this._createSubNodePromises)[e]||(t[e]=this._createSubNode(e).then(e=>(this._addSubNode(e),e))),this._createSubNodePromises[e]}dispose(){for(let e of(this._isDisposed=!0,Object.values(this._subNodes)))e.dispose();this._subNodes={},this._createSubNodePromises={}}getSubNode(e){return this._subNodes[e]??null}async removeSubNodeAsync(e){await this._createSubNodePromisesResolvedAsync();let t=e.name;this._subNodes[t]&&delete this._subNodes[t],delete this._createSubNodePromises[t],this._onSubNodesChanged()}async _createSubNodePromisesResolvedAsync(){return await Promise.all(Object.values(this._createSubNodePromises))}_addSubNode(e){this._isDisposed?e.dispose():(this._subNodes[e.name]=e,e.onDisposeObservable.addOnce(this._onSubNodeDisposed),this._onSubNodesChanged())}}var i=s(49354),o=s(44386),r=s(77034),a=s(49431);async function u(e){return new l(e)}class l extends o.Sy{constructor(e){super(e);const t=this.node=new GainNode(e._audioContext);this._volume=new a.k(e,t.gain)}dispose(){super.dispose(),this._volume.dispose()}get volume(){return this._volume.value}set volume(e){this.setVolume(e)}get _inNode(){return this.node}get _outNode(){return this.node}setVolume(e,t=null){this._volume.setTargetValue(e,t)}_connect(e){return!!super._connect(e)&&(e._inNode&&this.node.connect(e._inNode),!0)}_disconnect(e){return!!super._disconnect(e)&&(e._inNode&&this.node.disconnect(e._inNode),!0)}getClassName(){return"_VolumeWebAudioSubNode"}}var h=s(31996);async function d(e){return new c(e)}class c extends i.i_{constructor(e){super(e),this._byteFrequencyData=null,this._floatFrequencyData=null,this._analyzerNode=new AnalyserNode(e._audioContext)}get fftSize(){return this._analyzerNode.fftSize}set fftSize(e){e!==this._analyzerNode.fftSize&&(this._analyzerNode.fftSize=e,this._clearArrays())}get _inNode(){return this._analyzerNode}get minDecibels(){return this._analyzerNode.minDecibels}set minDecibels(e){this._analyzerNode.minDecibels=e}get maxDecibels(){return this._analyzerNode.maxDecibels}set maxDecibels(e){this._analyzerNode.maxDecibels=e}get smoothing(){return this._analyzerNode.smoothingTimeConstant}set smoothing(e){this._analyzerNode.smoothingTimeConstant=e}dispose(){super.dispose(),this._clearArrays(),this._byteFrequencyData=null,this._floatFrequencyData=null,this._analyzerNode.disconnect()}getClassName(){return"_WebAudioAnalyzerSubNode"}getByteFrequencyData(){return this._byteFrequencyData&&0!==this._byteFrequencyData.length||(this._byteFrequencyData=new Uint8Array(this._analyzerNode.frequencyBinCount)),this._analyzerNode.getByteFrequencyData(this._byteFrequencyData),this._byteFrequencyData}getFloatFrequencyData(){return this._floatFrequencyData&&0!==this._floatFrequencyData.length||(this._floatFrequencyData=new Float32Array(this._analyzerNode.frequencyBinCount)),this._analyzerNode.getFloatFrequencyData(this._floatFrequencyData),this._floatFrequencyData}_clearArrays(){this._byteFrequencyData?.set((0,h.hU)()),this._floatFrequencyData?.set((0,h.Hi)())}}class _ extends n{constructor(e){super(),this._outputNode=null,this._owner=e}async initAsync(e){let t=(0,r.GA)(e);if(t&&await this.createAndAddSubNodeAsync("Analyzer"),await this.createAndAddSubNodeAsync("Volume"),await this._createSubNodePromisesResolvedAsync(),t){let t=(0,i.CA)(this);if(!t)throw Error("No analyzer subnode.");t.setOptions(e)}let s=(0,o.sf)(this);if(!s)throw Error("No volume subnode.");if(s.setOptions(e),"_VolumeWebAudioSubNode"!==s.getClassName())throw Error("Not a WebAudio subnode.");if(this._outputNode=s.node,this._outputNode&&this._downstreamNodes){let e=this._downstreamNodes.values();for(let t=e.next();!t.done;t=e.next()){let e=t.value._inNode;e&&this._outputNode.connect(e)}}}get _inNode(){return this._outputNode}get _outNode(){return this._outputNode}_createSubNode(e){switch(e){case"Analyzer":return d(this._owner.engine);case"Volume":return u(this._owner.engine);default:throw Error(`Unknown subnode name: ${e}`)}}_onSubNodesChanged(){let e=(0,i.CA)(this),t=(0,o.sf)(this);e&&t&&t.connect(e)}}}}]);