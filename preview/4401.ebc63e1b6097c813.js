/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunk_cosmos_journeyer_game=globalThis.webpackChunk_cosmos_journeyer_game||[]).push([["4401"],{89245:function(t,e,n){n.d(e,{Au:()=>a,Pt:()=>u,y5:()=>r});var o=n(4205),i=n(73925),s=n(66579);class a extends s.e{constructor(t){super("Spatial",t),this._attacherComponent=null}get isAttached(){return null!==this._attacherComponent&&this._attacherComponent.isAttached}attach(t,e,n){this.detach(),this._attacherComponent||(this._attacherComponent=new o.l(this)),this._attacherComponent.attach(t,e,n)}detach(){this._attacherComponent?.detach()}dispose(){super.dispose(),this._attacherComponent?.dispose(),this._attacherComponent=null}setOptions(t){this.coneInnerAngle=t.spatialConeInnerAngle??i.Qc.coneInnerAngle,this.coneOuterAngle=t.spatialConeOuterAngle??i.Qc.coneOuterAngle,this.coneOuterVolume=t.spatialConeOuterVolume??i.Qc.coneOuterVolume,this.distanceModel=t.spatialDistanceModel??i.Qc.distanceModel,this.maxDistance=t.spatialMaxDistance??i.Qc.maxDistance,this.minDistance=t.spatialMinDistance??i.Qc.minDistance,this.panningModel=t.spatialPanningModel??i.Qc.panningModel,this.rolloffFactor=t.spatialRolloffFactor??i.Qc.rolloffFactor,t.spatialPosition&&(this.position=t.spatialPosition.clone()),t.spatialRotationQuaternion?this.rotationQuaternion=t.spatialRotationQuaternion.clone():t.spatialRotation?this.rotation=t.spatialRotation.clone():this.rotationQuaternion=i.Qc.rotationQuaternion.clone(),this.update()}update(){this.isAttached?this._attacherComponent?.update():(this._updatePosition(),this._updateRotation())}}function r(t){return t.getSubNode("Spatial")}function u(t,e,n){t.callOnSubNode("Spatial",t=>{t[e]=n})}},29501:function(t,e,n){n.d(e,{KJ:()=>a,a7:()=>s,n9:()=>r});var o=n(66579),i=n(68129);class s extends o.e{constructor(t){super("Stereo",t)}setOptions(t){this.pan=t.stereoPan??i.uJ.pan}}function a(t){return t.getSubNode("Stereo")}function r(t,e,n){t.callOnSubNode("Stereo",t=>{t[e]=n})}},73925:function(t,e,n){n.d(e,{GB:()=>s,Qc:()=>i,lA:()=>a});var o=n(66144);let i={coneInnerAngle:6.28318530718,coneOuterAngle:6.28318530718,coneOuterVolume:0,distanceModel:"linear",maxDistance:1e4,minDistance:1,panningModel:"equalpower",position:o.Pq.Zero(),rolloffFactor:1,rotation:o.Pq.Zero(),rotationQuaternion:new o.PT};function s(t){return t.spatialEnabled||void 0!==t.spatialAutoUpdate||void 0!==t.spatialConeInnerAngle||void 0!==t.spatialConeOuterAngle||void 0!==t.spatialConeOuterVolume||void 0!==t.spatialDistanceModel||void 0!==t.spatialMaxDistance||void 0!==t.spatialMinDistance||void 0!==t.spatialMinUpdateTime||void 0!==t.spatialPanningModel||void 0!==t.spatialPosition||void 0!==t.spatialRolloffFactor||void 0!==t.spatialRotation||void 0!==t.spatialRotationQuaternion}class a{}},68129:function(t,e,n){n.d(e,{bO:()=>s,uD:()=>i,uJ:()=>o});let o={pan:0};function i(t){return t.stereoEnabled||void 0!==t.stereoPan}class s{}},87931:function(t,e,n){n.d(e,{i:()=>s});var o=n(68129),i=n(29501);class s extends o.bO{constructor(t){super(),this._pan=o.uJ.pan,this._subGraph=t}get pan(){return this._pan}set pan(t){this._pan=t,(0,i.n9)(this._subGraph,"pan",t)}}},75050:function(t,e,n){n.d(e,{Q:()=>Q});var o=n(89245),i=n(29501),s=n(38439),a=n(73925),r=n(68129),u=n(66144),c=n(52720);let h=u.uq.Zero(),l=new u.PT,d=u.Pq.Zero();function p(t){return t*Math.PI/180}function _(t){return 180*t/Math.PI}async function g(t){return new m(t)}class m extends o.Au{constructor(t){super(t),this._lastPosition=u.Pq.Zero(),this._lastRotation=u.Pq.Zero(),this._lastRotationQuaternion=new u.PT,this.position=a.Qc.position.clone(),this.rotation=a.Qc.rotation.clone(),this.rotationQuaternion=a.Qc.rotationQuaternion.clone(),this.node=new PannerNode(t._audioContext),this._orientationX=new c.k(t,this.node.orientationX),this._orientationY=new c.k(t,this.node.orientationY),this._orientationZ=new c.k(t,this.node.orientationZ),this._positionX=new c.k(t,this.node.positionX),this._positionY=new c.k(t,this.node.positionY),this._positionZ=new c.k(t,this.node.positionZ)}dispose(){super.dispose(),this._orientationX.dispose(),this._orientationY.dispose(),this._orientationZ.dispose(),this._positionX.dispose(),this._positionY.dispose(),this._positionZ.dispose(),this.node.disconnect()}get coneInnerAngle(){return p(this.node.coneInnerAngle)}set coneInnerAngle(t){this.node.coneInnerAngle=_(t)}get coneOuterAngle(){return p(this.node.coneOuterAngle)}set coneOuterAngle(t){this.node.coneOuterAngle=_(t)}get coneOuterVolume(){return this.node.coneOuterGain}set coneOuterVolume(t){this.node.coneOuterGain=t}get distanceModel(){return this.node.distanceModel}set distanceModel(t){this.node.distanceModel=t;let e=this.node.maxDistance;this.node.maxDistance=e+.001,this.node.maxDistance=e}get minDistance(){return this.node.refDistance}set minDistance(t){this.node.refDistance=t}get maxDistance(){return this.node.maxDistance}set maxDistance(t){this.node.maxDistance=t}get panningModel(){return this.node.panningModel}set panningModel(t){this.node.panningModel=t}get rolloffFactor(){return this.node.rolloffFactor}set rolloffFactor(t){this.node.rolloffFactor=t}get _inNode(){return this.node}get _outNode(){return this.node}_updatePosition(){this._lastPosition.equalsWithEpsilon(this.position)||this.isAttached&&(this._positionX.isRamping||this._positionY.isRamping||this._positionZ.isRamping)||(this._positionX.targetValue=this.position.x,this._positionY.targetValue=this.position.y,this._positionZ.targetValue=this.position.z,this._lastPosition.copyFrom(this.position))}_updateRotation(){if(!this.isAttached||!this._orientationX.isRamping&&!this._orientationY.isRamping&&!this._orientationZ.isRamping){if(this._lastRotationQuaternion.equalsWithEpsilon(this.rotationQuaternion))if(this._lastRotation.equalsWithEpsilon(this.rotation))return;else u.PT.FromEulerAnglesToRef(this.rotation.x,this.rotation.y,this.rotation.z,l),this._lastRotation.copyFrom(this.rotation);else l.copyFrom(this.rotationQuaternion),this._lastRotationQuaternion.copyFrom(this.rotationQuaternion);u.uq.FromQuaternionToRef(l,h),u.Pq.TransformNormalToRef(u.Pq.RightReadOnly,h,d),this._orientationX.targetValue=d.x,this._orientationY.targetValue=d.y,this._orientationZ.targetValue=d.z}}_connect(t){return!!super._connect(t)&&(t._inNode&&this.node.connect(t._inNode),!0)}_disconnect(t){return!!super._disconnect(t)&&(t._inNode&&this.node.disconnect(t._inNode),!0)}getClassName(){return"_SpatialWebAudioSubNode"}}async function f(t){return new A(t)}class A extends i.a7{constructor(t){super(t),this.node=new StereoPannerNode(t._audioContext),this._pan=new c.k(t,this.node.pan)}dispose(){super.dispose(),this._pan.dispose()}get pan(){return this._pan.targetValue}set pan(t){this._pan.targetValue=t}get _inNode(){return this.node}get _outNode(){return this.node}getClassName(){return"_StereoWebAudioSubNode"}_connect(t){return!!super._connect(t)&&(t._inNode&&this.node.connect(t._inNode),!0)}_disconnect(t){return!!super._disconnect(t)&&(t._inNode&&this.node.disconnect(t._inNode),!0)}}var N=n(46737);class Q extends N.H{constructor(){super(...arguments),this._rootNode=null,this._inputNode=null}async initAsync(t){await super.initAsync(t);let e=!1,n=!1;(e=(0,a.GB)(t))&&await this.createAndAddSubNodeAsync("Spatial"),(n=(0,r.uD)(t))&&await this.createAndAddSubNodeAsync("Stereo"),await this._createSubNodePromisesResolvedAsync(),e&&(0,o.y5)(this)?.setOptions(t),n&&(0,i.KJ)(this)?.setOptions(t)}get _inNode(){return this._inputNode}_createSubNode(t){try{return super._createSubNode(t)}catch(t){}switch(t){case"Spatial":return g(this._owner.engine);case"Stereo":return f(this._owner.engine);default:throw Error(`Unknown subnode name: ${t}`)}}_onSubNodesChanged(){super._onSubNodesChanged();let t=(0,o.y5)(this),e=(0,i.KJ)(this),n=(0,s.sf)(this);if(t&&"_SpatialWebAudioSubNode"!==t.getClassName()||e&&"_StereoWebAudioSubNode"!==e.getClassName()||n&&"_VolumeWebAudioSubNode"!==n.getClassName())throw Error("Not a WebAudio subnode.");t&&(t.disconnectAll(),n&&t.connect(n)),e&&(e.disconnectAll(),n&&e.connect(n)),t&&e?(this._rootNode=new GainNode(this._owner.engine._audioContext),this._rootNode.connect(t._outNode),this._rootNode.connect(e._outNode)):(this._rootNode?.disconnect(),this._rootNode=null);let a=null,r=null;if(this._rootNode?r=this._rootNode:(t?a=t:e?a=e:n&&(a=n),r=a?.node??null),this._inputNode!==r){if(this._inputNode&&this._upstreamNodes){let t=this._upstreamNodes.values();for(let e=t.next();!e.done;e=t.next())e.value._outNode?.disconnect(this._inputNode)}if(this._inputNode=r,r&&this._upstreamNodes){let t=this._upstreamNodes.values();for(let e=t.next();!e.done;e=t.next())e.value._outNode?.connect(r)}}}}},97607:function(t,e,n){n.d(e,{i:()=>r});var o=n(89245),i=n(73925);class s extends i.lA{constructor(t){super(),this._coneInnerAngle=i.Qc.coneInnerAngle,this._coneOuterAngle=i.Qc.coneOuterAngle,this._coneOuterVolume=i.Qc.coneOuterVolume,this._distanceModel=i.Qc.distanceModel,this._maxDistance=i.Qc.maxDistance,this._minDistance=i.Qc.minDistance,this._panningModel=i.Qc.panningModel,this._rolloffFactor=i.Qc.rolloffFactor;const e=(0,o.y5)(t);e?(this._position=e.position.clone(),this._rotation=e.rotation.clone(),this._rotationQuaternion=e.rotationQuaternion.clone()):(this._position=i.Qc.position.clone(),this._rotation=i.Qc.rotation.clone(),this._rotationQuaternion=i.Qc.rotationQuaternion.clone(),t.createAndAddSubNodeAsync("Spatial")),this._subGraph=t}get coneInnerAngle(){return this._coneInnerAngle}set coneInnerAngle(t){this._coneInnerAngle=t,(0,o.Pt)(this._subGraph,"coneInnerAngle",t)}get coneOuterAngle(){return this._coneOuterAngle}set coneOuterAngle(t){this._coneOuterAngle=t,(0,o.Pt)(this._subGraph,"coneOuterAngle",t)}get coneOuterVolume(){return this._coneOuterVolume}set coneOuterVolume(t){this._coneOuterVolume=t,(0,o.Pt)(this._subGraph,"coneOuterVolume",t)}get distanceModel(){return this._distanceModel}set distanceModel(t){this._distanceModel=t,(0,o.Pt)(this._subGraph,"distanceModel",t)}get isAttached(){return this._subGraph.getSubNode("Spatial")?.isAttached??!1}get maxDistance(){return this._maxDistance}set maxDistance(t){t<=0&&(t=1e-6),this._maxDistance=t,(0,o.Pt)(this._subGraph,"maxDistance",t)}get minDistance(){return this._minDistance}set minDistance(t){this._minDistance=t,(0,o.Pt)(this._subGraph,"minDistance",t)}get panningModel(){return this._panningModel}set panningModel(t){this._panningModel=t,(0,o.Pt)(this._subGraph,"panningModel",t)}get position(){return this._position}set position(t){this._position=t,this._updatePosition()}get rolloffFactor(){return this._rolloffFactor}set rolloffFactor(t){this._rolloffFactor=t,(0,o.Pt)(this._subGraph,"rolloffFactor",t)}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._updateRotation()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(t){this._rotationQuaternion=t,this._updateRotation()}attach(t,e=!1,n=3){(0,o.y5)(this._subGraph)?.attach(t,e,n)}detach(){(0,o.y5)(this._subGraph)?.detach()}update(){let t=(0,o.y5)(this._subGraph);t&&(t.isAttached?t.update():(this._updatePosition(t),this._updateRotation(t)))}_updatePosition(t=null){(t||(t=(0,o.y5)(this._subGraph)))&&(t.position.equalsWithEpsilon(this._position)||(t.position.copyFrom(this._position),t._updatePosition()))}_updateRotation(t=null){(t||(t=(0,o.y5)(this._subGraph)))&&(t.rotationQuaternion.equalsWithEpsilon(this._rotationQuaternion)?t.rotation.equalsWithEpsilon(this._rotation)||(t.rotation.copyFrom(this._rotation),t._updateRotation()):(t.rotationQuaternion.copyFrom(this._rotationQuaternion),t._updateRotation()))}}var a=n(64244);class r extends s{constructor(t,e,n){super(t),this._updaterComponent=new a.w(this,e,n)}get minUpdateTime(){return this._updaterComponent.minUpdateTime}set minUpdateTime(t){this._updaterComponent.minUpdateTime=t}dispose(){this._updaterComponent.dispose(),this._updaterComponent=null}}}}]);