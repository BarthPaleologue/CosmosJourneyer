/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunk_cosmos_journeyer_game=globalThis.webpackChunk_cosmos_journeyer_game||[]).push([["3603"],{56869:function(e,r,t){t.d(r,{DDSTools:()=>y});var a=t(50912),l=t(49478),f=t(99170),o=t(83620);function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}t(84548);let s=n("DXT1"),u=n("DXT3"),i=n("DXT5"),A=n("DX10");class y{static GetDDSInfo(e){let r=new Int32Array(e.buffer,e.byteOffset,31),t=new Int32Array(e.buffer,e.byteOffset,35),a=1;131072&r[2]&&(a=Math.max(1,r[7]));let l=r[21],f=l===A?t[32]:0,o=0;switch(l){case 113:o=2;break;case 116:o=1;break;case A:if(10===f){o=2;break}2===f&&(o=1)}return{width:r[4],height:r[3],mipmapCount:a,isFourCC:(4&r[20])==4,isRGB:(64&r[20])==64,isLuminance:(131072&r[20])==131072,isCube:(512&r[28])==512,isCompressed:l===s||l===u||l===i,dxgiFormat:f,textureType:o}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,r,t,a,l,f){let n=new Float32Array(a),s=new Uint16Array(l,t),u=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=(r+t*e)*4;n[u]=(0,o.SX)(s[a]),n[u+1]=(0,o.SX)(s[a+1]),n[u+2]=(0,o.SX)(s[a+2]),y.StoreLODInAlphaChannel?n[u+3]=f:n[u+3]=(0,o.SX)(s[a+3]),u+=4}return n}static _GetHalfFloatRGBAArrayBuffer(e,r,t,a,l,f){if(y.StoreLODInAlphaChannel){let n=new Uint16Array(a),s=new Uint16Array(l,t),u=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=(r+t*e)*4;n[u]=s[a],n[u+1]=s[a+1],n[u+2]=s[a+2],n[u+3]=(0,o.LZ)(f),u+=4}return n}return new Uint16Array(l,t,a)}static _GetFloatRGBAArrayBuffer(e,r,t,a,l,f){if(y.StoreLODInAlphaChannel){let o=new Float32Array(a),n=new Float32Array(l,t),s=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=(r+t*e)*4;o[s]=n[a],o[s+1]=n[a+1],o[s+2]=n[a+2],o[s+3]=f,s+=4}return o}return new Float32Array(l,t,a)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,r,t,a,l,f){let n=new Uint16Array(a),s=new Float32Array(l,t),u=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++)n[u]=(0,o.LZ)(s[u]),n[u+1]=(0,o.LZ)(s[u+1]),n[u+2]=(0,o.LZ)(s[u+2]),y.StoreLODInAlphaChannel?n[u+3]=(0,o.LZ)(f):n[u+3]=(0,o.LZ)(s[u+3]),u+=4;return n}static _GetFloatAsUIntRGBAArrayBuffer(e,r,t,l,f,o){let n=new Uint8Array(l),s=new Float32Array(f,t),u=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let l=(r+t*e)*4;n[u]=255*(0,a.Clamp)(s[l]),n[u+1]=255*(0,a.Clamp)(s[l+1]),n[u+2]=255*(0,a.Clamp)(s[l+2]),y.StoreLODInAlphaChannel?n[u+3]=o:n[u+3]=255*(0,a.Clamp)(s[l+3]),u+=4}return n}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,r,t,l,f,n){let s=new Uint8Array(l),u=new Uint16Array(f,t),i=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let l=(r+t*e)*4;s[i]=255*(0,a.Clamp)((0,o.SX)(u[l])),s[i+1]=255*(0,a.Clamp)((0,o.SX)(u[l+1])),s[i+2]=255*(0,a.Clamp)((0,o.SX)(u[l+2])),y.StoreLODInAlphaChannel?s[i+3]=n:s[i+3]=255*(0,a.Clamp)((0,o.SX)(u[l+3])),i+=4}return s}static _GetRGBAArrayBuffer(e,r,t,a,l,f,o,n,s){let u=new Uint8Array(a),i=new Uint8Array(l,t),A=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=(r+t*e)*4;u[A]=i[a+f],u[A+1]=i[a+o],u[A+2]=i[a+n],u[A+3]=i[a+s],A+=4}return u}static _ExtractLongWordOrder(e){return 0===e||255===e||-0x1000000===e?0:1+y._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,r,t,a,l,f,o,n){let s=new Uint8Array(a),u=new Uint8Array(l,t),i=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=(r+t*e)*3;s[i]=u[a+f],s[i+1]=u[a+o],s[i+2]=u[a+n],i+=3}return s}static _GetLuminanceArrayBuffer(e,r,t,a,l){let f=new Uint8Array(a),o=new Uint8Array(l,t),n=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=r+t*e;f[n]=o[a],n++}return f}static UploadDDSLevels(e,r,t,a,o,n,c=-1,p,B=!0){let G,b,d,m=null;a.sphericalPolynomial&&(m=[]);let F=!!e.getCaps().s3tc;r.generateMipMaps=o;let h=new Int32Array(t.buffer,t.byteOffset,31),C,_,w,x=0,R,L=0,O=1;if(0x20534444!==h[0])return void l.V.Error("Invalid magic number in DDS header");if(!a.isFourCC&&!a.isRGB&&!a.isLuminance)return void l.V.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(a.isCompressed&&!F)return void l.V.Error("Compressed textures are not supported on this platform.");let D=h[22];R=h[1]+4;let g=!1;if(a.isFourCC)switch(C=h[21]){case s:O=8,L=33777;break;case u:O=16,L=33778;break;case i:O=16,L=33779;break;case 113:g=!0,D=64;break;case 116:g=!0,D=128;break;case A:{R+=20;let e=!1;switch(a.dxgiFormat){case 10:g=!0,D=64,e=!0;break;case 2:g=!0,D=128,e=!0;break;case 88:a.isRGB=!0,a.isFourCC=!1,D=32,e=!0}if(e)break}default:l.V.Error(["Unsupported FourCC code:",String.fromCharCode(255&C,C>>8&255,C>>16&255,C>>24&255)]);return}let U=y._ExtractLongWordOrder(h[23]),S=y._ExtractLongWordOrder(h[24]),k=y._ExtractLongWordOrder(h[25]),I=y._ExtractLongWordOrder(h[26]);g&&(L=e._getRGBABufferInternalSizedFormat(a.textureType)),b=1,131072&h[2]&&!1!==o&&(b=Math.max(1,h[7]));let T=p||0,H=e.getCaps();for(let l=T;l<n;l++){for(d=0,_=h[4],w=h[3];d<b;++d){if(-1===c||c===d){let f=-1===c?d:0;if(!a.isCompressed&&a.isFourCC){r.format=5,x=_*w*4;let a=null;if(e._badOS||e._badDesktopOS||!H.textureHalfFloat&&!H.textureFloat)128===D?(a=y._GetFloatAsUIntRGBAArrayBuffer(_,w,t.byteOffset+R,x,t.buffer,f),m&&0==f&&m.push(y._GetFloatRGBAArrayBuffer(_,w,t.byteOffset+R,x,t.buffer,f))):64===D&&(a=y._GetHalfFloatAsUIntRGBAArrayBuffer(_,w,t.byteOffset+R,x,t.buffer,f),m&&0==f&&m.push(y._GetHalfFloatAsFloatRGBAArrayBuffer(_,w,t.byteOffset+R,x,t.buffer,f))),r.type=0;else{let e,l=H.textureFloat&&(B&&H.textureFloatLinearFiltering||!B),o=H.textureHalfFloat&&(B&&H.textureHalfFloatLinearFiltering||!B),n=(128===D||64===D&&!o)&&l?1:(64===D||128===D&&!l)&&o?2:0,s=null;if(128===D)switch(n){case 1:e=y._GetFloatRGBAArrayBuffer,s=null;break;case 2:e=y._GetFloatAsHalfFloatRGBAArrayBuffer,s=y._GetFloatRGBAArrayBuffer;break;case 0:e=y._GetFloatAsUIntRGBAArrayBuffer,s=y._GetFloatRGBAArrayBuffer}else switch(n){case 1:e=y._GetHalfFloatAsFloatRGBAArrayBuffer,s=null;break;case 2:e=y._GetHalfFloatRGBAArrayBuffer,s=y._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:e=y._GetHalfFloatAsUIntRGBAArrayBuffer,s=y._GetHalfFloatAsFloatRGBAArrayBuffer}r.type=n,a=e(_,w,t.byteOffset+R,x,t.buffer,f),m&&0==f&&m.push(s?s(_,w,t.byteOffset+R,x,t.buffer,f):a)}a&&e._uploadDataToTextureDirectly(r,a,l,f)}else if(a.isRGB)r.type=0,24===D?(r.format=4,x=_*w*3,G=y._GetRGBArrayBuffer(_,w,t.byteOffset+R,x,t.buffer,U,S,k)):(r.format=5,x=_*w*4,G=y._GetRGBAArrayBuffer(_,w,t.byteOffset+R,x,t.buffer,U,S,k,I)),e._uploadDataToTextureDirectly(r,G,l,f);else if(a.isLuminance){let a=e._getUnpackAlignement(),o=_;x=Math.floor((_+a-1)/a)*a*(w-1)+o,G=y._GetLuminanceArrayBuffer(_,w,t.byteOffset+R,x,t.buffer),r.format=1,r.type=0,e._uploadDataToTextureDirectly(r,G,l,f)}else x=Math.max(4,_)/4*Math.max(4,w)/4*O,G=new Uint8Array(t.buffer,t.byteOffset+R,x),r.type=0,e._uploadCompressedDataToTextureDirectly(r,L,_,w,G,l,f)}R+=D?_*w*(D/8):x,_*=.5,w*=.5,_=Math.max(1,_),w=Math.max(1,w)}if(void 0!==p)break}m&&m.length>0?a.sphericalPolynomial=f.d.ConvertCubeMapToSphericalPolynomial({size:h[4],right:m[0],left:m[1],up:m[2],down:m[3],front:m[4],back:m[5],format:5,type:1,gammaSpace:!1}):a.sphericalPolynomial=void 0}}y.StoreLODInAlphaChannel=!1},13586:function(e,r,t){t.d(r,{r:()=>a});function a(e){let r=e.split("?")[0],t=r.lastIndexOf(".");return t>-1?r.substring(t).toLowerCase():""}}}]);