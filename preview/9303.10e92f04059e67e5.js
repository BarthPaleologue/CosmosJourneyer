/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunk_cosmos_journeyer_game=globalThis.webpackChunk_cosmos_journeyer_game||[]).push([["9303"],{27262(e,i,t){t.d(i,{d:()=>s});class s{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}},42519(e,i,t){t.d(i,{e:()=>P});var s=t(80260),n=t(12903),r=t(12827),o=t(93287),a=t(88078),l=t(58566),h=t(35813),c=t(97548),p=t(46575),d=t(39409);class u{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(e){this._singleClick=e}set doubleClick(e){this._doubleClick=e}set hasSwiped(e){this._hasSwiped=e}set ignore(e){this._ignore=e}}class P{constructor(e){if(this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=[],this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new o.I9(0,0),this._previousStartingPointerPosition=new o.I9(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=e||p.q.LastCreatedScene,!this._scene)return}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(e){return this._meshUnderPointerId[e]||null}get unTranslatedPointer(){return new o.I9(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(e){this._pointerX=e}get pointerY(){return this._pointerY}set pointerY(e){this._pointerY=e}_updatePointerPosition(e){let i=this._scene.getEngine().getInputElementClientRect();i&&(this._pointerX=e.clientX-i.left,this._pointerY=e.clientY-i.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(e,i){let t,n=this._scene,r=n.getEngine(),o=r.getInputElement();for(let t of(o&&(o.tabIndex=r.canvasTabIndex,n.doNotHandleCursors||(o.style.cursor=n.defaultCursor)),this._setCursorAndPointerOverMesh(e,i,n),n._pointerMoveStage)){e=e||this._pickMove(i);let s=!!e?.pickedMesh;e=t.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,s,o)}let a=i.inputIndex>=h.ST.MouseWheelX&&i.inputIndex<=h.ST.MouseWheelZ?s.Zp.POINTERWHEEL:s.Zp.POINTERMOVE;n.onPointerMove&&(e=e||this._pickMove(i),n.onPointerMove(i,e,a)),e?(t=new s.mx(a,i,e),this._setRayOnPointerInfo(e,i)):(t=new s.mx(a,i,null,this),this._movePointerInfo=t),n.onPointerObservable.hasObservers()&&n.onPointerObservable.notifyObservers(t,a)}_setRayOnPointerInfo(e,i){let t=this._scene;e&&d.h._IsPickingAvailable&&!e.ray&&(e.ray=t.createPickingRay(i.offsetX,i.offsetY,o.uq.Identity(),t.activeCamera))}_addCameraPointerObserver(e,i){return this._cameraObserverCount++,this._scene.onPointerObservable.add(e,i)}_removeCameraPointerObserver(e){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(e)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(e,i,t){let n=this._scene,r=new s.tT(t,i,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(r.originalPickingInfo=e,r.ray=e.ray,"xr-near"===i.pointerType&&e.originMesh&&(r.nearInteractionPickingInfo=e)),n.onPrePointerObservable.notifyObservers(r,t),!!r.skipOnPointerObservable}_pickMove(e){let i=this._scene,t=i.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,i.pointerMovePredicate,i.pointerMoveFastCheck,i.cameraToUseForPointers,i.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(t,e,i),t}_setCursorAndPointerOverMesh(e,i,t){let s=t.getEngine().getInputElement();if(e?.pickedMesh){if(this.setPointerOverMesh(e.pickedMesh,i.pointerId,e,i),!t.doNotHandleCursors&&s&&this._pointerOverMesh){let e=this._pointerOverMesh._getActionManagerForTrigger();e&&e.hasPointerTriggers&&(s.style.cursor=e.hoverCursor||t.hoverCursor)}}else this.setPointerOverMesh(null,i.pointerId,e,i)}simulatePointerMove(e,i){let t=new PointerEvent("pointermove",i);t.inputIndex=h.ST.Move,this._checkPrePointerObservable(e,t,s.Zp.POINTERMOVE)||this._processPointerMove(e,t)}simulatePointerDown(e,i){let t=new PointerEvent("pointerdown",i);t.inputIndex=t.button+2,this._checkPrePointerObservable(e,t,s.Zp.POINTERDOWN)||this._processPointerDown(e,t)}_processPointerDown(e,i){let t,n=this._scene;if(e?.pickedMesh){this._pickedDownMesh=e.pickedMesh;let t=e.pickedMesh._getActionManagerForTrigger();if(t){if(t.hasPickTriggers)switch(t.processTrigger(5,new a.X(e.pickedMesh,n.pointerX,n.pointerY,e.pickedMesh,i,e)),i.button){case 0:t.processTrigger(2,new a.X(e.pickedMesh,n.pointerX,n.pointerY,e.pickedMesh,i,e));break;case 1:t.processTrigger(4,new a.X(e.pickedMesh,n.pointerX,n.pointerY,e.pickedMesh,i,e));break;case 2:t.processTrigger(3,new a.X(e.pickedMesh,n.pointerX,n.pointerY,e.pickedMesh,i,e))}t.hasSpecificTrigger(8)&&window.setTimeout(()=>{let e=n.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,e=>e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===this._pickedDownMesh,!1,n.cameraToUseForPointers);e?.pickedMesh&&t&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>P.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,t.processTrigger(8,a.X.CreateNew(e.pickedMesh,i)))},P.LongPressDelay)}}else for(let t of n._pointerDownStage)e=t.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,i,!1);let r=s.Zp.POINTERDOWN;e?(n.onPointerDown&&n.onPointerDown(i,e,r),t=new s.mx(r,i,e),this._setRayOnPointerInfo(e,i)):t=new s.mx(r,i,null,this),n.onPointerObservable.hasObservers()&&n.onPointerObservable.notifyObservers(t,r)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(e,i,t){let n=new PointerEvent("pointerup",i);n.inputIndex=h.ST.Move;let r=new u;t?r.doubleClick=!0:r.singleClick=!0,this._checkPrePointerObservable(e,n,s.Zp.POINTERUP)||this._processPointerUp(e,n,r)}_processPointerUp(e,i,t){let n=this._scene;if(e?.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(n.onPointerPick&&n.onPointerPick(i,e),t.singleClick&&!t.ignore&&n.onPointerObservable.observers.length>this._cameraObserverCount)){let t=s.Zp.POINTERPICK,r=new s.mx(t,i,e);this._setRayOnPointerInfo(e,i),n.onPointerObservable.notifyObservers(r,t)}let r=e.pickedMesh._getActionManagerForTrigger();if(r&&!t.ignore){r.processTrigger(7,a.X.CreateNew(e.pickedMesh,i,e)),!t.hasSwiped&&t.singleClick&&r.processTrigger(1,a.X.CreateNew(e.pickedMesh,i,e));let s=e.pickedMesh._getActionManagerForTrigger(6);t.doubleClick&&s&&s.processTrigger(6,a.X.CreateNew(e.pickedMesh,i,e))}}else if(!t.ignore)for(let s of n._pointerUpStage)e=s.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,i,t.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){let e=this._pickedDownMesh._getActionManagerForTrigger(16);e&&e.processTrigger(16,a.X.CreateNew(this._pickedDownMesh,i))}if(!t.ignore){let r=new s.mx(s.Zp.POINTERUP,i,e);if(this._setRayOnPointerInfo(e,i),n.onPointerObservable.notifyObservers(r,s.Zp.POINTERUP),n.onPointerUp&&n.onPointerUp(i,e,s.Zp.POINTERUP),!t.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let r=0;if(t.singleClick?r=s.Zp.POINTERTAP:t.doubleClick&&(r=s.Zp.POINTERDOUBLETAP),r){let t=new s.mx(r,i,e);n.onPointerObservable.hasObservers()&&n.onPointerObservable.hasSpecificMask(r)&&n.onPointerObservable.notifyObservers(t,r)}}}}isPointerCaptured(e=0){return this._pointerCaptures[e]}attachControl(e=!0,i=!0,t=!0,o=null){let p=this._scene,d=p.getEngine();o||(o=d.getInputElement()),this._alreadyAttached&&this.detachControl(),o&&(this._alreadyAttachedTo=o),this._deviceSourceManager=new c.Z(d),this._initActionManager=e=>{if(!this._meshPickProceed){let i=!p.skipPointerUpPicking&&(0!==p._registeredActions||this._checkForPicking()||p.onPointerUp)?p.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,p.pointerUpPredicate,p.pointerUpFastCheck,p.cameraToUseForPointers,p.pointerUpTrianglePredicate):null;this._currentPickResult=i,i&&(e=i.hit&&i.pickedMesh?i.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return e},this._delayedSimpleClick=(e,i,t)=>{if((Date.now()-this._previousStartingPointerTime>P.DoubleClickDelay&&!this._doubleClickOccured||e!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,i.singleClick=!0,i.ignore=!1,this._delayedClicks[e])){let i=this._delayedClicks[e].evt,t=s.Zp.POINTERTAP,n=new s.mx(t,i,this._currentPickResult);p.onPointerObservable.hasObservers()&&p.onPointerObservable.hasSpecificMask(t)&&p.onPointerObservable.notifyObservers(n,t),this._delayedClicks[e]=null}},this._initClickEvent=(e,i,t,r)=>{let o=new u;this._currentPickResult=null;let a=null,l=e.hasSpecificMask(s.Zp.POINTERPICK)||i.hasSpecificMask(s.Zp.POINTERPICK)||e.hasSpecificMask(s.Zp.POINTERTAP)||i.hasSpecificMask(s.Zp.POINTERTAP)||e.hasSpecificMask(s.Zp.POINTERDOUBLETAP)||i.hasSpecificMask(s.Zp.POINTERDOUBLETAP);!l&&n.G&&(a=this._initActionManager(a,o))&&(l=a.hasPickTriggers);let h=!1;if(l=l&&!this._isMultiTouchGesture){let l=t.button;if(o.hasSwiped=this._isPointerSwiping(),!o.hasSwiped){let c=!P.ExclusiveDoubleClickMode;if(!c&&(c=!e.hasSpecificMask(s.Zp.POINTERDOUBLETAP)&&!i.hasSpecificMask(s.Zp.POINTERDOUBLETAP))&&!n.G.HasSpecificTrigger(6)&&(a=this._initActionManager(a,o))&&(c=!a.hasSpecificTrigger(6)),c)(Date.now()-this._previousStartingPointerTime>P.DoubleClickDelay||l!==this._previousButtonPressed)&&(o.singleClick=!0,r(o,this._currentPickResult),h=!0);else{let e={evt:t,clickInfo:o,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,l,o,r),P.DoubleClickDelay)};this._delayedClicks[l]=e}let p=e.hasSpecificMask(s.Zp.POINTERDOUBLETAP)||i.hasSpecificMask(s.Zp.POINTERDOUBLETAP);!p&&n.G.HasSpecificTrigger(6)&&(a=this._initActionManager(a,o))&&(p=a.hasSpecificTrigger(6)),p&&(l===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<P.DoubleClickDelay&&!this._doubleClickOccured?(o.hasSwiped||this._isPointerSwiping()?(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=l,P.ExclusiveDoubleClickMode?(this._delayedClicks[l]&&(clearTimeout(this._delayedClicks[l]?.timeoutId),this._delayedClicks[l]=null),r(o,this._previousPickResult)):r(o,this._currentPickResult)):(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,o.doubleClick=!0,o.ignore=!1,P.ExclusiveDoubleClickMode&&this._delayedClicks[l]&&(clearTimeout(this._delayedClicks[l]?.timeoutId),this._delayedClicks[l]=null),r(o,this._currentPickResult)),h=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=l))}}h||r(o,this._currentPickResult)},this._onPointerMove=e=>{if(this._updatePointerPosition(e),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>P.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>P.DragMovementThreshold),d.isPointerLock&&d._verifyPointerLock(),this._checkPrePointerObservable(null,e,e.inputIndex>=h.ST.MouseWheelX&&e.inputIndex<=h.ST.MouseWheelZ?s.Zp.POINTERWHEEL:s.Zp.POINTERMOVE)||!p.cameraToUseForPointers&&!p.activeCamera)return;if(p.skipPointerMovePicking)return void this._processPointerMove(new r.G,e);p.pointerMovePredicate||(p.pointerMovePredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||p.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!p.cameraToUseForPointers||(p.cameraToUseForPointers.layerMask&e.layerMask)!=0));let i=p._registeredActions>0||p.constantlyUpdateMeshUnderPointer?this._pickMove(e):null;this._processPointerMove(i,e)},this._onPointerDown=e=>{let i,t=this._activePointerIds.indexOf(-1);if(-1===t?this._activePointerIds.push(e.pointerId):this._activePointerIds[t]=e.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,P.ExclusiveDoubleClickMode){for(let i=0;i<this._delayedClicks.length;i++)if(this._delayedClicks[i])if(e.button===i)clearTimeout(this._delayedClicks[i]?.timeoutId);else{let e=this._delayedClicks[i].clickInfo;this._doubleClickOccured=!1,e.singleClick=!0,e.ignore=!1;let t=this._delayedClicks[i].evt,n=s.Zp.POINTERTAP,r=new s.mx(n,t,this._currentPickResult);p.onPointerObservable.hasObservers()&&p.onPointerObservable.hasSpecificMask(n)&&p.onPointerObservable.notifyObservers(r,n),this._delayedClicks[i]=null}}this._updatePointerPosition(e),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=e.button),p.preventDefaultOnPointerDown&&o&&(e.preventDefault(),o.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,e,s.Zp.POINTERDOWN)||(p.cameraToUseForPointers||p.activeCamera)&&(this._pointerCaptures[e.pointerId]=!0,p.pointerDownPredicate||(p.pointerDownPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!p.cameraToUseForPointers||(p.cameraToUseForPointers.layerMask&e.layerMask)!=0)),this._pickedDownMesh=null,i=!p.skipPointerDownPicking&&(0!==p._registeredActions||this._checkForPicking()||p.onPointerDown)?p.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,p.pointerDownPredicate,p.pointerDownFastCheck,p.cameraToUseForPointers,p.pointerDownTrianglePredicate):new r.G,this._processPointerDown(i,e))},this._onPointerUp=e=>{let i=this._activePointerIds.indexOf(e.pointerId);-1!==i&&(this._activePointerIds[i]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(e),p.preventDefaultOnPointerUp&&o&&(e.preventDefault(),o.focus()),this._initClickEvent(p.onPrePointerObservable,p.onPointerObservable,e,(i,t)=>{if(p.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!i.ignore)){if(this._checkPrePointerObservable(null,e,s.Zp.POINTERUP)){this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1);return}!i.hasSwiped&&(i.singleClick&&p.onPrePointerObservable.hasSpecificMask(s.Zp.POINTERTAP)&&this._checkPrePointerObservable(null,e,s.Zp.POINTERTAP)&&(this._skipPointerTap=!0),i.doubleClick&&p.onPrePointerObservable.hasSpecificMask(s.Zp.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,e,s.Zp.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}if(!this._pointerCaptures[e.pointerId]){this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1);return}0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1),(p.cameraToUseForPointers||p.activeCamera)&&(p.pointerUpPredicate||(p.pointerUpPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!p.cameraToUseForPointers||(p.cameraToUseForPointers.layerMask&e.layerMask)!=0)),!this._meshPickProceed&&(n.G&&n.G.HasTriggers||this._checkForPicking()||p.onPointerUp)&&this._initActionManager(null,i),t||(t=this._currentPickResult),this._processPointerUp(t,e,i),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))}))},this._onKeyDown=e=>{let i=l.TB.KEYDOWN;if(p.onPreKeyboardObservable.hasObservers()){let t=new l.Bu(i,e);if(p.onPreKeyboardObservable.notifyObservers(t,i),t.skipOnKeyboardObservable)return}if(p.onKeyboardObservable.hasObservers()){let t=new l.W0(i,e);p.onKeyboardObservable.notifyObservers(t,i)}p.actionManager&&p.actionManager.processTrigger(14,a.X.CreateNewFromScene(p,e))},this._onKeyUp=e=>{let i=l.TB.KEYUP;if(p.onPreKeyboardObservable.hasObservers()){let t=new l.Bu(i,e);if(p.onPreKeyboardObservable.notifyObservers(t,i),t.skipOnKeyboardObservable)return}if(p.onKeyboardObservable.hasObservers()){let t=new l.W0(i,e);p.onKeyboardObservable.notifyObservers(t,i)}p.actionManager&&p.actionManager.processTrigger(15,a.X.CreateNewFromScene(p,e))},this._deviceSourceManager.onDeviceConnectedObservable.add(s=>{s.deviceType===h.bq.Mouse?s.onInputChangedObservable.add(n=>{this._originMouseEvent=n,n.inputIndex===h.ST.LeftClick||n.inputIndex===h.ST.MiddleClick||n.inputIndex===h.ST.RightClick||n.inputIndex===h.ST.BrowserBack||n.inputIndex===h.ST.BrowserForward?i&&1===s.getInput(n.inputIndex)?this._onPointerDown(n):e&&0===s.getInput(n.inputIndex)&&this._onPointerUp(n):t&&(n.inputIndex===h.ST.Move?this._onPointerMove(n):(n.inputIndex===h.ST.MouseWheelX||n.inputIndex===h.ST.MouseWheelY||n.inputIndex===h.ST.MouseWheelZ)&&this._onPointerMove(n))}):s.deviceType===h.bq.Touch?s.onInputChangedObservable.add(n=>{n.inputIndex===h.ST.LeftClick&&(i&&1===s.getInput(n.inputIndex)?(this._onPointerDown(n),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):e&&0===s.getInput(n.inputIndex)&&(this._onPointerUp(n),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),t&&n.inputIndex===h.ST.Move&&this._onPointerMove(n)}):s.deviceType===h.bq.Keyboard&&s.onInputChangedObservable.add(e=>{"keydown"===e.type?this._onKeyDown(e):"keyup"===e.type&&this._onKeyUp(e)})}),this._alreadyAttached=!0}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(e,i=0,t,s){let n;if(this._meshUnderPointerId[i]===e&&(!e||!e._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;let r=this._meshUnderPointerId[i];r&&(n=r._getActionManagerForTrigger(10))&&n.processTrigger(10,new a.X(r,this._pointerX,this._pointerY,e,s,{pointerId:i})),e?(this._meshUnderPointerId[i]=e,this._pointerOverMesh=e,(n=e._getActionManagerForTrigger(9))&&n.processTrigger(9,new a.X(e,this._pointerX,this._pointerY,e,s,{pointerId:i,pickResult:t}))):(delete this._meshUnderPointerId[i],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:e,pointerId:i})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(e){for(let i in this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[i]===e&&delete this._meshUnderPointerId[i]}}P.DragMovementThreshold=10,P.LongPressDelay=500,P.DoubleClickDelay=300,P.ExclusiveDoubleClickMode=!1},74468(e,i,t){t.d(i,{_ENVTextureLoader:()=>n});var s=t(40062);class n{constructor(){this.supportCascades=!1}loadCubeData(e,i,t,n,r){if(Array.isArray(e))return;let o=(0,s.cU)(e);if(o){i.width=o.width,i.height=o.width;try{(0,s.ow)(i,o),(0,s.o5)(i,e,o).then(()=>{i.isReady=!0,i.onLoadedObservable.notifyObservers(i),i.onLoadedObservable.clear(),n&&n()},e=>{r?.("Can not upload environment levels",e)})}catch(e){r?.("Can not upload environment file",e)}}else r&&r("Can not parse the environment file",null)}loadData(){throw".env not supported in 2d."}}},26648(e,i,t){var s=t(33271),n=t(64658);n.t.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(n.t.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;this._texture.isReady&&(this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=s.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then(e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0})))}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})},12793(e,i,t){t.d(i,{B:()=>s});function s(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}},14462(e,i,t){t.d(i,{C:()=>r,_:()=>n});var s=t(12793);function n(e,i){i.EXPOSURE&&e.push("exposureLinear"),i.CONTRAST&&e.push("contrast"),i.COLORGRADING&&e.push("colorTransformSettings"),(i.VIGNETTE||i.DITHER)&&e.push("vInverseScreenSize"),i.VIGNETTE&&(e.push("vignetteSettings1"),e.push("vignetteSettings2")),i.COLORCURVES&&(0,s.B)(e),i.DITHER&&e.push("ditherIntensity")}function r(e,i){i.COLORGRADING&&e.push("txColorTransform")}},52364(e,i,t){t.r(i),t.d(i,{Dispose:()=>k,DumpData:()=>b,DumpDataAsync:()=>v,DumpFramebuffer:()=>g,DumpTools:()=>T,EncodeImageAsync:()=>_});var s=t(55440),n=t(9187),r=t(42194),o=t(57975),a=t(46575),l=t(96861),h=t(56377),c=t(76663);let p=null;async function d(){let e=a.q.LastCreatedEngine?.createCanvas(100,100)??new OffscreenCanvas(100,100);e instanceof OffscreenCanvas&&l.V.Warn("DumpData: OffscreenCanvas will be used for dumping data. This may result in lossy alpha values.");let{ThinEngine:i}=await Promise.resolve().then(t.bind(t,67995));if(!i.IsSupported)throw Error("DumpData: No WebGL context available. Cannot dump data.");let s=new i(e,!1,{preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1});a.q.Instances.pop(),a.q.OnEnginesDisposedObservable.add(e=>{s&&e!==s&&!s.isDisposed&&0===a.q.Instances.length&&k()}),s.getCaps().parallelShaderCompile=void 0;let r=new n.J(s),{passPixelShader:o}=await t.e("4857").then(t.bind(t,18272)),h=new n.$({engine:s,name:o.name,fragmentShader:o.shader,samplerNames:["textureSampler"]});return{canvas:e,dumpEngine:{engine:s,renderer:r,wrapper:h}}}async function u(){return p||(p=d()),await p}class P{static async EncodeImageAsync(e,i,t,s,n,o){let a=await u(),l=a.dumpEngine;l.engine.setSize(i,t,!0);let h=l.engine.createRawTexture(e,i,t,5,!1,!n,1);return l.renderer.setViewport(),l.renderer.applyEffectWrapper(l.wrapper),l.wrapper.effect._bindTexture("textureSampler",h),l.renderer.draw(),h.dispose(),await new Promise((e,i)=>{r.S0.ToBlob(a.canvas,t=>{t?e(t):i(Error("EncodeImageAsync: Failed to convert canvas to blob."))},s,o)})}}(0,s.Cg)([c.Cx],P,"EncodeImageAsync",null);let _=P.EncodeImageAsync;async function g(e,i,t,s,n="image/png",r,o){let a=new Uint8Array((await t.readPixels(0,0,e,i)).buffer);b(e,i,a,s,n,r,!0,void 0,o)}async function v(e,i,t,s="image/png",n,a=!1,c=!1,p){if(t instanceof Float32Array){let e=new Uint8Array(t.length),i=t.length;for(;i--;){let s=t[i];e[i]=Math.round(255*(0,o.Clamp)(s))}t=e}let d=await P.EncodeImageAsync(t,e,i,s,a,p);void 0!==n&&r.S0.DownloadBlob(d,n),d.type!==s&&l.V.Warn(`DumpData: The requested mimeType '${s}' is not supported. The result has mimeType '${d.type}' instead.`);let u=await d.arrayBuffer();return c?u:`data:${s};base64,${(0,h.EL)(u)}`}function b(e,i,t,s,n="image/png",r,o=!1,a=!1,l){void 0!==r||s||(r=""),v(e,i,t,n,r,o,a,l).then(e=>{s&&s(e)})}function k(){p&&(p?.then(e=>{e.canvas instanceof HTMLCanvasElement&&e.canvas.remove(),e.dumpEngine&&(e.dumpEngine.engine.dispose(),e.dumpEngine.renderer.dispose(),e.dumpEngine.wrapper.dispose())}),p=null)}let T={DumpData:b,DumpDataAsync:v,DumpFramebuffer:g,Dispose:k};r.S0.DumpData=b,r.S0.DumpDataAsync=v,r.S0.DumpFramebuffer=g},39409(e,i,t){t.d(i,{h:()=>s});class s{}s._IsPickingAvailable=!1}}]);