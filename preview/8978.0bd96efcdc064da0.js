"use strict";(globalThis.webpackChunk_cosmos_journeyer_game=globalThis.webpackChunk_cosmos_journeyer_game||[]).push([["8978"],{38457:function(e,a,n){n.r(a),n.d(a,{Dispose:()=>v,DumpData:()=>y,DumpDataAsync:()=>h,DumpFramebuffer:()=>w,DumpTools:()=>D,EncodeImageAsync:()=>g});var t=n(7791),r=n(27958),s=n(14931),i=n(50912),o=n(95844),p=n(49478),l=n(1568),u=n(81876);let c=null;async function d(){let e=o.q.LastCreatedEngine?.createCanvas(100,100)??new OffscreenCanvas(100,100);e instanceof OffscreenCanvas&&p.V.Warn("DumpData: OffscreenCanvas will be used for dumping data. This may result in lossy alpha values.");let{ThinEngine:a}=await Promise.resolve().then(n.bind(n,12106));if(!a.IsSupported)throw Error("DumpData: No WebGL context available. Cannot dump data.");let t=new a(e,!1,{preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1});o.q.Instances.pop(),o.q.OnEnginesDisposedObservable.add(e=>{t&&e!==t&&!t.isDisposed&&0===o.q.Instances.length&&v()}),t.getCaps().parallelShaderCompile=void 0;let s=new r.J(t),{passPixelShader:i}=await n.e("8012").then(n.bind(n,38375)),l=new r.$({engine:t,name:i.name,fragmentShader:i.shader,samplerNames:["textureSampler"]});return{canvas:e,dumpEngine:{engine:t,renderer:s,wrapper:l}}}async function m(){return c||(c=d()),await c}class f{static async EncodeImageAsync(e,a,n,t,r,i){let o=await m(),p=o.dumpEngine;p.engine.setSize(a,n,!0);let l=p.engine.createRawTexture(e,a,n,5,!1,!r,1);return p.renderer.setViewport(),p.renderer.applyEffectWrapper(p.wrapper),p.wrapper.effect._bindTexture("textureSampler",l),p.renderer.draw(),l.dispose(),await new Promise((e,a)=>{s.S0.ToBlob(o.canvas,n=>{n?e(n):a(Error("EncodeImageAsync: Failed to convert canvas to blob."))},t,i)})}}(0,t.Cg)([u.Cx],f,"EncodeImageAsync",null);let g=f.EncodeImageAsync;async function w(e,a,n,t,r="image/png",s,i){let o=new Uint8Array((await n.readPixels(0,0,e,a)).buffer);y(e,a,o,t,r,s,!0,void 0,i)}async function h(e,a,n,t="image/png",r,o=!1,u=!1,c){if(n instanceof Float32Array){let e=new Uint8Array(n.length),a=n.length;for(;a--;){let t=n[a];e[a]=Math.round(255*(0,i.Clamp)(t))}n=e}let d=await f.EncodeImageAsync(n,e,a,t,o,c);void 0!==r&&s.S0.DownloadBlob(d,r),d.type!==t&&p.V.Warn(`DumpData: The requested mimeType '${t}' is not supported. The result has mimeType '${d.type}' instead.`);let m=await d.arrayBuffer();return u?m:`data:${t};base64,${(0,l.EL)(m)}`}function y(e,a,n,t,r="image/png",s,i=!1,o=!1,p){void 0!==s||t||(s=""),h(e,a,n,r,s,i,o,p).then(e=>{t&&t(e)})}function v(){c&&(c?.then(e=>{e.canvas instanceof HTMLCanvasElement&&e.canvas.remove(),e.dumpEngine&&(e.dumpEngine.engine.dispose(),e.dumpEngine.renderer.dispose(),e.dumpEngine.wrapper.dispose())}),c=null)}let D={DumpData:y,DumpDataAsync:h,DumpFramebuffer:w,Dispose:v};s.S0.DumpData=y,s.S0.DumpDataAsync=h,s.S0.DumpFramebuffer=w}}]);