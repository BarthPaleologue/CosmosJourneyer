/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["571"],{1137:function(e,t,r){r.d(t,{$:()=>s});class s{constructor(e,t){this.width=e,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let e=0|this.width;return 397*e^(0|this.height)}copyFrom(e){this.width=e.width,this.height=e.height}copyFromFloats(e,t){return this.width=e,this.height=t,this}set(e,t){return this.copyFromFloats(e,t)}multiplyByFloats(e,t){return new s(this.width*e,this.height*t)}clone(){return new s(this.width,this.height)}equals(e){return!!e&&this.width===e.width&&this.height===e.height}get surface(){return this.width*this.height}static Zero(){return new s(0,0)}add(e){return new s(this.width+e.width,this.height+e.height)}subtract(e){return new s(this.width-e.width,this.height-e.height)}scale(e){return new s(this.width*e,this.height*e)}static Lerp(e,t,r){return new s(e.width+(t.width-e.width)*r,e.height+(t.height-e.height)*r)}}},45809:function(e,t,r){r.d(t,{Q:()=>d,Z:()=>c});var s=r(69254),i=r(75590),n=r(74913),a=r(46363),o=r(90131),h=r(98606),l=r(88609);class d extends i.D{getClassName(){return"PassPostProcess"}constructor(e,t,r=null,s,i,n,a=0,o=!1){let l={size:"number"==typeof t?t:void 0,camera:r,samplingMode:s,engine:i,reusable:n,textureType:a,blockCompilation:o,...t};super(e,h.S.FragmentUrl,{effectWrapper:"number"!=typeof t&&t.effectWrapper?void 0:new h.S(e,i,l),...l})}static _Parse(e,t,r,s){return o.p.Parse(()=>new d(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable),e,r,s)}}(0,a.H7)("BABYLON.PassPostProcess",d);class c extends i.D{get face(){return this._effectWrapper.face}set face(e){this._effectWrapper.face=e}getClassName(){return"PassCubePostProcess"}constructor(e,t,r=null,s,i,n,a=0,o=!1){let l={size:"number"==typeof t?t:void 0,camera:r,samplingMode:s,engine:i,reusable:n,textureType:a,blockCompilation:o,...t};super(e,h.S.FragmentUrl,{effectWrapper:"number"!=typeof t&&t.effectWrapper?void 0:new h.s(e,i,l),...l})}static _Parse(e,t,r,s){return o.p.Parse(()=>new c(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable),e,r,s)}}(0,s.gn)([(0,l.qC)()],c.prototype,"face",null),n.a._RescalePostProcessFactory=e=>new d("rescale",1,null,2,e,!1,0)},47888:function(e,t,r){r.d(t,{$B:()=>u,Q:()=>d,RZ:()=>l,ZZ:()=>c,hr:()=>h,i5:()=>i,j_:()=>_});var s,i,n=r(16891),a=r(61834),o=r(49087);(s=i||(i={}))[s.CW=0]="CW",s[s.CCW=1]="CCW";class h{static Interpolate(e,t,r,s,i){if(0===e)return 0;let n=1-3*s+3*t,a=3*s-6*t,o=3*t,h=e;for(let t=0;t<5;t++){let t=h*h,r=t*h*n+a*t+o*h,s=1/(3*n*t+2*a*h+o);h-=(r-e)*s,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*r+3*(1-h)*Math.pow(h,2)*i+Math.pow(h,3)}}class l{constructor(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(e,t){let r=t.subtract(e);return new l(Math.atan2(r.y,r.x))}static BetweenTwoVectors(e,t){let r=e.lengthSquared()*t.lengthSquared();if(0===r)return new l(Math.PI/2);r=Math.sqrt(r);let s=e.dot(t)/r;return new l(Math.acos(s=(0,n.Clamp)(s,-1,1)))}static FromRadians(e){return new l(e)}static FromDegrees(e){return new l(e*Math.PI/180)}}class d{constructor(e,t,r){this.startPoint=e,this.midPoint=t,this.endPoint=r;let s=Math.pow(t.x,2)+Math.pow(t.y,2),i=(Math.pow(e.x,2)+Math.pow(e.y,2)-s)/2,n=(s-Math.pow(r.x,2)-Math.pow(r.y,2))/2,o=(e.x-t.x)*(t.y-r.y)-(t.x-r.x)*(e.y-t.y);this.centerPoint=new a.FM((i*(t.y-r.y)-n*(e.y-t.y))/o,((e.x-t.x)*n-(t.x-r.x)*i)/o),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=l.BetweenTwoPoints(this.centerPoint,this.startPoint);let h=this.startAngle.degrees(),d=l.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),c=l.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();d-h>180&&(d-=360),d-h<-180&&(d+=360),c-d>180&&(c-=360),c-d<-180&&(c+=360),this.orientation=d-h<0?0:1,this.angle=l.FromDegrees(0===this.orientation?h-c:c-h)}}class c{constructor(e,t){this._points=[],this._length=0,this.closed=!1,this._points.push(new a.FM(e,t))}addLineTo(e,t){if(this.closed)return this;let r=new a.FM(e,t),s=this._points[this._points.length-1];return this._points.push(r),this._length+=r.subtract(s).length(),this}addArcTo(e,t,r,s,i=36){if(this.closed)return this;let n=this._points[this._points.length-1],o=new d(n,new a.FM(e,t),new a.FM(r,s)),h=o.angle.radians()/i;0===o.orientation&&(h*=-1);let l=o.startAngle.radians()+h;for(let e=0;e<i;e++){let e=Math.cos(l)*o.radius+o.centerPoint.x,t=Math.sin(l)*o.radius+o.centerPoint.y;this.addLineTo(e,t),l+=h}return this}addQuadraticCurveTo(e,t,r,s,i=36){if(this.closed)return this;let n=(e,t,r,s)=>(1-e)*(1-e)*t+2*e*(1-e)*r+e*e*s,a=this._points[this._points.length-1];for(let o=0;o<=i;o++){let h=o/i,l=n(h,a.x,e,r),d=n(h,a.y,t,s);this.addLineTo(l,d)}return this}addBezierCurveTo(e,t,r,s,i,n,a=36){if(this.closed)return this;let o=(e,t,r,s,i)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*r+3*e*e*(1-e)*s+e*e*e*i,h=this._points[this._points.length-1];for(let l=0;l<=a;l++){let d=l/a,c=o(d,h.x,e,r,i),u=o(d,h.y,t,s,n);this.addLineTo(c,u)}return this}isPointInside(e){let t=!1,r=this._points.length;for(let s=r-1,i=0;i<r;s=i++){let r=this._points[s],n=this._points[i],a=n.x-r.x,o=n.y-r.y;if(Math.abs(o)>Number.EPSILON){if(o<0&&(r=this._points[i],a=-a,n=this._points[s],o=-o),e.y<r.y||e.y>n.y)continue;if(e.y===r.y&&e.x===r.x)return!0;{let s=o*(e.x-r.x)-a*(e.y-r.y);if(0===s)return!0;if(s<0)continue;t=!t}}else{if(e.y!==r.y)continue;if(n.x<=e.x&&e.x<=r.x||r.x<=e.x&&e.x<=n.x)return!0}}return t}close(){return this.closed=!0,this}length(){let e=this._length;if(this.closed){let t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e}area(){let e=this._points.length,t=0;for(let r=e-1,s=0;s<e;r=s++)t+=this._points[r].x*this._points[s].y-this._points[s].x*this._points[r].y;return .5*t}getPoints(){return this._points}getPointAtLengthPosition(e){if(e<0||e>1)return a.FM.Zero();let t=e*this.length(),r=0;for(let e=0;e<this._points.length;e++){let s=(e+1)%this._points.length,i=this._points[e],n=this._points[s].subtract(i),o=n.length()+r;if(t>=r&&t<=o){let e=n.normalize(),s=t-r;return new a.FM(i.x+e.x*s,i.y+e.y*s)}r=o}return a.FM.Zero()}static StartingAt(e,t){return new c(e,t)}}class u{constructor(e,t=null,r,s=!1){this.path=e,this._curve=[],this._distances=[],this._tangents=[],this._normals=[],this._binormals=[],this._pointAtData={id:0,point:a.P.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:a.y3.Identity()};for(let t=0;t<e.length;t++)this._curve[t]=e[t].clone();this._raw=r||!1,this._alignTangentsWithPath=s,this._compute(t,s)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(e){return this._updatePointAtData(e).point}getTangentAt(e,t=!1){return this._updatePointAtData(e,t),t?a.P.TransformCoordinates(a.P.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(e,t=!1){return this._updatePointAtData(e,t),t?a.P.TransformCoordinates(a.P.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(e,t=!1){return this._updatePointAtData(e,t),t?a.P.TransformCoordinates(a.P.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(e){return this.length()*e}getPreviousPointIndexAt(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex}getSubPositionAt(e){return this._updatePointAtData(e),this._pointAtData.subPosition}getClosestPositionTo(e){let t=Number.MAX_VALUE,r=0;for(let s=0;s<this._curve.length-1;s++){let i=this._curve[s+0],n=this._curve[s+1].subtract(i).normalize(),o=this._distances[s+1]-this._distances[s+0],h=Math.min(Math.max(a.P.Dot(n,e.subtract(i).normalize()),0)*a.P.Distance(i,e)/o,1),l=a.P.Distance(i.add(n.scale(h*o)),e);l<t&&(t=l,r=(this._distances[s+0]+o*h)/this.length())}return r}slice(e=0,t=1){if(e<0&&(e=1- -1*e%1),t<0&&(t=1- -1*t%1),e>t){let r=e;e=t,t=r}let r=this.getCurve(),s=this.getPointAt(e),i=this.getPreviousPointIndexAt(e),n=this.getPointAt(t),a=this.getPreviousPointIndexAt(t)+1,o=[];return 0!==e&&(i++,o.push(s)),o.push(...r.slice(i,a)),(1!==t||1===e)&&o.push(n),new u(o,this.getNormalAt(e),this._raw,this._alignTangentsWithPath)}update(e,t=null,r=!1){for(let t=0;t<e.length;t++)this._curve[t].x=e[t].x,this._curve[t].y=e[t].y,this._curve[t].z=e[t].z;return this._compute(t,r),this}_compute(e,t=!1){let r,s,i,n,o,h=this._curve.length;if(h<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[h-1]=this._curve[h-1].subtract(this._curve[h-2]),this._raw||this._tangents[h-1].normalize();let l=this._tangents[0],d=this._normalVector(l,e);this._normals[0]=d,this._raw||this._normals[0].normalize(),this._binormals[0]=a.P.Cross(l,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let e=1;e<h;e++)r=this._getLastNonNullVector(e),e<h-1&&(s=this._getFirstNonNullVector(e),this._tangents[e]=t?s:r.add(s),this._tangents[e].normalize()),this._distances[e]=this._distances[e-1]+this._curve[e].subtract(this._curve[e-1]).length(),i=this._tangents[e],o=this._binormals[e-1],this._normals[e]=a.P.Cross(o,i),this._raw||(0===this._normals[e].length()?(n=this._normals[e-1],this._normals[e]=n.clone()):this._normals[e].normalize()),this._binormals[e]=a.P.Cross(i,this._normals[e]),this._raw||this._binormals[e].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(e){let t=1,r=this._curve[e+t].subtract(this._curve[e]);for(;0===r.length()&&e+t+1<this._curve.length;)t++,r=this._curve[e+t].subtract(this._curve[e]);return r}_getLastNonNullVector(e){let t=1,r=this._curve[e].subtract(this._curve[e-t]);for(;0===r.length()&&e>t+1;)t++,r=this._curve[e].subtract(this._curve[e-t]);return r}_normalVector(e,t){let r,s=e.length();if(0===s&&(s=1),null==t){let t;t=(0,n.WithinEpsilon)(Math.abs(e.y)/s,1,o.kn)?(0,n.WithinEpsilon)(Math.abs(e.x)/s,1,o.kn)?(0,n.WithinEpsilon)(Math.abs(e.z)/s,1,o.kn)?a.P.Zero():new a.P(0,0,1):new a.P(1,0,0):new a.P(0,-1,0),r=a.P.Cross(e,t)}else r=a.P.Cross(e,t),a.P.CrossToRef(r,e,r);return r.normalize(),r}_updatePointAtData(e,t=!1){let r;if(this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;let s=this.getPoints();if(e<=0)return this._setPointAtData(0,0,s[0],0,t);if(e>=1)return this._setPointAtData(1,1,s[s.length-1],s.length-1,t);let i=s[0],n=0,o=e*this.length();for(let h=1;h<s.length;h++){r=s[h];let l=a.P.Distance(i,r);if((n+=l)===o)return this._setPointAtData(e,1,r,h,t);if(n>o){let s=(n-o)/l,a=i.subtract(r),d=r.add(a.scaleInPlace(s));return this._setPointAtData(e,1-s,d,h-1,t)}i=r}return this._pointAtData}_setPointAtData(e,t,r,s,i){return this._pointAtData.point=r,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=s,this._pointAtData.interpolateReady=i,i&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=a.y3.Identity();let e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){let t=e+1,r=this._tangents[e].clone(),s=this._normals[e].clone(),i=this._binormals[e].clone(),n=this._tangents[t].clone(),o=this._normals[t].clone(),h=this._binormals[t].clone(),l=a._f.RotationQuaternionFromAxis(s,i,r),d=a._f.RotationQuaternionFromAxis(o,h,n);a._f.Slerp(l,d,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class _{static CreateQuadraticBezier(e,t,r,s){s=s>2?s:3;let i=[],n=(e,t,r,s)=>(1-e)*(1-e)*t+2*e*(1-e)*r+e*e*s;for(let o=0;o<=s;o++)i.push(new a.P(n(o/s,e.x,t.x,r.x),n(o/s,e.y,t.y,r.y),n(o/s,e.z,t.z,r.z)));return new _(i)}static CreateCubicBezier(e,t,r,s,i){i=i>3?i:4;let n=[],o=(e,t,r,s,i)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*r+3*e*e*(1-e)*s+e*e*e*i;for(let h=0;h<=i;h++)n.push(new a.P(o(h/i,e.x,t.x,r.x,s.x),o(h/i,e.y,t.y,r.y,s.y),o(h/i,e.z,t.z,r.z,s.z)));return new _(n)}static CreateHermiteSpline(e,t,r,s,i){let n=[],o=1/i;for(let h=0;h<=i;h++)n.push(a.P.Hermite(e,t,r,s,h*o));return new _(n)}static CreateCatmullRomSpline(e,t,r){let s=[],i=1/t,n=0;if(r){let r=e.length;for(let o=0;o<r;o++){n=0;for(let h=0;h<t;h++)s.push(a.P.CatmullRom(e[o%r],e[(o+1)%r],e[(o+2)%r],e[(o+3)%r],n)),n+=i}s.push(s[0])}else{let r=[];r.push(e[0].clone()),Array.prototype.push.apply(r,e),r.push(e[e.length-1].clone());let o=0;for(;o<r.length-3;o++){n=0;for(let e=0;e<t;e++)s.push(a.P.CatmullRom(r[o],r[o+1],r[o+2],r[o+3],n)),n+=i}o--,s.push(a.P.CatmullRom(r[o],r[o+1],r[o+2],r[o+3],n))}return new _(s)}static ArcThru3Points(e,t,r,s=32,i=!1,n=!1){let o=[],h=t.subtract(e),l=r.subtract(t),d=e.subtract(r),c=a.P.Cross(h,l),u=c.length();if(u<1e-8)return new _(o);let g=h.lengthSquared(),p=l.lengthSquared(),m=d.lengthSquared(),b=c.lengthSquared(),R=h.length(),f=.5*R*l.length()*d.length()/u,P=a.P.Dot(h,d),x=a.P.Dot(h,l),T=a.P.Dot(l,d),v=e.scale(-.5*p*P/b).add(t.scale(-.5*m*x/b)).add(r.scale(-.5*g*T/b)),y=e.subtract(v).normalize(),M=a.P.Cross(c,y).normalize();if(n){let t=2*Math.PI/s;for(let e=0;e<=2*Math.PI;e+=t)o.push(v.add(y.scale(f*Math.cos(e)).add(M.scale(f*Math.sin(e)))));o.push(e)}else{let t=1/s,n=0,h=a.P.Zero();do h=v.add(y.scale(f*Math.cos(n)).add(M.scale(f*Math.sin(n)))),o.push(h),n+=t;while(!h.equalsWithEpsilon(r,f*t*1.1));o.push(r),i&&o.push(e)}return new _(o)}constructor(e){this._length=0,this._points=e,this._length=this._computeLength(e)}getPoints(){return this._points}length(){return this._length}continue(e){let t=this._points[this._points.length-1],r=this._points.slice(),s=e.getPoints();for(let e=1;e<s.length;e++)r.push(s[e].subtract(s[0]).add(t));return new _(r)}_computeLength(e){let t=0;for(let r=1;r<e.length;r++)t+=e[r].subtract(e[r-1]).length();return t}}},49087:function(e,t,r){r.d(t,{Nn:()=>i,Q_:()=>n,kn:()=>a,zp:()=>s});let s=1/2.2,i=2.2,n=(1+Math.sqrt(5))/2,a=.001},57716:function(e,t,r){r.d(t,{_:()=>c});var s=r(85791),i=r(61834),n=r(32160),a=r(2553),o=r(6838),h=r(34403),l=r(88280),d=r(85282);h.Q.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)};class c extends n.x{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(e){this._objectRenderer.renderListPredicate=e}get renderList(){return this._objectRenderer.renderList}set renderList(e){this._objectRenderer.renderList=e}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(e){this._objectRenderer.particleSystemList=e}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(e){this._objectRenderer.getCustomRenderList=e}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(e){this._objectRenderer.renderParticles=e}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(e){this._objectRenderer.renderSprites=e}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(e){this._objectRenderer.forceLayerMaskCheck=e}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(e){this._objectRenderer.activeCamera=e}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(e){this._objectRenderer.cameraForLOD=e}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(e){this._objectRenderer.disableImageProcessing=e}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(e){this._objectRenderer.customIsReadyFunction=e}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(e){this._objectRenderer.customRenderFunction=e}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}set onClear(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(e){this._objectRenderer._waitingRenderList=e}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(e,t){this._objectRenderer.setMaterialForRendering(e,t)}get isMulti(){return this._renderTarget?.isMulti??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;let t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){return this._renderTarget?._depthStencilTexture??null}constructor(e,t,r,a=!1,o=!0,h=0,c=!1,u=n.x.TRILINEAR_SAMPLINGMODE,_=!0,g=!1,p=!1,m=5,b=!1,R,f,P=!1,x=!1){let T,v,y=!0;if("object"==typeof a){let e=a;a=!!e.generateMipMaps,o=e.doNotChangeAspectRatio??!0,h=e.type??0,c=!!e.isCube,u=e.samplingMode??n.x.TRILINEAR_SAMPLINGMODE,_=e.generateDepthBuffer??!0,g=!!e.generateStencilBuffer,p=!!e.isMulti,m=e.format??5,b=!!e.delayAllocation,R=e.samples,f=e.creationFlags,P=!!e.noColorAttachment,x=!!e.useSRGBBuffer,T=e.colorAttachment,y=e.gammaSpace??y,v=e.existingObjectRenderer}if(super(null,r,!a,void 0,u,void 0,void 0,void 0,void 0,m),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new s.y$,this.onAfterUnbindObservable=new s.y$,this.onClearObservable=new s.y$,this.onResizeObservable=new s.y$,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=i.P.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(r=this.getScene()))return;let M=this.getScene().getEngine();if(this._gammaSpace=y,this._coordinatesMode=n.x.PROJECTION_MODE,this.name=e,this.isRenderTarget=!0,this._initialSizeParameter=t,this._dontDisposeObjectRenderer=!!v,this._processSizeParameter(t),this._objectRenderer=v??new d.b(e,r,{numPasses:c?6:this.getRenderLayers()||1,doNotChangeAspectRatio:o}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add(()=>{if(!this._disableEngineStages)for(let e of this._scene._beforeRenderTargetClearStage)e.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(M):this.skipInitialClear||M.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(let e of this._scene._beforeRenderTargetDrawStage)e.action(this,this._currentFaceIndex,this._currentLayer)}),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add(()=>{if(!this._disableEngineStages)for(let e of this._scene._afterRenderTargetDrawStage)e.action(this,this._currentFaceIndex,this._currentLayer);let e=this._texture?.generateMipMaps??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(let e of this._scene._afterRenderTargetPostProcessStage)e.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=e),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),M):l.Y.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add(()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(M):this.skipInitialClear||M.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)}),this._resizeObserver=M.onResizeObservable.add(()=>{}),this._generateMipMaps=!!a,this._doNotChangeAspectRatio=o,p)return;this._renderTargetOptions={generateMipMaps:a,type:h,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:_,generateStencilBuffer:g,samples:R,creationFlags:f,noColorAttachment:P,useSRGBBuffer:x,colorAttachment:T,label:this.name},this.samplingMode===n.x.NEAREST_SAMPLINGMODE&&(this.wrapU=n.x.CLAMP_ADDRESSMODE,this.wrapV=n.x.CLAMP_ADDRESSMODE),b||(c?(this._renderTarget=r.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=n.x.INVCUBIC_MODE,this._textureMatrix=i.y3.Identity()):this._renderTarget=r.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==R&&(this.samples=R))}createDepthStencilTexture(e=0,t=!0,r=!1,s=1,i=14,n){this._renderTarget?.createDepthStencilTexture(e,t,r,s,i,n)}_processSizeParameter(e){if(e.ratio){this._sizeRatio=e.ratio;let t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e}get samples(){return this._renderTarget?.samples??this._samples}set samples(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))}addPostProcess(e){if(!this._postProcessManager){let e=this.getScene();if(!e)return;this._postProcessManager=new a.O(e),this._postProcesses=[]}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1}clearPostProcesses(e=!1){if(this._postProcesses){if(e)for(let e of this._postProcesses)e.dispose();this._postProcesses=[]}}removePostProcess(e){if(!this._postProcesses)return;let t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(e){this._objectRenderer.refreshRate=e}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){let e=this._size.layers;if(e)return e;let t=this._size.depth;return t||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(e){let t=Math.max(1,this.getRenderSize()*e);this.resize(t)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(e){let t=this.isCube;this._renderTarget?.dispose(),this._renderTarget=null;let r=this.getScene();r&&(this._processSizeParameter(e),t?this._renderTarget=r.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._renderTarget=r.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(e=!1,t=!1){this._render(e,t)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,r.e("8978").then(r.bind(r,23207)).then(e=>this._dumpTools=e)),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());let e=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),e}_render(e=!1,t=!1){let r=this.getScene();if(r){if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),(this.is2DArray||this.is3D)&&!this.isMulti)for(let s=0;s<this.getRenderLayers();s++)this._renderToTarget(0,e,t,s),r.incrementRenderId(),r.resetCachedMaterial();else if(this.isCube&&!this.isMulti)for(let s=0;s<6;s++)this._renderToTarget(s,e,t),r.incrementRenderId(),r.resetCachedMaterial();else this._renderToTarget(0,e,t);this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(e,t){let r=e*t,s=(0,o.Tr)(r+16384/(128+r));return Math.min((0,o.Av)(e),s)}_bindFrameBuffer(e=0,t=0){let r=this.getScene();if(!r)return;let s=r.getEngine();this._renderTarget&&s.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}_unbindFrameBuffer(e,t){this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,()=>{this.onAfterRenderObservable.notifyObservers(t)})}_prepareFrame(e,t,r,s){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(t,r):s&&e.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,r)}_renderToTarget(e,t,r,s=0){let i=this.getScene();if(!i)return;let n=i.getEngine();this._currentFaceIndex=e,this._currentLayer=s,this._currentUseCameraPostProcess=t,this._currentDumpForDebug=r,this._prepareFrame(i,e,s,t),n._debugPushGroup?.(`render to face #${e} layer #${s}`,2),this._objectRenderer.render(e+s,!0),n._debugPopGroup?.(2),this._unbindFrameBuffer(n,e),this._texture&&this.isCube&&5===e&&n.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(e,t=null,r=null,s=null){this._objectRenderer.setRenderingOrder(e,t,r,s)}setRenderingAutoClearDepthStencil(e,t){this._objectRenderer.setRenderingAutoClearDepthStencil(e,t)}clone(){let e=this.getSize(),t=new c(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t}serialize(){if(!this.name)return null;let e=super.serialize();if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(let t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e}disposeFramebufferObjects(){this._renderTarget?.dispose(!0)}releaseInternalTexture(){this._renderTarget?.releaseTextures(),this._texture=null}dispose(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);let e=this.getScene();if(!e)return;let t=e.customRenderTargets.indexOf(this);for(let r of(t>=0&&e.customRenderTargets.splice(t,1),e.cameras))(t=r.customRenderTargets.indexOf(this))>=0&&r.customRenderTargets.splice(t,1);this._renderTarget?.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}c.REFRESHRATE_RENDER_ONCE=d.b.REFRESHRATE_RENDER_ONCE,c.REFRESHRATE_RENDER_ONEVERYFRAME=d.b.REFRESHRATE_RENDER_ONEVERYFRAME,c.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=d.b.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,n.x._CreateRenderTargetTexture=(e,t,r,s,i)=>new c(e,t,r,s)},62941:function(e,t,r){r.d(t,{J:()=>i});var s=r(61834);class i{constructor(e,t,r,i){this.normal=new s.P(e,t,r),this.d=i}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new i(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let e=this.normal.getHashCode();return 397*e^(0|this.d)}normalize(){let e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}transform(e){let t=i._TmpMatrix;e.invertToRef(t);let r=t.m,s=this.normal.x,n=this.normal.y,a=this.normal.z,o=this.d,h=s*r[0]+n*r[1]+a*r[2]+o*r[3],l=s*r[4]+n*r[5]+a*r[6]+o*r[7];return new i(h,l,s*r[8]+n*r[9]+a*r[10]+o*r[11],s*r[12]+n*r[13]+a*r[14]+o*r[15])}dotCoordinate(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}copyFromPoints(e,t,r){let s,i=t.x-e.x,n=t.y-e.y,a=t.z-e.z,o=r.x-e.x,h=r.y-e.y,l=r.z-e.z,d=n*l-a*h,c=a*o-i*l,u=i*h-n*o,_=Math.sqrt(d*d+c*c+u*u);return s=0!==_?1/_:0,this.normal.x=d*s,this.normal.y=c*s,this.normal.z=u*s,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}isFrontFacingTo(e,t){return s.P.Dot(this.normal,e)<=t}signedDistanceTo(e){return s.P.Dot(e,this.normal)+this.d}static FromArray(e){return new i(e[0],e[1],e[2],e[3])}static FromPoints(e,t,r){let s=new i(0,0,0,0);return s.copyFromPoints(e,t,r),s}static FromPositionAndNormal(e,t){let r=new i(0,0,0,0);return this.FromPositionAndNormalToRef(e,t,r)}static FromPositionAndNormalToRef(e,t,r){return r.normal.copyFrom(t),r.normal.normalize(),r.d=-e.dot(r.normal),r}static SignedDistanceToPlaneFromPositionAndNormal(e,t,r){let i=-(t.x*e.x+t.y*e.y+t.z*e.z);return s.P.Dot(r,t)+i}}i._TmpMatrix=s.y3.Identity()},66669:function(e,t,r){r.d(t,{l:()=>s});class s{constructor(e,t,r,s){this.x=e,this.y=t,this.width=r,this.height=s}toGlobal(e,t){return new s(this.x*e,this.y*t,this.width*e,this.height*t)}toGlobalToRef(e,t,r){return r.x=this.x*e,r.y=this.y*t,r.width=this.width*e,r.height=this.height*t,this}clone(){return new s(this.x,this.y,this.width,this.height)}}},85286:function(e,t,r){r.d(t,{$:()=>i,e:()=>n});var s=r(61834);class i{constructor(e=s.P.Zero(),t=s.P.Up()){this.position=e,this.normal=t}clone(){return new i(this.position.clone(),this.normal.clone())}}class n{constructor(e=s.P.Zero(),t=s.P.Up(),r=s.FM.Zero()){this.position=e,this.normal=t,this.uv=r}clone(){return new n(this.position.clone(),this.normal.clone(),this.uv.clone())}}},87286:function(e,t,r){r.d(t,{i:()=>i});var s=r(62941);class i{static GetPlanes(e){let t=[];for(let e=0;e<6;e++)t.push(new s.J(0,0,0,0));return i.GetPlanesToRef(e,t),t}static GetNearPlaneToRef(e,t){let r=e.m;t.normal.x=r[3]+r[2],t.normal.y=r[7]+r[6],t.normal.z=r[11]+r[10],t.d=r[15]+r[14],t.normalize()}static GetFarPlaneToRef(e,t){let r=e.m;t.normal.x=r[3]-r[2],t.normal.y=r[7]-r[6],t.normal.z=r[11]-r[10],t.d=r[15]-r[14],t.normalize()}static GetLeftPlaneToRef(e,t){let r=e.m;t.normal.x=r[3]+r[0],t.normal.y=r[7]+r[4],t.normal.z=r[11]+r[8],t.d=r[15]+r[12],t.normalize()}static GetRightPlaneToRef(e,t){let r=e.m;t.normal.x=r[3]-r[0],t.normal.y=r[7]-r[4],t.normal.z=r[11]-r[8],t.d=r[15]-r[12],t.normalize()}static GetTopPlaneToRef(e,t){let r=e.m;t.normal.x=r[3]-r[1],t.normal.y=r[7]-r[5],t.normal.z=r[11]-r[9],t.d=r[15]-r[13],t.normalize()}static GetBottomPlaneToRef(e,t){let r=e.m;t.normal.x=r[3]+r[1],t.normal.y=r[7]+r[5],t.normal.z=r[11]+r[9],t.d=r[15]+r[13],t.normalize()}static GetPlanesToRef(e,t){i.GetNearPlaneToRef(e,t[0]),i.GetFarPlaneToRef(e,t[1]),i.GetLeftPlaneToRef(e,t[2]),i.GetRightPlaneToRef(e,t[3]),i.GetTopPlaneToRef(e,t[4]),i.GetBottomPlaneToRef(e,t[5])}static IsPointInFrustum(e,t){for(let r=0;r<6;r++)if(0>t[r].dotCoordinate(e))return!1;return!0}}}}]);