/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["3821"],{10816:function(e,t,r){r.d(t,{C7:()=>o,EN:()=>f,GX:()=>p,Gu:()=>w,VU:()=>u,b7:()=>n,bK:()=>a,jV:()=>y,nW:()=>d,qW:()=>l,rc:()=>i,sd:()=>h,w8:()=>c,zq:()=>s});let n=4,l=4,a=1,i=2,o=8,u=65536,f=8192,s=14,c=65537,h=16384,p=16383,w=59,d=63,y=6},21594:function(e,t,r){r.d(t,{b:()=>a});var n=r(88280),l=r(6132);function a(e,t){if(0x1312f76!=e.getUint32(0,!0))throw Error("Incorrect OpenEXR format");let r=e.getUint8(4),a=e.getUint8(5);t.value=8;let i={},o=!0;for(;o;){let r=(0,l.j)(e.buffer,t);if(r){let a=(0,l.j)(e.buffer,t),o=(0,l.vA)(e,t),u=(0,l.Vr)(e,t,a,o);void 0===u?n.Y.Warn(`Unknown header attribute type ${a}'.`):i[r]=u}else o=!1}if((-5&a)!=0)throw Error("Unsupported file format");return{version:r,spec:{singleTile:!!(2&a),longName:!!(4&a),deepFormat:!!(8&a),multiPart:!!(16&a)},...i}}},26553:function(e,t,r){r.r(t),r.d(t,{_ExrTextureLoader:()=>o});var n=r(21594),l=r(56182),a=r(43294),i=r(88280);class o{constructor(){this.supportCascades=!1}loadCubeData(e,t,r,n,l){throw".exr not supported in Cube."}loadData(e,t,r){let o=new DataView(e.buffer),u={value:0},f=(0,n.b)(o,u);(0,l.G)(f,o,u,a.P.DefaultOutputType).then(e=>{(0,l.B)(e,f,o,u),r(f.dataWindow.xMax-f.dataWindow.xMin+1,f.dataWindow.yMax-f.dataWindow.yMin+1,t.generateMipMaps,!1,()=>{let r=t.getEngine();t.format=f.format,t.type=e.textureType,t.invertY=!1,t._gammaSpace=!f.linearSpace,e.byteArray&&r._uploadDataToTextureDirectly(t,e.byteArray,0,0,void 0,!0)})}).catch(e=>{i.Y.Error("Failed to load EXR texture: ",e)})}}},37838:function(e,t,r){r.d(t,{U:()=>n});function n(e){let t=e.byteLength,r=[],n=0,l=new DataView(e);for(;t>0;){let e=l.getInt8(n++);if(e<0){let a=-e;t-=a+1;for(let e=0;e<a;e++)r.push(l.getUint8(n++))}else{t-=2;let a=l.getUint8(n++);for(let t=0;t<e+1;t++)r.push(a)}}return r}},43294:function(e,t,r){var n,l;r.d(t,{P:()=>a,n:()=>n}),(l=n||(n={}))[l.Float=0]="Float",l[l.HalfFloat=1]="HalfFloat";class a{}a.DefaultOutputType=n.HalfFloat,a.FFLATEUrl="https://unpkg.com/fflate@0.8.2"},56182:function(e,t,r){r.d(t,{B:()=>f,G:()=>u});var n=r(6132),l=r(60882),a=r(10816),i=r(70541),o=r(43294);async function u(e,t,r,u){let f={size:0,viewer:t,array:new Uint8Array(t.buffer),offset:r,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,channelLineOffsets:{},scanOrder:()=>0,bytesPerLine:0,outLineWidth:0,lines:0,scanlineBlockSize:0,inputSize:null,type:0,uncompress:null,getter:()=>0,format:5,outputChannels:0,decodeChannels:{},blockCount:null,byteArray:null,linearSpace:!1,textureType:0};switch(e.compression){case n.Lj.NO_COMPRESSION:f.lines=1,f.uncompress=l.OK;break;case n.Lj.RLE_COMPRESSION:f.lines=1,f.uncompress=l.Rj;break;case n.Lj.ZIPS_COMPRESSION:f.lines=1,f.uncompress=l.GS,await i.w1.LoadScriptAsync(o.P.FFLATEUrl);break;case n.Lj.ZIP_COMPRESSION:f.lines=16,f.uncompress=l.GS,await i.w1.LoadScriptAsync(o.P.FFLATEUrl);break;case n.Lj.PIZ_COMPRESSION:f.lines=32,f.uncompress=l.St;break;case n.Lj.PXR24_COMPRESSION:f.lines=16,f.uncompress=l.Ms,await i.w1.LoadScriptAsync(o.P.FFLATEUrl);break;default:throw Error(n.Lj[e.compression]+" is unsupported")}f.scanlineBlockSize=f.lines;let s={};for(let t of e.channels)switch(t.name){case"R":case"G":case"B":case"A":case"Y":s[t.name]=!0,f.type=t.pixelType}let c=!1;if(s.R&&s.G&&s.B&&s.A)f.outputChannels=4,f.decodeChannels={R:0,G:1,B:2,A:3};else if(s.R&&s.G&&s.B)c=!0,f.outputChannels=4,f.decodeChannels={R:0,G:1,B:2,A:3};else if(s.R&&s.G)f.outputChannels=2,f.decodeChannels={R:0,G:1};else if(s.R)f.outputChannels=1,f.decodeChannels={R:0};else if(s.Y)f.outputChannels=1,f.decodeChannels={Y:0};else throw Error("EXRLoader.parse: file contains unsupported data channels.");if(1===f.type)switch(u){case o.n.Float:f.getter=n.Gy,f.inputSize=a.rc;break;case o.n.HalfFloat:f.getter=n.cG,f.inputSize=a.rc}else if(2===f.type)switch(u){case o.n.Float:f.getter=n.hc,f.inputSize=a.qW;break;case o.n.HalfFloat:f.getter=n.$0,f.inputSize=a.qW}else throw Error("Unsupported pixelType "+f.type+" for "+e.compression);f.blockCount=f.height/f.scanlineBlockSize;for(let e=0;e<f.blockCount;e++)(0,n.H3)(t,r);let h=f.width*f.height*f.outputChannels;switch(u){case o.n.Float:f.byteArray=new Float32Array(h),f.textureType=1,c&&f.byteArray.fill(1,0,h);break;case o.n.HalfFloat:f.byteArray=new Uint16Array(h),f.textureType=2,c&&f.byteArray.fill(15360,0,h);break;default:throw Error("Unsupported type: "+u)}let p=0;for(let t of e.channels)void 0!==f.decodeChannels[t.name]&&(f.channelLineOffsets[t.name]=p*f.width),p+=2*t.pixelType;return f.bytesPerLine=f.width*p,f.outLineWidth=f.width*f.outputChannels,"INCREASING_Y"===e.lineOrder?f.scanOrder=e=>e:f.scanOrder=e=>f.height-1-e,4==f.outputChannels?(f.format=5,f.linearSpace=!0):(f.format=6,f.linearSpace=!1),f}function f(e,t,r,a){let i={value:0};for(let o=0;o<e.height/e.scanlineBlockSize;o++){let u=(0,n.xk)(r,a)-t.dataWindow.yMin;e.size=(0,n.vA)(r,a),e.lines=u+e.scanlineBlockSize>e.height?e.height-u:e.scanlineBlockSize;let f=e.size<e.lines*e.bytesPerLine&&e.uncompress?e.uncompress(e):(0,l.OK)(e);a.value+=e.size;for(let r=0;r<e.scanlineBlockSize;r++){let n=o*e.scanlineBlockSize,l=r+e.scanOrder(n);if(l>=e.height)continue;let a=r*e.bytesPerLine,u=(e.height-1-l)*e.outLineWidth;for(let r=0;r<e.channels;r++){let n=t.channels[r].name,l=e.channelLineOffsets[n],o=e.decodeChannels[n];if(void 0!==o){i.value=a+l;for(let t=0;t<e.width;t++){let r=u+t*e.outputChannels+o;e.byteArray&&(e.byteArray[r]=e.getter(f,i))}}}}}}},60882:function(e,t,r){r.d(t,{GS:()=>f,Ms:()=>s,OK:()=>o,Rj:()=>u,St:()=>c});var n=r(87740),l=r(37838),a=r(6132),i=r(10816);function o(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function u(e){let t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array((0,l.U)(t)),n=new Uint8Array(r.length);return(0,a.bu)(r),(0,a.Lt)(r,n),new DataView(n.buffer)}function f(e){let t=e.array.slice(e.offset.value,e.offset.value+e.size),r=fflate.unzlibSync(t),n=new Uint8Array(r.length);return(0,a.bu)(r),(0,a.Lt)(r,n),new DataView(n.buffer)}function s(e){let t=e.array.slice(e.offset.value,e.offset.value+e.size),r=fflate.unzlibSync(t),n=e.lines*e.channels*e.width,l=1==e.type?new Uint16Array(n):new Uint32Array(n),a=0,i=0,o=[,,,,];for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:o[0]=a,o[1]=o[0]+e.width,a=o[1]+e.width;for(let n=0;n<e.width;++n)t+=r[o[0]++]<<8|r[o[1]++],l[i]=t,i++;break;case 2:o[0]=a,o[1]=o[0]+e.width,o[2]=o[1]+e.width,a=o[2]+e.width;for(let n=0;n<e.width;++n)t+=r[o[0]++]<<24|r[o[1]++]<<16|r[o[2]++]<<8,l[i]=t,i++}}return new DataView(l.buffer)}function c(e){let t=e.viewer,r={value:e.offset.value},l=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),o=new Uint8Array(i.EN),u=0,f=Array(e.channels);for(let t=0;t<e.channels;t++)f[t]={},f[t].start=u,f[t].end=f[t].start,f[t].nx=e.width,f[t].ny=e.lines,f[t].size=e.type,u+=f[t].nx*f[t].ny*f[t].size;let s=(0,a.cG)(t,r),c=(0,a.cG)(t,r);if(c>=i.EN)throw Error("Wrong PIZ_COMPRESSION BITMAP_SIZE");if(s<=c)for(let e=0;e<c-s+1;e++)o[e+s]=(0,a.zJ)(t,r);let h=new Uint16Array(i.VU),p=(0,n.Aw)(o,h),w=(0,a.vA)(t,r);(0,n.o6)(e.array,t,r,w,l,u);for(let t=0;t<e.channels;++t){let e=f[t];for(let r=0;r<f[t].size;++r)(0,n.AR)(l,e.start+r,e.nx,e.size,e.ny,e.nx*e.size,p)}(0,n.pT)(h,l,u);let d=0,y=new Uint8Array(l.buffer.byteLength);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let e=f[t],r=e.nx*e.size,n=new Uint8Array(l.buffer,e.end*i.rc,r*i.rc);y.set(n,d),d+=r*i.rc,e.end+=r}return new DataView(y.buffer)}},6132:function(e,t,r){r.d(t,{$0:()=>S,Gy:()=>v,H3:()=>y,Lj:()=>a,Lt:()=>g,Vr:()=>E,_Q:()=>d,bu:()=>A,cG:()=>w,hc:()=>b,j:()=>s,vA:()=>h,xk:()=>c,zJ:()=>p});var n,l,a,i,o=r(16891),u=r(10816);(n=a||(a={}))[n.NO_COMPRESSION=0]="NO_COMPRESSION",n[n.RLE_COMPRESSION=1]="RLE_COMPRESSION",n[n.ZIPS_COMPRESSION=2]="ZIPS_COMPRESSION",n[n.ZIP_COMPRESSION=3]="ZIP_COMPRESSION",n[n.PIZ_COMPRESSION=4]="PIZ_COMPRESSION",n[n.PXR24_COMPRESSION=5]="PXR24_COMPRESSION",(l=i||(i={}))[l.INCREASING_Y=0]="INCREASING_Y",l[l.DECREASING_Y=1]="DECREASING_Y";let f=function(){let e=new ArrayBuffer(4),t=new Float32Array(e),r=new Uint32Array(e),n=new Uint32Array(512),l=new Uint32Array(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(n[e]=0,n[256|e]=32768,l[e]=24,l[256|e]=24):t<-14?(n[e]=1024>>-t-14,n[256|e]=1024>>-t-14|32768,l[e]=-t-1,l[256|e]=-t-1):t<=15?(n[e]=t+15<<10,n[256|e]=t+15<<10|32768,l[e]=13,l[256|e]=13):t<128?(n[e]=31744,n[256|e]=64512,l[e]=24,l[256|e]=24):(n[e]=31744,n[256|e]=64512,l[e]=13,l[256|e]=13)}let a=new Uint32Array(2048),i=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;(8388608&t)==0;)t<<=1,r-=8388608;t&=-8388609,r+=0x38800000,a[e]=t|r}for(let e=1024;e<2048;++e)a[e]=0x38000000+(e-1024<<13);for(let e=1;e<31;++e)i[e]=e<<23;i[31]=0x47800000,i[32]=0x80000000;for(let e=33;e<63;++e)i[e]=0x80000000+(e-32<<23);i[63]=0xc7800000;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:r,baseTable:n,shiftTable:l,mantissaTable:a,exponentTable:i,offsetTable:o}}();function s(e,t){let r=new Uint8Array(e),n=0;for(;0!=r[t.value+n];)n+=1;let l=new TextDecoder().decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,l}function c(e,t){let r=e.getInt32(t.value,!0);return t.value+=u.b7,r}function h(e,t){let r=e.getUint32(t.value,!0);return t.value+=u.b7,r}function p(e,t){let r=e.getUint8(t.value);return t.value+=u.bK,r}function w(e,t){let r=e.getUint16(t.value,!0);return t.value+=u.rc,r}function d(e,t){let r=e[t.value];return t.value+=u.bK,r}function y(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=u.C7,r}function b(e,t){let r=e.getFloat32(t.value,!0);return t.value+=u.qW,r}function v(e,t){var r=w(e,t);let n=(31744&r)>>10,l=1023&r;return(r>>15?-1:1)*(n?31===n?l?NaN:1/0:Math.pow(2,n-15)*(1+l/1024):l/1024*6103515625e-14)}function S(e,t){var r=b(e,t);if(Math.abs(r)>65504)throw Error("Value out of range.Consider using float instead of half-float.");r=(0,o.Clamp)(r,-65504,65504),f.floatView[0]=r;let n=f.uint32View[0],l=n>>23&511;return f.baseTable[l]+((8388607&n)>>f.shiftTable[l])}function E(e,t,r,n){switch(r){case"string":case"stringvector":case"iccProfile":var l=e.buffer;let a=new TextDecoder().decode(new Uint8Array(l).slice(t.value,t.value+n));return t.value=t.value+n,a;case"chlist":return function(e,t,r){let n=t.value,l=[];for(;t.value<n+r-1;){let r=s(e.buffer,t),n=c(e,t),a=p(e,t);t.value+=3;let i=c(e,t),o=c(e,t);l.push({name:r,pixelType:n,pLinear:a,xSampling:i,ySampling:o})}return t.value+=1,l}(e,t,n);case"chromaticities":return function(e,t){let r=b(e,t),n=b(e,t),l=b(e,t),a=b(e,t),i=b(e,t),o=b(e,t);return{redX:r,redY:n,greenX:l,greenY:a,blueX:i,blueY:o,whiteX:b(e,t),whiteY:b(e,t)}}(e,t);case"compression":return p(e,t);case"box2i":let o=c(e,t);return{xMin:o,yMin:c(e,t),xMax:c(e,t),yMax:c(e,t)};case"lineOrder":return i[p(e,t)];case"float":return b(e,t);case"v2f":return[b(e,t),b(e,t)];case"v3f":return[b(e,t),b(e,t),b(e,t)];case"int":return c(e,t);case"rational":return[c(e,t),h(e,t)];case"timecode":return[h(e,t),h(e,t)];case"preview":return t.value+=n,"skipped";default:t.value+=n;return}}function A(e){for(let t=1;t<e.length;t++){let r=e[t-1]+e[t]-128;e[t]=r}}function g(e,t){let r=0,n=Math.floor((e.length+1)/2),l=0,a=e.length-1;for(;!(l>a)&&(t[l++]=e[r++],!(l>a));){;t[l++]=e[n++]}}},87740:function(e,t,r){r.d(t,{AR:()=>w,Aw:()=>a,o6:()=>s,pT:()=>d});var n=r(6132),l=r(10816);function a(e,t){let r=0;for(let n=0;n<l.VU;++n)(0==n||e[n>>3]&1<<(7&n))&&(t[r++]=n);let n=r-1;for(;r<l.VU;)t[r++]=0;return n}function i(e,t,r,l,a){for(;r<e;)t=t<<8|(0,n._Q)(l,a),r+=8;return{l:t>>(r-=e)&(1<<e)-1,c:t,lc:r}}function o(e,t,r,l){return{c:e=e<<8|(0,n._Q)(r,l),lc:t+=8}}function u(e,t,r,n,l,a,i,u,f){if(e==t){if(n<8){let e=o(r,n,l,a);r=e.c,n=e.lc}let e=r>>(n-=8);if(e=new Uint8Array([e])[0],u.value+e>f)return null;let t=i[u.value-1];for(;e-- >0;)i[u.value++]=t}else{if(!(u.value<f))return null;i[u.value++]=e}return{c:r,lc:n}}let f=Array(59);function s(e,t,r,a,s,c){let h=r.value,p=(0,n.vA)(t,r),w=(0,n.vA)(t,r);r.value+=4;let d=(0,n.vA)(t,r);if(r.value+=4,p<0||p>=l.w8||w<0||w>=l.w8)throw Error("Wrong HUF_ENCSIZE");let y=Array(l.w8),b=Array(l.sd);for(let e=0;e<l.sd;e++)b[e]={},b[e].len=0,b[e].lit=0,b[e].p=null;let v=a-(r.value-h);if(!function(e,t,r,n,a,o){let u=0,s=0;for(;n<=a;n++){if(t.value-t.value>r)return;let f=i(6,u,s,e,t),c=f.l;if(u=f.c,s=f.lc,o[n]=c,c==l.nW){if(t.value-t.value>r)throw Error("Error in HufUnpackEncTable");let c=(f=i(8,u,s,e,t)).l+l.jV;if(u=f.c,s=f.lc,n+c>a+1)throw Error("Error in HufUnpackEncTable");for(;c--;)o[n++]=0;n--}else if(c>=l.Gu){let e=c-l.Gu+2;if(n+e>a+1)throw Error("Error in HufUnpackEncTable");for(;e--;)o[n++]=0;n--}}!function(e){for(let e=0;e<=58;++e)f[e]=0;for(let t=0;t<l.w8;++t)f[e[t]]+=1;let t=0;for(let e=58;e>0;--e){let r=t+f[e]>>1;f[e]=t,t=r}for(let t=0;t<l.w8;++t){let r=e[t];r>0&&(e[t]=r|f[r]++<<6)}}(o)}(e,r,v,p,w,y),d>8*(a-(r.value-h)))throw Error("Wrong hufUncompress");!function(e,t,r,n){for(;t<=r;t++){let r=e[t]>>6,a=63&e[t];if(r>>a)throw Error("Invalid table entry");if(a>l.zq){let e=n[r>>a-l.zq];if(e.len)throw Error("Invalid table entry");if(e.lit++,e.p){let t=e.p;e.p=Array(e.lit);for(let r=0;r<e.lit-1;++r)e.p[r]=t[r]}else e.p=[,];e.p[e.lit-1]=t}else if(a){let e=0;for(let i=1<<l.zq-a;i>0;i--){let i=n[(r<<l.zq-a)+e];if(i.len||i.p)throw Error("Invalid table entry");i.len=a,i.lit=t,e++}}}}(y,p,w,b),function(e,t,r,n,a,i,f,s,c){let h=0,p=0,w=Math.trunc(n.value+(a+7)/8);for(;n.value<w;){let a=o(h,p,r,n);for(h=a.c,p=a.lc;p>=l.zq;){let d=t[h>>p-l.zq&l.GX];if(d.len){p-=d.len;let e=u(d.lit,i,h,p,r,n,s,c,f);e&&(h=e.c,p=e.lc)}else{let t;if(!d.p)throw Error("hufDecode issues");for(t=0;t<d.lit;t++){let l=63&e[d.p[t]];for(;p<l&&n.value<w;)h=(a=o(h,p,r,n)).c,p=a.lc;if(p>=l&&e[d.p[t]]>>6==(h>>p-l&(1<<l)-1)){p-=l;let e=u(d.p[t],i,h,p,r,n,s,c,f);e&&(h=e.c,p=e.lc);break}}if(t==d.lit)throw Error("HufDecode issues")}}}let d=8-a&7;for(h>>=d,p-=d;p>0;){let e=t[h<<l.zq-p&l.GX];if(e.len){p-=e.len;let t=u(e.lit,i,h,p,r,n,s,c,f);t&&(h=t.c,p=t.lc)}else throw Error("HufDecode issues")}}(y,b,e,r,d,w,c,s,{value:0})}function c(e){let t=65535&e;return t>32767?t-65536:t}function h(e,t){let r=c(e),n=c(t),l=r+(1&n)+(n>>1);return{a:l,b:l-n}}function p(e,t){let r=65535&t,n=(65535&e)-(r>>1)&65535;return{a:r+n-32768&65535,b:n}}function w(e,t,r,n,l,a,i){let o,u,f=i<16384,s=r>l?l:r,c=1;for(;c<=s;)c<<=1;for(c>>=1,o=c,c>>=1;c>=1;){let i,s,w,d,y=(u=0)+a*(l-o),b=a*c,v=a*o,S=n*c,E=n*o;for(;u<=y;u+=v){let l=u,a=u+n*(r-o);for(;l<=a;l+=E){let r=l+S,n=l+b,a=n+S;if(f){let o=h(e[l+t],e[n+t]);i=o.a,w=o.b,s=(o=h(e[r+t],e[a+t])).a,d=o.b,o=h(i,s),e[l+t]=o.a,e[r+t]=o.b,o=h(w,d),e[n+t]=o.a,e[a+t]=o.b}else{let o=p(e[l+t],e[n+t]);i=o.a,w=o.b,s=(o=p(e[r+t],e[a+t])).a,d=o.b,o=p(i,s),e[l+t]=o.a,e[r+t]=o.b,o=p(w,d),e[n+t]=o.a,e[a+t]=o.b}}if(r&c){let r,n=l+b;i=(r=f?h(e[l+t],e[n+t]):p(e[l+t],e[n+t])).a,e[n+t]=r.b,e[l+t]=i}}if(l&c){let l=u,a=u+n*(r-o);for(;l<=a;l+=E){let r,n=l+S;i=(r=f?h(e[l+t],e[n+t]):p(e[l+t],e[n+t])).a,e[n+t]=r.b,e[l+t]=i}}o=c,c>>=1}return u}function d(e,t,r){for(let n=0;n<r;++n)t[n]=e[t[n]]}}}]);