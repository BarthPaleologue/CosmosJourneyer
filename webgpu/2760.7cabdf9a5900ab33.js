/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["2760"],{14221:function(e,t,n){e.exports=n.p+"2470ffe0b50b2171.webp"},14280:function(e,t,n){n.d(t,{Iu:()=>o,QB:()=>v,Sf:()=>c,Sl:()=>y,U1:()=>u,XT:()=>s,cs:()=>d,fx:()=>b,gM:()=>f,jw:()=>l,nA:()=>h,tW:()=>m});var r=n(84081),i=n(61834),a=n(42933);function o(e,t){e.setAbsolutePosition(e.getAbsolutePosition().add(t)),e.computeWorldMatrix(!0)}function s(e,t,n,r){e.rotateAround(t,n,r),e.computeWorldMatrix(!0)}function u(e,t,n){e.rotate(t,n,r.T.WORLD)}function l(e){if(null===e.rotationQuaternion)throw Error("Null quaternion for ".concat(e.name));return e.rotationQuaternion}function c(e,t){e.rotationQuaternion=t,e.computeWorldMatrix(!0)}function h(e,t){if(!t.equalsWithEpsilon(e.up,1e-7)){var n=e.up;u(e,i.P.Cross(t,n),-Math.acos(i.P.Dot(t,n)))}}function d(e){return e.getDirection(a.F.FORWARD)}function f(e){return e.getDirection(a.F.UP)}function v(e){return p(e).negate()}function p(e){return e.getDirection(a.F.LEFT)}function y(e,t){u(e,d(e),t)}function m(e,t){u(e,p(e),t)}function b(e,t){u(e,f(e),t)}},15788:function(e,t,n){e.exports=n.p+"ceb0939a515e507b.webp"},24660:function(e,t,n){n.d(t,{_T:()=>c,gr:()=>s,pl:()=>u,xM:()=>l});var r=n(16891),i=n(61834),a=n(14280);function o(e,t){var n=-1,r=t[0];if(void 0===r)throw Error("no bodieees !");var i=!0,a=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=e.subtract(l.getTransform().getAbsolutePosition()).length();(-1===n||c<n)&&(r=l,n=c)}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return r}function s(e,t,n,r){var o=e.getBoundingRadius(),s=t.length(),u=Math.max(2*o,s),l=e.getTransform().getWorldMatrix(),c=i.P.TransformCoordinates(t.scale(u/(s+1e-4)),l);r.setAbsolutePosition(c);var h=e.getTransform().absoluteRotationQuaternion,d=n.multiply(h);(0,a.Sf)(r,d)}function u(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,a=o(t.getTransform().getAbsolutePosition(),n.getStellarObjects());if(a===t)e.getTransform().setAbsolutePosition(t.getTransform().getAbsolutePosition().add(new i.P(0,.2,1).scaleInPlace(t.getBoundingRadius()*r)));else{var s=t.getTransform().getAbsolutePosition().subtract(a.getTransform().getAbsolutePosition()),u=s.length();s.scaleInPlace(1/u);var l=a.getTransform().getAbsolutePosition().add(s.scale(u-r*t.getBoundingRadius()));e.getTransform().setAbsolutePosition(l)}n.translateEverythingNow(e.getTransform().getAbsolutePosition().negate()),e.getTransform().setAbsolutePosition(i.P.Zero()),e.getTransform().lookAt(t.getTransform().getAbsolutePosition())}function l(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,s=o(t.getTransform().getAbsolutePosition(),n.getStellarObjects());if(s===t)e.getTransform().setAbsolutePosition(t.getTransform().getAbsolutePosition().add(new i.P(0,.2,1).scaleInPlace(t.getBoundingRadius()*r)));else{var u=t.getTransform().getAbsolutePosition().subtract(s.getTransform().getAbsolutePosition()),l=u.length();u.scaleInPlace(1/l);var c=(0,a.gM)(t.getTransform()),h=i.P.Cross(u,c),d=s.getTransform().getAbsolutePosition().add(u.scale(l+1.5*t.getBoundingRadius())).add(h.scale(4*t.getBoundingRadius()));e.getTransform().setAbsolutePosition(d),(0,a.XT)(e.getTransform(),t.getTransform().getAbsolutePosition(),u,-Math.PI/16)}n.translateEverythingNow(e.getTransform().getAbsolutePosition().negate()),e.getTransform().setAbsolutePosition(i.P.Zero());var f=s.getTransform().getAbsolutePosition().subtract(t.getTransform().getAbsolutePosition()).normalize(),v=t.getTransform().getAbsolutePosition().add(f.scale(4*t.getBoundingRadius()));e.getTransform().lookAt(v),e.getTransform().computeWorldMatrix(!0),(0,a.Sl)(e.getTransform(),-Math.PI/8),e.getActiveCamera().getViewMatrix(!0),e.getActiveCamera().getProjectionMatrix(!0)}function c(e,t,n){var s=e.asteroidField;if(null===s)throw Error("The body does not have an asteroid field");var u=e.getTransform().getAbsolutePosition(),l=(0,r.Lerp)(s.innerRadius,s.outerRadius,n),c=o(u,t.getStellarObjects()),h=u.subtract(c.getTransform().getAbsolutePosition()).normalize(),d=(0,a.gM)(e.getTransform()),f=i.P.Cross(h,d).normalize();return u.add(f.scale(l)).add(d.scale(s.patchThickness))}},30369:function(e,t,n){e.exports=n.p+"a818b763cab42c30.webp"},42615:function(e,t,n){e.exports=n.p+"e11ee3cdd6bf505e.webp"},4761:function(e,t,n){n.d(t,{Ae:()=>u,bM:()=>o,eU:()=>s});function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i,a,o=((i={})[i.CHARLOTTE=0]="CHARLOTTE",i),s=((a={})[a.INITIATING_PLANETARY_LANDING=0]="INITIATING_PLANETARY_LANDING",a[a.LANDING_REQUEST_GRANTED=1]="LANDING_REQUEST_GRANTED",a[a.LANDING_COMPLETE=2]="LANDING_COMPLETE",a[a.MISSION_COMPLETE=3]="MISSION_COMPLETE",a[a.NEW_DISCOVERY=4]="NEW_DISCOVERY",a[a.CANNOT_ENGAGE_WARP_DRIVE=5]="CANNOT_ENGAGE_WARP_DRIVE",a[a.WARP_DRIVE_EMERGENCY_SHUT_DOWN=6]="WARP_DRIVE_EMERGENCY_SHUT_DOWN",a[a.WARP_DRIVE_DISENGAGED=7]="WARP_DRIVE_DISENGAGED",a[a.ENGAGING_WARP_DRIVE=8]="ENGAGING_WARP_DRIVE",a[a.FUEL_SCOOPING=9]="FUEL_SCOOPING",a[a.FUEL_SCOOPING_COMPLETE=10]="FUEL_SCOOPING_COMPLETE",a),u=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");r(this,"voiceLines",void 0),r(this,"isPlaying",!1),r(this,"soundQueue",new Set),this.voiceLines=e}return e=[{key:"getLineFromVoiceLines",value:function(e,t){switch(t){case 0:return e.initiatingPlanetaryLanding;case 1:return e.landingRequestGranted;case 2:return e.landingComplete;case 3:return e.missionComplete;case 4:return e.newDiscovery;case 5:return e.cannotEngageWarpDrive;case 6:return e.warpDriveEmergencyShutDown;case 7:return e.warpDriveDisengaged;case 8:return e.engagingWarpDrive;case 9:return e.fuelScooping;case 10:return e.fuelScoopingComplete}}},{key:"getVoiceLinesFromSpeaker",value:function(e){if(0===e)return this.voiceLines.charlotte}},{key:"sayNow",value:function(e,t){this.getLineFromVoiceLines(this.getVoiceLinesFromSpeaker(e),t).play()}},{key:"enqueueSay",value:function(e,t){this.soundQueue.add(this.getLineFromVoiceLines(this.getVoiceLinesFromSpeaker(e),t))}},{key:"update",value:function(){var e=this;if(!this.isPlaying){var t=this.soundQueue.values().next().value;void 0!==t&&(this.soundQueue.delete(t),this.isPlaying=!0,t.play(),t.onEndedObservable.addOnce(function(){e.isPlaying=!1}))}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},48353:function(e,t,n){n.d(t,{Kz:()=>o,P1:()=>s,Ub:()=>u,XX:()=>a,fT:()=>i});var r=n(96509);function i(e){return e/r.JR}function a(e){return e*r.JR}function o(e){return e/r.C}function s(e){return e+273.15}function u(e){return e*r.AU}},53020:function(e,t,n){n.d(t,{n:()=>o}),n(4046);var r=n(57423);n(39596);var i=n(6562);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var o=function(e,t,n,o){var s=new r.HE(n.r,n.g,n.b,1),u=t.map(function(){return s});return(0,i.nL)(e,{points:function(e){if(Array.isArray(e))return a(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return a(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),colors:u,updatable:!1},o)}},54755:function(e,t,n){function r(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{st:()=>p,k6:()=>v,cV:()=>y});var s,u=function(){function e(t,n,i,a){r(this,e),o(this,"sound",void 0),o(this,"targetVolume",void 0),o(this,"volumeMultiplier",void 0),o(this,"playbackSpeedMultiplier",void 0),o(this,"maskFactor",1),o(this,"mask",void 0);var s=t.clone();if(null===s)throw Error("Cloned sound was null!");this.sound=s,this.mask=n,this.targetVolume=i,this.volumeMultiplier=t.getVolume(),this.playbackSpeedMultiplier=t.getPlaybackRate(),this.sound.updateOptions({playbackRate:this.playbackSpeedMultiplier,volume:this.targetVolume*this.volumeMultiplier*this.maskFactor,loop:!a})}return a(e,[{key:"play",value:function(){this.sound.play()}},{key:"setVolume",value:function(e){this.targetVolume=e,this.sound.setVolume(this.targetVolume*this.volumeMultiplier*this.maskFactor,.5)}},{key:"setMaskFactor",value:function(e){this.maskFactor=e,this.sound.setVolume(this.targetVolume*this.volumeMultiplier*this.maskFactor,.5)}},{key:"getMask",value:function(){return this.mask}},{key:"dispose",value:function(){this.sound.dispose()}}]),e}(),l=function(){function e(){r(this,e)}return a(e,[{key:"play",value:function(){}},{key:"setVolume",value:function(){}},{key:"setMaskFactor",value:function(){}},{key:"getMask",value:function(){return 0}},{key:"dispose",value:function(){}}]),e}();function c(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=((s={})[s.CLICK=0]="CLICK",s[s.HOVER=1]="HOVER",s[s.SUCCESS=2]="SUCCESS",s[s.ERROR=3]="ERROR",s[s.WARNING=4]="WARNING",s[s.INFO=5]="INFO",s[s.ENABLE_ORBIT_DISPLAY=6]="ENABLE_ORBIT_DISPLAY",s[s.DISABLE_ORBIT_DISPLAY=7]="DISABLE_ORBIT_DISPLAY",s[s.TARGET_LOCK=8]="TARGET_LOCK",s[s.TARGET_UNLOCK=9]="TARGET_UNLOCK",s[s.ITINERARY_COMPUTED=10]="ITINERARY_COMPUTED",s[s.OPEN_PAUSE_MENU=11]="OPEN_PAUSE_MENU",s[s.ENABLE_WARP_DRIVE=12]="ENABLE_WARP_DRIVE",s[s.DISABLE_WARP_DRIVE=13]="DISABLE_WARP_DRIVE",s[s.ACCELERATING_WARP_DRIVE=14]="ACCELERATING_WARP_DRIVE",s[s.DECELERATING_WARP_DRIVE=15]="DECELERATING_WARP_DRIVE",s[s.HYPER_SPACE=16]="HYPER_SPACE",s[s.THRUSTER=17]="THRUSTER",s),p=function(){function e(t){c(this,e),f(this,"sounds",void 0),f(this,"isPlaying",!1),f(this,"soundQueue",[]),f(this,"soundInstances",new Set),f(this,"soundInstanceMask",15),this.sounds=t}return d(e,[{key:"getSoundFromType",value:function(e){switch(e){case 0:case 4:case 5:return this.sounds.menuSelect;case 2:return this.sounds.success;case 3:return this.sounds.error;case 1:case 6:case 7:return this.sounds.menuHover;case 8:return this.sounds.targetLock;case 9:case 10:return this.sounds.targetUnlock;case 11:return this.sounds.openPauseMenu;case 12:return this.sounds.enableWarpDrive;case 13:return this.sounds.disableWarpDrive;case 14:return this.sounds.acceleratingWarpDrive;case 15:return this.sounds.deceleratingWarpDrive;case 16:return this.sounds.hyperSpace;case 17:return this.sounds.thruster}}},{key:"playNow",value:function(e){this.getSoundFromType(e).play()}},{key:"enqueuePlay",value:function(e){this.soundQueue.push(this.getSoundFromType(e))}},{key:"createInstance",value:function(e,t,n,r){var i=new u(this.getSoundFromType(e),t,n,r);return this.soundInstances.add(i),i.setMaskFactor(+((t&this.soundInstanceMask)!=0)),i}},{key:"freeInstance",value:function(e){this.soundInstances.delete(e),e.dispose()}},{key:"setInstanceMask",value:function(e){this.soundInstanceMask=e}},{key:"update",value:function(){var e=this,t=!0,n=!1,r=void 0;try{for(var i,a=this.soundInstances[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=(o.getMask()&this.soundInstanceMask)!=0;o.setMaskFactor(+!!s)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}if(!this.isPlaying){var u=this.soundQueue.shift();void 0!==u&&(this.isPlaying=!0,u.play(),u.onEndedObservable.addOnce(function(){e.isPlaying=!1}))}}}]),e}(),y=function(){function e(){c(this,e)}return d(e,[{key:"playNow",value:function(){}},{key:"enqueuePlay",value:function(){}},{key:"createInstance",value:function(){return new l}},{key:"freeInstance",value:function(){}},{key:"setInstanceMask",value:function(){}},{key:"update",value:function(){}}]),e}()},61012:function(e,t,n){n.d(t,{Bh:()=>H,CD:()=>Q,CW:()=>$,Cf:()=>O,IH:()=>ee,Jb:()=>ei,K4:()=>Z,LB:()=>er,Nb:()=>K,Ou:()=>L,R3:()=>Y,RZ:()=>D,Tm:()=>I,V9:()=>M,VV:()=>en,Vl:()=>q,Vz:()=>C,Wn:()=>J,Yo:()=>_,ZI:()=>U,a2:()=>j,dC:()=>W,dr:()=>eo,f:()=>x,fQ:()=>R,fv:()=>B,fz:()=>V,hi:()=>G,kE:()=>F,lp:()=>ea,lu:()=>et,xz:()=>X,zZ:()=>N});var r=n(1725),i=n(52137);n(44787);var a=n(16091),o=n(34651),s=n(28957),u=n(82263),l=n(19236),c=n(81731),h=n(4489);n(65794);var d=n(77904);n(36775);var f=n(2132);n(76320);var v=n(80836),p=n(86607),y=n(37393),m=n(56093),b=n(83612),g=n(40282),S=n(71193),w=n(4693),E=n(45906),P=n(25378),T=n(54603),A=n(59942),k=n(68099),C={VERT:A.u.Vertex,FRAG:A.u.Fragment,NEUTRAL:A.u.Neutral,VERT_AND_FRAG:A.u.VertexAndFragment};function I(e){var t,n=new l.S("cameraPosition");return n.target=null!=(t=null==e?void 0:e.target)?t:A.u.Neutral,n.setAsSystemValue(k.$.CameraPosition),n.output}function O(e){var t,n=new l.S("view");return n.target=null!=(t=null==e?void 0:e.target)?t:A.u.Neutral,n.setAsSystemValue(k.$.View),n.output}function R(e){var t,n=new l.S("ViewProjection");return n.target=null!=(t=null==e?void 0:e.target)?t:A.u.Neutral,n.setAsSystemValue(k.$.ViewProjection),n.output}function M(e){var t,n=new l.S("world");return n.target=null!=(t=null==e?void 0:e.target)?t:A.u.Neutral,n.setAsSystemValue(k.$.World),n.output}function L(e,t){var n,r=new l.S(e);return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Vertex,r.setAsAttribute(e),r.output}function V(e,t){var n,r=new l.S("float");return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,r.value=e,r.isConstant=!0,r.output}function x(e,t){return V(e,t)}function D(e,t,n){var r,i,a,s,u=new o.M("texture");return u.target=null!=(r=null==n?void 0:n.target)?r:A.u.Fragment,u.convertToGammaSpace=null!=(i=null==n?void 0:n.convertToGammaSpace)&&i,u.convertToLinearSpace=null!=(a=null==n?void 0:n.convertToLinearSpace)&&a,u.disableLevelMultiplication=null!=(s=null==n?void 0:n.disableLevelMultiplication)&&s,u.texture=e,t.connectTo(u.uv),u}function N(e,t,n){var r,i=new g.m("TransformPosition");return i.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,i.complementZ=0,i.complementW=1,t.connectTo(i.vector),e.connectTo(i.transform),i.output}function _(e,t,n){var r,i=new g.m("TransformDirection");return i.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,i.complementZ=0,i.complementW=0,t.connectTo(i.vector),e.connectTo(i.transform),i.output}function B(e,t,n){var r,a=new i.x("atan2");return a.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(a.x),t.connectTo(a.y),a.output}function F(e,t){var n,r=new c.u("length");return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.connectTo(r.value),r.output}function j(e,t,n,r,i,a){var o,s=new p.w("remap");return s.target=null!=(o=null==a?void 0:a.target)?o:A.u.Neutral,e.connectTo(s.input),t.connectTo(s.sourceMin),n.connectTo(s.sourceMax),r.connectTo(s.targetMin),i.connectTo(s.targetMax),s.output}function U(e,t){var n,r=new S.S("fract");return r.operation=S.p.Fract,r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.connectTo(r.input),r.output}function W(e,t,n){var r,i=new f.U("mul");return i.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(i.left),t.connectTo(i.right),i.output}function G(e,t,n){var r,i=new a.x("div");return i.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(i.left),t.connectTo(i.right),i.output}function z(e,t,n,r,i){var a,o=new w.t("Merge");return o.target=null!=(a=null==i?void 0:i.target)?a:A.u.Neutral,e.connectTo(o.x),t.connectTo(o.y),n&&n.connectTo(o.z),r&&r.connectTo(o.w),o}function H(e,t){var n,r=new l.S("Mesh UV scale factor");return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,r.isConstant=!0,r.value=e,r.output}function Z(e,t,n){return z(e,t,null,null,n).xyOut}function Y(e,t,n,r){return z(e,t,n,null,r).xyzOut}function q(e,t){var n,r=new E.R("split");switch(r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.type){case T.E.Float:case T.E.Int:case T.E.Matrix:case T.E.Object:case T.E.AutoDetect:case T.E.BasedOnInput:case T.E.All:throw Error("Invalid input type");case T.E.Vector2:e.connectTo(r.xyIn);break;case T.E.Vector3:case T.E.Color3:e.connectTo(r.xyzIn);break;case T.E.Vector4:case T.E.Color4:e.connectTo(r.xyzw)}return r}function X(e,t){var n,r=q(e,t),i=new w.t("OutputXZ");return i.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,r.x.connectTo(i.x),r.z.connectTo(i.y),i.xyOut}function K(e,t,n){var r,i=new m.n("step");return i.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(i.edge),t.connectTo(i.value),i.output}function $(e,t,n,r){var i,a=new y.S("smoothstep");return a.target=null!=(i=null==r?void 0:r.target)?i:A.u.Neutral,e.connectTo(a.edge0),t.connectTo(a.edge1),n.connectTo(a.value),a.output}function J(e,t){var n,r=new S.S("abs");return r.operation=S.p.Abs,r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.connectTo(r.input),r.output}function Q(e,t,n,r){var i,a=new h.J("mix");return a.target=null!=(i=null==r?void 0:r.target)?i:A.u.Neutral,e.connectTo(a.left),t.connectTo(a.right),n.connectTo(a.gradient),a.output}function ee(e,t,n){var i,a=new r.S("add");return a.target=null!=(i=null==n?void 0:n.target)?i:A.u.Neutral,e.connectTo(a.left),t.connectTo(a.right),a.output}function et(e,t,n){var r,i=new b.F("sub");return i.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(i.left),t.connectTo(i.right),i.output}function en(e,t,n){var r,i=new d.d("min");return i.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(i.left),t.connectTo(i.right),i.output}function er(e,t,n,r,i,a){var o,s=new u.h("Perturb normal");return s.target=null!=(o=null==a?void 0:a.target)?o:A.u.Fragment,e.connectTo(s.uv),t.connectTo(s.worldPosition),n.connectTo(s.worldNormal),r.connectTo(s.normalMapColor),i.connectTo(s.strength),s.output}function ei(e,t,n,r,i,a,o,s,u,l){var c,h,d,f,p=new v.M("PBRMetallicRoughness");return p.target=null!=(c=null==l?void 0:l.target)?c:A.u.Fragment,p.useEnergyConservation=null==(h=null==l?void 0:l.useEnergyConservation)||h,p.useRadianceOcclusion=null==(d=null==l?void 0:l.useRadianceOcclusion)||d,p.useHorizonOcclusion=null==(f=null==l?void 0:l.useHorizonOcclusion)||f,e.connectTo(p.baseColor),t.connectTo(p.metallic),n.connectTo(p.roughness),null==r||r.connectTo(p.ambientOcc),i.connectTo(p.perturbedNormal),a.connectTo(p.worldNormal),o.connectTo(p.view),s.connectTo(p.cameraPosition),u.connectTo(p.worldPosition),p.lighting}function ea(e,t){var n,r,i=new s.g("FragmentOutput");return i.target=A.u.Fragment,i.convertToGammaSpace=null!=(n=null==t?void 0:t.convertToGammaSpace)&&n,i.convertToLinearSpace=null!=(r=null==t?void 0:t.convertToLinearSpace)&&r,e.connectTo(i.rgb),i}function eo(e,t){var n,r=new P.t("VertexOutput");return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Vertex,e.connectTo(r.vector),r}},70104:function(e,t,n){n.d(t,{vG:()=>d});var r=n(85737),i=n(16585),a=n(76473),o=(0,i.c)(a.Z.POWER_PLAY_SEED),s=0,u=(0,r.makeNoise3D)(function(){return o(s++)}),l=(0,i.c)(a.Z.POWER_PLAY_SEED+598),c=0,h=(0,r.makeNoise3D)(function(){return l(c++)});function d(e){var t,n;return{materialistSpiritualist:(t=e.x,.5*u(.2*t,.2*e.y,.2*e.z)+.5),capitalistCommunist:(n=e.x,.5*h(.2*n,.2*e.y,.2*e.z)+.5)}}},73425:function(e,t,n){n.d(t,{d:()=>tx}),n(80781),n(10425),n(99876);var r,i=n(50558),a=n(76478),o=n(61834),s=n(70541),u=n(95603),l=n(24919),c=n(72392),h=n(91822),d=n(46526),f=n(87158),v=n(46060);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function y(e){function t(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(y=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new y(e)}function m(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}function b(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){m(a,r,i,o,s,"next",e)}function s(e){m(a,r,i,o,s,"throw",e)}o(void 0)})}}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function w(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var E=function(){var e,t;function n(e){var t,r;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");r=void 0,(t="rootHandle")in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[t]=r,this.rootHandle=e}return e=[{key:"getDirectoryHandle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return b(function(){var n,r,i,a,o,s,u,l,c,h;return w(this,function(d){switch(d.label){case 0:d.trys.push([0,9,,10]),n=e.split("/").filter(Boolean),r=this.rootHandle,i=!0,a=!1,o=void 0,d.label=1;case 1:d.trys.push([1,6,7,8]),s=n[Symbol.iterator](),d.label=2;case 2:if(i=(u=s.next()).done)return[3,5];return l=u.value,[4,r.getDirectoryHandle(l,{create:t})];case 3:r=d.sent(),d.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return c=d.sent(),a=!0,o=c,[3,8];case 7:try{i||null==s.return||s.return()}finally{if(a)throw o}return[7];case 8:return[2,r];case 9:if(S(h=d.sent(),DOMException)&&"NotFoundError"===h.name)return[2,null];throw h;case 10:return[2]}})}).call(this)}},{key:"getFileHandle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return b(function(){var n,r,i,a;return w(this,function(o){switch(o.label){case 0:if(o.trys.push([0,3,,4]),void 0===(r=(n=e.split("/").filter(Boolean)).pop()))throw Error("Invalid file path");return[4,this.getDirectoryHandle("/"+n.join("/"),t)];case 1:if(!(i=o.sent()))return[2,null];return[4,i.getFileHandle(r,{create:t})];case 2:return[2,o.sent()];case 3:if(S(a=o.sent(),DOMException)&&"NotFoundError"===a.name)return[2,null];throw a;case 4:return[2]}})}).call(this)}},{key:"createDirectory",value:function(e){return b(function(){var t;return w(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.getDirectoryHandle(e,!0)];case 1:return n.sent(),[2,!0];case 2:return t=n.sent(),console.error("Failed to create directory: ".concat(e),t),[2,!1];case 3:return[2]}})}).call(this)}},{key:"deleteDirectory",value:function(e){return b(function(){var t,n,r,i;return w(this,function(a){switch(a.label){case 0:if(a.trys.push([0,3,,4]),void 0===(n=(t=e.split("/").filter(Boolean)).pop()))return[2,!1];return[4,this.getDirectoryHandle("/"+t.join("/"))];case 1:if(!(r=a.sent()))return[2,!1];return[4,r.removeEntry(n,{recursive:!0})];case 2:return a.sent(),[2,!0];case 3:return i=a.sent(),console.error("Failed to delete directory: ".concat(e),i),[2,!1];case 4:return[2]}})}).call(this)}},{key:"listDirectory",value:function(e){return b(function(){var t,n,r,i,a,o,s,u,l,c;return w(this,function(h){switch(h.label){case 0:return h.trys.push([0,14,,15]),[4,this.getDirectoryHandle(e)];case 1:if(!(t=h.sent()))return[2,null];n=[],r=!1,i=!1,h.label=2;case 2:h.trys.push([2,7,8,13]),o=function(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new y(t.call(e));n="@@asyncIterator",r="@@iterator"}throw TypeError("Object is not async iterable")}(t.entries()),h.label=3;case 3:return[4,o.next()];case 4:var d;if(!(r=!(s=h.sent()).done))return[3,6];u=(function(e){if(Array.isArray(e))return e}(d=s.value)||function(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a=[],o=!0,s=!1;try{for(i=i.call(e);!(o=(n=i.next()).done)&&(a.push(n.value),a.length!==t);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==i.return||i.return()}finally{if(s)throw r}}return a}}(d,1)||function(e,t){if(e){if("string"==typeof e)return p(e,1);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}}(d,1)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],n.push(u),h.label=5;case 5:return r=!1,[3,3];case 6:return[3,13];case 7:return l=h.sent(),i=!0,a=l,[3,13];case 8:if(h.trys.push([8,,11,12]),!(r&&null!=o.return))return[3,10];return[4,o.return()];case 9:h.sent(),h.label=10;case 10:return[3,12];case 11:if(i)throw a;return[7];case 12:return[7];case 13:return[2,n.sort()];case 14:return c=h.sent(),console.error("Failed to list directory: ".concat(e),c),[2,null];case 15:return[2]}})}).call(this)}},{key:"directoryExists",value:function(e){return b(function(){return w(this,function(t){switch(t.label){case 0:return[4,this.getDirectoryHandle(e)];case 1:return[2,null!==t.sent()]}})}).call(this)}},{key:"writeFile",value:function(e,t){return b(function(){var n,r,i;return w(this,function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),[4,this.getFileHandle(e,!0)];case 1:if(!(n=a.sent()))return[2,!1];return[4,n.createWritable()];case 2:return[4,(r=a.sent()).write(t)];case 3:return a.sent(),[4,r.close()];case 4:return a.sent(),[2,!0];case 5:return i=a.sent(),console.error("Failed to write file: ".concat(e),i),[2,!1];case 6:return[2]}})}).call(this)}},{key:"readFile",value:function(e){return b(function(){var t,n;return w(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,this.getFileHandle(e)];case 1:if(!(t=r.sent()))return[2,null];return[4,t.getFile()];case 2:return[4,r.sent().text()];case 3:return[2,r.sent()];case 4:return n=r.sent(),console.error("Failed to read file: ".concat(e),n),[2,null];case 5:return[2]}})}).call(this)}},{key:"deleteFile",value:function(e){return b(function(){var t,n,r,i;return w(this,function(a){switch(a.label){case 0:if(a.trys.push([0,3,,4]),void 0===(n=(t=e.split("/").filter(Boolean)).pop()))return[2,!1];return[4,this.getDirectoryHandle("/"+t.join("/"))];case 1:if(!(r=a.sent()))return[2,!1];return[4,r.removeEntry(n)];case 2:return a.sent(),[2,!0];case 3:return i=a.sent(),console.error("Failed to delete file: ".concat(e),i),[2,!1];case 4:return[2]}})}).call(this)}},{key:"fileExists",value:function(e){return b(function(){return w(this,function(t){switch(t.label){case 0:return[4,this.getFileHandle(e)];case 1:return[2,null!==t.sent()]}})}).call(this)}}],t=[{key:"CreateAsync",value:function(){return b(function(){var e,t;return w(this,function(r){switch(r.label){case 0:if(!n.IsSupported())return[2,(0,d.cn)(Error("OPFS is not supported in this browser"))];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,navigator.storage.getDirectory()];case 2:return e=r.sent(),[2,(0,d.ok)(new n(e))];case 3:return console.error("Failed to create OPFSFileSystem:",t=r.sent()),[2,(0,d.cn)(t)];case 4:return[2]}})})()}},{key:"IsSupported",value:function(){return"storage"in navigator&&"getDirectory"in navigator.storage}}],e&&g(n.prototype,e),t&&g(n,t),n}(),P=n(9852),T=n(76473),A=n(89963),k=n(32133);function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function I(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}function O(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){I(a,r,i,o,s,"next",e)}function s(e){I(a,r,i,o,s,"throw",e)}o(void 0)})}}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}}function V(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var x=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");M(this,"fileSystem",void 0),M(this,"starSystemDatabase",void 0),M(this,"corruptedSaves",[]),this.fileSystem=e,this.starSystemDatabase=t}return e=[{key:"getCorruptedSaves",value:function(){var e;return function(e){if(Array.isArray(e))return C(e)}(e=this.corruptedSaves)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||L(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},{key:"loadSaveFile",value:function(e){return O(function(){var t,n,r,i,a;return V(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,5]),[4,this.fileSystem.readFile(e)];case 1:if(null===(t=o.sent()))return[2,null];if(!(n=(0,P.o)(t)))throw Error("Invalid JSON");if(!(r=(0,A.Yn)(n,this.starSystemDatabase)).success)throw Error("Save validation failed: ".concat((0,k.M)(r.error)));return[2,r.value];case 2:return i=o.sent(),[4,this.fileSystem.readFile(e)];case 3:return a=o.sent(),this.corruptedSaves.push({filePath:e,error:i,rawContent:null!=a?a:""}),console.error("Corrupted save file: ".concat(e),i),[4,this.quarantineCorruptedSave(e)];case 4:return o.sent(),[2,null];case 5:return[2]}})}).call(this)}},{key:"quarantineCorruptedSave",value:function(e){return O(function(){var t,n,r,i;return V(this,function(a){switch(a.label){case 0:return a.trys.push([0,6,,7]),[4,this.fileSystem.readFile(e)];case 1:if(null===(t=a.sent()))return[3,4];return r=(n=e.replace("/saves/","/corrupted/")).substring(0,n.lastIndexOf("/")),[4,this.fileSystem.createDirectory(r)];case 2:return a.sent(),[4,this.fileSystem.writeFile(n,t)];case 3:a.sent(),a.label=4;case 4:return[4,this.fileSystem.deleteFile(e)];case 5:return a.sent(),[3,7];case 6:return i=a.sent(),console.error("Failed to quarantine corrupted save: ".concat(e),i),[3,7];case 7:return[2]}})}).call(this)}},{key:"getSavesForCmdr",value:function(e){return O(function(){var t,r,i,a,o,s,u,l,c,h,d,f,v,p,y,m,b,g,S,w,E,P;return V(this,function(T){switch(T.label){case 0:return t="".concat(n.SAVES_DIR,"/").concat(e),[4,this.fileSystem.directoryExists(t)];case 1:if(!T.sent())return[2,void 0];return r=[],i=[],a="".concat(t,"/manual"),[4,this.fileSystem.listDirectory(a)];case 2:if(null===(o=T.sent()))return[3,10];s=!0,u=!1,l=void 0,T.label=3;case 3:T.trys.push([3,8,9,10]),c=o[Symbol.iterator](),T.label=4;case 4:if(s=(h=c.next()).done)return[3,7];return d=h.value,[4,this.loadSaveFile("".concat(a,"/").concat(d))];case 5:if(null===(f=T.sent()))return[3,6];r.push(f),T.label=6;case 6:return s=!0,[3,4];case 7:return[3,10];case 8:return v=T.sent(),u=!0,l=v,[3,10];case 9:try{s||null==c.return||c.return()}finally{if(u)throw l}return[7];case 10:return p="".concat(t,"/auto"),[4,this.fileSystem.listDirectory(p)];case 11:if(null===(y=T.sent()))return[3,19];m=!0,b=!1,g=void 0,T.label=12;case 12:T.trys.push([12,17,18,19]),S=y[Symbol.iterator](),T.label=13;case 13:if(m=(w=S.next()).done)return[3,16];return E=w.value,[4,this.loadSaveFile("".concat(p,"/").concat(E))];case 14:if(null===(P=T.sent()))return[3,15];i.push(P),T.label=15;case 15:return m=!0,[3,13];case 16:return[3,19];case 17:return v=T.sent(),b=!0,g=v,[3,19];case 18:try{m||null==S.return||S.return()}finally{if(b)throw g}return[7];case 19:return r.sort(function(e,t){return t.timestamp-e.timestamp}),i.sort(function(e,t){return t.timestamp-e.timestamp}),[2,{manual:r,auto:i}]}})}).call(this)}},{key:"deleteSaveForCmdr",value:function(e,t){return O(function(){var r,i,a;return V(this,function(o){switch(o.label){case 0:return r="".concat(n.SAVES_DIR,"/").concat(e),i="".concat(r,"/manual/").concat(t,".json"),[4,this.fileSystem.fileExists(i)];case 1:if(!o.sent())return[3,3];return[4,this.fileSystem.deleteFile(i)];case 2:case 5:return[2,o.sent()];case 3:return a="".concat(r,"/auto/").concat(t,".json"),[4,this.fileSystem.fileExists(a)];case 4:if(!o.sent())return[3,6];return[4,this.fileSystem.deleteFile(a)];case 6:return[2,!1]}})}).call(this)}},{key:"deleteCmdr",value:function(e){return O(function(){var t;return V(this,function(r){switch(r.label){case 0:return t="".concat(n.SAVES_DIR,"/").concat(e),[4,this.fileSystem.deleteDirectory(t)];case 1:return[2,r.sent()]}})}).call(this)}},{key:"getCmdrUuids",value:function(){return O(function(){var e,t;return V(this,function(r){switch(r.label){case 0:return e=n.SAVES_DIR,[4,this.fileSystem.directoryExists(e)];case 1:if(!r.sent())return[2,[]];return[4,this.fileSystem.listDirectory(e)];case 2:return[2,null!=(t=r.sent())?t:[]]}})}).call(this)}},{key:"addManualSave",value:function(e,t){return O(function(){var r,i,a;return V(this,function(o){switch(o.label){case 0:return r="".concat(n.SAVES_DIR,"/").concat(e),i="".concat(r,"/manual"),[4,this.fileSystem.createDirectory(r)];case 1:return o.sent(),[4,this.fileSystem.createDirectory(i)];case 2:return o.sent(),a="".concat(i,"/").concat(t.uuid,".json"),[4,this.fileSystem.fileExists(a)];case 3:if(o.sent())return[2,!1];return[4,this.fileSystem.writeFile(a,JSON.stringify(t))];case 4:return[2,o.sent()]}})}).call(this)}},{key:"addAutoSave",value:function(e,t){return O(function(){var r,i,a;return V(this,function(o){switch(o.label){case 0:return r="".concat(n.SAVES_DIR,"/").concat(e),i="".concat(r,"/auto"),[4,this.fileSystem.createDirectory(r)];case 1:return o.sent(),[4,this.fileSystem.createDirectory(i)];case 2:return o.sent(),a="".concat(i,"/").concat(t.uuid,".json"),[4,this.fileSystem.fileExists(a)];case 3:if(o.sent())return[2,!1];return[4,this.fileSystem.writeFile(a,JSON.stringify(t))];case 4:if(!o.sent())return[2,!1];return[4,this.cleanupAutoSaves(e)];case 5:return o.sent(),[2,!0]}})}).call(this)}},{key:"cleanupAutoSaves",value:function(e){return O(function(){var t,r,i,a,o,s,u,l,c,h,d,f;return V(this,function(v){switch(v.label){case 0:return t="".concat(n.SAVES_DIR,"/").concat(e,"/auto"),[4,this.fileSystem.listDirectory(t)];case 1:if(!(r=v.sent()))return[2];i=[],a=!0,o=!1,s=void 0,v.label=2;case 2:v.trys.push([2,7,8,9]),u=r[Symbol.iterator](),v.label=3;case 3:if(a=(l=u.next()).done)return[3,6];return c=l.value,[4,this.loadSaveFile("".concat(t,"/").concat(c))];case 4:null!==(h=v.sent())&&i.push({uuid:h.uuid,timestamp:h.timestamp}),v.label=5;case 5:return a=!0,[3,3];case 6:return[3,9];case 7:return d=v.sent(),o=!0,s=d,[3,9];case 8:try{a||null==u.return||u.return()}finally{if(o)throw s}return[7];case 9:i.sort(function(e,t){return t.timestamp-e.timestamp}),v.label=10;case 10:if(!(i.length>T.Z.MAX_AUTO_SAVES))return[3,13];if(void 0===(f=i.pop()))return[3,12];return[4,this.fileSystem.deleteFile("".concat(t,"/").concat(f.uuid,".json"))];case 11:v.sent(),v.label=12;case 12:return[3,10];case 13:return[2]}})}).call(this)}},{key:"importSaves",value:function(e){return O(function(){var t,n,r,i,a,o,s,u,l,c,h,d,f,v,p,y,m,b,g,S,w;return V(this,function(E){switch(E.label){case 0:t=[],n=!0,r=!1,i=void 0;try{for(a=Object.entries(e)[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var P;P=o.value,u=(s=function(e){if(Array.isArray(e))return e}(P)||function(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a=[],o=!0,s=!1;try{for(i=i.call(e);!(o=(n=i.next()).done)&&(a.push(n.value),a.length!==t);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==i.return||i.return()}finally{if(s)throw r}}return a}}(P,2)||L(P,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],l=s[1],c=!0,h=!1,d=void 0;try{for(f=l.manual[Symbol.iterator]();!(c=(v=f.next()).done);c=!0)p=v.value,t.push(this.addManualSave(u,p))}catch(e){h=!0,d=e}finally{try{c||null==f.return||f.return()}finally{if(h)throw d}}y=!0,m=!1,b=void 0;try{for(g=l.auto[Symbol.iterator]();!(y=(S=g.next()).done);y=!0)w=S.value,t.push(this.addAutoSave(u,w))}catch(e){m=!0,b=e}finally{try{y||null==g.return||g.return()}finally{if(m)throw b}}}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return[4,Promise.all(t)];case 1:return[2,E.sent().every(function(e){return e})]}})}).call(this)}},{key:"exportSaves",value:function(){return O(function(){var e,t,n,r,i,a,o,s,u,l;return V(this,function(c){switch(c.label){case 0:return e={},[4,this.getCmdrUuids()];case 1:t=c.sent(),n=!0,r=!1,i=void 0,c.label=2;case 2:c.trys.push([2,7,8,9]),a=t[Symbol.iterator](),c.label=3;case 3:if(n=(o=a.next()).done)return[3,6];return s=o.value,[4,this.getSavesForCmdr(s)];case 4:void 0!==(u=c.sent())&&(e[s]=u),c.label=5;case 5:return n=!0,[3,3];case 6:return[3,9];case 7:return l=c.sent(),r=!0,i=l,[3,9];case 8:try{n||null==a.return||a.return()}finally{if(r)throw i}return[7];case 9:return[2,e]}})}).call(this)}}],t=[{key:"CreateAsync",value:function(e,t){return O(function(){return V(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.createDirectory(n.SAVES_DIR)];case 1:return r.sent(),[2,(0,d.ok)(new n(e,t))];case 2:return console.error("Failed to create SaveBackendMultiFile:",r.sent()),[2,(0,d.cn)({type:k.b.INVALID_JSON})];case 3:return[2]}})})()}}],e&&R(n.prototype,e),t&&R(n,t),n}();M(x,"SAVES_DIR","/saves");var D=n(48464),N=n(37032),_=n(76103),B=n(50137),F=n(92099);function j(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var W=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");U(this,"save",void 0),U(this,"encyclopaedia",void 0),U(this,"universe",void 0),this.save=e,this.encyclopaedia=n,this.universe=r}return e=[{key:"New",value:function(){var e;return(e=function(){var e,n,r,i,a,o,s;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(u){switch(u.label){case 0:return e=new F.Z((0,_.D)()),e.registerGeneralPlugin(function(e){return(0,h.q)([e.coordinates.starSectorX,e.coordinates.starSectorY,e.coordinates.starSectorZ,e.coordinates.localX,e.coordinates.localY,e.coordinates.localZ])>.5},function(e){var t=e.stellarObjects.map(function(e){return e.id});return e.anomalies.push((0,B.C)(t)),e}),(n=new v.t).backends.push(new f.O(e)),[4,D.p.CreateAsync(new N.u(N.u.SAVES_KEY),new N.u(N.u.BACKUP_SAVE_KEY),e)];case 1:return r=u.sent(),i=void 0,[4,E.CreateAsync()];case 2:if(!(a=u.sent()).success)return[3,8];return[4,x.CreateAsync(a.value,e)];case 3:if(!(o=u.sent()).success)return[3,7];if(!r.success)return[3,6];return[4,r.value.exportSaves()];case 4:return s=u.sent(),[4,o.value.importSaves(s)];case 5:u.sent(),u.label=6;case 6:return i=o.value,[3,8];case 7:r.success&&(i=r.value),u.label=8;case 8:if(void 0===i)return[2,(0,d.cn)(Error("Failed to initialize save backend: OPFS not supported and legacy save backend failed"))];return[2,(0,d.ok)(new t(i,n,e))]}})},function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){j(a,r,i,o,s,"next",e)}function s(e){j(a,r,i,o,s,"throw",e)}o(void 0)})})()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t,e),t}(),G=n(31872),z=n(73303);n(78683),n(95698);var H=n(95212);let Z=n.p+"17af999e7b7ad57f.mp3",Y=n.p+"041ff9a253ed825d.mp3",q=n.p+"1549759e283bd206.ogg",X=n.p+"31e17b20ef567c2c.ogg",K=n.p+"39989db1f505d453.ogg",$=n.p+"d0fafb23c7d554d6.mp3",J=n.p+"e681fd4fea79fa37.ogg",Q=n.p+"2a8bc67628c05fba.ogg",ee=n.p+"1814b3aace9cf589.ogg",et=n.p+"bf4b326c5ffca2bb.mp3",en=n.p+"368a319571c58001.ogg",er=n.p+"c1c5397b26a6c809.ogg",ei=n.p+"920dd9f7b92185e2.ogg";function ea(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}let eo=n.p+"a77f60b1dade8fb8.mp3",es=n.p+"2344fdde5c5a6410.mp3",eu=n.p+"a5a4982c205e1a77.mp3",el=n.p+"452710f264d2ba19.mp3",ec=n.p+"305475735c5d3c0e.mp3",eh=n.p+"65ceacf6bbb524ce.mp3",ed=n.p+"5f6f5bf7bfca113e.mp3",ef=n.p+"4884a61f606c46b6.mp3",ev=n.p+"414af932bdf1a85c.mp3",ep=n.p+"9bbc526876e8d7f3.mp3",ey=n.p+"4c543ebfed7579a0.mp3",em=n.p+"dea0682c68132870.mp3";function eb(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}let eg=n.p+"d03a87f2075d6f53.mp3",eS=n.p+"02b9b418f00b21c6.mp3",ew=n.p+"cd82c2ed886f9749.mp3",eE=n.p+"5d862e8381583459.mp3",eP=n.p+"c83251e2246e7d88.mp3",eT=n.p+"64c7906a8f900679.mp3",eA=n.p+"2da6813008740281.mp3",ek=n.p+"b3ce59bafdbe5a25.mp3",eC=n.p+"cb1faa14ee3af51b.mp3",eI=n.p+"398d2c8156e90ba6.mp3",eO=n.p+"03f6eca0cfdf0539.mp3";function eR(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}function eM(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}var eL=n(95959);function eV(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}var ex=n(72067),eD=n(74913);function eN(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var e_=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");eN(this,"currentMusic",null),eN(this,"silenceSeconds",0),eN(this,"volume",1),eN(this,"fadeSeconds",3),eN(this,"pauseMusicWhenPaused",!1),eN(this,"starSystemView",void 0),eN(this,"musics",void 0),this.musics=e,this.starSystemView=n;var i=eD.a.audioEngine;if(null===i)throw Error("Audio context is null");i.onAudioUnlockedObservable.add(function(){if(null!==r.currentMusic){var e=r.currentMusic;r.currentMusic=null,r.setMusic(e)}})}return e=[{key:"setMusicFromSelection",value:function(e){if(!(null!==this.currentMusic&&e.includes(this.currentMusic))){var t=e[Math.floor(Math.random()*e.length)];void 0!==t&&this.setMusic(t)}}},{key:"setMusic",value:function(e){if(this.currentMusic!==e){if(null!==this.currentMusic){this.currentMusic.setVolume(0,this.fadeSeconds),this.currentMusic.stop(this.fadeSeconds),this.currentMusic=null,this.silenceSeconds=this.fadeSeconds;return}null!==e&&(this.currentMusic=e,this.currentMusic.stop(),this.currentMusic.setVolume(0),this.currentMusic.play(),this.currentMusic.setVolume(this.volume,this.fadeSeconds),console.log("currently playing",this.currentMusic.name))}}},{key:"setSoundtrackVolume",value:function(e){this.volume=e,null!==this.currentMusic&&this.currentMusic.setVolume(e)}},{key:"getVolume",value:function(){return this.volume}},{key:"update",value:function(e,t,n,r){if(null!==this.currentMusic){if(e&&this.pauseMusicWhenPaused&&this.currentMusic.isPlaying)return void this.currentMusic.pause();if(!e&&this.currentMusic.isPaused)return void this.currentMusic.play();e||this.currentMusic.isPlaying||(this.currentMusic=null,this.silenceSeconds=30+(Math.random()-.5)*20)}if(this.silenceSeconds>0){this.silenceSeconds-=r;return}if(!this.starSystemView.isLoadingSystem()){var i=this.starSystemView.getSpaceshipControls().getSpaceship(),a=this.starSystemView.scene.getActiveControls()===this.starSystemView.getCharacterControls(),s=this.starSystemView.scene.getActiveControls().getTransform().getAbsolutePosition(),u=this.starSystemView.getStarSystem().getNearestOrbitalObject(s),l=o.P.Distance(s,u.getTransform().getAbsolutePosition());if(!t||n)return void this.setMusic(this.musics.wandering);if(!i.isLanded()&&null!==i.getTargetLandingPad())return void this.setMusic(this.musics.straussBlueDanube);var c=i.getInternals().getWarpDrive();switch(u.model.type){case G.o.BLACK_HOLE:this.setMusicFromSelection([this.musics.soaring]);return;case G.o.MANDELBULB:case G.o.JULIA_SET:case G.o.MANDELBOX:case G.o.SIERPINSKI_PYRAMID:case G.o.MENGER_SPONGE:case G.o.DARK_KNIGHT:if(l<100*u.getBoundingRadius())return void this.setMusicFromSelection([this.musics.spacialWinds,this.musics.echoesOfTime]);break;case G.o.STAR:case G.o.NEUTRON_STAR:case G.o.TELLURIC_PLANET:case G.o.TELLURIC_SATELLITE:case G.o.GAS_PLANET:case G.o.CUSTOM:break;case G.o.SPACE_STATION:case G.o.SPACE_ELEVATOR:if((null===c||c.isDisabled())&&l<10*u.getBoundingRadius())return void this.setMusic(this.musics.equatorialComplex)}if(null!==c&&c.isEnabled()){var h=[this.musics.atlanteanTwilight,this.musics.infinitePerspective,this.musics.mesmerize];this.setMusicFromSelection(h);return}if(!i.isLanded()&&(null===c||c.isDisabled())){var d=[this.musics.thatZenMoment,this.musics.deepRelaxation,this.musics.peaceOfMind];this.setMusicFromSelection(d);return}if(a||i.isLanded()){var f=[this.musics.thatZenMoment,this.musics.deepRelaxation,this.musics.peaceOfMind,this.musics.mesmerize,this.musics.reawakening];this.setMusicFromSelection(f);return}this.setMusic(null)}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),eB=n(54755),eF=n(4761),ej=n(55914),eU=n(70620),eW=n(70618),eG=n(74667),ez=n(96775),eH=n(33778),eZ=n(68215),eY=n(85791),eq=n(49541),eX=n(90328),eK=n(14280),e$=n(24660),eJ=n(32075),eQ=n(15589),e0=n(59265),e1=n(43999),e2=n(2607),e4=n(58237),e3=n(52653),e5=n(58672),e6=n(11508),e7=n(12428),e8=n(94117),e9=n(94997),te=[ej.S,e9.B,e7.v,e6.m,e3.V,e5.H,e8.v],tt=n(30073),tn=n(91307);function tr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ti(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function ta(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a=[],o=!0,s=!1;try{for(i=i.call(e);!(o=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==i.return||i.return()}finally{if(s)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return tr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tr(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var to=n(86950),ts=n(24432),tu=n(16050),tl=n(31328);function tc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var th=function e(){var t=this;if(!(this instanceof e))throw TypeError("Cannot call a class as a function");tc(this,"htmlRoot",void 0),tc(this,"onTutorialSelected",new eY.y$),tc(this,"availableTutorials",void 0),this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("tutorialsMenuContainer"),this.availableTutorials=[new to.d,new tl.b,new tu.D,new ts.L],this.availableTutorials.forEach(function(e){var n=document.createElement("div");n.classList.add("tutorial");var r=document.createElement("h2");r.textContent=e.getTitle(),n.appendChild(r);var i=document.createElement("img");i.src=e.coverImageSrc,i.alt=e.getTitle(),n.appendChild(i);var a=document.createElement("p");a.textContent=e.getDescription(),n.appendChild(a),t.htmlRoot.appendChild(n),n.addEventListener("click",function(){t.onTutorialSelected.notifyObservers(e)})});var n=document.createElement("p");n.classList.add("moreWillCome"),n.textContent=eJ.Z.t("tutorials:common:moreWillComeSoon"),this.htmlRoot.appendChild(n)};function td(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}function tf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tv=((r={})[r.LOAD_SAVE=0]="LOAD_SAVE",r[r.SETTINGS=1]="SETTINGS",r[r.TUTORIALS=2]="TUTORIALS",r[r.CONTRIBUTE=3]="CONTRIBUTE",r[r.CREDITS=4]="CREDITS",r[r.ABOUT=5]="ABOUT",r),tp=function(){var e;function t(e,n,r,i){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");tf(this,"activeRightPanel",null),tf(this,"loadSavePanel",void 0),tf(this,"loadSavePanelContent",void 0),tf(this,"settingsPanel",void 0),tf(this,"tutorialsPanel",void 0),tf(this,"tutorialsPanelContent",void 0),tf(this,"contributePanel",void 0),tf(this,"creditsPanel",void 0),tf(this,"aboutPanel",void 0),tf(this,"starSystemDatabase",void 0),tf(this,"saveBackend",void 0),this.starSystemDatabase=e,this.saveBackend=n;var a=document.getElementById("loadSavePanel");if(null===a)throw Error("#loadSavePanel does not exist!");this.loadSavePanel=a,this.attachCloseButton(this.loadSavePanel),this.loadSavePanelContent=new e0.W(e,r),this.loadSavePanel.appendChild(this.loadSavePanelContent.htmlRoot),this.settingsPanel=function(e){var t=document.getElementById("settingsPanel");if(null===t)throw Error("#settings does not exist!");var n=document.createElement("div");n.classList.add("settings-section");var r=document.createElement("h3");r.textContent=eJ.Z.t("sidePanel:audioSettings"),r.style.fontFamily="Nasalization, sans-serif",n.appendChild(r);var i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.gap="10px",i.style.fontFamily="Nasalization, sans-serif";var a=document.createElement("label");a.textContent=eJ.Z.t("sidePanel:musicVolume"),a.style.fontFamily="Nasalization, sans-serif",a.style.minWidth="80px",a.style.flexGrow="1",a.style.color="#fff",a.style.fontWeight="bold",a.style.letterSpacing="1px",a.style.fontSize="1.1em",i.appendChild(a);var o=document.createElement("input");o.type="range",o.min="0",o.max="1",o.step="0.05",o.value=e.getVolume().toString(),o.style.margin="0 10px",o.style.accentColor="#ffffff";var s=document.createElement("span");return s.textContent=(100*parseFloat(o.value)).toFixed(0)+"%",s.style.fontFamily="Nasalization, sans-serif",s.style.color="#fff",s.style.backgroundColor="#1a1a1a",s.style.padding="2px 8px",s.style.borderRadius="4px",s.style.fontWeight="bold",s.style.fontSize="1em",s.style.marginLeft="4px",s.style.minWidth="50px",s.style.textAlign="center",o.addEventListener("input",function(){var t=parseFloat(o.value);s.textContent=(100*t).toFixed(0)+"%",e.setSoundtrackVolume(t)}),i.appendChild(o),i.appendChild(s),n.appendChild(i),t.appendChild(n),(0,tt.x)().then(function(e){te.forEach(function(n){var r=document.createElement("div");r.classList.add("map");var i=document.createElement("h3");i.textContent=n.name.replace(/([A-Z])/g," $1").trim(),r.appendChild(i);var a=!0,o=!1,s=void 0;try{for(var u,l=Object.entries(n.map)[Symbol.iterator]();!(a=(u=l.next()).done);a=!0)!function(){var t=ta(u.value,2),n=t[0],i=t[1],a=new Map;(ti(i,e1.Z)?i.bindings:i.action.bindings).forEach(function(t){if(ti(t.control,e4.Z))(0,tn.cs)(t.control,e).forEach(function(e){var t,n=ta(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else if(ti(t.control,e2.N3)){var n,r=(0,tn.x_)(t.control,e);a.has("BUTTON")||a.set("BUTTON",[]),null==(n=a.get("BUTTON"))||n.push(r)}else if(ti(t.control,e2.LV))(0,tn.C9)(t.control,e).forEach(function(e){var t,n=ta(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else if(ti(t.control,e2.Z9))(0,tn.JT)(t.control).forEach(function(e){var t,n=ta(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else if(ti(t.control,e2.xE))(0,tn.gG)().forEach(function(e){var t,n=ta(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else throw Error("Unknown control type")});var o=document.createElement("div"),s=document.createElement("p");if(s.textContent=n.replace(/([A-Z])/g," $1").trim(),o.appendChild(s),1===a.size){o.classList.add("actionSingle");var l=document.createElement("div");l.classList.add("valuesContainer");var c=!0,h=!1,d=void 0;try{for(var f,v=a.values()[Symbol.iterator]();!(c=(f=v.next()).done);c=!0)f.value.forEach(function(e){var t=document.createElement("p");t.innerText=e,l.appendChild(t)})}catch(e){h=!0,d=e}finally{try{c||null==v.return||v.return()}finally{if(h)throw d}}o.appendChild(l)}else o.classList.add("actionMultiple"),a.forEach(function(e,t){var n=document.createElement("div");n.classList.add("subAction");var r=document.createElement("p");r.textContent=t;var i=document.createElement("div");i.classList.add("valuesContainer"),e.forEach(function(e){var t=document.createElement("p");t.innerText=e,i.appendChild(t)}),n.appendChild(r),n.appendChild(i),o.appendChild(n)});r.appendChild(o)}()}catch(e){o=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}t.appendChild(r)})}),t}(i),this.attachCloseButton(this.settingsPanel);var o=document.getElementById("tutorials");if(null===o)throw Error("#tutorials does not exist!");this.tutorialsPanel=o,this.attachCloseButton(this.tutorialsPanel),this.tutorialsPanelContent=new th,this.tutorialsPanel.appendChild(this.tutorialsPanelContent.htmlRoot);var s=document.getElementById("contribute");if(null===s)throw Error("#contribute does not exist!");this.contributePanel=s,this.attachCloseButton(this.contributePanel);var u=document.getElementById("credits");if(null===u)throw Error("#credits does not exist!");this.creditsPanel=u,this.attachCloseButton(this.creditsPanel);var l=document.getElementById("about");if(null===l)throw Error("#about does not exist!");this.aboutPanel=l,this.attachCloseButton(this.aboutPanel)}return e=[{key:"panelFromType",value:function(e){var t=null;switch(e){case 0:t=this.loadSavePanel;break;case 1:t=this.settingsPanel;break;case 2:t=this.tutorialsPanel;break;case 3:t=this.contributePanel;break;case 4:t=this.creditsPanel;break;case 5:t=this.aboutPanel}return t}},{key:"attachCloseButton",value:function(e){var t=this;if(!e.querySelector(".close-button")){var n=document.createElement("button");n.innerText="X",n.className="close-button",n.addEventListener("click",function(){t.hideActivePanel()}),e.appendChild(n)}}},{key:"toggleActivePanel",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(n){switch(n.label){case 0:if(t=this.panelFromType(e),this.activeRightPanel===t)return[2];if(0!==e)return[3,2];return[4,this.loadSavePanelContent.populateCmdrList(this.starSystemDatabase,this.saveBackend)];case 1:n.sent(),n.label=2;case 2:return null!==this.activeRightPanel&&this.hideActivePanel(),this.activeRightPanel=t,t.classList.add("visible"),[2]}})},function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(e){td(a,r,i,o,s,"next",e)}function s(e){td(a,r,i,o,s,"throw",e)}o(void 0)})}).call(this)}},{key:"hideActivePanel",value:function(){null!==this.activeRightPanel&&(this.activeRightPanel.classList.remove("visible"),this.activeRightPanel=null)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function ty(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}function tm(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){ty(a,r,i,o,s,"next",e)}function s(e){ty(a,r,i,o,s,"throw",e)}o(void 0)})}}function tb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tg(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var tS=function(){var e;function t(e,n,r,i){var a=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");tb(this,"scene",void 0),tb(this,"controls",void 0),tb(this,"starSystemView",void 0),tb(this,"starSystemModel",void 0),tb(this,"onStartObservable",new eY.y$),tb(this,"onContributeObservable",new eY.y$),tb(this,"onCreditsObservable",new eY.y$),tb(this,"onAboutObservable",new eY.y$),tb(this,"htmlRoot",void 0),tb(this,"title",void 0),tb(this,"version",void 0),tb(this,"sidePanels",void 0),tb(this,"universeObjectId",void 0),tb(this,"startAnimationDurationSeconds",5),this.sidePanels=e,this.starSystemView=n,this.scene=this.starSystemView.scene,this.controls=this.starSystemView.getDefaultControls(),this.starSystemView.setUIEnabled(!1);var o=r.getSystemModelFromCoordinates({localX:.49137314641446483,localY:.48043087077347135,localZ:.38353311777279386,starSectorX:0,starSectorY:0,starSectorZ:0});if(null===o)throw Error("Cannot find system");var s=o.planets.at(1);if(void 0===s)throw Error("Cannot find planet with index 2");this.universeObjectId=(0,z.D2)(s,o),this.starSystemModel=o;var u=document.getElementById("mainMenu");if(null===u)throw Error("#mainMenu does not exist!");this.htmlRoot=u,this.htmlRoot.style.display="none";var l=document.querySelector("#mainMenu h1");if(null===l)throw Error("#mainMenu h1 does not exist!");this.title=l;var c=document.getElementById("version");if(null===c)throw Error("#version does not exist!");var h=c.querySelector("a");if(null===h)throw Error("version link does not exist!");h.textContent="Alpha ".concat(eQ.i8),this.version=c,document.querySelectorAll("#menuItems li").forEach(function(e){e.addEventListener("mouseenter",function(){i.playNow(eB.k6.HOVER)}),e.addEventListener("click",function(){i.playNow(eB.k6.CLICK)})}),document.querySelectorAll("#mainMenu *[data-i18n]").forEach(function(e){var t=e.getAttribute("data-i18n");if(null===t)throw Error("data-i18n attribute is null");e.textContent=eJ.Z.t(t)});var d=document.getElementById("startButton");if(null===d)throw Error("#startButton does not exist!");d.addEventListener("click",function(){a.startAnimation(function(){return a.onStartObservable.notifyObservers()})});var f=document.getElementById("loadSaveButton");if(null===f)throw Error("#loadSaveButton does not exist!");f.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.LOAD_SAVE)];case 1:return e.sent(),[2]}})}).call(a)}),this.sidePanels.loadSavePanelContent.onLoadSaveObservable.add(function(){a.hide()});var v=document.getElementById("settingsButton");if(null===v)throw Error("#settingsButton does not exist!");v.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.SETTINGS)];case 1:return e.sent(),[2]}})}).call(a)});var p=document.getElementById("tutorialsButton");if(null===p)throw Error("#tutorialsButton does not exist!");p.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.TUTORIALS)];case 1:return e.sent(),[2]}})}).call(a)});var y=document.getElementById("contributeButton");if(null===y)throw Error("#contributeButton does not exist!");y.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.CONTRIBUTE)];case 1:return e.sent(),this.onContributeObservable.notifyObservers(),[2]}})}).call(a)});var m=document.getElementById("creditsButton");if(null===m)throw Error("#creditsButton does not exist!");m.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.CREDITS)];case 1:return e.sent(),this.onCreditsObservable.notifyObservers(),[2]}})}).call(a)});var b=document.getElementById("aboutButton");if(null===b)throw Error("#aboutButton does not exist!");b.addEventListener("click",function(){return tm(function(){return tg(this,function(e){switch(e.label){case 0:return[4,this.sidePanels.toggleActivePanel(tv.ABOUT)];case 1:return e.sent(),this.onAboutObservable.notifyObservers(),[2]}})}).call(a)})}return e=[{key:"init",value:function(){return tm(function(){var e;return tg(this,function(t){switch(t.label){case 0:return e=this,[4,this.starSystemView.loadStarSystem(this.starSystemModel)];case 1:return t.sent(),this.starSystemView.onInitStarSystem.addOnce(function(){return tm(function(){var e,t;return tg(this,function(n){switch(n.label){case 0:return[4,this.starSystemView.switchToDefaultControls(!1)];case 1:if(n.sent(),e=this.starSystemModel.stellarObjects[0].type===G.o.BLACK_HOLE?8:2,void 0===(t=this.starSystemView.getStarSystem().getOrbitalObjectById(this.universeObjectId.idInSystem)))throw Error("Could not find object with ID ".concat(JSON.stringify(this.universeObjectId)));return(0,e$.xM)(this.controls,t,this.starSystemView.getStarSystem(),e),[2]}})}).call(e)}),this.starSystemView.targetCursorLayer.setEnabled(!1),this.htmlRoot.style.display="block",[2]}})}).call(this)}},{key:"startAnimation",value:function(e){var t=this;this.sidePanels.hideActivePanel();var n=this.starSystemView.getStarSystem(),r=(0,eK.cs)(this.controls.getTransform()),i=n.getOrbitalObjectById(this.universeObjectId.idInSystem),a=n.getCelestialBodies().find(function(e){return e===i});if(void 0===a)throw Error("No corresponding celestial body found");var s=a.getTransform().getAbsolutePosition().subtract(this.controls.getTransform().getAbsolutePosition()).normalize(),u=o.P.Cross(r,s),l=o.P.GetAngleBetweenVectors(r,s,u),c=(0,e$._T)(a,n,.9),h=new eq._(this.controls.getTransform(),u,l,this.startAnimationDurationSeconds),d=new eX.J(this.controls.getTransform(),c,this.startAnimationDurationSeconds);this.title.animate([{marginTop:this.title.style.marginTop,opacity:1},{marginTop:"30vh",opacity:0}],{duration:1e3*this.startAnimationDurationSeconds,easing:"ease-in-out",fill:"forwards"});var f=function(){var r=t.scene.getEngine().getDeltaTime()/1e3;if(d.isFinished()||d.update(r),h.isFinished()){t.scene.onBeforePhysicsObservable.removeCallback(f),t.htmlRoot.style.display="none",t.starSystemView.setUIEnabled(!0),e();return}h.update(r),t.controls.getActiveCamera().getViewMatrix(),n.applyFloatingOrigin(),t.starSystemView.postProcessManager.update(0),n.updateShaders(0)};this.scene.onBeforePhysicsObservable.add(f),this.hideMenu(),this.hideVersion()}},{key:"hideVersion",value:function(){this.version.style.transform="translateY(100%)"}},{key:"hideMenu",value:function(){var e=document.getElementById("menuItems");if(null===e)throw Error("#menuItems does not exist!");e.style.left="-20%"}},{key:"hide",value:function(){this.hideVersion(),this.hideMenu(),this.sidePanels.hideActivePanel(),this.htmlRoot.style.display="none"}},{key:"isVisible",value:function(){return"none"!==this.htmlRoot.style.display}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),tw=n(62341);function tE(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}function tP(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){tE(a,r,i,o,s,"next",e)}function s(e){tE(a,r,i,o,s,"throw",e)}o(void 0)})}}function tT(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tA(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var tk=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");tT(this,"rootNode",void 0),tT(this,"mask",void 0),tT(this,"screenshotButton",void 0),tT(this,"shareButton",void 0),tT(this,"contributeButton",void 0),tT(this,"tutorialsButton",void 0),tT(this,"settingsButton",void 0),tT(this,"loadButton",void 0),tT(this,"saveButton",void 0),tT(this,"resumeButton",void 0),tT(this,"sidePanels",void 0),tT(this,"onScreenshot",new eY.y$),tT(this,"onShare",new eY.y$),tT(this,"onSave",new eY.y$),tT(this,"onResume",new eY.y$),this.sidePanels=e,this.mask=document.createElement("div"),this.mask.id="pauseMask",this.rootNode=document.createElement("ul"),this.rootNode.id="pauseMenu",this.rootNode.classList.add("leftSideMenu");var i=function(e,t){var n=document.createElement("li");return n.id=e,n.classList.add("button"),n.innerText=eJ.Z.t(t),r.rootNode.appendChild(n),n};this.resumeButton=i("resumeButton","pauseMenu:resume"),this.saveButton=i("saveButton","pauseMenu:save"),this.loadButton=i("loadButton","pauseMenu:load"),this.tutorialsButton=i("pauseTutorialsButton","pauseMenu:tutorials"),this.settingsButton=i("pauseSettingsButton","pauseMenu:settings"),this.contributeButton=i("pauseContributeButton","pauseMenu:contribute"),this.screenshotButton=i("screenshotButton","pauseMenu:screenshot"),this.shareButton=i("shareButton","pauseMenu:share"),this.mask.appendChild(this.rootNode),document.body.appendChild(this.mask),this.screenshotButton.addEventListener("click",function(){return r.onScreenshot.notifyObservers()}),this.shareButton.addEventListener("click",function(){return r.onShare.notifyObservers()}),this.contributeButton.addEventListener("click",function(){return tP(function(){return tA(this,function(e){switch(e.label){case 0:return n.playNow(eB.k6.CLICK),[4,this.sidePanels.toggleActivePanel(tv.CONTRIBUTE)];case 1:return e.sent(),[2]}})}).call(r)}),this.tutorialsButton.addEventListener("click",function(){return tP(function(){return tA(this,function(e){switch(e.label){case 0:return n.playNow(eB.k6.CLICK),[4,this.sidePanels.toggleActivePanel(tv.TUTORIALS)];case 1:return e.sent(),[2]}})}).call(r)}),this.settingsButton.addEventListener("click",function(){return tP(function(){return tA(this,function(e){switch(e.label){case 0:return n.playNow(eB.k6.CLICK),[4,this.sidePanels.toggleActivePanel(tv.SETTINGS)];case 1:return e.sent(),[2]}})}).call(r)}),this.loadButton.addEventListener("click",function(){return tP(function(){return tA(this,function(e){switch(e.label){case 0:return n.playNow(eB.k6.CLICK),[4,this.sidePanels.toggleActivePanel(tv.LOAD_SAVE)];case 1:return e.sent(),[2]}})}).call(r)}),this.saveButton.addEventListener("click",function(){return r.onSave.notifyObservers()}),this.resumeButton.addEventListener("click",function(){return r.onResume.notifyObservers()}),this.rootNode.querySelectorAll("li").forEach(function(e){e.addEventListener("mouseenter",function(){n.playNow(eB.k6.HOVER)}),e.addEventListener("click",function(){n.playNow(eB.k6.CLICK)})}),this.setVisibility(!1)}return e=[{key:"setVisibility",value:function(e){this.rootNode.style.display=e?"grid":"none",this.mask.style.display=e?"block":"none",e||this.sidePanels.hideActivePanel()}},{key:"isVisible",value:function(){return"none"!==this.rootNode.style.display}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),tC=n(19577),tI=n(80929);function tO(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(r,i)}function tR(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){tO(a,r,i,o,s,"next",e)}function s(e){tO(a,r,i,o,s,"throw",e)}o(void 0)})}}function tM(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tL(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tV(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var tx=function(){var e,t;function r(e,t,n,i,a,s,u){var l=this;if(!(this instanceof r))throw TypeError("Cannot call a class as a function");tL(this,"engine",void 0),tL(this,"assets",void 0),tL(this,"starSystemView",void 0),tL(this,"starMap",void 0),tL(this,"musicConductor",void 0),tL(this,"soundPlayer",void 0),tL(this,"tts",void 0),tL(this,"mainMenu",void 0),tL(this,"pauseMenu",void 0),tL(this,"sidePanels",void 0),tL(this,"tutorialLayer",void 0),tL(this,"activeView",void 0),tL(this,"state",0),tL(this,"videoRecorder",null),tL(this,"player",void 0),tL(this,"backend",void 0),tL(this,"elapsedSeconds",0),tL(this,"autoSavePeriodSeconds",300),tL(this,"autoSaveTimerSeconds",0),tL(this,"isAutoSaveEnabled",!0),this.engine=t,this.assets=n,this.player=e,this.player.onNameChangedObservable.add(function(){return tR(function(){return tV(this,function(e){switch(e.label){case 0:return[4,this.createManualSave()];case 1:return e.sent(),[2]}})}).call(l)}),this.backend=a,this.player.discoveries.uploaded.forEach(function(e){return tR(function(){return tV(this,function(t){switch(t.label){case 0:return[4,this.backend.encyclopaedia.contributeDiscoveryIfNew(e)];case 1:return t.sent(),[2]}})}).call(l)}),this.starSystemView=i,this.starSystemView.onBeforeJump.add(function(){return tR(function(){return tV(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(l)}),this.starSystemView.onAfterJump.add(function(){return tR(function(){var e;return tV(this,function(t){switch(t.label){case 0:return e=this,[4,this.createAutoSave()];case 1:if(t.sent(),this.player.tutorials.fuelScoopingCompleted)return[3,3];return[4,this.tutorialLayer.setTutorial(new ts.L)];case 2:t.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.fuelScoopingCompleted=!0}),t.label=3;case 3:return[2]}})}).call(l)}),this.starSystemView.onNewDiscovery.add(function(){return tR(function(){return tV(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(l)}),this.musicConductor=new e_(this.assets.audio.musics,this.starSystemView),this.soundPlayer=s,this.tts=u,this.starMap=new eW.s(this.player,this.engine,this.backend.encyclopaedia,this.backend.universe,this.soundPlayer),this.starMap.onTargetSetObservable.add(function(e){l.starSystemView.setSystemAsTarget(e)}),this.starMap.detachControl(),this.starSystemView.attachControl(),this.activeView=this.starSystemView,s.setInstanceMask(ex.S.STAR_SYSTEM_VIEW),this.tutorialLayer=new tC.b(this.soundPlayer),document.body.appendChild(this.tutorialLayer.root),this.sidePanels=new tp(this.backend.universe,this.backend.save,this.soundPlayer,this.musicConductor),this.sidePanels.loadSavePanelContent.onLoadSaveObservable.add(function(e){t.onEndFrameObservable.addOnce(function(){return tR(function(){return tV(this,function(t){switch(t.label){case 0:if(!this.isPaused())return[3,2];return[4,this.createAutoSave()];case 1:t.sent(),t.label=2;case 2:return[4,this.resume()];case 3:return t.sent(),this.starSystemView.setUIEnabled(!0),[4,this.loadSave(e)];case 4:return t.sent(),[2]}})}).call(l)})}),this.mainMenu=new tS(this.sidePanels,this.starSystemView,this.backend.universe,this.soundPlayer),this.mainMenu.onStartObservable.add(function(){return tR(function(){var e,t,n;return tV(this,function(r){switch(r.label){case 0:return e=this,[4,this.tutorialLayer.setTutorial(new to.d)];case 1:return r.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.flightCompleted=!0}),[4,this.starSystemView.switchToSpaceshipControls()];case 2:return r.sent(),t=this.starSystemView.getSpaceshipControls().getTransform().getAbsolutePosition(),n=this.starSystemView.getStarSystem().getOrbitalFacilities().reduce(function(e,n){return o.P.DistanceSquared(t,n.getTransform().getAbsolutePosition())<o.P.DistanceSquared(t,e.getTransform().getAbsolutePosition())?n:e}),this.starSystemView.setTarget(n),[4,this.createAutoSave()];case 3:return r.sent(),[2]}})}).call(l)}),this.sidePanels.tutorialsPanelContent.onTutorialSelected.add(function(e){return tR(function(){return tV(this,function(t){switch(t.label){case 0:if(this.mainMenu.isVisible())return[3,3];return[4,this.createAutoSave()];case 1:return t.sent(),[4,(0,eZ.bG)(eJ.Z.t("tutorials:common:loadTutorialWillLeaveGame"),this.soundPlayer)];case 2:if(!t.sent())return[2];t.label=3;case 3:return this.sidePanels.hideActivePanel(),this.loadTutorial(e),[2]}})}).call(l)}),this.starSystemView.getSpaceshipControls().onToggleWarpDrive.add(function(e){return tR(function(){var t,n,r,i,a,s;return tV(this,function(u){switch(u.label){case 0:if(t=this,e||this.player.tutorials.stationLandingCompleted||null===(r=(n=this.starSystemView.getSpaceshipControls()).getClosestLandableFacility())||(i=n.getTransform().getAbsolutePosition(),a=r.getTransform().position,s=10*r.getBoundingRadius(),o.P.DistanceSquared(i,a)>Math.pow(s,2)))return[2];return[4,this.tutorialLayer.setTutorial(new tl.b)];case 1:return u.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){t.player.tutorials.stationLandingCompleted=!0}),[2]}})}).call(l)}),this.starSystemView.getSpaceshipControls().onCompleteLanding.add(function(){return tR(function(){return tV(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(l)}),this.starSystemView.onInitStarSystem.add(function(){var e=l.starSystemView.getStarSystem().model;l.starMap.setCurrentStarSystem(e.coordinates)}),this.starSystemView.spaceStationLayer.onTakeOffObservable.add(function(){return tR(function(){var e;return tV(this,function(t){switch(t.label){case 0:if(e=this,this.player.tutorials.starMapCompleted)return[2];return[4,this.tutorialLayer.setTutorial(new tu.D)];case 1:return t.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.starMapCompleted=!0}),[2]}})}).call(l)}),this.pauseMenu=new tk(this.sidePanels,this.soundPlayer),this.pauseMenu.onResume.add(function(){return l.resume()}),this.pauseMenu.onScreenshot.add(function(){return l.takeScreenshot()}),this.pauseMenu.onShare.add(function(){l.engine.onEndFrameObservable.addOnce(function(){return tR(function(){var e,t,n;return tV(this,function(r){switch(r.label){case 0:return e=this,[4,this.generateSaveData()];case 1:if((t=r.sent()).player.uuid=T.Z.SHARED_POSITION_SAVE_UUID,null!==(n=(0,A.z0)(t)))return[3,3];return[4,(0,eZ.UX)("Could not create a shareable link.",this.soundPlayer)];case 2:case 4:return r.sent(),[2];case 3:return[4,navigator.clipboard.writeText(n.toString()).then(function(){(0,tw.sc)(tw.OO.GENERAL,tw.sh.INFO,eJ.Z.t("notifications:copiedToClipboard"),2e3,e.soundPlayer)})]}})}).call(l)})}),this.pauseMenu.onSave.add(function(){return tR(function(){return tV(this,function(e){switch(e.label){case 0:return[4,this.createManualSave()];case 1:return e.sent()?(0,tw.sc)(tw.OO.GENERAL,tw.sh.SUCCESS,eJ.Z.t("notifications:saveOk"),2e3,this.soundPlayer):(0,tw.sc)(tw.OO.GENERAL,tw.sh.ERROR,eJ.Z.t("notifications:cantSaveTutorial"),2e3,this.soundPlayer),[2]}})}).call(l)}),window.addEventListener("blur",function(){l.mainMenu.isVisible()||l.starSystemView.isLoadingSystem()||l.pause()}),window.addEventListener("mouseleave",function(){l.mainMenu.isVisible()||l.starSystemView.isLoadingSystem()||l.pause()}),window.addEventListener("resize",function(){l.engine.resize(!0)}),window.addEventListener("beforeunload",function(){return tR(function(){return tV(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(l)}),ej.S.map.toggleStarMap.on("complete",function(){return tR(function(){return tV(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.toggleStarMap()];case 1:return e.sent(),[2]}})}).call(l)}),ej.S.map.screenshot.on("complete",function(){return tR(function(){return tV(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.takeScreenshot()];case 1:return e.sent(),[2]}})}).call(l)}),ej.S.map.videoCapture.on("complete",function(){return tR(function(){return tV(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.takeVideoCapture()];case 1:return e.sent(),[2]}})}).call(l)}),ej.S.map.togglePause.on("complete",function(){!l.mainMenu.isVisible()&&(l.isPaused()||l.pause())}),window.CosmosJourneyer=this}return e=[{key:"pause",value:function(){!this.isPaused()&&(this.mainMenu.isVisible()||(this.state=2,document.exitPointerLock(),this.activeView===this.starSystemView&&this.starSystemView.stopBackgroundSounds(),this.soundPlayer.playNow(eB.k6.OPEN_PAUSE_MENU),this.pauseMenu.setVisibility(!0)))}},{key:"resume",value:function(){return tR(function(){var e;return tV(this,function(t){switch(t.label){case 0:if(!this.isPaused())return[2];if(this.state=1,this.soundPlayer.playNow(eB.k6.CLICK),this.pauseMenu.setVisibility(!1),!(this.activeView===this.starSystemView&&this.starSystemView.scene.getActiveControls().shouldLockPointer()))return[3,2];return[4,null==(e=this.engine.getRenderingCanvas())?void 0:e.requestPointerLock()];case 1:t.sent(),t.label=2;case 2:return[2]}})}).call(this)}},{key:"isPaused",value:function(){return 2===this.state}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return tR(function(){var t;return tV(this,function(n){switch(n.label){case 0:if(t=this,e)return[3,2];return[4,this.mainMenu.init()];case 1:n.sent(),n.label=2;case 2:return this.starSystemView.initStarSystem(),this.engine.runRenderLoop(function(){var e=t.engine.getDeltaTime()/1e3;t.elapsedSeconds+=e,t.player.timePlayedSeconds+=e,t.autoSaveTimerSeconds+=e,t.autoSaveTimerSeconds>=t.autoSavePeriodSeconds&&(t.autoSaveTimerSeconds%=t.autoSavePeriodSeconds,t.mainMenu.isVisible()||t.starSystemView.isJumpingBetweenSystems()||t.createAutoSave()),(0,tw.BX)(e),t.musicConductor.update(t.isPaused(),t.activeView===t.starSystemView,t.mainMenu.isVisible(),e),t.soundPlayer.update(),t.tts.update(),t.isPaused()||t.activeView.render()}),this.state=1,[2]}})}).call(this)}},{key:"toggleStarMap",value:function(){return tR(function(){var e,t;return tV(this,function(n){switch(n.label){case 0:if(this.activeView!==this.starSystemView)return[3,1];return this.soundPlayer.setInstanceMask(ex.S.STAR_MAP_VIEW),this.starSystemView.targetCursorLayer.setEnabled(!1),document.exitPointerLock(),this.starSystemView.detachControl(),this.starMap.attachControl(),e=this.starMap,this.activeView=e,e.focusOnCurrentSystem(),[3,3];case 1:if(this.starMap.detachControl(),this.starSystemView.attachControl(),this.soundPlayer.setInstanceMask(ex.S.STAR_SYSTEM_VIEW),this.activeView=this.starSystemView,!this.starSystemView.scene.getActiveControls().shouldLockPointer())return[3,3];return[4,null==(t=this.engine.getRenderingCanvas())?void 0:t.requestPointerLock()];case 2:n.sent(),n.label=3;case 3:return[2]}})}).call(this)}},{key:"takeScreenshot",value:function(){return tR(function(){var e;return tV(this,function(t){switch(t.label){case 0:if(null!==(e=this.activeView.getMainScene().activeCamera))return[3,2];return[4,(0,eZ.UX)("Cannot take screenshot: camera is null",this.soundPlayer)];case 1:return t.sent(),[2,!1];case 2:return s.w1.CreateScreenshot(this.engine,e,{precision:1}),[2,!0]}})}).call(this)}},{key:"takeVideoCapture",value:function(){return tR(function(){return tV(this,function(e){switch(e.label){case 0:if(!u.S.IsSupported(this.engine))return console.warn("Your browser does not support video recording!"),[2];if(null===this.videoRecorder&&(this.videoRecorder=new u.S(this.engine,{fps:60,recordChunckSize:3e6,mimeType:"video/webm;codecs=h264"})),!this.videoRecorder.isRecording)return[3,1];return this.videoRecorder.stopRecording(),[3,3];case 1:return[4,this.videoRecorder.startRecording("planetEngine.webm",Number(prompt("Enter video duration in seconds","10"))).then()];case 2:e.sent(),e.label=3;case 3:return[2]}})}).call(this)}},{key:"getCurrentUniverseCoordinates",value:function(e){var t=this.starSystemView.getStarSystem(),n=e.getAbsolutePosition(),r=t.getNearestOrbitalObject(n),i=(0,z.D2)(r.model,t.model),a=r.getTransform().computeWorldMatrix(!0).clone().invert(),s=o.P.TransformCoordinates(n,a);s.length()<1.1*r.getBoundingRadius()&&s.copyFromFloats(0,0,5*r.getBoundingRadius());var u=e.absoluteRotationQuaternion,l=r.getTransform().absoluteRotationQuaternion.clone().invert(),c=u.multiply(l);return{type:"relative",universeObjectId:i,position:{x:s.x,y:s.y,z:s.z},rotation:{x:c.x,y:c.y,z:c.z,w:c.w}}}},{key:"generateSaveData",value:function(){return tR(function(){var e,t,n,r,i,a;return tV(this,function(o){switch(o.label){case 0:if(t=(e=this.starSystemView.getSpaceshipControls()).getSpaceship(),n=this.getCurrentUniverseCoordinates(e.getTransform()),r=t.isLandedAtFacility()?{type:"atStation",universeObjectId:n.universeObjectId}:n,i=this.activeView.getMainScene().activeCamera,a="",!i)return[3,2];return[4,s.w1.CreateScreenshotAsync(this.engine,i,{width:320,height:180,precision:.8})];case 1:a=o.sent(),o.label=2;case 2:return[2,{uuid:crypto.randomUUID(),timestamp:Date.now(),player:eU.J.Serialize(this.player),playerLocation:{type:"inSpaceship",shipId:t.id},shipLocations:tL({},t.id,r),thumbnail:a}]}})}).call(this)}},{key:"createManualSave",value:function(){return tR(function(){var e,t,n,r,i;return tV(this,function(a){switch(a.label){case 0:if(this.player.uuid===T.Z.TUTORIAL_SAVE_UUID)return[2,!1];if(this.player.uuid!==T.Z.SHARED_POSITION_SAVE_UUID)return[3,2];return this.player.uuid=crypto.randomUUID(),n=(t=this.player).setName,[4,(0,eZ.We)(eJ.Z.t("spaceStation:cmdrNameChangePrompt"),this.player.getName(),this.soundPlayer)];case 1:n.apply(t,[null!=(e=a.sent())?e:"Python"]),a.label=2;case 2:return[4,this.generateSaveData()];case 3:return i=(r=a.sent()).player.uuid,[2,this.backend.save.addManualSave(i,r)]}})}).call(this)}},{key:"setAutoSaveEnabled",value:function(e){this.isAutoSaveEnabled=e}},{key:"createAutoSave",value:function(){return tR(function(){var e,t;return tV(this,function(n){switch(n.label){case 0:if(!this.isAutoSaveEnabled)return[2];return[4,this.generateSaveData()];case 1:if((t=(e=n.sent()).player.uuid)===T.Z.SHARED_POSITION_SAVE_UUID||t===T.Z.TUTORIAL_SAVE_UUID)return[2];return[4,this.backend.save.addAutoSave(t,e)];case 2:return n.sent(),this.autoSaveTimerSeconds=0,[2]}})}).call(this)}},{key:"downloadSaveFile",value:function(){var e=this;this.engine.onEndFrameObservable.addOnce(function(){return tR(function(){var e,t,n,r;return tV(this,function(i){switch(i.label){case 0:return[4,this.generateSaveData()];case 1:return e=new Blob([JSON.stringify(i.sent())],{type:"application/json"}),t=URL.createObjectURL(e),(n=document.createElement("a")).href=t,r=new Date().toLocaleString().replace(/[^0-9a-zA-Z]/g,"_"),n.download="CMDR_".concat(this.player.getName(),"_").concat(r,".json"),n.click(),[2]}})}).call(e)})}},{key:"loadTutorial",value:function(e){var t=this;this.engine.onEndFrameObservable.addOnce(function(){return tR(function(){var t,n;return tV(this,function(r){switch(r.label){case 0:if(this.mainMenu.hide(),this.mainMenu.isVisible())return[3,2];return[4,this.createAutoSave()];case 1:r.sent(),r.label=2;case 2:if((t=e.getSaveData(this.backend.universe)).success)return[3,4];return console.error(t.error),[4,(0,eZ.UX)(eJ.Z.t("The tutorial save has errors and could not be loaded! Check the console for more information."),this.soundPlayer)];case 3:return r.sent(),[2];case 4:return[4,this.loadSave(t.value)];case 5:return r.sent(),this.player.uuid=T.Z.TUTORIAL_SAVE_UUID,[4,this.resume()];case 6:return r.sent(),[4,this.tutorialLayer.setTutorial(e)];case 7:return r.sent(),this.starSystemView.setUIEnabled(!0),n=this.starSystemView.getStarSystem().getNearestOrbitalObject(this.starSystemView.scene.getActiveControls().getTransform().getAbsolutePosition()),this.starSystemView.getSpaceshipControls().getTransform().lookAt(n.getTransform().getAbsolutePosition()),[2]}})}).call(t)})}},{key:"loadSave",value:function(e){return tR(function(){var t,n,r,i,a,o;return tV(this,function(s){switch(s.label){case 0:if(t=this,"inSpaceship"===(n=e.playerLocation).type)return[3,1];return r=n,[3,6];case 1:if(void 0!==(i=e.shipLocations[n.shipId]))return[3,3];return[4,(0,eZ.UX)("Player is in spaceship, but said spaceship does not exist. The loading procedure has been aborted.",this.soundPlayer)];case 2:case 4:return s.sent(),[2];case 3:if("inSpaceship"!==i.type)return[3,5];return[4,(0,eZ.UX)("Spaceship inside spaceships is not yet supported. The loading procedure has been aborted.",this.soundPlayer)];case 5:r=i,s.label=6;case 6:if(null!==(a=this.backend.universe.getSystemModelFromCoordinates(r.universeObjectId.systemCoordinates)))return[3,8];return[4,(0,eZ.UX)("Cannot load universe coordinates: system model not found. The loading procedure has been aborted.",this.soundPlayer)];case 7:return s.sent(),[2];case 8:return o=eU.J.Deserialize(e.player,this.backend.universe),this.player.copyFrom(o,this.backend.universe),this.player.discoveries.uploaded.forEach(function(e){return tR(function(){return tV(this,function(t){switch(t.label){case 0:return[4,this.backend.encyclopaedia.contributeDiscoveryIfNew(e)];case 1:return t.sent(),[2]}})}).call(t)}),[4,this.starSystemView.resetPlayer()];case 9:return s.sent(),this.engine.loadingScreen.displayLoadingUI(),[4,this.starSystemView.loadStarSystem(a)];case 10:if(s.sent(),0!==this.state)return[3,12];return[4,this.init(!0)];case 11:return s.sent(),[3,13];case 12:this.starSystemView.initStarSystem(),s.label=13;case 13:if("inSpaceship"!==n.type)return[3,15];return[4,this.starSystemView.switchToSpaceshipControls()];case 14:return s.sent(),[3,17];case 15:return[4,this.starSystemView.switchToCharacterControls()];case 16:s.sent(),s.label=17;case 17:return[4,this.loadLocation(r)];case 18:return s.sent(),this.starSystemView.getSpaceshipControls().getActiveCamera().getViewMatrix(!0),this.starSystemView.getStarSystem().applyFloatingOrigin(),this.engine.loadingScreen.hideLoadingUI(),null!==this.player.currentItinerary&&this.starSystemView.setSystemAsTarget(this.player.currentItinerary[1]),[2]}})}).call(this)}},{key:"loadLocation",value:function(e){return tR(function(){return tV(this,function(t){switch(t.label){case 0:if("relative"!==e.type)return[3,2];return[4,this.loadRelativeLocation(e)];case 1:return t.sent(),[3,4];case 2:if("atStation"!==e.type)return[3,4];return[4,this.loadAtStationLocation(e)];case 3:t.sent(),t.label=4;case 4:return[2]}})}).call(this)}},{key:"loadRelativeLocation",value:function(e){return tR(function(){var t,n,r,i,s,u;return tV(this,function(l){switch(l.label){case 0:if(t=this.starSystemView.scene.getActiveControls().getTransform(),void 0!==(r=(n=this.starSystemView.getStarSystem()).getOrbitalObjectById(e.universeObjectId.idInSystem)))return[3,2];return i=n.getStellarObjects()[0],(0,e$.gr)(i,new o.P(0,0,4*i.getBoundingRadius()),new a._f(0,0,0,1),t),[4,(0,eZ.UX)("The object you are trying to spawn near to could not be found. You will spawn around the first stellar object of the system instead.",this.soundPlayer)];case 1:return l.sent(),[2];case 2:return(0,e$.gr)(r,new o.P(e.position.x,e.position.y,e.position.z),new a._f(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),t),(s=o.P.Distance(t.getAbsolutePosition(),r.getTransform().getAbsolutePosition()))<1.1*(u=r.getBoundingRadius())&&(s<.1?t.position.addInPlace(new o.P(0,0,5*u)):t.position.scaleInPlace(1.1*u/s)),this.starSystemView.targetCursorLayer.setTarget(r),this.starSystemView.spaceShipLayer.setTarget(r.getTransform()),[2]}})}).call(this)}},{key:"loadAtStationLocation",value:function(e){return tR(function(){var t,n,r,i,s,u;return tV(this,function(l){switch(l.label){case 0:if(t=this.starSystemView.scene.getActiveControls().getTransform(),void 0!==(r=(n=this.starSystemView.getStarSystem()).getOrbitalObjectById(e.universeObjectId.idInSystem))&&(r.type===G.o.SPACE_STATION||r.type===G.o.SPACE_ELEVATOR))return[3,2];return i=n.getStellarObjects()[0],(0,e$.gr)(i,new o.P(0,0,4*i.getBoundingRadius()),new a._f(0,0,0,1),t),[4,(0,eZ.UX)("The space station you are trying to spawn at could not be found. You will spawn around the first stellar object of the system instead.",this.soundPlayer)];case 1:case 3:return l.sent(),[2];case 2:if(void 0!==(s=r.getLandingPadManager().getAvailableLandingPads().at(0)))return[3,4];return u=r,(0,e$.gr)(u,new o.P(0,0,4*u.getBoundingRadius()),new a._f(0,0,0,1),t),[4,(0,eZ.UX)("There are no available pads at the space station you are trying to spawn at. You have been moved outside of the station instead.",this.soundPlayer)];case 4:return this.starSystemView.getSpaceshipControls().getSpaceship().spawnOnPad(s),[2]}})}).call(this)}}],t=[{key:"CreateAsync",value:function(){return tR(function(){var e,t,a,s,u,h,d,f,v,p,y,m,b,g;return tV(this,function(S){switch(S.label){case 0:return(e=document.getElementById("renderer")).width=window.innerWidth,e.height=window.innerHeight,t=new ez.a(e),[4,W.New()];case 1:if((a=S.sent()).success)return[3,3];return[4,(0,eZ.UX)(a.error.message,new eB.cV)];case 2:throw S.sent(),a.error;case 3:return s=a.value,[4,i.f.IsSupportedAsync];case 4:return S.sent()||alert("WebGPU is not supported in your browser. Please check the compatibility here: https://github.com/gpuweb/gpuweb/wiki/Implementation-Status#implementation-status"),[4,(u=new i.f(e,{antialias:!0,useHighPrecisionMatrix:!0,doNotHandleContextLost:!0,audioEngine:!0})).initAsync(void 0,{wasmPath:new URL(n(43808),n.b).href,jsPath:new URL(n(78996),n.b).href})];case 5:return S.sent(),u.useReverseDepthBuffer=!0,u.loadingScreen=t,u.loadingScreen.displayLoadingUI(),window.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight,u.resize(!0)}),[4,(0,eJ.L)()];case 6:return S.sent(),console.log("API: ".concat(u.isWebGPU?"WebGPU":"WebGL")),console.log("GPU detected: ".concat(u.extractDriverInfo())),[4,(0,c.Z)()];case 7:var w,E;return h=S.sent(),console.log("Havok initialized"),d=eU.J.Default(s.universe),(f=new eH.E(u)).useRightHandedSystem=!0,(v=new l.a(!0,h)).setVelocityLimits(1e4,1e4),f.enablePhysics(o.P.Zero(),v),(p=new tI.c).addProgressCallback(function(e,n){t.setProgress(e,n)}),[4,(w=f,(E=function(){var e,t,n;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:var i;return e=(i=function(){var e,t,n,r;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(i){switch(i.label){case 0:var a,o,s;return e=(a=function(){var e,t,n,r,i,a,o,s,u,l,c,h,d,f,v,y,m;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(b){switch(b.label){case 0:return t=(e=function(e,t,n){return null==p||p.startTask(),new Promise(function(r){var i=new H.$(e,t,null,function(){r(i)},n)}).then(function(e){return null==p||p.completeTask(),e})})("OuchSound",em),n=e("EngineRunningSound",ey,{loop:!0}),r=e("MenuHoverSound",eo,{playbackRate:.5}),i=e("MenuSelectSound",eo),a=e("OpenPauseMenuSound",eo,{playbackRate:.75}),o=e("TargetLockSound",ep),s=e("TargetUnlockSound",ep,{playbackRate:.5}),u=e("EnableWarpDriveSound",ec,{playbackRate:2}),l=e("DisableWarpDriveSound",es),c=e("AcceleratingWarpDriveSound",eh,{playbackRate:1,volume:.3,loop:!0}),h=e("DeceleratingWarpDriveSound",ef,{playbackRate:1,volume:.3,loop:!0}),d=e("HyperSpaceSound",ed,{playbackRate:1.5,volume:.25,loop:!0}),f=e("ThrusterSound",eu,{playbackRate:1,volume:.5,loop:!0}),v=e("Success",ev),y=e("Error",el),m={},[4,t];case 1:return m.ouch=b.sent(),[4,n];case 2:return m.engineRunning=b.sent(),[4,r];case 3:return m.menuHover=b.sent(),[4,i];case 4:return m.menuSelect=b.sent(),[4,a];case 5:return m.openPauseMenu=b.sent(),[4,o];case 6:return m.targetLock=b.sent(),[4,s];case 7:return m.targetUnlock=b.sent(),[4,u];case 8:return m.enableWarpDrive=b.sent(),[4,l];case 9:return m.disableWarpDrive=b.sent(),[4,c];case 10:return m.acceleratingWarpDrive=b.sent(),[4,h];case 11:return m.deceleratingWarpDrive=b.sent(),[4,d];case 12:return m.hyperSpace=b.sent(),[4,f];case 13:return m.thruster=b.sent(),[4,v];case 14:return m.success=b.sent(),[4,y];case 15:return[2,(m.error=b.sent(),m)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=a.apply(e,t);function o(e){eb(i,n,r,o,s,"next",e)}function s(e){eb(i,n,r,o,s,"throw",e)}o(void 0)})})(),t=(o=function(){var e,t,n,r,i,a,o,s,u,l,c,h,d,f,v;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(y){switch(y.label){case 0:return t=(e=function(e,t,n){return null==p||p.startTask(),new Promise(function(r){var i=new H.$(e,t,null,function(){r(i)},n)}).then(function(e){return null==p||p.completeTask(),e})})("Wandering",Z,{loop:!0}),n=e("StraussBlueDanube",er),r=e("DeepRelaxation",q),i=e("AtlanteanTwilight",Y),a=e("InfinitePerspective",J),o=e("ThatZenMoment",ei),s=e("EchoesOfTime",X),u=e("PeaceOfMind",ee),l=e("SpacialWinds",$),c=e("Mesmerize",Q),h=e("Reawakening",et),d=e("EquatorialComplex",K),f=e("Soaring",en),v={},[4,t];case 1:return v.wandering=y.sent(),[4,n];case 2:return v.straussBlueDanube=y.sent(),[4,r];case 3:return v.deepRelaxation=y.sent(),[4,i];case 4:return v.atlanteanTwilight=y.sent(),[4,a];case 5:return v.infinitePerspective=y.sent(),[4,o];case 6:return v.thatZenMoment=y.sent(),[4,s];case 7:return v.echoesOfTime=y.sent(),[4,u];case 8:return v.peaceOfMind=y.sent(),[4,l];case 9:return v.spacialWinds=y.sent(),[4,c];case 10:return v.mesmerize=y.sent(),[4,h];case 11:return v.reawakening=y.sent(),[4,d];case 12:return v.equatorialComplex=y.sent(),[4,f];case 13:return[2,(v.soaring=y.sent(),v)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=o.apply(e,t);function a(e){ea(i,n,r,a,s,"next",e)}function s(e){ea(i,n,r,a,s,"throw",e)}a(void 0)})})(),n=(s=function(){var e,t,n,r,i,a,o,s,u,l,c,h,d,f;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(v){switch(v.label){case 0:return t=(e=function(e,t,n){return null==p||p.startTask(),new Promise(function(r){var i=new H.$(e,t,null,function(){r(i)},n)}).then(function(e){return null==p||p.completeTask(),e})})("InitiatingPlanetaryLanding",eP),n=e("LandingRequestGranted",eA),r=e("LandingComplete",eT),i=e("MissionComplete",ek),a=e("NewDiscovery",eC),o=e("CannotEngageWarpDrive",eg),s=e("WarpDriveEmergencyShutDown",eO),u=e("WarpDriveDisengaged",eI),l=e("EngagingWarpDrive",eS),c=e("FuelScoopingVoice",ew),h=e("FuelScoopingCompleteVoice",eE),d={},f={},[4,t];case 1:return f.initiatingPlanetaryLanding=v.sent(),[4,n];case 2:return f.landingRequestGranted=v.sent(),[4,r];case 3:return f.landingComplete=v.sent(),[4,i];case 4:return f.missionComplete=v.sent(),[4,a];case 5:return f.newDiscovery=v.sent(),[4,o];case 6:return f.cannotEngageWarpDrive=v.sent(),[4,s];case 7:return f.warpDriveEmergencyShutDown=v.sent(),[4,u];case 8:return f.warpDriveDisengaged=v.sent(),[4,l];case 9:return f.engagingWarpDrive=v.sent(),[4,c];case 10:return f.fuelScooping=v.sent(),[4,h];case 11:return[2,(d.charlotte=(f.fuelScoopingComplete=v.sent(),f),d)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=s.apply(e,t);function a(e){eR(i,n,r,a,o,"next",e)}function o(e){eR(i,n,r,a,o,"throw",e)}a(void 0)})})(),r={},[4,e];case 1:return r.sounds=i.sent(),[4,t];case 2:return r.musics=i.sent(),[4,n];case 3:return[2,(r.speakerVoiceLines=i.sent(),r)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=i.apply(e,t);function o(e){eM(a,n,r,o,s,"next",e)}function s(e){eM(a,n,r,o,s,"throw",e)}o(void 0)})})(),t=(0,eL.v)(w,p),n={},[4,e];case 1:return n.audio=r.sent(),[4,t];case 2:return[2,(n.rendering=r.sent(),n)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=E.apply(e,t);function a(e){eV(i,n,r,a,o,"next",e)}function o(e){eV(i,n,r,a,o,"throw",e)}a(void 0)})})())];case 8:return y=S.sent(),m=new eB.st(y.audio.sounds),b=new eF.Ae(y.audio.speakerVoiceLines),[4,(g=new eG.p(f,d,u,v,s.encyclopaedia,s.universe,m,b,y.rendering)).resetPlayer()];case 9:return S.sent(),[4,(0,tt.x)()];case 10:if(null!==S.sent())return[3,12];return[4,(0,eZ.UX)(eJ.Z.t("notifications:unknownKeyboardLayout"),m)];case 11:S.sent(),S.label=12;case 12:return[2,new r(d,u,y,g,s,m,b)]}})})()}}],e&&tM(r.prototype,e),t&&tM(r,t),r}()},81469:function(e,t,n){n.d(t,{V:()=>i,n:()=>a});var r=n(26980),i=r.z.object({type:r.z.literal("discoveryScanner"),size:r.z.number(),quality:r.z.number()});function a(e){return{relativeRange:e.size+e.quality/10}}},91010:function(e,t,n){n.d(t,{P8:()=>i,Wl:()=>a});var r=n(61834);function i(e,t){for(var n=Math.floor(e.length/16),r=Math.floor(n/t),i=new Float32Array(16*r),a=0;a<r;a++){var o=16*Math.floor(Math.random()*n);i.set(e.subarray(o,o+16),16*a)}return i}function a(e,t,n,i){if(void 0===e[0]||void 0===e[1]||void 0===e[2]||void 0===e[3]||void 0===e[4]||void 0===e[5]||void 0===e[6]||void 0===e[7]||void 0===e[8]||void 0===e[9]||void 0===e[10]||void 0===e[11]||void 0===e[12]||void 0===e[13]||void 0===e[14]||void 0===e[15])throw Error("Matrix is not defined");t.set(e[12],e[13],e[14]);var a=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);i.set(a,a,a);var o=r.y3.Identity();o.setRowFromFloats(0,e[0]/a,e[1]/a,e[2]/a,0),o.setRowFromFloats(1,e[4]/a,e[5]/a,e[6]/a,0),o.setRowFromFloats(2,e[8]/a,e[9]/a,e[10]/a,0),o.setRowFromFloats(3,0,0,0,1),n.copyFrom(r._f.FromRotationMatrix(o))}},91307:function(e,t,n){function r(e){var t=[];return e.children.forEach(function(n,r){"x"!==r&&"y"!==r&&t.push([r,e.name])}),t}function i(e,t){var n=[];if(e.children.forEach(function(e,r){if("x"!==r&&"y"!==r){var i,a,o=e.name;o=o.replace("key:",""),o=null!=(a=null==t||null==(i=t.get(o))?void 0:i.toUpperCase())?a:o,n.push([r,o])}}),void 0===n[0]||void 0===n[1]||void 0===n[2]||void 0===n[3])throw Error("DPadComposite keys are undefined");return[n[2],n[0],n[3],n[1]]}function a(){return[["x","pointerX"],["y","pointerY"]]}function o(e,t){var n,r,i=e.name;return i=i.replace("key:",""),i=null!=(r=null==t||null==(n=t.get(i))?void 0:n.toUpperCase())?r:i}function s(e,t){var n=[];return e.children.forEach(function(e,r){var i,a,o=e.name;o=o.replace("key:",""),o=null!=(a=null==t||null==(i=t.get(o))?void 0:i.toUpperCase())?a:o,n.push([r,o])}),n}function u(e,t){return e.action.bindings.map(function(e){return o(e.control,t)})}n.d(t,{C9:()=>s,JT:()=>r,cs:()=>i,gG:()=>a,gW:()=>u,x_:()=>o})},91822:function(e,t,n){function r(e,t,n){return(0x466f45d*e^0x127409f*t^0x4f9ffb7*n)%1e9}function i(e){var t=0x811c9dc5,n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t^=s,t=Math.imul(t,0x1000193)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return(t>>>=0)/0xffffffff}n.d(t,{Z:()=>r,q:()=>i})}}]);