"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["7141"],{76583:function(e,t,a){a.r(t),a.d(t,{FlowGraphSetDelayBlock:()=>d});var l=a(96185),n=a(82753),i=a(2745),s=a(88280),r=a(46363),o=a(10118);class d extends l.g{constructor(e){super(e),this.cancel=this._registerSignalInput("cancel"),this.duration=this.registerDataInput("duration",n.ab),this.lastDelayIndex=this.registerDataOutput("lastDelayIndex",n.fj,new o.K(-1))}_preparePendingTasks(e){let t=this.duration.getValue(e);if(t<0||isNaN(t)||!isFinite(t))return this._reportError(e,"Invalid duration in SetDelay block");if(e._getGlobalContextVariable("activeDelays",0)>=d.MaxParallelDelayCount)return this._reportError(e,"Max parallel delays reached");let a=e._getGlobalContextVariable("lastDelayIndex",-1),l=e._getExecutionVariable(this,"pendingDelays",[]),n=e.configuration.scene,s=new i.xb({timeout:1e3*t,contextObservable:n.onBeforeRenderObservable,onEnded:()=>this._onEnded(s,e)});s.start();let r=a+1;this.lastDelayIndex.setValue(new o.K(r),e),e._setGlobalContextVariable("lastDelayIndex",r),l[r]=s,e._setExecutionVariable(this,"pendingDelays",l),this._updateGlobalTimers(e)}_cancelPendingTasks(e){for(let t of e._getExecutionVariable(this,"pendingDelays",[]))t?.dispose();e._deleteExecutionVariable(this,"pendingDelays"),this.lastDelayIndex.setValue(new o.K(-1),e),this._updateGlobalTimers(e)}_execute(e,t){if(t===this.cancel)return void this._cancelPendingTasks(e);this._preparePendingTasks(e),this.out._activateSignal(e)}getClassName(){return"FlowGraphSetDelayBlock"}_onEnded(e,t){let a=t._getExecutionVariable(this,"pendingDelays",[]),l=a.indexOf(e);-1!==l?a.splice(l,1):s.Y.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),t._removePendingBlock(this),this.done._activateSignal(t),this._updateGlobalTimers(t)}_updateGlobalTimers(e){let t=e._getExecutionVariable(this,"pendingDelays",[]),a=e._getGlobalContextVariable("pendingDelays",[]);for(let e=0;e<t.length;e++){if(!t[e])continue;let l=t[e];a[e]&&a[e]!==l?s.Y.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"):a[e]=l}e._setGlobalContextVariable("pendingDelays",a)}}d.MaxParallelDelayCount=100,(0,r.H7)("FlowGraphSetDelayBlock",d)}}]);