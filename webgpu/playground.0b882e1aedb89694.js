/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

(()=>{"use strict";var e={14221:function(e,t,n){e.exports=n.p+"2470ffe0b50b2171.webp"},14280:function(e,t,n){n.d(t,{Iu:()=>i,QB:()=>d,Sf:()=>l,Sl:()=>v,U1:()=>u,cs:()=>f,fx:()=>b,gM:()=>p,jw:()=>s,nA:()=>c,tW:()=>m});var r=n(84081),o=n(61834),a=n(42933);function i(e,t){e.setAbsolutePosition(e.getAbsolutePosition().add(t)),e.computeWorldMatrix(!0)}function u(e,t,n){e.rotate(t,n,r.T.WORLD)}function s(e){if(null===e.rotationQuaternion)throw Error("Null quaternion for ".concat(e.name));return e.rotationQuaternion}function l(e,t){e.rotationQuaternion=t,e.computeWorldMatrix(!0)}function c(e,t){if(!t.equalsWithEpsilon(e.up,1e-7)){var n=e.up;u(e,o.P.Cross(t,n),-Math.acos(o.P.Dot(t,n)))}}function f(e){return e.getDirection(a.F.FORWARD)}function p(e){return e.getDirection(a.F.UP)}function d(e){return h(e).negate()}function h(e){return e.getDirection(a.F.LEFT)}function v(e,t){u(e,f(e),t)}function m(e,t){u(e,h(e),t)}function b(e,t){u(e,p(e),t)}},15788:function(e,t,n){e.exports=n.p+"ceb0939a515e507b.webp"},18722:function(e,t,n){n.a(e,async function(e,t){try{n(15738),n(19295);var r,o=n(83416),a=n(96775),i=n(80929),u=n(81386),s=document.getElementById("renderer");s.width=window.innerWidth,s.height=window.innerHeight;var l=new a.a(s),c=new o.WebGPUEngine(s,{antialias:!0,audioEngine:!0,useHighPrecisionMatrix:!0,doNotHandleContextLost:!0});await c.initAsync(void 0,{wasmPath:new URL(n(43808),n.b).href,jsPath:new URL(n(78996),n.b).href}),c.useReverseDepthBuffer=!0,c.loadingScreen=l,c.displayLoadingUI();var f=function(){};c.runRenderLoop(f);var p=new URLSearchParams(window.location.search),d=null!=(r=p.get("scene"))?r:"",h=new u.j().get(d),v=new i.c;v.addProgressCallback(function(e,t){l.setProgress(e,t),l.loadingUIText="Loading ".concat(d," (").concat(t,"/").concat(e,")")}),v.startTask();var m=await h(c,v);if(window.scene=m,v.completeTask(),null!==p.get("debug")){var b=document.createElement("div");document.body.appendChild(b),b.id="inspectorLayer",await m.debugLayer.show({globalRoot:b})}if(null!==p.get("physicsViewer")){var y=new o.PhysicsViewer(m);m.onBeforeRenderObservable.add(function(){var e=!0,t=!1,n=void 0;try{for(var r,o=m.meshes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value.physicsBody;a&&y.showBody(a)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}})}var g=p.get("freeze"),w=Number(g);if(null!==g&&!isNaN(w)){c.getDeltaTime=function(){return 0};var _=0;m.onAfterRenderObservable.add(function(){if(++_>=w){c.stopRenderLoop(),s.dataset.frozen="1";return}})}m.onAfterRenderObservable.addOnce(function(){s.dataset.ready="1"}),m.executeWhenReady(function(){c.loadingScreen.hideLoadingUI(),c.stopRenderLoop(f),c.runRenderLoop(function(){m.render()})}),window.addEventListener("resize",function(){s.width=window.innerWidth,s.height=window.innerHeight,c.resize(!0)}),document.addEventListener("keypress",function(e){"p"===e.key&&null!==m.activeCamera&&o.Tools.CreateScreenshot(c,m.activeCamera,{precision:1})}),window.scene=m,t()}catch(e){t(e)}},1)},24660:function(e,t,n){n.d(t,{pl:()=>o}),n(16891);var r=n(61834);function o(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,a=function(e,t){var n=-1,r=t[0];if(void 0===r)throw Error("no bodieees !");var o=!0,a=!1,i=void 0;try{for(var u,s=t[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=u.value,c=e.subtract(l.getTransform().getAbsolutePosition()).length();(-1===n||c<n)&&(r=l,n=c)}}catch(e){a=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(a)throw i}}return r}(t.getTransform().getAbsolutePosition(),n.getStellarObjects());if(a===t)e.getTransform().setAbsolutePosition(t.getTransform().getAbsolutePosition().add(new r.P(0,.2,1).scaleInPlace(t.getBoundingRadius()*o)));else{var i=t.getTransform().getAbsolutePosition().subtract(a.getTransform().getAbsolutePosition()),u=i.length();i.scaleInPlace(1/u);var s=a.getTransform().getAbsolutePosition().add(i.scale(u-o*t.getBoundingRadius()));e.getTransform().setAbsolutePosition(s)}n.translateEverythingNow(e.getTransform().getAbsolutePosition().negate()),e.getTransform().setAbsolutePosition(r.P.Zero()),e.getTransform().lookAt(t.getTransform().getAbsolutePosition())}n(14280)},30369:function(e,t,n){e.exports=n.p+"a818b763cab42c30.webp"},33219:function(e,t,n){n.d(t,{XP:()=>i,b7:()=>a,bY:()=>u});var r=n(96509),o=n(48353);function a(e){return Math.pow(e/r.ah,.78)*r.uR}function i(e,t){return 2*Math.PI*Math.sqrt(e/t)}function u(e,t,n){var r,a=(r=(0,o.P1)(100),e<=0?0:1/(1/r+2044761436301033e-19*Math.log(101325/e))),i=(0,o.P1)(0);return!(e<.05)&&!(a<i)&&!(t>a)&&!(n<i)}},42615:function(e,t,n){e.exports=n.p+"e11ee3cdd6bf505e.webp"},4761:function(e,t,n){n.d(t,{bM:()=>a,eU:()=>i,jH:()=>u});var r,o,a=((r={})[r.CHARLOTTE=0]="CHARLOTTE",r),i=((o={})[o.INITIATING_PLANETARY_LANDING=0]="INITIATING_PLANETARY_LANDING",o[o.LANDING_REQUEST_GRANTED=1]="LANDING_REQUEST_GRANTED",o[o.LANDING_COMPLETE=2]="LANDING_COMPLETE",o[o.MISSION_COMPLETE=3]="MISSION_COMPLETE",o[o.NEW_DISCOVERY=4]="NEW_DISCOVERY",o[o.CANNOT_ENGAGE_WARP_DRIVE=5]="CANNOT_ENGAGE_WARP_DRIVE",o[o.WARP_DRIVE_EMERGENCY_SHUT_DOWN=6]="WARP_DRIVE_EMERGENCY_SHUT_DOWN",o[o.WARP_DRIVE_DISENGAGED=7]="WARP_DRIVE_DISENGAGED",o[o.ENGAGING_WARP_DRIVE=8]="ENGAGING_WARP_DRIVE",o[o.FUEL_SCOOPING=9]="FUEL_SCOOPING",o[o.FUEL_SCOOPING_COMPLETE=10]="FUEL_SCOOPING_COMPLETE",o),u=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"sayNow",value:function(){}},{key:"enqueueSay",value:function(){}},{key:"update",value:function(){}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},48353:function(e,t,n){n.d(t,{Kz:()=>i,Mf:()=>l,P1:()=>u,Ub:()=>s,XX:()=>a,fT:()=>o});var r=n(96509);function o(e){return e/r.JR}function a(e){return e*r.JR}function i(e){return e/r.C}function u(e){return e+273.15}function s(e){return e*r.AU}function l(e){return 1e5*e}},53020:function(e,t,n){n.d(t,{Z:()=>l,n:()=>c});var r=n(4046),o=n(57423),a=n(39596),i=n(6562);function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return u(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var l=function(e,t,n,i){return(0,a.NK)(e,{points:s(t),updatable:!1},{color:new o.Wo(n.r,n.g,n.b),width:5,colorMode:r.VL.COLOR_MODE_SET,sizeAttenuation:!0},i)},c=function(e,t,n,r){var a=new o.HE(n.r,n.g,n.b,1),u=t.map(function(){return a});return(0,i.nL)(e,{points:s(t),colors:u,updatable:!1},r)}},54755:function(e,t,n){n.d(t,{k6:()=>a,cV:()=>i});var r,o=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"play",value:function(){}},{key:"setVolume",value:function(){}},{key:"setMaskFactor",value:function(){}},{key:"getMask",value:function(){return 0}},{key:"dispose",value:function(){}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),a=((r={})[r.CLICK=0]="CLICK",r[r.HOVER=1]="HOVER",r[r.SUCCESS=2]="SUCCESS",r[r.ERROR=3]="ERROR",r[r.WARNING=4]="WARNING",r[r.INFO=5]="INFO",r[r.ENABLE_ORBIT_DISPLAY=6]="ENABLE_ORBIT_DISPLAY",r[r.DISABLE_ORBIT_DISPLAY=7]="DISABLE_ORBIT_DISPLAY",r[r.TARGET_LOCK=8]="TARGET_LOCK",r[r.TARGET_UNLOCK=9]="TARGET_UNLOCK",r[r.ITINERARY_COMPUTED=10]="ITINERARY_COMPUTED",r[r.OPEN_PAUSE_MENU=11]="OPEN_PAUSE_MENU",r[r.ENABLE_WARP_DRIVE=12]="ENABLE_WARP_DRIVE",r[r.DISABLE_WARP_DRIVE=13]="DISABLE_WARP_DRIVE",r[r.ACCELERATING_WARP_DRIVE=14]="ACCELERATING_WARP_DRIVE",r[r.DECELERATING_WARP_DRIVE=15]="DECELERATING_WARP_DRIVE",r[r.HYPER_SPACE=16]="HYPER_SPACE",r[r.THRUSTER=17]="THRUSTER",r),i=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"playNow",value:function(){}},{key:"enqueuePlay",value:function(){}},{key:"createInstance",value:function(){return new o}},{key:"freeInstance",value:function(){}},{key:"setInstanceMask",value:function(){}},{key:"update",value:function(){}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},61012:function(e,t,n){n.d(t,{Bh:()=>J,CD:()=>ei,CW:()=>eo,Cf:()=>C,Fv:()=>V,G6:()=>F,GW:()=>ec,IH:()=>eu,J_:()=>G,Jb:()=>ep,K4:()=>$,Kh:()=>X,LB:()=>ef,Nb:()=>er,Ou:()=>N,R3:()=>ee,RZ:()=>B,TE:()=>W,TS:()=>Q,Tm:()=>O,V9:()=>M,VV:()=>el,Vl:()=>et,Vz:()=>I,Wn:()=>ea,Yo:()=>D,ZI:()=>Y,a2:()=>Z,dC:()=>q,dr:()=>eh,f:()=>U,fQ:()=>k,fv:()=>H,fz:()=>L,hi:()=>K,kE:()=>z,lp:()=>ed,lu:()=>es,xz:()=>en,zZ:()=>j});var r=n(1725),o=n(52137),a=n(44787),i=n(16091),u=n(34651),s=n(28957),l=n(82263),c=n(19236),f=n(81731),p=n(4489);n(65794);var d=n(77904);n(36775);var h=n(2132),v=n(76320),m=n(80836),b=n(86607),y=n(37393),g=n(56093),w=n(83612),_=n(40282),T=n(71193),x=n(4693),S=n(45906),P=n(25378),R=n(54603),A=n(59942),E=n(68099),I={VERT:A.u.Vertex,FRAG:A.u.Fragment,NEUTRAL:A.u.Neutral,VERT_AND_FRAG:A.u.VertexAndFragment};function O(e){var t,n=new c.S("cameraPosition");return n.target=null!=(t=null==e?void 0:e.target)?t:A.u.Neutral,n.setAsSystemValue(E.$.CameraPosition),n.output}function C(e){var t,n=new c.S("view");return n.target=null!=(t=null==e?void 0:e.target)?t:A.u.Neutral,n.setAsSystemValue(E.$.View),n.output}function k(e){var t,n=new c.S("ViewProjection");return n.target=null!=(t=null==e?void 0:e.target)?t:A.u.Neutral,n.setAsSystemValue(E.$.ViewProjection),n.output}function M(e){var t,n=new c.S("world");return n.target=null!=(t=null==e?void 0:e.target)?t:A.u.Neutral,n.setAsSystemValue(E.$.World),n.output}function N(e,t){var n,r=new c.S(e);return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Vertex,r.setAsAttribute(e),r.output}function L(e,t){var n,r=new c.S("float");return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,r.value=e,r.isConstant=!0,r.output}function U(e,t){return L(e,t)}function F(e,t,n){var r,o=new c.S(e);return o.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,o.value=t,o.output}function B(e,t,n){var r,o,a,i,s=new u.M("texture");return s.target=null!=(r=null==n?void 0:n.target)?r:A.u.Fragment,s.convertToGammaSpace=null!=(o=null==n?void 0:n.convertToGammaSpace)&&o,s.convertToLinearSpace=null!=(a=null==n?void 0:n.convertToLinearSpace)&&a,s.disableLevelMultiplication=null!=(i=null==n?void 0:n.disableLevelMultiplication)&&i,s.texture=e,t.connectTo(s.uv),s}function G(e,t,n,r){var o,a,i,s,l=new u.M("texture2dArray");return l.target=null!=(o=null==r?void 0:r.target)?o:A.u.Fragment,l.convertToGammaSpace=null!=(a=null==r?void 0:r.convertToGammaSpace)&&a,l.convertToLinearSpace=null!=(i=null==r?void 0:r.convertToLinearSpace)&&i,l.disableLevelMultiplication=null!=(s=null==r?void 0:r.disableLevelMultiplication)&&s,l.texture=e,t.connectTo(l.uv),n.connectTo(l.layer),l}function j(e,t,n){var r,o=new _.m("TransformPosition");return o.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,o.complementZ=0,o.complementW=1,t.connectTo(o.vector),e.connectTo(o.transform),o.output}function D(e,t,n){var r,o=new _.m("TransformDirection");return o.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,o.complementZ=0,o.complementW=0,t.connectTo(o.vector),e.connectTo(o.transform),o.output}function H(e,t,n){var r,a=new o.x("atan2");return a.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(a.x),t.connectTo(a.y),a.output}function V(e,t){var n,r=new v.A("normalize");return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.connectTo(r.input),r.output}function z(e,t){var n,r=new f.u("length");return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.connectTo(r.value),r.output}function W(e,t,n){var r,o=new a.y("distance");return o.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(o.left),t.connectTo(o.right),o.output}function Z(e,t,n,r,o,a){var i,u=new b.w("remap");return u.target=null!=(i=null==a?void 0:a.target)?i:A.u.Neutral,e.connectTo(u.input),t.connectTo(u.sourceMin),n.connectTo(u.sourceMax),r.connectTo(u.targetMin),o.connectTo(u.targetMax),u.output}function Y(e,t){var n,r=new T.S("fract");return r.operation=T.p.Fract,r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.connectTo(r.input),r.output}function X(e,t){var n,r=new T.S("acos");return r.operation=T.p.ArcCos,r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.connectTo(r.input),r.output}function q(e,t,n){var r,o=new h.U("mul");return o.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(o.left),t.connectTo(o.right),o.output}function K(e,t,n){var r,o=new i.x("div");return o.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(o.left),t.connectTo(o.right),o.output}function Q(e,t,n,r,o){var a,i=new x.t("Merge");return i.target=null!=(a=null==o?void 0:o.target)?a:A.u.Neutral,e.connectTo(i.x),t.connectTo(i.y),n&&n.connectTo(i.z),r&&r.connectTo(i.w),i}function J(e,t){var n,r=new c.S("Mesh UV scale factor");return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,r.isConstant=!0,r.value=e,r.output}function $(e,t,n){return Q(e,t,null,null,n).xyOut}function ee(e,t,n,r){return Q(e,t,n,null,r).xyzOut}function et(e,t){var n,r=new S.R("split");switch(r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.type){case R.E.Float:case R.E.Int:case R.E.Matrix:case R.E.Object:case R.E.AutoDetect:case R.E.BasedOnInput:case R.E.All:throw Error("Invalid input type");case R.E.Vector2:e.connectTo(r.xyIn);break;case R.E.Vector3:case R.E.Color3:e.connectTo(r.xyzIn);break;case R.E.Vector4:case R.E.Color4:e.connectTo(r.xyzw)}return r}function en(e,t){var n,r=et(e,t),o=new x.t("OutputXZ");return o.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,r.x.connectTo(o.x),r.z.connectTo(o.y),o.xyOut}function er(e,t,n){var r,o=new g.n("step");return o.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(o.edge),t.connectTo(o.value),o.output}function eo(e,t,n,r){var o,a=new y.S("smoothstep");return a.target=null!=(o=null==r?void 0:r.target)?o:A.u.Neutral,e.connectTo(a.edge0),t.connectTo(a.edge1),n.connectTo(a.value),a.output}function ea(e,t){var n,r=new T.S("abs");return r.operation=T.p.Abs,r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.connectTo(r.input),r.output}function ei(e,t,n,r){var o,a=new p.J("mix");return a.target=null!=(o=null==r?void 0:r.target)?o:A.u.Neutral,e.connectTo(a.left),t.connectTo(a.right),n.connectTo(a.gradient),a.output}function eu(e,t,n){var o,a=new r.S("add");return a.target=null!=(o=null==n?void 0:n.target)?o:A.u.Neutral,e.connectTo(a.left),t.connectTo(a.right),a.output}function es(e,t,n){var r,o=new w.F("sub");return o.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(o.left),t.connectTo(o.right),o.output}function el(e,t,n){var r,o=new d.d("min");return o.target=null!=(r=null==n?void 0:n.target)?r:A.u.Neutral,e.connectTo(o.left),t.connectTo(o.right),o.output}function ec(e,t){var n,r=new T.S("floor");return r.operation=T.p.Floor,r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Neutral,e.connectTo(r.input),r.output}function ef(e,t,n,r,o,a){var i,u=new l.h("Perturb normal");return u.target=null!=(i=null==a?void 0:a.target)?i:A.u.Fragment,e.connectTo(u.uv),t.connectTo(u.worldPosition),n.connectTo(u.worldNormal),r.connectTo(u.normalMapColor),o.connectTo(u.strength),u.output}function ep(e,t,n,r,o,a,i,u,s,l){var c,f,p,d,h=new m.M("PBRMetallicRoughness");return h.target=null!=(c=null==l?void 0:l.target)?c:A.u.Fragment,h.useEnergyConservation=null==(f=null==l?void 0:l.useEnergyConservation)||f,h.useRadianceOcclusion=null==(p=null==l?void 0:l.useRadianceOcclusion)||p,h.useHorizonOcclusion=null==(d=null==l?void 0:l.useHorizonOcclusion)||d,e.connectTo(h.baseColor),t.connectTo(h.metallic),n.connectTo(h.roughness),null==r||r.connectTo(h.ambientOcc),o.connectTo(h.perturbedNormal),a.connectTo(h.worldNormal),i.connectTo(h.view),u.connectTo(h.cameraPosition),s.connectTo(h.worldPosition),h.lighting}function ed(e,t){var n,r,o=new s.g("FragmentOutput");return o.target=A.u.Fragment,o.convertToGammaSpace=null!=(n=null==t?void 0:t.convertToGammaSpace)&&n,o.convertToLinearSpace=null!=(r=null==t?void 0:t.convertToLinearSpace)&&r,e.connectTo(o.rgb),o}function eh(e,t){var n,r=new P.t("VertexOutput");return r.target=null!=(n=null==t?void 0:t.target)?n:A.u.Vertex,e.connectTo(r.vector),r}},69427:function(e,t,n){n.d(t,{o:()=>r});function r(e){try{return window.btoa(encodeURIComponent(e))}catch(e){return null}}},70104:function(e,t,n){n.d(t,{vG:()=>p});var r=n(85737),o=n(16585),a=n(76473),i=(0,o.c)(a.Z.POWER_PLAY_SEED),u=0,s=(0,r.makeNoise3D)(function(){return i(u++)}),l=(0,o.c)(a.Z.POWER_PLAY_SEED+598),c=0,f=(0,r.makeNoise3D)(function(){return l(c++)});function p(e){var t,n;return{materialistSpiritualist:(t=e.x,.5*s(.2*t,.2*e.y,.2*e.z)+.5),capitalistCommunist:(n=e.x,.5*f(.2*n,.2*e.y,.2*e.z)+.5)}}},81386:function(e,t,n){n.d(t,{j:()=>aD});var r=n(83416),o=n(57947),a=n(55104),i=n(77054);function u(e,t){var n,u=new r.Scene(e);u.useRightHandedSystem=!0;var s=new URLSearchParams(window.location.search),l=new r.ArcRotateCamera("ArcRotateCamera",0,3.14/3,30,r.Vector3.Zero(),u);l.attachControl(),l.lowerRadiusLimit=.5,l.wheelPrecision*=100,l.minZ=.01;var c=u.enableDepthRenderer(l,!0,!0);c.clearColor=new r.Color4(0,0,0,1);var f=(0,o.c)("juliaSet",Number(null!=(n=s.get("seed"))?n:1e5*Math.random()),"Julia Set",[]),p=new i.W(f,u);p.getTransform().scalingDeterminant=1e-5;var d=new a.v(p.getTransform(),p.getBoundingRadius(),f.accentColor,u,[]);return u.cameras.forEach(function(e){return e.attachPostProcess(d)}),u.onNewCameraAddedObservable.add(function(e){e.attachPostProcess(d)}),u.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;d.update(t)}),u.onBeforeCameraRenderObservable.add(function(e){c.getDepthMap().activeCamera=e}),Promise.resolve(u)}var s=n(25178),l=n(20678);function c(e,t){var n,o=new r.Scene(e);o.useRightHandedSystem=!0;var a=new URLSearchParams(window.location.search),u=new r.ArcRotateCamera("ArcRotateCamera",0,3.14/3,5,r.Vector3.Zero(),o);u.attachControl(),u.lowerRadiusLimit=.5,u.wheelPrecision*=100,u.minZ=.01;var c=o.enableDepthRenderer(u,!0,!0);c.clearColor=new r.Color4(0,0,0,1);var f=(0,s.i)("mandelbox",Number(null!=(n=a.get("seed"))?n:1e5*Math.random()),"Mandelbox",[]),p=new i.W(f,o);p.getTransform().scalingDeterminant=1e-5;var d=new l.m(p.getTransform(),p.getBoundingRadius(),f,o,[]);return o.cameras.forEach(function(e){return e.attachPostProcess(d)}),o.onNewCameraAddedObservable.add(function(e){e.attachPostProcess(d)}),o.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;d.update(t)}),o.onBeforeCameraRenderObservable.add(function(e){c.getDepthMap().activeCamera=e}),Promise.resolve(o)}var f=n(76106),p=n(75122);function d(e,t){var n,o=new r.Scene(e);o.useRightHandedSystem=!0;var a=new URLSearchParams(window.location.search),u=new r.ArcRotateCamera("ArcRotateCamera",0,3.14/3,30,r.Vector3.Zero(),o);u.attachControl(),u.lowerRadiusLimit=.5,u.wheelPrecision*=100,u.minZ=.01;var s=o.enableDepthRenderer(u,!0,!0);s.clearColor=new r.Color4(0,0,0,1);var l=(0,f.i)("mandelbulb",Number(null!=(n=a.get("seed"))?n:1e5*Math.random()),"Mandelbulb",[]),c=new i.W(l,o);c.getTransform().scalingDeterminant=1e-5;var d=new p.C(c.getTransform(),c.getBoundingRadius(),l,o,[]);return o.cameras.forEach(function(e){return e.attachPostProcess(d)}),o.onNewCameraAddedObservable.add(function(e){e.attachPostProcess(d)}),o.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;d.update(t)}),o.onBeforeCameraRenderObservable.add(function(e){s.getDepthMap().activeCamera=e}),Promise.resolve(o)}var h=n(97343),v=n(59209);function m(e,t){var n,o=new r.Scene(e);o.useRightHandedSystem=!0;var a=new URLSearchParams(window.location.search),u=new r.ArcRotateCamera("ArcRotateCamera",0,3.14/3,5,r.Vector3.Zero(),o);u.attachControl(),u.lowerRadiusLimit=.5,u.wheelPrecision*=100,u.minZ=.01;var s=o.enableDepthRenderer(u,!0,!0);s.clearColor=new r.Color4(0,0,0,1);var l=(0,h.$)("mengerSponge",Number(null!=(n=a.get("seed"))?n:1e5*Math.random()),"Menger Sponge",[]),c=new i.W(l,o);c.getTransform().scalingDeterminant=1e-5;var f=new v.x(c.getTransform(),c.getBoundingRadius(),l,o,[]);return o.cameras.forEach(function(e){return e.attachPostProcess(f)}),o.onNewCameraAddedObservable.add(function(e){e.attachPostProcess(f)}),o.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;f.update(t)}),o.onBeforeCameraRenderObservable.add(function(e){s.getDepthMap().activeCamera=e}),Promise.resolve(o)}var b=n(51056),y=n(48757);function g(e,t){var n,o=new r.Scene(e);o.useRightHandedSystem=!0;var a=new URLSearchParams(window.location.search),u=new r.ArcRotateCamera("ArcRotateCamera",0,3.14/3,5,r.Vector3.Zero(),o);u.attachControl(),u.lowerRadiusLimit=.5,u.wheelPrecision*=100,u.minZ=.01;var s=o.enableDepthRenderer(u,!0,!0);s.clearColor=new r.Color4(0,0,0,1);var l=(0,b.q)("sierpinski",Number(null!=(n=a.get("seed"))?n:1e5*Math.random()),"Sierpinski Pyramid",[]),c=new i.W(l,o);c.getTransform().scalingDeterminant=1e-5;var f=new y.U(c.getTransform(),c.getBoundingRadius(),l,o,[]);return o.cameras.forEach(function(e){return e.attachPostProcess(f)}),o.onNewCameraAddedObservable.add(function(e){e.attachPostProcess(f)}),o.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;f.update(t)}),o.onBeforeCameraRenderObservable.add(function(e){s.getDepthMap().activeCamera=e}),Promise.resolve(o)}var w=n(70621),_=n(98201),T=n(93019),x=n(82866);n(10425);var S=n(61834),P=n(24919),R=n(72392);function A(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function E(e,t){var n;return(n=function(e){var t,n,r,o,a,i,u=arguments;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(s){switch(s.label){case 0:if(t=u.length>1&&void 0!==u[1]?u[1]:S.P.Zero(),n=u.length>2?u[2]:void 0,o=P.a.bind,a=[void 0,!0],null==n)return[3,1];return i=n,[3,3];case 1:return[4,(0,R.Z)()];case 2:i=s.sent(),s.label=3;case 3:return r=new(o.apply(P.a,a.concat([i]))),e.enablePhysics(t,r),[2,r]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){A(a,r,o,i,u,"next",e)}function u(e){A(a,r,o,i,u,"throw",e)}i(void 0)})}).apply(this,arguments)}function I(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function O(e,t){var n;return(n=function(){var n,o,a,i,u,s,l;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(c){switch(c.label){case 0:return(n=new r.Scene(e)).useRightHandedSystem=!0,[4,E(n)];case 1:return c.sent(),(a=(o=new _.Q(n)).getActiveCamera()).attachControl(),[4,(0,w.Pr)(n,t)];case 2:return i=c.sent(),new r.DirectionalLight("sun",new r.Vector3(1,-1,0),n).intensity=.7,new r.HemisphericLight("hemi",r.Vector3.Up(),n).intensity=.4,o.getTransform().position.z=-75e3,o.getTransform().position.y=1500,o.speed*=500,a.maxZ*=500,u=r.MeshBuilder.CreateSphere("sphere",{diameter:1e4},n),new r.PhysicsAggregate(u,r.PhysicsShapeType.SPHERE,{mass:0},n),x.c.BATCH_SIZE=1e4,s=new T.K(42,u,6e4,127500,n),(l=r.MeshBuilder.CreateTorus("torus",{diameter:17e4,thickness:1e5,tessellation:32},n)).visibility=.1,l.parent=u,l.scaling.y=2e-4,n.onBeforeRenderObservable.add(function(){o.update(e.getDeltaTime()/1e3),s.update(o.getTransform().getAbsolutePosition(),i,e.getDeltaTime()/1e3)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){I(a,r,o,i,u,"next",e)}function u(e){I(a,r,o,i,u,"throw",e)}i(void 0)})})()}var C=n(76468),k=n(64026),M=n(30017);function N(e,t){var n=new C.x(e);n.useRightHandedSystem=!0;var o=new _.Q(n),a=o.getActiveCamera();o.speed=6e6,a.maxZ*=6e6,o.getTransform().setAbsolutePosition(new r.Vector3(0,1,-2).scaleInPlace(6e6)),o.getTransform().lookAt(r.Vector3.Zero()),a.attachControl(),n.enableDepthRenderer(a,!0,!0).clearColor=new r.Color4(0,0,0,1);var i=new r.PointLight("light1",new r.Vector3(6e7,0,0),n),u=r.MeshBuilder.CreateSphere("sphere",{diameter:12e6,segments:64},n),s=new k.r(6e6,5972e21,298,{seaLevelPressure:101325,greenHouseEffectFactor:.5,gasMix:[["N2",.78],["O2",.21],["Ar",.01]],aerosols:{tau550:.05,angstromExponent:0,particleRadius:5e-7,settlingCoefficient:.15}}),l=new M.C(u,6e6,s,[i],n);return a.attachPostProcess(l),n.onBeforeRenderObservable.add(function(){var e=n.getEngine().getDeltaTime()/1e3;o.update(e);var t=o.getTransform().position.clone();o.getTransform().position=r.Vector3.Zero(),u.position.subtractInPlace(t)}),Promise.resolve(n)}var L=n(88113),U=n(78626),F=n(84787),B=n(95959),G=n(54755),j=n(71631),D=n(43161),H=n(76473);function V(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function z(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(f){switch(f.label){case 0:return(n=new C.x(e)).useRightHandedSystem=!0,[4,E(n)];case 1:return f.sent(),[4,(0,B.v)(n,t)];case 2:return o=f.sent(),a=new G.cV,(i=j.O.CreateDefault(n,o,a)).getTransform().position.copyFromFloats((0,U.randRange)(-50,50,Math.random,0),(0,U.randRange)(30,50,Math.random,0),(0,U.randRange)(-50,50,Math.random,0)),i.getTransform().rotationQuaternion=r.Quaternion.Random().normalize(),(u=new _.Q(n)).getTransform().position.copyFromFloats(0,10,-50),u.speed*=10,(s=u.getActiveCamera()).minZ=.1,s.attachControl(),new F.X(42,D.g.SMALL,o,n),(l=r.MeshBuilder.CreateBox("ground",{width:100,height:1,depth:100},n)).position.y=-2,l.position.x=75,(c=new r.PhysicsAggregate(l,r.PhysicsShapeType.BOX,{mass:0},n)).shape.filterMembershipMask=H.k.ENVIRONMENT,c.shape.filterCollideMask=H.k.DYNAMIC_OBJECTS,new L.e("hemi",S.P.Up(),n).intensity=.7,i.engageSurfaceLanding(l),n.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;i.update(t),u.update(t)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){V(a,r,o,i,u,"next",e)}function u(e){V(a,r,o,i,u,"throw",e)}i(void 0)})})()}var W=n(57845),Z=n(78681),Y=n(52653);function X(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function q(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){X(a,r,o,i,u,"next",e)}function u(e){X(a,r,o,i,u,"throw",e)}i(void 0)})}}function K(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function Q(e,t){return q(function(){var n,o,a,i,u,s,l,c,f;return K(this,function(p){switch(p.label){case 0:return(o=new C.x(e)).useRightHandedSystem=!0,[4,E(o,new S.P(0,-9.81,0))];case 1:return p.sent(),null==(n=e.getRenderingCanvas())||n.addEventListener("click",function(){return q(function(){var t;return K(this,function(n){switch(n.label){case 0:return[4,null==(t=e.getRenderingCanvas())?void 0:t.requestPointerLock()];case 1:return n.sent(),[2]}})})()}),[4,(0,W.l)(o,t)];case 2:var d,h;if(a=p.sent(),(i=new r.DirectionalLight("dir01",new S.P(1,-2,-1),o)).position=new S.P(5,5,5).scaleInPlace(10),new r.HemisphericLight("hemi",new S.P(0,1,0),o).intensity=.5,(u=new r.ShadowGenerator(1024,i)).useBlurExponentialShadowMap=!0,d=s=a.default.instantiateHierarchy(null),null!=(h=r.AbstractMesh)&&"undefined"!=typeof Symbol&&h[Symbol.hasInstance]?!h[Symbol.hasInstance](d):!(d instanceof h))throw Error("Character object is null");return(l=new Z.J(s,o)).getTransform().position.y=40,null!==new URLSearchParams(window.location.search).get("thirdPerson")&&l.setThirdPersonCameraActive(),l.getActiveCamera().attachControl(),Y.V.setEnabled(!0),u.addShadowCaster(l.character),c=r.MeshBuilder.CreateIcoSphere("ground",{radius:40},o),new r.PhysicsAggregate(c,r.PhysicsShapeType.MESH,{mass:0},o),(f=new r.PBRMetallicRoughnessMaterial("groundMaterial",o)).baseColor=new r.Color3(.5,.5,.5),c.material=f,c.receiveShadows=!0,l.setClosestWalkableObject({getTransform:function(){return c}}),o.onBeforeRenderObservable.add(function(){if(l.getActiveCamera()!==o.activeCamera){null==(t=o.activeCamera)||t.detachControl();var t,n=l.getActiveCamera();n.attachControl(),o.activeCamera=n}var r=e.getDeltaTime()/1e3;l.update(r)}),[2,o]}})})()}var J=n(50137),$=n(63435),ee=n(14373);function et(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function en(e,t){var n;return(n=function(){var n,o,a,i,u,s;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(l){switch(l.label){case 0:return(n=new r.Scene(e)).useRightHandedSystem=!0,[4,(0,$.j)(n,t)];case 1:return o=l.sent(),n.environmentTexture=o.environment.milkyWay,(i=(a=new _.Q(n)).getActiveCamera()).attachControl(),new r.HemisphericLight("light1",new r.Vector3(0,1,0),n).intensity=.7,a.speed=s=(u=new ee.c((0,J.C)([]),n)).getBoundingRadius(),i.maxZ*=s,a.getTransform().setAbsolutePosition(new r.Vector3(0,1,-2).scaleInPlace(s)),a.getTransform().lookAt(r.Vector3.Zero()),n.onBeforeRenderObservable.add(function(){var e=n.getEngine().getDeltaTime()/1e3;a.update(e);var t=a.getTransform().position.clone();a.getTransform().position=r.Vector3.Zero(),u.getTransform().position.subtractInPlace(t)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){et(a,r,o,i,u,"next",e)}function u(e){et(a,r,o,i,u,"throw",e)}i(void 0)})})()}function er(e,t){var n=new C.x(e),o=new r.FreeCamera("camera1",new r.Vector3(0,5,-10),n);return o.setTarget(r.Vector3.Zero()),o.attachControl(),new r.HemisphericLight("light1",new r.Vector3(0,1,0),n).intensity=.7,r.MeshBuilder.CreateSphere("sphere",{diameter:2,segments:32},n).position.y=1,r.MeshBuilder.CreateGround("ground",{width:6,height:6},n),Promise.resolve(n)}var eo=n(4761),ea=n(60480),ei=n(11508);function eu(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function es(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f,p,d;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(h){switch(h.label){case 0:return(n=new C.x(e)).useRightHandedSystem=!0,n.defaultCursor="crosshair",[4,E(n)];case 1:return h.sent(),[4,(0,B.v)(n,t)];case 2:return o=h.sent(),a=new G.cV,i=new eo.jH,(s=(u=ea.y.CreateDefault(n,o,i,a)).getActiveCamera()).minZ=.1,s.attachControl(),n.activeCamera=s,ei.m.setEnabled(!0),new L.e("hemi",S.P.Up(),n).intensity=1,l=r.MeshBuilder.CreateBox("box",{size:50},n),c=new r.SolidParticleSystem("boxes",n,{updatable:!1}),f=function(e,t){return Math.random()*(t-e)+e},c.addShape(l,1e4,{positionFunction:function(e){e.position=new S.P(f(-1,1),f(-1,1),f(-1,1)).scaleInPlace(5e3)}}),p=c.buildMesh(),(d=new r.PBRMetallicRoughnessMaterial("material",n)).baseColor=new r.Color3(.5,.5,.5),d.metallic=0,d.roughness=.5,p.material=d,l.setEnabled(!1),n.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;u.update(t)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){eu(a,r,o,i,u,"next",e)}function u(e){eu(a,r,o,i,u,"throw",e)}i(void 0)})})()}var el=n(69151),ec=n(54944),ef=n(25254),ep=n(52209),ed=n(50312),eh=n(62213);function ev(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function em(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f,p,d,h,v;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(m){switch(m.label){case 0:return(n=new r.Scene(e)).useRightHandedSystem=!0,n.clearColor.setAll(0),[4,(0,$.j)(n,t)];case 1:return o=m.sent(),[4,E(n)];case 2:if(m.sent(),a=10*H.Z.EARTH_RADIUS,u=(i=new _.Q(n)).getActiveCamera(),i.speed=a,u.maxZ*=a,i.getTransform().setAbsolutePosition(new r.Vector3(0,1,-2).scaleInPlace(a)),i.getTransform().lookAt(r.Vector3.Zero()),u.attachControl(),n.enableDepthRenderer(null,!0,!0).clearColor.set(0,0,0,1),s=new r.PointLight("light1",new r.Vector3(7,5,-10).scaleInPlace(a),n),l=new URLSearchParams(window.location.search).get("seed"),c=(0,el.L)("gasPlanet",null!==l?Number(l):1e3*Math.random(),"Gas Planet",[]),f=new eh._(function(){return new ef.h(n)}),p=new ed.v(c,o,f,n),d=new ep.A(p.getTransform(),p.getBoundingRadius(),p.ringsUniforms,null,!1,[{getBoundingRadius:function(){return 0},getLight:function(){return s}}],n),u.attachPostProcess(d),h=new M.C(p.getTransform(),p.getBoundingRadius(),p.atmosphereUniforms,[s],n),u.attachPostProcess(h),!p.ringsUniforms)return[3,4];return v=new ec.e(p.getTransform(),p.ringsUniforms,c,[s],n),u.attachPostProcess(v),[4,new Promise(function(e){var t;(null==(t=p.ringsUniforms)?void 0:t.patternLut.type)==="procedural"&&p.ringsUniforms.patternLut.lut.getTexture().executeWhenReady(function(){e()})})];case 3:m.sent(),m.label=4;case 4:return n.onBeforeRenderObservable.add(function(){var e=n.getEngine().getDeltaTime()/1e3;i.update(e),p.updateMaterial([s],e);var t=i.getTransform().position.clone();i.getTransform().position=r.Vector3.Zero(),p.getTransform().position.subtractInPlace(t),s.position.subtractInPlace(t)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){ev(a,r,o,i,u,"next",e)}function u(e){ev(a,r,o,i,u,"throw",e)}i(void 0)})})()}var eb=n(54812),ey=n(49323),eg=n(32557),ew=n(91010),e_=n(96112);function eT(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function ex(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f,p;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(d){switch(d.label){case 0:return n=new C.x(e),[4,(0,$.j)(n,t)];case 1:return o=d.sent(),(a=new r.FreeCamera("camera1",new r.Vector3(0,5,-10),n)).setTarget(r.Vector3.Zero()),a.attachControl(),i=new r.PointLight("light1",new r.Vector3(200,800,100),n),r.MeshBuilder.CreateSphere("lightSphere",{diameter:.1,segments:8},n).position=i.position,(u=r.MeshBuilder.CreateGround("ground",{width:32,height:32,subdivisions:4},n)).setEnabled(!1),(s=(0,ey.f)(n,5)).isVisible=!1,(l=new eg.B(n,o.noises,!1)).setPlanet(u),s.material=l,c=(0,eb.seededSquirrelNoise)(0),f=0,p=function(){return c(f++)},new e_.N((0,ew.ZX)(r.Vector3.Zero(),32,256,p)).createInstances([{mesh:s,distance:0}]),n.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;l.update([i],new r.Vector3(0,10,0),t)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){eT(a,r,o,i,u,"next",e)}function u(e){eT(a,r,o,i,u,"throw",e)}i(void 0)})})()}var eS=n(94518),eP=n(84081),eR=n(97451);function eA(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function eE(e,t){var n;return(n=function(){var n,r,o,a;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(i){switch(i.label){case 0:return(n=new C.x(e)).useRightHandedSystem=!0,(r=new _.Q(n)).getActiveCamera().attachControl(),[4,(0,$.j)(n,t)];case 1:return o=i.sent(),new eS.O("sun",new S.P(1,-1,0),n).intensity=.7,a=new eR.$(eP.RD.Z,n,o.noises),n.onBeforeRenderObservable.add(function(){r.update(e.getDeltaTime()/1e3),a.update(e.getDeltaTime()/1e3)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){eA(a,r,o,i,u,"next",e)}function u(e){eA(a,r,o,i,u,"throw",e)}i(void 0)})})()}var eI=n(64832),eO=n(70541),eC=n(31872),ek=n(39745),eM=n(57420);function eN(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var eL=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");eN(this,"_transform",void 0),eN(this,"model",void 0),eN(this,"type",void 0),eN(this,"boundingRadius",void 0),this._transform=e,this._transform.rotationQuaternion=S._f.Identity(),this.model=n,this.type=n.type;var r=this.getTransform().getHierarchyBoundingVectors();this.boundingRadius=r.max.subtract(r.min).length()/2}return e=[{key:"getTransform",value:function(){return this._transform}},{key:"getBoundingRadius",value:function(){return this.boundingRadius}},{key:"getTypeName",value:function(){return"Wrapped Orbital Object"}},{key:"dispose",value:function(){this.getTransform().dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),eU=n(53020),eF=n(82090);function eB(e,t){var n=new C.x(e);n.useRightHandedSystem=!0;var r=new _.Q(n),o=r.getActiveCamera();o.minZ=.1,o.attachControl(),new L.e("hemi",S.P.Up(),n).intensity=1;var a=new eL(eI.V.CreateSphere("sun",{diameter:1},n),{id:"sun",name:"Sun",orbit:{parentIds:[],argumentOfPeriapsis:0,semiMajorAxis:0,initialMeanAnomaly:0,longitudeOfAscendingNode:0,inclination:0,eccentricity:0,p:2},type:eC.o.CUSTOM,axialTilt:0,mass:1e12,siderealDaySeconds:0}),i=new eL(eI.V.CreateSphere("earth",{diameter:.5},n),{id:"earth",name:"Earth",orbit:{parentIds:[a.model.id],argumentOfPeriapsis:0,semiMajorAxis:10,initialMeanAnomaly:0,longitudeOfAscendingNode:1.7,inclination:eO.w1.ToRadians(23.5),eccentricity:.5,p:2},type:eC.o.CUSTOM,axialTilt:eO.w1.ToRadians(23.5),mass:1e11,siderealDaySeconds:0}),u=new eL(eI.V.CreateSphere("moon",{diameter:.2},n),{id:"moon",name:"Moon",orbit:{parentIds:[i.model.id],argumentOfPeriapsis:0,semiMajorAxis:3,initialMeanAnomaly:0,longitudeOfAscendingNode:0,inclination:i.model.orbit.inclination+i.model.axialTilt,eccentricity:.7,p:2},type:eC.o.CUSTOM,mass:1e10,axialTilt:0,siderealDaySeconds:0}),s=[a,i,u],l=new Map;l.set(i,[a]),l.set(u,[i]);var c=new eF.B(eU.Z);c.setOrbitalObjects(s,n),c.setVisibility(!0);var f=new eM.Y(eU.Z);f.setVisibility(!0),f.setOrbitalObjects(s,n);var p=S.y3.Identity(),d=S.y3.Identity(),h=0;return r.getTransform().setAbsolutePosition(new S.P(0,0,-10)),r.getTransform().lookAt(S.P.Zero()),n.onBeforeRenderObservable.add(function(){var t,n,o=e.getDeltaTime()/1e3;h+=o,r.update(o),S.y3.FromQuaternionToRef(null!=(n=null==(t=r.getTransform().rotationQuaternion)?void 0:t.clone().invertInPlace())?n:S._f.Identity(),d),r.getTransform().rotationQuaternion=S._f.Identity(),r.getTransform().computeWorldMatrix(!0),p.multiplyToRef(d,p),s.forEach(function(e){var t;(0,ek.PF)(e,null!=(t=l.get(e))?t:[],p,h),(0,ek.L$)(e,p,h)}),c.update(p)}),Promise.resolve(n)}var eG=n(21132);function ej(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function eD(e,t){var n;return(n=function(){var t,n,o,a,i,u,s,l,c,f;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(p){switch(p.label){case 0:return(t=new C.x(e)).useRightHandedSystem=!0,t.clearColor.set(0,0,0,1),n=1e7,a=(o=new _.Q(t)).getActiveCamera(),o.speed=n,a.maxZ*=n,o.getTransform().setAbsolutePosition(new r.Vector3(0,5,-10).scaleInPlace(n)),o.getTransform().lookAt(r.Vector3.Zero()),a.attachControl(),t.enableDepthRenderer(a,!0,!0).clearColor=new r.Color4(0,0,0,1),(i=new r.PointLight("light1",new r.Vector3(-1,.5,-2).scaleInPlace(10*n),t)).intensity=.7,u=r.MeshBuilder.CreateSphere("sphere",{diameter:2*n,segments:32},t),s=new eh._(function(){return new ef.h(t)}),l={innerRadius:1.7*n,outerRadius:3.5*n,type:"procedural",seed:0,frequency:10,albedo:{r:120/255,g:112/255,b:104/255}},c=eG.fv.NewProcedural(l,s,0,t),[4,new Promise(function(e){"procedural"===c.patternLut.type&&c.patternLut.lut.getTexture().executeWhenReady(function(){e()})})];case 1:return p.sent(),f=new ec.e(u,c,{name:"Sphere",radius:+n},[i],t),a.attachPostProcess(f),t.onBeforeRenderObservable.add(function(){var e=t.getEngine().getDeltaTime()/1e3;o.update(e);var n=o.getTransform().position.clone();o.getTransform().position=r.Vector3.Zero(),u.position.subtractInPlace(n),i.position.subtractInPlace(n)}),[2,t]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){ej(a,r,o,i,u,"next",e)}function u(e){ej(a,r,o,i,u,"throw",e)}i(void 0)})})()}var eH=n(48464),eV=n(37032),ez=n(76103),eW=n(92099),eZ=n(68215),eY=n(59265),eX=n(32075);function eq(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function eK(e,t){var n;return(n=function(){var t,n,o,a,i;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(u){switch(u.label){case 0:return t=new C.x(e),new r.FreeCamera("camera",r.Vector3.Zero(),t).attachControl(),[4,(0,eX.L)()];case 1:return u.sent(),n=new eW.Z((0,ez.D)()),o=new G.cV,(a=new eY.W(n,o)).htmlRoot.style.position="absolute",document.body.appendChild(a.htmlRoot),[4,eH.p.CreateAsync(new eV.u(eV.u.SAVES_KEY),new eV.u(eV.u.BACKUP_SAVE_KEY),n)];case 2:if((i=u.sent()).success)return[3,4];return[4,(0,eZ.UX)("Could not load saves",o)];case 3:case 5:return u.sent(),[2,t];case 4:return[4,a.populateCmdrList(n,i.value)]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){eq(a,r,o,i,u,"next",e)}function u(e){eq(a,r,o,i,u,"throw",e)}i(void 0)})})()}var eQ=n(57423),eJ=n(96509),e$=n(48353);function e0(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function e1(e){return{id:"earth",name:"Earth",type:eC.o.TELLURIC_PLANET,radius:6371e3,mass:5972e21,axialTilt:eO.w1.ToRadians(23.44),siderealDaySeconds:86400,waterAmount:1,temperature:{min:(0,e$.P1)(-50),max:(0,e$.P1)(50)},orbit:{parentIds:function(e){if(Array.isArray(e))return e0(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return e0(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e0(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),semiMajorAxis:14959787e4,eccentricity:.0167,inclination:eO.w1.ToRadians(0),longitudeOfAscendingNode:eO.w1.ToRadians(0),argumentOfPeriapsis:eO.w1.ToRadians(114.20783),initialMeanAnomaly:0,p:2},terrainSettings:{continents_frequency:1,continents_fragmentation:.65,bumps_frequency:30,max_bump_height:1500,max_mountain_height:1e4,continent_base_height:19e3,mountains_frequency:360},rings:null,atmosphere:{seaLevelPressure:eJ.z2,greenHouseEffectFactor:.5,gasMix:[["N2",.78],["O2",.21],["Ar",.01]],aerosols:{tau550:.05,settlingCoefficient:.15,particleRadius:5e-7,angstromExponent:0}},clouds:{layerRadius:6401e3,smoothness:.7,specularPower:2,frequency:4,detailFrequency:12,coverage:.5,sharpness:2.5,color:new eQ.Wo(.8,.8,.8),worleySpeed:5e-4,detailSpeed:.003},ocean:{depth:1e4},seed:0}}var e2=n(51577),e3=n(74634);let e4=n.p+"2e25e4a2f9e9e4e0.glb";function e5(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}var e6=n(32160),e7=n(46526),e8=n(14581);function e9(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function te(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function tt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return e9(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e9(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tn(e,t,n,r){var o;return(o=function(){var o,a,i,u,s,l,c,f,p,d,h,v,m,b,y,g,w,_,T,x,S,P,R,A,E,I,O,C,k,M,N;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(L){switch(L.label){case 0:o=[],a=!0,i=!1,u=void 0;try{for(s=t.entries()[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){f=(c=tt(l.value,2))[0],p=c[1],d=!0,h=!1,v=void 0;try{for(m=p.entries()[Symbol.iterator]();!(d=(b=m.next()).done);d=!0)g=(y=tt(b.value,2))[0],w=y[1],o.push((0,e8.Z)("".concat(e,"_").concat(f,"_").concat(g),w,n,r))}catch(e){h=!0,v=e}finally{try{d||null==m.return||m.return()}finally{if(h)throw v}}}}catch(e){i=!0,u=e}finally{try{a||null==s.return||s.return()}finally{if(i)throw u}}return[4,Promise.all(o)];case 1:if(T=(_=L.sent())[0],x=_[1],S=_[2],P=_[3],R=_[4],A=_[5],E=_[6],I=_[7],void 0===T||void 0===x||void 0===S||void 0===P||void 0===R||void 0===A||void 0===E||void 0===I){O=!0,C=!1,k=void 0;try{for(M=_[Symbol.iterator]();!(O=(N=M.next()).done);O=!0)N.value.dispose()}catch(e){C=!0,k=e}finally{try{O||null==M.return||M.return()}finally{if(C)throw k}}return[2,(0,e7.cn)([Error("One or more textures failed to load.")])]}return[2,(0,e7.ok)({type:"2x4",textures:[[T,x,S,P],[R,A,E,I]]})]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=o.apply(e,t);function i(e){te(a,n,r,i,u,"next",e)}function u(e){te(a,n,r,i,u,"throw",e)}i(void 0)})})()}let tr=n.p+"b4070f7c72dd3f6d.png",to=n.p+"7c8d08f2ab6c9cb6.png",ta=n.p+"f05f090bd863b63a.png",ti=n.p+"0aa1c9ae2fd69ffc.png",tu=n.p+"e61cef361129b6fb.png",ts=n.p+"65eb742dbf741838.png",tl=n.p+"302d5f4b86bfff02.png",tc=n.p+"da364aaa47a8d3d4.png",tf=n.p+"64e5fcd400a4dd80.png",tp=n.p+"5accf841daaf253b.png",td=n.p+"5554205b79f7473b.png",th=n.p+"916697f18b845f2d.png",tv=n.p+"5e39c479bfa7696e.png",tm=n.p+"9cfdfd02bce87b52.png",tb=n.p+"27ca24d1bbd42185.png",ty=n.p+"6ebf2b783119ac2f.png",tg=n.p+"dcdfb213523d9a81.png",tw=n.p+"0b15cdd524980d33.png",t_=n.p+"21c9a0e97d4dc713.png",tT=n.p+"97265bd50c1dd708.png",tx=n.p+"bb89aed0ee4f6f82.png",tS=n.p+"00924daef502aceb.png",tP=n.p+"5c64c029734e9536.png",tR=n.p+"633a9dc7e88337b9.png",tA=n.p+"e0f5953a626b982c.png",tE=n.p+"a31ca3007b8660a9.png",tI=n.p+"193308d39b5fc570.png",tO=n.p+"8486107d259e93b4.png",tC=n.p+"945e9c7e50490439.png",tk=n.p+"53f19c480ecefd05.png",tM=n.p+"1719e46972a7c16d.png",tN=n.p+"1a08fecd21225806.png";function tL(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function tU(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function tF(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tB(e,t,n){return t&&tF(e.prototype,t),n&&tF(e,n),e}function tG(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tj=function(){function e(t,n){tU(this,e),tG(this,"heightMaps",void 0),tG(this,"higherResolutionHeightMaps",{}),tG(this,"scene",void 0),this.heightMaps=t,this.scene=n}return tB(e,[{key:"loadHeightMapsToGpu",value:function(e,t){var n;return(n=function(){var n,r,o,a,i,u,s,l;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(c){n=[],r=!0,o=!1,a=void 0;try{for(i=e[Symbol.iterator]();!(r=(u=i.next()).done);r=!0)s=u.value,l=this.preloadHeightMap(s,t),void 0!==l&&n.push(l)}catch(e){o=!0,a=e}finally{try{r||null==i.return||i.return()}finally{if(o)throw a}}return[2,Promise.all(n)]})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){tL(a,r,o,i,u,"next",e)}function u(e){tL(a,r,o,i,u,"throw",e)}i(void 0)})}).call(this)}},{key:"preloadHeightMap",value:function(e,t){var n=this;switch(e){case"mercury":return tn(e,[[tg,tw,t_,tT],[tx,tS,tP,tR]],this.scene,t).then(function(t){return t.success&&(n.higherResolutionHeightMaps[e]=t.value),t});case"venus":return;case"earth":return tn(e,[[tr,to,ta,ti],[tu,ts,tl,tc]],this.scene,t).then(function(t){return t.success&&(n.higherResolutionHeightMaps[e]=t.value),t});case"moon":return tn(e,[[tA,tE,tI,tO],[tC,tk,tM,tN]],this.scene,t).then(function(t){return t.success&&(n.higherResolutionHeightMaps[e]=t.value),t});case"mars":return tn(e,[[tf,tp,td,th],[tv,tm,tb,ty]],this.scene,t).then(function(t){return t.success&&(n.higherResolutionHeightMaps[e]=t.value),t});default:return(0,e7.UT)(e)}}},{key:"reset",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=Object.values(this.higherResolutionHeightMaps)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;switch(a.type){case"2x4":!function(e){var t=!0,n=!1,r=void 0;try{for(var o,a=e.textures[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var i=o.value,u=!0,s=!1,l=void 0;try{for(var c,f=i[Symbol.iterator]();!(u=(c=f.next()).done);u=!0)c.value.dispose()}catch(e){s=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(s)throw l}}}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}(a);break;case"1x1":a.texture.dispose();break;default:(0,e7.UT)(a)}}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.higherResolutionHeightMaps={}}},{key:"getHeightMap",value:function(e){var t=this.higherResolutionHeightMaps[e];if(void 0!==t)return t;switch(e){case"earth":return this.heightMaps.earth1x1;case"mercury":return this.heightMaps.mercury1x1;case"moon":return this.heightMaps.moon1x1;case"venus":case"mars":return this.heightMaps.mars1x1;default:return(0,e7.UT)(e)}}}]),e}(),tD=function(){function e(){tU(this,e)}return tB(e,[{key:"loadHeightMapsToGpu",value:function(){return Promise.resolve([])}},{key:"getHeightMap",value:function(){return{type:"1x1",texture:new e6.x(null,null)}}},{key:"reset",value:function(){}}]),e}();let tH=n.p+"95322e3b8b5983db.png";function tV(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}let tz=n.p+"db67068c72421af0.png";function tW(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}let tZ=n.p+"f9568d724f2c1094.png";function tY(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}let tX=n.p+"0696dfde5d7237a3.png";function tq(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function tK(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function tQ(e,t){var n;return(n=function(){var n;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){var o,a,i,u;switch(r.label){case 0:return n={},[4,(o=function(){var n;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return n={type:"1x1"},[4,(0,e8.Z)("mercuryHeightMap1x1",tZ,e,t)];case 1:return[2,(n.texture=r.sent(),n)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=o.apply(e,t);function i(e){tY(a,n,r,i,u,"next",e)}function u(e){tY(a,n,r,i,u,"throw",e)}i(void 0)})})()];case 1:return n.mercury1x1=r.sent(),[4,(a=function(){var n,r;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(o){switch(o.label){case 0:return n=(0,e8.Z)("EarthHeightMap_1x1",tH,e,t),r={type:"1x1"},[4,n];case 1:return[2,(r.texture=o.sent(),r)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=a.apply(e,t);function i(e){tV(o,n,r,i,u,"next",e)}function u(e){tV(o,n,r,i,u,"throw",e)}i(void 0)})})()];case 2:return n.earth1x1=r.sent(),[4,(i=function(){var n,r;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(o){switch(o.label){case 0:return n=(0,e8.Z)("MarsHeightMap_1x1",tz,e,t),r={type:"1x1"},[4,n];case 1:return[2,(r.texture=o.sent(),r)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=i.apply(e,t);function a(e){tW(o,n,r,a,u,"next",e)}function u(e){tW(o,n,r,a,u,"throw",e)}a(void 0)})})()];case 3:return n.mars1x1=r.sent(),[4,(u=function(){var n,r;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(o){switch(o.label){case 0:return n=(0,e8.Z)("MoonHeightMap_1x1",tX,e,t),r={type:"1x1"},[4,n];case 1:return[2,(r.texture=o.sent(),r)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=u.apply(e,t);function a(e){tq(o,n,r,a,i,"next",e)}function i(e){tq(o,n,r,a,i,"throw",e)}a(void 0)})})()];case 4:return n.moon1x1=r.sent(),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){tK(a,r,o,i,u,"next",e)}function u(e){tK(a,r,o,i,u,"throw",e)}i(void 0)})})()}var tJ=n(79474),t$=n(20534),t0=n(1266),t1=n(13616);function t2(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function t3(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function t4(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){t3(a,r,o,i,u,"next",e)}function u(e){t3(a,r,o,i,u,"throw",e)}i(void 0)})}}function t5(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function t6(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function t7(e,t,n,r){return t4(function(){var o,a,i,u,s,l,c,f,p,d,h,v,m,b,y,g,w,_,T,x;return t6(this,function(S){var P;switch(S.label){case 0:return null==r||r.startTask(),[4,t4(function(){var t,n,r,o,a,i,u,s,l,c,f,p,d,h,v;return t6(this,function(m){switch(m.label){case 0:t=[],n=!0,r=!1,o=void 0;try{for(a=e[Symbol.iterator]();!(n=(i=a.next()).done);n=!0)u=i.value,t.push(function(e){return t4(function(){var t;return t6(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),[4,fetch(e)];case 1:return[4,n.sent().blob()];case 2:return[4,createImageBitmap(n.sent(),{colorSpaceConversion:"none"})];case 3:return[2,e7.ok.apply(void 0,[n.sent()])];case 4:return t=n.sent(),[2,(0,e7.cn)(Error('Failed to load image bitmap from URL "'.concat(e,'": ').concat(t5(t,Error)?t.message:String(t))))];case 5:return[2]}})})()}(u))}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return[4,Promise.all(t)];case 1:s=m.sent(),l=[],c=!0,f=!1,p=void 0;try{for(d=s[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){if(!(v=h.value).success)return[2,v];l.push(v.value)}}catch(e){f=!0,p=e}finally{try{c||null==d.return||d.return()}finally{if(f)throw p}}return[2,(0,e7.ok)(l)]}})})()];case 1:if(!(o=S.sent()).success)return null==r||r.completeTask(),[2,o];if(a=o.value,i=function(){var e=!0,t=!1,n=void 0;try{for(var o,i=a[Symbol.iterator]();!(e=(o=i.next()).done);e=!0)o.value.close()}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}null==r||r.completeTask()},void 0===(u=a[0]))return null==r||r.completeTask(),[2,(0,e7.cn)(Error("No image bitmaps were loaded. Please check the URLs."))];if(s=u.width,l=u.height,c=a.length,f=new t0.e(null,s,l,c,t$.D.TEXTUREFORMAT_RGBA,t,!1,!1,e6.x.TRILINEAR_SAMPLINGMODE),p=n._device,null===(d=f.getInternalTexture()))return i(),[2,(0,e7.cn)(Error("Failed to get internal texture from RawTexture2DArray."))];if(null===(h=d._hardwareTexture))return i(),[2,(0,e7.cn)(Error("Failed to get hardware texture from internal texture."))];v=h.underlyingResource;try{m=!0,b=!1,y=void 0;try{for(g=a.entries()[Symbol.iterator]();!(m=(w=g.next()).done);m=!0)P=w.value,T=(_=function(e){if(Array.isArray(e))return e}(P)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(P,2)||function(e,t){if(e){if("string"==typeof e)return t2(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t2(e,t)}}(P,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],x=_[1],p.queue.copyExternalImageToTexture({source:x,flipY:!1},{texture:v,origin:{z:T}},{width:s,height:l,depthOrArrayLayers:1})}catch(e){b=!0,y=e}finally{try{m||null==g.return||g.return()}finally{if(b)throw y}}}catch(e){if(t5(e,Error))return[2,(0,e7.cn)(e)];return[2,(0,e7.cn)(Error("Failed to copy external image to texture: ".concat(String(e))))]}finally{i()}return f.wrapU=e6.x.CLAMP_ADDRESSMODE,f.wrapV=e6.x.CLAMP_ADDRESSMODE,f.wrapR=e6.x.CLAMP_ADDRESSMODE,[2,(0,e7.ok)(f)]}})})()}function t8(e,t,n,r,o){var a,i,u,s=new t1.F(null!=(a=null==o?void 0:o.data)?a:null,t.width,t.height,t.depth,n,r,!1,!1,null!=(i=null==o?void 0:o.samplingMode)?i:tJ.g.TEXTURE_NEAREST_SAMPLINGMODE,null!=(u=null==o?void 0:o.type)?u:tJ.g.TEXTURETYPE_FLOAT,tJ.g.TEXTURE_CREATIONFLAG_STORAGE);return s.name=e,s.wrapU=tJ.g.TEXTURE_WRAP_ADDRESSMODE,s.wrapV=tJ.g.TEXTURE_WRAP_ADDRESSMODE,s}let t9=n.p+"2443af3bc1a02504.png",ne=n.p+"650cab575ae8b184.png",nt=n.p+"c985afbf7269c0ba.png",nn=n.p+"824340cc9c7be066.png",nr=n.p+"aa312295d1eaab3c.png",no=n.p+"9d64d203fbc64f0a.png",na=n.p+"c1df60ac4e155d3e.png",ni=n.p+"6e579e383e4f5855.png",nu=n.p+"85885d9791e4d0a0.png",ns=n.p+"88aaf09099cf0cd1.png",nl=n.p+"ee5a368e2c478a2e.png",nc=n.p+"0139910c67514e55.png",nf=n.p+"1ce9c76103e8bfc8.png",np=n.p+"116c8b83d0d69625.png",nd=n.p+"ca1315fdd5d2ff62.png",nh=n.p+"958aea2749605639.png",nv=n.p+"99d382ab42f5de93.png",nm=n.p+"6a91141f45a93713.png";function nb(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function ny(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){nb(a,r,o,i,u,"next",e)}function u(e){nb(a,r,o,i,u,"throw",e)}i(void 0)})}}function ng(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var nw=n(49841),n_=n(50394),nT=n(53191),nx=n(4798),nS=n(66502),nP=n(97867);function nR(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function nA(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var nE=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");nA(this,"map",void 0),nA(this,"maxSize",void 0),nA(this,"cleanup",void 0),this.map=new Map,this.maxSize=e,this.cleanup=n}return e=[{key:"set",value:function(e,t){var n=this.map.get(e);if(void 0!==n)n!==t&&this.cleanup(e,n),this.map.delete(e);else if(this.map.size>=this.maxSize){var r=this.map.entries().next().value;void 0!==r&&(this.cleanup(r[0],r[1]),this.map.delete(r[0]))}this.map.set(e,t)}},{key:"get",value:function(e){if(this.map.has(e))return this.touch(e),this.map.get(e)}},{key:"touch",value:function(e){var t=this.map.get(e);void 0!==t&&(this.map.delete(e),this.map.set(e,t))}},{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.map.entries()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a,i=(a=r.value,function(e){if(Array.isArray(e))return e}(a)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(a,2)||function(e,t){if(e){if("string"==typeof e)return nR(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nR(e,t)}}(a,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],s=i[1];this.cleanup(u,s)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.map.clear()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),nI=n(49458),nO=n(95979),nC=n(32556),nk=n(69342);function nM(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function nN(e,t,n){var r;return(r=function(){var r;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(o){switch(o.label){case 0:r=0,o.label=1;case 1:if(!(r<t))return[3,4];if(e())return[2];if(!(++r<t))return[3,3];return[4,(0,nk.D)(n)];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:throw Error("Function failed after ".concat(t," attempts"))}})},function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){nM(a,n,o,i,u,"next",e)}function u(e){nM(a,n,o,i,u,"throw",e)}i(void 0)})})()}function nL(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function nU(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nF(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var nB=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");nF(this,"computeShader",void 0),nF(this,"paramsBuffer",void 0),this.computeShader=e,this.paramsBuffer=new nC.M(t),this.paramsBuffer.addUniform("row_vertex_count",1),this.computeShader.setUniformBuffer("params",this.paramsBuffer)}return e=[{key:"dispatch",value:function(e,t){this.paramsBuffer.updateUInt("row_vertex_count",e),this.paramsBuffer.update();var r=new nI.N(t,Uint32Array.BYTES_PER_ELEMENT*(e-1)*(e-1)*6,tJ.g.BUFFER_CREATIONFLAG_INDEX|tJ.g.BUFFER_CREATIONFLAG_READWRITE);return this.computeShader.setStorageBuffer("indices",r),this.computeShader.dispatch(e/n.WORKGROUP_SIZE[0],e/n.WORKGROUP_SIZE[1],1),r}}],t=[{key:"New",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return t=new nO.U("gridIndicesComputeShader",e,{computeSource:"//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nstruct Params {\n    row_vertex_count : u32,\n};\n\n@group(0) @binding(0) var<storage, read_write> indices : array<u32>;\n@group(0) @binding(1) var<uniform> params : Params;\n\n@compute @workgroup_size(16,16,1)\nfn main(@builtin(global_invocation_id) id: vec3<u32>) {\n    if (id.x >= params.row_vertex_count || id.y >= params.row_vertex_count) { \n        return; \n    }\n\n    let index: u32 = id.x + id.y * u32(params.row_vertex_count);\n\n    if(id.x > 0 && id.y > 0) {\n        let indexIndex = ((id.x - 1) + (id.y - 1) * (params.row_vertex_count - 1)) * 6;\n\n        indices[indexIndex + 0] = index - 1;\n        indices[indexIndex + 1] = index - params.row_vertex_count - 1;\n        indices[indexIndex + 2] = index;\n\n        indices[indexIndex + 3] = index;\n        indices[indexIndex + 4] = index - params.row_vertex_count - 1;\n        indices[indexIndex + 5] = index - params.row_vertex_count;\n    }\n}"},{bindingsMapping:{indices:{group:0,binding:0},params:{group:0,binding:1}}}),[4,nN(function(){return t.isReady()},H.Z.COMPUTE_SHADER_READY_MAX_RETRY,10)];case 1:return r.sent(),[2,new n(t,e)]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){nL(a,r,o,i,u,"next",e)}function u(e){nL(a,r,o,i,u,"throw",e)}i(void 0)})})()}}],e&&nU(n.prototype,e),t&&nU(n,t),n}();function nG(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function nj(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nD(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}nF(nB,"WORKGROUP_SIZE",[16,16]);var nH=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");nD(this,"computeShader",void 0),nD(this,"paramsBuffer",void 0),this.computeShader=e,this.paramsBuffer=new nC.M(t),this.paramsBuffer.addUniform("row_vertex_count",1),this.computeShader.setUniformBuffer("params",this.paramsBuffer)}return e=[{key:"dispatch",value:function(e,t,r){this.computeShader.setStorageBuffer("positions",t);var o=new nI.N(r,Float32Array.BYTES_PER_ELEMENT*e*e*3,tJ.g.BUFFER_CREATIONFLAG_VERTEX|tJ.g.BUFFER_CREATIONFLAG_READWRITE);return this.computeShader.setStorageBuffer("normals",o),this.paramsBuffer.updateUInt("row_vertex_count",e),this.paramsBuffer.update(),this.computeShader.dispatch(e/n.WORKGROUP_SIZE[0],e/n.WORKGROUP_SIZE[1],1),o}}],t=[{key:"New",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return t=new nO.U("squareGridNormalComputer",e,{computeSource:"//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nstruct Params {\n    row_vertex_count : u32,\n};\n\n@group(0) @binding(0) var<storage, read> positions: array<f32>; // x,y,z triples\n@group(0) @binding(1) var<storage, read_write> normals: array<f32>; // x,y,z triples\n@group(0) @binding(2) var<uniform> params: Params;\n\n// helper to load a position at grid (i,j)\nfn load_position(i: u32, j: u32, row_vertex_count: u32) -> vec3<f32> {\n    let iidx = (i + j * row_vertex_count) * 3u;\n    return vec3<f32>(\n        positions[iidx + 0u],\n        positions[iidx + 1u],\n        positions[iidx + 2u]\n    );\n}\n\n@compute @workgroup_size(16,16)\nfn main(@builtin(global_invocation_id) id: vec3<u32>) {\n    let x = id.x;\n    let y = id.y;\n    let row_vertex_count = params.row_vertex_count;\n    if (x >= row_vertex_count || y >= row_vertex_count) {\n        return;\n    }\n\n    // linear index of this vertex\n    let idx = x + y * row_vertex_count;\n\n    // get neighbor coords with clamped forward/backward differences\n    let x_left = select(x - 1u, 0u, x == 0u);\n    let x_right = min(x + 1u, row_vertex_count - 1u);\n    let y_down = select(y - 1u, 0u, y == 0u);\n    let y_up = min(y + 1u, row_vertex_count - 1u);\n\n    // fetch neighbor positions\n    let position_left = load_position(x_left, y, row_vertex_count);\n    let position_right = load_position(x_right, y, row_vertex_count);\n    let position_down = load_position(x, y_down, row_vertex_count);\n    let position_up = load_position(x, y_up, row_vertex_count);\n\n    // approximate tangents via finite differencing\n    let tangent_x = position_right - position_left;\n    let tangent_y = position_up - position_down;\n\n    // normal is cross of the two tangents\n    let normal = normalize(cross(tangent_y, tangent_x));\n\n    // write back\n    let buffer_index = idx * 3u;\n    normals[buffer_index + 0u] = normal.x;\n    normals[buffer_index + 1u] = normal.y;\n    normals[buffer_index + 2u] = normal.z;\n}\n"},{bindingsMapping:{positions:{group:0,binding:0},normals:{group:0,binding:1},params:{group:0,binding:2}}}),[4,nN(function(){return t.isReady()},H.Z.COMPUTE_SHADER_READY_MAX_RETRY,10)];case 1:return r.sent(),[2,new n(t,e)]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){nG(a,r,o,i,u,"next",e)}function u(e){nG(a,r,o,i,u,"throw",e)}i(void 0)})})()}}],e&&nj(n.prototype,e),t&&nj(n,t),n}();nD(nH,"WORKGROUP_SIZE",[16,16]);var nV=n(3472);function nz(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function nW(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nZ(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var nY=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");nZ(this,"computeShader",void 0),nZ(this,"paramsBuffer",void 0),nZ(this,"terrainModelBuffer",void 0),this.computeShader=e,this.paramsBuffer=new nC.M(t),this.paramsBuffer.addUniform("nbVerticesPerRow",1),this.paramsBuffer.addUniform("size",1),this.paramsBuffer.addUniform("direction",1),this.paramsBuffer.addUniform("chunk_position_on_cube",3),this.paramsBuffer.addUniform("sphere_radius",1),this.paramsBuffer.addUniform("chunk_position_on_sphere",3),this.paramsBuffer.update(),this.computeShader.setUniformBuffer("params",this.paramsBuffer),this.terrainModelBuffer=new nC.M(t),this.terrainModelBuffer.addUniform("min_height",1),this.terrainModelBuffer.addUniform("max_height",1),this.computeShader.setUniformBuffer("terrainModel",this.terrainModelBuffer);var r=new nV.a;r.setParameters(),r.samplingMode=tJ.g.TEXTURE_BILINEAR_SAMPLINGMODE,r.useMipMaps=!1,this.computeShader.setTextureSampler("heightMapSampler",r)}return e=[{key:"dispatch",value:function(e,t,r,o,a,i,u,s){this.paramsBuffer.updateUInt("nbVerticesPerRow",r),this.paramsBuffer.updateVector3("chunk_position_on_cube",e),this.paramsBuffer.updateVector3("chunk_position_on_sphere",t),this.paramsBuffer.updateFloat("sphere_radius",a),this.paramsBuffer.updateUInt("direction",o),this.paramsBuffer.updateFloat("size",i),this.paramsBuffer.update(),this.terrainModelBuffer.updateFloat("min_height",u.minHeight),this.terrainModelBuffer.updateFloat("max_height",u.maxHeight),this.terrainModelBuffer.update(),this.computeShader.setTexture("heightMap",u.heightMap.texture,!1);var l=new nI.N(s,Float32Array.BYTES_PER_ELEMENT*r*r*3,tJ.g.BUFFER_CREATIONFLAG_VERTEX|tJ.g.BUFFER_CREATIONFLAG_READWRITE);return this.computeShader.setStorageBuffer("positions",l),this.computeShader.dispatch(r/n.WORKGROUP_SIZE[0],r/n.WORKGROUP_SIZE[1],1),l}}],t=[{key:"New",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return t=new nO.U("sphericalHeightMapTextureComputeShader",e,{computeSource:"//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nstruct Params {\n    nbVerticesPerRow : u32,\n    size : f32,\n    direction: u32,\n    chunk_position_on_cube : vec3<f32>,\n    sphere_radius : f32,\n    chunk_position_on_sphere : vec3<f32>,\n};\n\nstruct TerrainModel {\n    min_height: f32,\n    max_height: f32,\n}\n\n@group(0) @binding(0) var<storage, read_write> positions : array<f32>;\n@group(0) @binding(1) var<uniform> params : Params;\n@group(0) @binding(2) var heightMap : texture_2d<f32>;\n@group(0) @binding(3) var heightMapSampler : sampler;\n@group(0) @binding(4) var<uniform> terrainModel : TerrainModel;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nconst PI : f32 = 3.141592653589793;\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfn get_vertex_position_on_cube(chunk_position_on_cube: vec3<f32>, direction: u32, offset: vec2<f32>) -> vec3<f32> {\n    switch (direction) {\n        case 0: { // UP\n            return chunk_position_on_cube + vec3<f32>(offset.x, 0.0, offset.y);\n        }\n        case 1: { // DOWN\n            return chunk_position_on_cube + vec3<f32>(offset.y, 0.0, offset.x);\n        }\n        case 2: { // LEFT\n            return chunk_position_on_cube + vec3<f32>(0.0, offset.x, offset.y);\n        }\n        case 3: { // RIGHT\n            return chunk_position_on_cube + vec3<f32>(0.0, offset.y, offset.x);\n        }\n        case 4: { // FORWARD\n            return chunk_position_on_cube + vec3<f32>(offset.x, offset.y, 0.0);\n        }\n        default: { // BACKWARD\n            return chunk_position_on_cube + vec3<f32>(offset.y, offset.x, 0.0);\n        }\n    }\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Maps a position on the cube to a point on the unit sphere.\n * @see https://catlikecoding.com/unity/tutorials/cube-sphere/\n */\nfn map_cube_to_unit_sphere(position_on_cube: vec3<f32>) -> vec3<f32> {\n    /*let p = position_on_cube / (params.sphere_radius);\n    let x2 = p.x*p.x;\n    let y2 = p.y*p.y;\n    let z2 = p.z*p.z;\n\n    return vec3(\n        p.x * sqrt(1.0 - 0.5*(y2+z2) + (y2*z2)/3.0),\n        p.y * sqrt(1.0 - 0.5*(z2+x2) + (z2*x2)/3.0),\n        p.z * sqrt(1.0 - 0.5*(x2+y2) + (x2*y2)/3.0)\n    );*/\n\n    return normalize(position_on_cube);\n}\n\nfn remap(value: f32, old_min: f32, old_max: f32, new_min: f32, new_max: f32) -> f32 {\n    return new_min + (value - old_min) * (new_max - new_min) / (old_max - old_min);\n}\n\nfn sphere_to_uv(sphere_position: vec3<f32>) -> vec2<f32> {\n    let theta = acos(sphere_position.y);\n    let phi = atan2(sphere_position.z, sphere_position.x);\n    let u = (phi + PI) / (2.0 * PI);\n    let v = (theta) / PI;\n\n    return vec2<f32>(u, v);\n}\n\n@compute @workgroup_size(16,16,1)\nfn main(@builtin(global_invocation_id) id: vec3<u32>) {\n    if (id.x >= params.nbVerticesPerRow || id.y >= params.nbVerticesPerRow) { \n        return; \n    }\n\n    let vertex_offset_01 = vec2<f32>(f32(id.x), f32(id.y)) / f32(params.nbVerticesPerRow - 1);\n    let vertex_offset_centered = params.size * vec2<f32>(0.5 - vertex_offset_01.x, vertex_offset_01.y - 0.5);\n\n    let vertex_position_on_cube = get_vertex_position_on_cube(params.chunk_position_on_cube, params.direction, vertex_offset_centered);\n\n    let sphere_up = map_cube_to_unit_sphere(vertex_position_on_cube);\n\n    var uv = sphere_to_uv(sphere_up);\n    uv.x = 1.0 - uv.x; // Flip the x coordinate to match the texture coordinates\n\n    let heightMapSample : vec4<f32> = textureSampleLevel(heightMap, heightMapSampler, uv, 0.0);\n    \n    let vertex_position_on_sphere = sphere_up * params.sphere_radius;\n\n    let elevation = remap(heightMapSample.r, 0.0, 1.0, terrainModel.min_height, terrainModel.max_height);\n\n    let final_position = vertex_position_on_sphere + sphere_up * elevation - params.chunk_position_on_sphere;\n\n    let index: u32 = id.x + id.y * u32(params.nbVerticesPerRow);\n    positions[index * 3 + 0] = final_position.x;\n    positions[index * 3 + 1] = final_position.y;\n    positions[index * 3 + 2] = final_position.z;\n}"},{bindingsMapping:{positions:{group:0,binding:0},params:{group:0,binding:1},heightMap:{group:0,binding:2},heightMapSampler:{group:0,binding:3},terrainModel:{group:0,binding:4}}}),[4,nN(function(){return t.isReady()},H.Z.COMPUTE_SHADER_READY_MAX_RETRY,10)];case 1:return r.sent(),[2,new n(t,e)]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){nz(a,r,o,i,u,"next",e)}function u(e){nz(a,r,o,i,u,"throw",e)}i(void 0)})})()}}],e&&nW(n.prototype,e),t&&nW(n,t),n}();function nX(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function nq(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nK(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}nZ(nY,"WORKGROUP_SIZE",[16,16]);var nQ=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");nK(this,"computeShader",void 0),nK(this,"paramsBuffer",void 0),nK(this,"terrainModelBuffer",void 0),this.computeShader=e,this.paramsBuffer=new nC.M(t),this.paramsBuffer.addUniform("nbVerticesPerRow",1),this.paramsBuffer.addUniform("size",1),this.paramsBuffer.addUniform("direction",1),this.paramsBuffer.addUniform("chunk_position_on_cube",3),this.paramsBuffer.addUniform("sphere_radius",1),this.paramsBuffer.addUniform("chunk_position_on_sphere",3),this.paramsBuffer.update(),this.computeShader.setUniformBuffer("params",this.paramsBuffer),this.terrainModelBuffer=new nC.M(t),this.terrainModelBuffer.addUniform("min_height",1),this.terrainModelBuffer.addUniform("max_height",1),this.computeShader.setUniformBuffer("terrainModel",this.terrainModelBuffer);var r=new nV.a;r.setParameters(),r.samplingMode=tJ.g.TEXTURE_BILINEAR_SAMPLINGMODE,r.useMipMaps=!1,r.wrapU=tJ.g.TEXTURE_CLAMP_ADDRESSMODE,r.wrapV=tJ.g.TEXTURE_CLAMP_ADDRESSMODE,this.computeShader.setTextureSampler("heightMapSampler",r)}return e=[{key:"dispatch",value:function(e,t,r,o,a,i,u,s){this.paramsBuffer.updateUInt("nbVerticesPerRow",r),this.paramsBuffer.updateVector3("chunk_position_on_cube",e),this.paramsBuffer.updateVector3("chunk_position_on_sphere",t),this.paramsBuffer.updateFloat("sphere_radius",a),this.paramsBuffer.updateUInt("direction",o),this.paramsBuffer.updateFloat("size",i),this.paramsBuffer.update(),this.terrainModelBuffer.updateFloat("min_height",u.minHeight),this.terrainModelBuffer.updateFloat("max_height",u.maxHeight),this.terrainModelBuffer.update(),this.computeShader.setTexture("heightMap_0_0",u.heightMap.textures[0][0],!1),this.computeShader.setTexture("heightMap_0_1",u.heightMap.textures[0][1],!1),this.computeShader.setTexture("heightMap_0_2",u.heightMap.textures[0][2],!1),this.computeShader.setTexture("heightMap_0_3",u.heightMap.textures[0][3],!1),this.computeShader.setTexture("heightMap_1_0",u.heightMap.textures[1][0],!1),this.computeShader.setTexture("heightMap_1_1",u.heightMap.textures[1][1],!1),this.computeShader.setTexture("heightMap_1_2",u.heightMap.textures[1][2],!1),this.computeShader.setTexture("heightMap_1_3",u.heightMap.textures[1][3],!1);var l=new nI.N(s,Float32Array.BYTES_PER_ELEMENT*r*r*3,tJ.g.BUFFER_CREATIONFLAG_VERTEX|tJ.g.BUFFER_CREATIONFLAG_READWRITE);return this.computeShader.setStorageBuffer("positions",l),this.computeShader.dispatch(r/n.WORKGROUP_SIZE[0],r/n.WORKGROUP_SIZE[1],1),l}}],t=[{key:"New",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return t=new nO.U("sphericalHeightMap2x4ComputeShader",e,{computeSource:"//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nstruct Params {\n    nbVerticesPerRow : u32,\n    size : f32,\n    direction: u32,\n    chunk_position_on_cube : vec3<f32>,\n    sphere_radius : f32,\n    chunk_position_on_sphere : vec3<f32>,\n};\n\nstruct TerrainModel {\n    min_height: f32,\n    max_height: f32,\n}\n\n@group(0) @binding(0) var<storage, read_write> positions : array<f32>;\n@group(0) @binding(1) var<uniform> params : Params;\n@group(0) @binding(2) var heightMapSampler : sampler;\n@group(0) @binding(3) var<uniform> terrainModel : TerrainModel;\n\n@group(1) @binding(0) var heightMap_0_0 : texture_2d<f32>;\n@group(1) @binding(1) var heightMap_0_1 : texture_2d<f32>;\n@group(1) @binding(2) var heightMap_0_2 : texture_2d<f32>;\n@group(1) @binding(3) var heightMap_0_3 : texture_2d<f32>;\n@group(1) @binding(4) var heightMap_1_0 : texture_2d<f32>;\n@group(1) @binding(5) var heightMap_1_1 : texture_2d<f32>;\n@group(1) @binding(6) var heightMap_1_2 : texture_2d<f32>;\n@group(1) @binding(7) var heightMap_1_3 : texture_2d<f32>;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nconst PI : f32 = 3.141592653589793;\n\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfn get_vertex_position_on_cube(chunk_position_on_cube: vec3<f32>, direction: u32, offset: vec2<f32>) -> vec3<f32> {\n    switch (direction) {\n        case 0: { // UP\n            return chunk_position_on_cube + vec3<f32>(offset.x, 0.0, offset.y);\n        }\n        case 1: { // DOWN\n            return chunk_position_on_cube + vec3<f32>(offset.y, 0.0, offset.x);\n        }\n        case 2: { // LEFT\n            return chunk_position_on_cube + vec3<f32>(0.0, offset.x, offset.y);\n        }\n        case 3: { // RIGHT\n            return chunk_position_on_cube + vec3<f32>(0.0, offset.y, offset.x);\n        }\n        case 4: { // FORWARD\n            return chunk_position_on_cube + vec3<f32>(offset.x, offset.y, 0.0);\n        }\n        default: { // BACKWARD\n            return chunk_position_on_cube + vec3<f32>(offset.y, offset.x, 0.0);\n        }\n    }\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Maps a position on the cube to a point on the unit sphere.\n * @see https://catlikecoding.com/unity/tutorials/cube-sphere/\n */\nfn map_cube_to_unit_sphere(position_on_cube: vec3<f32>) -> vec3<f32> {\n    /*let p = position_on_cube / (params.sphere_radius);\n    let x2 = p.x*p.x;\n    let y2 = p.y*p.y;\n    let z2 = p.z*p.z;\n\n    return vec3(\n        p.x * sqrt(1.0 - 0.5*(y2+z2) + (y2*z2)/3.0),\n        p.y * sqrt(1.0 - 0.5*(z2+x2) + (z2*x2)/3.0),\n        p.z * sqrt(1.0 - 0.5*(x2+y2) + (x2*y2)/3.0)\n    );*/\n\n    return normalize(position_on_cube);\n}\n\nfn remap(value: f32, old_min: f32, old_max: f32, new_min: f32, new_max: f32) -> f32 {\n    return new_min + (value - old_min) * (new_max - new_min) / (old_max - old_min);\n}\n\nfn sphere_to_uv(sphere_position: vec3<f32>) -> vec2<f32> {\n    let theta = acos(sphere_position.y);\n    let phi = atan2(sphere_position.z, sphere_position.x);\n    let u = (phi + PI) / (2.0 * PI);\n    let v = (theta) / PI;\n\n    return vec2<f32>(u, v);\n}\n\nfn sample_height_map(uv: vec2<f32>) -> vec4<f32> {\n    let uv_scaled = uv * vec2<f32>(4.0, 2.0); // Scale UV to match the 2x4 height map layout\n    \n    let tile_x = floor(uv_scaled.x);\n    let tile_y = floor(uv_scaled.y);\n    let tile_index = u32(tile_x) + u32(tile_y) * 4u; // 4 tiles in the x direction, 2 in the y direction\n\n    let uv_in_tile = fract(uv_scaled);\n\n    switch (tile_index) {\n        case 0: {\n            return textureSampleLevel(heightMap_0_0, heightMapSampler, uv_in_tile, 0.0);\n        }\n        case 1: {\n            return textureSampleLevel(heightMap_0_1, heightMapSampler, uv_in_tile, 0.0);\n        }\n        case 2: {\n            return textureSampleLevel(heightMap_0_2, heightMapSampler, uv_in_tile, 0.0);\n        }\n        case 3: {\n            return textureSampleLevel(heightMap_0_3, heightMapSampler, uv_in_tile, 0.0);\n        }\n        case 4: {\n            return textureSampleLevel(heightMap_1_0, heightMapSampler, uv_in_tile, 0.0);\n        }\n        case 5: {\n            return textureSampleLevel(heightMap_1_1, heightMapSampler, uv_in_tile, 0.0);\n        }\n        case 6: {\n            return textureSampleLevel(heightMap_1_2, heightMapSampler, uv_in_tile, 0.0);\n        }\n        default: { // case 7\n            return textureSampleLevel(heightMap_1_3, heightMapSampler, uv_in_tile, 0.0);\n        }\n    }\n}\n\n@compute @workgroup_size(16,16,1)\nfn main(@builtin(global_invocation_id) id: vec3<u32>) {\n    if (id.x >= params.nbVerticesPerRow || id.y >= params.nbVerticesPerRow) { \n        return; \n    }\n\n    let vertex_offset_01 = vec2<f32>(f32(id.x), f32(id.y)) / f32(params.nbVerticesPerRow - 1);\n    let vertex_offset_centered = params.size * vec2<f32>(0.5 - vertex_offset_01.x, vertex_offset_01.y - 0.5);\n\n    let vertex_position_on_cube = get_vertex_position_on_cube(params.chunk_position_on_cube, params.direction, vertex_offset_centered);\n\n    let sphere_up = map_cube_to_unit_sphere(vertex_position_on_cube);\n    \n    var uv = sphere_to_uv(sphere_up);\n    uv.x = 1.0 - uv.x; // Flip the x coordinate to match the texture coordinates\n\n    let heightMapSample : vec4<f32> = sample_height_map(uv);\n    \n    let vertex_position_on_sphere = sphere_up * params.sphere_radius;\n\n    let elevation = remap(heightMapSample.r, 0.0, 1.0, terrainModel.min_height, terrainModel.max_height);\n\n    let final_position = vertex_position_on_sphere + sphere_up * elevation - params.chunk_position_on_sphere;\n\n    let index: u32 = id.x + id.y * u32(params.nbVerticesPerRow);\n    positions[index * 3 + 0] = final_position.x;\n    positions[index * 3 + 1] = final_position.y;\n    positions[index * 3 + 2] = final_position.z;\n}"},{bindingsMapping:{positions:{group:0,binding:0},params:{group:0,binding:1},heightMapSampler:{group:0,binding:2},terrainModel:{group:0,binding:3},heightMap_0_0:{group:1,binding:0},heightMap_0_1:{group:1,binding:1},heightMap_0_2:{group:1,binding:2},heightMap_0_3:{group:1,binding:3},heightMap_1_0:{group:1,binding:4},heightMap_1_1:{group:1,binding:5},heightMap_1_2:{group:1,binding:6},heightMap_1_3:{group:1,binding:7}}}),[4,nN(function(){return t.isReady()},H.Z.COMPUTE_SHADER_READY_MAX_RETRY,10)];case 1:return r.sent(),[2,new n(t,e)]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){nX(a,r,o,i,u,"next",e)}function u(e){nX(a,r,o,i,u,"throw",e)}i(void 0)})})()}}],e&&nq(n.prototype,e),t&&nq(n,t),n}();function nJ(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function n$(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n0(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}nK(nQ,"WORKGROUP_SIZE",[16,16]);var n1=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");n0(this,"computeShader",void 0),n0(this,"chunkBuffer",void 0),n0(this,"terrainModel",void 0),this.computeShader=e,this.chunkBuffer=new nC.M(t),this.chunkBuffer.addUniform("row_vertex_count",1),this.chunkBuffer.addUniform("size",1),this.chunkBuffer.addUniform("face_index",1),this.chunkBuffer.addUniform("position_on_cube",3),this.chunkBuffer.addUniform("up_direction",3),this.chunkBuffer.update(),this.computeShader.setUniformBuffer("chunk",this.chunkBuffer),this.terrainModel=new nC.M(t),this.terrainModel.addUniform("seed",1),this.terrainModel.addUniform("radius",1),this.terrainModel.addUniform("continental_crust_elevation",1),this.terrainModel.addUniform("continental_crust_fraction",1),this.terrainModel.addUniform("mountain_elevation",1),this.terrainModel.addUniform("mountain_terrace_elevation",1),this.terrainModel.addUniform("mountain_erosion",1),this.terrainModel.addUniform("craters_octave_count",1),this.terrainModel.addUniform("craters_sparsity",1),this.terrainModel.update(),this.computeShader.setUniformBuffer("terrain_model",this.terrainModel)}return e=[{key:"dispatch",value:function(e,t,r,o,a,i,u,s){this.chunkBuffer.updateUInt("row_vertex_count",r),this.chunkBuffer.updateVector3("position_on_cube",e),this.chunkBuffer.updateVector3("up_direction",t.normalizeToNew()),this.chunkBuffer.updateUInt("face_index",o),this.chunkBuffer.updateFloat("size",i),this.chunkBuffer.update(),this.terrainModel.updateFloat("seed",u.seed),this.terrainModel.updateFloat("radius",a),this.terrainModel.updateFloat("continental_crust_elevation",u.continentalCrust.elevation),this.terrainModel.updateFloat("continental_crust_fraction",u.continentalCrust.fraction),this.terrainModel.updateFloat("mountain_elevation",u.mountain.elevation),this.terrainModel.updateFloat("mountain_terrace_elevation",u.mountain.terraceElevation),this.terrainModel.updateFloat("mountain_erosion",u.mountain.erosion),this.terrainModel.updateUInt("craters_octave_count",u.craters.octaveCount),this.terrainModel.updateFloat("craters_sparsity",u.craters.sparsity),this.terrainModel.update();var l=new nI.N(s,Float32Array.BYTES_PER_ELEMENT*r*r*3,tJ.g.BUFFER_CREATIONFLAG_VERTEX|tJ.g.BUFFER_CREATIONFLAG_READWRITE);return this.computeShader.setStorageBuffer("positions",l),this.computeShader.dispatch(r/n.WORKGROUP_SIZE[0],r/n.WORKGROUP_SIZE[1],1),l}}],t=[{key:"New",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return t=new nO.U("heightMap",e,{computeSource:'//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nstruct Chunk {\n    row_vertex_count: u32,\n    size: f32,\n    face_index: u32,\n    position_on_cube: vec3<f32>,\n    up_direction: vec3<f32>,\n};\n\nstruct ProceduralTerrainModel {\n    seed: f32,\n    radius: f32,\n    continental_crust_elevation: f32,\n    continental_crust_fraction: f32,\n    mountain_elevation: f32,\n    mountain_terrace_elevation: f32,\n    mountain_erosion: f32,\n    craters_octave_count: u32,\n    craters_sparsity: f32,\n}\n\n@group(0) @binding(0) var<storage, read_write> positions: array<f32>;\n@group(0) @binding(1) var<uniform> chunk: Chunk;\n@group(0) @binding(2) var<uniform> terrain_model: ProceduralTerrainModel;\n\nfn remap(value: f32, old_min: f32, old_max: f32, new_min: f32, new_max: f32) -> f32 {\n    return new_min + (value - old_min) * (new_max - new_min) / (old_max - old_min);\n}\n\n// The MIT License\n// Copyright \xa9 2017 Inigo Quilez\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n// https://www.youtube.com/c/InigoQuilez\n// https://iquilezles.org/\n\n// Computes the analytic derivatives of a 3D Gradient Noise. This can be used for example to compute normals to a\n// 3d rocks based on Gradient Noise without approximating the gradient by having to take central differences.\n//\n// More info here: https://iquilezles.org/articles/gradientnoise\n\n// All noise functions here:\n//\n// https://www.shadertoy.com/playlist/fXlXzf&from=0&num=12\n\n// From https://www.shadertoy.com/view/4djSRW\n// Name : Hash without Sine\n// Author : Dave_Hoskins\n// License : MIT\n// Why not normal hash? Because terrible for planets, and that is what I am using this for.\nfn hash33(p3: vec3<f32>) -> vec3<f32> {\n	var p3_mod = fract(p3 * vec3<f32>(.1031, .1030, .0973));\n    p3_mod += dot(p3_mod, p3_mod.yxz+33.33);\n    return 1.0 - 2.0 * fract((p3_mod.xxy + p3_mod.yxx)*p3_mod.zyx);\n\n}\n\n// return value noise (in x) and its derivatives (in yzw)\nfn gradient_noise_3d(x : vec3<f32>) -> vec4<f32> {\n    // grid\n    let i = floor(x);\n    let f = fract(x);\n    \n    // quintic interpolant\n    let u = f*f*f*(f*(f*6.0-15.0)+10.0);\n    let du = 30.0*f*f*(f*(f-2.0)+1.0);\n    \n    // gradients\n    let ga = hash33(i + vec3<f32>(0.0, 0.0, 0.0));\n    let gb = hash33(i + vec3<f32>(1.0, 0.0, 0.0));\n    let gc = hash33(i + vec3<f32>(0.0, 1.0, 0.0));\n    let gd = hash33(i + vec3<f32>(1.0, 1.0, 0.0));\n    let ge = hash33(i + vec3<f32>(0.0, 0.0, 1.0));\n    let gf = hash33(i + vec3<f32>(1.0, 0.0, 1.0));\n    let gg = hash33(i + vec3<f32>(0.0, 1.0, 1.0));\n    let gh = hash33(i + vec3<f32>(1.0, 1.0, 1.0));\n    \n    // projections\n    let va = dot(ga, f - vec3<f32>(0.0, 0.0, 0.0));\n    let vb = dot(gb, f - vec3<f32>(1.0, 0.0, 0.0));\n    let vc = dot(gc, f - vec3<f32>(0.0, 1.0, 0.0));\n    let vd = dot(gd, f - vec3<f32>(1.0, 1.0, 0.0));\n    let ve = dot(ge, f - vec3<f32>(0.0, 0.0, 1.0));\n    let vf = dot(gf, f - vec3<f32>(1.0, 0.0, 1.0));\n    let vg = dot(gg, f - vec3<f32>(0.0, 1.0, 1.0));\n    let vh = dot(gh, f - vec3<f32>(1.0, 1.0, 1.0));\n	\n    // interpolations\n    let k0 = va - vb - vc + vd;\n    let g0 = ga - gb - gc + gd;\n    let k1 = va - vc - ve + vg;\n    let g1 = ga - gc - ge + gg;\n    let k2 = va - vb - ve + vf;\n    let g2 = ga - gb - ge + gf;\n    let k3 = -va + vb + vc - vd + ve - vf - vg + vh;\n    let g3 = -ga + gb + gc - gd + ge - gf - gg + gh;\n    let k4 = vb - va;\n    let g4 = gb - ga;\n    let k5 = vc - va;\n    let g5 = gc - ga;\n    let k6 = ve - va;\n    let g6 = ge - ga;\n    \n    return vec4f( va + k4*u.x + k5*u.y + k6*u.z + k0*u.x*u.y + k1*u.y*u.z + k2*u.z*u.x + k3*u.x*u.y*u.z,    // value\n                 ga + g4*u.x + g5*u.y + g6*u.z + g0*u.x*u.y + g1*u.y*u.z + g2*u.z*u.x + g3*u.x*u.y*u.z +   // derivatives\n                 du * (vec3f(k4,k5,k6) + \n                       vec3f(k0,k1,k2)*u.yzx +\n                       vec3f(k2,k0,k1)*u.zxy +\n                       k3*u.yzx*u.zxy ));\n}\n\nfn gradient_noise_3d_fbm(p: vec3<f32>, octave_count: u32) -> f32 {\n    var sample_position = p;\n    var octave_amplitude = 1.0;\n    var total_amplitude = 0.0;\n    var result = 0.0;\n    for(var i = 0u; i < octave_count; i+=1u) {\n        result += gradient_noise_3d(sample_position).x * octave_amplitude;\n        total_amplitude += octave_amplitude;\n\n        sample_position *= 2.0;\n        octave_amplitude /= 2.0;\n    }\n\n    return result / total_amplitude;\n}\n\n// Approx inverse-CDF for single-octave gradient/Perlin-like noise remapped to [0,1].\n// Input:  p = desired coverage (e.g. 0.70 means 70% water)\n// Return: threshold t so that ~p of samples fall <= t for this noise.\nfn invert_noise_threshold(p: f32) -> f32 {\n    let k: f32 = 4.50;                 // sharpness 1.5..1.7 works well for 3D gradient noise\n    let x: f32 = clamp(p, 1e-6, 1.0-1e-6);\n    let l: f32 = log(x/(1.0 - x));     // logit\n    return 1.0 / (1.0 + exp(-l / k));  // logistic(logit(p)/k)\n}\n\n//3D MODIFICATION OF "ERODED TERRAIN NOISE" By clayjohn : https://www.shadertoy.com/view/MtGcWh\n//I Would recommend starting there for an understanding of the code, the changes were minor, but\n//I felt like making this available.\n\n//ORIGINAL COPYRIGHT DISCLAIMER\n\n//Copyright 2020 Clay John\n\n//Permission is hereby granted, free of charge, to any person obtaining a copy of this software \n//and associated documentation files (the "Software"), to deal in the Software without restriction, \n//including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, \n//and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do \n//so, subject to the following conditions:\n\n//The above copyright notice and this permission notice shall be included in all copies or \n//substantial portions of the Software.\n\n//THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT \n//NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. \n//IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, \n//WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE \n//SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n//GRADIENT 3D NOISE DERIVATIVES SCENE/PREVIEW BY IQ : https://www.shadertoy.com/view/4dffRH\n\nconst erosionscale: f32 = 4.0;\n\n// code modified from https://www.shadertoy.com/view/4tB3RR\n// Name : Gavoronoise 3d\n// Author : guil\n// License : // License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\nfn erosion(p: vec3<f32>, dir: vec3<f32>) -> vec4<f32> {    \n    let ip = floor(p);\n    let fp = fract(p);\n    let f = 4.0*3.14159265359;//frequency (PI constant)\n    var va: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);\n    var wt: f32 = 0.0;\n    \n    for (var i: i32 = -2; i <= 1; i++) { \n        for (var j: i32 = -2; j <= 1; j++) {\n            for (var k: i32 = -2; k <= 1; k++) {		\n                let o = vec3<f32>(f32(i), f32(j), f32(k));\n                let h = hash33((ip - o))*.5;\n                let pp = fp + o - h;\n                let d = dot(pp, pp);\n                let w = exp(-d*8.0);\n                wt += w;\n                let mag = dot(pp, dir);\n                va += vec4<f32>(cos(mag*f), -sin(mag*f)*(pp+dir))*w;\n            }\n        }\n    }\n    \n    return va/wt;\n}\n\n\n//Modified to have erosionscale and it to be 3D\nfn mountain(p: vec3<f32>, nor: vec3<f32>, erosion_amount: f32) -> f32 {\n\n    var n: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);\n    var nf: f32 = 1.0;\n    var na: f32 = 0.6;\n    for (var i: i32 = 0; i < 3; i++) {\n       n += gradient_noise_3d(p*nf)*na*vec4<f32>(1.0, nf, nf, nf);\n       na *= 0.5;\n       nf *= 2.0;\n    }\n\n    let noise_before_erosion_01 = smoothstep(-1.0, 1.0, n.x);\n\n    if(erosion_amount <= 0.0) {\n        return noise_before_erosion_01;\n    }\n    \n    //take the curl of the normal to get the gradient facing down the slope\n    let dir = cross(n.yzw, nor);\n    \n    //Now we compute another fbm type noise\n    // erosion is a type of noise with a strong directionality\n    //we pass in the direction based on the slope of the terrain\n    //erosion also returns the slope. we add that to a running total\n    //so that the direction of successive layers are based on the\n    //past layers\n    var h: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);\n    var a: f32 = 0.7*(smoothstep(0.3, 0.5, n.x*0.5+0.5)); //smooth the valleys\n    var f: f32 = 1.0;\n    for (var i: i32 = 0; i < 4; i++) {\n        h += erosion(p*erosionscale*f, dir+cross(h.yzw, normalize(p)))*a*vec4<f32>(1.0, f, f, f);\n        a *= 0.6;\n        f *= 2.0;\n    }\n    //remap height to [0,1] and add erosion\n    //looks best when erosion amount is small\n    //not sure about adding the normals together, but it looks okay\n    return noise_before_erosion_01 + h.x * 0.01 * erosion_amount;\n}\n\nfn hash( p : vec3f ) -> f32 {\n    return fract(sin(p.x*15.32758341+p.y*39.786792357+p.z*59.4583127+7.5312) * 43758.236237153)-0.5;\n}\n\nfn hash3( p : vec3f ) -> vec3f {\n    return vec3f(hash(p), hash(p+1.5), hash(p+2.5));\n}\n\nfn voronoi_noise_3d( p : vec3f ) -> f32 {    \n    let ip = floor(p);\n    let fp = fract(p);\n    var rid = -1.0;\n    var r = vec2f(2.0);\n    for (var i = -1; i <= 0; i++) {\n        for (var j = -1; j <= 0; j++) {\n            for (var k = -1; k <= 0; k++) {\n                let g = vec3f(f32(i), f32(j), f32(k));\n                //let h = hash(ip - g);\n                let pp = fp + g + hash3(ip - g) * 0.6;\n                let d = dot(pp, pp);\n\n                if (d < r.x) {\n                    r.y = r.x;\n                    r.x = d;\n                    // rid = h + 0.5;\n                } else if (d < r.y) {\n                    r.y = d;\n                }\n            }\n        }\n    }\n    return r.x;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfn crater_noise_3d(p : vec3f, sparsity: f32) -> f32 {\n    // modulate the crater size with some noise\n    let shrink_factor = 4.0 * remap(gradient_noise_3d(p * 0.1).x, -1.0, 1.0, 0.2, 1.8);\n\n    // break the perfect circle with some noise for a more natural look\n    let noisy_boundary_factor = 1.0 + gradient_noise_3d_fbm(p * 4.0, 3) * 0.8;\n\n    // normalized distance to the center of the crater (with noise modulations)\n    let v = voronoi_noise_3d(p / sparsity) * pow(sparsity, 2.0) * shrink_factor * noisy_boundary_factor;\n\n    let central_hill = 0.8 * exp(-sqrt(v) * 10.0);\n\n    let border_slope = smoothstep(0.5, 0.7, v);\n\n    let slope_bump = 10.0 * pow(1.0 - smoothstep(0.0, 1.0, v), 2.0) + 1.0;\n\n    return central_hill + border_slope * slope_bump;\n}\n\nfn crater_noise_3d_fbm(p: vec3<f32>, sparsity: f32, octave_count: u32, lacunarity: f32, decay: f32) -> f32 {\n    var sample_position = p;\n    var octave_amplitude = 1.0;\n    var total_amplitude = 0.0;\n    var result = 0.0;\n    for(var i = 0u; i < octave_count; i+=1u) {\n        result += crater_noise_3d(sample_position, sparsity) * octave_amplitude;\n        total_amplitude += octave_amplitude;\n\n        sample_position *= lacunarity;\n        octave_amplitude /= decay;\n    }\n\n    return result / total_amplitude;\n}\n\n\n// from https://www.shadertoy.com/view/4djSRW\n//  3 out, 1 in...\nfn hash31(p: f32) -> vec3<f32> {\n   var p3 = fract(vec3<f32>(p) * vec3<f32>(.1031, .1030, .0973));\n   p3 += dot(p3, p3.yzx+33.33);\n   return fract((p3.xxy+p3.yzz)*p3.zyx); \n}\n\nfn smootherstep(a: f32, b: f32, x: f32) -> f32 {\n    let t = clamp((x - a) / (b - a), 0.0, 1.0);\n    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n\nfn planet_height_field(p: vec3<f32>, terrain_model: ProceduralTerrainModel) -> f32 {\n    let noise_sampling_point = p + (hash31(terrain_model.seed) - 0.5) * 1e8;\n\n    let continent_noise = gradient_noise_3d_fbm(noise_sampling_point / 3000e3, 10);\n\n    let fjord_noise = abs(gradient_noise_3d_fbm(noise_sampling_point / 600e3, 3));\n\n    let mountain_noise = mountain(noise_sampling_point * 0.0001, normalize(p), terrain_model.mountain_erosion);\n\n    let mountain_mask = 0.05 + 0.95 * smoothstep(0.5, 0.6, remap(gradient_noise_3d_fbm(noise_sampling_point / 1000e3  + gradient_noise_3d(noise_sampling_point / 1000e3).yzw, 5), -1.0, 1.0, 0.0, 1.0));\n\n    let terrace_mask = smoothstep(0.4, 0.6, remap(gradient_noise_3d(noise_sampling_point / 2000e3).x, -1.0, 1.0, 0.0, 1.0));\n\n    let terrace_height_variation = gradient_noise_3d_fbm(noise_sampling_point / 5e3, 3);\n\n    let crater_noise = crater_noise_3d_fbm(noise_sampling_point / 500e3, terrain_model.craters_sparsity, terrain_model.craters_octave_count, 2.0, 1.3);\n\n    let continent_mask = remap(continent_noise, -1.0, 1.0, 0.0, 1.0);\n\n    let continental_crust_elevation = terrain_model.continental_crust_elevation;\n\n    let ocean_threshold = invert_noise_threshold(1.0 - terrain_model.continental_crust_fraction);\n\n    let continent_smoothness = 0.01;\n\n    let continent_sharp_mask = smootherstep(ocean_threshold - continent_smoothness, ocean_threshold + continent_smoothness, continent_mask);\n\n    let fjord_penetration = 0.05;\n\n    let continent_fjord_mask = continent_sharp_mask * (1.0 - smootherstep(ocean_threshold, ocean_threshold + fjord_penetration, continent_mask));\n\n    let fjord_width_threshold = 0.03;\n\n    let fjord_noise_sharpened = smootherstep(0.0, fjord_width_threshold * remap(continent_fjord_mask, 0.0, 1.0, 0.3, 1.0), fjord_noise);\n\n    let fjord_elevation = (terrain_model.continental_crust_elevation + terrain_model.mountain_elevation) * remap(fjord_noise_sharpened, 0.0, 1.0, -1.0, 0.0) * continent_fjord_mask;\n    \n    let mountain_elevation = terrain_model.mountain_elevation * mountain_noise * continent_sharp_mask * mountain_mask;\n\n    let terrace_height = 5e3 + terrace_height_variation * 2e3;\n\n    let terrace_elevation = terrain_model.mountain_terrace_elevation * smoothstep(terrace_height - 10.0, terrace_height + 10.0, mountain_elevation) * terrace_mask;\n\n    let continent_elevation = continental_crust_elevation * clamp(continent_sharp_mask + continent_mask, 0.0, 1.0);\n\n    let craters_elevation = 10e3 * (crater_noise - 1.0);\n\n    return continent_elevation + fjord_elevation + mountain_elevation + terrace_elevation + craters_elevation;\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nfn get_vertex_position_on_cube(chunk_position_on_cube: vec3<f32>, direction: u32, offset: vec2<f32>) -> vec3<f32> {\n    switch (direction) {\n        case 0: { // UP\n            return chunk_position_on_cube + vec3<f32>(offset.x, 0.0, offset.y);\n        }\n        case 1: { // DOWN\n            return chunk_position_on_cube + vec3<f32>(offset.y, 0.0, offset.x);\n        }\n        case 2: { // LEFT\n            return chunk_position_on_cube + vec3<f32>(0.0, offset.x, offset.y);\n        }\n        case 3: { // RIGHT\n            return chunk_position_on_cube + vec3<f32>(0.0, offset.y, offset.x);\n        }\n        case 4: { // FORWARD\n            return chunk_position_on_cube + vec3<f32>(offset.x, offset.y, 0.0);\n        }\n        default: { // BACKWARD\n            return chunk_position_on_cube + vec3<f32>(offset.y, offset.x, 0.0);\n        }\n    }\n}\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Maps a position on the cube to a point on the unit sphere.\n * @see https://catlikecoding.com/unity/tutorials/cube-sphere/\n */\nfn map_cube_to_unit_sphere(position_on_cube: vec3<f32>) -> vec3<f32> {\n    /*let p = position_on_cube / (params.sphere_radius);\n    let x2 = p.x*p.x;\n    let y2 = p.y*p.y;\n    let z2 = p.z*p.z;\n\n    return vec3(\n        p.x * sqrt(1.0 - 0.5*(y2+z2) + (y2*z2)/3.0),\n        p.y * sqrt(1.0 - 0.5*(z2+x2) + (z2*x2)/3.0),\n        p.z * sqrt(1.0 - 0.5*(x2+y2) + (x2*y2)/3.0)\n    );*/\n\n    return normalize(position_on_cube);\n}\n\n@compute @workgroup_size(16,16,1)\nfn main(@builtin(global_invocation_id) id: vec3<u32>) {\n    if (id.x >= chunk.row_vertex_count || id.y >= chunk.row_vertex_count) { \n        return;\n    }\n\n    let vertex_offset_01 = vec2<f32>(f32(id.x), f32(id.y)) / f32(chunk.row_vertex_count - 1u);\n    let vertex_offset_centered = chunk.size * vec2<f32>(0.5 - vertex_offset_01.x, vertex_offset_01.y - 0.5);\n\n    let vertex_position_on_cube = get_vertex_position_on_cube(chunk.position_on_cube, chunk.face_index, vertex_offset_centered);\n    let vertex_up = normalize(vertex_position_on_cube);\n\n    let elevation = planet_height_field(vertex_up * terrain_model.radius, terrain_model);\n\n    let final_position = (vertex_up - chunk.up_direction) * terrain_model.radius + vertex_up * elevation;\n\n    let index: u32 = id.x + id.y * chunk.row_vertex_count;\n    positions[index*3u + 0u] = final_position.x;\n    positions[index*3u + 1u] = final_position.y;\n    positions[index*3u + 2u] = final_position.z;\n}'},{bindingsMapping:{positions:{group:0,binding:0},chunk:{group:0,binding:1},terrain_model:{group:0,binding:2}}}),[4,nN(function(){return t.isReady()},H.Z.COMPUTE_SHADER_READY_MAX_RETRY,10)];case 1:return r.sent(),[2,new n(t,e)]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){nJ(a,r,o,i,u,"next",e)}function u(e){nJ(a,r,o,i,u,"throw",e)}i(void 0)})})()}}],e&&n$(n.prototype,e),t&&n$(n,t),n}();function n2(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n3(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function n4(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n5(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n0(n1,"WORKGROUP_SIZE",[16,16]);var n6=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");n5(this,"tasks",[]),n5(this,"workers",void 0),n5(this,"dispatchWorker",void 0),n5(this,"outputs",[]),n5(this,"currentWorkLoad",new Map),this.workers=e,this.dispatchWorker=t}return e=[{key:"push",value:function(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.tasks).push.apply(e,function(e){if(Array.isArray(e))return n2(e)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return n2(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return n2(e,t)}}(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}},{key:"update",value:function(){var e=this,t=!0,n=!1,r=void 0;try{for(var o,a,i=this.workers[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var u=(o=this,function(){var t=a.value;if(o.currentWorkLoad.has(t))return"continue";var n=o.tasks.shift();if(void 0===n)return{v:void 0};var r=o.dispatchWorker(t,n).then(function(t){e.outputs.push(t)}).catch(function(e){console.error("Error while processing task with worker:",t,e)}).finally(function(){e.currentWorkLoad.delete(t)});o.currentWorkLoad.set(t,r)}());if("object"==(u&&"undefined"!=typeof Symbol&&u.constructor===Symbol?"symbol":typeof u))return u.v}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"consumeOutputs",value:function(){for(var e=this.outputs.length,t=[],n=0;n<e;n++){var r=this.outputs.shift();if(void 0===r)break;t.push(r)}return t}},{key:"reset",value:function(){this.tasks.length=0,this.outputs.length=0,this.currentWorkLoad.clear()}}],t=[{key:"New",value:function(e,t,r){var o;return(o=function(){var o,a,i;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(u){switch(u.label){case 0:o=[],a=0,u.label=1;case 1:if(!(a<e))return[3,4];return[4,t()];case 2:i=u.sent(),o.push(i),u.label=3;case 3:return a++,[3,1];case 4:return[2,new n(o,r)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=o.apply(e,t);function i(e){n3(a,n,r,i,u,"next",e)}function u(e){n3(a,n,r,i,u,"throw",e)}i(void 0)})})()}}],e&&n4(n.prototype,e),t&&n4(n,t),n}();function n7(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n8(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function n9(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){n8(a,r,o,i,u,"next",e)}function u(e){n8(a,r,o,i,u,"throw",e)}i(void 0)})}}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){rt(e,t,n[t])})}return e}function rr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function ro(e){return function(e){if(Array.isArray(e))return n7(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n7(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return n7(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ra(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var ri=function(){var e,t;function n(e,t,r,o,a,i){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");rt(this,"proceduralHeightFieldComputePool",void 0),rt(this,"custom1x1HeightFieldComputePool",void 0),rt(this,"custom2x4HeightFieldComputePool",void 0),rt(this,"normalComputePool",void 0),rt(this,"gridIndices",void 0),rt(this,"cache",void 0),rt(this,"outputs",void 0),rt(this,"applyQueue",[]),rt(this,"heightMapAtlas",void 0),rt(this,"rowVertexCount",void 0),this.proceduralHeightFieldComputePool=e.heightFieldProcedural,this.custom1x1HeightFieldComputePool=e.heightField1x1,this.custom2x4HeightFieldComputePool=e.heightField2x4,this.normalComputePool=e.normal,this.gridIndices=t,this.heightMapAtlas=i,this.outputs=r,this.cache=o,this.rowVertexCount=a}return e=[{key:"pushTask",value:function(e,t,n,r,o,a,i){this.outputs.set(e,{status:"pending"});var u={id:e,positionOnCube:t,positionOnSphere:n,faceIndex:r,size:o,sphereRadius:a};switch(i.type){case"procedural":this.proceduralHeightFieldComputePool.push(rr(rn({},u),{terrainModel:i}));break;case"custom":this.addCustomHeightFieldTask(u,i)}}},{key:"addCustomHeightFieldTask",value:function(e,t){var n=this.heightMapAtlas.getHeightMap(t.id);switch(n.type){case"1x1":this.custom1x1HeightFieldComputePool.push(rr(rn({},e),{heightRange:t.heightRange,heightMap:n}));break;case"2x4":this.custom2x4HeightFieldComputePool.push(rr(rn({},e),{heightRange:t.heightRange,heightMap:n}))}}},{key:"updatePositions",value:function(){this.proceduralHeightFieldComputePool.update();var e,t,n,r=this.proceduralHeightFieldComputePool.consumeOutputs();(e=this.normalComputePool).push.apply(e,ro(r)),this.custom2x4HeightFieldComputePool.update();var o=this.custom2x4HeightFieldComputePool.consumeOutputs();(t=this.normalComputePool).push.apply(t,ro(o)),this.custom1x1HeightFieldComputePool.update();var a=this.custom1x1HeightFieldComputePool.consumeOutputs();(n=this.normalComputePool).push.apply(n,ro(a))}},{key:"updateNormals",value:function(){this.normalComputePool.update();var e,t=this.normalComputePool.consumeOutputs();(e=this.applyQueue).push.apply(e,ro(t))}},{key:"applyAllReady",value:function(){for(;this.applyQueue.length>0;){var e=this.applyQueue.shift();if(void 0===e)break;this.outputs.set(e.id,{status:"completed",rowVertexCount:this.rowVertexCount,positions:e.positions,normals:e.normals,indices:this.gridIndices})}}},{key:"update",value:function(){this.updatePositions(),this.updateNormals(),this.applyAllReady()}},{key:"reset",value:function(){var e=this.proceduralHeightFieldComputePool.consumeOutputs(),t=!0,n=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)o.value.positions.gpu.dispose()}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}this.proceduralHeightFieldComputePool.reset();var i=this.custom1x1HeightFieldComputePool.consumeOutputs(),u=!0,s=!1,l=void 0;try{for(var c,f=i[Symbol.iterator]();!(u=(c=f.next()).done);u=!0)c.value.positions.gpu.dispose()}catch(e){s=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(s)throw l}}this.custom1x1HeightFieldComputePool.reset();var p=this.custom2x4HeightFieldComputePool.consumeOutputs(),d=!0,h=!1,v=void 0;try{for(var m,b=p[Symbol.iterator]();!(d=(m=b.next()).done);d=!0)m.value.positions.gpu.dispose()}catch(e){h=!0,v=e}finally{try{d||null==b.return||b.return()}finally{if(h)throw v}}this.custom2x4HeightFieldComputePool.reset();var y=this.normalComputePool.consumeOutputs(),g=!0,w=!1,_=void 0;try{for(var T,x=y[Symbol.iterator]();!(g=(T=x.next()).done);g=!0){var S=T.value;S.normals.gpu.dispose(),S.positions.gpu.dispose()}}catch(e){w=!0,_=e}finally{try{g||null==x.return||x.return()}finally{if(w)throw _}}this.normalComputePool.reset(),this.cache.positions.clear(),this.cache.normals.clear(),this.outputs.clear(),this.applyQueue.length=0}},{key:"getOutput",value:function(e){return this.outputs.get(e)}}],t=[{key:"New",value:function(e,t,r,o){return n9(function(){var a;return ra(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,n.NewUnsafe(e,t,r,o)];case 1:return[2,e7.ok.apply(void 0,[i.sent()])];case 2:return console.error("Failed to create ChunkForgeCompute:",a=i.sent()),[2,(0,e7.cn)(a)];case 3:return[2]}})})()}},{key:"NewUnsafe",value:function(e,t,r,o){return n9(function(){var a,i,u,s,l,c,f,p;return ra(this,function(d){switch(d.label){case 0:return a=new Map,i={positions:new nE(H.Z.MAX_CACHED_CHUNKS,function(e,t){t.gpu.getBuffer().references--,0===t.gpu.getBuffer().references&&t.gpu.dispose(),a.delete(e)}),normals:new nE(H.Z.MAX_CACHED_CHUNKS,function(e,t){t.gpu.getBuffer().references--,0===t.gpu.getBuffer().references&&t.gpu.dispose(),a.delete(e)})},[4,n6.New(e,function(){return n1.New(o)},function(e,n){return n9(function(){var r,a,u,s;return ra(this,function(l){switch(l.label){case 0:if(void 0!==(r=i.positions.get(n.id)))return[2,{id:n.id,positions:r}];return[4,(a=e.dispatch(n.positionOnCube,n.positionOnSphere,t,n.faceIndex,n.sphereRadius,n.size,n.terrainModel,o)).read()];case 1:return u=l.sent(),s={gpu:a,cpu:new Float32Array(u.buffer)},i.positions.set(n.id,s),[2,{id:n.id,positions:s}]}})})()})];case 1:return u=d.sent(),[4,n6.New(e,function(){return nY.New(o)},function(e,n){return n9(function(){var r,a,u,s;return ra(this,function(l){switch(l.label){case 0:if(void 0!==(r=i.positions.get(n.id)))return[2,{id:n.id,positions:r}];return[4,(a=e.dispatch(n.positionOnCube,n.positionOnSphere,t,n.faceIndex,n.sphereRadius,n.size,{maxHeight:n.heightRange.max,minHeight:n.heightRange.min,heightMap:n.heightMap},o)).read()];case 1:return u=l.sent(),s={gpu:a,cpu:new Float32Array(u.buffer)},i.positions.set(n.id,s),[2,{id:n.id,positions:s}]}})})()})];case 2:return s=d.sent(),[4,n6.New(e,function(){return nQ.New(o)},function(e,n){return n9(function(){var r,a,u,s;return ra(this,function(l){switch(l.label){case 0:if(void 0!==(r=i.positions.get(n.id)))return[2,{id:n.id,positions:r}];return[4,(a=e.dispatch(n.positionOnCube,n.positionOnSphere,t,n.faceIndex,n.sphereRadius,n.size,{maxHeight:n.heightRange.max,minHeight:n.heightRange.min,heightMap:n.heightMap},o)).read()];case 1:return u=l.sent(),s={gpu:a,cpu:new Float32Array(u.buffer)},i.positions.set(n.id,s),[2,{id:n.id,positions:s}]}})})()})];case 3:return l=d.sent(),[4,n6.New(e,function(){return nH.New(o)},function(e,n){return n9(function(){var r,a,u,s;return ra(this,function(l){switch(l.label){case 0:if(void 0!==(r=i.normals.get(n.id)))return[2,{id:n.id,normals:r,positions:n.positions}];return[4,(a=e.dispatch(t,n.positions.gpu,o)).read()];case 1:return u=l.sent(),s={gpu:a,cpu:new Float32Array(u.buffer)},i.normals.set(n.id,s),[2,{id:n.id,normals:s,positions:n.positions}]}})})()})];case 4:return c=d.sent(),[4,nB.New(o)];case 5:return[4,(f=d.sent().dispatch(t,o)).read()];case 6:return p=new Uint32Array(d.sent().buffer),[2,new n({heightFieldProcedural:u,heightField1x1:s,heightField2x4:l,normal:c},{gpu:f,cpu:p},a,i,t,r)]}})})()}}],e&&re(n.prototype,e),t&&re(n,t),n}(),ru=n(82134),rs=n(61012);function rl(e,t,n){var r,o,a,i,u,s,l,c,f,p,d,h=e.type;switch(h){case"texture_2d":return(0,rs.RZ)(e.texture,t,n);case"texture_2d_array_mosaic":return r=e,o=t,a=n,i=(0,rs.f)(r.tileCount.x),u=(0,rs.f)(r.tileCount.y),s=(0,rs.dC)(o,(0,rs.K4)(i,u)),c=(l=(0,rs.Vl)((0,rs.GW)(s))).x,f=l.y,p=(0,rs.IH)(c,(0,rs.dC)(f,i)),d=(0,rs.ZI)(s),(0,rs.J_)(r.array,d,p,a);default:(0,e7.UT)(h)}}var rc={InversePlanetWorld:"inversePlanetWorld"},rf=function(){var e;function t(e,n,r){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");a=void 0,(o="material")in this?Object.defineProperty(this,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):this[o]=a,this.material=new ru.O("CustomPlanetMaterial",r);var o,a,i,u,s,l,c,f,p=(0,rs.Ou)("position"),d=(0,rs.Ou)("normal"),h=(0,rs.V9)(),v=(0,rs.zZ)(h,p),m=(0,rs.Yo)(h,d),b=(0,rs.G6)(rc.InversePlanetWorld,S.y3.Identity()),y=(0,rs.zZ)(b,v),g=(0,rs.fQ)(),w=(0,rs.zZ)(g,v),_=(0,rs.dr)(w);this.material.addOutputNode(_);var T=(i=(0,rs.Fv)(y,{target:rs.Vz.FRAG}),u=(0,rs.Vl)(i),s=(0,rs.Kh)(u.y),l=(0,rs.fv)(u.z,u.x),c=(0,rs.hi)((0,rs.IH)(l,(0,rs.f)(Math.PI)),(0,rs.f)(2*Math.PI)),f=(0,rs.hi)(s,(0,rs.f)(Math.PI)),(0,rs.TS)((0,rs.lu)((0,rs.f)(1),c),f,null,null).xyOut),x=rl(e,T,{convertToLinearSpace:!0}),P=rl(n,T),R=(0,rs.Tm)(),A=(0,rs.TE)(R,(0,rs.Vl)(v).xyzOut),E=(0,rs.CW)((0,rs.f)(1e5),(0,rs.f)(3e5),A),I=(0,rs.LB)(T,v,m,P.rgb,E),O=(0,rs.Cf)(),C=(0,rs.Jb)(x.rgb,(0,rs.f)(0),(0,rs.f)(1),null,I,m,O,R,v),k=(0,rs.lp)(C);this.material.addOutputNode(k),this.material.build()}return e=[{key:"setPlanetInverseWorld",value:function(e){var t=this.material.getInputBlockByPredicate(function(e){return e.name===rc.InversePlanetWorld});if(null===t)return void console.warn("Input block ".concat(rc.InversePlanetWorld," not found in material."));t.value=e}},{key:"get",value:function(){return this.material}},{key:"dispose",value:function(){this.material.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),rp=n(27987),rd=n(8655),rh=n(31913),rv=n(82961);function rm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function rb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ry=function(){var e;function t(e,n,r,o,a,i,u){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");rb(this,"id",void 0),rb(this,"indices",void 0),rb(this,"mesh",void 0),rb(this,"material",void 0),rb(this,"faceIndex",void 0),rb(this,"sphereRadius",void 0),rb(this,"sideLength",void 0),rb(this,"loadingState","not_started"),rb(this,"children",null),rb(this,"parent",void 0),rb(this,"positionOnCube",void 0),rb(this,"geometry",null),rb(this,"terrainModel",void 0),rb(this,"scene",void 0),this.id="".concat(o.name,"->d").concat(n,"->l").concat(e.lod,"->[x").concat(e.x,";y").concat(e.y,"]"),this.mesh=new e2.Kj(this.id,u),this.mesh.isPickable=!1,this.mesh.parent=o,this.mesh.material=i,this.material=i,this.parent=o,this.indices=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){rb(e,t,n[t])})}return e}({},e),this.terrainModel=a,this.mesh.position.x=-r+2*r*(e.x+.5)/Math.pow(2,e.lod),this.mesh.position.y=-r+2*r*(e.y+.5)/Math.pow(2,e.lod),this.mesh.position.z=r,this.mesh.position.applyRotationQuaternionInPlace((0,rd.W)(n)),this.positionOnCube=this.mesh.position.clone(),this.mesh.position.normalize().scaleInPlace(r),this.faceIndex=n,this.sphereRadius=r,this.sideLength=2*r/Math.pow(2,e.lod),this.mesh.setEnabled(!1),this.scene=u}return e=[{key:"setVertexData",value:function(e,t,n){e.positions.gpu.getBuffer().references++,e.normals.gpu.getBuffer().references++,e.indices.gpu.getBuffer().references++;var r=new rh.o(n,e.positions.gpu.getBuffer(),"position",!1,!1,3);this.mesh.setVerticesBuffer(r);var o=new rh.o(n,e.normals.gpu.getBuffer(),"normal",!1,!1,3);this.mesh.setVerticesBuffer(o),this.mesh.setIndexBuffer(e.indices.gpu.getBuffer(),t*t,(t-1)*(t-1)*6,!0);var a=[S.P.FromArray(e.positions.cpu),S.P.FromArray(e.positions.cpu,(t-1)*3),S.P.FromArray(e.positions.cpu,(t-1)*t*3),S.P.FromArray(e.positions.cpu,((t-1)*t+(t-1))*3)],i=!0,u=!1,s=void 0;try{for(var l,c=a[Symbol.iterator]();!(i=(l=c.next()).done);i=!0)l.value.addInPlace(this.mesh.position)}catch(e){u=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(u)throw s}}var f=a[0].add(a[1]).add(a[2]).add(a[3]).scaleInPlace(.25),p=0,d=!0,h=!1,v=void 0;try{for(var m,b=a[Symbol.iterator]();!(d=(m=b.next()).done);d=!0){var y=m.value;p=Math.max(p,S.P.Distance(f,y))}}catch(e){h=!0,v=e}finally{try{d||null==b.return||b.return()}finally{if(h)throw v}}var g=Math.max(S.P.Distance(a[0],a[1]),S.P.Distance(a[1],a[3]),S.P.Distance(a[3],a[2]),S.P.Distance(a[2],a[0]));p+=g*g/(8*this.sphereRadius);var w=2*this.sideLength/(t-1);this.geometry={buffers:e,boundsPlanetSpace:{corners:a,center:f,radius:p},error:w}}},{key:"subdivide",value:function(){for(var e=this,n=[],r=0;r<2;r++)for(var o=0;o<2;o++)n.push({x:2*this.indices.x+o,y:2*this.indices.y+r,lod:this.indices.lod+1});var a=n.map(function(n){return new t(n,e.faceIndex,e.sphereRadius,e.parent,e.terrainModel,e.material,e.scene)});if(void 0===a[0]||void 0===a[1]||void 0===a[2]||void 0===a[3])throw Error("Failed to create all children for SphericalHeightFieldChunk.");this.children=[a[0],a[1],a[2],a[3]]}},{key:"updateLoadingState",value:function(e){if("completed"!==this.loadingState){var t=e.getOutput(this.id);if(void 0!==t){if("pending"===t.status)return;this.setVertexData(t,e.rowVertexCount,this.mesh.getScene().getEngine()),this.loadingState="completed";return}this.loadingState="in_progress",e.pushTask(this.id,this.positionOnCube,this.mesh.position,this.faceIndex,this.sideLength,this.sphereRadius,this.terrainModel)}}},{key:"updateSubdivision",value:function(e){if(null!==this.geometry){var t=e.fovMode===rv.V.FOVMODE_VERTICAL_FIXED?e.fov:e.fov*e.viewport.height/e.viewport.width,n=e.viewport.height*e.getEngine().getRenderHeight()/(2*Math.tan(.5*t)),r=this.parent.getWorldMatrix().clone().invert(),o=S.P.TransformCoordinates(e.globalPosition,r),a=this.geometry.boundsPlanetSpace.center,i=this.geometry.boundsPlanetSpace.radius,u=Math.max(.001,o.subtract(a).length()-i),s=this.geometry.error*n/u,l=Math.ceil(Math.log2(2*this.sphereRadius/(H.Z.MIN_DISTANCE_BETWEEN_VERTICES*(this.geometry.buffers.rowVertexCount-1))));if(null===this.children&&s>=16&&this.indices.lod<l)this.subdivide();else if(null!==this.children&&s<=8&&"completed"===this.getLoadingState()){var c=!0,f=!1,p=void 0;try{for(var d,h=this.children[Symbol.iterator]();!(c=(d=h.next()).done);c=!0)d.value.dispose()}catch(e){f=!0,p=e}finally{try{c||null==h.return||h.return()}finally{if(f)throw p}}this.children=null}}}},{key:"update",value:function(e,t){if(this.updateLoadingState(t),this.updateSubdivision(e),null!==this.children){var n=!0,r=!0,o=!1,a=void 0;try{for(var i,u=this.children[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var s=i.value;s.update(e,t),"completed"!==s.getLoadingState()&&(n=!1)}}catch(e){o=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}this.getTransform().setEnabled(!n)}else"completed"===this.getLoadingState()&&this.getTransform().setEnabled(!0)}},{key:"getTransform",value:function(){return this.mesh}},{key:"getLoadingState",value:function(){return this.loadingState}},{key:"getAllChildren",value:function(){if(null===this.children)return[];var e=function(e){if(Array.isArray(e))return rm(e)}(o=this.children)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return rm(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rm(e,t)}}(o)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),t=!0,n=!1,r=void 0;try{for(var o,a,i=this.children[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var u=a.value;e=e.concat(u.getAllChildren())}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}},{key:"dispose",value:function(){var e;this.getTransform().dispose(),null==(e=this.children)||e.forEach(function(e){e.dispose()})}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function rg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function rw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r_=function(){var e;function t(e,n,r,o,a){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");rw(this,"transform",void 0),rw(this,"sides",void 0),this.transform=new rp.Y(e,a),this.transform.rotationQuaternion=S._f.Identity();var i={x:0,y:0,lod:0};this.sides=[new ry(i,rd.N.UP,n,this.getTransform(),r,o,a),new ry(i,rd.N.DOWN,n,this.getTransform(),r,o,a),new ry(i,rd.N.FORWARD,n,this.getTransform(),r,o,a),new ry(i,rd.N.BACKWARD,n,this.getTransform(),r,o,a),new ry(i,rd.N.LEFT,n,this.getTransform(),r,o,a),new ry(i,rd.N.RIGHT,n,this.getTransform(),r,o,a)]}return e=[{key:"getTransform",value:function(){return this.transform}},{key:"update",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var a,i=this.sides[Symbol.iterator]();!(n=(a=i.next()).done);n=!0)a.value.update(e,t)}catch(e){r=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}}},{key:"getAllChunks",value:function(){var e=function(e){if(Array.isArray(e))return rg(e)}(o=this.sides)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return rg(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rg(e,t)}}(o)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),t=!0,n=!1,r=void 0;try{for(var o,a,i=this.sides[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var u=a.value;e=e.concat(u.getAllChildren())}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}},{key:"isIdle",value:function(){var e=this.getAllChunks(),t=e.filter(function(e){return 0===e.getAllChildren().length});return e.every(function(e){return"completed"===e.getLoadingState()})&&t.every(function(e){return e.getTransform().isEnabled()})}},{key:"dispose",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.sides[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)r.value.dispose()}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.transform.dispose()}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function rT(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function rx(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){rT(a,r,o,i,u,"next",e)}function u(e){rT(a,r,o,i,u,"throw",e)}i(void 0)})}}function rS(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function rP(e,t){return rx(function(){var n,o,a,i,u,s,l,c,f,p,d,h,v,m,b,y,g,w,T,x,S,P,R,A,E,I,O,C,N,L,U,F,B,G;return rS(this,function(j){var D,H,V,z,W,Z;switch(j.label){case 0:return(o=new r.Scene(e)).useRightHandedSystem=!0,o.defaultCursor="default",o.clearColor.set(0,0,0,1),[4,(0,n_.q)(o,t)];case 1:return a=j.sent(),i=(0,nw.U)(o),[4,tQ(o,t)];case 2:if(u=j.sent(),l=(s=e1([])).radius,(c=new _.Q(o)).getTransform().position=new r.Vector3(0,5,-10).normalize().scale(3*l),c.getTransform().lookAt(r.Vector3.Zero()),c.speed=l/3,(f=c.getActiveCamera()).minZ=.01,f.maxZ=0,f.attachControl(),o.activeCamera=f,null==(n=e.getRenderingCanvas())||n.addEventListener("click",function(){return rx(function(){var t;return rS(this,function(n){switch(n.label){case 0:return[4,null==(t=e.getRenderingCanvas())?void 0:t.requestPointerLock()];case 1:return n.sent(),[2]}})})()}),o.enableDepthRenderer(null,!0,!0).clearColor.set(0,0,0,1),(p=new r.PointLight("light",new r.Vector3(10,2,-10).normalize().scale(10*l),o)).falloffType=r.Light.FALLOFF_STANDARD,p.intensity=4,new r.LightGizmo().light=p,(d=new r.GizmoManager(o)).positionGizmoEnabled=!0,d.rotationGizmoEnabled=!0,d.boundingBoxGizmoEnabled=!0,d.usePointerToAttachGizmos=!1,!(h=null===new URLSearchParams(window.location.search).get("light")))return[3,5];return[4,(D=o,ny(function(){var n;return ng(this,function(r){switch(r.label){case 0:return[4,t7([ne,nt,nn,nr,no,na,ni,nu],D,e,t)];case 1:if(!(n=r.sent()).success)return[2,n];return[2,(0,e7.ok)({type:"texture_2d_array_mosaic",array:n.value,tileCount:{x:4,y:2}})]}})})())];case 3:if(!(b=j.sent()).success)throw Error("Failed to create albedo texture array: ".concat(String(b.error)));return[4,(H=o,ny(function(){var n;return ng(this,function(r){switch(r.label){case 0:return[4,t7([ns,nl,nc,nf,np,nd,nh,nv],H,e,t)];case 1:if(!(n=r.sent()).success)return[2,n];return[2,(0,e7.ok)({type:"texture_2d_array_mosaic",array:n.value,tileCount:{x:4,y:2}})]}})})())];case 4:if(!(y=j.sent()).success)throw Error("Failed to create normal map texture array: ".concat(String(y.error)));return v=b.value,m=y.value,[3,8];case 5:return g={type:"texture_2d"},[4,(V=o,ny(function(){return ng(this,function(e){return[2,(0,e8.Z)("EarthColorMap8k",t9,V,t)]})})())];case 6:return g.texture=j.sent(),v=g,w={type:"texture_2d"},[4,(z=o,ny(function(){return ng(this,function(e){return[2,(0,e8.Z)("EarthNormalMap8k",nm,z,t)]})})())];case 7:w.texture=j.sent(),m=w,j.label=8;case 8:if(T=new rf(v,m,o),S=new r_("SphericalHeightFieldTerrain",l,x={type:"custom",heightRange:{min:-11e3,max:8600},id:"earth"},T.get(),o),P=new tj(u,o),!h)return[3,10];return[4,P.loadHeightMapsToGpu([x.id],t)];case 9:j.sent(),j.label=10;case 10:return[4,ri.New(6,64,P,e)];case 11:if(!(R=j.sent()).success)throw Error("Failed to create chunk forge: ".concat(String(R.error)));return A=R.value,E=new nP.C(l,0),I=new nS.A(S.getTransform(),l,E,[p],a,o),f.attachPostProcess(I),O=new nT.cj(s.clouds,i.cloudsLut,o),C=new nx.w(S.getTransform(),l,O,[p],o),f.attachPostProcess(C),N=new k.r(l,s.mass,298,s.atmosphere),L=new M.C(S.getTransform(),l,N,[p],o),f.attachPostProcess(L),[4,(W=o,(Z=function(){var e,n,r,o,a,i,u;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(s){switch(s.label){case 0:return[4,(0,e3.v)("ISS",e4,W,t)];case 1:var l,c;if(l=n=(e=s.sent()).rootNodes[0],null!=(c=e2.Kj)&&"undefined"!=typeof Symbol&&c[Symbol.hasInstance]?!c[Symbol.hasInstance](l):!(l instanceof c))throw Error("ISS root node is not a Mesh");n.isVisible=!1,r=!0,o=!1,a=void 0;try{for(i=n.getChildMeshes()[Symbol.iterator]();!(r=(u=i.next()).done);r=!0)u.value.isVisible=!1}catch(e){o=!0,a=e}finally{try{r||null==i.return||i.return()}finally{if(o)throw a}}return e.addAllToScene(),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var o=Z.apply(e,t);function a(e){e5(o,n,r,a,i,"next",e)}function i(e){e5(o,n,r,a,i,"throw",e)}a(void 0)})})())];case 12:if(null===(U=j.sent().instantiateHierarchy()))throw Error("Failed to load ISS model.");return null!==new URLSearchParams(window.location.search).get("iss")&&(c.getTransform().parent=U,c.getTransform().position=new r.Vector3(100,0,-100),c.getTransform().lookAt(r.Vector3.Zero()),c.speed=10),F=new eL(S.getTransform(),{id:"earth",name:"Earth",type:eC.o.CUSTOM,orbit:{parentIds:[],semiMajorAxis:0,eccentricity:0,inclination:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0,p:1},mass:s.mass,siderealDaySeconds:s.siderealDaySeconds,axialTilt:s.axialTilt}),B=new eL(U,{id:"iss",name:"International Space Station",type:eC.o.CUSTOM,orbit:{parentIds:[],semiMajorAxis:6771e3,eccentricity:1e-4,inclination:Math.PI/180*51.64,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0,p:2},mass:42e4,siderealDaySeconds:0,axialTilt:0}),G=0,o.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;G+=t,c.update(t),S.update(f,A),A.update(),I.update(t);var n=(0,ek.ng)(B,[F],r.Matrix.Identity(),G),a=(0,ek.ng)(B,[F],r.Matrix.Identity(),G+10).subtract(n).scaleInPlace(.1);d=S.getTransform().position.subtract(n).normalize(),h=a.normalizeToNew(),v=r.Vector3.Cross(d,h).normalize(),m=r.Quaternion.FromRotationMatrix(r.Matrix.FromXYZAxesToRef(h,v,d,new r.Matrix)),U.rotationQuaternion=r.Quaternion.RotationYawPitchRoll(0,r.Tools.ToRadians(-6),r.Tools.ToRadians(.9)).multiply(m),U.position=n,c.getTransform().computeWorldMatrix(!0),f.getViewMatrix(!0);var i=f.globalPosition.clone(),u=function(e){var t=new Set,n=!0,r=!1,o=void 0;try{for(var a,i=e.meshes[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var u=a.value;null===u.parent&&t.add(u)}}catch(e){r=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}var s=!0,l=!1,c=void 0;try{for(var f,p=e.transformNodes[Symbol.iterator]();!(s=(f=p.next()).done);s=!0){var d=f.value;null===d.parent&&t.add(d)}}catch(e){l=!0,c=e}finally{try{s||null==p.return||p.return()}finally{if(l)throw c}}return t}(o),s=!0,l=!1,p=void 0;try{for(var d,h,v,m,b,y=u[Symbol.iterator]();!(s=(b=y.next()).done);s=!0){var g=b.value;g.position.subtractInPlace(i),g.computeWorldMatrix(!0)}}catch(e){l=!0,p=e}finally{try{s||null==y.return||y.return()}finally{if(l)throw p}}T.setPlanetInverseWorld(S.getTransform().computeWorldMatrix(!0).clone().invert())}),[4,new Promise(function(t){var n=e.onBeginFrameObservable.add(function(){S.update(f,A),A.update(),S.isIdle()&&(n.remove(),t())})})];case 13:return j.sent(),[2,o]}})})()}function rR(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function rA(e){return{id:"jupiter",name:"Jupiter",type:eC.o.GAS_PLANET,radius:69911e3,mass:1898e24,axialTilt:eO.w1.ToRadians(3.13),siderealDaySeconds:35730,orbit:{parentIds:function(e){if(Array.isArray(e))return rR(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return rR(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rR(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),semiMajorAxis:7785472e5,eccentricity:.0934,inclination:eO.w1.ToRadians(1.85),longitudeOfAscendingNode:eO.w1.ToRadians(49.558),argumentOfPeriapsis:eO.w1.ToRadians(286.502),initialMeanAnomaly:0,p:2},atmosphere:{seaLevelPressure:1e5,greenHouseEffectFactor:.7,gasMix:[["H2",.9],["He",.1]],aerosols:{tau550:.1,angstromExponent:.3,particleRadius:75e-8,settlingCoefficient:1}},colorPalette:{type:"textured",textureId:"jupiter"},rings:null,seed:0}}function rE(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function rI(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(p){switch(p.label){case 0:return(n=new r.Scene(e)).useRightHandedSystem=!0,n.clearColor.set(0,0,0,1),[4,(0,$.j)(n,t)];case 1:return o=p.sent(),[4,E(n)];case 2:return p.sent(),i=(a=new _.Q(n)).getActiveCamera(),a.speed=66e6,i.maxZ*=66e6,a.getTransform().setAbsolutePosition(new r.Vector3(0,1,-2).scaleInPlace(66e6)),a.getTransform().lookAt(r.Vector3.Zero()),i.attachControl(),n.enableDepthRenderer(null,!0,!0).clearColor.set(0,0,0,1),(u=new r.PointLight("light1",new r.Vector3(7,5,-10).scaleInPlace(66e6),n)).falloffType=r.Light.FALLOFF_STANDARD,s=rA([]),l=new eh._(function(){return new ef.h(n)}),c=new ed.v(s,o,l,n),f=new M.C(c.getTransform(),c.getBoundingRadius(),c.atmosphereUniforms,[u],n),i.attachPostProcess(f),n.onBeforeRenderObservable.add(function(){var e=n.getEngine().getDeltaTime()/1e3;a.update(e),c.getTransform().rotate(r.Axis.Y,.1*e),c.updateMaterial([u],e);var t=a.getTransform().position.clone();a.getTransform().position=r.Vector3.Zero(),c.getTransform().position.subtractInPlace(t),u.position.subtractInPlace(t)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){rE(a,r,o,i,u,"next",e)}function u(e){rE(a,r,o,i,u,"throw",e)}i(void 0)})})()}function rO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function rC(e){return{id:"mars",name:"Mars",type:eC.o.TELLURIC_PLANET,radius:3389500,mass:64171e19,axialTilt:eO.w1.ToRadians(25.19),siderealDaySeconds:88732.79999999999,waterAmount:0,temperature:{min:(0,e$.P1)(-140),max:(0,e$.P1)(20)},orbit:{parentIds:function(e){if(Array.isArray(e))return rO(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return rO(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rO(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),semiMajorAxis:2279392e5,eccentricity:.0934,inclination:eO.w1.ToRadians(1.85),longitudeOfAscendingNode:eO.w1.ToRadians(49.558),argumentOfPeriapsis:eO.w1.ToRadians(286.502),initialMeanAnomaly:0,p:2},terrainSettings:{continents_fragmentation:.1,continents_frequency:1,bumps_frequency:10,max_bump_height:15e3,max_mountain_height:0,continent_base_height:0,mountains_frequency:0},atmosphere:{seaLevelPressure:(0,e$.Mf)(.006),greenHouseEffectFactor:.1,gasMix:[["CO2",.95],["N2",.03],["Ar",.01],["O2",.01]],aerosols:{tau550:.1,settlingCoefficient:1,particleRadius:1e-6,angstromExponent:.6}},rings:null,clouds:null,ocean:null,seed:0}}let rk=n.p+"db3654a54189eaa7.png",rM=n.p+"60eece6cf54ca023.png",rN=n.p+"97065fe3e1fd69fb.png",rL=n.p+"0da5811fcd3028c7.png",rU=n.p+"dcb47344c0964cd2.png",rF=n.p+"710307ce8f37ccfb.png",rB=n.p+"0283d3dbfa4cc1b3.png",rG=n.p+"033fea0d8042a104.png",rj=n.p+"459ea1e1da365309.png",rD=n.p+"264ff746d24b6844.png";function rH(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function rV(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){rH(a,r,o,i,u,"next",e)}function u(e){rH(a,r,o,i,u,"throw",e)}i(void 0)})}}function rz(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function rW(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function rZ(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f,p,d,h,v,m,b,y,g,w,T,x,S;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(P){var R,A,E;switch(P.label){case 0:return(n=new r.Scene(e)).useRightHandedSystem=!0,n.defaultCursor="default",n.clearColor.set(0,0,0,1),[4,tQ(n,t)];case 1:if(o=P.sent(),i=(a=rC([])).radius,(u=new _.Q(n)).getTransform().position=new r.Vector3(0,5,-10).normalize().scale(3*i),u.getTransform().lookAt(r.Vector3.Zero()),u.speed=i/3,(s=u.getActiveCamera()).minZ=.01,s.maxZ=0,s.attachControl(),n.activeCamera=s,n.enableDepthRenderer(null,!0,!0).clearColor.set(0,0,0,1),(l=new r.PointLight("light",new r.Vector3(-5,2,-10).normalize().scale(10*i),n)).falloffType=r.Light.FALLOFF_STANDARD,l.intensity=4,new r.LightGizmo().light=l,(c=new r.GizmoManager(n)).positionGizmoEnabled=!0,c.rotationGizmoEnabled=!0,c.boundingBoxGizmoEnabled=!0,c.usePointerToAttachGizmos=!1,!(f=null===new URLSearchParams(window.location.search).get("light")))return[3,3];return[4,(R=n,rV(function(){var n;return rz(this,function(r){switch(r.label){case 0:return[4,t7([rM,rN,rL,rU,rF,rB,rG,rj],R,e,t)];case 1:if(!(n=r.sent()).success)return[2,n];return[2,(0,e7.ok)({type:"texture_2d_array_mosaic",array:n.value,tileCount:{x:4,y:2}})]}})})())];case 2:if(!(d=P.sent()).success)throw Error("Failed to create albedo texture array: ".concat(String(d.error)));return p=d.value,[3,5];case 3:return h={type:"texture_2d"},[4,(A=n,rV(function(){return rz(this,function(e){return[2,(0,e8.Z)("MarsAlbedo",rk,A,t)]})})())];case 4:h.texture=P.sent(),p=h,P.label=5;case 5:return[4,(E=n,rV(function(){return rz(this,function(e){return[2,(0,e8.Z)("MarsNormal",rD,E,t)]})})())];case 6:if(v=P.sent(),m=new rf(p,{type:"texture_2d",texture:v},n),(y=new r_("SphericalHeightFieldTerrain",i,b={type:"custom",heightRange:{min:0,max:29442},id:"mars"},m.get(),n)).getTransform().rotate(r.Axis.Y,Math.PI),g=new tj(o,n),!f)return[3,8];return[4,g.loadHeightMapsToGpu([b.id],t)];case 7:P.sent(),P.label=8;case 8:return[4,ri.New(6,64,g,e)];case 9:if(!(w=P.sent()).success)throw Error("Failed to create chunk forge: ".concat(String(w.error)));return T=w.value,x=new k.r(i,a.mass,298,a.atmosphere),S=new M.C(y.getTransform(),i,x,[l],n),s.attachPostProcess(S),n.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;u.update(t),y.update(s,T),T.update();var n=s.globalPosition.clone();y.getTransform().position.subtractInPlace(n),l.position.subtractInPlace(n),u.getTransform().position.subtractInPlace(n),m.setPlanetInverseWorld(y.getTransform().computeWorldMatrix(!0).clone().invert())}),[4,new Promise(function(t){var n=e.onBeginFrameObservable.add(function(){y.update(s,T),T.update(),y.isIdle()&&(n.remove(),t())})})];case 10:return P.sent(),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){rW(a,r,o,i,u,"next",e)}function u(e){rW(a,r,o,i,u,"throw",e)}i(void 0)})})()}function rY(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function rX(e){return{id:"mercury",name:"Mercury",type:eC.o.TELLURIC_PLANET,radius:2439700,mass:3301e20,axialTilt:eO.w1.ToRadians(.034),siderealDaySeconds:5067014.4,waterAmount:0,temperature:{min:437,max:437},orbit:{parentIds:function(e){if(Array.isArray(e))return rY(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return rY(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rY(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),semiMajorAxis:(0,e$.Ub)(.38),eccentricity:.2056,p:2,inclination:eO.w1.ToRadians(7),longitudeOfAscendingNode:eO.w1.ToRadians(48.331),argumentOfPeriapsis:eO.w1.ToRadians(29.124),initialMeanAnomaly:0},terrainSettings:{continents_fragmentation:.1,continents_frequency:1,bumps_frequency:10,max_bump_height:15e3,max_mountain_height:0,continent_base_height:0,mountains_frequency:0},atmosphere:null,rings:null,clouds:null,ocean:null,seed:0}}let rq=n.p+"53e59d2b9f67f8a9.png",rK=n.p+"7be05a95402c273c.png",rQ=n.p+"28cde3c094028fad.png",rJ=n.p+"9d86f4a248e29fb7.png",r$=n.p+"09594b26d4cc9db5.png",r0=n.p+"fc48a27ddd0f70b1.png",r1=n.p+"4ebcfc3aef3f6ce0.png",r2=n.p+"03835f2251019646.png",r3=n.p+"78dfc0e7008a4390.png",r4=n.p+"258d891acbdc8590.png";function r5(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function r6(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){r5(a,r,o,i,u,"next",e)}function u(e){r5(a,r,o,i,u,"throw",e)}i(void 0)})}}function r7(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function r8(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function r9(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f,p,d,h,v,m,b,y,g,w;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(T){var x,S,P;switch(T.label){case 0:return(n=new r.Scene(e)).useRightHandedSystem=!0,n.defaultCursor="default",n.clearColor.set(0,0,0,1),[4,tQ(n,t)];case 1:if(o=T.sent(),a=rX([]).radius,(i=new _.Q(n)).getTransform().position=new r.Vector3(0,5,-10).normalize().scale(3*a),i.getTransform().lookAt(r.Vector3.Zero()),i.speed=a/3,(u=i.getActiveCamera()).minZ=.01,u.maxZ=0,u.attachControl(),n.activeCamera=u,n.enableDepthRenderer(null,!0,!0).clearColor.set(0,0,0,1),(s=new r.PointLight("light",new r.Vector3(-5,2,-10).normalize().scale(10*a),n)).falloffType=r.Light.FALLOFF_STANDARD,s.intensity=4,new r.LightGizmo().light=s,(l=new r.GizmoManager(n)).positionGizmoEnabled=!0,l.rotationGizmoEnabled=!0,l.boundingBoxGizmoEnabled=!0,l.usePointerToAttachGizmos=!1,!(c=null===new URLSearchParams(window.location.search).get("light")))return[3,3];return[4,(x=n,r6(function(){var n;return r7(this,function(r){switch(r.label){case 0:return[4,t7([rK,rQ,rJ,r$,r0,r1,r2,r3],x,e,t)];case 1:if(!(n=r.sent()).success)return[2,n];return[2,(0,e7.ok)({type:"texture_2d_array_mosaic",array:n.value,tileCount:{x:4,y:2}})]}})})())];case 2:if(!(p=T.sent()).success)throw Error("Failed to create albedo texture: ".concat(String(p.error)));return f=p.value,[3,5];case 3:return d={type:"texture_2d"},[4,(S=n,r6(function(){return r7(this,function(e){return[2,(0,e8.Z)("MercuryAlbedo",rq,S,t)]})})())];case 4:d.texture=T.sent(),f=d,T.label=5;case 5:return[4,(P=n,r6(function(){return r7(this,function(e){return[2,(0,e8.Z)("MercuryNormal",r4,P,t)]})})())];case 6:if(h=T.sent(),v=new rf(f,{type:"texture_2d",texture:h},n),b=new r_("SphericalHeightFieldTerrain",a,m={type:"custom",heightRange:{min:-5380,max:4480},id:"mercury"},v.get(),n),y=new tj(o,n),!c)return[3,8];return[4,y.loadHeightMapsToGpu([m.id],t)];case 7:T.sent(),T.label=8;case 8:return[4,ri.New(6,64,y,e)];case 9:if(!(g=T.sent()).success)throw Error("Failed to create chunk forge: ".concat(String(g.error)));return w=g.value,n.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;i.update(t),b.update(u,w),w.update();var n=u.globalPosition.clone();b.getTransform().position.subtractInPlace(n),s.position.subtractInPlace(n),i.getTransform().position.subtractInPlace(n),v.setPlanetInverseWorld(b.getTransform().computeWorldMatrix(!0).clone().invert())}),[4,new Promise(function(t){var n=e.onBeginFrameObservable.add(function(){b.update(u,w),w.update(),b.isIdle()&&(n.remove(),t())})})];case 10:return T.sent(),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){r8(a,r,o,i,u,"next",e)}function u(e){r8(a,r,o,i,u,"throw",e)}i(void 0)})})()}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ot(e){return{id:"moon",name:"Moon",type:eC.o.TELLURIC_SATELLITE,radius:1737100,mass:7342e19,axialTilt:eO.w1.ToRadians(6.68),siderealDaySeconds:2360620.8,waterAmount:0,temperature:{min:100,max:100},orbit:{parentIds:function(e){if(Array.isArray(e))return oe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return oe(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oe(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),semiMajorAxis:3844e5,eccentricity:.0549,inclination:eO.w1.ToRadians(5.145),longitudeOfAscendingNode:eO.w1.ToRadians(125.08),argumentOfPeriapsis:eO.w1.ToRadians(318.15),initialMeanAnomaly:0,p:2},terrainSettings:{continents_fragmentation:.1,continents_frequency:1,bumps_frequency:10,max_bump_height:15e3,max_mountain_height:0,continent_base_height:0,mountains_frequency:0},atmosphere:null,clouds:null,ocean:null,seed:0}}let on=n.p+"319def6b14b0ea76.png",or=n.p+"b3e84a4ec1cce3a3.png",oo=n.p+"e1c9ef2782faa838.png",oa=n.p+"a3f4f665422dce7f.png",oi=n.p+"de33c4990a961c34.png",ou=n.p+"bb2a3aca2431de60.png",os=n.p+"3f78e0d399e4ba46.png",ol=n.p+"675c3253e43e37d7.png",oc=n.p+"cb8385e4ef5c14af.png",of=n.p+"cda172cd3fbd5051.png";function op(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function od(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){op(a,r,o,i,u,"next",e)}function u(e){op(a,r,o,i,u,"throw",e)}i(void 0)})}}function oh(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function ov(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function om(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f,p,d,h,v,m,b,y,g,w;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(T){var x,S,P;switch(T.label){case 0:return(n=new r.Scene(e)).useRightHandedSystem=!0,n.defaultCursor="default",n.clearColor.set(0,0,0,1),[4,tQ(n,t)];case 1:if(o=T.sent(),a=ot([]).radius,(i=new _.Q(n)).getTransform().position=new r.Vector3(0,0,-10).normalize().scale(3*a),i.getTransform().lookAt(r.Vector3.Zero()),i.speed=a/3,(u=i.getActiveCamera()).minZ=.01,u.maxZ=0,u.attachControl(),n.activeCamera=u,n.enableDepthRenderer(null,!0,!0).clearColor.set(0,0,0,1),(s=new r.PointLight("light",new r.Vector3(0,0,-10).normalize().scale(10*a),n)).falloffType=r.Light.FALLOFF_STANDARD,s.intensity=4,new r.HemisphericLight("ambient",new r.Vector3(0,1,0),n).intensity=.001,new r.LightGizmo().light=s,(l=new r.GizmoManager(n)).positionGizmoEnabled=!0,l.rotationGizmoEnabled=!0,!(c=null===new URLSearchParams(window.location.search).get("light")))return[3,3];return[4,(x=n,od(function(){var n;return oh(this,function(r){switch(r.label){case 0:return[4,t7([or,oo,oa,oi,ou,os,ol,oc],x,e,t)];case 1:if(!(n=r.sent()).success)return[2,n];return[2,(0,e7.ok)({type:"texture_2d_array_mosaic",array:n.value,tileCount:{x:4,y:2}})]}})})())];case 2:if(!(p=T.sent()).success)throw Error("Failed to load high-resolution albedo texture: ".concat(String(p.error)));return f=p.value,[3,5];case 3:return d={type:"texture_2d"},[4,(S=n,od(function(){return oh(this,function(e){return[2,(0,e8.Z)("MoonAlbedo",on,S,t)]})})())];case 4:d.texture=T.sent(),f=d,T.label=5;case 5:return[4,(P=n,od(function(){return oh(this,function(e){return[2,(0,e8.Z)("MoonNormal",of,P,t)]})})())];case 6:if(h=T.sent(),v=new rf(f,{type:"texture_2d",texture:h},n),(b=new r_("SphericalHeightFieldTerrain",a,m={type:"custom",heightRange:{min:-9178,max:10786},id:"moon"},v.get(),n)).getTransform().rotate(r.Axis.Y,Math.PI/2),y=new tj(o,n),!c)return[3,8];return[4,y.loadHeightMapsToGpu([m.id],t)];case 7:T.sent(),T.label=8;case 8:return[4,ri.New(6,64,y,e)];case 9:if(!(g=T.sent()).success)throw Error("Failed to create chunk forge: ".concat(String(g.error)));return w=g.value,n.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;i.update(t),b.update(u,w),w.update();var n=u.globalPosition.clone();b.getTransform().position.subtractInPlace(n),s.position.subtractInPlace(n),i.getTransform().position.subtractInPlace(n),v.setPlanetInverseWorld(b.getTransform().computeWorldMatrix(!0).clone().invert())}),[4,new Promise(function(t){var n=e.onBeginFrameObservable.add(function(){b.update(u,w),w.update(),b.isIdle()&&(n.remove(),t())})})];case 10:return T.sent(),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){ov(a,r,o,i,u,"next",e)}function u(e){ov(a,r,o,i,u,"throw",e)}i(void 0)})})()}function ob(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function oy(e){return{id:"saturn",name:"Saturn",type:eC.o.GAS_PLANET,radius:58232e3,mass:5683e23,axialTilt:eO.w1.ToRadians(26.73),siderealDaySeconds:38361.6,orbit:{parentIds:function(e){if(Array.isArray(e))return ob(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ob(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ob(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),semiMajorAxis:143344937e4,eccentricity:.0565,inclination:eO.w1.ToRadians(2.49),longitudeOfAscendingNode:eO.w1.ToRadians(113.715),argumentOfPeriapsis:eO.w1.ToRadians(336.092),initialMeanAnomaly:0,p:2},atmosphere:{seaLevelPressure:1e5,greenHouseEffectFactor:.5,gasMix:[["H2",.9],["He",.1]],aerosols:{tau550:.1,angstromExponent:.8,particleRadius:15e-8,settlingCoefficient:.5}},colorPalette:{type:"textured",textureId:"saturn"},rings:{innerRadius:74658e3,outerRadius:136775e3,type:"textured",textureId:"saturn"},seed:0}}function og(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function ow(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f,p,d,h,v;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(m){switch(m.label){case 0:return(n=new r.Scene(e)).useRightHandedSystem=!0,n.clearColor.set(0,0,0,1),[4,E(n)];case 1:return m.sent(),[4,(0,B.v)(n,t)];case 2:return o=m.sent(),i=(a=new _.Q(n)).getActiveCamera(),a.speed=96e6,i.maxZ*=96e6,a.getTransform().setAbsolutePosition(new r.Vector3(0,2,-2).scaleInPlace(96e6)),a.getTransform().lookAt(r.Vector3.Zero()),i.attachControl(),n.enableDepthRenderer(null,!0,!0).clearColor.set(0,0,0,1),(u=new r.TransformNode("sun",n)).position=new r.Vector3(7,5.5,-10).scaleInPlace(96e6),(s=new r.PointLight("light1",r.Vector3.Zero(),n)).falloffType=r.Light.FALLOFF_STANDARD,s.parent=u,l=oy([]),c=new eh._(function(){return new ef.h(n)}),f=new ed.v(l,o.textures,c,n),p=null,null!==l.rings&&(p=new T.K(0,f.getTransform(),l.rings.innerRadius,l.rings.outerRadius,n)),d=new ep.A(f.getTransform(),f.getBoundingRadius(),f.ringsUniforms,null,!1,[{getBoundingRadius:function(){return 0},getLight:function(){return s}}],n),i.attachPostProcess(d),h=new M.C(f.getTransform(),f.getBoundingRadius(),f.atmosphereUniforms,[s],n),i.attachPostProcess(h),null!==f.ringsUniforms&&(v=new ec.e(f.getTransform(),f.ringsUniforms,f.model,[s],n),i.attachPostProcess(v)),n.onBeforeRenderObservable.add(function(){var e=n.getEngine().getDeltaTime()/1e3;a.update(e),f.updateMaterial([s],e);var t=a.getTransform().position.clone();a.getTransform().position=r.Vector3.Zero(),f.getTransform().position.subtractInPlace(t),s.position.subtractInPlace(t),null==p||p.update(i.globalPosition,o.objects.asteroids,e)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){og(a,r,o,i,u,"next",e)}function u(e){og(a,r,o,i,u,"throw",e)}i(void 0)})})()}function o_(){return{id:"sun",name:"Sun",type:eC.o.STAR,radius:695508e3,mass:1989e27,blackBodyTemperature:5778,axialTilt:eO.w1.ToRadians(7.25),siderealDaySeconds:2217888,orbit:{parentIds:[],semiMajorAxis:0,eccentricity:0,p:2,inclination:0,longitudeOfAscendingNode:0,argumentOfPeriapsis:0,initialMeanAnomaly:0},rings:null,seed:0}}var oT=n(50487),ox=n(33778),oS=n(13833),oP=n(45825),oR=n(52482),oA=n(84496);function oE(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function oI(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f,p,d,h,v,m,b,y;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(g){switch(g.label){case 0:return(n=new ox.E(e)).useRightHandedSystem=!0,n.clearColor.set(0,0,0,1),[4,E(n)];case 1:return g.sent(),[4,(0,eX.L)()];case 2:return g.sent(),[4,(0,B.v)(n,t)];case 3:return o=g.sent(),i=(a=new _.Q(n)).getActiveCamera(),a.speed=66e6,i.maxZ*=66e6,[4,n.setActiveControls(a)];case 4:var w,T,x,S,P,R,A,I,O,C;return g.sent(),n.enableDepthRenderer(null,!0,!0),u=new oP.z(H.Z.VERTEX_RESOLUTION),s=new oA.F,[4,oR.z.CreateAsync((T=rX([(w=o_()).id]),x={id:"venus",name:"Venus",type:eC.o.TELLURIC_PLANET,radius:6051800,mass:4865e21,axialTilt:eO.w1.ToRadians(177.36),siderealDaySeconds:0x14064f0,waterAmount:0,temperature:{min:719,max:763},orbit:{parentIds:[w.id],semiMajorAxis:1082095e5,eccentricity:.0067,inclination:eO.w1.ToRadians(3.39),longitudeOfAscendingNode:eO.w1.ToRadians(76.68),argumentOfPeriapsis:eO.w1.ToRadians(54.88),initialMeanAnomaly:0,p:2},terrainSettings:{continents_fragmentation:.1,continents_frequency:1,bumps_frequency:10,max_bump_height:15e3,max_mountain_height:2e4,continent_base_height:0,mountains_frequency:5},rings:null,atmosphere:{seaLevelPressure:(0,e$.Mf)(93),greenHouseEffectFactor:.99,gasMix:[["CO2",.96],["N2",.04]],aerosols:{tau550:30,angstromExponent:.1,particleRadius:1e-6,settlingCoefficient:.3}},clouds:{layerRadius:6061800,smoothness:.7,specularPower:2,frequency:4,detailFrequency:12,coverage:0,sharpness:2.5,color:new eQ.Wo(.8,.8,.1),worleySpeed:5e-4,detailSpeed:.003},ocean:null,seed:0},P=ot([(S=e1([w.id])).id]),R=rC([w.id]),A=rA([w.id]),I=oy([w.id]),O={id:"uranus",name:"Uranus",type:eC.o.GAS_PLANET,radius:25362e3,mass:8681e22,axialTilt:eO.w1.ToRadians(97.77),siderealDaySeconds:3600*17.24,orbit:{parentIds:[w.id],semiMajorAxis:287246327e4,eccentricity:.0565,inclination:eO.w1.ToRadians(.77),longitudeOfAscendingNode:eO.w1.ToRadians(74.229),argumentOfPeriapsis:eO.w1.ToRadians(96.541),initialMeanAnomaly:0,p:2},colorPalette:{type:"textured",textureId:"uranus"},atmosphere:{seaLevelPressure:1e5,greenHouseEffectFactor:.5,gasMix:[["H2",.83],["He",.15],["CH4",.02]],aerosols:{tau550:.08,angstromExponent:.9,particleRadius:1e-7,settlingCoefficient:1}},rings:{innerRadius:50724e3,outerRadius:62e6,type:"textured",textureId:"uranus"},seed:0},C={id:"neptune",name:"Neptune",type:eC.o.GAS_PLANET,radius:24622e3,mass:1024e23,axialTilt:eO.w1.ToRadians(28.32),siderealDaySeconds:57996,orbit:{parentIds:[w.id],semiMajorAxis:449506e7,eccentricity:.0086,inclination:eO.w1.ToRadians(1.77),longitudeOfAscendingNode:eO.w1.ToRadians(131.72169),argumentOfPeriapsis:eO.w1.ToRadians(265.646853),initialMeanAnomaly:0,p:2},colorPalette:{type:"textured",textureId:"neptune"},atmosphere:{seaLevelPressure:1e5,greenHouseEffectFactor:.7,gasMix:[["H2",.8],["He",.19],["CH4",.01]],aerosols:{tau550:.5,angstromExponent:1,particleRadius:24e-8,settlingCoefficient:1}},rings:null,seed:0},{name:"Sol",coordinates:{starSectorX:0,starSectorY:0,starSectorZ:0,localX:0,localY:0,localZ:0},stellarObjects:[w],planets:[T,x,S,R,A,I,O,C],satellites:[P],anomalies:[],orbitalFacilities:[]}),s,o,n)];case 5:(l=g.sent()).initPositions(2,u),c=l.getStellarObjects()[0],a.getTransform().position=c.getTransform().position.add(new r.Vector3(0,1,-2).scaleInPlace(7*c.getBoundingRadius())),a.getTransform().lookAt(c.getTransform().position),(f=new oT.O(o.textures,n)).addCelestialBodies(l.getCelestialBodies(),l.getStellarObjects(),[l.starFieldBox.mesh]),p=new oS.V,d=!0,h=!1,v=void 0;try{for(m=l.getCelestialBodies()[Symbol.iterator]();!(d=(b=m.next()).done);d=!0)y=b.value,p.addObject(y)}catch(e){h=!0,v=e}finally{try{d||null==m.return||m.return()}finally{if(h)throw v}}return n.onBeforeRenderObservable.add(function(){var e=n.getEngine().getDeltaTime()/1e3;a.update(e),u.update(o),f.update(e),l.update(e,u),p.update(i)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){oE(a,r,o,i,u,"next",e)}function u(e){oE(a,r,o,i,u,"throw",e)}i(void 0)})})()}var oO=n(65681),oC=n(82659),ok=n(58451),oM=n(47608);function oN(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function oL(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(p){switch(p.label){case 0:return(n=new r.Scene(e)).useRightHandedSystem=!0,n.clearColor.set(0,0,0,1),[4,E(n)];case 1:return p.sent(),[4,(0,$.j)(n,t)];case 2:var d;return o=p.sent(),i=(a=new _.Q(n)).getActiveCamera(),a.speed=9e8,i.maxZ*=9e8,n.enableDepthRenderer(i,!0,!0),a.getTransform().setAbsolutePosition(new r.Vector3(0,2,-2).scaleInPlace(9e8)),a.getTransform().lookAt(r.Vector3.Zero()),(null!=(d=r.FreeCamera)&&"undefined"!=typeof Symbol&&d[Symbol.hasInstance]?!!d[Symbol.hasInstance](i):i instanceof d)&&i.setTarget(new r.Vector3(.001,0,.1)),i.attachControl(),u=new ok.S(o.environment.milkyWay,n),s=o_(),l=new oM.U(s,o,n),c=new oC.X(l.mesh,l.volumetricLightUniforms,[u.mesh],n),i.attachPostProcess(c),f=new oO.i(l.getTransform(),l.getBoundingRadius(),l.getLight().diffuse,n),i.attachPostProcess(f),n.onBeforeRenderObservable.add(function(){var e=n.getEngine().getDeltaTime()/1e3;a.update(e),l.updateMaterial(e);var t=a.getTransform().position.clone();a.getTransform().position=r.Vector3.Zero(),l.getTransform().position.subtractInPlace(t)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){oN(a,r,o,i,u,"next",e)}function u(e){oN(a,r,o,i,u,"throw",e)}i(void 0)})})()}var oU=n(47599),oF=n(19346);function oB(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function oG(e,t){var n;return(n=function(){var n,r,o,a,i,u,s,l,c,f,p;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(d){switch(d.label){case 0:return(n=new C.x(e)).useRightHandedSystem=!0,[4,E(n)];case 1:return d.sent(),[4,(0,B.v)(n,t)];case 2:return r=d.sent(),(o=new _.Q(n)).speed=2e3,(a=o.getActiveCamera()).maxZ=1e5*H.Z.EARTH_RADIUS,a.attachControl(),i=eJ.AU,o.getTransform().setAbsolutePosition(new S.P(0,2,-3).normalize().scaleInPlace(4e4)),o.getTransform().lookAt(S.P.Zero()),u={starSectorX:0,starSectorY:0,starSectorZ:0,localX:0,localY:0,localZ:0},s=new eW.Z((0,ez.D)()).getSystemGalacticPosition(u),l=o_(),(c=new oM.U(l,r.textures,n)).getTransform().position=new S.P(7,2,5).normalize().scaleInPlace(i),(f=(0,oU.z)("station",Math.random()*H.Z.SEED_HALF_RANGE,u,s,[l])).orbit.semiMajorAxis=i,p=new oF.f(f,new Map([[l,i]]),r,n),n.onBeforePhysicsObservable.add(function(){var t=e.getDeltaTime()/1e3;o.update(t);var n=a.globalPosition;p.update([c],n,t)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){oB(a,r,o,i,u,"next",e)}function u(e){oB(a,r,o,i,u,"throw",e)}i(void 0)})})()}var oj=n(46060),oD=n(70620),oH=n(80012);function oV(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function oz(e,t){var n;return(n=function(){var n,r,o,a,i,u,s,l,c,f,p,d,h;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(v){switch(v.label){case 0:return(n=new C.x(e)).useRightHandedSystem=!0,[4,E(n)];case 1:return v.sent(),[4,(0,eX.L)()];case 2:return v.sent(),[4,(0,B.v)(n,t)];case 3:if(r=v.sent(),o=new G.cV,a=new eo.jH,i=new eW.Z((0,ez.D)()),void 0===(s=(u=oD.J.Default(i)).serializedSpaceships.shift()))throw Error("No spaceship found in player data");if(l=j.O.Deserialize(s,u.spareSpaceshipComponents,n,r,o),u.instancedSpaceships.push(l),(c=new ea.y(l,n,o,a).thirdPersonCamera).attachControl(),n.activeCamera=c,f=i.fallbackSystem,p=new oj.t,d=new oH.L(u,p,i,o),void 0===(h=f.orbitalFacilities[0]))throw Error("No station found in system model");return d.setStation(h,[],u),d.setVisibility(!0),window.player=u,[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){oV(a,r,o,i,u,"next",e)}function u(e){oV(a,r,o,i,u,"throw",e)}i(void 0)})})()}function oW(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function oZ(e,t){var n;return(n=function(){var t,n,o,a,i,u,s,l;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(c){switch(c.label){case 0:return(t=new r.Scene(e)).useRightHandedSystem=!0,t.defaultCursor="default",(n=new _.Q(t)).getTransform().position=new r.Vector3(0,5,-10).normalize().scale(19113e3),n.getTransform().lookAt(r.Vector3.Zero()),n.speed=6371e3/3,(o=n.getActiveCamera()).minZ=.01,o.maxZ=0,o.attachControl(),t.activeCamera=o,t.enableDepthRenderer(o,!0,!0).clearColor=new r.Color4(0,0,0,1),new r.PointLight("light",new r.Vector3(-5,2,10).scaleInPlace(-6371e4),t).falloffType=r.Light.FALLOFF_STANDARD,(a=new r.PBRMetallicRoughnessMaterial("terrainMaterial",t)).baseColor=new r.Color3(.5,.5,.5),a.metallic=0,a.roughness=.6,i=new r_("SphericalHeightFieldTerrain",6371e3,{type:"procedural",seed:0,continentalCrust:{elevation:5e3,fraction:.3},mountain:{elevation:1e4,terraceElevation:1e3,erosion:1},craters:{octaveCount:3,sparsity:2}},a,t),u=new tD,[4,ri.New(6,64,u,e)];case 1:if(!(s=c.sent()).success)throw Error("Failed to create chunk forge: ".concat(String(s.error)));return l=s.value,t.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;n.update(t),i.update(o,l),l.update();var r=o.globalPosition.clone();i.getTransform().position.subtractInPlace(r),n.getTransform().position.subtractInPlace(r)}),[4,new Promise(function(t){var n=e.onBeginFrameObservable.add(function(){i.update(o,l),l.update(),i.isIdle()&&(n.remove(),t())})})];case 2:return c.sent(),[2,t]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){oW(a,r,o,i,u,"next",e)}function u(e){oW(a,r,o,i,u,"throw",e)}i(void 0)})})()}var oY=n(87158),oX=n(31760),oq=n(70618),oK=n(9852);function oQ(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function oJ(e,t){var n;return(n=function(){var t,n,r,o,a,i,u;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(s){switch(s.label){case 0:return[4,(0,eX.L)()];case 1:if(s.sent(),t=new eW.Z((0,ez.D)()),n=oD.J.Default(t),r=new oY.O(t),o=new G.cV,(a=new oq.s(n,e,r,t,o)).setCurrentStarSystem(t.fallbackSystem.coordinates),null!==(i=new URLSearchParams(window.location.search).get("systemCoordinates"))){if(null===(u=(0,oK.o)(decodeURIComponent(i))))throw Error("Invalid system coordinates json provided in URL parameters.");a.focusOnSystem(oX.f.parse(u),!0)}return[2,a.scene]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){oQ(a,r,o,i,u,"next",e)}function u(e){oQ(a,r,o,i,u,"throw",e)}i(void 0)})})()}var o$=n(79405),o0=n(76929),o1=n(67810),o2=n(6478),o3=n(74667),o4=n(62341),o5=n(24660);function o6(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function o7(e,t){var n;return(n=function(){var n,r,o,a,i,u,s,l,c;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(f){switch(f.label){case 0:return[4,(0,eX.L)()];case 1:var p,d,h,v,m,b,y;return f.sent(),n=new eW.Z((p={starSectorX:0,starSectorY:1,starSectorZ:0,localX:0,localY:0,localZ:0},(d=(0,o0.dD)("star0",420,"Weierstrass",[])).blackBodyTemperature=5778,(h=(0,o1.$)("hecate",253,"H\xe9cate",[d])).temperature.min=(0,e$.P1)(-40),h.temperature.max=(0,e$.P1)(30),h.orbit.semiMajorAxis=21e3*h.radius,v=(0,oU.z)("hecate->station",0,p,S.P.Zero(),[h]),(m=(0,o2.u)("hecate->manaleth",23,"Manaleth",[h])).orbit.inclination=eO.w1.ToRadians(45),m.orbit.semiMajorAxis=(0,o$.at)(m.siderealDaySeconds,h.mass),null!==(b=(0,o1.$)("ares",.3725,"Ares",[d])).clouds&&(b.clouds.coverage=1),null!==b.atmosphere&&(b.atmosphere.seaLevelPressure=.5*eJ.z2),b.orbit.semiMajorAxis=25100*h.radius,(y=(0,el.L)("andromaque",.28711440474126226,"Andromaque",[d])).orbit.semiMajorAxis=25300*h.radius,y.orbit.eccentricity=.8,{name:"Alpha Testis",coordinates:p,stellarObjects:[d],planets:[h,b,y],satellites:[m],anomalies:[],orbitalFacilities:[v]})),r=oD.J.Default(n),o=new oj.t,a=new G.cV,i=new eo.jH,(u=new ox.E(e)).useRightHandedSystem=!0,[4,E(u)];case 2:return s=f.sent(),[4,(0,B.v)(u,t)];case 3:return l=f.sent(),[4,(c=new o3.p(u,r,e,s,o,n,a,i,l)).resetPlayer()];case 4:return f.sent(),[4,c.switchToSpaceshipControls()];case 5:return f.sent(),[4,c.loadStarSystem(n.fallbackSystem)];case 6:return f.sent(),c.initStarSystem(),(0,o5.pl)(c.getSpaceshipControls(),c.getStarSystem().getStellarObjects()[0],c.getStarSystem()),u.onBeforeRenderObservable.add(function(){var e=u.getEngine().getDeltaTime()/1e3;(0,o4.BX)(e)}),[2,c.scene]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){o6(a,r,o,i,u,"next",e)}function u(e){o6(a,r,o,i,u,"throw",e)}i(void 0)})})()}var o8=n(43011),o9=n(14280),ae=n(17769),at=n(2059);function an(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function ar(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){an(a,r,o,i,u,"next",e)}function u(e){an(a,r,o,i,u,"throw",e)}i(void 0)})}}function ao(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function aa(e,t){return ar(function(){var n,r,o,a,i,u,s;return ao(this,function(l){switch(l.label){case 0:return(n=new C.x(e)).useRightHandedSystem=!0,[4,E(n)];case 1:return l.sent(),[4,(0,$.j)(n,t)];case 2:return r=l.sent(),(o=new _.Q(n)).speed=2e6,(a=o.getActiveCamera()).attachControl(),n.activeCamera=a,n.enableDepthRenderer(null,!0,!0).clearColor.set(0,0,0,1),new ok.S(r.environment.milkyWay,n),i=(0,o8.s)("blackHole",42,"Black Hole Demo",[]),(u=new ae.s(i,r.environment.milkyWay,n)).getTransform().position=new S.P(0,-.2,1).scaleInPlace(20*u.getRadius()),s=new at.z(u.getTransform(),u.blackHoleUniforms,n),a.attachPostProcess(s),a.maxZ=1e12,o.getTransform().lookAt(u.getTransform().position),n.onBeforePhysicsObservable.add(function(){var t=e.getDeltaTime()/1e3,n=o.update(t);(0,o9.Iu)(o.getTransform(),n.negate()),(0,o9.Iu)(u.getTransform(),n.negate()),s.update(t)}),document.addEventListener("click",function(){return ar(function(){var e;return ao(this,function(t){switch(t.label){case 0:if(null!==document.pointerLockElement)return[3,2];return[4,null==(e=o.getActiveCamera().getEngine().getRenderingCanvas())?void 0:e.requestPointerLock()];case 1:t.sent(),t.label=2;case 2:return[2]}})})()}),[2,n]}})})()}var ai=n(73529),au=n(16890),as=n(62632),al=n(44356);function ac(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function af(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(p){switch(p.label){case 0:return(n=new C.x(e)).useRightHandedSystem=!0,[4,E(n)];case 1:return p.sent(),[4,(0,$.j)(n,t)];case 2:return o=p.sent(),(a=new _.Q(n)).speed=2e3,(i=a.getActiveCamera()).attachControl(),i.maxZ=0,n.activeCamera=i,n.enableDepthRenderer(i,!0,!0).clearColor=new r.Color4(0,0,0,1),u=(0,ai.L)("neutronStar",456,"Neutron Star Demo",[]),(s=new as.R(u,o,n)).getTransform().position=new S.P(0,0,1).scaleInPlace(2e6*s.getRadius()),l=new oC.X(s.mesh,s.volumetricLightUniforms,[],n),i.attachPostProcess(l),c=new au.J(s.getTransform(),s.getRadius(),s.model.dipoleTilt,n),i.attachPostProcess(c),f=new oO.i(s.getTransform(),s.getRadius(),(0,al.y)(u.blackBodyTemperature),n),i.attachPostProcess(f),i.maxZ=1e12,a.getTransform().lookAt(s.getTransform().position),n.onBeforePhysicsObservable.add(function(){var t=e.getDeltaTime()/1e3,n=a.update(t);s.getTransform().rotate(r.Axis.Y,2*Math.PI*t/u.siderealDaySeconds),(0,o9.Iu)(a.getTransform(),n.negate()),(0,o9.Iu)(s.getTransform(),n.negate()),c.update(t)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){ac(a,r,o,i,u,"next",e)}function u(e){ac(a,r,o,i,u,"throw",e)}i(void 0)})})()}var ap=n(63455);function ad(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function ah(e,t){var n;return(n=function(){var n,o,a,i,u,s,l,c,f,p,d,h,v,m,b,y,g,w,T,x,S,P,R,A,E,I,O,C,N,L,U,F;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(B){switch(B.label){case 0:return(o=new r.Scene(e)).clearColor.set(0,0,0,1),o.useRightHandedSystem=!0,o.defaultCursor="default",[4,(0,$.j)(o,t)];case 1:return a=B.sent(),[4,tQ(o,t)];case 2:var G,j;return i=B.sent(),(u=new _.Q(o)).getTransform().position=new r.Vector3(0,5,-10).normalize().scale(19113e3),u.getTransform().lookAt(r.Vector3.Zero()),u.speed=6371e3/3,(s=u.getActiveCamera()).minZ=.01,s.maxZ=0,s.attachControl(),o.activeCamera=s,o.enableDepthRenderer(s,!0,!0).clearColor=new r.Color4(0,0,0,1),(l=new r.PointLight("light",new r.Vector3(10,2,-10).normalize().scale(6371e4),o)).falloffType=r.Light.FALLOFF_STANDARD,l.intensity=4,new r.LightGizmo().light=l,(c=new r.GizmoManager(o)).positionGizmoEnabled=!0,c.rotationGizmoEnabled=!0,f=new URLSearchParams(window.location.search).get("seed"),G=p=(0,o1.$)("telluricPlanet",null!==f?Number(f):1e3*Math.random(),"Gas Planet",[]),window.model=G,j=d=new ap.t(p,a.terrains,a.pools.telluricPlanetMaterialLut,o),window.material=j,h=1e3*(null!==p.atmosphere),v=3,m=2,b=0,null!==p.atmosphere&&(v-=1,b=1),y=1,null!==p.ocean&&(v-=1,m*=2,y=.3),w={type:"procedural",seed:p.seed,continentalCrust:{elevation:null!=(g=null==(n=p.ocean)?void 0:n.depth)?g:5e3,fraction:y},mountain:{elevation:1e4,terraceElevation:h,erosion:b},craters:{octaveCount:v,sparsity:m}},T=new r_("SphericalHeightFieldTerrain",p.radius,w,d,o),x=new tj(i,o),[4,ri.New(6,64,x,e)];case 3:if(!(S=B.sent()).success)throw Error("Failed to create chunk forge: ".concat(String(S.error)));return P=S.value,R=null,null!==p.ocean&&(A=new nP.C(p.radius,p.ocean.depth),R=new nS.A(T.getTransform(),p.radius+p.ocean.depth,A,[l],a.water,o),s.attachPostProcess(R)),E=null,null!==p.clouds&&(O=new nT.cj(p.clouds,a.pools.cloudsLut,o),E=new nx.w(T.getTransform(),p.radius+(null!=(C=null==(I=p.ocean)?void 0:I.depth)?C:0),O,[l],o),s.attachPostProcess(E)),null!==p.atmosphere&&(L=new k.r(p.radius,p.mass,298,p.atmosphere),F=new M.C(T.getTransform(),p.radius+(null!=(U=null==(N=p.ocean)?void 0:N.depth)?U:0),L,[l],o),s.attachPostProcess(F)),o.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;u.update(t),T.update(s,P),P.update();var n=s.globalPosition.clone();T.getTransform().position.subtractInPlace(n),u.getTransform().position.subtractInPlace(n),d.update(T.getTransform().computeWorldMatrix(!0),[l]),null==R||R.update(t),null==E||E.update(t)}),[4,new Promise(function(t){var n=e.onBeginFrameObservable.add(function(){T.update(s,P),P.update(),T.isIdle()&&(n.remove(),t())})})];case 4:return B.sent(),[2,o]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){ad(a,r,o,i,u,"next",e)}function u(e){ad(a,r,o,i,u,"throw",e)}i(void 0)})})()}function av(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function am(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ab(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ay=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");ab(this,"computeShader",void 0),ab(this,"paramsBuffer",void 0),this.computeShader=e,this.paramsBuffer=new nC.M(t),this.paramsBuffer.addUniform("nbVerticesPerRow",1),this.paramsBuffer.addUniform("size",1),this.paramsBuffer.addUniform("octaves",1),this.paramsBuffer.addUniform("lacunarity",1),this.paramsBuffer.addUniform("persistence",1),this.paramsBuffer.addUniform("scaleFactor",1),this.paramsBuffer.updateInt("octaves",2),this.paramsBuffer.updateFloat("lacunarity",2),this.paramsBuffer.updateFloat("persistence",.5),this.paramsBuffer.updateFloat("scaleFactor",.5),this.paramsBuffer.update(),this.computeShader.setUniformBuffer("params",this.paramsBuffer)}return e=[{key:"dispatch",value:function(e,t,r){this.paramsBuffer.updateUInt("nbVerticesPerRow",e),this.paramsBuffer.updateFloat("size",t),this.paramsBuffer.update();var o=new nI.N(r,Float32Array.BYTES_PER_ELEMENT*e*e*3,tJ.g.BUFFER_CREATIONFLAG_VERTEX|tJ.g.BUFFER_CREATIONFLAG_READWRITE);return this.computeShader.setStorageBuffer("positions",o),this.computeShader.dispatch(e/n.WORKGROUP_SIZE[0],e/n.WORKGROUP_SIZE[1],1),o}}],t=[{key:"New",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return t=new nO.U("heightMap",e,{computeSource:'//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nstruct Params {\n    nbVerticesPerRow : u32,\n    size : f32,\n    octaves : i32,\n    lacunarity : f32,\n    persistence : f32,\n    scaleFactor : f32,\n};\n\n@group(0) @binding(0) var<storage, read_write> positions : array<f32>;\n@group(0) @binding(1) var<uniform> params : Params;\n\n//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nconst PI : f32 = 3.141592653589793;\n\n\nfn hash(x: vec2<f32>) -> vec2<f32> {\n    let k = vec2(0.3183099, 0.3678794);\n    let newX = x*k + k.yx;\n    return -1.0 + 2.0*fract(16.0 * k*fract(newX.x*newX.y*(newX.x+newX.y)));\n}\n\n// from https://www.shadertoy.com/view/XdXBRH\n//name:Noise - Gradient - 2D - Deriv\n//Author: iq\n//License: MIT\n// return gradient noise (in x) and its derivatives (in yz)\nfn noised(p: vec2<f32>) -> vec3<f32> {\n    let i = floor(p);\n    let f = fract(p);\n\n    let u = f*f*f*(f*(f * 6.0 - 15.0) + 10.0);\n    let du = 30.0*f*f*(f*(f - 2.0) + 1.0);\n\n    let ga = hash(i + vec2(0.0, 0.0));\n    let gb = hash(i + vec2(1.0, 0.0));\n    let gc = hash(i + vec2(0.0, 1.0));\n    let gd = hash(i + vec2(1.0, 1.0));\n\n    let va = dot(ga, f - vec2(0.0, 0.0));\n    let vb = dot(gb, f - vec2(1.0, 0.0));\n    let vc = dot(gc, f - vec2(0.0, 1.0));\n    let vd = dot(gd, f - vec2(1.0, 1.0));\n\n    return vec3(va + u.x*(vb-va) + u.y*(vc-va) + u.x*u.y*(va-vb-vc+vd), // value\n    ga + u.x*(gb-ga) + u.y*(gc-ga) + u.x*u.y*(ga-gb-gc+gd) +// derivatives\n    du * (u.yx*(va-vb-vc+vd) + vec2(vb, vc) - va));\n}\n\n//3D MODIFICATION OF "ERODED TERRAIN NOISE" By clayjohn : https://www.shadertoy.com/view/MtGcWh\n//I Would recommend starting there for an understanding of the code, the changes were minor, but\n//I felt like making this available.\n\n//ORIGINAL COPYRIGHT DISCLAIMER\n\n//Copyright 2020 Clay John\n\n//Permission is hereby granted, free of charge, to any person obtaining a copy of this software \n//and associated documentation files (the "Software"), to deal in the Software without restriction, \n//including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, \n//and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do \n//so, subject to the following conditions:\n\n//The above copyright notice and this permission notice shall be included in all copies or \n//substantial portions of the Software.\n\n//THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT \n//NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. \n//IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, \n//WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE \n//SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n//GRADIENT 3D NOISE DERIVATIVES SCENE/PREVIEW BY IQ : https://www.shadertoy.com/view/4dffRH\n\nconst erosionscale: f32 = 4.0;\n\n// code modified from https://www.shadertoy.com/view/4tB3RR\n// Name : Gavoronoise 3d\n// Author : guil\n// License : // License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\nfn erosion(p: vec3<f32>, dir: vec3<f32>) -> vec4<f32> {    \n    let ip = floor(p);\n    let fp = fract(p);\n    let f = 4.0*3.14159265359;//frequency (PI constant)\n    var va: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);\n    var wt: f32 = 0.0;\n    \n    for (var i: i32 = -2; i <= 1; i++) { \n        for (var j: i32 = -2; j <= 1; j++) {\n            for (var k: i32 = -2; k <= 1; k++) {		\n                let o = vec3<f32>(f32(i), f32(j), f32(k));\n                let h = hash33((ip - o))*.5;\n                let pp = fp + o - h;\n                let d = dot(pp, pp);\n                let w = exp(-d*8.0);\n                wt += w;\n                let mag = dot(pp, dir);\n                va += vec4<f32>(cos(mag*f), -sin(mag*f)*(pp+dir))*w;\n            }\n        }\n    }\n    \n    return va/wt;\n}\n\n\n//Modified to have erosionscale and it to be 3D\nfn mountain(p: vec3<f32>, nor: vec3<f32>, erosion_amount: f32) -> f32 {\n\n    var n: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);\n    var nf: f32 = 1.0;\n    var na: f32 = 0.6;\n    for (var i: i32 = 0; i < 3; i++) {\n       n += gradient_noise_3d(p*nf)*na*vec4<f32>(1.0, nf, nf, nf);\n       na *= 0.5;\n       nf *= 2.0;\n    }\n\n    let noise_before_erosion_01 = smoothstep(-1.0, 1.0, n.x);\n\n    if(erosion_amount <= 0.0) {\n        return noise_before_erosion_01;\n    }\n    \n    //take the curl of the normal to get the gradient facing down the slope\n    let dir = cross(n.yzw, nor);\n    \n    //Now we compute another fbm type noise\n    // erosion is a type of noise with a strong directionality\n    //we pass in the direction based on the slope of the terrain\n    //erosion also returns the slope. we add that to a running total\n    //so that the direction of successive layers are based on the\n    //past layers\n    var h: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);\n    var a: f32 = 0.7*(smoothstep(0.3, 0.5, n.x*0.5+0.5)); //smooth the valleys\n    var f: f32 = 1.0;\n    for (var i: i32 = 0; i < 4; i++) {\n        h += erosion(p*erosionscale*f, dir+cross(h.yzw, normalize(p)))*a*vec4<f32>(1.0, f, f, f);\n        a *= 0.6;\n        f *= 2.0;\n    }\n    //remap height to [0,1] and add erosion\n    //looks best when erosion amount is small\n    //not sure about adding the normals together, but it looks okay\n    return noise_before_erosion_01 + h.x * 0.01 * erosion_amount;\n}\n\n@compute @workgroup_size(16,16,1)\nfn main(@builtin(global_invocation_id) id: vec3<u32>) {\n    if (id.x >= params.nbVerticesPerRow || id.y >= params.nbVerticesPerRow) { \n        return; \n    }\n\n    let x : f32 = f32(id.x);\n    let y : f32 = f32(id.y);\n\n    let index: u32 = id.x + id.y * u32(params.nbVerticesPerRow);\n\n    var vertex_position = vec3<f32>(params.size * x / f32(params.nbVerticesPerRow - 1) - params.size / 2.0, 0.0, params.size * y / f32(params.nbVerticesPerRow - 1) - params.size / 2.0);\n\n    let elevation = mountain(vertex_position * 0.5, vec3f(0.0, 1.0, 0.0), 1.0);\n\n    positions[index * 3 + 0] = vertex_position.x;\n    positions[index * 3 + 1] = elevation;\n    positions[index * 3 + 2] = vertex_position.z;\n}'},{bindingsMapping:{positions:{group:0,binding:0},params:{group:0,binding:1}}}),[4,nN(function(){return t.isReady()},H.Z.COMPUTE_SHADER_READY_MAX_RETRY,10)];case 1:return r.sent(),[2,new n(t,e)]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){av(a,r,o,i,u,"next",e)}function u(e){av(a,r,o,i,u,"throw",e)}i(void 0)})})()}}],e&&am(n.prototype,e),t&&am(n,t),n}();function ag(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function aw(e,t){var n;return(n=function(){var t,n,o,a,i,u,s,l,c,f,p,d,h,v,m,b,y,g,w,T,x,S,P,R;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(A){switch(A.label){case 0:return(n=new r.Scene(e)).useRightHandedSystem=!0,n.defaultCursor="default",(o=new _.Q(n)).getTransform().position=new r.Vector3(0,5,-10).scale(5),o.getTransform().lookAt(r.Vector3.Zero()),(a=o.getActiveCamera()).attachControl(),n.activeCamera=a,(i=new r.DirectionalLight("light",new r.Vector3(-5,-2,10).normalize(),n)).position=new r.Vector3(0,100,0),(u=new r.LightGizmo).light=i,null==(t=u.attachedMesh)||t.position.set(0,20,0),(s=new r.GizmoManager(n)).positionGizmoEnabled=!0,s.rotationGizmoEnabled=!0,s.boundingBoxGizmoEnabled=!0,s.usePointerToAttachGizmos=!1,s.attachToMesh(u.attachedMesh),(l=new r.ShadowGenerator(1024,i)).usePercentageCloserFiltering=!0,l.bias=1e-4,c=1024,f=8,p=new r.Mesh("terrain",n),[4,ay.New(e)];case 1:return d=A.sent(),[4,nH.New(e)];case 2:return h=A.sent(),[4,nB.New(e)];case 3:v=A.sent(),m=d.dispatch(c,f,e),b=h.dispatch(c,m,e),y=v.dispatch(c,e);return g=new r.VertexBuffer(e,m.getBuffer(),"position",!1,!1,3),p.setVerticesBuffer(g),w=new r.VertexBuffer(e,b.getBuffer(),"normal",!1,!1,3),p.setVerticesBuffer(w),p.setBoundingInfo(new r.BoundingInfo(new r.Vector3(-f,-f,-f),new r.Vector3(f,f,f))),p.setIndexBuffer(y.getBuffer(),c*c,(c-1)*(c-1)*6,!0),[3,8];case 4:return[4,m.read()];case 5:return T=A.sent(),[4,y.read()];case 6:return x=A.sent(),[4,b.read()];case 7:S=A.sent(),(P=new r.VertexData).positions=new Float32Array(T.buffer),P.indices=new Uint32Array(x.buffer),P.normals=new Float32Array(S.buffer),P.applyToMesh(p),A.label=8;case 8:return(R=new r.PBRMetallicRoughnessMaterial("terrainMat",n)).baseColor=new r.Color3(.5,1,.5),R.metallic=0,R.roughness=.8,p.material=R,p.scaling.scaleInPlace(10),p.scaling.y*=2,p.receiveShadows=!0,l.addShadowCaster(p),n.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;o.update(t)}),[2,n]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){ag(a,r,o,i,u,"next",e)}function u(e){ag(a,r,o,i,u,"throw",e)}i(void 0)})})()}ab(ay,"WORKGROUP_SIZE",[16,16]);var a_=n(60394);function aT(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function ax(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function aS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var aP=function(){var e,t;function n(e){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");aS(this,"computeShader",void 0),this.computeShader=e}return e=[{key:"dispatch",value:function(e){this.computeShader.setStorageTexture("output_texture",e),this.computeShader.dispatch(e.width/n.WORKGROUP_SIZE[0],e.height/n.WORKGROUP_SIZE[1],e.depth/n.WORKGROUP_SIZE[2])}}],t=[{key:"New",value:function(e){var t;return(t=function(){var t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return t=new nO.U("Voronoi3dTextureGenerator",e,{computeSource:"//  This file is part of Cosmos Journeyer\n//\n//  Copyright (C) 2024 Barth\xe9lemy Pal\xe9ologue <barth.paleologue@cosmosjourneyer.com>\n//\n//  This program is free software: you can redistribute it and/or modify\n//  it under the terms of the GNU Affero General Public License as published by\n//  the Free Software Foundation, either version 3 of the License, or\n//  (at your option) any later version.\n//\n//  This program is distributed in the hope that it will be useful,\n//  but WITHOUT ANY WARRANTY; without even the implied warranty of\n//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n//  GNU Affero General Public License for more details.\n//\n//  You should have received a copy of the GNU Affero General Public License\n//  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n\n@group(0) @binding(0) var output_texture: texture_storage_3d<rgba8unorm, write>;\n\n// Cell size in *voxels*. For perfect seamless tiling, each texture dimension\n// should be an exact multiple of CELL_SIZE.\noverride CELL_SIZE: u32 = 32u;\n\n// Optional jitter of feature positions inside each cell in [0,1].\noverride JITTER: f32 = 1.0;\n\nfn positive_modulo(a: i32, b: i32) -> i32 {\n    var r = a % b;\n    if (r < 0) { r = r + b; }\n    return r;\n}\n\n// A small 3D integer hash -> [0,1) floats. Deterministic and reasonably decorrelated.\nfn rng3(seed: vec3<u32>) -> vec3<f32> {\n    var v = seed;\n    v = v * 1664525u + 1013904223u;\n    v.x += v.y * v.z;\n    v.y += v.z * v.x;\n    v.z += v.x * v.y;\n    v ^= (v >> vec3<u32>(16u));\n    v = v * 22695477u + 1u;\n    // Map to [0,1)\n    let k = 1.0 / 4294967296.0;\n    return vec3<f32>(v) * k;\n}\n\n@compute @workgroup_size(4, 4, 4)\nfn main(@builtin(global_invocation_id) global_invocation_id: vec3<u32>) {\n    let dims = textureDimensions(output_texture);\n    if (any(global_invocation_id >= dims)) { \n        return; \n    }\n\n    // Derived grid info.\n    let cellSize = max(CELL_SIZE, 1u);\n    let cellSize3 = vec3<u32>(cellSize);\n\n    // Number of cells along each axis (>=1). Seamless period == dims if dims % CELL_SIZE == 0.\n    let tileCellsU = max(dims / cellSize3, vec3<u32>(1u));\n    let tileCellsI = vec3<i32>(tileCellsU);\n\n    // Current cell (integer) and local position within the cell [0,1)^3.\n    let cell = vec3<i32>(global_invocation_id / cellSize3);\n    let p_local = fract(vec3<f32>(global_invocation_id) / vec3<f32>(cellSize3));\n\n    var min_d2: f32 = 1e30;\n\n    // Examine 27 neighboring cells around the current cell.\n    for (var dz: i32 = -1; dz <= 1; dz = dz + 1) {\n        for (var dy: i32 = -1; dy <= 1; dy = dy + 1) {\n            for (var dx: i32 = -1; dx <= 1; dx = dx + 1) {\n                let offset = vec3<i32>(dx, dy, dz);\n                let neighbor_cell = cell + offset;\n\n                // Wrap only for hashing (so randomness repeats across texture bounds).\n                let wrap_cell_u = vec3<u32>(\n                    u32(positive_modulo(neighbor_cell.x, tileCellsI.x)),\n                    u32(positive_modulo(neighbor_cell.y, tileCellsI.y)),\n                    u32(positive_modulo(neighbor_cell.z, tileCellsI.z))\n                );\n\n                // Feature point inside the neighbor cell in [0,1)^3 with optional jitter.\n                let r = rng3(wrap_cell_u);\n                // Pure Voronoi uses full-range [0,1) positions. JITTER < 1.0 pulls toward the cell center.\n                let feature_local = mix(vec3<f32>(0.5), r, JITTER);\n\n                // Relative vector from current voxel's local position to the feature (in cell units).\n                let rel = vec3<f32>(offset) + feature_local - p_local;\n\n                let d2 = dot(rel, rel);\n                if (d2 < min_d2) {\n                    min_d2 = d2;\n                }\n            }\n        }\n    }\n\n    // Normalize by sqrt(3) (max possible nearest distance in unit cube neighborhood).\n    let inv_sqrt3 = 0.5773502691896258; // 1/sqrt(3)\n    let f1 = clamp(sqrt(min_d2) * inv_sqrt3, 0.0, 1.0);\n\n    // Write grayscale Voronoi F1 distance.\n    let c = vec4<f32>(f1, f1, f1, 1.0);\n    textureStore(output_texture, vec3<i32>(global_invocation_id), c);\n}\n"},{bindingsMapping:{output_texture:{group:0,binding:0}}}),[4,nN(function(){return t.isReady()},H.Z.COMPUTE_SHADER_READY_MAX_RETRY,10)];case 1:return r.sent(),[2,new n(t)]}})},function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(e){aT(a,r,o,i,u,"next",e)}function u(e){aT(a,r,o,i,u,"throw",e)}i(void 0)})})()}}],e&&ax(n.prototype,e),t&&ax(n,t),n}();function aR(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}aS(aP,"WORKGROUP_SIZE",[4,4,4]);var aA=function(e,t,n,r,o){var a=new a_.Slider;a.minimum=t,a.maximum=n,a.value=0,a.width="200px",a.height="40px",a.onValueChangedObservable.add(r),o.addControl(a)};function aE(e,t){var n;return(n=function(){var t,n,o,a,i,u,s,l,c,f,p,d;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(h){switch(h.label){case 0:if((t=new r.Scene(e)).defaultCursor="default",n=new r.ArcRotateCamera("camera1",Math.PI/2,Math.PI/4,3,r.Vector3.Zero(),t),n.wheelPrecision*=10,n.minZ=.1,n.setTarget(r.Vector3.Zero()),n.attachControl(),new r.HemisphericLight("light1",new r.Vector3(0,1,0),t).intensity=.7,r.MeshBuilder.CreateBox("box",{size:1.001},t).visibility=.2,(o=r.MeshBuilder.CreatePlane("xzPlane",{size:1,sideOrientation:r.Mesh.DOUBLESIDE},t)).rotation.x=Math.PI/2,o.rotation.y=-Math.PI/2,a=r.MeshBuilder.CreatePlane("xyPlane",{size:1,sideOrientation:r.Mesh.DOUBLESIDE},t),(i=r.MeshBuilder.CreatePlane("yzPlane",{size:1,sideOrientation:r.Mesh.DOUBLESIDE},t)).rotation.y=Math.PI/2,u=a_.AdvancedDynamicTexture.CreateFullscreenUI("UI"),(s=new a_.StackPanel).isVertical=!1,s.height="100px",s.horizontalAlignment=a_.StackPanel.HORIZONTAL_ALIGNMENT_CENTER,(l=new a_.StackPanel).verticalAlignment=a_.StackPanel.VERTICAL_ALIGNMENT_BOTTOM,l.addControl(s),u.addControl(l),"voronoi"!==new URLSearchParams(window.location.search).get("texture"))return[3,2];return c=t8("voronoiTexture",{width:128,height:128,depth:128},r.Constants.TEXTUREFORMAT_RGBA,t,{type:r.Constants.TEXTURETYPE_UNSIGNED_BYTE}),[4,aP.New(e)];case 1:return h.sent().dispatch(c),[3,3];case 2:for(p=0,f=new Float32Array(8388608);p<f.length;p++)f[p]=Math.random();c=t8("testTexture",{width:16,height:16,depth:16},r.Constants.TEXTUREFORMAT_RGBA,t,{data:f,type:r.Constants.TEXTURETYPE_FLOAT}),h.label=3;case 3:return r.Effect.ShadersStore.customVertexShader="\n        precision highp float;\n        attribute vec3 position;\n\n        uniform mat4 worldViewProjection;\n        uniform mat4 world;\n\n        varying vec3 vPositionW;\n\n        void main() {\n            vec4 p = vec4(position, 1.);\n\n            vPositionW = (world * p).xyz;\n\n            gl_Position = worldViewProjection * p;\n        }\n    ",r.Effect.ShadersStore.customFragmentShader="\n        precision highp float;\n\n        uniform sampler3D volumeTexture;\n        varying vec3 vPositionW;\n\n        void main() {\n            gl_FragColor = texture(volumeTexture, vPositionW);\n        }\n    ",(d=new r.ShaderMaterial("PlaneMaterial",t,"custom",{attributes:["position"],uniforms:["worldViewProjection","world"],samplers:["volumeTexture"]})).setTexture("volumeTexture",c),o.material=d,a.material=d,i.material=d,aA("XZ",-.5,.5,function(e){o.position.y=e},s),aA("XY",-.5,.5,function(e){a.position.z=e},s),aA("YZ",-.5,.5,function(e){i.position.x=e},s),[2,t]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){aR(a,r,o,i,u,"next",e)}function u(e){aR(a,r,o,i,u,"throw",e)}i(void 0)})})()}var aI=n(19577),aO=n(86950),aC=n(24432),ak=n(16050),aM=n(31328);function aN(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function aL(e,t){var n;return(n=function(){var t,n,o,a;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(i){switch(i.label){case 0:return t=new C.x(e),(n=new r.FreeCamera("camera1",new r.Vector3(0,5,-10),t)).setTarget(r.Vector3.Zero()),n.attachControl(),[4,(0,eX.L)()];case 1:switch(i.sent(),o=new aI.b(new G.cV),document.body.appendChild(o.root),null!=(a=new URLSearchParams(window.location.search).get("tutorial"))?a:"flight"){case"flight":return[3,2];case"fuelScoop":return[3,4];case"stationLanding":return[3,6];case"starMap":return[3,8]}return[3,10];case 2:return[4,o.setTutorial(new aO.d)];case 3:case 5:case 7:case 9:return i.sent(),[3,10];case 4:return[4,o.setTutorial(new aC.L)];case 6:return[4,o.setTutorial(new aM.b)];case 8:return[4,o.setTutorial(new ak.D)];case 10:return[2,t]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){aN(a,r,o,i,u,"next",e)}function u(e){aN(a,r,o,i,u,"throw",e)}i(void 0)})})()}var aU=n(71351);function aF(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function aB(e,t){var n;return(n=function(){var t,n,o,a,i;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(u){switch(u.label){case 0:return(t=new C.x(e)).useRightHandedSystem=!0,o=(n=new _.Q(t)).getActiveCamera(),[4,E(t)];case 1:return u.sent(),(a=r.MeshBuilder.CreateBox("Anchor",{size:10},t)).position.z=200,(i=new aU.u(t)).setThrottle(1),i.getTransform().parent=a,t.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;i.update(t),n.update(t),a.position.z+=2e3*t,n.getTransform().position.z+=2e3*t;var r=o.globalPosition;a.position.subtractInPlace(r),n.getTransform().position.subtractInPlace(r)}),[2,t]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){aF(a,r,o,i,u,"next",e)}function u(e){aF(a,r,o,i,u,"throw",e)}i(void 0)})})()}function aG(e,t,n,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){n(e);return}u.done?t(s):Promise.resolve(s).then(r,o)}function aj(e,t){var n;return(n=function(){var t,n,u,c,d;function m(n){t.cameras.forEach(function(e){return e.attachPostProcess(n)}),t.onNewCameraAddedObservable.add(function(e){e.attachPostProcess(n)}),t.onBeforeRenderObservable.add(function(){var t=e.getDeltaTime()/1e3;n.update(t)})}return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){var l=[u,s];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(g){switch(g.label){case 0:var w,_,T,x,P,R,A,E,I,O;return((t=new C.x(e)).useRightHandedSystem=!0,n=new URLSearchParams(window.location.search),(u=new r.ArcRotateCamera("ArcRotateCamera",0,3.14/3,5,S.P.Zero(),t)).attachControl(),u.lowerRadiusLimit=.5,u.wheelPrecision*=100,u.minZ=.01,(c=t.enableDepthRenderer(null,!0,!0)).clearColor=new r.Color4(0,0,0,1),"mandelbulb"===(d=n.get("fractal")))?(w=(0,f.i)("mandelbulb",1e5*Math.random(),"XR Anomaly",[]),(_=new i.W(w,t)).getTransform().scalingDeterminant=1/4e5,m(new p.C(_.getTransform(),_.getBoundingRadius(),w,t,[])),_.getTransform()):"julia"===d?(T=(0,o.c)("julia",1e5*Math.random(),"XR Anomaly",[]),(x=new i.W(T,t)).getTransform().scalingDeterminant=1/4e5,m(new a.v(x.getTransform(),x.getBoundingRadius(),T.accentColor,t,[])),x.getTransform()):"mandelbox"===d?(P=(0,s.i)("mandelbox",1e5*Math.random(),"XR Anomaly",[]),(R=new i.W(P,t)).getTransform().scalingDeterminant=1e-5,m(new l.m(R.getTransform(),R.getBoundingRadius(),P,t,[])),R.getTransform()):"pyramid"===d?(A=(0,b.q)("sierpinski",1e5*Math.random(),"XR Anomaly",[]),(E=new i.W(A,t)).getTransform().scalingDeterminant=1e-5,m(new y.U(E.getTransform(),E.getBoundingRadius(),A,t,[])),E.getTransform()):(I=(0,h.$)("menger",1e5*Math.random(),"XR Anomaly",[]),(O=new i.W(I,t)).getTransform().scalingDeterminant=1e-5,m(new v.x(O.getTransform(),O.getBoundingRadius(),I,t,[])),O.getTransform()),[4,t.createDefaultXRExperienceAsync()];case 1:return g.sent().baseExperience.camera.setTransformationFromNonVRCamera(u,!0),t.onBeforeCameraRenderObservable.add(function(e){c.getDepthMap().activeCamera=e}),[2,t]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){aG(a,r,o,i,u,"next",e)}function u(e){aG(a,r,o,i,u,"throw",e)}i(void 0)})})()}var aD=function(){var e;function t(){var e;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");e=new Map([["orbitalDemo",eB],["tunnel",eE],["automaticLanding",z],["spaceStation",oG],["spaceStationUI",oz],["xr",aj],["flightDemo",es],["neutronStar",af],["character",Q],["starMap",oJ],["tutorial",aL],["asteroidField",O],["starSystemView",o7],["rings",eD],["sierpinski",g],["mandelbox",c],["mandelbulb",d],["juliaSet",u],["mengerSponge",m],["atmosphericScattering",N],["darkKnight",en],["blackHole",aa],["gasPlanet",em],["telluricPlanet",ah],["jupiter",rI],["saturn",ow],["sol",oI],["grass",ex],["warpTunnel",aB],["saveLoadingPanelContent",eK],["sun",oL],["terrain",aw],["sphericalTerrain",oZ],["earth",rP],["mars",rZ],["moon",om],["mercury",r9],["texture3d",aE]]),"map"in this?Object.defineProperty(this,"map",{value:e,enumerable:!0,configurable:!0,writable:!0}):this.map=e}return e=[{key:"register",value:function(e,t){this.map.set(e,t)}},{key:"get",value:function(e){var t;return null!=(t=this.map.get(e))?t:er}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},81469:function(e,t,n){n.d(t,{V:()=>o,n:()=>a});var r=n(26980),o=r.z.object({type:r.z.literal("discoveryScanner"),size:r.z.number(),quality:r.z.number()});function a(e){return{relativeRange:e.size+e.quality/10}}},91010:function(e,t,n){n.d(t,{P8:()=>o,Wl:()=>i,ZX:()=>a});var r=n(61834);function o(e,t){for(var n=Math.floor(e.length/16),r=Math.floor(n/t),o=new Float32Array(16*r),a=0;a<r;a++){var i=16*Math.floor(Math.random()*n);o.set(e.subarray(i,i+16),16*a)}return o}function a(e,t,n,o){for(var a=new Float32Array(n*n*16),i=t/n,u=0,s=0;s<n;s++)for(var l=0;l<n;l++){var c=o()*i,f=o()*i,p=e.x+s*i-t/2+c,d=e.z+l*i-t/2+f,h=.7+.6*o();r.y3.Compose(new r.P(h,h,h),r._f.RotationAxis(r.P.Up(),2*o()*Math.PI),new r.P(p,0,d)).copyToArray(a,16*u),u+=1}return a}function i(e,t,n,o){if(void 0===e[0]||void 0===e[1]||void 0===e[2]||void 0===e[3]||void 0===e[4]||void 0===e[5]||void 0===e[6]||void 0===e[7]||void 0===e[8]||void 0===e[9]||void 0===e[10]||void 0===e[11]||void 0===e[12]||void 0===e[13]||void 0===e[14]||void 0===e[15])throw Error("Matrix is not defined");t.set(e[12],e[13],e[14]);var a=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);o.set(a,a,a);var i=r.y3.Identity();i.setRowFromFloats(0,e[0]/a,e[1]/a,e[2]/a,0),i.setRowFromFloats(1,e[4]/a,e[5]/a,e[6]/a,0),i.setRowFromFloats(2,e[8]/a,e[9]/a,e[10]/a,0),i.setRowFromFloats(3,0,0,0,1),n.copyFrom(r._f.FromRotationMatrix(i))}},91307:function(e,t,n){function r(e,t){var n=[];if(e.children.forEach(function(e,r){if("x"!==r&&"y"!==r){var o,a,i=e.name;i=i.replace("key:",""),i=null!=(a=null==t||null==(o=t.get(i))?void 0:o.toUpperCase())?a:i,n.push([r,i])}}),void 0===n[0]||void 0===n[1]||void 0===n[2]||void 0===n[3])throw Error("DPadComposite keys are undefined");return[n[2],n[0],n[3],n[1]]}function o(e,t){var n=[];return e.children.forEach(function(e,r){var o,a,i=e.name;i=i.replace("key:",""),i=null!=(a=null==t||null==(o=t.get(i))?void 0:o.toUpperCase())?a:i,n.push([r,i])}),n}function a(e,t){return e.action.bindings.map(function(e){var n,r,o,a;return n=e.control,a=(a=n.name).replace("key:",""),a=null!=(o=null==t||null==(r=t.get(a))?void 0:r.toUpperCase())?o:a})}n.d(t,{C9:()=>o,cs:()=>r,gW:()=>a})},91822:function(e,t,n){n.d(t,{Z:()=>r});function r(e,t,n){return(0x466f45d*e^0x127409f*t^0x4f9ffb7*n)%1e9}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.m=e,(()=>{var e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",o=e=>{e&&e.d<1&&(e.d=1,e.forEach(e=>e.r--),e.forEach(e=>e.r--?e.r++:e()))},a=n=>n.map(n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var a=[];a.d=0,n.then(e=>{i[t]=e,o(a)},e=>{i[r]=e,o(a)});var i={};return i[e]=e=>e(a),i}}var u={};return u[e]=function(){},u[t]=n,u});n.a=(n,i,u)=>{u&&((s=[]).d=-1);var s,l,c,f,p=new Set,d=n.exports,h=new Promise((e,t)=>{f=t,c=e});h[t]=d,h[e]=e=>{s&&e(s),p.forEach(e),h.catch(function(){})},n.exports=h,i(n=>{l=a(n);var o,i=()=>l.map(e=>{if(e[r])throw e[r];return e[t]}),u=new Promise(t=>{(o=()=>t(i)).r=0;var n=e=>e!==s&&!p.has(e)&&(p.add(e),e&&!e.d&&(o.r++,e.push(o)));l.map(t=>t[e](n))});return o.r?u:i()},e=>(e?f(h[r]=e):c(d),o(s))),s&&s.d<0&&(s.d=0)}})(),n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.k=e=>""+e+".css",n.u=e=>""+e+"."+({1009:"4e09f2eb6fb572e7",1108:"00fe7425e8dfa7de",1192:"6bc188dfcce4a7db",1246:"a6d8767a6ddf1d6c",1413:"c91e9f77aa843175",1420:"ca81dd390692d997",1523:"d452cee24142d238",1619:"cedaa2bd44b3b853",1667:"f165f5c1f8d21272",1670:"5bb47da53daa6519",1730:"6f3b433e2b9413b2",178:"04b5c4f07b354096",1801:"fa674c3ff688a69b",1806:"ece43cee92dba8ed",188:"565063ee0612af57",1935:"b48077fb07edbbbe",1952:"f3927659c9d3a9fb",1953:"097da047255cecd4",1966:"feebb9a8c1e1ccec",1968:"b98704fa70c3d48c",2029:"f72c675b7f77adf6",2070:"9574178ac62600b9",2219:"2c3f420ec8a7f627",2400:"2cec4bd956fac0e4",2508:"e735353dd2f7121a",2524:"59e480ff430393f7",2751:"3547cdd721fdb4e7",276:"20463a0f6b54768c",2770:"fa3dfda4da92b40e",2814:"92a9ea152015ca79",2851:"82f306a3dc3e531f",287:"0921cdd649d45e62",2886:"ba81cdcee8da8d67",29:"d05953d40e6c6bdd",2907:"21dccbfda50f02f1",2927:"1cbf6925f559598d",2951:"fe0d062f14355e20",2979:"bedada3d8734d327",3034:"56aacf35db44363a",3145:"ef866cba8c543650",3332:"3f06ec03e72e5e06",34:"a3fa484be544439e",3536:"5b7d8d76c9e35c12",3674:"d80141f33fb3d9a8",3722:"ced176c80adeaf11",3742:"16c2bac33b1752f5",3745:"cf54c8eab2e4b2bf",3798:"bef4813d59f74f9d",3833:"06ab04ec1666faa5",3845:"d27dabaf9a64c1fe",395:"c345047896c9a2a0",4003:"98afa796a3b45df9",4129:"0bfd3a3e2d044e3b",4164:"8864c3f24a2d80be",4280:"92b42bdca365ff81",4296:"d025fb75a4e0be15",4309:"6c2a6a517e8542fc",4441:"18fd7745b7fae304",4549:"065f54f53200d271",4556:"be6fd477d7e1d5b8",4584:"233beaeaca4507ec",4636:"619990781b1fa2c8",4658:"5215752f114ab92f",4751:"b96ee6f2953f8158",477:"f4d4c9ef3f358999",4774:"fff0cb2f4591e4d0",4820:"3b7f21bdb09f53b5",4823:"5a15113e9aced178",5038:"db4923baee4bdba9",5185:"23b74d5de79b65f4",5221:"18e9d185b1d01f07",5381:"b2be4284de0d1cce",5551:"c2abb4cdb2d8a5bc",5603:"258b8561a6464435",5630:"42bfe7c514e6e1ff",5652:"4308bd36c3d07b44",579:"42fa556d70e592ed",5815:"5ac8ff84307b750d",5915:"314a98d3154a8173",5960:"3d758248c1eff04a",5988:"e6a7e155e4277968",5989:"5e039e22c64b3c75",5997:"cd981479dddfed58",6150:"09fbe177dd9e55a2",6240:"4c4ab50553285ee6",6248:"ed24a4a08993849a",6253:"98bd5534c6f2547d",6264:"14baeb4f12c1a6bd",6342:"f2776df4a469b38a",6378:"f0d7c4209dde3fc3",65:"30e1a03fd2992306",6500:"a7d72979fd2f6892",6550:"b8f7074cf83e5b4b",6551:"33fef526a71c11bc",66:"3dfdcd75e7aeea66",6645:"101350041eaf8c0e",67:"34bf38ec8f16371a",6758:"044473dcb696902f",6903:"5bcc3b98827507b5",7044:"c29afde9765c10c2",7081:"f54bab8775979f7c",712:"9cc0f3aef7661a43",7122:"9b2a9c0b4d7719cf",7126:"ccaf29bfbf3aac92",713:"e51b368f0e2eb3cf",7141:"36798d8f72c2e56e",7143:"2ec7bcabc113582c",7291:"3eab4a3a855b9bf0",7311:"8bed6f2771abb6b3",7590:"02186071a278da7b",7606:"6fcb1ff5b1721d1d",761:"92fb5c010539fa69",7809:"3aaec01bfa7b82d4",7843:"04e51aecba961339",7874:"fe0133e2443eb483",7903:"7a40885624204d09",7927:"8bc67d46817ebf12",7971:"affb0e13f60e979c",8097:"20f9610fc35097ce",8197:"f804e1d75f2a08f4",8204:"30b0c2aa4b89d82e",8210:"b8b5372c25f2ddc7",8314:"2c4a8ca3c207cc43",8321:"93eff49fd1c17cf3",833:"a968828739cec5a4",8345:"461189a0002f76ec",8497:"6d96d201a74d5ffd",8561:"badeebfde897a73b",8631:"ff5652adfa8e6ded",8632:"ac33ba04fb1c3888",8661:"1b45ba22d96561a9",8775:"ede08a2083b775ed",8854:"95057da7267ee458",8953:"c32f83dbd9a61dff",8975:"8f869395af72ed17",8978:"388f04717647405b",9050:"b6daa4b6a2cbf3fe",9068:"4c1df3aa9074ee9d",9075:"5fd8ae1fd8118631",9123:"9b62bda9b2bf6bbc",9190:"57be96b2ea48c611",9249:"4acc99b99a61d136",9256:"3745335b0d834476",9276:"c31f9160fcec626c",9385:"eeba2f32ece0dd7b",9474:"b5ca8e84c57f37b7",9616:"e42351c8ee1d64fb",9646:"bff583100e5a5b5c",974:"d475d90651a484f7",9749:"0117bee4d54a979b",975:"07939f26ed1e9130",9824:"188c489e64174b2d",9828:"06179aceb5726924",9870:"e00f89104b331c8a",9999:"34242539546a7587"})[e]+".js",n.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="cosmos-journeyer:";n.l=function(r,o,a,i){if(e[r])return void e[r].push(o);if(void 0!==a)for(var u,s,l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var f=l[c];if(f.getAttribute("src")==r||f.getAttribute("data-webpack")==t+a){u=f;break}}u||(s=!0,(u=document.createElement("script")).charset="utf-8",u.timeout=120,n.nc&&u.setAttribute("nonce",n.nc),u.setAttribute("data-webpack",t+a),u.src=r),e[r]=[o];var p=function(t,n){u.onerror=u.onload=null,clearTimeout(d);var o=e[r];if(delete e[r],u.parentNode&&u.parentNode.removeChild(u),o&&o.forEach(function(e){return e(n)}),t)return t(n)},d=setTimeout(p.bind(null,void 0,{type:"timeout",target:u}),12e4);u.onerror=p.bind(null,u.onerror),u.onload=p.bind(null,u.onload),s&&document.head.appendChild(u)}})(),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=(t,r,o,a)=>{if(r){a=a||0;for(var i=e.length;i>0&&e[i-1][2]>a;i--)e[i]=e[i-1];e[i]=[r,o,a];return}for(var u=1/0,i=0;i<e.length;i++){for(var[r,o,a]=e[i],s=!0,l=0;l<r.length;l++)(!1&a||u>=a)&&Object.keys(n.O).every(e=>n.O[e](r[l]))?r.splice(l--,1):(s=!1,a<u&&(u=a));if(s){e.splice(i--,1);var c=o();void 0!==c&&(t=c)}}return t}})(),n.rv=()=>"1.3.13",(()=>{n.g.importScripts&&(e=n.g.location+"");var e,t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw Error("Automatic publicPath is not supported in this browser");n.p=e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/")})(),(()=>{var e={8033:0},t="cosmos-journeyer",r=(t,n)=>{e[n]=0},o="data-webpack-loading",a=function(e,r,a,i,u){var s,l,c="chunk-"+e;if(!i){for(var f=document.getElementsByTagName("link"),p=0;p<f.length;p++){var d=f[p],h=d.getAttribute("href")||d.href;if(h&&!h.startsWith(n.p)&&(h=n.p+(h.startsWith("/")?h.slice(1):h)),"stylesheet"==d.rel&&(h&&h.startsWith(r)||d.getAttribute("data-webpack")==t+":"+c)){s=d;break}}if(!a)return s}s||(l=!0,s=document.createElement("link"),n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+":"+c),u&&s.setAttribute("fetchpriority",u),s.setAttribute(o,1),s.rel="stylesheet",s.href=r);var v=function(e,t){if(s.onerror=s.onload=null,s.removeAttribute(o),clearTimeout(m),t&&"load"!=t.type&&s.parentNode.removeChild(s),a(t),e)return e(t)};if(s.getAttribute(o)){var m=setTimeout(v.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=v.bind(null,s.onerror),s.onload=v.bind(null,s.onload)}else v(void 0,{type:"load",target:s});return i&&i.getAttribute("fetchpriority")&&s.setAttribute("fetchpriority",i.getAttribute("fetchpriority")),i?document.head.insertBefore(s,i):l&&document.head.appendChild(s),s};r(n.m,0,"8033"),n.f.css=function(t,o,i){var u=n.o(e,t)?e[t]:void 0;if(0!==u)if(u)o.push(u[2]);else if(8033==t){var s=new Promise(function(n,r){u=e[t]=[n,r]});o.push(u[2]=s);var l=n.p+n.k(t),c=Error();a(t,l,function(o){if(n.o(e,t)&&(0!==(u=e[t])&&(e[t]=void 0),u))if("load"!==o.type){var a=o&&o.type,i=o&&o.target&&o.target.src;c.message="Loading css chunk "+t+" failed.\n("+a+": "+i+")",c.name="ChunkLoadError",c.type=a,c.request=i,u[1](c)}else r(n.m,t),u[0]()},void 0,i)}else e[t]=0}})(),(()=>{n.b=document.baseURI||self.location.href;var e={8308:0};n.f.j=function(t,r){var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)r.push(o[2]);else{var a=new Promise((n,r)=>o=e[t]=[n,r]);r.push(o[2]=a);var i=n.p+n.u(t),u=Error();n.l(i,function(r){if(n.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;u.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",u.name="ChunkLoadError",u.type=a,u.request=i,o[1](u)}},"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,r)=>{var o,a,[i,u,s]=r,l=0;if(i.some(t=>0!==e[t])){for(o in u)n.o(u,o)&&(n.m[o]=u[o]);if(s)var c=s(n)}for(t&&t(r);l<i.length;l++)a=i[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(c)},r=globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.ruid="bundler=rspack@1.3.13";var r=n.O(void 0,["9826","7384","907","4359","5134","4874","1633","52","3112","9647","482","3759","3821","3829","9248","5725","4400","5983","4055","3826","7650","6444","8033"],function(){return n(18722)});r=n.O(r)})();