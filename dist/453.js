"use strict";(self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[]).push([[453],{453:()=>{var t;!function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Forward=4]="Forward",t[t.Backward=5]="Backward"}(t||(t={}));class e{constructor(t,e,a){this.x=t,this.y=e,this.z=a}dot2(t,e){return this.x*t+this.y*e}dot3(t,e,a){return this.x*t+this.y*e+this.z*a}}let a=[new e(1,1,0),new e(-1,1,0),new e(1,-1,0),new e(-1,-1,0),new e(1,0,1),new e(-1,0,1),new e(1,0,-1),new e(-1,0,-1),new e(0,1,1),new e(0,-1,1),new e(0,1,-1),new e(0,-1,-1)],s=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],i=new Array(512),r=new Array(512);Math.sqrt(3),Math.sqrt(3);const n=1/6;function o(t){return h(t._x,t._y,t._z)}function h(t,e,o){let h,c,l,u;!function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(let e=0;e<256;e++){let n;n=1&e?s[e]^255&t:s[e]^t>>8&255,i[e]=i[e+256]=n,r[e]=r[e+256]=a[n%12]}}(42);let _,d,w,f,M,y,p=.3333333333333333*(t+e+o),m=Math.floor(t+p),x=Math.floor(e+p),g=Math.floor(o+p),T=(m+x+g)*n,z=t-m+T,b=e-x+T,q=o-g+T;z>=b?b>=q?(_=1,d=0,w=0,f=1,M=1,y=0):z>=q?(_=1,d=0,w=0,f=1,M=0,y=1):(_=0,d=0,w=1,f=1,M=0,y=1):b<q?(_=0,d=0,w=1,f=0,M=1,y=1):z<q?(_=0,d=1,w=0,f=0,M=1,y=1):(_=0,d=1,w=0,f=1,M=1,y=0);let N=z-_+n,v=b-d+n,k=q-w+n,F=z-f+2*n,V=b-M+2*n,R=q-y+2*n,A=z-1+.5,D=b-1+.5,I=q-1+.5;m&=255,x&=255,g&=255;let O=r[m+i[x+i[g]]],P=r[m+_+i[x+d+i[g+w]]],S=r[m+f+i[x+M+i[g+y]]],C=r[m+1+i[x+1+i[g+1]]],L=.6-z*z-b*b-q*q;L<0?h=0:(L*=L,h=L*L*O.dot3(z,b,q));let Y=.6-N*N-v*v-k*k;Y<0?c=0:(Y*=Y,c=Y*Y*P.dot3(N,v,k));let B=.6-F*F-V*V-R*R;B<0?l=0:(B*=B,l=B*B*S.dot3(F,V,R));let U=.6-A*A-D*D-I*I;return U<0?u=0:(U*=U,u=U*U*C.dot3(A,D,I)),32*(h+c+l+u)}class c{constructor(t,e,a,s,i){this._frequency=t,this._nbOctaves=e,this._decay=a,this._lacunarity=s,this._minValue=i}evaluate(t){let e=0,a=0;for(let i=0;i<this._nbOctaves;i++){let r=t.scaleToNew(this._frequency);r=r.scaleToNew(Math.pow(this._lacunarity,i)),e+=(1+h((s=r)._x,s._y,s._z))/2/Math.pow(this._decay,i),a+=1/Math.pow(this._decay,i)}var s;return e/=a,1!=this._minValue&&(e=Math.max(this._minValue,e)-this._minValue,e/=1-this._minValue),e}}class l{constructor(t,e,a){this._x=t,this._y=e,this._z=a}getSquaredMagnitude(){return this._x**2+this._y**2+this._z**2}getMagnitude(){return Math.sqrt(this.getSquaredMagnitude())}scaleToNew(t){return new l(this._x*t,this._y*t,this._z*t)}addToNew(t){return new l(this._x+t._x,this._y+t._y,this._z+t._z)}addInPlace(t){this._x+=t._x,this._y+=t._y,this._z+=t._z}normalizeToNew(){return this.scaleToNew(1/this.getMagnitude())}static Zero(){return new l(0,0,0)}static FromArray(t){return new l(t[0],t[1],t[2])}applyMatrixToNew(t){let e=l.Zero(),a=t.m;return e._x=a[0][0]*this._x+a[0][1]*this._y+a[0][2]*this._z,e._y=a[1][0]*this._x+a[1][1]*this._y+a[1][2]*this._z,e._z=a[2][0]*this._x+a[2][1]*this._y+a[2][2]*this._z,e}static DistanceSquared(t,e){return(t._x-e._x)**2+(t._y-e._y)**2+(t._z-e._z)**2}static Distance(t,e){return Math.sqrt(l.DistanceSquared(t,e))}}class u{constructor(t){this.m=t}static RotationX(t){return new u([[1,0,0],[0,Math.cos(t),-Math.sin(t)],[0,Math.sin(t),Math.cos(t)]])}static RotationY(t){return new u([[Math.cos(t),0,Math.sin(t)],[0,1,0],[-Math.sin(t),0,Math.cos(t)]])}static RotationZ(t){return new u([[Math.cos(t),-Math.sin(t),0],[Math.sin(t),Math.cos(t),0],[0,0,1]])}static Identity(){return new u([[1,0,0],[0,1,0],[0,0,1]])}}class _{constructor(t,e,a,s,i){this._frequency=t,this._nbOctaves=e,this._decay=a,this._lacunarity=s,this._minValue=i}evaluate(t){let e=0,a=0;for(let s=0;s<this._nbOctaves;s++){let i=t.scaleToNew(this._frequency);i=i.scaleToNew(Math.pow(this._lacunarity,s)),e+=o(i)/Math.pow(this._decay,s),a+=1/Math.pow(this._decay,s)}return e/=a,e=1-Math.abs(e),this._minValue<1&&(e=Math.max(this._minValue,e)-this._minValue,e/=1-this._minValue),e}}class d{constructor(t,e,a,s,i){this._frequency=t,this._nbOctaves=e,this._decay=a,this._lacunarity=s,this._minValue=i}evaluate(t){let e=0,a=0;for(let s=0;s<this._nbOctaves;s++){let i=t.scaleToNew(this._frequency);i=i.scaleToNew(Math.pow(this._lacunarity,s)),e+=o(i)/Math.pow(this._decay,s),a+=1/Math.pow(this._decay,s)}return e/=a,e=Math.pow(e,2),this._minValue<1&&(e=Math.max(this._minValue,e)-this._minValue,e/=1-this._minValue),e*=.95,e+=1-.95,e}}let w,f,M,y,p={radiusModifier:1,steepnessModifier:1,maxDepthModifier:1,scaleFactor:1},m={amplitudeModifier:1,offsetModifier:[0,0,0],frequencyModifier:1,minValueModifier:1,archipelagoFactor:.5};function x(){w=new c(1e-4,5,2,2,0),f=new c(5e-6,5,1.8,2,m.archipelagoFactor),M=new d(2e-5,5,1.5,2,0),y=new _(2e-5,6,2,2,0)}x();let g=new class extends class{constructor(t){this.filterFunction=t}evaluate(t,e){return this.filterFunction(t,e)}}{constructor(t){super(((e,a)=>{for(let s of t)l.DistanceSquared(e,l.FromArray(s.position)),s.radius,a.radiusModifier,s.steepness,a.steepnessModifier;return 0}))}setCraters(t){this.filterFunction=(e,a)=>{let s=0;for(let i of t){let t=l.Distance(e,l.FromArray(i.position)),r=i.radius*a.radiusModifier;i.steepness,a.steepnessModifier,t<=r&&(s+=3e5*r*((t/r)**(16*a.steepnessModifier)-1)*a.maxDepthModifier)}return s}}}([]);function T(t,e,a){let s=[t._x,t._y,t._z],i=Math.sqrt(s[0]**2+s[1]**2+s[2]**2);s=s.map((t=>t*a/i));let r=l.FromArray(s),n=r.normalizeToNew().scaleToNew(m.frequencyModifier),o=0;o+=e.evaluate(n,p)/20,o+=f.evaluate(r)*y.evaluate(r)*1e4,o+=300*w.evaluate(r);let h=t.addToNew(n.scaleToNew(o));return new l(h._x,h._y,h._z)}onmessage=e=>{if("buildTask"==e.data.taskType){let a=e.data.chunkLength,s=e.data.subdivisions,i=e.data.depth,r=e.data.direction,n=e.data.position;g.setCraters(e.data.craters),m=e.data.noiseModifiers,p=e.data.craterModifiers,x();let o=a/2**i,h=a/2,c=[],_=[],d=s+1,w=u.Identity();switch(r){case t.Up:w=u.RotationX(-Math.PI/2);break;case t.Down:w=u.RotationX(Math.PI/2);break;case t.Forward:w=u.Identity();break;case t.Backward:w=u.RotationY(-Math.PI);break;case t.Left:w=u.RotationY(Math.PI/2);break;case t.Right:w=u.RotationY(-Math.PI/2)}for(let t=0;t<d;t++)for(let e=0;e<d;e++){let a=new l((t-s/2)/s,(e-s/2)/s,0);a=a.scaleToNew(o);let i=l.FromArray(n);a=a.addToNew(i),a=a.applyMatrixToNew(w),a=a.normalizeToNew().scaleToNew(h),a=T(a,g,h),c.push(a._x,a._y,a._z),t<d-1&&e<d-1&&_.push([t*d+e,t*d+e+1,(t+1)*d+e+1,(t+1)*d+e])}let f=c,M=[],y=[];for(let t of _)for(let e=0;e<t.length-2;e++)M.push(t[0],t[e+2],t[e+1]);!function(t,e,a){var s=0,i=0,r=0,n=0,o=0,h=0,c=0,l=0,u=0,_=0,d=0,w=0,f=0,M=0,y=0,p=0,m=0,x=0,g=0,T=0;for(s=0;s<t.length;s++)a[s]=0;var z=e.length/3|0;for(s=0;s<z;s++)f=1+(w=3*e[3*s]),M=w+2,p=1+(y=3*e[3*s+1]),m=y+2,g=1+(x=3*e[3*s+2]),T=x+2,i=t[w]-t[y],r=t[f]-t[p],n=t[M]-t[m],o=t[x]-t[y],h=t[g]-t[p],l=1*(r*(c=t[T]-t[m])-n*h),u=1*(n*o-i*c),_=1*(i*h-r*o),l/=d=0===(d=Math.sqrt(l*l+u*u+_*_))?1:d,u/=d,_/=d,a[w]+=l,a[f]+=u,a[M]+=_,a[y]+=l,a[p]+=u,a[m]+=_,a[x]+=l,a[g]+=u,a[T]+=_;for(s=0;s<a.length/3;s++)l=a[3*s],u=a[3*s+1],_=a[3*s+2],l/=d=0===(d=Math.sqrt(l*l+u*u+_*_))?1:d,u/=d,_/=d,a[3*s]=l,a[3*s+1]=u,a[3*s+2]=_}(f,M,y);let z=new Float32Array(f.length);z.set(f);let b=new Int16Array(M.length);b.set(M);let q=new Float32Array(y.length);q.set(y),postMessage({p:z,i:b,n:q},[z.buffer,b.buffer,q.buffer])}else console.log(`Tâche reçue : ${e.data.taskType}`)}}}]);