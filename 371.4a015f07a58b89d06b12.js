
//  This file is part of Cosmos Journeyer
//
//  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
//
//  This program is free software: you can redistribute it and/or modify
//  it under the terms of the GNU Affero General Public License as published by
//  the Free Software Foundation, either version 3 of the License, or
//  (at your option) any later version.
//
//  This program is distributed in the hope that it will be useful,
//  but WITHOUT ANY WARRANTY; without even the implied warranty of
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//  GNU Affero General Public License for more details.
//
//  You should have received a copy of the GNU Affero General Public License
//  along with this program.  If not, see <https://www.gnu.org/licenses/>.
        
"use strict";(self.webpackChunkcosmos_journeyer=self.webpackChunkcosmos_journeyer||[]).push([[371],{477:(e,t,s)=>{s.d(t,{n:()=>n});var r=s(52101),i=s(9300);class n{static Instantiate(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];const t=(0,i.n9)(e);if(t)return t;r.V.Warn(e+" not found, you may have missed an import.");const s=e.split(".");let n=window||this;for(let e=0,t=s.length;e<t;e++)n=n[s[e]];return"function"!=typeof n?null:n}}n.RegisteredExternalClasses={}},2438:(e,t,s)=>{s.d(t,{K:()=>r});class r{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=r.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=r.KEEP,this.opDepthFail=r.KEEP,this.opStencilDepthPass=r.REPLACE}get stencilFunc(){return this.func}set stencilFunc(e){this.func=e}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(e){this.funcRef=e}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(e){this.funcMask=e}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(e){this.opStencilFail=e}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(e){this.opDepthFail=e}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(e){this.opStencilDepthPass=e}get stencilMask(){return this.mask}set stencilMask(e){this.mask=e}get stencilTest(){return this.enabled}set stencilTest(e){this.enabled=e}}r.ALWAYS=519,r.KEEP=7680,r.REPLACE=7681},9262:(e,t,s)=>{s.d(t,{l:()=>r});class r{static GetShadersRepository(e=0){return 0===e?r.ShadersRepository:r.ShadersRepositoryWGSL}static GetShadersStore(e=0){return 0===e?r.ShadersStore:r.ShadersStoreWGSL}static GetIncludesShadersStore(e=0){return 0===e?r.IncludesShadersStore:r.IncludesShadersStoreWGSL}}r.ShadersRepository="src/Shaders/",r.ShadersStore={},r.IncludesShadersStore={},r.ShadersRepositoryWGSL="src/ShadersWGSL/",r.ShadersStoreWGSL={},r.IncludesShadersStoreWGSL={}},9300:(e,t,s)=>{s.d(t,{Y5:()=>i,n9:()=>n});const r={};function i(e,t){r[e]=t}function n(e){return r[e]}},9370:(e,t,s)=>{s.d(t,{$:()=>C});var r=s(44903),i=s(52101),n=s(24952),o=s(41355),a=s(72785),l=s(22671),h=s(96648),c=s(2438),u=s(23762),_=s(24099),d=s(44838),f=s(67618),p=s(40380),g=s(84153),m=s(62762);function b(e,t){if((0,f.BA)()){const{requestAnimationFrame:s}=t||window;if("function"==typeof s)return s(e)}else if("function"==typeof requestAnimationFrame)return requestAnimationFrame(e);return setTimeout(e,16)}class C{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(e){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?518:515)}setColorWrite(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(e){if(e)return this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);{let e="";return this.isNDCHalfZRange&&(e+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}_rebuildInternalTextures(){const e=this._internalTexturesCache.slice();for(const t of e)t._rebuild()}_rebuildRenderTargetWrappers(){const e=this._renderTargetWrapperCache.slice();for(const t of e)t._rebuild()}_rebuildEffects(){for(const e in this._compiledEffects){const t=this._compiledEffects[e];t._pipelineContext=null,t._prepareEffect()}n.M.ResetCache()}_rebuildGraphicsResources(){this.wipeCaches(!0),this._rebuildEffects(),this._rebuildComputeEffects?.(),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){i.V.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(e){setTimeout((async()=>{this._clearEmptyResources();const t=this._depthCullingState.depthTest,s=this._depthCullingState.depthFunc,r=this._depthCullingState.depthMask,i=this._stencilState.stencilTest;await e(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=s,this._depthCullingState.depthMask=r,this._stencilState.stencilTest=i,this._flagContextRestored()}),0)}get isDisposed(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(e){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(e){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(e){if(!e)return this._activeRenderLoops.length=0,void this._cancelFrame();const t=this._activeRenderLoops.indexOf(e);t>=0&&(this._activeRenderLoops.splice(t,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const e=this._frameHandler;if(this._frameHandler=0,(0,f.BA)()){const{cancelAnimationFrame:t}=this.getHostWindow()||window;if("function"==typeof t)return t(e)}else if("function"==typeof cancelAnimationFrame)return cancelAnimationFrame(e);return clearTimeout(e)}}beginFrame(){this.onBeginFrameObservable.notifyObservers(this)}endFrame(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e,void 0!==e&&(this._minFrameTime=e<=0?Number.MAX_VALUE:1e3/(e+1))}_isOverFrameTime(e){if(!e)return!1;const t=e-this._lastFrameTime;return!(void 0===this._maxFPS||t>=this._minFrameTime)||(this._lastFrameTime=e,!1)}_processFrame(e){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(e)){let e=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.endFrame())}}_renderLoop(e){this._processFrame(e),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let e=0;e<this._activeRenderLoops.length;e++)(0,this._activeRenderLoops[e])()}_renderViews(){return!1}_queueNewFrame(e,t){return b(e,t)}runRenderLoop(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(e){this._depthCullingState.depthTest=e}setZOffset(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}getZOffset(){const e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}setZOffsetUnits(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}getZOffsetUnits(){const e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}getHostWindow(){return(0,f.BA)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(e){this._compatibilityMode=!0}_rebuildTextures(){for(const e of this.scenes)e._rebuildTextures();for(const e of this._virtualScenes)e._rebuildTextures()}_releaseRenderTargetWrapper(e){const t=this._renderTargetWrapperCache.indexOf(e);-1!==t&&this._renderTargetWrapperCache.splice(t,1)}get currentViewport(){return this._cachedViewport}setViewport(e,t,s){const r=t||this.getRenderWidth(),i=s||this.getRenderHeight(),n=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(n*r,o*i,r*e.width,i*e.height)}createCanvasImage(){return document.createElement("img")}get description(){let e=this.name+this.version;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e}_createTextureBase(e,t,s,n,o=3,a=null,l=null,h,c,u=null,_=null,f=null,p=null,g,b,v){const x="data:"===(e=e||"").substr(0,5),y="blob:"===e.substr(0,5),S=x&&-1!==e.indexOf(";base64,"),w=_||new d.h(this,1);w!==_&&(w.label=e.substring(0,60));const F=e;!this._transformTextureUrl||S||_||u||(e=this._transformTextureUrl(e)),F!==e&&(w._originalUrl=F);const P=e.lastIndexOf(".");let A=p||(P>-1?e.substring(P).toLowerCase():"");A.indexOf("?")>-1&&(A=A.split("?")[0]);const T=(0,m.gT)(A,g);n&&n.addPendingData(w),w.url=e,w.generateMipMaps=!t,w.samplingMode=o,w.invertY=s,w._useSRGBBuffer=this._getUseSRGBBuffer(!!v,t),this._doNotHandleContextLost||(w._buffer=u);let R=null;a&&!_&&(R=w.onLoadedObservable.add(a)),_||this._internalTexturesCache.push(w);const E=(s,_)=>{n&&n.removePendingData(w),e===F?(R&&w.onLoadedObservable.remove(R),r.q.UseFallbackTexture&&e!==r.q.FallbackTexture&&this._createTextureBase(r.q.FallbackTexture,t,w.invertY,n,o,null,l,h,c,u,w),s=(s||"Unknown error")+(r.q.UseFallbackTexture?" - Fallback texture was used":""),w.onErrorObservable.notifyObservers({message:s,exception:_}),l&&l(s,_)):(i.V.Warn(`Failed to load ${e}, falling back to ${F}`),this._createTextureBase(F,t,w.invertY,n,o,a,l,h,c,u,w,f,p,g,b,v))};if(T){const t=async e=>{(await T).loadData(e,w,((e,t,s,r,i,a)=>{a?E("TextureLoader failed to load data"):h(w,A,n,{width:e,height:t},w.invertY,!s,r,(()=>(i(),!1)),o)}),b)};u?u instanceof ArrayBuffer?t(new Uint8Array(u)):ArrayBuffer.isView(u)?t(u):l&&l("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,(e=>t(new Uint8Array(e))),void 0,n?n.offlineProvider:void 0,!0,((e,t)=>{E("Unable to load "+(e&&e.responseURL,t))}))}else{const s=e=>{y&&!this._doNotHandleContextLost&&(w._buffer=e),h(w,A,n,e,w.invertY,t,!1,c,o)};!x||S?u&&("string"==typeof u.decoding||u.close)?s(u):C._FileToolsLoadImage(e||"",s,E,n?n.offlineProvider:null,g,w.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"==typeof u||u instanceof ArrayBuffer||ArrayBuffer.isView(u)||u instanceof Blob?C._FileToolsLoadImage(u,s,E,n?n.offlineProvider:null,g,w.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):u&&s(u)}return w}_rebuildBuffers(){for(const e of this._uniformBuffers)e._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,f.Nf)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(e){this._name=e}static get NpmPackage(){return"babylonjs@7.49.0"}static get Version(){return"7.49.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(e){this._hardwareScalingLevel=e,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(e){this._doNotHandleContextLost=e}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(e,t,s){this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new l.N,this._stencilStateComposer=new h.u,this._stencilState=new c.K,this._alphaState=new u.i,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new p.cP,this.onCanvasFocusObservable=new p.cP,this.onNewSceneAddedObservable=new p.cP,this.onResizeObservable=new p.cP,this.onCanvasPointerOutObservable=new p.cP,this.onEffectErrorObservable=new p.cP,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new p.cP,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=e=>this._renderLoop(e),this._lastFrameTime=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new p.cP,this.onAfterShaderCompilationObservable=new p.cP,this.onBeginFrameObservable=new p.cP,this.onEndFrameObservable=new p.cP,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new p.cP,this.onContextRestoredObservable=new p.cP,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new p.cP,this.onReleaseEffectsObservable=new p.cP,r.q.Instances.push(this),this.startTime=a.j.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,o.I.SetMatrixPrecision(!!t.useHighPrecisionMatrix),(0,f.XD)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=s??!1,t.antialias=e??t.antialias,t.deterministicLockstep=t.deterministicLockstep??!1,t.lockstepMaxSteps=t.lockstepMaxSteps??4,t.timeStep=t.timeStep??1/60,t.audioEngine=t.audioEngine??!0,t.stencil=t.stencil??!0,this._audioContext=t.audioEngineOptions?.audioContext??null,this._audioDestination=t.audioEngineOptions?.audioDestination??null,this.premultipliedAlpha=t.premultipliedAlpha??!0,this._doNotHandleContextLost=!!t.doNotHandleContextLost,this._isStencilEnable=!!t.stencil,this.useExactSrgbConversions=t.useExactSrgbConversions??!1;const i=(0,f.BA)()&&window.devicePixelRatio||1,n=t.limitDeviceRatio||i;s=s||t.adaptToDeviceRatio||!1,this._hardwareScalingLevel=s?1/Math.min(n,i):1,this._lastDevicePixelRatio=i,this._creationOptions=t}resize(e=!1){let t,s;if(this.adaptToDeviceRatio){const e=(0,f.BA)()&&window.devicePixelRatio||1,t=this._lastDevicePixelRatio/e;this._lastDevicePixelRatio=e,this._hardwareScalingLevel*=t}if((0,f.BA)()&&(0,f.Nf)())if(this._renderingCanvas){const e=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};t=this._renderingCanvas.clientWidth||e.width||this._renderingCanvas.width||100,s=this._renderingCanvas.clientHeight||e.height||this._renderingCanvas.height||100}else t=window.innerWidth,s=window.innerHeight;else t=this._renderingCanvas?this._renderingCanvas.width:100,s=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(t/this._hardwareScalingLevel,s/this._hardwareScalingLevel,e)}setSize(e,t,s=!1){if(!this._renderingCanvas)return!1;if(e|=0,t|=0,!s&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)return!1;if(this._renderingCanvas.width=e,this._renderingCanvas.height=t,this.scenes){for(let e=0;e<this.scenes.length;e++){const t=this.scenes[e];for(let e=0;e<t.cameras.length;e++)t.cameras[e]._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(e,t,s,r,i,n,o,a,l,h,c){throw(0,_.n)("engine.rawTexture")}createRawCubeTexture(e,t,s,r,i,n,o,a){throw(0,_.n)("engine.rawTexture")}createRawTexture3D(e,t,s,r,i,n,o,a,l,h,c){throw(0,_.n)("engine.rawTexture")}createRawTexture2DArray(e,t,s,r,i,n,o,a,l,h,c){throw(0,_.n)("engine.rawTexture")}_sharedInit(e){this._renderingCanvas=e}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const e=navigator.userAgent;this.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&(0,f.Nf)()&&"ontouchend"in document},this._checkForMobile(),(0,f.BA)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(e){return document.createElement("video")}_reportDrawCall(e=1){this._drawCalls?.addCount(e,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(e,t){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(e,t){return createImageBitmap(e,t)}resizeImageBitmap(e,t,s){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(e){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);const s=document.createElement("canvas");return s.width=e,s.height=t,s}createCanvas(e,t){return C._CreateCanvas(e,t)}static _FileToolsLoadImage(e,t,s,r,i,n){throw(0,_.n)("FileTools")}_loadFile(e,t,s,r,i,n){const o=(0,g.W0)(e,t,s,r,i,n);return this._activeRequests.push(o),o.onCompleteObservable.add((()=>{const e=this._activeRequests.indexOf(o);-1!==e&&this._activeRequests.splice(e,1)})),o}static _FileToolsLoadFile(e,t,s,r,i,n){if(g.sg.loadFile)return g.sg.loadFile(e,t,s,r,i,n);throw(0,_.n)("FileTools")}dispose(){for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();this.releaseComputeEffects?.(),n.M.ResetCache();for(const e of this._activeRequests)e.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,f.BA)()&&window.removeEventListener("resize",this._checkForMobile);const e=r.q.Instances.indexOf(this);e>=0&&r.q.Instances.splice(e,1),r.q.Instances.length||(r.q.OnEnginesDisposedObservable.notifyObservers(this),r.q.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(e){throw(0,_.n)("LoadingScreen")}static MarkAllMaterialsAsDirty(e,t){for(let s=0;s<r.q.Instances.length;s++){const i=r.q.Instances[s];for(let s=0;s<i.scenes.length;s++)i.scenes[s].markAllMaterialsAsDirty(e,t)}}}C._RenderPassIdCounter=0,C._RescalePostProcessFactory=null,C.CollisionsEpsilon=.001,C.QueueNewFrame=b},22671:(e,t,s)=>{s.d(t,{N:()=>r});class r{constructor(e=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}},23762:(e,t,s)=>{s.d(t,{i:()=>r});class r{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(e,t,s,r){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===s&&this._blendConstants[3]===r||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=s,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(e,t,s,r){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===s&&this._blendFunctionParameters[3]===r||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=s,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}},24099:(e,t,s)=>{s.d(t,{n:()=>i});const r={};function i(e,t=!1){if(!t||!r[e])return r[e]=!0,`${e} needs to be imported before as it contains a side-effect required by your code.`}},24385:(e,t,s)=>{s.d(t,{nO:()=>w,pB:()=>y,M0:()=>S,J:()=>E});class r{constructor(){this.children=[]}isValid(e){return!0}process(e,t){let s="";if(this.line){let r=this.line;const i=t.processor;if(i){i.lineProcessor&&(r=i.lineProcessor(r,t.isFragment,t.processingContext));const s=t.processor?.attributeKeywordName??"attribute",n=t.isFragment&&t.processor?.varyingFragmentKeywordName?t.processor?.varyingFragmentKeywordName:!t.isFragment&&t.processor?.varyingVertexKeywordName?t.processor?.varyingVertexKeywordName:"varying";!t.isFragment&&i.attributeProcessor&&this.line.startsWith(s)?r=i.attributeProcessor(this.line,e,t.processingContext):i.varyingProcessor&&(i.varyingCheck?.(this.line,t.isFragment)||!i.varyingCheck&&this.line.startsWith(n))?r=i.varyingProcessor(this.line,t.isFragment,e,t.processingContext):i.uniformProcessor&&i.uniformRegexp&&i.uniformRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(r=i.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):i.uniformBufferProcessor&&i.uniformBufferRegexp&&i.uniformBufferRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(r=i.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0):i.textureProcessor&&i.textureRegexp&&i.textureRegexp.test(this.line)?r=i.textureProcessor(this.line,t.isFragment,e,t.processingContext):(i.uniformProcessor||i.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?i.uniformProcessor&&(r=i.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):i.uniformBufferProcessor&&(r=i.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)),t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,i.endOfUniformBufferProcessor&&(r=i.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}s+=r+"\n"}return this.children.forEach((r=>{s+=r.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),s}}class i{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(e){this._lines.length=0;for(const t of e){if(!t||"\r"===t)continue;if("#"===t[0]){this._lines.push(t);continue}const e=t.trim();if(!e)continue;if(e.startsWith("//")){this._lines.push(t);continue}const s=e.indexOf(";");if(-1===s)this._lines.push(e);else if(s===e.length-1)e.length>1&&this._lines.push(e);else{const e=t.split(";");for(let t=0;t<e.length;t++){let s=e[t];s&&(s=s.trim(),s&&this._lines.push(s+(t!==e.length-1?";":"")))}}}}}class n extends r{process(e,t){for(let s=0;s<this.children.length;s++){const r=this.children[s];if(r.isValid(e))return r.process(e,t)}return""}}class o extends r{isValid(e){return this.testExpression.isTrue(e)}}class a{isTrue(e){return!0}static postfixToInfix(e){const t=[];for(const s of e)if(void 0===a._OperatorPriority[s])t.push(s);else{const e=t[t.length-1],r=t[t.length-2];t.length-=2,t.push(`(${r}${s}${e})`)}return t[t.length-1]}static infixToPostfix(e){const t=a._InfixToPostfixCache.get(e);if(t)return t.accessTime=Date.now(),t.result;if(!(e.includes("&&")||e.includes("||")||e.includes(")")||e.includes("(")))return[e];const s=[];let r=-1;const i=()=>{c=c.trim(),""!==c&&(s.push(c),c="")},n=e=>{r<a._Stack.length-1&&(a._Stack[++r]=e)},o=()=>a._Stack[r],l=()=>-1===r?"!!INVALID EXPRESSION!!":a._Stack[r--];let h=0,c="";for(;h<e.length;){const t=e.charAt(h),u=h<e.length-1?e.substring(h,2+h):"";if("("===t)c="",n(t);else if(")"===t){for(i();-1!==r&&"("!==o();)s.push(l());l()}else if(a._OperatorPriority[u]>1){for(i();-1!==r&&a._OperatorPriority[o()]>=a._OperatorPriority[u];)s.push(l());n(u),h++}else c+=t;h++}for(i();-1!==r;)"("===o()?l():s.push(l());return a._InfixToPostfixCache.size>=a.InfixToPostfixCacheLimitSize&&a.ClearCache(),a._InfixToPostfixCache.set(e,{result:s,accessTime:Date.now()}),s}static ClearCache(){const e=Array.from(a._InfixToPostfixCache.entries()).sort(((e,t)=>e[1].accessTime-t[1].accessTime));for(let t=0;t<a.InfixToPostfixCacheCleanupSize;t++)a._InfixToPostfixCache.delete(e[t][0])}}a.InfixToPostfixCacheLimitSize=5e4,a.InfixToPostfixCacheCleanupSize=25e3,a._InfixToPostfixCache=new Map,a._OperatorPriority={")":0,"(":1,"||":2,"&&":3},a._Stack=["","","","","","","","","","","","","","","","","","","",""];class l extends a{constructor(e,t=!1){super(),this.define=e,this.not=t}isTrue(e){let t=void 0!==e[this.define];return this.not&&(t=!t),t}}class h extends a{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}class c extends a{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}class u extends a{constructor(e,t,s){super(),this.define=e,this.operand=t,this.testValue=s}isTrue(e){let t=e[this.define];void 0===t&&(t=this.define);let s=!1;const r=parseInt(t),i=parseInt(this.testValue);switch(this.operand){case">":s=r>i;break;case"<":s=r<i;break;case"<=":s=r<=i;break;case">=":s=r>=i;break;case"==":s=r===i;break;case"!=":s=r!==i}return s}}var _=s(24099),d=s(84153);const f=/defined\s*?\((.+?)\)/g,p=/defined\s*?\[(.+?)\]/g,g=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,m=/__decl__/,b=/light\{X\}.(\w*)/g,C=/\{X\}/g,v=[],x=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function y(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}function S(e,t,s,n){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),R(e,t,(e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines));const o=function(e,t,s){let n=function(e,t){if(t.processor?.noPrecision)return e;const s=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=s?"precision highp float;\n"+e:"precision mediump float;\n"+e:s||(e=e.replace("precision highp float","precision mediump float")),e}(e,t);if(!t.processor)return n;if(0===t.processor.shaderLanguage&&-1!==n.indexOf("#version 3")&&(n=n.replace("#version 300 es",""),!t.processor.parseGLES3))return n;const o=t.defines,a=function(e,t){const s=e.defines,r={};for(const e of s){const t=e.replace("#define","").replace(";","").trim().split(" ");r[t[0]]=t.length>1?t[1]:""}return 0===e.processor?.shaderLanguage&&(r.GL_ES="true"),r.__VERSION__=e.version,r[e.platformName]="true",(0,d.xt)(r,t?.isNDCHalfZRange,t?.useReverseDepthBuffer,t?.useExactSrgbConversions),r}(t,s);return t.processor.preProcessor&&(n=t.processor.preProcessor(n,o,a,t.isFragment,t.processingContext)),n=function(e,t,s){const n=new r,o=new i;return o.lineIndex=-1,o.lines=e.split("\n"),T(o,n),n.process(t,s)}(n,a,t),t.processor.postProcessor&&(n=t.processor.postProcessor(n,o,t.isFragment,t.processingContext,s?{drawBuffersExtensionDisabled:!s.getCaps().drawBuffersExtension}:{})),s?._features.needShaderCodeInlining&&(n=s.inlineShaderCode(n)),n}(e,t,n);s(o,e)}))}function w(e,t,s){return s.processor&&s.processor.finalizeShaders?s.processor.finalizeShaders(e,t,s.processingContext):{vertexCode:e,fragmentCode:t}}function F(e){const t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new l(t[1].trim(),"!"===e[0]);const s=["==","!=",">=","<=","<",">"];let r="",i=0;for(r of s)if(i=e.indexOf(r),i>-1)break;if(-1===i)return new l(e);const n=e.substring(0,i).trim(),o=e.substring(i+r.length).trim();return new u(n,r,o)}function P(e,t){const s=new o,r=e.substring(0,t);let i=e.substring(t);return i=i.substring(0,(i.indexOf("//")+1||i.length+1)-1).trim(),s.testExpression="#ifdef"===r?new l(i):"#ifndef"===r?new l(i,!0):function(e){e=e.replace(f,"defined[$1]");const t=a.infixToPostfix(e),s=[];for(const e of t)if("||"!==e&&"&&"!==e)s.push(e);else if(s.length>=2){let t=s[s.length-1],r=s[s.length-2];s.length-=2;const i="&&"==e?new c:new h;"string"==typeof t&&(t=t.replace(p,"defined($1)")),"string"==typeof r&&(r=r.replace(p,"defined($1)")),i.leftOperand="string"==typeof r?F(r):r,i.rightOperand="string"==typeof t?F(t):t,s.push(i)}let r=s[s.length-1];return"string"==typeof r&&(r=r.replace(p,"defined($1)")),"string"==typeof r?F(r):r}(i),s}function A(e,t,s){let i=e.currentLine;for(;T(e,s);){i=e.currentLine;const n=i.substring(0,5).toLowerCase();if("#else"===n){const s=new r;return t.children.push(s),void T(e,s)}if("#elif"===n){const e=P(i,5);t.children.push(e),s=e}}}function T(e,t){for(;e.canRead;){e.lineIndex++;const s=e.currentLine;if(s.indexOf("#")>=0){const r=x.exec(s);if(r&&r.length){switch(r[0]){case"#ifdef":{const r=new n;t.children.push(r);const i=P(s,6);r.children.push(i),A(e,r,i);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const r=new n;t.children.push(r);const i=P(s,7);r.children.push(i),A(e,r,i);break}case"#if":{const r=new n,i=P(s,3);t.children.push(r),r.children.push(i),A(e,r,i);break}}continue}}const i=new r;if(i.line=s,t.children.push(i),"#"===s[0]&&"d"===s[1]){const e=s.replace(";","").split(" ");i.additionalDefineKey=e[1],3===e.length&&(i.additionalDefineValue=e[2])}}return!1}function R(e,t,s){let r;for(v.length=0;null!==(r=g.exec(e));)v.push(r);let i=String(e),n=[e],o=!1;for(const e of v){let r=e[1];if(-1!==r.indexOf("__decl__")&&(r=r.replace(m,""),t.supportsUniformBuffers&&(r=r.replace("Vertex","Ubo").replace("Fragment","Ubo")),r+="Declaration"),!t.includesShadersStore[r]){const e=t.shadersRepository+"ShadersInclude/"+r+".fx";return void E.loadFile(e,(e=>{t.includesShadersStore[r]=e,R(n.join(""),t,s)}))}{let s=t.includesShadersStore[r];if(e[2]){const t=e[3].split(",");for(let e=0;e<t.length;e+=2){const r=new RegExp(t[e],"g"),i=t[e+1];s=s.replace(r,i)}}if(e[4]){const r=e[5];if(-1!==r.indexOf("..")){const e=r.split(".."),i=parseInt(e[0]);let n=parseInt(e[1]),o=s.slice(0);s="",isNaN(n)&&(n=t.indexParameters[e[1]]);for(let e=i;e<n;e++)t.supportsUniformBuffers||(o=o.replace(b,((e,t)=>t+"{X}"))),s+=o.replace(C,e.toString())+"\n"}else t.supportsUniformBuffers||(s=s.replace(b,((e,t)=>t+"{X}"))),s=s.replace(C,r)}const i=[];for(const t of n){const r=t.split(e[0]);for(let e=0;e<r.length-1;e++)i.push(r[e]),i.push(s);i.push(r[r.length-1])}n=i,o=o||s.indexOf("#include<")>=0||s.indexOf("#include <")>=0}}v.length=0,i=n.join(""),o?R(i.toString(),t,s):s(i)}const E={loadFile:(e,t,s,r,i,n)=>{throw(0,_.n)("FileTools")}}},24952:(e,t,s)=>{s.d(t,{M:()=>l});var r=s(40380),i=s(52101),n=s(9262),o=s(96347),a=s(87712);class l{static get ShadersRepository(){return n.l.ShadersRepository}static set ShadersRepository(e){n.l.ShadersRepository=e}get isDisposed(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new r.cP),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(e,t,s,i=null,n,a=null,h=null,c=null,u=null,_,d="",f=0,p){this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new r.cP,this.onErrorObservable=new r.cP,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=e,this._key=d;const g=this._key.replace(/\r/g,"").replace(/\n/g,"|");let m;if(t.attributes){const e=t;if(this._engine=s,this._attributesNames=e.attributes,this._uniformsNames=e.uniformsNames.concat(e.samplers),this._samplerList=e.samplers.slice(),this.defines=e.defines,this.onError=e.onError,this.onCompiled=e.onCompiled,this._fallbacks=e.fallbacks,this._indexParameters=e.indexParameters,this._transformFeedbackVaryings=e.transformFeedbackVaryings||null,this._multiTarget=!!e.multiTarget,this._shaderLanguage=e.shaderLanguage??0,this._disableParallelShaderCompilation=!!e.disableParallelShaderCompilation,e.uniformBuffersNames){this._uniformBuffersNamesList=e.uniformBuffersNames.slice();for(let t=0;t<e.uniformBuffersNames.length;t++)this._uniformBuffersNames[e.uniformBuffersNames[t]]=t}this._processFinalCode=e.processFinalCode??null,this._processCodeAfterIncludes=e.processCodeAfterIncludes??void 0,p=e.extraInitializationsAsync,m=e.existingPipelineContext}else this._engine=n,this.defines=null==a?"":a,this._uniformsNames=s.concat(i),this._samplerList=i?i.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=f,this.onError=u,this.onCompiled=c,this._indexParameters=_,this._fallbacks=h;"WEBGL2"===this._engine.shaderPlatformName&&(m=(0,o.b4)(g,this._engine._gl)??m),this._attributeLocationByName={},this.uniqueId=l._UniqueIdSeed++,m?(this._pipelineContext=m,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,p),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.isDisposed||this.dispose(!0)}))}async _processShaderCodeAsync(e=null,t=!1,s=null,r){r&&await r(),this._processingContext=s||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const i={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:e??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:n.l.GetShadersRepository(this._shaderLanguage),includesShadersStore:n.l.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,o.bu)(i,this.name,this._processFinalCode,((e,s)=>{this._vertexSourceCode=e,this._fragmentSourceCode=s,this._prepareEffect(t)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.isDisposed||!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(e){return this._attributes[e]}getAttributeLocationByName(e){return this._attributeLocationByName[e]}getAttributesCount(){return this._attributes.length}getUniformIndex(e){return this._uniformsNames.indexOf(e)}getUniform(e){return this._uniforms[e]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}whenCompiledAsync(){return new Promise((e=>{this.executeWhenCompiled(e)}))}executeWhenCompiled(e){this.isReady()?e(this):(this.onCompileObservable.add((t=>{e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(e){(0,a.F)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(t=>{this._processCompilationErrors(t,e)}),16,3e4,!0,` - Effect: ${"string"==typeof this.name?this.name:this.key}`)}get vertexSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._pipelineContext?._getVertexShaderCode()??this._vertexSourceCode}get fragmentSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._pipelineContext?._getFragmentShaderCode()??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(e,t,s,r){this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=(e,t)=>{r&&r(t)},this.onCompiled=()=>{const e=this.getEngine().scenes;if(e)for(let t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);this._pipelineContext._handlesSpectorRebuildCallback?.(s)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(e){if(this._pipelineContext=e,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let e=0;e<this._attributesNames.length;e++){const t=this._attributesNames[e];this._attributeLocationByName[t]=this._attributes[e]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),l.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(e=!1){const t=this._pipelineContext;this._isReady=!1;try{const s=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),r=s?null:this.defines,i=s?this._vertexSourceCodeOverride:this._vertexSourceCode,n=s?this._fragmentSourceCodeOverride:this._fragmentSourceCode,a=this._engine;this._pipelineContext=(0,o.uR)({existingPipelineContext:e?t:null,vertex:i,fragment:n,context:"WEBGL2"===a.shaderPlatformName||"WEBGL1"===a.shaderPlatformName?a._gl:void 0,rebuildRebind:(e,t,s,r)=>this._rebuildProgram(e,t,s,r),defines:r,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:s,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:s=>{t&&!e&&this._engine._deletePipelineContext(t),s&&this._onRenderingStateCompiled(s)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(e){this._processCompilationErrors(e,t)}}_getShaderCodeAndErrorLine(e,t,s){const r=s?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let i=null;if(t&&e){const n=t.match(r);if(n&&2===n.length){const t=parseInt(n[1]),r=e.split("\n",-1);r.length>=t&&(i=`Offending line [${t}] in ${s?"fragment":"vertex"} code: ${r[t-1]}`)}}return[e,i]}_processCompilationErrors(e,t=null){this._compilationError=e.message;const s=this._attributesNames,r=this._fallbacks;if(i.V.Error("Unable to compile effect:"),i.V.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),i.V.Error("Attributes: "+s.map((function(e){return" "+e}))),i.V.Error("Defines:\n"+this.defines),l.LogShaderCodeOnCompilationError){let e=null,t=null,s=null;this._pipelineContext?._getVertexShaderCode()&&([s,e]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),s&&(i.V.Error("Vertex code:"),i.V.Error(s))),this._pipelineContext?._getFragmentShaderCode()&&([s,t]=this._getShaderCodeAndErrorLine(this._pipelineContext?._getFragmentShaderCode(),this._compilationError,!0),s&&(i.V.Error("Fragment code:"),i.V.Error(s))),e&&i.V.Error(e),t&&i.V.Error(t)}i.V.Error("Error: "+this._compilationError);const n=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};t&&(this._pipelineContext=t,this._isReady=!0,n()),r?(this._pipelineContext=null,r.hasMoreFallbacks?(this._allFallbacksProcessed=!1,i.V.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,n(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,t||n())}get isSupported(){return""===this._compilationError}_bindTexture(e,t){this._engine._bindTexture(this._samplers[e],t,e)}setTexture(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}setTextureArray(e,t){const s=e+"Ex";if(-1===this._samplerList.indexOf(s+"0")){const r=this._samplerList.indexOf(e);for(let e=1;e<t.length;e++){const t=s+(e-1).toString();this._samplerList.splice(r+e,0,t)}let i=0;for(const e of this._samplerList)this._samplers[e]=i,i+=1}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}bindUniformBuffer(e,t){const s=this._uniformBuffersNames[t];void 0===s||l._BaseCache[s]===e&&this._engine._features.useUBOBindingCache||(l._BaseCache[s]=e,this._engine.bindUniformBufferBase(e,s,t))}bindUniformBlock(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}setInt(e,t){return this._pipelineContext.setInt(e,t),this}setInt2(e,t,s){return this._pipelineContext.setInt2(e,t,s),this}setInt3(e,t,s,r){return this._pipelineContext.setInt3(e,t,s,r),this}setInt4(e,t,s,r,i){return this._pipelineContext.setInt4(e,t,s,r,i),this}setIntArray(e,t){return this._pipelineContext.setIntArray(e,t),this}setIntArray2(e,t){return this._pipelineContext.setIntArray2(e,t),this}setIntArray3(e,t){return this._pipelineContext.setIntArray3(e,t),this}setIntArray4(e,t){return this._pipelineContext.setIntArray4(e,t),this}setUInt(e,t){return this._pipelineContext.setUInt(e,t),this}setUInt2(e,t,s){return this._pipelineContext.setUInt2(e,t,s),this}setUInt3(e,t,s,r){return this._pipelineContext.setUInt3(e,t,s,r),this}setUInt4(e,t,s,r,i){return this._pipelineContext.setUInt4(e,t,s,r,i),this}setUIntArray(e,t){return this._pipelineContext.setUIntArray(e,t),this}setUIntArray2(e,t){return this._pipelineContext.setUIntArray2(e,t),this}setUIntArray3(e,t){return this._pipelineContext.setUIntArray3(e,t),this}setUIntArray4(e,t){return this._pipelineContext.setUIntArray4(e,t),this}setFloatArray(e,t){return this._pipelineContext.setArray(e,t),this}setFloatArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setFloatArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setFloatArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setArray(e,t){return this._pipelineContext.setArray(e,t),this}setArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setMatrices(e,t){return this._pipelineContext.setMatrices(e,t),this}setMatrix(e,t){return this._pipelineContext.setMatrix(e,t),this}setMatrix3x3(e,t){return this._pipelineContext.setMatrix3x3(e,t),this}setMatrix2x2(e,t){return this._pipelineContext.setMatrix2x2(e,t),this}setFloat(e,t){return this._pipelineContext.setFloat(e,t),this}setBool(e,t){return this._pipelineContext.setInt(e,t?1:0),this}setVector2(e,t){return this._pipelineContext.setVector2(e,t),this}setFloat2(e,t,s){return this._pipelineContext.setFloat2(e,t,s),this}setVector3(e,t){return this._pipelineContext.setVector3(e,t),this}setFloat3(e,t,s,r){return this._pipelineContext.setFloat3(e,t,s,r),this}setVector4(e,t){return this._pipelineContext.setVector4(e,t),this}setQuaternion(e,t){return this._pipelineContext.setQuaternion(e,t),this}setFloat4(e,t,s,r,i){return this._pipelineContext.setFloat4(e,t,s,r,i),this}setColor3(e,t){return this._pipelineContext.setColor3(e,t),this}setColor4(e,t,s){return this._pipelineContext.setColor4(e,t,s),this}setDirectColor4(e,t){return this._pipelineContext.setDirectColor4(e,t),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(e=!1){if(e)this._refCount=0;else{if(l.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,o.mO)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(e,t,s,r=0){t&&(n.l.GetShadersStore(r)[`${e}PixelShader`]=t),s&&(n.l.GetShadersStore(r)[`${e}VertexShader`]=s)}static ResetCache(){l._BaseCache={}}}l.LogShaderCodeOnCompilationError=!0,l.PersistentMode=!1,l.AutomaticallyClearCodeCache=!1,l._UniqueIdSeed=0,l._BaseCache={},l.ShadersStore=n.l.ShadersStore,l.IncludesShadersStore=n.l.IncludesShadersStore},28565:(e,t,s)=>{s.d(t,{r:()=>n});var r=s(52101);const i=(e,t,s)=>e?e.getClassName&&"Mesh"===e.getClassName()?null:!e.getClassName||"SubMesh"!==e.getClassName()&&"PhysicsBody"!==e.getClassName()?e.clone?e.clone():Array.isArray(e)?e.slice():s&&"object"==typeof e?{...e}:null:e.clone(t):null;class n{static DeepCopy(e,t,s,n,o=!1){const a=function(e){const t=[];do{Object.getOwnPropertyNames(e).forEach((function(e){-1===t.indexOf(e)&&t.push(e)}))}while(e=Object.getPrototypeOf(e));return t}(e);for(const l of a){if("_"===l[0]&&(!n||-1===n.indexOf(l)))continue;if(l.endsWith("Observable"))continue;if(s&&-1!==s.indexOf(l))continue;const a=e[l],h=typeof a;if("function"!==h)try{if("object"===h)if(a instanceof Uint8Array)t[l]=Uint8Array.from(a);else if(a instanceof Array){if(t[l]=[],a.length>0)if("object"==typeof a[0])for(let e=0;e<a.length;e++){const s=i(a[e],t,o);-1===t[l].indexOf(s)&&t[l].push(s)}else t[l]=a.slice(0)}else t[l]=i(a,t,o);else t[l]=a}catch(e){r.V.Warn(e.message)}}}}},34231:(e,t,s)=>{s.d(t,{T:()=>r});class r{}r.FilesToLoad={}},35386:(e,t,s)=>{s.d(t,{u:()=>r});class r{constructor(){this._xhr="undefined"!=typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(r.CustomRequestHeaders).length>0||r.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const e in r.CustomRequestHeaders){const t=r.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}}_shouldSkipRequestModifications(e){return r.SkipRequestModificationForBabylonCDN&&(e.includes("preview.babylonjs.com")||e.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(e){this._xhr.onprogress=e}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(e){this._xhr.responseType=e}get timeout(){return this._xhr.timeout}set timeout(e){this._xhr.timeout=e}addEventListener(e,t,s){this._xhr.addEventListener(e,t,s)}removeEventListener(e,t,s){this._xhr.removeEventListener(e,t,s)}abort(){this._xhr.abort()}send(e){r.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)}open(e,t){for(const e of r.CustomRequestModifiers){if(this._shouldSkipRequestModifications(t))return;t=e(this._xhr,t)||t}t=(t=t.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=t,this._xhr.open(e,t,!0)}setRequestHeader(e,t){this._xhr.setRequestHeader(e,t)}getResponseHeader(e){return this._xhr.getResponseHeader(e)}}r.CustomRequestHeaders={},r.CustomRequestModifiers=new Array,r.SkipRequestModificationForBabylonCDN=!0},36296:(e,t,s)=>{s.a(e,(async(e,r)=>{try{s.d(t,{$I:()=>n.$I,$d:()=>n.$d,Rz:()=>n.Rz});var i=s(60492),n=s(93556),o=e([i]);i=(o.then?(await o)():o)[0],(0,n.lI)(i),r()}catch(e){r(e)}}))},38552:(e,t,s)=>{s.d(t,{A5:()=>d,C5:()=>b,Cm:()=>l,EX:()=>c,GX:()=>u,N5:()=>a,YM:()=>p,bS:()=>C,kf:()=>h,tI:()=>_,tg:()=>f});var r=s(61314),i=s(84153);const n=new WeakMap,o={_webGLVersion:2,cachedPipelines:{}};function a(e){let t=n.get(e);if(!t){if(!e)return o;t={_webGLVersion:e.TEXTURE_BINDING_3D?2:1,_context:e,parallelShaderCompile:e.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},n.set(e,t)}return t}function l(e){n.delete(e)}function h(e,t,s,r,i,n){const o=a(r);return n||(n=o._createShaderProgramInjection??_),n(e,m(t,"vertex",r,o._contextWasLost),m(s,"fragment",r,o._contextWasLost),r,i,o.validateShaderPrograms)}function c(e,t,s,r,i,n=null,o){const l=a(i);o||(o=l._createShaderProgramInjection??_);const h=l._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return o(e,g(t,"vertex",r,h,i,l._contextWasLost),g(s,"fragment",r,h,i,l._contextWasLost),i,n,l.validateShaderPrograms)}function u(e,t){const s=new r.x,i=a(e);return i.parallelShaderCompile&&!i.disableParallelShaderCompile&&(s.isParallelCompiled=!0),s.context=i._context,s}function _(e,t,s,r,i=null,n){const o=r.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");return r.attachShader(o,t),r.attachShader(o,s),r.linkProgram(o),e.context=r,e.vertexShader=t,e.fragmentShader=s,e.isParallelCompiled||f(e,r,n),o}function d(e,t,s){const r=e;if(r._isDisposed)return!1;const i=a(t);return!!t.getProgramParameter(r.program,i.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(f(r,t,s),!0)}function f(e,t,s){const r=e.context,i=e.vertexShader,n=e.fragmentShader,o=e.program;if(!r.getProgramParameter(o,r.LINK_STATUS)){if(!t.getShaderParameter(i,t.COMPILE_STATUS)){const s=t.getShaderInfoLog(i);if(s)throw e.vertexCompilationError=s,new Error("VERTEX SHADER "+s)}if(!t.getShaderParameter(n,t.COMPILE_STATUS)){const s=t.getShaderInfoLog(n);if(s)throw e.fragmentCompilationError=s,new Error("FRAGMENT SHADER "+s)}const s=r.getProgramInfoLog(o);if(s)throw e.programLinkError=s,new Error(s)}if(s&&(r.validateProgram(o),!r.getProgramParameter(o,r.VALIDATE_STATUS))){const t=r.getProgramInfoLog(o);if(t)throw e.programValidationError=t,new Error(t)}r.deleteShader(i),r.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)}function p(e,t,s,r,i,n,o,l,u,_="",d,f,p){const g=a(e.context);f||(f=g.createRawShaderProgramInjection??h),p||(p=g.createShaderProgramInjection??c);const m=e;m.program=r?f(m,t,s,m.context,u):p(m,t,s,l,m.context,u),m.program.__SPECTOR_rebuildProgram=o,d()}function g(e,t,s,r,n,o){return m((0,i.iL)(e,s,r),t,n,o)}function m(e,t,s,r){const i=s.createShader("vertex"===t?s.VERTEX_SHADER:s.FRAGMENT_SHADER);if(!i){let e=s.NO_ERROR,i=s.NO_ERROR;for(;(i=s.getError())!==s.NO_ERROR;)e=i;throw new Error(`Something went wrong while creating a gl ${t} shader object. gl error=${e}, gl isContextLost=${s.isContextLost()}, _contextWasLost=${r}`)}return s.shaderSource(i,e),s.compileShader(i),i}function b(e,t){t.useProgram(e)}function C(e,t){const s=e;if(!s.isParallelCompiled)return void t(e);const r=s.onCompiled;s.onCompiled=()=>{r?.(),t(e)}}},40380:(e,t,s)=>{s.d(t,{cP:()=>o});const r="undefined"!=typeof WeakRef;class i{constructor(e,t=!1,s,r){this.initialize(e,t,s,r)}initialize(e,t=!1,s,r){return this.mask=e,this.skipNextObservers=t,this.target=s,this.currentTarget=r,this}}class n{constructor(e,t,s=null){this.callback=e,this.mask=t,this.scope=s,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class o{static FromPromise(e,t){const s=new o;return e.then((e=>{s.notifyObservers(e)})).catch((e=>{if(!t)throw e;t.notifyObservers(e)})),s}get observers(){return this._observers}constructor(e,t=!1){this.notifyIfTriggered=t,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new i(0),e&&(this._onObserverAdded=e)}add(e,t=-1,s=!1,i=null,o=!1){if(!e)return null;const a=new n(e,t,i);a.unregisterOnNextCall=o,s?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(a,this._lastNotifiedValue);const l=r?new WeakRef(this):{deref:()=>this};return a._remove=()=>{const e=l.deref();e&&e._remove(a)},a}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}remove(e){return!!e&&(e._remove=null,-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))}removeCallback(e,t){for(let s=0;s<this._observers.length;s++){const r=this._observers[s];if(!(r._willBeUnregistered||r.callback!==e||t&&t!==r.scope))return this._deferUnregister(r),!0}return!1}_deferUnregister(e){e._willBeUnregistered||(this._numObserversMarkedAsDeleted++,e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((()=>{this._remove(e)}),0))}_remove(e,t=!0){if(!e)return!1;const s=this._observers.indexOf(e);return-1!==s&&(t&&this._numObserversMarkedAsDeleted--,this._observers.splice(s,1),!0)}makeObserverTopPriority(e){this._remove(e,!1),this._observers.unshift(e)}makeObserverBottomPriority(e){this._remove(e,!1),this._observers.push(e)}notifyObservers(e,t=-1,s,r,i){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),!this._observers.length)return!0;const n=this._eventState;n.mask=t,n.target=s,n.currentTarget=r,n.skipNextObservers=!1,n.lastReturnValue=e,n.userInfo=i;for(const s of this._observers)if(!s._willBeUnregistered&&(s.mask&t&&(s.unregisterOnNextCall&&this._deferUnregister(s),s.scope?n.lastReturnValue=s.callback.apply(s.scope,[e,n]):n.lastReturnValue=s.callback(e,n)),n.skipNextObservers))return!1;return!0}notifyObserver(e,t,s=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),e._willBeUnregistered)return;const r=this._eventState;r.mask=s,r.skipNextObservers=!1,e.unregisterOnNextCall&&this._deferUnregister(e),e.callback(t,r)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const e=this._observers.pop();e&&(e._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const e=new o;return e._observers=this._observers.slice(0),e}hasSpecificMask(e=-1){for(const t of this._observers)if(t.mask&e||t.mask===e)return!0;return!1}}},41355:(e,t,s)=>{s.d(t,{I:()=>r});class r{static SetMatrixPrecision(e){if(r.MatrixTrackPrecisionChange=!1,e&&!r.MatrixUse64Bits&&r.MatrixTrackedMatrices)for(let e=0;e<r.MatrixTrackedMatrices.length;++e){const t=r.MatrixTrackedMatrices[e],s=t._m;t._m=new Array(16);for(let e=0;e<16;++e)t._m[e]=s[e]}r.MatrixUse64Bits=e,r.MatrixCurrentType=r.MatrixUse64Bits?Array:Float32Array,r.MatrixTrackedMatrices=null}}r.MatrixUse64Bits=!1,r.MatrixTrackPrecisionChange=!0,r.MatrixCurrentType=Float32Array,r.MatrixTrackedMatrices=[]},43831:(e,t,s)=>{s.d(t,{Cf:()=>r,bu:()=>n,tG:()=>i});class r extends Error{}r._setPrototypeOf=Object.setPrototypeOf||((e,t)=>(e.__proto__=t,e));const i={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class n extends r{constructor(e,t,s){super(e),this.errorCode=t,this.innerError=s,this.name="RuntimeError",r._setPrototypeOf(this,n.prototype)}}},44838:(e,t,s)=>{s.d(t,{h:()=>o});var r,i=s(40380),n=s(79233);!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.DepthStencil=12]="DepthStencil",e[e.CubeRawRGBD=13]="CubeRawRGBD",e[e.Depth=14]="Depth"}(r||(r={}));class o extends n.u{get useMipMaps(){return this.generateMipMaps}set useMipMaps(e){this.generateMipMaps=e}get uniqueId(){return this._uniqueId}_setUniqueId(e){this._uniqueId=e}getEngine(){return this._engine}get source(){return this._source}constructor(e,t,s=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new i.cP,this.onErrorObservable=new i.cP,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=e,this._source=t,this._uniqueId=o._Counter++,s||(this._hardwareTexture=e._createHardwareTexture())}incrementReferences(){this._references++}updateSize(e,t,s=1){this._engine.updateTextureDimensions(this,e,t,s),this.width=e,this.height=t,this.depth=s,this.baseWidth=e,this.baseHeight=t,this.baseDepth=s,this._size=e*t*s}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const e=this.onRebuildCallback(this),t=t=>{t._swapAndDie(this,!1),this.isReady=e.isReady};return void(e.isAsync?e.proxy.then(t):t(e.proxy))}let e;switch(this.source){case 2:case 12:case 14:break;case 1:return void(e=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(e=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),e._swapAndDie(this,!1),this.isReady=!0;break;case 10:e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 11:e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 4:e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),e._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(e=>{e&&e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(e._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(e,t=!0){this._hardwareTexture?.setUsage(e._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);const s=this._engine.getLoadedTexturesCache();let r=s.indexOf(this);-1!==r&&s.splice(r,1),r=s.indexOf(e),-1===r&&s.push(e)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}o._Counter=0},44903:(e,t,s)=>{s.d(t,{q:()=>i});var r=s(40380);class i{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}i.Instances=[],i.OnEnginesDisposedObservable=new r.cP,i._LastCreatedScene=null,i.UseFallbackTexture=!0,i.FallbackTexture=""},45892:(e,t,s)=>{function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}s.d(t,{z:()=>r})},52101:(e,t,s)=>{s.d(t,{V:()=>r});class r{static _CheckLimit(e,t){let s=r._LogLimitOutputs[e];return s?s.current++:(s={limit:t,current:1},r._LogLimitOutputs[e]=s),s.current<=s.limit}static _GenerateLimitMessage(e,t=1){const s=r._LogLimitOutputs[e];if(!s||!r.MessageLimitReached)return;const i=this._Levels[t];s.current===s.limit&&r[i.name](r.MessageLimitReached.replace(/%LIMIT%/g,""+s.limit).replace(/%TYPE%/g,i.name??""))}static _AddLogEntry(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)}static _FormatMessage(e){const t=e=>e<10?"0"+e:""+e,s=new Date;return"["+t(s.getHours())+":"+t(s.getMinutes())+":"+t(s.getSeconds())+"]: "+e}static _LogDisabled(e,t){}static _LogEnabled(e=1,t,s){const i=Array.isArray(t)?t[0]:t;if(void 0!==s&&!r._CheckLimit(i,s))return;const n=r._FormatMessage(i),o=this._Levels[e],a=Array.isArray(t)?t.slice(1):[];o.logFunc&&o.logFunc("BJS - "+n,...a);const l=`<div style='color:${o.color}'>${n}</div><br>`;r._AddLogEntry(l),r._GenerateLimitMessage(i,e)}static get LogCache(){return r._LogCache}static ClearLogCache(){r._LogCache="",r._LogLimitOutputs={},r.errorsCount=0}static set LogLevels(e){r.Log=r._LogDisabled,r.Warn=r._LogDisabled,r.Error=r._LogDisabled,[r.MessageLogLevel,r.WarningLogLevel,r.ErrorLogLevel].forEach((t=>{if((e&t)===t){const e=this._Levels[t];r[e.name]=r._LogEnabled.bind(r,t)}}))}}r.NoneLogLevel=0,r.MessageLogLevel=1,r.WarningLogLevel=2,r.ErrorLogLevel=4,r.AllLogLevel=7,r.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",r._LogCache="",r._LogLimitOutputs={},r._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],r.errorsCount=0,r.Log=r._LogEnabled.bind(r,r.MessageLogLevel),r.Warn=r._LogEnabled.bind(r,r.WarningLogLevel),r.Error=r._LogEnabled.bind(r,r.ErrorLogLevel)},60492:(e,t,s)=>{var r=s(93556);e.exports=s.v(t,e.id,"fa9110baad6f00813d20",{"./terrain_generation_bg.js":{__wbindgen_copy_to_typed_array:r.U6,__wbindgen_object_drop_ref:r.bk,__wbindgen_throw:r.Qn}})},61314:(e,t,s)=>{s.d(t,{x:()=>r});class r{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(e){e&&this.program&&e(this.program)}setEngine(e){this.engine=e}_fillEffectInformation(e,t,s,r,i,n,o,a){const l=this.engine;if(l.supportsUniformBuffers)for(const s in t)e.bindUniformBlock(s,t[s]);let h;for(this.engine.getUniforms(this,s).forEach(((e,t)=>{r[s[t]]=e})),this._uniforms=r,h=0;h<i.length;h++)null==e.getUniform(i[h])&&(i.splice(h,1),h--);i.forEach(((e,t)=>{n[e]=t}));for(const e of l.getAttributes(this,o))a.push(e)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(e,t){const s=this._valueCache[e],r=t.updateFlag;return(void 0===s||s!==r)&&(this._valueCache[e]=r,!0)}_cacheFloat2(e,t,s){let r=this._valueCache[e];if(!r||2!==r.length)return r=[t,s],this._valueCache[e]=r,!0;let i=!1;return r[0]!==t&&(r[0]=t,i=!0),r[1]!==s&&(r[1]=s,i=!0),i}_cacheFloat3(e,t,s,r){let i=this._valueCache[e];if(!i||3!==i.length)return i=[t,s,r],this._valueCache[e]=i,!0;let n=!1;return i[0]!==t&&(i[0]=t,n=!0),i[1]!==s&&(i[1]=s,n=!0),i[2]!==r&&(i[2]=r,n=!0),n}_cacheFloat4(e,t,s,r,i){let n=this._valueCache[e];if(!n||4!==n.length)return n=[t,s,r,i],this._valueCache[e]=n,!0;let o=!1;return n[0]!==t&&(n[0]=t,o=!0),n[1]!==s&&(n[1]=s,o=!0),n[2]!==r&&(n[2]=r,o=!0),n[3]!==i&&(n[3]=i,o=!0),o}setInt(e,t){const s=this._valueCache[e];void 0!==s&&s===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setInt2(e,t,s){this._cacheFloat2(e,t,s)&&(this.engine.setInt2(this._uniforms[e],t,s)||(this._valueCache[e]=null))}setInt3(e,t,s,r){this._cacheFloat3(e,t,s,r)&&(this.engine.setInt3(this._uniforms[e],t,s,r)||(this._valueCache[e]=null))}setInt4(e,t,s,r,i){this._cacheFloat4(e,t,s,r,i)&&(this.engine.setInt4(this._uniforms[e],t,s,r,i)||(this._valueCache[e]=null))}setIntArray(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)}setIntArray2(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)}setIntArray3(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)}setIntArray4(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)}setUInt(e,t){const s=this._valueCache[e];void 0!==s&&s===t||this.engine.setUInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setUInt2(e,t,s){this._cacheFloat2(e,t,s)&&(this.engine.setUInt2(this._uniforms[e],t,s)||(this._valueCache[e]=null))}setUInt3(e,t,s,r){this._cacheFloat3(e,t,s,r)&&(this.engine.setUInt3(this._uniforms[e],t,s,r)||(this._valueCache[e]=null))}setUInt4(e,t,s,r,i){this._cacheFloat4(e,t,s,r,i)&&(this.engine.setUInt4(this._uniforms[e],t,s,r,i)||(this._valueCache[e]=null))}setUIntArray(e,t){this._valueCache[e]=null,this.engine.setUIntArray(this._uniforms[e],t)}setUIntArray2(e,t){this._valueCache[e]=null,this.engine.setUIntArray2(this._uniforms[e],t)}setUIntArray3(e,t){this._valueCache[e]=null,this.engine.setUIntArray3(this._uniforms[e],t)}setUIntArray4(e,t){this._valueCache[e]=null,this.engine.setUIntArray4(this._uniforms[e],t)}setArray(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)}setArray2(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)}setArray3(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)}setArray4(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)}setMatrices(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))}setMatrix(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.asArray())||(this._valueCache[e]=null))}setMatrix3x3(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)}setMatrix2x2(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)}setFloat(e,t){const s=this._valueCache[e];void 0!==s&&s===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)}setVector2(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))}setFloat2(e,t,s){this._cacheFloat2(e,t,s)&&(this.engine.setFloat2(this._uniforms[e],t,s)||(this._valueCache[e]=null))}setVector3(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))}setFloat3(e,t,s,r){this._cacheFloat3(e,t,s,r)&&(this.engine.setFloat3(this._uniforms[e],t,s,r)||(this._valueCache[e]=null))}setVector4(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setQuaternion(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setFloat4(e,t,s,r,i){this._cacheFloat4(e,t,s,r,i)&&(this.engine.setFloat4(this._uniforms[e],t,s,r,i)||(this._valueCache[e]=null))}setColor3(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))}setColor4(e,t,s){this._cacheFloat4(e,t.r,t.g,t.b,s)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,s)||(this._valueCache[e]=null))}setDirectColor4(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}},62073:(e,t,s)=>{function r(e){let t=1;do{t*=2}while(t<e);return t===e}function i(e,t,s){return e*(1-s)+t*s}function n(e){const t=o(e),s=a(e);return t-e>e-s?s:t}function o(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function a(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)}function l(e,t,s=2){let r;switch(s){case 1:r=a(e);break;case 2:r=n(e);break;default:r=o(e)}return Math.min(r,t)}s.d(t,{C4:()=>a,L8:()=>r,OG:()=>n,R:()=>l,zF:()=>i})},62273:(e,t,s)=>{s.d(t,{AV:()=>i,EL:()=>r,yS:()=>n});const r=e=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let s,r,i,n,o,a,l,h="",c=0;const u=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);for(;c<u.length;)s=u[c++],r=c<u.length?u[c++]:Number.NaN,i=c<u.length?u[c++]:Number.NaN,n=s>>2,o=(3&s)<<4|r>>4,a=(15&r)<<2|i>>6,l=63&i,isNaN(r)?a=l=64:isNaN(i)&&(l=64),h+=t.charAt(n)+t.charAt(o)+t.charAt(a)+t.charAt(l);return h},i=e=>atob(e),n=e=>{const t=i(e),s=t.length,r=new Uint8Array(new ArrayBuffer(s));for(let e=0;e<s;e++)r[e]=t.charCodeAt(e);return r.buffer}},62762:(e,t,s)=>{s.d(t,{gT:()=>o});var r=s(52101);const i=new Map;function n(e,t){(function(e){return i.delete(e)})(e)&&r.V.Warn(`Extension with the name '${name}' already exists`),i.set(e,t)}function o(e,t){"image/ktx"!==t&&"image/ktx2"!==t||(e=".ktx"),i.has(e)||(e.endsWith(".ies")&&n(".ies",(()=>s.e(332).then(s.bind(s,65332)).then((e=>new e._IESTextureLoader)))),e.endsWith(".dds")&&n(".dds",(()=>Promise.all([s.e(991),s.e(357),s.e(77),s.e(340),s.e(518)]).then(s.bind(s,518)).then((e=>new e._DDSTextureLoader)))),e.endsWith(".basis")&&n(".basis",(()=>Promise.all([s.e(991),s.e(357),s.e(132)]).then(s.bind(s,37751)).then((e=>new e._BasisTextureLoader)))),e.endsWith(".env")&&n(".env",(()=>Promise.all([s.e(991),s.e(357),s.e(77),s.e(676)]).then(s.bind(s,69676)).then((e=>new e._ENVTextureLoader)))),e.endsWith(".hdr")&&n(".hdr",(()=>Promise.all([s.e(991),s.e(59)]).then(s.bind(s,99059)).then((e=>new e._HDRTextureLoader)))),(e.endsWith(".ktx")||e.endsWith(".ktx2"))&&(n(".ktx",(()=>s.e(306).then(s.bind(s,86306)).then((e=>new e._KTXTextureLoader)))),n(".ktx2",(()=>s.e(306).then(s.bind(s,86306)).then((e=>new e._KTXTextureLoader))))),e.endsWith(".tga")&&n(".tga",(()=>s.e(301).then(s.bind(s,77301)).then((e=>new e._TGATextureLoader)))),e.endsWith(".exr")&&n(".exr",(()=>s.e(442).then(s.bind(s,43442)).then((e=>new e._ExrTextureLoader)))));const r=i.get(e);return r?Promise.resolve(r(t)):null}},64800:(e,t,s)=>{s.d(t,{M1:()=>x,NJ:()=>w,W$:()=>S,eC:()=>v,f2:()=>T,rz:()=>E,sh:()=>P,zU:()=>F});var r=s(35386),i=s(67618),n=s(40380),o=s(34231),a=s(90658),l=s(43831),h=s(62273),c=s(24385),u=s(44903),_=s(52101),d=s(87712),f=s(84153),p=s(9370);const g=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class m extends l.bu{constructor(e,t){super(e,l.tG.LoadFileError),this.name="LoadFileError",l.Cf._setPrototypeOf(this,m.prototype),t instanceof r.u?this.request=t:this.file=t}}class b extends l.bu{constructor(e,t){super(e,l.tG.RequestFileError),this.request=t,this.name="RequestFileError",l.Cf._setPrototypeOf(this,b.prototype)}}class C extends l.bu{constructor(e,t){super(e,l.tG.ReadFileError),this.file=t,this.name="ReadFileError",l.Cf._setPrototypeOf(this,C.prototype)}}const v={DefaultRetryStrategy:a.a.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:e=>e.replace(/#/gm,"%23")},x=(e,t)=>{if((!e||0!==e.indexOf("data:"))&&v.CorsBehavior)if("string"==typeof v.CorsBehavior||v.CorsBehavior instanceof String)t.crossOrigin=v.CorsBehavior;else{const s=v.CorsBehavior(e);s&&(t.crossOrigin=s)}},y={getRequiredSize:null},S=(e,t,s,i,n="",a)=>{const l=u.q.LastCreatedEngine;if("undefined"==typeof HTMLImageElement&&!l?._features.forceBitmapOverHTMLImageElement)return s("LoadImage is only supported in web or BabylonNative environments."),null;let c,_=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!=typeof Blob&&"undefined"!=typeof URL?(c=URL.createObjectURL(new Blob([e],{type:n})),_=!0):c=`data:${n};base64,`+(0,h.EL)(e):e instanceof Blob?(c=URL.createObjectURL(e),_=!0):(c=v.CleanUrl(e),c=v.PreprocessUrl(c));const d=t=>{if(s){const r=c||e.toString();s(`Error while trying to load image: ${0===r.indexOf("http")||r.length<=128?r:r.slice(0,128)+"..."}`,t)}};if(l?._features.forceBitmapOverHTMLImageElement)return F(c,(r=>{l.createImageBitmap(new Blob([r],{type:n}),{premultiplyAlpha:"none",...a}).then((e=>{t(e),_&&URL.revokeObjectURL(c)})).catch((t=>{s&&s("Error while trying to load image: "+e,t)}))}),void 0,i||void 0,!0,((e,t)=>{d(t)})),null;const f=new Image;if(y.getRequiredSize){const t=y.getRequiredSize(e);t.width&&(f.width=t.width),t.height&&(f.height=t.height)}x(c,f);const p=[],g=()=>{p.forEach((e=>{e.target.removeEventListener(e.name,e.handler)})),p.length=0};p.push({target:f,name:"load",handler:()=>{g(),t(f),_&&f.src&&URL.revokeObjectURL(f.src)}}),p.push({target:f,name:"error",handler:e=>{g(),d(e),_&&f.src&&URL.revokeObjectURL(f.src)}}),p.push({target:document,name:"securitypolicyviolation",handler:e=>{if(e.blockedURI!==f.src||"report"===e.disposition)return;g();const t=new Error(`CSP violation of policy ${e.effectiveDirective} ${e.blockedURI}. Current policy is ${e.originalPolicy}`);u.q.UseFallbackTexture=!1,d(t),_&&f.src&&URL.revokeObjectURL(f.src),f.src=""}}),p.forEach((e=>{e.target.addEventListener(e.name,e.handler)}));const m="blob:"===c.substring(0,5),b="data:"===c.substring(0,5),C=()=>{m||b||!r.u.IsCustomRequestAvailable?f.src=c:F(c,((e,t,s)=>{const r=new Blob([e],{type:!n&&s?s:n}),i=URL.createObjectURL(r);_=!0,f.src=i}),void 0,i||void 0,!0,((e,t)=>{d(t)}))};if(!m&&!b&&i&&i.enableTexturesOffline)i.open((()=>{i&&i.loadImage(c,f)}),C);else{if(-1!==c.indexOf("file:")){const e=decodeURIComponent(c.substring(5).toLowerCase());if(o.T.FilesToLoad[e]&&"undefined"!=typeof URL){try{let t;try{t=URL.createObjectURL(o.T.FilesToLoad[e])}catch(s){t=URL.createObjectURL(o.T.FilesToLoad[e])}f.src=t,_=!0}catch(e){f.src=""}return f}}C()}return f},w=(e,t,s,r,i)=>{const o=new FileReader,a={onCompleteObservable:new n.cP,abort:()=>o.abort()};return o.onloadend=()=>a.onCompleteObservable.notifyObservers(a),i&&(o.onerror=()=>{i(new C(`Unable to read ${e.name}`,e))}),o.onload=e=>{t(e.target.result)},s&&(o.onprogress=s),r?o.readAsArrayBuffer(e):o.readAsText(e),a},F=(e,t,s,r,i,a,l)=>{if(e.name)return w(e,t,s,i,a?e=>{a(void 0,e)}:void 0);const h=e;if(-1!==h.indexOf("file:")){let e=decodeURIComponent(h.substring(5).toLowerCase());0===e.indexOf("./")&&(e=e.substring(2));const r=o.T.FilesToLoad[e];if(r)return w(r,t,s,i,a?e=>a(void 0,new m(e.message,e.file)):void 0)}const{match:c,type:u}=R(h);if(c){const e={onCompleteObservable:new n.cP,abort:()=>()=>{}};try{const e=i?E(h):L(h);t(e,void 0,u)}catch(e){a?a(void 0,e):_.V.Error(e.message||"Failed to parse the Data URL")}return d._.SetImmediate((()=>{e.onCompleteObservable.notifyObservers(e)})),e}return P(h,((e,s)=>{t(e,s?.responseURL,s?.getResponseHeader("content-type"))}),s,r,i,a?e=>{a(e.request,new m(e.message,e.request))}:void 0,l)},P=(e,t,s,o,a,l,h)=>{e=v.CleanUrl(e),e=v.PreprocessUrl(e);const c=v.BaseUrl+e;let u=!1;const d={onCompleteObservable:new n.cP,abort:()=>u=!0},f=()=>{let e,n=new r.u,o=null;const f=()=>{n&&(s&&n.removeEventListener("progress",s),e&&n.removeEventListener("readystatechange",e),n.removeEventListener("loadend",p))};let p=()=>{f(),d.onCompleteObservable.notifyObservers(d),d.onCompleteObservable.clear(),s=void 0,e=null,p=null,l=void 0,h=void 0,t=void 0};d.abort=()=>{u=!0,p&&p(),n&&n.readyState!==(XMLHttpRequest.DONE||4)&&n.abort(),null!==o&&(clearTimeout(o),o=null),n=null};const g=e=>{const t=e.message||"Unknown error";l&&n?l(new b(t,n)):_.V.Error(t)},m=_=>{if(n){if(n.open("GET",c),h)try{h(n)}catch(e){return void g(e)}a&&(n.responseType="arraybuffer"),s&&n.addEventListener("progress",s),p&&n.addEventListener("loadend",p),e=()=>{if(!u&&n&&n.readyState===(XMLHttpRequest.DONE||4)){if(e&&n.removeEventListener("readystatechange",e),n.status>=200&&n.status<300||0===n.status&&(!(0,i.BA)()||A())){const e=a?n.response:n.responseText;if(null!==e){try{t&&t(e,n)}catch(e){g(e)}return}}const s=v.DefaultRetryStrategy;if(s){const e=s(c,n,_);if(-1!==e)return f(),n=new r.u,void(o=setTimeout((()=>m(_+1)),e))}const h=new b("Error status: "+n.status+" "+n.statusText+" - Unable to load "+c,n);l&&l(h)}},n.addEventListener("readystatechange",e),n.send()}};m(0)};if(o&&o.enableSceneOffline){const r=e=>{e&&e.status>400?l&&l(e):f()},i=()=>{o&&o.loadFile(v.BaseUrl+e,(e=>{!u&&t&&t(e),d.onCompleteObservable.notifyObservers(d)}),s?e=>{!u&&s&&s(e)}:void 0,r,a)};o.open(i,r)}else f();return d},A=()=>"undefined"!=typeof location&&"file:"===location.protocol,T=e=>g.test(e),R=e=>{const t=g.exec(e);return null===t||0===t.length?{match:!1,type:""}:{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function E(e){return(0,h.yS)(e.split(",")[1])}const L=e=>(0,h.AV)(e.split(",")[1]);let U;p.$._FileToolsLoadImage=S,f.sg.loadFile=F,c.J.loadFile=F,((e,t,s,r,i,n,o,a,l,h)=>{U={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:t,DefaultRetryStrategy:s.DefaultRetryStrategy,BaseUrl:s.BaseUrl,CorsBehavior:s.CorsBehavior,PreprocessUrl:s.PreprocessUrl,IsBase64DataUrl:r,IsFileURL:i,LoadFile:n,LoadImage:o,ReadFile:a,RequestFile:l,SetCorsBehavior:h},Object.defineProperty(U,"DefaultRetryStrategy",{get:function(){return s.DefaultRetryStrategy},set:function(e){s.DefaultRetryStrategy=e}}),Object.defineProperty(U,"BaseUrl",{get:function(){return s.BaseUrl},set:function(e){s.BaseUrl=e}}),Object.defineProperty(U,"PreprocessUrl",{get:function(){return s.PreprocessUrl},set:function(e){s.PreprocessUrl=e}}),Object.defineProperty(U,"CorsBehavior",{get:function(){return s.CorsBehavior},set:function(e){s.CorsBehavior=e}})})(E,L,v,T,A,F,S,w,P,x)},67290:(e,t,s)=>{s.d(t,{S0:()=>g});var r=s(40380),i=s(67618),n=s(52101),o=s(28565),a=s(72785),l=s(24099),h=s(35386),c=s(44903),u=s(64800),_=s(87712),d=s(477),f=s(45892),p=s(62073);class g{static get BaseUrl(){return u.eC.BaseUrl}static set BaseUrl(e){u.eC.BaseUrl=e}static get CleanUrl(){return u.eC.CleanUrl}static set CleanUrl(e){u.eC.CleanUrl=e}static IsAbsoluteUrl(e){return 0===e.indexOf("//")||-1!==e.indexOf("://")&&-1!==e.indexOf(".")&&-1!==e.indexOf("/")&&!(e.indexOf(":")>e.indexOf("/"))&&(e.indexOf("://")<e.indexOf(".")||0===e.indexOf("data:")||0===e.indexOf("blob:"))}static set ScriptBaseUrl(e){u.eC.ScriptBaseUrl=e}static get ScriptBaseUrl(){return u.eC.ScriptBaseUrl}static set CDNBaseUrl(e){g.ScriptBaseUrl=e,g.AssetBaseUrl=e}static set ScriptPreprocessUrl(e){u.eC.ScriptPreprocessUrl=e}static get ScriptPreprocessUrl(){return u.eC.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return u.eC.DefaultRetryStrategy}static set DefaultRetryStrategy(e){u.eC.DefaultRetryStrategy=e}static get CorsBehavior(){return u.eC.CorsBehavior}static set CorsBehavior(e){u.eC.CorsBehavior=e}static get UseFallbackTexture(){return c.q.UseFallbackTexture}static set UseFallbackTexture(e){c.q.UseFallbackTexture=e}static get RegisteredExternalClasses(){return d.n.RegisteredExternalClasses}static set RegisteredExternalClasses(e){d.n.RegisteredExternalClasses=e}static get fallbackTexture(){return c.q.FallbackTexture}static set fallbackTexture(e){c.q.FallbackTexture=e}static FetchToRef(e,t,s,r,i,n){const o=4*((Math.abs(e)*s%s|0)+(Math.abs(t)*r%r|0)*s);n.r=i[o]/255,n.g=i[o+1]/255,n.b=i[o+2]/255,n.a=i[o+3]/255}static Mix(e,t,s){return 0}static Instantiate(e){return d.n.Instantiate(e)}static SetImmediate(e){_._.SetImmediate(e)}static IsExponentOfTwo(e){return!0}static FloatRound(e){return Math.fround(e)}static GetFilename(e){const t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}static GetFolderPath(e,t=!1){const s=e.lastIndexOf("/");return s<0?t?e:"":e.substring(0,s+1)}static ToDegrees(e){return 180*e/Math.PI}static ToRadians(e){return e*Math.PI/180}static SmoothAngleChange(e,t,s=.9){const r=this.ToRadians(e),i=this.ToRadians(t);return this.ToDegrees(Math.atan2((1-s)*Math.sin(i)+s*Math.sin(r),(1-s)*Math.cos(i)+s*Math.cos(r)))}static MakeArray(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null}static GetPointerPrefix(e){return(0,i.BA)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(e,t){(0,u.M1)(e,t)}static SetReferrerPolicyBehavior(e,t){t.referrerPolicy=e}static get PreprocessUrl(){return u.eC.PreprocessUrl}static set PreprocessUrl(e){u.eC.PreprocessUrl=e}static LoadImage(e,t,s,r,i,n){return(0,u.W$)(e,t,s,r,i,n)}static LoadFile(e,t,s,r,i,n){return(0,u.zU)(e,t,s,r,i,n)}static LoadFileAsync(e,t=!0){return new Promise(((s,r)=>{(0,u.zU)(e,(e=>{s(e)}),void 0,void 0,t,((e,t)=>{r(t)}))}))}static GetAssetUrl(e){if(!e)return"";if(g.AssetBaseUrl&&e.startsWith(g._DefaultAssetsUrl)){const t="/"===g.AssetBaseUrl[g.AssetBaseUrl.length-1]?g.AssetBaseUrl.substring(0,g.AssetBaseUrl.length-1):g.AssetBaseUrl;return e.replace(g._DefaultAssetsUrl,t)}return e}static GetBabylonScriptURL(e,t){if(!e)return"";if(g.ScriptBaseUrl&&e.startsWith(g._DefaultCdnUrl)){const t="/"===g.ScriptBaseUrl[g.ScriptBaseUrl.length-1]?g.ScriptBaseUrl.substring(0,g.ScriptBaseUrl.length-1):g.ScriptBaseUrl;e=e.replace(g._DefaultCdnUrl,t)}return e=g.ScriptPreprocessUrl(e),t&&(e=g.GetAbsoluteUrl(e)),e}static LoadBabylonScript(e,t,s,r){e=g.GetBabylonScriptURL(e),g.LoadScript(e,t,s)}static LoadBabylonScriptAsync(e){return e=g.GetBabylonScriptURL(e),g.LoadScriptAsync(e)}static LoadScript(e,t,s,r,n=!1){if("function"==typeof importScripts){try{importScripts(e),t&&t()}catch(t){s?.(`Unable to load script '${e}' in worker`,t)}return}if(!(0,i.BA)())return void s?.(`Cannot load script '${e}' outside of a window or a worker`);const o=document.getElementsByTagName("head")[0],a=document.createElement("script");n?(a.setAttribute("type","module"),a.innerText=e):(a.setAttribute("type","text/javascript"),a.setAttribute("src",e)),r&&(a.id=r),a.onload=()=>{t&&t()},a.onerror=t=>{s&&s(`Unable to load script '${e}'`,t)},o.appendChild(a)}static LoadScriptAsync(e,t){return new Promise(((s,r)=>{this.LoadScript(e,(()=>{s()}),((e,t)=>{r(t||new Error(e))}),t)}))}static ReadFileAsDataURL(e,t,s){const i=new FileReader,n={onCompleteObservable:new r.cP,abort:()=>i.abort()};return i.onloadend=()=>{n.onCompleteObservable.notifyObservers(n)},i.onload=e=>{t(e.target.result)},i.onprogress=s,i.readAsDataURL(e),n}static ReadFile(e,t,s,r,i){return(0,u.NJ)(e,t,s,r,i)}static FileAsURL(e){const t=new Blob([e]);return window.URL.createObjectURL(t)}static Format(e,t=2){return e.toFixed(t)}static DeepCopy(e,t,s,r){o.r.DeepCopy(e,t,s,r)}static IsEmpty(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}static RegisterTopRootEvents(e,t){for(let s=0;s<t.length;s++){const r=t[s];e.addEventListener(r.name,r.handler,!1);try{window.parent&&window.parent.addEventListener(r.name,r.handler,!1)}catch(e){}}}static UnregisterTopRootEvents(e,t){for(let s=0;s<t.length;s++){const r=t[s];e.removeEventListener(r.name,r.handler);try{e.parent&&e.parent.removeEventListener(r.name,r.handler)}catch(e){}}}static async DumpFramebuffer(e,t,s,r,i="image/png",n,o){throw(0,l.n)("DumpTools")}static DumpData(e,t,s,r,i="image/png",n,o=!1,a=!1,h){throw(0,l.n)("DumpTools")}static DumpDataAsync(e,t,s,r="image/png",i,n=!1,o=!1,a){throw(0,l.n)("DumpTools")}static _IsOffScreenCanvas(e){return void 0!==e.convertToBlob}static ToBlob(e,t,s="image/png",r){g._IsOffScreenCanvas(e)||e.toBlob||(e.toBlob=function(e,t,s){setTimeout((()=>{const r=atob(this.toDataURL(t,s).split(",")[1]),i=r.length,n=new Uint8Array(i);for(let e=0;e<i;e++)n[e]=r.charCodeAt(e);e(new Blob([n]))}))}),g._IsOffScreenCanvas(e)?e.convertToBlob({type:s,quality:r}).then((e=>t(e))):e.toBlob((function(e){t(e)}),s,r)}static DownloadBlob(e,t){if("download"in document.createElement("a")){if(!t){const e=new Date;t="screenshot_"+(e.getFullYear()+"-"+(e.getMonth()+1)).slice(2)+"-"+e.getDate()+"_"+e.getHours()+"-"+("0"+e.getMinutes()).slice(-2)+".png"}g.Download(e,t)}else if(e&&"undefined"!=typeof URL){const t=URL.createObjectURL(e),s=window.open("");if(!s)return;const r=s.document.createElement("img");r.onload=function(){URL.revokeObjectURL(t)},r.src=t,s.document.body.appendChild(r)}}static EncodeScreenshotCanvasData(e,t,s="image/png",r,i){if("string"!=typeof r&&t){if(t){if(g._IsOffScreenCanvas(e))return void e.convertToBlob({type:s,quality:i}).then((e=>{const s=new FileReader;s.readAsDataURL(e),s.onloadend=()=>{const e=s.result;t(e)}}));const r=e.toDataURL(s,i);t(r)}}else this.ToBlob(e,(function(e){e&&g.DownloadBlob(e,r),t&&t("")}),s,i)}static Download(e,t){if("undefined"==typeof URL)return;const s=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=s,r.download=t,r.addEventListener("click",(()=>{r.parentElement&&r.parentElement.removeChild(r)})),r.click(),window.URL.revokeObjectURL(s)}static BackCompatCameraNoPreventDefault(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]}static CreateScreenshot(e,t,s,r,i="image/png",n=!1,o){throw(0,l.n)("ScreenshotTools")}static CreateScreenshotAsync(e,t,s,r="image/png",i){throw(0,l.n)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(e,t,s,r,i="image/png",n=1,o=!1,a,h=!1,c=!1,u=!0,_,d){throw(0,l.n)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(e,t,s,r="image/png",i=1,n=!1,o,a=!1,h=!1,c=!0,u,_){throw(0,l.n)("ScreenshotTools")}static RandomId(){return(0,f.z)()}static IsBase64(e){return(0,u.f2)(e)}static DecodeBase64(e){return(0,u.rz)(e)}static get errorsCount(){return n.V.errorsCount}static Log(e){n.V.Log(e)}static Warn(e){n.V.Warn(e)}static Error(e){n.V.Error(e)}static get LogCache(){return n.V.LogCache}static ClearLogCache(){n.V.ClearLogCache()}static set LogLevels(e){n.V.LogLevels=e}static set PerformanceLogLevel(e){return(e&g.PerformanceUserMarkLogLevel)===g.PerformanceUserMarkLogLevel?(g.StartPerformanceCounter=g._StartUserMark,void(g.EndPerformanceCounter=g._EndUserMark)):(e&g.PerformanceConsoleLogLevel)===g.PerformanceConsoleLogLevel?(g.StartPerformanceCounter=g._StartPerformanceConsole,void(g.EndPerformanceCounter=g._EndPerformanceConsole)):(g.StartPerformanceCounter=g._StartPerformanceCounterDisabled,void(g.EndPerformanceCounter=g._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(e,t){}static _EndPerformanceCounterDisabled(e,t){}static _StartUserMark(e,t=!0){if(!g._Performance){if(!(0,i.BA)())return;g._Performance=window.performance}t&&g._Performance.mark&&g._Performance.mark(e+"-Begin")}static _EndUserMark(e,t=!0){t&&g._Performance.mark&&(g._Performance.mark(e+"-End"),g._Performance.measure(e,e+"-Begin",e+"-End"))}static _StartPerformanceConsole(e,t=!0){t&&(g._StartUserMark(e,t),console.time&&console.time(e))}static _EndPerformanceConsole(e,t=!0){t&&(g._EndUserMark(e,t),console.timeEnd(e))}static get Now(){return a.j.Now}static GetClassName(e,t=!1){let s=null;return!t&&e.getClassName?s=e.getClassName():(e instanceof Object&&(s=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),s||(s=typeof e)),s}static First(e,t){for(const s of e)if(t(s))return s;return null}static getFullClassName(e,t=!1){let s=null,r=null;if(!t&&e.getClassName)s=e.getClassName();else{if(e instanceof Object){const i=t?e:Object.getPrototypeOf(e);s=i.constructor.__bjsclassName__,r=i.constructor.__bjsmoduleName__}s||(s=typeof e)}return s?(null!=r?r+".":"")+s:null}static DelayAsync(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static IsSafari(){return!!(0,i.XD)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}g.AssetBaseUrl="",g.UseCustomRequestHeaders=!1,g.CustomRequestHeaders=h.u.CustomRequestHeaders,g.GetDOMTextContent=i.Zl,g._DefaultCdnUrl="https://cdn.babylonjs.com",g._DefaultAssetsUrl="https://assets.babylonjs.com/core",g.GetAbsoluteUrl="object"==typeof document?e=>{const t=document.createElement("a");return t.href=e,t.href}:"function"==typeof URL&&"object"==typeof location?e=>new URL(e,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},g.NoneLogLevel=n.V.NoneLogLevel,g.MessageLogLevel=n.V.MessageLogLevel,g.WarningLogLevel=n.V.WarningLogLevel,g.ErrorLogLevel=n.V.ErrorLogLevel,g.AllLogLevel=n.V.AllLogLevel,g.IsWindowObjectExist=i.BA,g.PerformanceNoneLogLevel=0,g.PerformanceUserMarkLogLevel=1,g.PerformanceConsoleLogLevel=2,g.StartPerformanceCounter=g._StartPerformanceCounterDisabled,g.EndPerformanceCounter=g._EndPerformanceCounterDisabled,g.Mix=p.zF,g.IsExponentOfTwo=p.L8,c.q.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},67618:(e,t,s)=>{function r(){return"undefined"!=typeof window}function i(){return"undefined"!=typeof navigator}function n(){return"undefined"!=typeof document}function o(e){let t="",s=e.firstChild;for(;s;)3===s.nodeType&&(t+=s.textContent),s=s.nextSibling;return t}s.d(t,{BA:()=>r,Nf:()=>n,XD:()=>i,Zl:()=>o})},72785:(e,t,s)=>{s.d(t,{j:()=>i});var r=s(67618);class i{static get Now(){return(0,r.BA)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},79233:(e,t,s)=>{s.d(t,{u:()=>r});class r{get wrapU(){return this._cachedWrapU}set wrapU(e){this._cachedWrapU=e}get wrapV(){return this._cachedWrapV}set wrapV(e){this._cachedWrapV=e}get wrapR(){return this._cachedWrapR}set wrapR(e){this._cachedWrapR=e}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(e){this._cachedAnisotropicFilteringLevel=e}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(e){this._comparisonFunction=e}get useMipMaps(){return this._useMipMaps}set useMipMaps(e){this._useMipMaps=e}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(e=1,t=1,s=1,r=1,i=2,n=0){return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=s,this._cachedAnisotropicFilteringLevel=r,this.samplingMode=i,this._comparisonFunction=n,this}compareSampler(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}}},84153:(e,t,s)=>{s.d(t,{W0:()=>o,iL:()=>n,kZ:()=>l,sg:()=>i,xt:()=>a});var r=s(24099);s(67618);const i={};function n(e,t,s=""){return s+(t?t+"\n":"")+e}function o(e,t,s,n,o,a,l){const h=l||i.loadFile;if(h)return h(e,t,s,n,o,a);throw(0,r.n)("FileTools")}function a(e,t,s,r){if(e)return t?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,s?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(r?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);{let e="";return t&&(e+="#define IS_NDC_HALF_ZRANGE"),s&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),r&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}function l(e,t,s=!1,r){switch(e){case 3:{const e=(ArrayBuffer,new Int8Array(t));return r&&e.set(new Int8Array(r)),e}case 0:{const e=(ArrayBuffer,new Uint8Array(t));return r&&e.set(new Uint8Array(r)),e}case 4:{const e=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(s?t/2:t);return r&&e.set(new Int16Array(r)),e}case 5:case 8:case 9:case 10:case 2:{const e=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(s?t/2:t);return r&&e.set(new Uint16Array(r)),e}case 6:{const e=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(s?t/4:t);return r&&e.set(new Int32Array(r)),e}case 7:case 11:case 12:case 13:case 14:case 15:{const e=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(s?t/4:t);return r&&e.set(new Uint32Array(r)),e}case 1:{const e=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(s?t/4:t);return r&&e.set(new Float32Array(r)),e}}const i=(ArrayBuffer,new Uint8Array(t));return r&&i.set(new Uint8Array(r)),i}},87712:(e,t,s)=>{s.d(t,{F:()=>o,_:()=>i});let r=[];class i{static SetImmediate(e){0===r.length&&setTimeout((()=>{const e=r;r=[];for(const t of e)t()}),1),r.push(e)}}function n(e,t,s){try{if(e())return t(),!0}catch(e){return s?.(e),!0}return!1}const o=(e,t,s,r=16,i=3e4,o=!0,a)=>{if(o&&n(e,t,s))return null;const l=setInterval((()=>{n(e,t,s)?clearInterval(l):(i-=r)<0&&(clearInterval(l),s?.(new Error("Operation timed out after maximum retries. "+(a||"")),!0))}),r);return()=>clearInterval(l)}},90658:(e,t,s)=>{s.d(t,{a:()=>r});class r{static ExponentialBackoff(e=3,t=500){return(s,r,i)=>0!==r.status||i>=e||-1!==s.indexOf("file:")?-1:Math.pow(2,i)*t}}},93556:(e,t,s)=>{let r;function i(e){r=e}s.d(t,{$I:()=>b,$d:()=>m,Qn:()=>S,Rz:()=>v,U6:()=>x,bk:()=>y,lI:()=>i}),e=s.hmd(e);let n=null;function o(){return null!==n&&0!==n.byteLength||(n=new Uint8Array(r.memory.buffer)),n}const a=new Array(128).fill(void 0);function l(e){return a[e]}a.push(void 0,null,!0,!1);let h=a.length;let c=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});function u(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`);return e.ptr}c.decode();let _=null,d=0;function f(e,t){const s=t(4*e.length,4)>>>0;return(null!==_&&0!==_.byteLength||(_=new Float32Array(r.memory.buffer)),_).set(e,s/4),d=e.length,s}function p(e){h===a.length&&a.push(a.length+1);const t=h;return h=a[t],a[t]=e,t}let g=null;function m(e,t,s,i,n,o,a){u(e,b);var l=f(t,r.__wbindgen_malloc),h=d,c=function(e,t){const s=t(2*e.length,2)>>>0;return(null!==g&&0!==g.byteLength||(g=new Uint16Array(r.memory.buffer)),g).set(e,s/2),d=e.length,s}(s,r.__wbindgen_malloc),_=d,m=f(i,r.__wbindgen_malloc),v=d,x=f(n,r.__wbindgen_malloc),y=d,S=f(o,r.__wbindgen_malloc),w=d;const F=r.build_chunk_vertex_data(e.__wbg_ptr,l,h,p(t),c,_,p(s),m,v,p(i),x,y,p(n),S,w,p(o),a);return C.__wrap(F)}Object.freeze({Up:0,0:"Up",Down:1,1:"Down",Left:2,2:"Left",Right:3,3:"Right",Forward:4,4:"Forward",Backward:5,5:"Backward"});class b{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_builddata_free(e)}get planet_diameter(){return r.__wbg_get_builddata_planet_diameter(this.__wbg_ptr)}set planet_diameter(e){r.__wbg_set_builddata_planet_diameter(this.__wbg_ptr,e)}get chunk_depth(){return r.__wbg_get_builddata_chunk_depth(this.__wbg_ptr)>>>0}set chunk_depth(e){r.__wbg_set_builddata_chunk_depth(this.__wbg_ptr,e)}get chunk_tree_direction(){return r.__wbg_get_builddata_chunk_tree_direction(this.__wbg_ptr)}set chunk_tree_direction(e){r.__wbg_set_builddata_chunk_tree_direction(this.__wbg_ptr,e)}get chunk_cube_position_x(){return r.__wbg_get_builddata_chunk_cube_position_x(this.__wbg_ptr)}set chunk_cube_position_x(e){r.__wbg_set_builddata_chunk_cube_position_x(this.__wbg_ptr,e)}get chunk_cube_position_y(){return r.__wbg_get_builddata_chunk_cube_position_y(this.__wbg_ptr)}set chunk_cube_position_y(e){r.__wbg_set_builddata_chunk_cube_position_y(this.__wbg_ptr,e)}get chunk_cube_position_z(){return r.__wbg_get_builddata_chunk_cube_position_z(this.__wbg_ptr)}set chunk_cube_position_z(e){r.__wbg_set_builddata_chunk_cube_position_z(this.__wbg_ptr,e)}get planet_seed(){return r.__wbg_get_builddata_planet_seed(this.__wbg_ptr)}set planet_seed(e){r.__wbg_set_builddata_planet_seed(this.__wbg_ptr,e)}get resolution(){return r.__wbg_get_builddata_resolution(this.__wbg_ptr)>>>0}set resolution(e){r.__wbg_set_builddata_resolution(this.__wbg_ptr,e)}get terrain_settings(){const e=r.__wbg_get_builddata_terrain_settings(this.__wbg_ptr);return v.__wrap(e)}set terrain_settings(e){u(e,v);var t=e.__destroy_into_raw();r.__wbg_set_builddata_terrain_settings(this.__wbg_ptr,t)}constructor(e,t,s,i,n,o,a,l,h){u(h,v);var c=h.__destroy_into_raw();const _=r.builddata_new(e,t,s,i,n,o,a,l,c);return this.__wbg_ptr=_>>>0,this}}class C{static __wrap(e){e>>>=0;const t=Object.create(C.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_returndata_free(e)}get nb_instances_created(){return r.__wbg_get_returndata_nb_instances_created(this.__wbg_ptr)>>>0}set nb_instances_created(e){r.__wbg_set_returndata_nb_instances_created(this.__wbg_ptr,e)}get average_height(){return r.__wbg_get_returndata_average_height(this.__wbg_ptr)}set average_height(e){r.__wbg_set_returndata_average_height(this.__wbg_ptr,e)}}class v{static __wrap(e){e>>>=0;const t=Object.create(v.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_terrainsettings_free(e)}get continents_frequency(){return r.__wbg_get_terrainsettings_continents_frequency(this.__wbg_ptr)}set continents_frequency(e){r.__wbg_set_terrainsettings_continents_frequency(this.__wbg_ptr,e)}get bumps_frequency(){return r.__wbg_get_terrainsettings_bumps_frequency(this.__wbg_ptr)}set bumps_frequency(e){r.__wbg_set_terrainsettings_bumps_frequency(this.__wbg_ptr,e)}get mountains_frequency(){return r.__wbg_get_terrainsettings_mountains_frequency(this.__wbg_ptr)}set mountains_frequency(e){r.__wbg_set_terrainsettings_mountains_frequency(this.__wbg_ptr,e)}get continents_fragmentation(){return r.__wbg_get_terrainsettings_continents_fragmentation(this.__wbg_ptr)}set continents_fragmentation(e){r.__wbg_set_terrainsettings_continents_fragmentation(this.__wbg_ptr,e)}get continent_base_height(){return r.__wbg_get_terrainsettings_continent_base_height(this.__wbg_ptr)}set continent_base_height(e){r.__wbg_set_terrainsettings_continent_base_height(this.__wbg_ptr,e)}get max_mountain_height(){return r.__wbg_get_terrainsettings_max_mountain_height(this.__wbg_ptr)}set max_mountain_height(e){r.__wbg_set_terrainsettings_max_mountain_height(this.__wbg_ptr,e)}get max_bump_height(){return r.__wbg_get_terrainsettings_max_bump_height(this.__wbg_ptr)}set max_bump_height(e){r.__wbg_set_terrainsettings_max_bump_height(this.__wbg_ptr,e)}constructor(){const e=r.terrainsettings_new();return this.__wbg_ptr=e>>>0,this}}function x(e,t,s){var r,i;new Uint8Array(l(s).buffer,l(s).byteOffset,l(s).byteLength).set((r=e,i=t,r>>>=0,o().subarray(r/1,r/1+i)))}function y(e){!function(e){const t=l(e);(function(e){e<132||(a[e]=h,h=e)})(e)}(e)}function S(e,t){throw new Error((s=e,r=t,s>>>=0,c.decode(o().subarray(s,s+r))));var s,r}},96347:(e,t,s)=>{s.d(t,{b4:()=>h,bu:()=>u,mO:()=>c,uR:()=>d});var r=s(67618),i=s(38552),n=s(9262),o=s(52101),a=s(24385),l=s(84153);function h(e,t){return(0,i.N5)(t).cachedPipelines[e]}function c(e){const t=e._name,s=e.context;if(t&&s){const e=(0,i.N5)(s),r=e.cachedPipelines[t];r?.dispose(),delete e.cachedPipelines[t]}}function u(e,t,s,i,n,o,l){let h,c;const u=(0,r.BA)()?o?.getHostDocument():null;h="string"==typeof t?t:t.vertexSource?"source:"+t.vertexSource:t.vertexElement?u?.getElementById(t.vertexElement)||t.vertexElement:t.vertex||t,c="string"==typeof t?t:t.fragmentSource?"source:"+t.fragmentSource:t.fragmentElement?u?.getElementById(t.fragmentElement)||t.fragmentElement:t.fragment||t;const d=[void 0,void 0],f=()=>{if(d[0]&&d[1]){e.isFragment=!0;const[r,h]=d;(0,a.M0)(h,e,((o,h)=>{l&&(l._fragmentSourceCodeBeforeMigration=h),s&&(o=s("fragment",o));const c=(0,a.nO)(r,o,e);e=null;const u=function(e,t,s,r){return s?{vertexSourceCode:(1===r?"//":"")+"#define SHADER_NAME vertex:"+(s.vertexElement||s.vertex||s.spectorName||s)+"\n"+e,fragmentSourceCode:(1===r?"//":"")+"#define SHADER_NAME fragment:"+(s.fragmentElement||s.fragment||s.spectorName||s)+"\n"+t}:{vertexSourceCode:e,fragmentSourceCode:t}}(c.vertexCode,c.fragmentCode,t,n);i?.(u.vertexSourceCode,u.fragmentSourceCode)}),o)}};_(h,"Vertex","",(t=>{(0,a.pB)(e),(0,a.M0)(t,e,((e,r)=>{l&&(l._rawVertexSourceCode=t,l._vertexSourceCodeBeforeMigration=r),s&&(e=s("vertex",e)),d[0]=e,f()}),o)}),n),_(c,"Fragment","Pixel",(e=>{l&&(l._rawFragmentSourceCode=e),d[1]=e,f()}),n)}function _(e,t,s,i,o,a){if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return void i((0,r.Zl)(e));if("source:"===e.substring(0,7))return void i(e.substring(7));if("base64:"===e.substring(0,7))return void i(window.atob(e.substring(7)));const h=n.l.GetShadersStore(o);if(h[e+t+"Shader"])return void i(h[e+t+"Shader"]);if(s&&h[e+s+"Shader"])return void i(h[e+s+"Shader"]);let c;if(c="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:n.l.GetShadersRepository(o)+e,!(a=a||l.W0))throw new Error("loadFileInjection is not defined");a(c+"."+t.toLowerCase()+".fx",i)}const d=(e,t,s,r)=>{try{const n=e.context?(0,i.N5)(e.context):null;n&&(n.disableParallelShaderCompile=e.disableParallelCompilation);const o=e.existingPipelineContext||t(e.shaderProcessingContext);return o._name=e.name,e.name&&n&&(n.cachedPipelines[e.name]=o),s(o,e.vertex,e.fragment,!!e.createAsRaw,"","",e.rebuildRebind,e.defines,e.transformFeedbackVaryings,"",(()=>{r(o,(()=>{e.onRenderingStateCompiled?.(o)}))})),o}catch(e){throw o.V.Error("Error compiling effect"),e}}},96648:(e,t,s)=>{s.d(t,{u:()=>r});class r{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}constructor(e=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}reset(){this.stencilMaterial=void 0,this.stencilGlobal?.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(e){if(!e)return;const t=!this.useStencilGlobalOnly&&!!this.stencilMaterial?.enabled;this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=t?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=t?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=t?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=t?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}}}]);